<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: MemoryCompressionOptimizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">MemoryCompressionOptimizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class is used in the function <a class="el" href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade" title="Performs optimization to reduce memory usage where possible, making use of the kCompressMatrix and kD...">OptimizeMemoryCompression()</a>, once we determine that there is some potential to do memory compression for this computation.  
 <a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for MemoryCompressionOptimizer:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer__coll__graph.png" border="0" usemap="#MemoryCompressionOptimizer_coll__map" alt="Collaboration graph"/></div>
<map name="MemoryCompressionOptimizer_coll__map" id="MemoryCompressionOptimizer_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_1_1MatrixCompressInfo.html">MatrixCompressInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9c5be1c635342710540a8f6c675625d8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a9c5be1c635342710540a8f6c675625d8">MemoryCompressionOptimizer</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 memory_compression_level, int32 middle_command, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a9c5be1c635342710540a8f6c675625d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2035ba0afa36778a6f4f664af777e7e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a2035ba0afa36778a6f4f664af777e7e6">Optimize</a> ()</td></tr>
<tr class="separator:a2035ba0afa36778a6f4f664af777e7e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ae23a562cb4f08452e78e541239a06668"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ae23a562cb4f08452e78e541239a06668">ProcessMatrix</a> (int32 m)</td></tr>
<tr class="separator:ae23a562cb4f08452e78e541239a06668"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cdcac57cf79079fc211c29b6d4cb8dc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a3cdcac57cf79079fc211c29b6d4cb8dc">ModifyComputation</a> ()</td></tr>
<tr class="separator:a3cdcac57cf79079fc211c29b6d4cb8dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a863b06831c83977ed474b5896a02a579"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_1_1MatrixCompressInfo.html">MatrixCompressInfo</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">compress_info_</a></td></tr>
<tr class="separator:a863b06831c83977ed474b5896a02a579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbabf05a7702103113a02a113015205f"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a></td></tr>
<tr class="separator:adbabf05a7702103113a02a113015205f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a715006dc6c8d8855816051d40a2c1944"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a715006dc6c8d8855816051d40a2c1944">memory_compression_level_</a></td></tr>
<tr class="separator:a715006dc6c8d8855816051d40a2c1944"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac098379dcf820792fc77cd03a42c759e"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac098379dcf820792fc77cd03a42c759e">middle_command_</a></td></tr>
<tr class="separator:ac098379dcf820792fc77cd03a42c759e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36d13565d1302a2bf74127b141ba3537"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a></td></tr>
<tr class="separator:a36d13565d1302a2bf74127b141ba3537"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8ca96df1ecdb635738c59a88cff8835"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a></td></tr>
<tr class="separator:ac8ca96df1ecdb635738c59a88cff8835"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class is used in the function <a class="el" href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade" title="Performs optimization to reduce memory usage where possible, making use of the kCompressMatrix and kD...">OptimizeMemoryCompression()</a>, once we determine that there is some potential to do memory compression for this computation. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04690">4690</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a9c5be1c635342710540a8f6c675625d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c5be1c635342710540a8f6c675625d8">&#9670;&nbsp;</a></span>MemoryCompressionOptimizer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html">MemoryCompressionOptimizer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>memory_compression_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>middle_command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nnet</td><td>The neural net the computation is for. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">memory_compression_level.</td><td>The level of compression: 0 = no compression (the constructor should not be called with this value). 1 = compression that doesn't affect the results (but still takes time). 2 = compression that affects the results only very slightly 3 = compression that affects the results a little more. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">middle_command</td><td>Must be the command-index of the command of type kNoOperationMarker in 'computation'. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">computation</td><td>The computation we're optimizing. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04703">4703</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize_8cc_source.html#l00501">kaldi::nnet3::Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;                                                          :</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>(nnet), <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a715006dc6c8d8855816051d40a2c1944">memory_compression_level_</a>(memory_compression_level),</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac098379dcf820792fc77cd03a42c759e">middle_command_</a>(middle_command), <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>(computation) { }</div><div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::MemoryCompressionOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04764">nnet-optimize-utils.cc:4764</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a715006dc6c8d8855816051d40a2c1944"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a715006dc6c8d8855816051d40a2c1944">kaldi::nnet3::MemoryCompressionOptimizer::memory_compression_level_</a></div><div class="ttdeci">int32 memory_compression_level_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04762">nnet-optimize-utils.cc:4762</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::MemoryCompressionOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04761">nnet-optimize-utils.cc:4761</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_ac098379dcf820792fc77cd03a42c759e"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac098379dcf820792fc77cd03a42c759e">kaldi::nnet3::MemoryCompressionOptimizer::middle_command_</a></div><div class="ttdeci">int32 middle_command_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04763">nnet-optimize-utils.cc:4763</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a3cdcac57cf79079fc211c29b6d4cb8dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cdcac57cf79079fc211c29b6d4cb8dc">&#9670;&nbsp;</a></span>ModifyComputation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ModifyComputation </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04769">4769</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l04730">MemoryCompressionOptimizer::MatrixCompressInfo::compression_command_index</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04737">MemoryCompressionOptimizer::MatrixCompressInfo::compression_type</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8cc_source.html#l01173">NnetComputation::GetWholeSubmatrices()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04640">kaldi::nnet3::InsertCommands()</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kaldi::nnet3::kCompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kaldi::nnet3::kDecompressMatrix</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04726">MemoryCompressionOptimizer::MatrixCompressInfo::m</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04744">MemoryCompressionOptimizer::MatrixCompressInfo::range</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04748">MemoryCompressionOptimizer::MatrixCompressInfo::truncate</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l04734">MemoryCompressionOptimizer::MatrixCompressInfo::uncompression_command_index</a>.</p>
<div class="fragment"><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;                                                   {</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;  <span class="comment">// whole_submatrices[m] is the submatrix-index of the submatrix that</span></div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;  <span class="comment">// represents the whole of matrix m.</span></div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;  std::vector&lt;int32&gt; whole_submatrices;</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac6ad0d391be80aff8f4538b6fbf747b1">GetWholeSubmatrices</a>(&amp;whole_submatrices);</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;  <span class="comment">// &#39;pairs_to_insert&#39; will be a list of pairs (command-index, command),</span></div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;  <span class="comment">// meaning: (command-index just before which to insert this command; command</span></div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;  <span class="comment">// to insert).</span></div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;  std::vector&lt;std::pair&lt;int32, NnetComputation::Command&gt; &gt;</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;      pairs_to_insert;</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;  pairs_to_insert.reserve(<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">compress_info_</a>.size() * 2);</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">compress_info_</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;    <span class="keyword">const</span> MatrixCompressInfo &amp;info = <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">compress_info_</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;    int32 s = whole_submatrices[info.m];</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;    <span class="comment">// below we use compression_command_index + 1 because we want the</span></div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;    <span class="comment">// compression to go after the command in &#39;info.compression_command_index&#39;</span></div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;    <span class="comment">// (which might be, for instance, a forward propagation command).</span></div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;    std::pair&lt;int32, NnetComputation::Command&gt; p1(</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;        info.compression_command_index + 1,</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;        NnetComputation::Command(info.range, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>,</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;                                 s, static_cast&lt;int32&gt;(info.compression_type),</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;                                 info.truncate ? 1 : 0));</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;    pairs_to_insert.push_back(p1);</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;    std::pair&lt;int32, NnetComputation::Command&gt; p2(</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;        info.uncompression_command_index,</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;        NnetComputation::Command(1.0, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>, s));</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;    pairs_to_insert.push_back(p2);</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;  }</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a0cc731e05d6603b7d4d0191f9f1c9d32">InsertCommands</a>(&amp;pairs_to_insert,</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;                 <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a863b06831c83977ed474b5896a02a579"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">kaldi::nnet3::MemoryCompressionOptimizer::compress_info_</a></div><div class="ttdeci">std::vector&lt; MatrixCompressInfo &gt; compress_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04759">nnet-optimize-utils.cc:4759</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a0cc731e05d6603b7d4d0191f9f1c9d32"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0cc731e05d6603b7d4d0191f9f1c9d32">kaldi::nnet3::InsertCommands</a></div><div class="ttdeci">void InsertCommands(std::vector&lt; std::pair&lt; int32, NnetComputation::Command &gt; &gt; *new_commands, NnetComputation *computation)</div><div class="ttdoc">Inserts commands into the computation at the requested places. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04640">nnet-optimize-utils.cc:4640</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::MemoryCompressionOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04764">nnet-optimize-utils.cc:4764</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kaldi::nnet3::kCompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ac6ad0d391be80aff8f4538b6fbf747b1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac6ad0d391be80aff8f4538b6fbf747b1">kaldi::nnet3::NnetComputation::GetWholeSubmatrices</a></div><div class="ttdeci">void GetWholeSubmatrices(std::vector&lt; int32 &gt; *whole_submatrices) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l01173">nnet-computation.cc:1173</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kaldi::nnet3::kDecompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2035ba0afa36778a6f4f664af777e7e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2035ba0afa36778a6f4f664af777e7e6">&#9670;&nbsp;</a></span>Optimize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Optimize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04803">4803</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, and <a class="el" href="nnet-optimize-utils_8h_source.html#l00335">DerivativeTimeLimiter::nnet_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l04899">kaldi::nnet3::OptimizeMemoryCompression()</a>.</p>
<div class="fragment"><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;                                          {</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">Init</a>(<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>, *<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;  <span class="comment">// note: matrix zero is not really a matrix.</span></div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;  int32 num_matrices = <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>.size();</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++)</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ae23a562cb4f08452e78e541239a06668">ProcessMatrix</a>(m);</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">compress_info_</a>.empty())</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a3cdcac57cf79079fc211c29b6d4cb8dc">ModifyComputation</a>();</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a863b06831c83977ed474b5896a02a579"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">kaldi::nnet3::MemoryCompressionOptimizer::compress_info_</a></div><div class="ttdeci">std::vector&lt; MatrixCompressInfo &gt; compress_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04759">nnet-optimize-utils.cc:4759</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a3cdcac57cf79079fc211c29b6d4cb8dc"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a3cdcac57cf79079fc211c29b6d4cb8dc">kaldi::nnet3::MemoryCompressionOptimizer::ModifyComputation</a></div><div class="ttdeci">void ModifyComputation()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04769">nnet-optimize-utils.cc:4769</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::MemoryCompressionOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04764">nnet-optimize-utils.cc:4764</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a47a751a8db1c9c4856d04495f80620e9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">kaldi::nnet3::NnetComputation::matrices</a></div><div class="ttdeci">std::vector&lt; MatrixInfo &gt; matrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00390">nnet-computation.h:390</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_aab8a145e53802c80302dc498e388a2ad"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">kaldi::nnet3::Analyzer::Init</a></div><div class="ttdeci">void Init(const Nnet &amp;nnet, const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01421">nnet-analyze.cc:1421</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_ae23a562cb4f08452e78e541239a06668"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ae23a562cb4f08452e78e541239a06668">kaldi::nnet3::MemoryCompressionOptimizer::ProcessMatrix</a></div><div class="ttdeci">void ProcessMatrix(int32 m)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04813">nnet-optimize-utils.cc:4813</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::MemoryCompressionOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04761">nnet-optimize-utils.cc:4761</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::MemoryCompressionOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04765">nnet-optimize-utils.cc:4765</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae23a562cb4f08452e78e541239a06668"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae23a562cb4f08452e78e541239a06668">&#9670;&nbsp;</a></span>ProcessMatrix()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ProcessMatrix </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04813">4813</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8h_source.html#l00223">Access::access_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-analyze_8h_source.html#l00222">Access::command_index</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kBackprop</a>, <a class="el" href="cu-compressed-matrix_8h_source.html#l00143">kaldi::kCompressedMatrixInt16</a>, <a class="el" href="cu-compressed-matrix_8h_source.html#l00142">kaldi::kCompressedMatrixUint8</a>, <a class="el" href="nnet-analyze_8h_source.html#l00076">kaldi::nnet3::kReadAccess</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00335">DerivativeTimeLimiter::nnet_</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>
<div class="fragment"><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;                                                      {</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>[m].is_output) {</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// We can&#39;t do this optimization for matrices that are going to be</span></div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;             <span class="comment">// output to the user.</span></div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;  }</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;  <span class="comment">// &#39;accesses&#39; list the commands that access this matrix.</span></div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;  <span class="keyword">const</span> std::vector&lt;Access&gt; &amp;accesses = <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>[m].accesses;</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;  <span class="comment">// the &#39;kReadAccess&#39; below is actually a don&#39;t-care  This is just</span></div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;  <span class="comment">// to find the position in &#39;accesses&#39; that corresponds to command-index</span></div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;  <span class="comment">// &#39;middle_command&#39;.</span></div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;  Access middle_access(<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac098379dcf820792fc77cd03a42c759e">middle_command_</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>);</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;  std::vector&lt;Access&gt;::const_iterator iter = std::lower_bound(accesses.begin(),</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;                                                              accesses.end(),</div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;                                                              middle_access);</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;  <span class="comment">// At this point, &#39;iter&#39; points to the first access in &#39;accesses&#39;</span></div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;  <span class="comment">// whose command index is &gt;= &#39;middle_command_&#39; (which separates the forward</span></div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;  <span class="comment">// and backward passes), or accesses.end() if this matrix was not</span></div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;  <span class="comment">// accessed during the backward pass.</span></div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;  <span class="keywordflow">if</span> (iter == accesses.end()) {</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// There is nothing to do: this matrix was not accessed during the</span></div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;             <span class="comment">// backward pass.</span></div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;  }</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;  <span class="keywordflow">if</span> (iter == accesses.begin()) {</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// There is nothing to do: this matrix was not accessed during the</span></div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;             <span class="comment">// forward pass.</span></div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;  }</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;  <span class="comment">// &#39;backward_access&#39; is the first access of the matrix in the backward</span></div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;  <span class="comment">// pass of the computation, and</span></div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;  <span class="comment">// &#39;forward_access&#39; is the last access of the matrix in the forward pass</span></div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;  <span class="comment">// of the computation.</span></div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;  <span class="keyword">const</span> Access &amp;backward_access = iter[0],</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;      &amp;forward_access = iter[-1];</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(forward_access.command_index &lt; <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac098379dcf820792fc77cd03a42c759e">middle_command_</a> &amp;&amp;</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;               backward_access.command_index &gt; <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac098379dcf820792fc77cd03a42c759e">middle_command_</a>);</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;  <span class="comment">// &#39;backward_access_is_last_access&#39; is going to be set to true if</span></div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;  <span class="comment">// &#39;backward_access&#39; is the last command to access the matrix (apart from</span></div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;  <span class="comment">// deallocation or matrix-swap commands, which don&#39;t show up in the list of</span></div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;  <span class="comment">// accesses).</span></div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;  <span class="keywordtype">bool</span> backward_access_is_last_access = (accesses.end() == iter + 1);</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;  int32 backward_command_index = backward_access.command_index,</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;      forward_command_index = forward_access.command_index;</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;  NnetComputation::Command</div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;      &amp;backward_command = <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[backward_command_index];</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a715006dc6c8d8855816051d40a2c1944">memory_compression_level_</a> &gt;= 1 &amp;&amp;</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;      backward_access_is_last_access &amp;&amp;</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;      backward_access.access_type == <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a> &amp;&amp;</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;      backward_command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>) {</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;    int32 component_index = backward_command.arg1;</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;    <span class="keyword">const</span> Component *component = <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(component_index);</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;    <span class="comment">// this is potentially a candidate for our optimization for ReLU units,</span></div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;    <span class="comment">// where we only need to store the sign.</span></div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;    <span class="keywordflow">if</span> (component-&gt;Type() == <span class="stringliteral">&quot;RectifiedLinearComponent&quot;</span>) {</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">compress_info_</a>.push_back(</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;          MatrixCompressInfo(m, forward_command_index,</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;                             backward_command_index,</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;                             <a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d">kCompressedMatrixUint8</a>, 0.0,</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;                             <span class="keyword">true</span>));</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;    }</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;  }</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;  <span class="comment">// If memory_compression_level &gt;= 2 (an &quot;intermediate&quot; level of compression),</span></div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;  <span class="comment">// then we&#39;ll consider compressing quantities using 16 bits in the range</span></div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;  <span class="comment">// [-10, 10].  Because of the way this compression works, exact zero will</span></div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;  <span class="comment">// still be uncompressed as exact zero, so even if this is the output</span></div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;  <span class="comment">// of a ReLU, it&#39;s OK.  (Having a few derivatives zero for ReLU outputs</span></div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;  <span class="comment">// that were very close to zero is OK.)</span></div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a715006dc6c8d8855816051d40a2c1944">memory_compression_level_</a> &gt;= 2) {</div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">compress_info_</a>.push_back(</div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;        MatrixCompressInfo(m, forward_command_index,</div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;                           backward_command_index,</div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;                           <a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa8cf976d526a5eac828cf765737a64bfa">kCompressedMatrixInt16</a>, 10.0,</div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;                           <span class="keyword">true</span>));</div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;  }</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;</div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;  <span class="comment">// TODO: later maybe implement something for memory compression level = 3.</span></div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a863b06831c83977ed474b5896a02a579"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a863b06831c83977ed474b5896a02a579">kaldi::nnet3::MemoryCompressionOptimizer::compress_info_</a></div><div class="ttdeci">std::vector&lt; MatrixCompressInfo &gt; compress_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04759">nnet-optimize-utils.cc:4759</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kaldi::nnet3::kReadAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00076">nnet-analyze.h:76</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::MemoryCompressionOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04764">nnet-optimize-utils.cc:4764</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00439">nnet-computation.h:439</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6a81f9c498a2d703ea343d906a827b6fa8cf976d526a5eac828cf765737a64bfa"><div class="ttname"><a href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa8cf976d526a5eac828cf765737a64bfa">kaldi::kCompressedMatrixInt16</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-compressed-matrix_8h_source.html#l00143">cu-compressed-matrix.h:143</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_a715006dc6c8d8855816051d40a2c1944"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#a715006dc6c8d8855816051d40a2c1944">kaldi::nnet3::MemoryCompressionOptimizer::memory_compression_level_</a></div><div class="ttdeci">int32 memory_compression_level_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04762">nnet-optimize-utils.cc:4762</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d"><div class="ttname"><a href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d">kaldi::kCompressedMatrixUint8</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-compressed-matrix_8h_source.html#l00142">cu-compressed-matrix.h:142</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_a1451c041c35be895025d122f136b9959"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">kaldi::nnet3::Analyzer::matrix_accesses</a></div><div class="ttdeci">std::vector&lt; MatrixAccesses &gt; matrix_accesses</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00298">nnet-analyze.h:298</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::MemoryCompressionOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04761">nnet-optimize-utils.cc:4761</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::MemoryCompressionOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04765">nnet-optimize-utils.cc:4765</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_html_ac098379dcf820792fc77cd03a42c759e"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#ac098379dcf820792fc77cd03a42c759e">kaldi::nnet3::MemoryCompressionOptimizer::middle_command_</a></div><div class="ttdeci">int32 middle_command_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04763">nnet-optimize-utils.cc:4763</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ac8ca96df1ecdb635738c59a88cff8835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8ca96df1ecdb635738c59a88cff8835">&#9670;&nbsp;</a></span>analyzer_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> analyzer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04765">4765</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="a863b06831c83977ed474b5896a02a579"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a863b06831c83977ed474b5896a02a579">&#9670;&nbsp;</a></span>compress_info_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structkaldi_1_1nnet3_1_1MemoryCompressionOptimizer_1_1MatrixCompressInfo.html">MatrixCompressInfo</a>&gt; compress_info_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04759">4759</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="a36d13565d1302a2bf74127b141ba3537"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36d13565d1302a2bf74127b141ba3537">&#9670;&nbsp;</a></span>computation_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>* computation_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04764">4764</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="a715006dc6c8d8855816051d40a2c1944"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a715006dc6c8d8855816051d40a2c1944">&#9670;&nbsp;</a></span>memory_compression_level_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 memory_compression_level_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04762">4762</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="ac098379dcf820792fc77cd03a42c759e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac098379dcf820792fc77cd03a42c759e">&#9670;&nbsp;</a></span>middle_command_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 middle_command_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04763">4763</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="adbabf05a7702103113a02a113015205f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbabf05a7702103113a02a113015205f">&#9670;&nbsp;</a></span>nnet_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a>&amp; nnet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04761">4761</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>nnet3/<a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li><li class="navelem"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html">MemoryCompressionOptimizer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
