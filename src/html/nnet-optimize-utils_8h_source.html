<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: nnet3/nnet-optimize-utils.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nnet-optimize-utils_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nnet-optimize-utils.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="nnet-optimize-utils_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// nnet3/nnet-optimize-utils.h</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Copyright 2015    Johns Hopkins University (author: Daniel Povey)</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See ../../COPYING for clarification regarding multiple authors</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// you may not use this file except in compliance with the License.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//  http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// MERCHANTABLITY OR NON-INFRINGEMENT.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// See the Apache 2 License for the specific language governing permissions and</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// limitations under the License.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#ifndef KALDI_NNET3_NNET_OPTIMIZE_UTILS_H_</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#define KALDI_NNET3_NNET_OPTIMIZE_UTILS_H_</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;mutex&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="nnet-compile_8h.html">nnet3/nnet-compile.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="nnet-analyze_8h.html">nnet3/nnet-analyze.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacekaldi.html">kaldi</a> {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">namespace </span>nnet3 {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">struct </span>NnetOptimizeOptions;  <span class="comment">// Forward declaration.</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">  133</a></span>&#160;<span class="keyword">class </span><a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">VariableMergingOptimizer</a> {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a65d0ad3958501631af43a076c556a8d8">VariableMergingOptimizer</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;config,</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                           <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// Note: you can call this only once.  If it returns true, it means it has</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// merged variables.  In this case, you have the option to instantiate another</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// copy of the class and try again with that other copy.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a08a57d03b1828eeb8548ee5e8a942264">MergeVariables</a>();</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  std::pair&lt;bool,bool&gt; <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a7156e8f117cea1292ffbbc0dc1d87067">MayBeMerged</a>(int32 command, int32 s1, int32 s2) <span class="keyword">const</span>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">// Merges to matrices, whether left merge or right merge.  s_to_keep and</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// s_to_discard are the submatrix-indexes we will keep and discard</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// respectively (these are s1 and s2 in some order.</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a22dcf522c53105fb97eedd837ec8f6ec">DoMerge</a>(int32 command_index, int32 s_to_keep, int32 m_to_discard);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">MarkAsDirty</a>(int32 s);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a98b1050f09da390896f964fb7a892391">Initialize</a>();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">  171</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>;</div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">  172</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>;</div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">  173</a></span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">  175</a></span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// lists of submatrices that correspond to each matrix.</span></div><div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">  178</a></span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">matrix_to_submatrix_</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">// for each variable (as defined by analyzer_.variables), true if</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">// we have already performed a merge on it.</span></div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">  182</a></span>&#160;  std::vector&lt;bool&gt; <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">variable_dirty_</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">  184</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">already_called_merge_variables_</a>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;};</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a1adea5ddcf5f2d26ee01d796ec13510c">ExtendMatrices</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#af512f7de6c401fbdf7013d62295df9c2">ConsolidateModelUpdate</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                            <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">// Class DerivativeTimeLimiter is used inside LimitDerivativeTimes().</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">// Its function is to modify the computation so that we don&#39;t work</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">// with derivatives outside of a specified range of t values; this is</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">// useful, for instance, in BLSTMs where you might have a fair amount of</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">// left and right context in the training examples but don&#39;t want to</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">// propagate the derivatives to there.</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">// We require that the computation have debug info set up</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">// (!matrix_debug_info.empty()) and that this be the first</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">// optimization you perform.  This means that the debug_info will</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">// be accurate and that all matrices will be initialized with</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">// zero contents.</span></div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html">  226</a></span>&#160;<span class="keyword">class </span><a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html">DerivativeTimeLimiter</a> {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html">DerivativeTimeLimiter</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                        int32 min_deriv_time,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                        int32 max_deriv_time,</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                        <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">void</span> LimitDerivTimes();</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">// sets up matrix_prune_info_.</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordtype">void</span> ComputeMatrixPruneInfo();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">// sets up subatrix_map_ and submatrix_map_if_deriv_.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordtype">void</span> ComputeSubmatrixMaps();</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// modifies all the commands as appropriate to reflect that some derivative</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// values are zero (i.e. save any computation we can, based on this</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// assumption).</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordtype">void</span> ModifyCommands();</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="comment">// this function, called after we&#39;ve modified the commands to operate on</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">// submatrices of the original matrices, works out for which of the matrices</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="comment">// we can actually limit their extent in time, and changes the way the</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="comment">// matrices are allocated (it may remove some matrices entirely).</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">void</span> PruneMatrices();</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">// this function modifies commands of type kPropagate to set the memo indexes</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// to zero if the memo indexes appear in the list memos_to_delete_.  It&#39;s</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">// because if a backprop command has been deleted, the propagate command</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">// should no longer store a memo.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordtype">void</span> RemoveUnusedMemos();</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// called from PruneMatrices only for matrices that are derivatives,</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">// not inputs or outputs of the computation, and which are partly</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// inside the time range, this function returns true if we can</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// limit the size of the matrix (because variables outside the</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">// desired range are never accessed), and false otherwise.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> CanLimitMatrix(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;analyzer,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                             int32 matrix_index) <span class="keyword">const</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// called from PruneMatrices after it has figured out which matrices we need</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// to limit to a row-range, this function changes computation-&gt;submatrices and</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// computation-&gt;matrices in the way required to do that.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> LimitMatrices(<span class="keyword">const</span> std::vector&lt;bool&gt; &amp;will_limit);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="comment">// does the processing for a command of type kMatrixCopy or kMatrixAdd.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordtype">void</span> MapSimpleMatrixCommand(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *c);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">// does the processing for a command of type kCopyRows or kAddRows, where</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// 1st and 2nd args are submatrix indexes and the 3rd arg is a vector of</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">// row-indexes.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">void</span> MapIndexesCommand(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *c);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// does the processing for a command of type kAddRowsMulti, kAddToRowsMulti,</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">// kCopyRowsMulti or kCopyToRowsMulti, 1st arg is submatrix index that the</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// command is called with, and 2nd arg is &#39;indexes_multi&#39; index (which</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// contains pairs (source-submatrix, source-row).</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">void</span> MapIndexesMultiCommand(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *c);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// does the processing for a command of type kAddRowRanges.</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordtype">void</span> MapAddRowRangesCommand(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *c);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// Modifies this command to take into account prune_info_.  At this point we</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// don&#39;t actually reduce the size of the matrices, we simply make the commands</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// operate on submatrices of the original matrices where possible- or</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// delete them completely if their output is all zeros or for other reasons</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// we detect that they would be no-ops.</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// Note: this calls computation_-&gt;NewSubMatrix, and will generate duplicates</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">// of the same submatrix which we&#39;ll later remove in RemoveOrphanMatrices.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">void</span> ModifyCommand(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *command);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">// this will detect which matrices we can reduce the allocated size of,</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">// and reduce their size.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordtype">void</span> ResizeMatrices();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">// Requires that we have mapped &#39;initial_submatrix&#39; to &#39;new_submatrix&#39; in</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="comment">// an operation that may have removed some data on the left and/or the</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">// right (but still they point to the same underlying matrix).  Outputs</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">// to &#39;left_prune&#39; and &#39;right_prune&#39; the number of rows we have</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// removed on the left and on the right respectively.</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> GetPruneValues(int32 initial_submatrix,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                             int32 new_submatrix,</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                             int32 *left_prune,</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                             int32 *right_prune) <span class="keyword">const</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="comment">// This helper function, used while mapping commands, returns true if the</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">// Cindex represented by the pair (submatrix, row_index) has a &#39;t&#39; value</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">// within the range [min_deriv_time_, max_deriv_time_].</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">bool</span> RowIsKept(int32 submatrix,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                 int32 row_index) <span class="keyword">const</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html">  321</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html">MatrixPruneInfo</a> {</div><div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a9da2804c57d358d12d491f0c3d51d0ef">  322</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a9da2804c57d358d12d491f0c3d51d0ef">is_deriv</a>;  <span class="comment">// true if the matrix represents a derivative (copied from</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                    <span class="comment">// the debug-info; repeated here for convenience).</span></div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a3080a09e5ea2e63c0b61d0ab3d0958bc">  324</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a3080a09e5ea2e63c0b61d0ab3d0958bc">fully_inside_range</a>;  <span class="comment">// True if the matrix is completely inside the time range</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                             <span class="comment">// specified.</span></div><div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a64221ce8a4754677e990d336b6154936">  326</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a64221ce8a4754677e990d336b6154936">partly_inside_range</a>;  <span class="comment">// true if the matrix is partly (but not fully)</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                               <span class="comment">// inside the time range specified.</span></div><div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a1854b20fac9e366b01781d5d7c3a87e9">  328</a></span>&#160;    int32 <a class="code" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a1854b20fac9e366b01781d5d7c3a87e9">row_begin</a>;  <span class="comment">// if partly_inside_range, the first row that&#39;s within the time range (i.e. for which</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                      <span class="comment">// min_deriv_time_ &lt;= t &lt; max_deriv_time_.</span></div><div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a5b5e72d60df6479503b80e9ed4861fc6">  330</a></span>&#160;    int32 <a class="code" href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a5b5e72d60df6479503b80e9ed4861fc6">row_end</a>;    <span class="comment">// if partly_inside_range, one plus the last row that&#39;s within</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                      <span class="comment">// the time range.</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  };</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#adbabf05a7702103113a02a113015205f">  335</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;<a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#adbabf05a7702103113a02a113015205f">nnet_</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a7d43f793d8585fd0de88e7a428d60a6b">  337</a></span>&#160;  int32 <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a7d43f793d8585fd0de88e7a428d60a6b">min_deriv_time_</a>;</div><div class="line"><a name="l00338"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a7b34d0f8ba1be1c25827f404fd1de33c">  338</a></span>&#160;  int32 <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a7b34d0f8ba1be1c25827f404fd1de33c">max_deriv_time_</a>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">// the computation; we require it to have debug info set up</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// (otherwise you shouldn&#39;t be instantiating this class).</span></div><div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a36d13565d1302a2bf74127b141ba3537">  342</a></span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *<a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// for each matrix index &gt; 0, the index of a submatrix that consists of</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// the entirety of that matrix.</span></div><div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#ab7df4401facb8eb025241471ca37a9d9">  346</a></span>&#160;  std::vector&lt;int32&gt; <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#ab7df4401facb8eb025241471ca37a9d9">whole_submatrices_</a>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a1e3dad6a0a1c8cc5e5806070896de8c1">  348</a></span>&#160;  std::vector&lt;MatrixPruneInfo&gt; <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a1e3dad6a0a1c8cc5e5806070896de8c1">matrix_prune_info_</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// for each submatrix in the original range of computation_-&gt;submatrices,</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">// submatrix_map_ maps it to itself if the submatrix is completely inside the</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">// time-range, or to zero if it&#39;s completely outside the time-range, or to a</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// newly created submatrix-index if it&#39;s partly inside the time-range.</span></div><div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a066039f8c4f9f320876c465226f17f59">  354</a></span>&#160;  std::vector&lt;int32&gt; <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a066039f8c4f9f320876c465226f17f59">submatrix_map_</a>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// submatrix_map_if_deriv_ contains the quantity:</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// IsDerivative(s) ? submatrix_map_[s] : s,</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">// where IsDerivative(s) is true if s is part of a matrix that (according to its</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">// debug info) represents a derivative.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">// this comes up so frequently that storing it separately seemed like a good idea.</span></div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a14a83a4f58ad0342612cbb5ff943c580">  361</a></span>&#160;  std::vector&lt;int32&gt; <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a14a83a4f58ad0342612cbb5ff943c580">submatrix_map_if_deriv_</a>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a15bb7ca12ed6762b58036e84ba948bd8">  363</a></span>&#160;  std::vector&lt;MatrixPruneInfo&gt; <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a15bb7ca12ed6762b58036e84ba948bd8">prune_info_</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="comment">// List of indexes of memos that will no longer be stored because the backprop</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="comment">// commands using them were deleted.</span></div><div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a6e33b4d185cc5638ac9a27c09d211490">  367</a></span>&#160;  std::unordered_set&lt;int32&gt; <a class="code" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a6e33b4d185cc5638ac9a27c09d211490">memos_to_delete_</a>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;};</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">// This utility function, used in code that calls LimitDerivativeTimes(), returns</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">// the largest time &#39;t&#39; in any of the &#39;outputs&#39; in the computation request,</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">// or crashes if there are no outputs (or no cindexes in those outputs).</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;int32 <a class="code" href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">MaxOutputTimeInRequest</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">// This is the top-level interface to limit the times on which derivatives are</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">// computed (e.g. for truncated BPTT); internally it uses class</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">// DerivativeLimiter.  Will do nothing if min_deriv_time and max_deriv_time are</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">// their default -inf,+inf values.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a6ed9b871bd28649b80165dc1af5d1a98">LimitDerivativeTimes</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                          int32 min_deriv_time,</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                          int32 max_deriv_time,</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                          <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a54a0b9eb6a79c232605aa83476d44bb0">RequestIsDecomposable</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                           <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *mini_request,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                           int32 *num_n_values);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#af8007bfceb176a3f8f7f3efb765c9062">ExpandComputation</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                       <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> &amp;misc_info,</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                       <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation,</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                       <span class="keywordtype">bool</span> need_debug_info,</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                       int32 num_n_values,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                       <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *expanded_computation);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a281a103d9beaef2e5d64370754800cd1">ReplaceRowWithMatrixOps</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a590c38bb0c9acc4ad1f626237f1a4169">SnipRowOps</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acd48d2ca65dc0a73952effbec24ccfb1">SplitRowOps</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">RenumberComputation</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">RemoveNoOps</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a2ec833031232462f45b425a8a5503489">IdentifySubmatrixArgs</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *command,</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                           std::vector&lt;int32*&gt; *submatrix_args);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacekaldi_1_1nnet3.html#ac879380727c26962a7aaa4a6de9dc4d4">MatrixIsUnused</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;analyzer,</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation,</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                    int32 m);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#af53fca33c55f05968eab8ec1009509e6">RemoveCommandsForUnusedMatrix</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;analyzer,</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                                   int32 m,</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                   <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a2ec833031232462f45b425a8a5503489">IdentifySubmatrixArgs</a>(std::vector&lt;NnetComputation::Command&gt; *commands,</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                           std::vector&lt;int32*&gt; *submatrix_args);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#af87da4e8a0e1880438bf77e8a34b4143">IdentifySubmatrixArgsInComputation</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                        std::vector&lt;int32*&gt; *submatrix_args);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#af96b480d0b6d2b5890e1490f8c2e6ac0">IdentifyIndexesMultiArgs</a>(std::vector&lt;NnetComputation::Command&gt; *commands,</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                              std::vector&lt;int32*&gt; *indexes_multi_args);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a6950699c83d835e55f003f89bb92bc80">IdentifyIndexesArgs</a>(std::vector&lt;NnetComputation::Command&gt; *commands,</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                         std::vector&lt;int32*&gt; *indexes_args);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a6950699c83d835e55f003f89bb92bc80">IdentifyIndexesArgs</a>(std::vector&lt;NnetComputation::Command&gt; *commands,</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                         std::vector&lt;int32*&gt; *indexes_args);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a17acd598bf1ced7e83e0c8a8569d224f">IdentifyIndexesRangesArgs</a>(std::vector&lt;NnetComputation::Command&gt; *commands,</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                               std::vector&lt;int32*&gt; *indexes_ranges_args);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a0cc731e05d6603b7d4d0191f9f1c9d32">InsertCommands</a>(</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    std::vector&lt;std::pair&lt;int32, NnetComputation::Command&gt; &gt; *commands,</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade">OptimizeMemoryCompression</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                               int32 memory_compression_level,</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                               <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#abb347167ff71d1cd8a2ab35b6eb2f636">OptimizeLoopedComputation</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                               <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">FixGotoLabel</a>(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1ComputationCache.html">  625</a></span>&#160;<span class="keyword">class </span><a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html">ComputationCache</a> {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html">ComputationCache</a>(int32 cache_capacity);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// Note: if something fails in Read(), or the written cache was from an older</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// format, it will just leave the cache empty.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordtype">void</span> Read(std::istream &amp;is, <span class="keywordtype">bool</span> binary);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordtype">void</span> Write(std::ostream &amp;os, <span class="keywordtype">bool</span> binary) <span class="keyword">const</span>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="comment">// Searches for the computation corresponding to this computation, and returns</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">// it if cached, or NULL (as std::shared_ptr) if not.  (We need shared_ptr to</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// handle multi-threaded operation, so that if the computation is ejected from</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">// the cache by another thread, it won&#39;t be deleted while still in use).  This</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">// function also moves this computation to the end of the</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="comment">// most-recently-accessed queue, which is why it&#39;s not const.</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  std::shared_ptr&lt;const NnetComputation&gt; Find(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="comment">// Inserts the computation into the cache-- this is assumed to be the</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="comment">// computation for the computation-request &#39;request&#39;.  Returns a shared_ptr</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="comment">// which can be used to access the object.  This function takes ownership of</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="comment">// &#39;computation&#39;.</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  std::shared_ptr&lt;const NnetComputation&gt; Insert(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request,</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                                <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  ~<a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html">ComputationCache</a>();</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">// Checks the stored computation for correctness.</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordtype">void</span> Check(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet) <span class="keyword">const</span>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a281b5ec791338d4378e22ef44a51b4a1">  658</a></span>&#160;  std::mutex <a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a281b5ec791338d4378e22ef44a51b4a1">mutex_</a>;  <span class="comment">// Read/write mutex.</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a38be6b2c66f846512889b9fed7669815">  660</a></span>&#160;  int32 <a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a38be6b2c66f846512889b9fed7669815">cache_capacity_</a>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">// The access queue for keeping track of the freshness of computation.</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">// Most-recently-accessed computation is at the end, and</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="comment">// least-recently-accessed computaiton is at the beginning.  Together with</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">// computation_cache_, this forms a most-recently-used (MRU) cache for</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">// Computations, indexed by ComputationRequest. The pointers are owned in</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">// computation_cache_.</span></div><div class="line"><a name="l00668"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1ComputationCache.html#ac16733b20c5641a0cdd0368171730ef1">  668</a></span>&#160;  <span class="keyword">typedef</span> std::list&lt;const ComputationRequest*&gt; <a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html#ac16733b20c5641a0cdd0368171730ef1">AqType</a>;</div><div class="line"><a name="l00669"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1ComputationCache.html#adc9736e62e5ba21e68fb538c9d573beb">  669</a></span>&#160;  AqType <a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="comment">// Map from computation-request to pair of (computation, and position in</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="comment">// access_queue_). Used for fast lookup of previously compiled computations.</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">// All pointers are owned here.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keyword">typedef</span> unordered_map&lt;<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>*,</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                        std::pair&lt;std::shared_ptr&lt;const NnetComputation&gt;, AqType::iterator&gt;,</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                        <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html">ComputationRequestHasher</a>,</div><div class="line"><a name="l00677"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a5ac4e16701f71c9fc428868117d849e2">  677</a></span>&#160;                        <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequestPtrEqual.html">ComputationRequestPtrEqual</a>&gt; <a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a5ac4e16701f71c9fc428868117d849e2">CacheType</a>;</div><div class="line"><a name="l00678"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a6d889d796739f83d1af7a8a081e5a316">  678</a></span>&#160;  CacheType <a class="code" href="classkaldi_1_1nnet3_1_1ComputationCache.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;};</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;} <span class="comment">// namespace nnet3</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;} <span class="comment">// namespace kaldi</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo_html_a5b5e72d60df6479503b80e9ed4861fc6"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a5b5e72d60df6479503b80e9ed4861fc6">kaldi::nnet3::DerivativeTimeLimiter::MatrixPruneInfo::row_end</a></div><div class="ttdeci">int32 row_end</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00330">nnet-optimize-utils.h:330</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac879380727c26962a7aaa4a6de9dc4d4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac879380727c26962a7aaa4a6de9dc4d4">kaldi::nnet3::MatrixIsUnused</a></div><div class="ttdeci">bool MatrixIsUnused(const Analyzer &amp;analyzer, const NnetComputation &amp;computation, int32 m)</div><div class="ttdoc">This function returns true if matrix 1 &lt;= m &lt; computation-&gt;matrices.size() is unused, defined as: it is not an input or an output, and is not accessed other than via commands of type kAllocMatrix, kDeallocMatrix, and kSetConst. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04582">nnet-optimize-utils.cc:4582</a></div></div>
<div class="ttc" id="namespacekaldi_html"><div class="ttname"><a href="namespacekaldi.html">kaldi</a></div><div class="ttdoc">Relabels neural network egs with the read pdf-id alignments. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8dox_source.html#l00020">chain.dox:20</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">kaldi::nnet3::VariableMergingOptimizer</a></div><div class="ttdoc">This class is responsible for merging matrices, although you probably want to access it via the the f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00133">nnet-optimize-utils.h:133</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a15bb7ca12ed6762b58036e84ba948bd8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a15bb7ca12ed6762b58036e84ba948bd8">kaldi::nnet3::DerivativeTimeLimiter::prune_info_</a></div><div class="ttdeci">std::vector&lt; MatrixPruneInfo &gt; prune_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00363">nnet-optimize-utils.h:363</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acd48d2ca65dc0a73952effbec24ccfb1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acd48d2ca65dc0a73952effbec24ccfb1">kaldi::nnet3::SplitRowOps</a></div><div class="ttdeci">bool SplitRowOps(NnetComputation *computation)</div><div class="ttdoc">This function detects cases where commands of type kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti use indexes that correspond to at most two submatrices, in two distinct ranges without gaps filled by -1&amp;#39;s, and could be converted to at most two commands of type kMatrixAdd, kMatrixCopy, kAddRows or kCopyRows. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02894">nnet-optimize-utils.cc:2894</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequestHasher_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html">kaldi::nnet3::ComputationRequestHasher</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00163">nnet-computation.h:163</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_abb347167ff71d1cd8a2ab35b6eb2f636"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abb347167ff71d1cd8a2ab35b6eb2f636">kaldi::nnet3::OptimizeLoopedComputation</a></div><div class="ttdeci">void OptimizeLoopedComputation(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This function tries to optimize computation &amp;#39;computation&amp;#39; for an &amp;#39;looped&amp;#39; computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04544">nnet-optimize-utils.cc:4544</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationCache_html_adc9736e62e5ba21e68fb538c9d573beb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationCache.html#adc9736e62e5ba21e68fb538c9d573beb">kaldi::nnet3::ComputationCache::access_queue_</a></div><div class="ttdeci">AqType access_queue_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00669">nnet-optimize-utils.h:669</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a63de82c33f6a7330727c0f2fc670ae0d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">kaldi::nnet3::VariableMergingOptimizer::variable_dirty_</a></div><div class="ttdeci">std::vector&lt; bool &gt; variable_dirty_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00182">nnet-optimize-utils.h:182</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2ec833031232462f45b425a8a5503489"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2ec833031232462f45b425a8a5503489">kaldi::nnet3::IdentifySubmatrixArgs</a></div><div class="ttdeci">void IdentifySubmatrixArgs(NnetComputation::Command *c, std::vector&lt; int32 *&gt; *submatrix_args)</div><div class="ttdoc">This function outputs to &quot;submatrix_args&quot; the addresses of a subset of arguments arg1 through arg6 in...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00028">nnet-optimize-utils.cc:28</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6828e427bd8883455705e0c9b99b5f2f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">kaldi::nnet3::RenumberComputation</a></div><div class="ttdeci">void RenumberComputation(NnetComputation *computation)</div><div class="ttdoc">This function detects submatrices and matrices that are never used (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00693">nnet-optimize-utils.cc:693</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a0cc731e05d6603b7d4d0191f9f1c9d32"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0cc731e05d6603b7d4d0191f9f1c9d32">kaldi::nnet3::InsertCommands</a></div><div class="ttdeci">void InsertCommands(std::vector&lt; std::pair&lt; int32, NnetComputation::Command &gt; &gt; *new_commands, NnetComputation *computation)</div><div class="ttdoc">Inserts commands into the computation at the requested places. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04640">nnet-optimize-utils.cc:4640</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a14a83a4f58ad0342612cbb5ff943c580"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a14a83a4f58ad0342612cbb5ff943c580">kaldi::nnet3::DerivativeTimeLimiter::submatrix_map_if_deriv_</a></div><div class="ttdeci">std::vector&lt; int32 &gt; submatrix_map_if_deriv_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00361">nnet-optimize-utils.h:361</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_ab7df4401facb8eb025241471ca37a9d9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#ab7df4401facb8eb025241471ca37a9d9">kaldi::nnet3::DerivativeTimeLimiter::whole_submatrices_</a></div><div class="ttdeci">std::vector&lt; int32 &gt; whole_submatrices_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00346">nnet-optimize-utils.h:346</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af87da4e8a0e1880438bf77e8a34b4143"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af87da4e8a0e1880438bf77e8a34b4143">kaldi::nnet3::IdentifySubmatrixArgsInComputation</a></div><div class="ttdeci">void IdentifySubmatrixArgsInComputation(NnetComputation *computation, std::vector&lt; int32 *&gt; *submatrix_args)</div><div class="ttdoc">This function outputs to &quot;submatrix_args&quot; the addresses of integers in &amp;#39;computation&amp;#39; that correspond ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00340">nnet-optimize-utils.cc:340</a></div></div>
<div class="ttc" id="nnet-analyze_8h_html"><div class="ttname"><a href="nnet-analyze_8h.html">nnet-analyze.h</a></div><div class="ttdoc">This file contains utilities for analyzing and checking computations, which are used in the optimizat...</div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo_html_a1854b20fac9e366b01781d5d7c3a87e9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a1854b20fac9e366b01781d5d7c3a87e9">kaldi::nnet3::DerivativeTimeLimiter::MatrixPruneInfo::row_begin</a></div><div class="ttdeci">int32 row_begin</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00328">nnet-optimize-utils.h:328</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a54a0b9eb6a79c232605aa83476d44bb0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a54a0b9eb6a79c232605aa83476d44bb0">kaldi::nnet3::RequestIsDecomposable</a></div><div class="ttdeci">bool RequestIsDecomposable(const ComputationRequest &amp;request, ComputationRequest *mini_request, int32 *num_n_values)</div><div class="ttdoc">This function, used in &amp;#39;shortcut&amp;#39; compilation where we first compile a smaller computation with the s...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03852">nnet-optimize-utils.cc:3852</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationCache_html_a281b5ec791338d4378e22ef44a51b4a1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationCache.html#a281b5ec791338d4378e22ef44a51b4a1">kaldi::nnet3::ComputationCache::mutex_</a></div><div class="ttdeci">std::mutex mutex_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00658">nnet-optimize-utils.h:658</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::DerivativeTimeLimiter::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00342">nnet-optimize-utils.h:342</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1MiscComputationInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">kaldi::nnet3::MiscComputationInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00055">nnet-computation.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1adea5ddcf5f2d26ee01d796ec13510c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1adea5ddcf5f2d26ee01d796ec13510c">kaldi::nnet3::ExtendMatrices</a></div><div class="ttdeci">void ExtendMatrices(NnetComputation *computation)</div><div class="ttdoc">This is not really an optimization in itself but it can make things easier for class VariableMergingO...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l01270">nnet-optimize-utils.cc:1270</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6ed9b871bd28649b80165dc1af5d1a98"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6ed9b871bd28649b80165dc1af5d1a98">kaldi::nnet3::LimitDerivativeTimes</a></div><div class="ttdeci">void LimitDerivativeTimes(const Nnet &amp;nnet, int32 min_deriv_time, int32 max_deriv_time, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02215">nnet-optimize-utils.cc:2215</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a10b449e04f7115cc85d295440638fade"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade">kaldi::nnet3::OptimizeMemoryCompression</a></div><div class="ttdeci">void OptimizeMemoryCompression(const Nnet &amp;nnet, int32 memory_compression_level, NnetComputation *computation)</div><div class="ttdoc">Performs optimization to reduce memory usage where possible, making use of the kCompressMatrix and kD...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04899">nnet-optimize-utils.cc:4899</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a7b34d0f8ba1be1c25827f404fd1de33c"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a7b34d0f8ba1be1c25827f404fd1de33c">kaldi::nnet3::DerivativeTimeLimiter::max_deriv_time_</a></div><div class="ttdeci">int32 max_deriv_time_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00338">nnet-optimize-utils.h:338</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a22dcf522c53105fb97eedd837ec8f6ec"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a22dcf522c53105fb97eedd837ec8f6ec">kaldi::nnet3::VariableMergingOptimizer::DoMerge</a></div><div class="ttdeci">void DoMerge(int32 command_index, int32 s_to_keep, int32 m_to_discard)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00819">nnet-optimize-utils.cc:819</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac580549257041c725612ff223c99e43c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">kaldi::nnet3::MaxOutputTimeInRequest</a></div><div class="ttdeci">int32 MaxOutputTimeInRequest(const ComputationRequest &amp;request)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00484">nnet-optimize.cc:484</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a1e3dad6a0a1c8cc5e5806070896de8c1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a1e3dad6a0a1c8cc5e5806070896de8c1">kaldi::nnet3::DerivativeTimeLimiter::matrix_prune_info_</a></div><div class="ttdeci">std::vector&lt; MatrixPruneInfo &gt; matrix_prune_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00348">nnet-optimize-utils.h:348</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a4dcce2ef4364ac3b222debac11646a39"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">kaldi::nnet3::VariableMergingOptimizer::config_</a></div><div class="ttdeci">const NnetOptimizeOptions &amp; config_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00171">nnet-optimize-utils.h:171</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a0655730456d3a04cafe943687894a84d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">kaldi::nnet3::VariableMergingOptimizer::matrix_to_submatrix_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int32 &gt; &gt; matrix_to_submatrix_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00178">nnet-optimize-utils.h:178</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af96b480d0b6d2b5890e1490f8c2e6ac0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af96b480d0b6d2b5890e1490f8c2e6ac0">kaldi::nnet3::IdentifyIndexesMultiArgs</a></div><div class="ttdeci">void IdentifyIndexesMultiArgs(std::vector&lt; NnetComputation::Command &gt; *commands, std::vector&lt; int32 *&gt; *indexes_multi_args)</div><div class="ttdoc">Identifies in the vector of commands, arguments that correspond to indexes into the computation&amp;#39;s ind...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00105">nnet-optimize-utils.cc:105</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">kaldi::nnet3::NnetComputation::Command</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00338">nnet-computation.h:338</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a6e33b4d185cc5638ac9a27c09d211490"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a6e33b4d185cc5638ac9a27c09d211490">kaldi::nnet3::DerivativeTimeLimiter::memos_to_delete_</a></div><div class="ttdeci">std::unordered_set&lt; int32 &gt; memos_to_delete_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00367">nnet-optimize-utils.h:367</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html">kaldi::nnet3::DerivativeTimeLimiter</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00226">nnet-optimize-utils.h:226</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">kaldi::nnet3::NnetOptimizeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequestPtrEqual_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequestPtrEqual.html">kaldi::nnet3::ComputationRequestPtrEqual</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00168">nnet-computation.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::VariableMergingOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00173">nnet-optimize-utils.h:173</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::VariableMergingOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00175">nnet-optimize-utils.h:175</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a281a103d9beaef2e5d64370754800cd1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a281a103d9beaef2e5d64370754800cd1">kaldi::nnet3::ReplaceRowWithMatrixOps</a></div><div class="ttdeci">bool ReplaceRowWithMatrixOps(NnetComputation *computation)</div><div class="ttdoc">This function detects cases where commands of type kCopyRows, kAddRows or kAddToRows can be converted...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02288">nnet-optimize-utils.cc:2288</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::VariableMergingOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00172">nnet-optimize-utils.h:172</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a7d43f793d8585fd0de88e7a428d60a6b"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a7d43f793d8585fd0de88e7a428d60a6b">kaldi::nnet3::DerivativeTimeLimiter::min_deriv_time_</a></div><div class="ttdeci">int32 min_deriv_time_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00337">nnet-optimize-utils.h:337</a></div></div>
<div class="ttc" id="nnet-compile_8h_html"><div class="ttname"><a href="nnet-compile_8h.html">nnet-compile.h</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a98b1050f09da390896f964fb7a892391"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a98b1050f09da390896f964fb7a892391">kaldi::nnet3::VariableMergingOptimizer::Initialize</a></div><div class="ttdeci">void Initialize()</div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8953a6af8e449d7cc12efeb115c5f8d2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">kaldi::nnet3::FixGotoLabel</a></div><div class="ttdeci">void FixGotoLabel(NnetComputation *computation)</div><div class="ttdoc">This function ensures that the arg1 of a final command of type kGotoLabel is the same as the command ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04552">nnet-optimize-utils.cc:4552</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationCache_html_a5ac4e16701f71c9fc428868117d849e2"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationCache.html#a5ac4e16701f71c9fc428868117d849e2">kaldi::nnet3::ComputationCache::CacheType</a></div><div class="ttdeci">unordered_map&lt; const ComputationRequest *, std::pair&lt; std::shared_ptr&lt; const NnetComputation &gt;, AqType::iterator &gt;, ComputationRequestHasher, ComputationRequestPtrEqual &gt; CacheType</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00677">nnet-optimize-utils.h:677</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::DerivativeTimeLimiter::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00335">nnet-optimize-utils.h:335</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af8007bfceb176a3f8f7f3efb765c9062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af8007bfceb176a3f8f7f3efb765c9062">kaldi::nnet3::ExpandComputation</a></div><div class="ttdeci">void ExpandComputation(const Nnet &amp;nnet, const MiscComputationInfo &amp;misc_info, const NnetComputation &amp;computation, bool need_debug_info, int32 num_n_values, NnetComputation *expanded_computation)</div><div class="ttdoc">This function is used in &amp;#39;shortcut&amp;#39; compilation to expand a computation that has been compiled for ex...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03804">nnet-optimize-utils.cc:3804</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af512f7de6c401fbdf7013d62295df9c2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af512f7de6c401fbdf7013d62295df9c2">kaldi::nnet3::ConsolidateModelUpdate</a></div><div class="ttdeci">void ConsolidateModelUpdate(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization consolidates the model-update part of backprop commands, for components in (e...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l01551">nnet-optimize-utils.cc:1551</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationCache_html_a6d889d796739f83d1af7a8a081e5a316"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationCache.html#a6d889d796739f83d1af7a8a081e5a316">kaldi::nnet3::ComputationCache::computation_cache_</a></div><div class="ttdeci">CacheType computation_cache_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00678">nnet-optimize-utils.h:678</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a60ce57f518b5fa77d140cb414354cd95"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">kaldi::nnet3::VariableMergingOptimizer::MarkAsDirty</a></div><div class="ttdeci">void MarkAsDirty(int32 s)</div><div class="ttdoc">Marks the variables underlying submatrix &amp;#39;s&amp;#39; as dirty. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00807">nnet-optimize-utils.cc:807</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a65d0ad3958501631af43a076c556a8d8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a65d0ad3958501631af43a076c556a8d8">kaldi::nnet3::VariableMergingOptimizer::VariableMergingOptimizer</a></div><div class="ttdeci">VariableMergingOptimizer(const NnetOptimizeOptions &amp;config, const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00711">nnet-optimize-utils.cc:711</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo_html_a9da2804c57d358d12d491f0c3d51d0ef"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a9da2804c57d358d12d491f0c3d51d0ef">kaldi::nnet3::DerivativeTimeLimiter::MatrixPruneInfo::is_deriv</a></div><div class="ttdeci">bool is_deriv</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00322">nnet-optimize-utils.h:322</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1146f4efa141a56210f9dbf1090b20f0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">kaldi::nnet3::RemoveNoOps</a></div><div class="ttdeci">void RemoveNoOps(NnetComputation *computation)</div><div class="ttdoc">Removes commands of type kNoOperation in the computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00703">nnet-optimize-utils.cc:703</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a08a57d03b1828eeb8548ee5e8a942264"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a08a57d03b1828eeb8548ee5e8a942264">kaldi::nnet3::VariableMergingOptimizer::MergeVariables</a></div><div class="ttdeci">bool MergeVariables()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00723">nnet-optimize-utils.cc:723</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo_html_a64221ce8a4754677e990d336b6154936"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a64221ce8a4754677e990d336b6154936">kaldi::nnet3::DerivativeTimeLimiter::MatrixPruneInfo::partly_inside_range</a></div><div class="ttdeci">bool partly_inside_range</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00326">nnet-optimize-utils.h:326</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a17acd598bf1ced7e83e0c8a8569d224f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a17acd598bf1ced7e83e0c8a8569d224f">kaldi::nnet3::IdentifyIndexesRangesArgs</a></div><div class="ttdeci">void IdentifyIndexesRangesArgs(std::vector&lt; NnetComputation::Command &gt; *commands, std::vector&lt; int32 *&gt; *indexes_ranges_args)</div><div class="ttdoc">Identifies in the vector of commands, arguments that correspond to indexes into the computation&amp;#39;s &amp;#39;in...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00121">nnet-optimize-utils.cc:121</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af53fca33c55f05968eab8ec1009509e6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af53fca33c55f05968eab8ec1009509e6">kaldi::nnet3::RemoveCommandsForUnusedMatrix</a></div><div class="ttdeci">void RemoveCommandsForUnusedMatrix(const Analyzer &amp;analyzer, int32 m, NnetComputation *computation)</div><div class="ttdoc">This function removes from &amp;#39;computation&amp;#39; the commands accessing matrix &amp;#39;m&amp;#39;, which is assumed to be un...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04600">nnet-optimize-utils.cc:4600</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter_html_a066039f8c4f9f320876c465226f17f59"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html#a066039f8c4f9f320876c465226f17f59">kaldi::nnet3::DerivativeTimeLimiter::submatrix_map_</a></div><div class="ttdeci">std::vector&lt; int32 &gt; submatrix_map_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00354">nnet-optimize-utils.h:354</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationCache_html_ac16733b20c5641a0cdd0368171730ef1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationCache.html#ac16733b20c5641a0cdd0368171730ef1">kaldi::nnet3::ComputationCache::AqType</a></div><div class="ttdeci">std::list&lt; const ComputationRequest * &gt; AqType</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00668">nnet-optimize-utils.h:668</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a400e33db7a90834eec20a7eee34f162d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">kaldi::nnet3::VariableMergingOptimizer::already_called_merge_variables_</a></div><div class="ttdeci">bool already_called_merge_variables_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00184">nnet-optimize-utils.h:184</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a590c38bb0c9acc4ad1f626237f1a4169"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a590c38bb0c9acc4ad1f626237f1a4169">kaldi::nnet3::SnipRowOps</a></div><div class="ttdeci">bool SnipRowOps(NnetComputation *computation)</div><div class="ttdoc">This function detects cases where commands of type kCopyRows, kAddRows, kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti or kAddRowRanges use indexes that start or end with -1&amp;#39;s or equivalents, and replace them with similar commands that act on a sub-matrix of the matrices they are currently acting on. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02537">nnet-optimize-utils.cc:2537</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html">kaldi::nnet3::DerivativeTimeLimiter::MatrixPruneInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00321">nnet-optimize-utils.h:321</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationCache_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationCache.html">kaldi::nnet3::ComputationCache</a></div><div class="ttdoc">Class ComputationCache is used inside class CachingOptimizingCompiler to cache previously computed co...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00625">nnet-optimize-utils.h:625</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6950699c83d835e55f003f89bb92bc80"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6950699c83d835e55f003f89bb92bc80">kaldi::nnet3::IdentifyIndexesArgs</a></div><div class="ttdeci">void IdentifyIndexesArgs(std::vector&lt; NnetComputation::Command &gt; *commands, std::vector&lt; int32 *&gt; *indexes_args)</div><div class="ttdoc">Identifies in the vector of commands, arguments that correspond to indexes into the computation&amp;#39;s &amp;#39;in...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00133">nnet-optimize-utils.cc:133</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationCache_html_a38be6b2c66f846512889b9fed7669815"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationCache.html#a38be6b2c66f846512889b9fed7669815">kaldi::nnet3::ComputationCache::cache_capacity_</a></div><div class="ttdeci">int32 cache_capacity_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00660">nnet-optimize-utils.h:660</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html">kaldi::nnet3::Analyzer</a></div><div class="ttdoc">This struct exists to set up various pieces of analysis; it helps avoid the repetition of code where ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00294">nnet-analyze.h:294</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a7156e8f117cea1292ffbbc0dc1d87067"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a7156e8f117cea1292ffbbc0dc1d87067">kaldi::nnet3::VariableMergingOptimizer::MayBeMerged</a></div><div class="ttdeci">std::pair&lt; bool, bool &gt; MayBeMerged(int32 command, int32 s1, int32 s2) const</div><div class="ttdoc">This function returns a pair of bools saying whether we can do a (left and/or right) merge respective...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00945">nnet-optimize-utils.cc:945</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo_html_a3080a09e5ea2e63c0b61d0ab3d0958bc"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1DerivativeTimeLimiter_1_1MatrixPruneInfo.html#a3080a09e5ea2e63c0b61d0ab3d0958bc">kaldi::nnet3::DerivativeTimeLimiter::MatrixPruneInfo::fully_inside_range</a></div><div class="ttdeci">bool fully_inside_range</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00324">nnet-optimize-utils.h:324</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_67a0a17020b8eedc08ffa5626b1d53a1.html">nnet3</a></li><li class="navelem"><a class="el" href="nnet-optimize-utils_8h.html">nnet-optimize-utils.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
