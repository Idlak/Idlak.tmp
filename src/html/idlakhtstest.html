<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Testing the Idlak Front End with HTS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('idlakhtstest.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Testing the Idlak Front End with HTS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="idlaktxp_intro"></a>
Introduction</h1>
<p>HTS (H triple S - Hidden Markov Speech Synthesis System) is the leading open source parametric speech synthesis. As different parts of Idlak are added it is useful to feed information from them into HTS to see how these new modules are performing. In this document we outline the steps required to carry out these tests.</p>
<p>When possible these tests are automated, but as they rely on substantial third party releases it is quite possible the automatic scripts will fail dues to future changes in other releases. The automatic scripts intend to also act as a transparent sequence of commands, so if there is a problem you will need to refer back to these and determine which step has failed.</p>
<p>Currently these tests are carried out on:</p>
<p><a href="http://hts.sp.nitech.ac.jp/archives/2.3alpha/HTS-demo_CMU-ARCTIC-SLT.tar.bz2">http://hts.sp.nitech.ac.jp/archives/2.3alpha/HTS-demo_CMU-ARCTIC-SLT.tar.bz2</a></p>
<p>Using hts_engine output. This is not the best output you can achieve from HTS see <a href="http://hts.sp.nitech.ac.jp/">http://hts.sp.nitech.ac.jp/</a> for details of what's available and recent work on HTS.</p>
<p>The first test uses the Kaldi front end to drive the HTS system, other tests will follow as additional modules are added to Idlak. It is assumed you have already downloaded and built the Idlak branch from Kaldi.</p>
<h1><a class="anchor" id="idlaktxp_downloadhts"></a>
Downloading HTS</h1>
<p>All tests require downloading and building the HTS-demo. In order to do this you must register to get a userid and password to allow you to download HTK at <a href="http://htk.eng.cam.ac.uk/register.shtml">http://htk.eng.cam.ac.uk/register.shtml</a> once you have the userid and password you are ready to download the HTS-demo. Using the script install_HTS_demo.sh:</p>
<pre class="fragment">cd idlak-voice-build/utils
./install_HTS_demo.sh &lt;HTKID&gt; &lt;HTK PASSWORD&gt; &lt;INSTALL LOCATION&gt; STRAIGHT
</pre><p> or </p><pre class="fragment">./install_HTS_demo.sh &lt;HTKID&gt; &lt;HTK PASSWORD&gt; &lt;INSTALL LOCATION&gt; NOSTRAIGHT
</pre><p>Avoid installing HTS within an AFS directory unless you understand how to generate long life tokens. Initially we recommend an install location on a local scratch drive and avoiding installing within the Kaldi directory structure.</p>
<p>For testing with the STRAIGHT demo you will need to arrange access to the MATLAB STRAIGHT code distributed by Professor Kawahara. The latest release (STRAIGHTV40_007d) does not currently produce correct output synthesis but (STRAIGHTV40_005b) has been tested with this setup.</p>
<p>Reported results are based on Idlak version r3764 with non-STRAIGHT HTS-demo.</p>
<p>To test the HTS download:</p>
<pre class="fragment">cd &lt;INSTALL LOCATION&gt;/HTS-demo_CMU-ARCTIC-SLT
source config.txt
make
</pre><p>config.txt has the appropriate configuration set by the install_HTS_demo.sh script.</p>
<p>make will run data extraction and train models (which can take 24 hours).</p>
<h1><a class="anchor" id="idlaktxp_arcticstl"></a>
Downloading Arctic STL data</h1>
<p>The HTS demo we are using here used the stl arctic corpus. (see <a href="http://festvox.org/cmu_arctic">http://festvox.org/cmu_arctic</a>). In order to build the front end to produce Kaldi generated context model we need to install this corpus into Kaldi.</p>
<pre class="fragment">cd idlak-voice-build/utils
python prepare_arctic_slt.py
</pre><p>This will install arctic stl corpus into idlak-data/en/ga/stl.</p>
<h1><a class="anchor" id="idlaktxp_buikldcex"></a>
Building Full Context Models</h1>
<p>A full context model in Kaldi is a series of integers, in HTK it is a long string with delimited values. To build these models we need to carry out linguistic and pronunciation analysis on the stl corpus.</p>
<pre class="fragment">cd idlak-voice-build
python modules/alignsetup_def.py --buildid=&lt;ISO DATE&gt; --spkconf=speaker_conf/slt.xml
python modules/align_def.py --buildid=&lt;ISO DATE&gt; --spkconf=speaker_conf/slt.xml
python modules/cex_def.py --buildid=&lt;ISO DATE&gt; --spkconf=speaker_conf/slt.xml --hts
</pre><p>Where the build id is used to allow multiple builds and is typically and ISO date in the form YYYMMDD.</p>
<p>This will automatically run alignment using Kaldi, aligning CMU lexicon style phone names and determine pause positions.</p>
<p>By default output from this process will be stored in: </p><pre class="fragment"> idlak-voice-build/idlak-scratch/en/ga/slt/cex_def/&lt;BUILD ID&gt;/output/
</pre><p>The system generates full context models for each pause separated chunk of speech in the corpus (htslab), and an hts question file for building the decision trees (questions-kaldi-en-ga.hed) in HTK and the start and end times of each pause separated chunk of speech in the original corpus waveforms (spt_times.dat).</p>
<h1><a class="anchor" id="idlaktxp_htsintegration"></a>
Integrating KALDI CEX output with HTS</h1>
<p>In contrast to HTS which defaults to using whole utterances for building models Idlak uses silence delimited chunks of speech. Therefore we need to replace the original raw wavfiles in the HTS-demo with wave files cut up appropriately, as well as replacing the model label files and question file with those generated from Idlak.</p>
<p>HTS defaults to using 48khz input wav files and the arctic corpus that is available to download is 16Khz. Therefore we need to cut up the HTS-demo wavs appropriately rather than the wavs downloaded to build the alignment and context models.</p>
<pre class="fragment">cd idlak-voice-build
python modules/hts_test.py --buildid=&lt;ISO DATE&gt; --spkconf=speaker_conf/slt.xml --htsdemodir=&lt;INSTALL LOCATION&gt;
</pre><h1><a class="anchor" id="idlaktxp_htsgeneration"></a>
Creating Models for Speech Generation</h1>
<p>The hts engine that will synthesis output also requires full context models. These need to be generated using the Kaldi front end from XML text. The HTS demo uses the opening text from Alice in Wonderland although the actual text and the edition used is not specified. To directly compare output you can use the same text downloaded from librivox (<a href="http://www.gutenberg.org/etext/11">http://www.gutenberg.org/etext/11</a>)</p>
<pre class="fragment">mv &lt;INSTALL LOCATION&gt;/HTS-demo_CMU-ARCTIC-SLT/data/labels/gen &lt;INSTALL LOCATION&gt;/HTS-demo_CMU-ARCTIC-SLT/data/labels/gen.orig
mkdir &lt;INSTALL LOCATION&gt;/HTS-demo_CMU-ARCTIC-SLT/data/labels/gen
cd idlak-voice-build/utils
cat ../../idlak-data/en/testdata/alice.xml | \
../../src/idlaktxpbin/idlaktxp --pretty --tpdb=../../idlak-data/en/ga/slt - - | \
../../src/idlaktxpbin/idlakcex --pretty --cex-arch=hts --tpdb=../../idlak-data/en/ga/slt - - |\
python output_hts_test_labs.py  &lt;INSTALL LOCATION&gt;/HTS-demo_CMU-ARCTIC-SLT/data/labels/gen alice
</pre><p>If you would like to generate different output replace alice.xml.</p>
<h1><a class="anchor" id="idlaktxp_htstraining"></a>
HTS training</h1>
<p>You are now ready to train models based on Kaldi output in HTS. TO do this you need to bypass the usual HTS demo stage of label generation and need to make the system as follows:</p>
<pre class="fragment">cd &lt;INSTALL LOCATION&gt;/HTS-demo_CMU-ARCTIC-SLT/data
make analysis
make mlf list scp
cd ..
make voice
</pre><p>Output from the Kaldi based HTS system will be generated into: </p><pre class="fragment">&lt;INSTALL LOCATION&gt;/gen/qst001/ver1/hts_engine
</pre><p>In order to run HTS-demo with paths set to the tools you have downloaded you will need to run make within the HTS-demo directory configured appropriately. The download script has added a file config.txt to this directory which has an example of the appropriate settings. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
