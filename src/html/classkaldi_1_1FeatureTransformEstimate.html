<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: FeatureTransformEstimate Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1FeatureTransformEstimate.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="classkaldi_1_1FeatureTransformEstimate-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">FeatureTransformEstimate Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class for computing a feature transform used for preconditioning of the training data in neural-networks.  
 <a href="classkaldi_1_1FeatureTransformEstimate.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="get-feature-transform_8h_source.html">get-feature-transform.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for FeatureTransformEstimate:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1FeatureTransformEstimate__inherit__graph.png" border="0" usemap="#FeatureTransformEstimate_inherit__map" alt="Inheritance graph"/></div>
<map name="FeatureTransformEstimate_inherit__map" id="FeatureTransformEstimate_inherit__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for FeatureTransformEstimate:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1FeatureTransformEstimate__coll__graph.png" border="0" usemap="#FeatureTransformEstimate_coll__map" alt="Collaboration graph"/></div>
<map name="FeatureTransformEstimate_coll__map" id="FeatureTransformEstimate_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7a01396325ab38f8c0748d0d336649dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1FeatureTransformEstimate.html#a7a01396325ab38f8c0748d0d336649dd">Estimate</a> (const <a class="el" href="structkaldi_1_1FeatureTransformEstimateOptions.html">FeatureTransformEstimateOptions</a> &amp;opts, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *M, <a class="el" href="classkaldi_1_1TpMatrix.html">TpMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *within_cholesky) const</td></tr>
<tr class="memdesc:a7a01396325ab38f8c0748d0d336649dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimates the LDA transform matrix m.  <a href="#a7a01396325ab38f8c0748d0d336649dd">More...</a><br /></td></tr>
<tr class="separator:a7a01396325ab38f8c0748d0d336649dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classkaldi_1_1LdaEstimate"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classkaldi_1_1LdaEstimate')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classkaldi_1_1LdaEstimate.html">LdaEstimate</a></td></tr>
<tr class="memitem:a779b896225b5de458e37a35e4d764592 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a779b896225b5de458e37a35e4d764592">LdaEstimate</a> ()</td></tr>
<tr class="separator:a779b896225b5de458e37a35e4d764592 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b46759f545d541fde9ce3e6f5de77ef inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a2b46759f545d541fde9ce3e6f5de77ef">Init</a> (int32 num_classes, int32 dimension)</td></tr>
<tr class="memdesc:a2b46759f545d541fde9ce3e6f5de77ef inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates memory for accumulators.  <a href="classkaldi_1_1LdaEstimate.html#a2b46759f545d541fde9ce3e6f5de77ef">More...</a><br /></td></tr>
<tr class="separator:a2b46759f545d541fde9ce3e6f5de77ef inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43c2a77cf28ffa0364ae8e41954e91fc inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a43c2a77cf28ffa0364ae8e41954e91fc">NumClasses</a> () const</td></tr>
<tr class="memdesc:a43c2a77cf28ffa0364ae8e41954e91fc inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of classes.  <a href="classkaldi_1_1LdaEstimate.html#a43c2a77cf28ffa0364ae8e41954e91fc">More...</a><br /></td></tr>
<tr class="separator:a43c2a77cf28ffa0364ae8e41954e91fc inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6db7dfbac0d670f69c3754ed195b3c61 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a6db7dfbac0d670f69c3754ed195b3c61">Dim</a> () const</td></tr>
<tr class="memdesc:a6db7dfbac0d670f69c3754ed195b3c61 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the dimensionality of the feature vectors.  <a href="classkaldi_1_1LdaEstimate.html#a6db7dfbac0d670f69c3754ed195b3c61">More...</a><br /></td></tr>
<tr class="separator:a6db7dfbac0d670f69c3754ed195b3c61 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d5b06ebdf31fe679a8820784f2c63c1 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a2d5b06ebdf31fe679a8820784f2c63c1">ZeroAccumulators</a> ()</td></tr>
<tr class="memdesc:a2d5b06ebdf31fe679a8820784f2c63c1 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets all accumulators to zero.  <a href="classkaldi_1_1LdaEstimate.html#a2d5b06ebdf31fe679a8820784f2c63c1">More...</a><br /></td></tr>
<tr class="separator:a2d5b06ebdf31fe679a8820784f2c63c1 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a703407e9ea7d851397097c91c0275a08 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a703407e9ea7d851397097c91c0275a08">Scale</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> f)</td></tr>
<tr class="memdesc:a703407e9ea7d851397097c91c0275a08 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scales all accumulators.  <a href="classkaldi_1_1LdaEstimate.html#a703407e9ea7d851397097c91c0275a08">More...</a><br /></td></tr>
<tr class="separator:a703407e9ea7d851397097c91c0275a08 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50b09047db384a44e91a9c9f9ff2a038 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a50b09047db384a44e91a9c9f9ff2a038">TotCount</a> ()</td></tr>
<tr class="memdesc:a50b09047db384a44e91a9c9f9ff2a038 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return total count of the data.  <a href="classkaldi_1_1LdaEstimate.html#a50b09047db384a44e91a9c9f9ff2a038">More...</a><br /></td></tr>
<tr class="separator:a50b09047db384a44e91a9c9f9ff2a038 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49e9dd3e36510b60a2523398dcb35628 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a49e9dd3e36510b60a2523398dcb35628">Accumulate</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;data, int32 class_id, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> weight=1.0)</td></tr>
<tr class="memdesc:a49e9dd3e36510b60a2523398dcb35628 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accumulates data.  <a href="classkaldi_1_1LdaEstimate.html#a49e9dd3e36510b60a2523398dcb35628">More...</a><br /></td></tr>
<tr class="separator:a49e9dd3e36510b60a2523398dcb35628 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32aed5e0db606c9dcef021be3248f8e6 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a32aed5e0db606c9dcef021be3248f8e6">Estimate</a> (const <a class="el" href="structkaldi_1_1LdaEstimateOptions.html">LdaEstimateOptions</a> &amp;opts, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *M, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *Mfull=NULL) const</td></tr>
<tr class="memdesc:a32aed5e0db606c9dcef021be3248f8e6 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimates the LDA transform matrix m.  <a href="classkaldi_1_1LdaEstimate.html#a32aed5e0db606c9dcef021be3248f8e6">More...</a><br /></td></tr>
<tr class="separator:a32aed5e0db606c9dcef021be3248f8e6 inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a766484031c247f04d917764ac543541e inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a766484031c247f04d917764ac543541e">Read</a> (std::istream &amp;in_stream, <a class="el" href="classbool.html">bool</a> binary, <a class="el" href="classbool.html">bool</a> add)</td></tr>
<tr class="separator:a766484031c247f04d917764ac543541e inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affa097bf4d31dd363669a7de66a970ac inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#affa097bf4d31dd363669a7de66a970ac">Write</a> (std::ostream &amp;out_stream, <a class="el" href="classbool.html">bool</a> binary) const</td></tr>
<tr class="separator:affa097bf4d31dd363669a7de66a970ac inherit pub_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:a3159a21881b3aeabf4e2266c890d2119"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1FeatureTransformEstimate.html#a3159a21881b3aeabf4e2266c890d2119">EstimateInternal</a> (const <a class="el" href="structkaldi_1_1FeatureTransformEstimateOptions.html">FeatureTransformEstimateOptions</a> &amp;opts, const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; &amp;total_covar, const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; &amp;between_covar, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;mean, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *M, <a class="el" href="classkaldi_1_1TpMatrix.html">TpMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *C)</td></tr>
<tr class="separator:a3159a21881b3aeabf4e2266c890d2119"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_static_methods_classkaldi_1_1LdaEstimate"><td colspan="2" onclick="javascript:toggleInherit('pro_static_methods_classkaldi_1_1LdaEstimate')"><img src="closed.png" alt="-"/>&#160;Static Protected Member Functions inherited from <a class="el" href="classkaldi_1_1LdaEstimate.html">LdaEstimate</a></td></tr>
<tr class="memitem:a44634aefb38c4b324f8944f11d4fd9be inherit pro_static_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a44634aefb38c4b324f8944f11d4fd9be">AddMeanOffset</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; double &gt; &amp;total_mean, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *projection)</td></tr>
<tr class="memdesc:a44634aefb38c4b324f8944f11d4fd9be inherit pro_static_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function modifies the LDA matrix so that it also subtracts the mean feature value.  <a href="classkaldi_1_1LdaEstimate.html#a44634aefb38c4b324f8944f11d4fd9be">More...</a><br /></td></tr>
<tr class="separator:a44634aefb38c4b324f8944f11d4fd9be inherit pro_static_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_methods_classkaldi_1_1LdaEstimate"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classkaldi_1_1LdaEstimate')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classkaldi_1_1LdaEstimate.html">LdaEstimate</a></td></tr>
<tr class="memitem:ab7d200ffefec40ce4ae4ca1c511e8b62 inherit pro_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#ab7d200ffefec40ce4ae4ca1c511e8b62">GetStats</a> (<a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; *total_covar, <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; *between_covar, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *total_mean, double *sum) const</td></tr>
<tr class="memdesc:ab7d200ffefec40ce4ae4ca1c511e8b62 inherit pro_methods_classkaldi_1_1LdaEstimate"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract a more processed form of the stats.  <a href="classkaldi_1_1LdaEstimate.html#ab7d200ffefec40ce4ae4ca1c511e8b62">More...</a><br /></td></tr>
<tr class="separator:ab7d200ffefec40ce4ae4ca1c511e8b62 inherit pro_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2895e939c49f74d8057917ef4232630 inherit pro_methods_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1LdaEstimate.html">LdaEstimate</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#ad2895e939c49f74d8057917ef4232630">operator=</a> (const <a class="el" href="classkaldi_1_1LdaEstimate.html">LdaEstimate</a> &amp;other)</td></tr>
<tr class="separator:ad2895e939c49f74d8057917ef4232630 inherit pro_methods_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_classkaldi_1_1LdaEstimate"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classkaldi_1_1LdaEstimate')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classkaldi_1_1LdaEstimate.html">LdaEstimate</a></td></tr>
<tr class="memitem:ae20716f837965046e02ab0b2bb595c7b inherit pro_attribs_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#ae20716f837965046e02ab0b2bb595c7b">zero_acc_</a></td></tr>
<tr class="separator:ae20716f837965046e02ab0b2bb595c7b inherit pro_attribs_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86a48ae42f55f2c9e4cf5147b49f873c inherit pro_attribs_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a86a48ae42f55f2c9e4cf5147b49f873c">first_acc_</a></td></tr>
<tr class="separator:a86a48ae42f55f2c9e4cf5147b49f873c inherit pro_attribs_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ef7b189a6e1b145dc18399feb5e7764 inherit pro_attribs_classkaldi_1_1LdaEstimate"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1LdaEstimate.html#a9ef7b189a6e1b145dc18399feb5e7764">total_second_acc_</a></td></tr>
<tr class="separator:a9ef7b189a6e1b145dc18399feb5e7764 inherit pro_attribs_classkaldi_1_1LdaEstimate"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class for computing a feature transform used for preconditioning of the training data in neural-networks. </p>
<p>By preconditioning here, all we really mean is an affine transform of the input data&ndash; say if we set up the classification as going from vectors x_i to labels y_i, then this would be a linear transform on X, so we replace x_i with x'_i = A x_i + b. The statistics we use to obtain this transform are the within-class and between class variance statistics, and the global data mean, that we would use to estimate LDA. When designing this, we had a few principles in mind:</p><ul>
<li>We want to remove the global mean of the input features (this is well established, I think there is a paper by LeCun explaining why this is a good thing).</li>
<li>We would like the transform to make the training process roughly invariant to linear transformations of the input features, meaning that whatever linear transformation you apply prior to this transform, it should 'undo' it.</li>
<li>We want directions in which there is a lot of between-class variance to be given a higher variance than directions that have mostly within-class variance&ndash; it has been our experience that these 'nuisance directions' will interfere with the training if they are given too large a scaling. It is essential to our method that the number of classes is higher than the dimension of the input feature space, which is normal for speech recognition tasks (~5000 &gt; ~250).</li>
</ul>
<p>Basically our method is as follows:</p>
<ul>
<li>First subtract the mean.</li>
<li>Get the within-class and between-class stats, as for LDA.</li>
<li>Normalize the space as for LDA, so that the within-class covariance matrix is unit and the between-class covariance matrix is diagonalized</li>
<li>At this stage, if the user asked for dimension reduction then reduce the dimension by taking out dimensions with least between-class variance [note: the current scripts do not do this by default]</li>
<li>Apply a transform that reduces the variance of dimensions with low between-class variance, as we'll describe below.</li>
<li>Finally, do an SVD of the resulting transform, A = U S V^T, apply a maximum to the diagonal elements of the matrix S (e.g. 5.0), and reconstruct A' = U S' V^T; this is the final transform. The point of this stage is to stop the transform from 'blowing up' any dimensions of the space excessively; this stage was introduced in response to a problem we encountered at one point, and I think normally not very many dimensions of S end up getting floored.</li>
</ul>
<p>We need to explain the step that applies the dimension-specific scaling, which we described above as, "Apply a transform that reduces the variance
 of dimensions with low between-class variance". For a particular dimension, let the between-class diagonal covariance element be , and the within-class diagonal covariance is 1 at this point (since we have normalized the within-class covariance to unity); hence, the total variance is  + 1. Below, "within-class-factor" is a constant that we set by default to 0.001. We scale the i'th dimension of the features by:</p>
<p><img class="formulaInl" alt="$ sqrt( (within-class-factor + \lambda_i) / (1 + \lambda_i) ) $" src="form_114.png"/></p>
<p>If  &gt;&gt; 1, this scaling factor approaches 1 (we don't need to scale up dimensions with high between-class variance as they already naturally have a higher variance than other dimensions. As  becomes small, this scaling factor approaches sqrt(within-class-factor), so dimensions with very small between-class variance get assigned a small variance equal to within-class-factor, and for dimensions with intermediate between-class variance, they end up with a variance roughly equal to : consider that the variance was originally (1 + ), so by scaling the features by approximately sqrt(() / (1 + )), the variance becomes approximately  [this is clear after noting that the variance gets scaled by the square of the feature scale]. </p>

<p class="definition">Definition at line <a class="el" href="get-feature-transform_8h_source.html#l00133">133</a> of file <a class="el" href="get-feature-transform_8h_source.html">get-feature-transform.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a7a01396325ab38f8c0748d0d336649dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a01396325ab38f8c0748d0d336649dd">&#9670;&nbsp;</a></span>Estimate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Estimate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1FeatureTransformEstimateOptions.html">FeatureTransformEstimateOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>M</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1TpMatrix.html">TpMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>within_cholesky</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimates the LDA transform matrix m. </p>
<p>If Mfull != NULL, it also outputs the full matrix (without dimensionality reduction), which is useful for some purposes. If opts.remove_offset == true, it will output both matrices with an extra column which corresponds to mean-offset removal (the matrix should be multiplied by the feature with a 1 appended to give the correct result, as with other Kaldi transforms.) "within_cholesky" is a pointer to an <a class="el" href="classkaldi_1_1SpMatrix.html" title="Packed symetric matrix class. ">SpMatrix</a> that, if non-NULL, will be set to the Cholesky factor of the within-class covariance matrix. This is used for perturbing features. </p>

<p class="definition">Definition at line <a class="el" href="get-feature-transform_8cc_source.html#l00028">28</a> of file <a class="el" href="get-feature-transform_8cc_source.html">get-feature-transform.cc</a>.</p>

<p class="reference">References <a class="el" href="arpa-file-parser-test_8cc_source.html#l00066">count</a>, <a class="el" href="get-feature-transform_8cc_source.html#l00040">FeatureTransformEstimate::EstimateInternal()</a>, <a class="el" href="lda-estimate_8cc_source.html#l00057">LdaEstimate::GetStats()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-get-feature-transform_8cc_source.html#l00025">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                                                      { </div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  Vector&lt;double&gt; total_mean;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  SpMatrix&lt;double&gt; total_covar, between_covar;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="classkaldi_1_1LdaEstimate.html#ab7d200ffefec40ce4ae4ca1c511e8b62">GetStats</a>(&amp;total_covar, &amp;between_covar, &amp;total_mean, &amp;count);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Data count is &quot;</span> &lt;&lt; <a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a>;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="classkaldi_1_1FeatureTransformEstimate.html#a3159a21881b3aeabf4e2266c890d2119">EstimateInternal</a>(opts, total_covar, between_covar, total_mean, M, C);</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div><div class="ttc" id="arpa-file-parser-test_8cc_html_a951345011b75d2e8d9bfc18ca63510d2"><div class="ttname"><a href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a></div><div class="ttdeci">const size_t count</div><div class="ttdef"><b>Definition:</b> <a href="arpa-file-parser-test_8cc_source.html#l00066">arpa-file-parser-test.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1LdaEstimate_html_ab7d200ffefec40ce4ae4ca1c511e8b62"><div class="ttname"><a href="classkaldi_1_1LdaEstimate.html#ab7d200ffefec40ce4ae4ca1c511e8b62">kaldi::LdaEstimate::GetStats</a></div><div class="ttdeci">void GetStats(SpMatrix&lt; double &gt; *total_covar, SpMatrix&lt; double &gt; *between_covar, Vector&lt; double &gt; *total_mean, double *sum) const</div><div class="ttdoc">Extract a more processed form of the stats. </div><div class="ttdef"><b>Definition:</b> <a href="lda-estimate_8cc_source.html#l00057">lda-estimate.cc:57</a></div></div>
<div class="ttc" id="classkaldi_1_1FeatureTransformEstimate_html_a3159a21881b3aeabf4e2266c890d2119"><div class="ttname"><a href="classkaldi_1_1FeatureTransformEstimate.html#a3159a21881b3aeabf4e2266c890d2119">kaldi::FeatureTransformEstimate::EstimateInternal</a></div><div class="ttdeci">static void EstimateInternal(const FeatureTransformEstimateOptions &amp;opts, const SpMatrix&lt; double &gt; &amp;total_covar, const SpMatrix&lt; double &gt; &amp;between_covar, const Vector&lt; double &gt; &amp;mean, Matrix&lt; BaseFloat &gt; *M, TpMatrix&lt; BaseFloat &gt; *C)</div><div class="ttdef"><b>Definition:</b> <a href="get-feature-transform_8cc_source.html#l00040">get-feature-transform.cc:40</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3159a21881b3aeabf4e2266c890d2119"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3159a21881b3aeabf4e2266c890d2119">&#9670;&nbsp;</a></span>EstimateInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void EstimateInternal </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1FeatureTransformEstimateOptions.html">FeatureTransformEstimateOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>total_covar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>between_covar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>mean</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>M</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1TpMatrix.html">TpMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>C</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="get-feature-transform_8cc_source.html#l00040">40</a> of file <a class="el" href="get-feature-transform_8cc_source.html">get-feature-transform.cc</a>.</p>

<p class="reference">References <a class="el" href="sp-matrix_8cc_source.html#l00982">SpMatrix&lt; Real &gt;::AddMat2Sp()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00170">MatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="lda-estimate_8cc_source.html#l00166">LdaEstimate::AddMeanOffset()</a>, <a class="el" href="sp-matrix_8h_source.html#l00211">SpMatrix&lt; Real &gt;::AddSp()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00835">VectorBase&lt; Real &gt;::ApplyCeiling()</a>, <a class="el" href="tp-matrix_8cc_source.html#l00088">TpMatrix&lt; Real &gt;::Cholesky()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00861">MatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="tp-matrix_8h_source.html#l00104">TpMatrix&lt; Real &gt;::CopyFromTp()</a>, <a class="el" href="get-feature-transform_8h_source.html#l00041">FeatureTransformEstimateOptions::dim</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00037">MatrixBase&lt; Real &gt;::Invert()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00579">VectorBase&lt; Real &gt;::Max()</a>, <a class="el" href="get-feature-transform_8h_source.html#l00043">FeatureTransformEstimateOptions::max_singular_value</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01223">MatrixBase&lt; Real &gt;::MulRowsVec()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="packed-matrix_8h_source.html#l00104">PackedMatrix&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00199">MatrixBase&lt; Real &gt;::Range()</a>, <a class="el" href="get-feature-transform_8h_source.html#l00040">FeatureTransformEstimateOptions::remove_offset</a>, <a class="el" href="tp-matrix_8h_source.html#l00124">TpMatrix&lt; Real &gt;::Resize()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02534">kaldi::SortSvd()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01824">MatrixBase&lt; Real &gt;::Svd()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00171">SpMatrix&lt; Real &gt;::Trace()</a>, and <a class="el" href="get-feature-transform_8h_source.html#l00042">FeatureTransformEstimateOptions::within_class_factor</a>.</p>

<p class="reference">Referenced by <a class="el" href="get-feature-transform_8cc_source.html#l00028">FeatureTransformEstimate::Estimate()</a>, and <a class="el" href="get-feature-transform_8cc_source.html#l00130">FeatureTransformEstimateMulti::EstimateTransformPart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                            {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  </div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  int32 target_dim = opts.dim, dim = total_covar.<a class="code" href="classkaldi_1_1PackedMatrix.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>();</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// Interpret zero or negative target_dim as the full dim</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (target_dim &lt;= 0)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    target_dim = dim;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// between-class covar is of most rank C-1</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(target_dim &lt;= dim);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// within-class covariance</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  SpMatrix&lt;double&gt; wc_covar(total_covar);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  wc_covar.AddSp(-1.0, between_covar);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  TpMatrix&lt;double&gt; wc_covar_sqrt(dim);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    wc_covar_sqrt.Cholesky(wc_covar);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span> (C != NULL) {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      C-&gt;Resize(dim);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      C-&gt;CopyFromTp(wc_covar_sqrt);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> smooth = 1.0e-03 * wc_covar.Trace() / wc_covar.NumRows();</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Cholesky failed (possibly not +ve definite), so adding &quot;</span> &lt;&lt; smooth</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; to diagonal and trying again.\n&quot;</span>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; wc_covar.NumRows(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      wc_covar(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) += smooth;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    wc_covar_sqrt.Cholesky(wc_covar);    </div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  Matrix&lt;double&gt; wc_covar_sqrt_mat(wc_covar_sqrt);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  wc_covar_sqrt_mat.Invert();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  SpMatrix&lt;double&gt; tmp_sp(dim);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  tmp_sp.AddMat2Sp(1.0, wc_covar_sqrt_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, between_covar, 0.0);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  Matrix&lt;double&gt; tmp_mat(tmp_sp);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  Matrix&lt;double&gt; svd_u(dim, dim), svd_vt(dim, dim);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  Vector&lt;double&gt; svd_d(dim);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  tmp_mat.Svd(&amp;svd_d, &amp;svd_u, &amp;svd_vt);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">SortSvd</a>(&amp;svd_d, &amp;svd_u);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;LDA singular values are &quot;</span> &lt;&lt; svd_d;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Sum of all singular values is &quot;</span> &lt;&lt; svd_d.Sum();</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Sum of selected singular values is &quot;</span> &lt;&lt;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      SubVector&lt;double&gt;(svd_d, 0, target_dim).Sum();</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  </div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  Matrix&lt;double&gt; lda_mat(dim, dim);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  lda_mat.AddMatMat(1.0, svd_u, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, wc_covar_sqrt_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// finally, copy first target_dim rows to m</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  M-&gt;<a class="code" href="classkaldi_1_1Matrix.html#a70c095b28633f8874632a9d239a903d5">Resize</a>(target_dim, dim);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  M-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a557fe407783c0d8f2e604666fd48f96d">CopyFromMat</a>(lda_mat.Range(0, target_dim, 0, dim));</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  </div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">if</span> (opts.within_class_factor != 1.0) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; svd_d.Dim(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> old_var = 1.0 + svd_d(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>), <span class="comment">// the total variance of that dim..</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;          new_var = opts.within_class_factor + svd_d(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>), <span class="comment">// the variance we want..</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;          scale = sqrt(new_var / old_var);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">if</span> (i &lt; M-&gt;NumRows())</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        M-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>).Scale(scale);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">if</span> (opts.max_singular_value &gt; 0.0) {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    int32 rows = M-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(), cols = M-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>(),</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        min_dim = std::min(rows, cols);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    Matrix&lt;BaseFloat&gt; U(rows, min_dim), Vt(min_dim, cols);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    Vector&lt;BaseFloat&gt; s(min_dim);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    M-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a51d259f9f12fa93ff259428b1d7e201e">Svd</a>(&amp;s, &amp;U, &amp;Vt); <span class="comment">// decompose m = U diag(s) Vt.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_s = s.Max();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    s.ApplyCeiling(opts.max_singular_value, &amp;n);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span> (n &gt; 0) {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Applied ceiling to &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; out of &quot;</span> &lt;&lt; s.Dim()</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; singular values of transform using ceiling &quot;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                &lt;&lt; opts.max_singular_value &lt;&lt; <span class="stringliteral">&quot;, max is &quot;</span> &lt;&lt; max_s;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      Vt.MulRowsVec(s);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="comment">// reconstruct m with the modified singular values:</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      M-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a2b021269071bd3a943e4cec397aca2d1">AddMatMat</a>(1.0, U, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Vt, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">if</span> (opts.remove_offset)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="classkaldi_1_1LdaEstimate.html#a44634aefb38c4b324f8944f11d4fd9be">AddMeanOffset</a>(total_mean, M);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a557fe407783c0d8f2e604666fd48f96d"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a557fe407783c0d8f2e604666fd48f96d">kaldi::MatrixBase::CopyFromMat</a></div><div class="ttdeci">void CopyFromMat(const MatrixBase&lt; OtherReal &gt; &amp;M, MatrixTransposeType trans=kNoTrans)</div><div class="ttdoc">Copy given matrix. (no resize is done). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l00861">kaldi-matrix.cc:861</a></div></div>
<div class="ttc" id="classkaldi_1_1PackedMatrix_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1PackedMatrix.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::PackedMatrix::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdef"><b>Definition:</b> <a href="packed-matrix_8h_source.html#l00104">packed-matrix.h:104</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="classkaldi_1_1LdaEstimate_html_a44634aefb38c4b324f8944f11d4fd9be"><div class="ttname"><a href="classkaldi_1_1LdaEstimate.html#a44634aefb38c4b324f8944f11d4fd9be">kaldi::LdaEstimate::AddMeanOffset</a></div><div class="ttdeci">static void AddMeanOffset(const VectorBase&lt; double &gt; &amp;total_mean, Matrix&lt; BaseFloat &gt; *projection)</div><div class="ttdoc">This function modifies the LDA matrix so that it also subtracts the mean feature value. </div><div class="ttdef"><b>Definition:</b> <a href="lda-estimate_8cc_source.html#l00166">lda-estimate.cc:166</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a2b021269071bd3a943e4cec397aca2d1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a2b021269071bd3a943e4cec397aca2d1">kaldi::MatrixBase::AddMatMat</a></div><div class="ttdeci">void AddMatMat(const Real alpha, const MatrixBase&lt; Real &gt; &amp;A, MatrixTransposeType transA, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType transB, const Real beta)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l00170">kaldi-matrix.cc:170</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html_a70c095b28633f8874632a9d239a903d5"><div class="ttname"><a href="classkaldi_1_1Matrix.html#a70c095b28633f8874632a9d239a903d5">kaldi::Matrix::Resize</a></div><div class="ttdeci">void Resize(const MatrixIndexT r, const MatrixIndexT c, MatrixResizeType resize_type=kSetZero, MatrixStrideType stride_type=kDefaultStride)</div><div class="ttdoc">Sets matrix to a specified size (zero is OK as long as both r and c are zero). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l00818">kaldi-matrix.cc:818</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a51d259f9f12fa93ff259428b1d7e201e"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a51d259f9f12fa93ff259428b1d7e201e">kaldi::MatrixBase::Svd</a></div><div class="ttdeci">void Svd(VectorBase&lt; Real &gt; *s, MatrixBase&lt; Real &gt; *U, MatrixBase&lt; Real &gt; *Vt) const</div><div class="ttdoc">Compute SVD (*this) = U diag(s) Vt. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l01824">kaldi-matrix.cc:1824</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_ga4318e745ace6367bd00b2911089e9e79"><div class="ttname"><a href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">kaldi::SortSvd</a></div><div class="ttdeci">void SortSvd(VectorBase&lt; Real &gt; *s, MatrixBase&lt; Real &gt; *U, MatrixBase&lt; Real &gt; *Vt, bool sort_on_absolute_value)</div><div class="ttdoc">Function to ensure that SVD is sorted. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02534">kaldi-matrix.cc:2534</a></div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>nnet2/<a class="el" href="get-feature-transform_8h_source.html">get-feature-transform.h</a></li>
<li>nnet2/<a class="el" href="get-feature-transform_8cc_source.html">get-feature-transform.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="classkaldi_1_1FeatureTransformEstimate.html">FeatureTransformEstimate</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
