<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Classes and functions for creating FSTs from HMMs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__hmm__group__graph.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Classes and functions for creating FSTs from HMMs<div class="ingroups"><a class="el" href="group__hmm__group.html">Classes and functions related to HMM topology and transition modeling</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Classes and functions for creating FSTs from HMMs:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__hmm__group__graph.png" border="0" alt="" usemap="#group____hmm____group____graph"/>
<map name="group____hmm____group____graph" id="group____hmm____group____graph">
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration class for the <a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9" title="Returns the H tranducer; result owned by caller. ">GetHTransducer()</a> function; see <a class="el" href="hmm.html#hmm_graph_config">The HTransducerConfig configuration class</a> for context.  <a href="structkaldi_1_1HTransducerConfig.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1HmmCacheHash.html">HmmCacheHash</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gaf603f501ad03cb3632179ef5aa36b73e"><td class="memItemLeft" align="right" valign="top">typedef unordered_map&lt; std::pair&lt; int32, std::vector&lt; int32 &gt; &gt;, fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *, <a class="el" href="structkaldi_1_1HmmCacheHash.html">HmmCacheHash</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">HmmCacheType</a></td></tr>
<tr class="memdesc:gaf603f501ad03cb3632179ef5aa36b73e"><td class="mdescLeft">&#160;</td><td class="mdescRight">HmmCacheType is a map from (central-phone, sequence of pdf-ids) to FST, used as cache in GetHmmAsFsa, as an optimization.  <a href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">More...</a><br /></td></tr>
<tr class="separator:gaf603f501ad03cb3632179ef5aa36b73e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafd9f81f104ed8326628db93c0dc17d37"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gafd9f81f104ed8326628db93c0dc17d37">GetHmmAsFsa</a> (std::vector&lt; int32 &gt; context_window, const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;ctx_dep, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, const <a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a> &amp;config, <a class="el" href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">HmmCacheType</a> *cache=NULL)</td></tr>
<tr class="memdesc:gafd9f81f104ed8326628db93c0dc17d37"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by <a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9" title="Returns the H tranducer; result owned by caller. ">GetHTransducer()</a> and probably will not need to be called directly; it creates and returns the FST corresponding to the phone.  <a href="group__hmm__group__graph.html#gafd9f81f104ed8326628db93c0dc17d37">More...</a><br /></td></tr>
<tr class="separator:gafd9f81f104ed8326628db93c0dc17d37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad4f0020c7b8d948bae982264abdc8f17"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gad4f0020c7b8d948bae982264abdc8f17">GetHmmAsFsaSimple</a> (std::vector&lt; int32 &gt; context_window, const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;ctx_dep, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> prob_scale)</td></tr>
<tr class="memdesc:gad4f0020c7b8d948bae982264abdc8f17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Included mainly as a form of documentation, not used in any other code currently.  <a href="group__hmm__group__graph.html#gad4f0020c7b8d948bae982264abdc8f17">More...</a><br /></td></tr>
<tr class="separator:gad4f0020c7b8d948bae982264abdc8f17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gade0dda4e298562cc32dee6962e0ff0c9"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9">GetHTransducer</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;ilabel_info, const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;ctx_dep, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, const <a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a> &amp;config, std::vector&lt; int32 &gt; *disambig_syms_left)</td></tr>
<tr class="memdesc:gade0dda4e298562cc32dee6962e0ff0c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the H tranducer; result owned by caller.  <a href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9">More...</a><br /></td></tr>
<tr class="separator:gade0dda4e298562cc32dee6962e0ff0c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga204bf084239aa1ea304b5b7b987aa098"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga204bf084239aa1ea304b5b7b987aa098">GetIlabelMapping</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;ilabel_info_old, const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;ctx_dep, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, std::vector&lt; int32 &gt; *old2new_map)</td></tr>
<tr class="memdesc:ga204bf084239aa1ea304b5b7b987aa098"><td class="mdescLeft">&#160;</td><td class="mdescRight">GetIlabelMapping produces a mapping that's similar to HTK's logical-to-physical model mapping (i.e.  <a href="group__hmm__group__graph.html#ga204bf084239aa1ea304b5b7b987aa098">More...</a><br /></td></tr>
<tr class="separator:ga204bf084239aa1ea304b5b7b987aa098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga859d84c809f51c078075500cdca5a0df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga859d84c809f51c078075500cdca5a0df">AddSelfLoops</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> self_loop_scale, <a class="el" href="classbool.html">bool</a> reorder, <a class="el" href="classbool.html">bool</a> check_no_self_loops, fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *fst)</td></tr>
<tr class="memdesc:ga859d84c809f51c078075500cdca5a0df"><td class="mdescLeft">&#160;</td><td class="mdescRight">For context, see <a class="el" href="hmm.html#hmm_graph_add_self_loops">AddSelfLoops()</a>.  <a href="group__hmm__group__graph.html#ga859d84c809f51c078075500cdca5a0df">More...</a><br /></td></tr>
<tr class="separator:ga859d84c809f51c078075500cdca5a0df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga67218f63ca04115462e0af7143e12ddb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga67218f63ca04115462e0af7143e12ddb">AddTransitionProbs</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> transition_scale, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> self_loop_scale, fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *fst)</td></tr>
<tr class="memdesc:ga67218f63ca04115462e0af7143e12ddb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds transition-probs, with the supplied scales (see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>), to the graph.  <a href="group__hmm__group__graph.html#ga67218f63ca04115462e0af7143e12ddb">More...</a><br /></td></tr>
<tr class="separator:ga67218f63ca04115462e0af7143e12ddb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga23ca8403b997d73fdd0f72c51b1b9a87"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga23ca8403b997d73fdd0f72c51b1b9a87">AddTransitionProbs</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> transition_scale, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> self_loop_scale, <a class="el" href="namespacekaldi.html#a4c9e4132556649881ca6f29dd13e2742">Lattice</a> *lat)</td></tr>
<tr class="memdesc:ga23ca8403b997d73fdd0f72c51b1b9a87"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is as <a class="el" href="group__hmm__group__graph.html#ga859d84c809f51c078075500cdca5a0df" title="For context, see AddSelfLoops(). ">AddSelfLoops()</a>, but operates on a Lattice, where it affects the graph part of the weight (the first element of the pair).  <a href="group__hmm__group__graph.html#ga23ca8403b997d73fdd0f72c51b1b9a87">More...</a><br /></td></tr>
<tr class="separator:ga23ca8403b997d73fdd0f72c51b1b9a87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae04ff751dd230f18c7091b28bac598a1"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gae04ff751dd230f18c7091b28bac598a1">GetPdfToTransitionIdTransducer</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model)</td></tr>
<tr class="memdesc:gae04ff751dd230f18c7091b28bac598a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a transducer from pdfs plus one (input) to transition-ids (output).  <a href="group__hmm__group__graph.html#gae04ff751dd230f18c7091b28bac598a1">More...</a><br /></td></tr>
<tr class="separator:gae04ff751dd230f18c7091b28bac598a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa89b6ecebeea9ee1c62dd63382b40950"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gaa89b6ecebeea9ee1c62dd63382b40950">ConvertTransitionIdsToPdfs</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *fst)</td></tr>
<tr class="memdesc:gaa89b6ecebeea9ee1c62dd63382b40950"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts all transition-ids in the FST to pdfs plus one.  <a href="group__hmm__group__graph.html#gaa89b6ecebeea9ee1c62dd63382b40950">More...</a><br /></td></tr>
<tr class="separator:gaa89b6ecebeea9ee1c62dd63382b40950"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="gaf603f501ad03cb3632179ef5aa36b73e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf603f501ad03cb3632179ef5aa36b73e">&#9670;&nbsp;</a></span>HmmCacheType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unordered_map&lt;std::pair&lt;int32, std::vector&lt;int32&gt; &gt;, fst::VectorFst&lt;<a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a>&gt;*, <a class="el" href="structkaldi_1_1HmmCacheHash.html">HmmCacheHash</a>&gt; <a class="el" href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">HmmCacheType</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>HmmCacheType is a map from (central-phone, sequence of pdf-ids) to FST, used as cache in GetHmmAsFsa, as an optimization. </p>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8h_source.html#l00070">70</a> of file <a class="el" href="hmm-utils_8h_source.html">hmm-utils.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga859d84c809f51c078075500cdca5a0df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga859d84c809f51c078075500cdca5a0df">&#9670;&nbsp;</a></span>AddSelfLoops()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddSelfLoops </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>disambig_syms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>self_loop_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>reorder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>check_no_self_loops</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td>
          <td class="paramname"><em>fst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For context, see <a class="el" href="hmm.html#hmm_graph_add_self_loops">AddSelfLoops()</a>. </p>
<p>Expands an FST that has been built without self-loops, and adds the self-loops (it also needs to modify the probability of the non-self-loop ones, as the graph without self-loops was created in such a way that it was stochastic). Note that the disambig_syms will be empty in some recipes (e.g. if you already removed the disambiguation symbols). This function will treat numbers over 10000000 (kNontermBigNumber) the same as disambiguation symbols, assuming they are special symbols for grammar decoding.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trans_model</td><td>[in] Transition model </td></tr>
    <tr><td class="paramname">disambig_syms</td><td>[in] Sorted, uniq list of disambiguation symbols, required if the graph contains disambiguation symbols but only needed for sanity checks. </td></tr>
    <tr><td class="paramname">self_loop_scale</td><td>[in] Transition-probability scale for self-loops; c.f. <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a> </td></tr>
    <tr><td class="paramname">reorder</td><td>[in] If true, reorders the transitions (see <a class="el" href="hmm.html#hmm_reorder">Reordering transitions</a>). You'll normally want this to be true. </td></tr>
    <tr><td class="paramname">check_no_self_loops</td><td>[in] If true, it will check that there are no self-loops in the original graph; you'll normally want this to be true. If false, it will allow them, and will add self-loops after the original self-loop transitions, assuming reorder==true... this happens to be what we want when converting normal to unconstrained chain examples. WARNING: this was added in 2018; if you get a compilation error, add this as 'true', which emulates the behavior of older code. </td></tr>
    <tr><td class="paramname">fst</td><td>[in, out] The FST to be modified. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00602">602</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="hmm-utils_8cc_source.html#l00555">kaldi::AddSelfLoopsNoReorder()</a>, <a class="el" href="hmm-utils_8cc_source.html#l00472">kaldi::AddSelfLoopsReorder()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="training-graph-compiler_8cc_source.html#l00073">TrainingGraphCompiler::CompileGraph()</a>, <a class="el" href="training-graph-compiler_8cc_source.html#l00161">TrainingGraphCompiler::CompileGraphs()</a>, <a class="el" href="arpa-lm-compiler-test_8cc_source.html#l00119">kaldi::CoverageTest()</a>, <a class="el" href="add-self-loops_8cc_source.html#l00032">main()</a>, and <a class="el" href="arpa-lm-compiler-test_8cc_source.html#l00156">kaldi::ScoringTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                                {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacefst.html">fst</a>-&gt;Start() != fst::kNoStateId);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">if</span> (reorder)</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <a class="code" href="namespacekaldi.html#a128629df051ad5fe279dbcd25a7eab7e">AddSelfLoopsReorder</a>(trans_model, disambig_syms, self_loop_scale,</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                        check_no_self_loops, <a class="code" href="namespacefst.html">fst</a>);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="namespacekaldi.html#aa8d2d0add9f3320cde9e498336f86702">AddSelfLoopsNoReorder</a>(trans_model, disambig_syms, self_loop_scale,</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                          check_no_self_loops, <a class="code" href="namespacefst.html">fst</a>);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div><div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdoc">For an extended explanation of the framework of which grammar-fsts are a part, please see Support for...</div><div class="ttdef"><b>Definition:</b> <a href="graph_8dox_source.html#l00021">graph.dox:21</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa8d2d0add9f3320cde9e498336f86702"><div class="ttname"><a href="namespacekaldi.html#aa8d2d0add9f3320cde9e498336f86702">kaldi::AddSelfLoopsNoReorder</a></div><div class="ttdeci">static void AddSelfLoopsNoReorder(const TransitionModel &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, BaseFloat self_loop_scale, bool check_no_self_loops, fst::VectorFst&lt; fst::StdArc &gt; *fst)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00555">hmm-utils.cc:555</a></div></div>
<div class="ttc" id="namespacekaldi_html_a128629df051ad5fe279dbcd25a7eab7e"><div class="ttname"><a href="namespacekaldi.html#a128629df051ad5fe279dbcd25a7eab7e">kaldi::AddSelfLoopsReorder</a></div><div class="ttdeci">static void AddSelfLoopsReorder(const TransitionModel &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, BaseFloat self_loop_scale, bool check_no_self_loops, fst::VectorFst&lt; fst::StdArc &gt; *fst)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00472">hmm-utils.cc:472</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga67218f63ca04115462e0af7143e12ddb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga67218f63ca04115462e0af7143e12ddb">&#9670;&nbsp;</a></span>AddTransitionProbs() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddTransitionProbs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>disambig_syms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>transition_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>self_loop_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td>
          <td class="paramname"><em>fst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds transition-probs, with the supplied scales (see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>), to the graph. </p>
<p>Useful if you want to create a graph without transition probs, then possibly train the model (including the transition probs) but keep the graph fixed, and add back in the transition probs. It assumes the fst has transition-ids on it. It is not an error if the FST has no states (nothing will be done). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trans_model</td><td>[in] The transition model </td></tr>
    <tr><td class="paramname">disambig_syms</td><td>[in] A list of disambiguation symbols, required if the graph has disambiguation symbols on its input but only used for checks. </td></tr>
    <tr><td class="paramname">transition_scale</td><td>[in] A scale on transition-probabilities apart from those involving self-loops; see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>. </td></tr>
    <tr><td class="paramname">self_loop_scale</td><td>[in] A scale on self-loop transition probabilities; see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>. </td></tr>
    <tr><td class="paramname">fst</td><td>[in, out] The FST to be modified. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l01088">1088</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="hmm-utils_8cc_source.html#l01065">kaldi::GetScaledTransitionLogProb()</a>, <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="transition-model_8h_source.html#l00170">TransitionModel::NumTransitionIds()</a>, and <a class="el" href="lattice-weight_8h_source.html#l00363">fst::Times()</a>.</p>

<p class="reference">Referenced by <a class="el" href="align-compiled-mapped_8cc_source.html#l00031">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                                                      {</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(disambig_syms));</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="keywordtype">int</span> num_tids = trans_model.NumTransitionIds();</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="keywordflow">for</span> (StateIterator&lt;VectorFst&lt;StdArc&gt; &gt; siter(*<a class="code" href="namespacefst.html">fst</a>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      !siter.Done();</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      siter.Next()) {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">for</span> (MutableArcIterator&lt;VectorFst&lt;StdArc&gt; &gt; aiter(<a class="code" href="namespacefst.html">fst</a>, siter.Value());</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;         !aiter.Done();</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;         aiter.Next()) {</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> arc = aiter.Value();</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">StdArc::Label</a> l = arc.ilabel;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">if</span> (l &gt;= 1 &amp;&amp; l &lt;= num_tids) {  <span class="comment">// a transition-id.</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scaled_log_prob = <a class="code" href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">GetScaledTransitionLogProb</a>(trans_model,</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                                                               l,</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                                                               transition_scale,</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                                                               self_loop_scale);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        arc.weight = <a class="code" href="namespacefst.html#a0807071c6ceb397bc35281fce74ff8a7">Times</a>(arc.weight, TropicalWeight(-scaled_log_prob));</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l != 0) {</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordflow">if</span> (!std::binary_search(disambig_syms.begin(), disambig_syms.end(),</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                               arc.ilabel))</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;AddTransitionProbs: invalid symbol &quot;</span> &lt;&lt; arc.ilabel</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; on graph input side.&quot;</span>;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      }</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      aiter.SetValue(arc);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;}</div><div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdoc">For an extended explanation of the framework of which grammar-fsts are a part, please see Support for...</div><div class="ttdef"><b>Definition:</b> <a href="graph_8dox_source.html#l00021">graph.dox:21</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="namespacefst_html_a0807071c6ceb397bc35281fce74ff8a7"><div class="ttname"><a href="namespacefst.html#a0807071c6ceb397bc35281fce74ff8a7">fst::Times</a></div><div class="ttdeci">LatticeWeightTpl&lt; FloatType &gt; Times(const LatticeWeightTpl&lt; FloatType &gt; &amp;w1, const LatticeWeightTpl&lt; FloatType &gt; &amp;w2)</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight_8h_source.html#l00363">lattice-weight.h:363</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa9e82a3b0e8f208e37fd97ddc69efbc6"><div class="ttname"><a href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">kaldi::GetScaledTransitionLogProb</a></div><div class="ttdeci">static BaseFloat GetScaledTransitionLogProb(const TransitionModel &amp;trans_model, int32 trans_id, BaseFloat transition_scale, BaseFloat self_loop_scale)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l01065">hmm-utils.cc:1065</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga23ca8403b997d73fdd0f72c51b1b9a87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga23ca8403b997d73fdd0f72c51b1b9a87">&#9670;&nbsp;</a></span>AddTransitionProbs() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddTransitionProbs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>transition_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>self_loop_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#a4c9e4132556649881ca6f29dd13e2742">Lattice</a> *&#160;</td>
          <td class="paramname"><em>lat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is as <a class="el" href="group__hmm__group__graph.html#ga859d84c809f51c078075500cdca5a0df" title="For context, see AddSelfLoops(). ">AddSelfLoops()</a>, but operates on a Lattice, where it affects the graph part of the weight (the first element of the pair). </p>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l01121">1121</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="hmm-utils_8cc_source.html#l01065">kaldi::GetScaledTransitionLogProb()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="transition-model_8h_source.html#l00170">TransitionModel::NumTransitionIds()</a>.</p>
<div class="fragment"><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                                      {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordtype">int</span> num_tids = trans_model.NumTransitionIds();</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="keywordflow">for</span> (fst::StateIterator&lt;Lattice&gt; siter(*lat);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;       !siter.Done();</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;       siter.Next()) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keywordflow">for</span> (MutableArcIterator&lt;Lattice&gt; aiter(lat, siter.Value());</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;         !aiter.Done();</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;         aiter.Next()) {</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      <a class="code" href="namespacekaldi.html#a417e37822095c5adb9680fa07dffea8d">LatticeArc</a> arc = aiter.Value();</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">LatticeArc::Label</a> l = arc.ilabel;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keywordflow">if</span> (l &gt;= 1 &amp;&amp; l &lt;= num_tids) {  <span class="comment">// a transition-id.</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scaled_log_prob = <a class="code" href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">GetScaledTransitionLogProb</a>(trans_model,</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                                                               l,</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                                                               transition_scale,</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                                                               self_loop_scale);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        <span class="comment">// cost is negated log prob.</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        arc.weight.SetValue1(arc.weight.Value1() - scaled_log_prob);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l != 0) {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;AddTransitionProbs: invalid symbol &quot;</span> &lt;&lt; arc.ilabel</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; on lattice input side.&quot;</span>;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      aiter.SetValue(arc);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    }</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  }</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a417e37822095c5adb9680fa07dffea8d"><div class="ttname"><a href="namespacekaldi.html#a417e37822095c5adb9680fa07dffea8d">kaldi::LatticeArc</a></div><div class="ttdeci">fst::ArcTpl&lt; LatticeWeight &gt; LatticeArc</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-lattice_8h_source.html#l00040">kaldi-lattice.h:40</a></div></div>
<div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdoc">For an extended explanation of the framework of which grammar-fsts are a part, please see Support for...</div><div class="ttdef"><b>Definition:</b> <a href="graph_8dox_source.html#l00021">graph.dox:21</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa9e82a3b0e8f208e37fd97ddc69efbc6"><div class="ttname"><a href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">kaldi::GetScaledTransitionLogProb</a></div><div class="ttdeci">static BaseFloat GetScaledTransitionLogProb(const TransitionModel &amp;trans_model, int32 trans_id, BaseFloat transition_scale, BaseFloat self_loop_scale)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l01065">hmm-utils.cc:1065</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaa89b6ecebeea9ee1c62dd63382b40950"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa89b6ecebeea9ee1c62dd63382b40950">&#9670;&nbsp;</a></span>ConvertTransitionIdsToPdfs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::ConvertTransitionIdsToPdfs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>disambig_syms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td>
          <td class="paramname"><em>fst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts all transition-ids in the FST to pdfs plus one. </p>
<p>Placeholder: not implemented yet! </p>

</div>
</div>
<a id="gafd9f81f104ed8326628db93c0dc17d37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafd9f81f104ed8326628db93c0dc17d37">&#9670;&nbsp;</a></span>GetHmmAsFsa()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetHmmAsFsa </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; int32 &gt;&#160;</td>
          <td class="paramname"><em>context_window</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">HmmCacheType</a> *&#160;</td>
          <td class="paramname"><em>cache</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called by <a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9" title="Returns the H tranducer; result owned by caller. ">GetHTransducer()</a> and probably will not need to be called directly; it creates and returns the FST corresponding to the phone. </p>
<p>It's actually an acceptor (ilabels equal to olabels), which is why this is called "Fsa" not "Fst". This acceptor does not include self-loops; you have to call <a class="el" href="group__hmm__group__graph.html#ga859d84c809f51c078075500cdca5a0df" title="For context, see AddSelfLoops(). ">AddSelfLoops()</a> for that. (We do that at a later graph compilation phase, for efficiency). The labels on the FSA correspond to transition-ids.</p>
<p>as the symbols. For documentation in context, see <a class="el" href="hmm.html#hmm_graph_get_hmm_as_fst">The function GetHmmAsFst()</a> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context_window</td><td>A vector representing the phonetic context; see <a class="el" href="tree_externals.html#tree_window">here</a> for explanation. </td></tr>
    <tr><td class="paramname">ctx_dep</td><td>The object that contains the phonetic decision-tree </td></tr>
    <tr><td class="paramname">trans_model</td><td>The transition-model object, which provides the mappings to transition-ids and also the transition probabilities. </td></tr>
    <tr><td class="paramname">config</td><td>Configuration object, see <a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a>. </td></tr>
    <tr><td class="paramname">cache</td><td>Object used as a lookaside buffer to save computation; if it finds that the object it needs is already there, it will just return a pointer value from "cache"&ndash; not that this means you have to be careful not to delete things twice. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00032">32</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="fstext-utils-inl_8h_source.html#l00771">fst::ApplyProbabilityScale()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a63785b3c15a9e59679d01e91ec5deb32">ContextDependencyInterface::CentralPosition()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#add482cf5802e38844b4147007e7b3b2c">ContextDependencyInterface::Compute()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a5ab5836712a8f5537f9b88d05f429c42">ContextDependencyInterface::ContextWidth()</a>, <a class="el" href="transition-model_8h_source.html#l00140">TransitionModel::GetTopo()</a>, <a class="el" href="transition-model_8cc_source.html#l00457">TransitionModel::GetTransitionLogProbIgnoringSelfLoops()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="hmm-topology_8h_source.html#l00087">kaldi::kNoPdf</a>, <a class="el" href="kaldi-math_8h_source.html#l00100">kaldi::Log()</a>, <a class="el" href="hmm-topology_8cc_source.html#l00338">HmmTopology::NumPdfClasses()</a>, <a class="el" href="transition-model_8cc_source.html#l00314">TransitionModel::PairToTransitionId()</a>, <a class="el" href="remove-eps-local-inl_8h_source.html#l00309">fst::RemoveEpsLocal()</a>, <a class="el" href="hmm-topology_8cc_source.html#l00331">HmmTopology::TopologyForPhone()</a>, <a class="el" href="hmm-utils_8h_source.html#l00040">HTransducerConfig::transition_scale</a>, and <a class="el" href="transition-model_8cc_source.html#l00243">TransitionModel::TupleToTransitionState()</a>.</p>

<p class="reference">Referenced by <a class="el" href="hmm-utils_8cc_source.html#l00254">kaldi::GetHTransducer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                         {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;int32&gt;(phone_window.size()) != ctx_dep.ContextWidth())</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Context size mismatch, ilabel-info [from context FST is &quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;              &lt;&lt; phone_window.size() &lt;&lt; <span class="stringliteral">&quot;, context-dependency object &quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="stringliteral">&quot;expects &quot;</span> &lt;&lt; ctx_dep.ContextWidth();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">int</span> P = ctx_dep.CentralPosition();</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  int32 phone = phone_window[P];</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">if</span> (phone == 0)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;phone == 0.  Some mismatch happened, or there is &quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;          <span class="stringliteral">&quot;a code error.&quot;</span>;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keyword">const</span> HmmTopology &amp;topo = trans_model.GetTopo();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">const</span> HmmTopology::TopologyEntry &amp;entry  = topo.TopologyForPhone(phone);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// vector of the pdfs, indexed by pdf-class (pdf-classes must start from zero</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// and be contiguous).</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  std::vector&lt;int32&gt; pdfs(topo.NumPdfClasses(phone));</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">for</span> (int32 pdf_class = 0;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;       pdf_class &lt; static_cast&lt;int32&gt;(pdfs.size());</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;       pdf_class++) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> (! ctx_dep.Compute(phone_window, pdf_class, &amp;(pdfs[pdf_class])) ) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      std::ostringstream ctx_ss;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; phone_window.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        ctx_ss &lt;&lt; phone_window[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;GetHmmAsFsa: context-dependency object could not produce &quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;an answer: pdf-class = &quot;</span> &lt;&lt; pdf_class &lt;&lt; <span class="stringliteral">&quot; ctx-window = &quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                &lt;&lt; ctx_ss.str() &lt;&lt; <span class="stringliteral">&quot;.  This probably points &quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;          <span class="stringliteral">&quot;to either a coding error in some graph-building process, &quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;          <span class="stringliteral">&quot;a mismatch of topology with context-dependency object, the &quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;          <span class="stringliteral">&quot;wrong FST being passed on a command-line, or something of &quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;          <span class="stringliteral">&quot; that general nature.&quot;</span>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  std::pair&lt;int32, std::vector&lt;int32&gt; &gt; cache_index(phone, pdfs);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">if</span> (cache != NULL) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    HmmCacheType::iterator iter = cache-&gt;find(cache_index);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> (iter != cache-&gt;end())</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="keywordflow">return</span> iter-&gt;second;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  VectorFst&lt;StdArc&gt; *ans = <span class="keyword">new</span> VectorFst&lt;StdArc&gt;;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Arc::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">Arc::StateId</a> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a>;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Arc::Label</a> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  std::vector&lt;StateId&gt; state_ids;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; entry.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    state_ids.push_back(ans-&gt;AddState());</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(state_ids.size() != 0);  <span class="comment">// Or empty topology entry.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  ans-&gt;SetStart(state_ids[0]);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  StateId <span class="keyword">final</span> = state_ids.back();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  ans-&gt;SetFinal(<span class="keyword">final</span>, Weight::One());</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">for</span> (int32 hmm_state = 0;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;       hmm_state &lt; static_cast&lt;int32&gt;(entry.size());</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;       hmm_state++) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    int32 forward_pdf_class = entry[hmm_state].forward_pdf_class, forward_pdf;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    int32 self_loop_pdf_class = entry[hmm_state].self_loop_pdf_class, self_loop_pdf;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span> (forward_pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) {  <span class="comment">// nonemitting state.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      forward_pdf = <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      self_loop_pdf = <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(forward_pdf_class &lt; static_cast&lt;int32&gt;(pdfs.size()));</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_loop_pdf_class &lt; static_cast&lt;int32&gt;(pdfs.size()));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      forward_pdf = pdfs[forward_pdf_class];</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      self_loop_pdf = pdfs[self_loop_pdf_class];</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    int32 trans_idx;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">for</span> (trans_idx = 0;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        trans_idx &lt; static_cast&lt;int32&gt;(entry[hmm_state].transitions.size());</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        trans_idx++) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> log_prob;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      Label label;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      int32 dest_state = entry[hmm_state].transitions[trans_idx].first;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordtype">bool</span> is_self_loop = (dest_state == hmm_state);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="keywordflow">if</span> (is_self_loop)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// We will add self-loops in at a later stage of processing,</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">// not in this function.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">if</span> (forward_pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment">// no pdf, hence non-estimated probability.</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="comment">// [would not happen with normal topology] .  There is no transition-state</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="comment">// involved in this case.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        log_prob = <a class="code" href="namespacekaldi.html#af75c4606b108091c348102660de63180">Log</a>(entry[hmm_state].transitions[trans_idx].second);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        label = 0;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      } <span class="keywordflow">else</span> {  <span class="comment">// normal probability.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        int32 trans_state =</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            trans_model.TupleToTransitionState(phone, hmm_state, forward_pdf, self_loop_pdf);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        int32 trans_id =</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            trans_model.PairToTransitionId(trans_state, trans_idx);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        log_prob = trans_model.GetTransitionLogProbIgnoringSelfLoops(trans_id);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="comment">// log_prob is a negative number (or zero)...</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        label = trans_id;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">// Will add probability-scale later (we may want to push first).</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      ans-&gt;AddArc(state_ids[hmm_state],</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                  <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>(label, label, <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>(-log_prob), state_ids[dest_state]));</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="namespacefst.html#aa21bb5fdd25868b9fd813a15f37aef8e">fst::RemoveEpsLocal</a>(ans);  <span class="comment">// this is safe and will not blow up.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// Now apply probability scale.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// We waited till after the possible weight-pushing steps,</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">// because weight-pushing needs &quot;real&quot; weights in order to work.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <a class="code" href="namespacefst.html#acde6e041e51a069f9dc20999c332473d">ApplyProbabilityScale</a>(config.transition_scale, ans);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">if</span> (cache != NULL)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    (*cache)[cache_index] = ans;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div><div class="ttc" id="namespacefst_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">fst::StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00055">deterministic-fst-test.cc:55</a></div></div>
<div class="ttc" id="namespacefst_html_aa21bb5fdd25868b9fd813a15f37aef8e"><div class="ttname"><a href="namespacefst.html#aa21bb5fdd25868b9fd813a15f37aef8e">fst::RemoveEpsLocal</a></div><div class="ttdeci">void RemoveEpsLocal(MutableFst&lt; Arc &gt; *fst)</div><div class="ttdoc">RemoveEpsLocal remove some (but not necessarily all) epsilons in an FST, using an algorithm that is g...</div><div class="ttdef"><b>Definition:</b> <a href="remove-eps-local-inl_8h_source.html#l00309">remove-eps-local-inl.h:309</a></div></div>
<div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdoc">For an extended explanation of the framework of which grammar-fsts are a part, please see Support for...</div><div class="ttdef"><b>Definition:</b> <a href="graph_8dox_source.html#l00021">graph.dox:21</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="group__hmm__group_html_gad94539d80f1ba0b8731c6692b624b7a3"><div class="ttname"><a href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kaldi::kNoPdf</a></div><div class="ttdeci">static const int32 kNoPdf</div><div class="ttdoc">A constant used in the HmmTopology class as the pdf-class kNoPdf, which is used when a HMM-state is n...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-topology_8h_source.html#l00087">hmm-topology.h:87</a></div></div>
<div class="ttc" id="namespacekaldi_html_af75c4606b108091c348102660de63180"><div class="ttname"><a href="namespacekaldi.html#af75c4606b108091c348102660de63180">kaldi::Log</a></div><div class="ttdeci">double Log(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00100">kaldi-math.h:100</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacefst_html_acde6e041e51a069f9dc20999c332473d"><div class="ttname"><a href="namespacefst.html#acde6e041e51a069f9dc20999c332473d">fst::ApplyProbabilityScale</a></div><div class="ttdeci">void ApplyProbabilityScale(float scale, MutableFst&lt; Arc &gt; *fst)</div><div class="ttdoc">ApplyProbabilityScale is applicable to FSTs in the log or tropical semiring. </div><div class="ttdef"><b>Definition:</b> <a href="fstext-utils-inl_8h_source.html#l00771">fstext-utils-inl.h:771</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">Lattice::Arc Arc</div><div class="ttdef"><b>Definition:</b> <a href="lattice-determinize-non-compact_8cc_source.html#l00035">lattice-determinize-non-compact.cc:35</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gad4f0020c7b8d948bae982264abdc8f17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad4f0020c7b8d948bae982264abdc8f17">&#9670;&nbsp;</a></span>GetHmmAsFsaSimple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetHmmAsFsaSimple </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; int32 &gt;&#160;</td>
          <td class="paramname"><em>context_window</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>prob_scale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Included mainly as a form of documentation, not used in any other code currently. </p>
<p>Creates the acceptor FST with self-loops, and with fewer options. </p>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00155">155</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a63785b3c15a9e59679d01e91ec5deb32">ContextDependencyInterface::CentralPosition()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#add482cf5802e38844b4147007e7b3b2c">ContextDependencyInterface::Compute()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a5ab5836712a8f5537f9b88d05f429c42">ContextDependencyInterface::ContextWidth()</a>, <a class="el" href="transition-model_8h_source.html#l00140">TransitionModel::GetTopo()</a>, <a class="el" href="transition-model_8cc_source.html#l00448">TransitionModel::GetTransitionLogProb()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="hmm-topology_8h_source.html#l00087">kaldi::kNoPdf</a>, <a class="el" href="kaldi-math_8h_source.html#l00100">kaldi::Log()</a>, <a class="el" href="transition-model_8cc_source.html#l00314">TransitionModel::PairToTransitionId()</a>, <a class="el" href="hmm-topology_8cc_source.html#l00331">HmmTopology::TopologyForPhone()</a>, and <a class="el" href="transition-model_8cc_source.html#l00243">TransitionModel::TupleToTransitionState()</a>.</p>

<p class="reference">Referenced by <a class="el" href="hmm-utils_8cc_source.html#l01207">kaldi::GetRandomAlignmentForPhone()</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                        {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;int32&gt;(phone_window.size()) != ctx_dep.ContextWidth())</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt;<span class="stringliteral">&quot;Context size mismatch, ilabel-info [from context FST is &quot;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;              &lt;&lt;(phone_window.size())&lt;&lt;<span class="stringliteral">&quot;, context-dependency object &quot;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="stringliteral">&quot;expects &quot;</span>&lt;&lt;(ctx_dep.ContextWidth());</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">int</span> P = ctx_dep.CentralPosition();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  int32 phone = phone_window[P];</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(phone != 0);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keyword">const</span> HmmTopology &amp;topo = trans_model.GetTopo();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keyword">const</span> HmmTopology::TopologyEntry &amp;entry  = topo.TopologyForPhone(phone);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  VectorFst&lt;StdArc&gt; *ans = <span class="keyword">new</span> VectorFst&lt;StdArc&gt;;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="comment">// Create a mini-FST with a superfinal state [in case we have emitting</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="comment">// final-states, which we usually will.]</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Arc::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">Arc::StateId</a> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Arc::Label</a> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  std::vector&lt;StateId&gt; state_ids;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; entry.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    state_ids.push_back(ans-&gt;AddState());</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(state_ids.size() &gt; 1);  <span class="comment">// Or invalid topology entry.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  ans-&gt;SetStart(state_ids[0]);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  StateId <span class="keyword">final</span> = state_ids.back();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  ans-&gt;SetFinal(<span class="keyword">final</span>, Weight::One());</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">for</span> (int32 hmm_state = 0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;       hmm_state &lt; static_cast&lt;int32&gt;(entry.size());</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;       hmm_state++) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    int32 forward_pdf_class = entry[hmm_state].forward_pdf_class, forward_pdf;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    int32 self_loop_pdf_class = entry[hmm_state].self_loop_pdf_class, self_loop_pdf;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (forward_pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) {   <span class="comment">// nonemitting state; not generally used.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      forward_pdf = <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      self_loop_pdf = <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordtype">bool</span> ans = ctx_dep.Compute(phone_window, forward_pdf_class, &amp;forward_pdf);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans &amp;&amp; <span class="stringliteral">&quot;Context-dependency computation failed.&quot;</span>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      ans = ctx_dep.Compute(phone_window, self_loop_pdf_class, &amp;self_loop_pdf);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans &amp;&amp; <span class="stringliteral">&quot;Context-dependency computation failed.&quot;</span>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    int32 trans_idx;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">for</span> (trans_idx = 0;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        trans_idx &lt; static_cast&lt;int32&gt;(entry[hmm_state].transitions.size());</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        trans_idx++) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> log_prob;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      Label label;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      int32 dest_state = entry[hmm_state].transitions[trans_idx].first;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">if</span> (forward_pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">// no pdf, hence non-estimated probability.  very unusual case.  [would</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// not happen with normal topology] .  There is no transition-state</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">// involved in this case.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(hmm_state != dest_state);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        log_prob = <a class="code" href="namespacekaldi.html#af75c4606b108091c348102660de63180">Log</a>(entry[hmm_state].transitions[trans_idx].second);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        label = 0;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      } <span class="keywordflow">else</span> {  <span class="comment">// normal probability.</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        int32 trans_state =</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            trans_model.TupleToTransitionState(phone, hmm_state, forward_pdf, self_loop_pdf);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        int32 trans_id =</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            trans_model.PairToTransitionId(trans_state, trans_idx);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        log_prob = prob_scale * trans_model.GetTransitionLogProb(trans_id);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">// log_prob is a negative number (or zero)...</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        label = trans_id;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      ans-&gt;AddArc(state_ids[hmm_state],</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                  <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>(label, label, <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>(-log_prob), state_ids[dest_state]));</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div><div class="ttc" id="namespacefst_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">fst::StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00055">deterministic-fst-test.cc:55</a></div></div>
<div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdoc">For an extended explanation of the framework of which grammar-fsts are a part, please see Support for...</div><div class="ttdef"><b>Definition:</b> <a href="graph_8dox_source.html#l00021">graph.dox:21</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="group__hmm__group_html_gad94539d80f1ba0b8731c6692b624b7a3"><div class="ttname"><a href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kaldi::kNoPdf</a></div><div class="ttdeci">static const int32 kNoPdf</div><div class="ttdoc">A constant used in the HmmTopology class as the pdf-class kNoPdf, which is used when a HMM-state is n...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-topology_8h_source.html#l00087">hmm-topology.h:87</a></div></div>
<div class="ttc" id="namespacekaldi_html_af75c4606b108091c348102660de63180"><div class="ttname"><a href="namespacekaldi.html#af75c4606b108091c348102660de63180">kaldi::Log</a></div><div class="ttdeci">double Log(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00100">kaldi-math.h:100</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">Lattice::Arc Arc</div><div class="ttdef"><b>Definition:</b> <a href="lattice-determinize-non-compact_8cc_source.html#l00035">lattice-determinize-non-compact.cc:35</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gade0dda4e298562cc32dee6962e0ff0c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gade0dda4e298562cc32dee6962e0ff0c9">&#9670;&nbsp;</a></span>GetHTransducer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetHTransducer </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>ilabel_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>disambig_syms_left</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the H tranducer; result owned by caller. </p>
<p>Caution: our version of the H transducer does not include self-loops; you have to add those later. See <a class="el" href="hmm.html#hmm_graph_get_h_transducer">GetHTransducer()</a>. The H transducer has on the input transition-ids, and also possibly some disambiguation symbols, which will be put in disambig_syms. The output side contains the identifiers that are indexes into "ilabel_info" (these represent phones-in-context or disambiguation symbols). The ilabel_info vector allows GetHTransducer to map from symbols to phones-in-context (i.e. phonetic context windows). Any singleton symbols in the ilabel_info vector which are not phones, will be treated as disambiguation symbols. [Not all recipes use these]. The output "disambig_syms_left" will be set to a list of the disambiguation symbols on the input of the transducer (i.e. same symbol type as whatever is on the input of the transducer </p>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00254">254</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="stl-utils_8h_source.html#l00186">kaldi::DeletePointers()</a>, <a class="el" href="grammar-context-fst_8h_source.html#l00090">fst::GetEncodingMultiple()</a>, <a class="el" href="hmm-utils_8cc_source.html#l00032">kaldi::GetHmmAsFsa()</a>, <a class="el" href="transition-model_8h_source.html#l00194">TransitionModel::GetPhones()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="grammar-context-fst_8h_source.html#l00080">fst::kNontermBigNumber</a>, <a class="el" href="fstext-utils-inl_8h_source.html#l00669">fst::MakeLoopFst()</a>, <a class="el" href="hmm-utils_8cc_source.html#l00239">kaldi::MakeTrivialAcceptor()</a>, <a class="el" href="hmm-utils_8h_source.html#l00041">HTransducerConfig::nonterm_phones_offset</a>, <a class="el" href="transition-model_8h_source.html#l00170">TransitionModel::NumTransitionIds()</a>, and <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="training-graph-compiler_8cc_source.html#l00073">TrainingGraphCompiler::CompileGraph()</a>, <a class="el" href="training-graph-compiler_8cc_source.html#l00161">TrainingGraphCompiler::CompileGraphs()</a>, and <a class="el" href="compile-graph_8cc_source.html#l00032">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                                                                  {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ilabel_info.size() &gt;= 1 &amp;&amp; ilabel_info[0].size() == 0);  <span class="comment">// make sure that eps == eps.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">HmmCacheType</a> cache;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// &quot;cache&quot; is an optimization that prevents GetHmmAsFsa repeating work</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">// unnecessarily.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Arc::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">Arc::StateId</a> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Arc::Label</a> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  std::vector&lt;const ExpandedFst&lt;Arc&gt;* &gt; fsts(ilabel_info.size(), NULL);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  std::vector&lt;int32&gt; phones = trans_model.GetPhones();</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(disambig_syms_left != 0);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  disambig_syms_left-&gt;clear();</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  int32 first_disambig_sym = trans_model.NumTransitionIds() + 1;  <span class="comment">// First disambig symbol we can have on the input side.</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  int32 next_disambig_sym = first_disambig_sym;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (ilabel_info.size() &gt; 0)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ilabel_info[0].size() == 0);  <span class="comment">// make sure epsilon is epsilon...</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 1; j &lt; static_cast&lt;int32&gt;(ilabel_info.size()); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {  <span class="comment">// zero is eps.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].empty());</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][0] &lt; 0 ||</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        (ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][0] == 0 &amp;&amp; ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].size() == 1)) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="comment">// disambig symbol or special symbol for grammar FSTs.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">if</span> (ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].size() == 1) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">// disambiguation symbol.</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        int32 disambig_sym_left = next_disambig_sym++;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        disambig_syms_left-&gt;push_back(disambig_sym_left);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        fsts[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <a class="code" href="namespacekaldi.html#ab763f24f351cf30843d986353663461a">MakeTrivialAcceptor</a>(disambig_sym_left);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].size() == 2) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">if</span> (config.nonterm_phones_offset &lt;= 0) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;ilabel-info seems to be for grammar-FST.  You need to &quot;</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;              <span class="stringliteral">&quot;supply the --nonterm-phones-offset option.&quot;</span>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        int32 nonterm_phones_offset = config.nonterm_phones_offset,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            nonterminal = -ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][0],</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            left_context_phone = ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][1];</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (nonterminal &lt;= nonterm_phones_offset ||</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            left_context_phone &lt;= 0 ||</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            left_context_phone &gt; nonterm_phones_offset) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Could not interpret this ilabel-info with &quot;</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;              <span class="stringliteral">&quot;--nonterm-phones-offset=&quot;</span> &lt;&lt; nonterm_phones_offset</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;: nonterminal,left-context-phone=&quot;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    &lt;&lt; nonterminal &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; left_context_phone;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        int32 big_number = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(<a class="code" href="namespacefst.html#a251b709d87fe58fc66599f483fb98bd2aafc1d79474b5b834eae90c6a9c42790f">fst::kNontermBigNumber</a>),</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            encoding_multiple = <a class="code" href="namespacefst.html#a4828391bb3d612ffffaf704c14c30d6a">fst::GetEncodingMultiple</a>(nonterm_phones_offset);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        int32 encoded_symbol = big_number + nonterminal * encoding_multiple +</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            left_context_phone;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        fsts[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <a class="code" href="namespacekaldi.html#ab763f24f351cf30843d986353663461a">MakeTrivialAcceptor</a>(encoded_symbol);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Could not decode this ilabel_info entry.&quot;</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// Real phone-in-context.</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      std::vector&lt;int32&gt; phone_window = ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      VectorFst&lt;Arc&gt; *<a class="code" href="namespacefst.html">fst</a> = <a class="code" href="group__hmm__group__graph.html#gafd9f81f104ed8326628db93c0dc17d37">GetHmmAsFsa</a>(phone_window,</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                        ctx_dep,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                        trans_model,</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                        config,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                        &amp;cache);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      fsts[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = fst;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  VectorFst&lt;Arc&gt; *ans = <a class="code" href="namespacefst.html#a3b99f77992383006bda67038a91191de">MakeLoopFst</a>(fsts);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;fsts); <span class="comment">// remove duplicate pointers, which we will have</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">// in general, since we used the cache.</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="namespacekaldi.html#a34158c6c567bc6c51c90af0251395d6a">DeletePointers</a>(&amp;fsts);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;}</div><div class="ttc" id="namespacefst_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">fst::StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00055">deterministic-fst-test.cc:55</a></div></div>
<div class="ttc" id="namespacefst_html_a251b709d87fe58fc66599f483fb98bd2aafc1d79474b5b834eae90c6a9c42790f"><div class="ttname"><a href="namespacefst.html#a251b709d87fe58fc66599f483fb98bd2aafc1d79474b5b834eae90c6a9c42790f">fst::kNontermBigNumber</a></div><div class="ttdef"><b>Definition:</b> <a href="grammar-context-fst_8h_source.html#l00080">grammar-context-fst.h:80</a></div></div>
<div class="ttc" id="namespacekaldi_html_a34158c6c567bc6c51c90af0251395d6a"><div class="ttname"><a href="namespacekaldi.html#a34158c6c567bc6c51c90af0251395d6a">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A *&gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00186">stl-utils.h:186</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab763f24f351cf30843d986353663461a"><div class="ttname"><a href="namespacekaldi.html#ab763f24f351cf30843d986353663461a">kaldi::MakeTrivialAcceptor</a></div><div class="ttdeci">static fst::VectorFst&lt; fst::StdArc &gt; * MakeTrivialAcceptor(int32 label)</div><div class="ttdoc">This utility function, used in GetHTransducer(), creates an FSA (finite state acceptor, i.e. </div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00239">hmm-utils.cc:239</a></div></div>
<div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdoc">For an extended explanation of the framework of which grammar-fsts are a part, please see Support for...</div><div class="ttdef"><b>Definition:</b> <a href="graph_8dox_source.html#l00021">graph.dox:21</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="group__hmm__group__graph_html_gaf603f501ad03cb3632179ef5aa36b73e"><div class="ttname"><a href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">kaldi::HmmCacheType</a></div><div class="ttdeci">unordered_map&lt; std::pair&lt; int32, std::vector&lt; int32 &gt; &gt;, fst::VectorFst&lt; fst::StdArc &gt; *, HmmCacheHash &gt; HmmCacheType</div><div class="ttdoc">HmmCacheType is a map from (central-phone, sequence of pdf-ids) to FST, used as cache in GetHmmAsFsa...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8h_source.html#l00070">hmm-utils.h:70</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacefst_html_a3b99f77992383006bda67038a91191de"><div class="ttname"><a href="namespacefst.html#a3b99f77992383006bda67038a91191de">fst::MakeLoopFst</a></div><div class="ttdeci">VectorFst&lt; Arc &gt; * MakeLoopFst(const vector&lt; const ExpandedFst&lt; Arc &gt; *&gt; &amp;fsts)</div><div class="ttdoc">MakeLoopFst creates an FST that has a state that is both initial and final (weight == Weight::One())...</div><div class="ttdef"><b>Definition:</b> <a href="fstext-utils-inl_8h_source.html#l00669">fstext-utils-inl.h:669</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">Lattice::Arc Arc</div><div class="ttdef"><b>Definition:</b> <a href="lattice-determinize-non-compact_8cc_source.html#l00035">lattice-determinize-non-compact.cc:35</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
<div class="ttc" id="group__hmm__group__graph_html_gafd9f81f104ed8326628db93c0dc17d37"><div class="ttname"><a href="group__hmm__group__graph.html#gafd9f81f104ed8326628db93c0dc17d37">kaldi::GetHmmAsFsa</a></div><div class="ttdeci">fst::VectorFst&lt; fst::StdArc &gt; * GetHmmAsFsa(std::vector&lt; int32 &gt; phone_window, const ContextDependencyInterface &amp;ctx_dep, const TransitionModel &amp;trans_model, const HTransducerConfig &amp;config, HmmCacheType *cache)</div><div class="ttdoc">Called by GetHTransducer() and probably will not need to be called directly; it creates and returns t...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00032">hmm-utils.cc:32</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacefst_html_a4828391bb3d612ffffaf704c14c30d6a"><div class="ttname"><a href="namespacefst.html#a4828391bb3d612ffffaf704c14c30d6a">fst::GetEncodingMultiple</a></div><div class="ttdeci">int32 GetEncodingMultiple(int32 nonterm_phones_offset)</div><div class="ttdef"><b>Definition:</b> <a href="grammar-context-fst_8h_source.html#l00090">grammar-context-fst.h:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga204bf084239aa1ea304b5b7b987aa098"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga204bf084239aa1ea304b5b7b987aa098">&#9670;&nbsp;</a></span>GetIlabelMapping()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetIlabelMapping </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>ilabel_info_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1ContextDependencyInterface.html">ContextDependencyInterface</a> &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>old2new_map</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GetIlabelMapping produces a mapping that's similar to HTK's logical-to-physical model mapping (i.e. </p>
<p>the xwrd.clustered.mlist files). It groups together "logical HMMs" (i.e. in our world, phonetic context windows) that share the same sequence of transition-ids. This can be used in an optional graph-creation step that produces a remapped form of CLG that can be more productively determinized and minimized. This is used in the command-line program <a class="el" href="make-ilabel-transducer_8cc.html">make-ilabel-transducer.cc</a>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ilabel_info_old</td><td>[in] The original <a class="el" href="tree_externals.html#tree_ilabel">ilabel_info</a> vector </td></tr>
    <tr><td class="paramname">ctx_dep</td><td>[in] The tree </td></tr>
    <tr><td class="paramname">trans_model</td><td>[in] The transition-model object </td></tr>
    <tr><td class="paramname">old2new_map</td><td>[out] The output; this vector, which is of size equal to the number of new labels, is a mapping to the old labels such that we could create a vector ilabel_info_new such that ilabel_info_new[i] == ilabel_info_old[old2new_map[i]] </td></tr>
  </table>
  </dd>
</dl>
<p>The next variable maps from the (central-phone, pdf-sequence) to the index in ilabel_info_old corresponding to the first phone-in-context that we saw for it. We use this to work out the logical-to-physical mapping. Each time we handle a phone in context, we see if its (central-phone, pdf-sequence) has already been seen; if yes, we map to the original phone-sequence, if no, we create a new "phyiscal-HMM" and there is no mapping.</p>
<p>old2old_map is a map from the old ilabels to themselves (but duplicates are mapped to one unique one. </p>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00335">335</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a63785b3c15a9e59679d01e91ec5deb32">ContextDependencyInterface::CentralPosition()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#add482cf5802e38844b4147007e7b3b2c">ContextDependencyInterface::Compute()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a5ab5836712a8f5537f9b88d05f429c42">ContextDependencyInterface::ContextWidth()</a>, <a class="el" href="transition-model_8h_source.html#l00140">TransitionModel::GetTopo()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="hmm-topology_8cc_source.html#l00338">HmmTopology::NumPdfClasses()</a>, and <a class="el" href="io-funcs-inl_8h_source.html#l00198">kaldi::WriteIntegerVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="make-ilabel-transducer_8cc_source.html#l00029">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                                      {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(old2new_map != NULL);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  std::map&lt;std::pair&lt;int32, std::vector&lt;int32&gt; &gt;, int32 &gt;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      pair_to_physical;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  int32 N = ctx_dep.ContextWidth(),</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      P = ctx_dep.CentralPosition();</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  int32 num_syms_old = ilabel_info_old.size();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  std::vector&lt;int32&gt; old2old_map(num_syms_old);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  old2old_map[0] = 0;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_syms_old; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;vec = ilabel_info_old[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (vec.size() == 1 &amp;&amp; vec[0] &lt;= 0) {  <span class="comment">// disambig.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(vec.size() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(N));</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="comment">// work out the vector of context-dependent phone</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      int32 central_phone = vec[P];</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      int32 num_pdf_classes = trans_model.GetTopo().NumPdfClasses(central_phone);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      std::vector&lt;int32&gt; state_seq(num_pdf_classes);  <span class="comment">// Indexed by pdf-class</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">for</span> (int32 pdf_class = 0; pdf_class &lt; num_pdf_classes; pdf_class++) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">if</span> (!ctx_dep.Compute(vec, pdf_class, &amp;(state_seq[pdf_class]))) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          std::ostringstream ss;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          <a class="code" href="group__io__funcs__basic.html#ga99e4557f845a9c1e3202ab136226a980">WriteIntegerVector</a>(ss, <span class="keyword">false</span>, vec);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;tree did not succeed in converting phone window &quot;</span>&lt;&lt;ss.str();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      std::pair&lt;int32, std::vector&lt;int32&gt; &gt; pr(central_phone, state_seq);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      std::map&lt;std::pair&lt;int32, std::vector&lt;int32&gt; &gt;, int32 &gt;::iterator iter</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          = pair_to_physical.find(pr);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">if</span> (iter == pair_to_physical.end()) {  <span class="comment">// first time we saw something like this.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        pair_to_physical[pr] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      } <span class="keywordflow">else</span> {  <span class="comment">// seen it before.  look up in the map, the index we point to.</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = iter-&gt;second;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      }</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  std::vector&lt;bool&gt; seen(num_syms_old, <span class="keyword">false</span>);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_syms_old; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    seen[old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]] = <span class="keyword">true</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">// Now work out the elements of old2new_map corresponding to</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="comment">// things that are first in their equivalence class.  We&#39;re just</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// compacting the labels to those for which seen[i] == true.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  int32 cur_id = 0;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  old2new_map-&gt;resize(num_syms_old);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_syms_old; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (seen[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      (*old2new_map)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = cur_id++;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// fill in the other elements of old2new_map.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0; i &lt; num_syms_old; i++)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    (*old2new_map)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (*old2new_map)[old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga99e4557f845a9c1e3202ab136226a980"><div class="ttname"><a href="group__io__funcs__basic.html#ga99e4557f845a9c1e3202ab136226a980">kaldi::WriteIntegerVector</a></div><div class="ttdeci">void WriteIntegerVector(std::ostream &amp;os, bool binary, const std::vector&lt; T &gt; &amp;v)</div><div class="ttdoc">Function for writing STL vectors of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00198">io-funcs-inl.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gae04ff751dd230f18c7091b28bac598a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae04ff751dd230f18c7091b28bac598a1">&#9670;&nbsp;</a></span>GetPdfToTransitionIdTransducer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetPdfToTransitionIdTransducer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a transducer from pdfs plus one (input) to transition-ids (output). </p>
<p>Currenly of use only for testing. </p>

<p class="definition">Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00407">407</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="transition-model_8h_source.html#l00170">TransitionModel::NumTransitionIds()</a>, and <a class="el" href="transition-model_8h_source.html#l00324">TransitionModel::TransitionIdToPdf()</a>.</p>

<p class="reference">Referenced by <a class="el" href="make-pdf-to-tid-transducer_8cc_source.html#l00025">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                                                                            {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  VectorFst&lt;StdArc&gt; *ans = <span class="keyword">new</span> VectorFst&lt;StdArc&gt;;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">VectorFst&lt;StdArc&gt;::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  ans-&gt;AddState();</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  ans-&gt;SetStart(0);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  ans-&gt;SetFinal(0, Weight::One());</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">for</span> (int32 tid = 1; tid &lt;= trans_model.NumTransitionIds(); tid++) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    int32 pdf = trans_model.TransitionIdToPdf(tid);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    ans-&gt;AddArc(0, <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>(pdf+1, tid, Weight::One(), 0));  <span class="comment">// note the offset of 1 on the pdfs.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// it&#39;s because 0 is a valid pdf.</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}</div><div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdoc">For an extended explanation of the framework of which grammar-fsts are a part, please see Support for...</div><div class="ttdef"><b>Definition:</b> <a href="graph_8dox_source.html#l00021">graph.dox:21</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">Lattice::Arc Arc</div><div class="ttdef"><b>Definition:</b> <a href="lattice-determinize-non-compact_8cc_source.html#l00035">lattice-determinize-non-compact.cc:35</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
