<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: ExampleMergingStats Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1nnet3_1_1ExampleMergingStats.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classkaldi_1_1nnet3_1_1ExampleMergingStats-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ExampleMergingStats Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class is responsible for storing, and displaying in log messages, statistics about how examples of different sizes (c.f.  
 <a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="nnet-example-utils_8h_source.html">nnet-example-utils.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for ExampleMergingStats:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1nnet3_1_1ExampleMergingStats__coll__graph.png" border="0" usemap="#ExampleMergingStats_coll__map" alt="Collaboration graph"/></div>
<map name="ExampleMergingStats_coll__map" id="ExampleMergingStats_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ExampleMergingStats_1_1StatsForExampleSize.html">StatsForExampleSize</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab3c259d5e8014d77b1bab88b32fbd2db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#ab3c259d5e8014d77b1bab88b32fbd2db">WroteExample</a> (int32 example_size, <a class="el" href="classsize__t.html">size_t</a> structure_hash, int32 minibatch_size)</td></tr>
<tr class="memdesc:ab3c259d5e8014d77b1bab88b32fbd2db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Users call this function to inform this class that one minibatch has been written aggregating 'minibatch_size' separate examples of original size 'example_size' (e.g.  <a href="#ab3c259d5e8014d77b1bab88b32fbd2db">More...</a><br /></td></tr>
<tr class="separator:ab3c259d5e8014d77b1bab88b32fbd2db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aded7f484592af58ab68f55a990711775"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#aded7f484592af58ab68f55a990711775">DiscardedExamples</a> (int32 example_size, <a class="el" href="classsize__t.html">size_t</a> structure_hash, int32 num_discarded)</td></tr>
<tr class="memdesc:aded7f484592af58ab68f55a990711775"><td class="mdescLeft">&#160;</td><td class="mdescRight">Users call this function to inform this class that after processing all the data, for examples of original size 'example_size', 'num_discarded' examples could not be put into a minibatch and were discarded.  <a href="#aded7f484592af58ab68f55a990711775">More...</a><br /></td></tr>
<tr class="separator:aded7f484592af58ab68f55a990711775"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03d5ca6685fec726fde05d93002c3413"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a03d5ca6685fec726fde05d93002c3413">PrintStats</a> () const</td></tr>
<tr class="memdesc:a03d5ca6685fec726fde05d93002c3413"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calling this will cause a log message with information about the examples to be printed.  <a href="#a03d5ca6685fec726fde05d93002c3413">More...</a><br /></td></tr>
<tr class="separator:a03d5ca6685fec726fde05d93002c3413"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a6ef7d4c35014fd095b0b88892559076c"><td class="memItemLeft" align="right" valign="top">typedef unordered_map&lt; std::pair&lt; int32, <a class="el" href="classsize__t.html">size_t</a> &gt;, <a class="el" href="structkaldi_1_1nnet3_1_1ExampleMergingStats_1_1StatsForExampleSize.html">StatsForExampleSize</a>, <a class="el" href="structkaldi_1_1PairHasher.html">PairHasher</a>&lt; int32, <a class="el" href="classsize__t.html">size_t</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a6ef7d4c35014fd095b0b88892559076c">StatsType</a></td></tr>
<tr class="separator:a6ef7d4c35014fd095b0b88892559076c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ac239e7dff2d70f8bcefcc7bf28b3325e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#ac239e7dff2d70f8bcefcc7bf28b3325e">PrintAggregateStats</a> () const</td></tr>
<tr class="separator:ac239e7dff2d70f8bcefcc7bf28b3325e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5707a869fce9402d2f3f309a9cfc673"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#ab5707a869fce9402d2f3f309a9cfc673">PrintSpecificStats</a> () const</td></tr>
<tr class="separator:ab5707a869fce9402d2f3f309a9cfc673"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a82c3cff721066b8edb8b01a85334f979"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a6ef7d4c35014fd095b0b88892559076c">StatsType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">stats_</a></td></tr>
<tr class="separator:a82c3cff721066b8edb8b01a85334f979"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class is responsible for storing, and displaying in log messages, statistics about how examples of different sizes (c.f. </p>
<p><a class="el" href="namespacekaldi_1_1nnet3.html#afc8032deb3521ad4396a277b8c098b54" title="This function returns the &#39;size&#39; of a nnet-example as defined for purposes of merging egs...">GetNnetExampleSize()</a>) were merged into minibatches, and how many examples were left over and discarded. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8h_source.html#l00427">427</a> of file <a class="el" href="nnet-example-utils_8h_source.html">nnet-example-utils.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a6ef7d4c35014fd095b0b88892559076c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ef7d4c35014fd095b0b88892559076c">&#9670;&nbsp;</a></span>StatsType</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef unordered_map&lt;std::pair&lt;int32, <a class="el" href="classsize__t.html">size_t</a>&gt;, <a class="el" href="structkaldi_1_1nnet3_1_1ExampleMergingStats_1_1StatsForExampleSize.html">StatsForExampleSize</a>, <a class="el" href="structkaldi_1_1PairHasher.html">PairHasher</a>&lt;int32, <a class="el" href="classsize__t.html">size_t</a>&gt; &gt; <a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a6ef7d4c35014fd095b0b88892559076c">StatsType</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8h_source.html#l00464">464</a> of file <a class="el" href="nnet-example-utils_8h_source.html">nnet-example-utils.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aded7f484592af58ab68f55a990711775"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aded7f484592af58ab68f55a990711775">&#9670;&nbsp;</a></span>DiscardedExamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DiscardedExamples </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>example_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsize__t.html">size_t</a>&#160;</td>
          <td class="paramname"><em>structure_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_discarded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Users call this function to inform this class that after processing all the data, for examples of original size 'example_size', 'num_discarded' examples could not be put into a minibatch and were discarded. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l01065">1065</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-example_8cc_source.html#l00498">DiscriminativeExampleMerger::Finish()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00505">ChainExampleMerger::Finish()</a>, and <a class="el" href="nnet-example-utils_8cc_source.html#l01239">ExampleMerger::Finish()</a>.</p>
<div class="fragment"><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                                                              {</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  std::pair&lt;int32, size_t&gt; p(example_size, structure_hash);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">stats_</a>[p].num_discarded += num_discarded;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ExampleMergingStats_html_a82c3cff721066b8edb8b01a85334f979"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">kaldi::nnet3::ExampleMergingStats::stats_</a></div><div class="ttdeci">StatsType stats_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00468">nnet-example-utils.h:468</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac239e7dff2d70f8bcefcc7bf28b3325e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac239e7dff2d70f8bcefcc7bf28b3325e">&#9670;&nbsp;</a></span>PrintAggregateStats()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PrintAggregateStats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l01078">1078</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00458">ExampleMergingStats::StatsForExampleSize::minibatch_to_num_written</a>, and <a class="el" href="nnet-example-utils_8h_source.html#l00454">ExampleMergingStats::StatsForExampleSize::num_discarded</a>.</p>
<div class="fragment"><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                                                    {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="comment">// First print some aggregate stats.</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  int64 num_distinct_egs_types = 0,  <span class="comment">// number of distinct types of input egs</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                                     <span class="comment">// (differing in size or structure).</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      total_discarded_egs = 0, <span class="comment">// total number of discarded egs.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      total_discarded_egs_size = 0, <span class="comment">// total number of discarded egs each multiplied by size</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                                    <span class="comment">// of that eg</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      total_non_discarded_egs = 0,  <span class="comment">// total over all minibatches written, of</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                                    <span class="comment">// minibatch-size, equals number of input egs</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                                    <span class="comment">// that were not discarded.</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      total_non_discarded_egs_size = 0,  <span class="comment">// total over all minibatches of size-of-eg</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                                     <span class="comment">// * minibatch-size.</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      num_minibatches = 0,  <span class="comment">// total number of minibatches</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      num_distinct_minibatch_types = 0;  <span class="comment">// total number of combination of</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                                         <span class="comment">// (type-of-eg, number of distinct</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                                         <span class="comment">// minibatch-sizes for that eg-type)-</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                                         <span class="comment">// reflects the number of time we have</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                                         <span class="comment">// to compile.</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  StatsType::const_iterator eg_iter = <a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">stats_</a>.begin(), eg_end = <a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">stats_</a>.end();</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordflow">for</span> (; eg_iter != eg_end; ++eg_iter) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    int32 eg_size = eg_iter-&gt;first.first;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keyword">const</span> StatsForExampleSize &amp;stats = eg_iter-&gt;second;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    num_distinct_egs_types++;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    total_discarded_egs += stats.num_discarded;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    total_discarded_egs_size += stats.num_discarded * eg_size;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    unordered_map&lt;int32, int32&gt;::const_iterator</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        mb_iter = stats.minibatch_to_num_written.begin(),</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        mb_end = stats.minibatch_to_num_written.end();</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">for</span> (; mb_iter != mb_end; ++mb_iter) {</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      int32 mb_size = mb_iter-&gt;first,</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;          num_written = mb_iter-&gt;second;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      num_distinct_minibatch_types++;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      num_minibatches += num_written;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      total_non_discarded_egs += num_written * mb_size;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      total_non_discarded_egs_size += num_written * mb_size * eg_size;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    }</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">// the averages are written as integers- we don&#39;t really need more precision</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="comment">// than that.</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  int64 total_input_egs = total_discarded_egs + total_non_discarded_egs,</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      total_input_egs_size =</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      total_discarded_egs_size + total_non_discarded_egs_size;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="keywordtype">float</span> avg_input_egs_size = total_input_egs_size * 1.0 / total_input_egs;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keywordtype">float</span> percent_discarded = total_discarded_egs * 100.0 / total_input_egs;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="comment">// note: by minibatch size we mean the number of egs per minibatch, it</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="comment">// does not take note of the size of the input egs.</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keywordtype">float</span> avg_minibatch_size = total_non_discarded_egs * 1.0 / num_minibatches;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  os &lt;&lt; std::setprecision(4);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;Processed &quot;</span> &lt;&lt; total_input_egs</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; egs of avg. size &quot;</span> &lt;&lt; avg_input_egs_size</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; into &quot;</span> &lt;&lt; num_minibatches &lt;&lt; <span class="stringliteral">&quot; minibatches, discarding &quot;</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;     &lt;&lt; percent_discarded &lt;&lt;  <span class="stringliteral">&quot;% of egs.  Avg minibatch size was &quot;</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;     &lt;&lt; avg_minibatch_size &lt;&lt; <span class="stringliteral">&quot;, #distinct types of egs/minibatches &quot;</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;was &quot;</span> &lt;&lt; num_distinct_egs_types &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;     &lt;&lt; num_distinct_minibatch_types;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; os.str();</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ExampleMergingStats_html_a82c3cff721066b8edb8b01a85334f979"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">kaldi::nnet3::ExampleMergingStats::stats_</a></div><div class="ttdeci">StatsType stats_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00468">nnet-example-utils.h:468</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5707a869fce9402d2f3f309a9cfc673"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5707a869fce9402d2f3f309a9cfc673">&#9670;&nbsp;</a></span>PrintSpecificStats()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PrintSpecificStats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l01142">1142</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00458">ExampleMergingStats::StatsForExampleSize::minibatch_to_num_written</a>, and <a class="el" href="nnet-example-utils_8h_source.html#l00454">ExampleMergingStats::StatsForExampleSize::num_discarded</a>.</p>
<div class="fragment"><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                                                   {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Merged specific eg types as follows [format: &lt;eg-size1&gt;=&quot;</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="stringliteral">&quot;{&lt;mb-size1&gt;-&gt;&lt;num-minibatches1&gt;,&lt;mbsize2&gt;-&gt;&lt;num-minibatches2&gt;.../d=&lt;num-discarded&gt;}&quot;</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="stringliteral">&quot;,&lt;egs-size2&gt;={...},... (note,egs-size == number of input &quot;</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="stringliteral">&quot;frames including context).&quot;</span>;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="comment">// copy from unordered map to map to get sorting, for consistent output.</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keyword">typedef</span> std::map&lt;std::pair&lt;int32, size_t&gt;, StatsForExampleSize&gt; SortedMapType;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  SortedMapType stats;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  stats.insert(<a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">stats_</a>.begin(), <a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">stats_</a>.end());</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  SortedMapType::const_iterator eg_iter = stats.begin(), eg_end = stats.end();</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="keywordflow">for</span> (; eg_iter != eg_end; ++eg_iter) {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    int32 eg_size = eg_iter-&gt;first.first;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span> (eg_iter != stats.begin())</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    os &lt;&lt; eg_size &lt;&lt; <span class="stringliteral">&quot;={&quot;</span>;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keyword">const</span> StatsForExampleSize &amp;stats = eg_iter-&gt;second;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    unordered_map&lt;int32, int32&gt;::const_iterator</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        mb_iter = stats.minibatch_to_num_written.begin(),</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        mb_end =  stats.minibatch_to_num_written.end();</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">for</span> (; mb_iter != mb_end; ++mb_iter) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      int32 mb_size = mb_iter-&gt;first,</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;          num_written = mb_iter-&gt;second;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="keywordflow">if</span> (mb_iter != stats.minibatch_to_num_written.begin())</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      os &lt;&lt; mb_size &lt;&lt; <span class="stringliteral">&quot;-&gt;&quot;</span> &lt;&lt; num_written;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;,d=&quot;</span> &lt;&lt; stats.num_discarded &lt;&lt; <span class="stringliteral">&quot;}&quot;</span>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; os.str();</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ExampleMergingStats_html_a82c3cff721066b8edb8b01a85334f979"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">kaldi::nnet3::ExampleMergingStats::stats_</a></div><div class="ttdeci">StatsType stats_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00468">nnet-example-utils.h:468</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a03d5ca6685fec726fde05d93002c3413"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03d5ca6685fec726fde05d93002c3413">&#9670;&nbsp;</a></span>PrintStats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintStats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calling this will cause a log message with information about the examples to be printed. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l01073">1073</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-example_8cc_source.html#l00498">DiscriminativeExampleMerger::Finish()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00505">ChainExampleMerger::Finish()</a>, and <a class="el" href="nnet-example-utils_8cc_source.html#l01239">ExampleMerger::Finish()</a>.</p>
<div class="fragment"><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                                           {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#ab5707a869fce9402d2f3f309a9cfc673">PrintSpecificStats</a>();</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#ac239e7dff2d70f8bcefcc7bf28b3325e">PrintAggregateStats</a>();</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ExampleMergingStats_html_ac239e7dff2d70f8bcefcc7bf28b3325e"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#ac239e7dff2d70f8bcefcc7bf28b3325e">kaldi::nnet3::ExampleMergingStats::PrintAggregateStats</a></div><div class="ttdeci">void PrintAggregateStats() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l01078">nnet-example-utils.cc:1078</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ExampleMergingStats_html_ab5707a869fce9402d2f3f309a9cfc673"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#ab5707a869fce9402d2f3f309a9cfc673">kaldi::nnet3::ExampleMergingStats::PrintSpecificStats</a></div><div class="ttdeci">void PrintSpecificStats() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l01142">nnet-example-utils.cc:1142</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab3c259d5e8014d77b1bab88b32fbd2db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3c259d5e8014d77b1bab88b32fbd2db">&#9670;&nbsp;</a></span>WroteExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WroteExample </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>example_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsize__t.html">size_t</a>&#160;</td>
          <td class="paramname"><em>structure_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>minibatch_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Users call this function to inform this class that one minibatch has been written aggregating 'minibatch_size' separate examples of original size 'example_size' (e.g. </p>
<p>as determined by <a class="el" href="namespacekaldi_1_1nnet3.html#afc8032deb3521ad4396a277b8c098b54" title="This function returns the &#39;size&#39; of a nnet-example as defined for purposes of merging egs...">GetNnetExampleSize()</a>, but the caller does that. The 'structure_hash' is provided so that this class can distinguish between egs that have the same size but different structure. In the extremely unlikely eventuality that there is a hash collision, it will cause misleading stats to be printed out. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l01051">1051</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-example_8cc_source.html#l00483">DiscriminativeExampleMerger::WriteMinibatch()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00490">ChainExampleMerger::WriteMinibatch()</a>, and <a class="el" href="nnet-example-utils_8cc_source.html#l01225">ExampleMerger::WriteMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                                                          {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  std::pair&lt;int32, size_t&gt; p(example_size, structure_hash);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  unordered_map&lt;int32, int32&gt; &amp;h = <a class="code" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">stats_</a>[p].minibatch_to_num_written;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  unordered_map&lt;int32, int32&gt;::iterator iter = h.find(minibatch_size);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keywordflow">if</span> (iter == h.end())</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    h[minibatch_size] = 1;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    iter-&gt;second += 1;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ExampleMergingStats_html_a82c3cff721066b8edb8b01a85334f979"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a82c3cff721066b8edb8b01a85334f979">kaldi::nnet3::ExampleMergingStats::stats_</a></div><div class="ttdeci">StatsType stats_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00468">nnet-example-utils.h:468</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a82c3cff721066b8edb8b01a85334f979"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82c3cff721066b8edb8b01a85334f979">&#9670;&nbsp;</a></span>stats_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#a6ef7d4c35014fd095b0b88892559076c">StatsType</a> stats_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8h_source.html#l00468">468</a> of file <a class="el" href="nnet-example-utils_8h_source.html">nnet-example-utils.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>nnet3/<a class="el" href="nnet-example-utils_8h_source.html">nnet-example-utils.h</a></li>
<li>nnet3/<a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li><li class="navelem"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html">ExampleMergingStats</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
