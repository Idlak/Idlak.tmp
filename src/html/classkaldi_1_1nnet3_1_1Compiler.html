<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Compiler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1nnet3_1_1Compiler.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classkaldi_1_1nnet3_1_1Compiler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Compiler Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class creates an initial version of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>, without any optimization or sharing of matrices.  
 <a href="classkaldi_1_1nnet3_1_1Compiler.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for Compiler:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1nnet3_1_1Compiler__coll__graph.png" border="0" usemap="#Compiler_coll__map" alt="Collaboration graph"/></div>
<map name="Compiler_coll__map" id="Compiler_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1Compiler_1_1StepInfo.html">StepInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa41a731616baf5a87051a7a0c18cefa0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#aa41a731616baf5a87051a7a0c18cefa0">Compiler</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="separator:aa41a731616baf5a87051a7a0c18cefa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a070abb791896f1b516c9f9f251325470"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a070abb791896f1b516c9f9f251325470">Compiler</a> (const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&gt; &amp;request, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="separator:a070abb791896f1b516c9f9f251325470"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ba7e6700716ba8e6dfb85784922001b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a3ba7e6700716ba8e6dfb85784922001b">CreateComputation</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> &amp;opts, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a3ba7e6700716ba8e6dfb85784922001b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a65f01265f204617cc7b138d9d8b8bc5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a65f01265f204617cc7b138d9d8b8bc5e">ComputeStepDependencies</a> (const std::vector&lt; int32 &gt; &amp;this_step, int32 step_index, unordered_set&lt; int32 &gt; *dep_steps)</td></tr>
<tr class="separator:a65f01265f204617cc7b138d9d8b8bc5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5001f10346116df587c511fdf6d37c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#af5001f10346116df587c511fdf6d37c1">ComputeDerivNeeded</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;steps, const std::vector&lt; int32 &gt; &amp;step_to_segment, std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; *deriv_needed)</td></tr>
<tr class="separator:af5001f10346116df587c511fdf6d37c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac77a6c3ac3e85ee3a02125f13e38e8e2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#ac77a6c3ac3e85ee3a02125f13e38e8e2">CreateStepInfo</a> (const std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; &amp;deriv_needed, const std::vector&lt; int32 &gt; &amp;step_to_segment, std::vector&lt; std::vector&lt; int32 &gt; &gt; *by_step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:ac77a6c3ac3e85ee3a02125f13e38e8e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0b0b44dd99dc3d7b22f7380acd626c8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#aa0b0b44dd99dc3d7b22f7380acd626c8">GetStrideType</a> (int32 node_index) const</td></tr>
<tr class="separator:aa0b0b44dd99dc3d7b22f7380acd626c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab374736f7b545da4642720f56175118f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#ab374736f7b545da4642720f56175118f">DefineMatrices</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:ab374736f7b545da4642720f56175118f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7746483c91dc0506b44f5534f84840b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#ac7746483c91dc0506b44f5534f84840b">DefineSubmatrices</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:ac7746483c91dc0506b44f5534f84840b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae6044721ba4633e603924f34f31e3c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#aae6044721ba4633e603924f34f31e3c0">AllocateMatrices</a> (const std::vector&lt; int32 &gt; &amp;whole_submatrices, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:aae6044721ba4633e603924f34f31e3c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ed330888cafea969ad27813d55b5109"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a4ed330888cafea969ad27813d55b5109">SetUpPrecomputedIndexes</a> (const std::vector&lt; int32 &gt; &amp;step_to_segment, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a4ed330888cafea969ad27813d55b5109"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27b3a3bed171a1668597f5ed9784ee26"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a27b3a3bed171a1668597f5ed9784ee26">CompileForward</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a27b3a3bed171a1668597f5ed9784ee26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6463ed0a053c729473149580d518c1b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a6463ed0a053c729473149580d518c1b8">AddForwardStepComponent</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a6463ed0a053c729473149580d518c1b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5aba4c5309356cf4e0c06b615f4019f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a5aba4c5309356cf4e0c06b615f4019f9">AddForwardStepInput</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a5aba4c5309356cf4e0c06b615f4019f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7182453a66397f21a9cbb9f33ff1f6ff"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a7182453a66397f21a9cbb9f33ff1f6ff">IsInputStep</a> (int32 step) const</td></tr>
<tr class="separator:a7182453a66397f21a9cbb9f33ff1f6ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e16f71721f026c39566bf601a91ae9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e16f71721f026c39566bf601a91ae9d">CompileForwardDescriptor</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a6e16f71721f026c39566bf601a91ae9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4569ec9a6f0b9e96e784ed05116df490"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a4569ec9a6f0b9e96e784ed05116df490">CompileForwardSumDescriptor</a> (int32 step, int32 part_index, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a4569ec9a6f0b9e96e784ed05116df490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77c85c33bcf54ec797f1bd578bade7b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a77c85c33bcf54ec797f1bd578bade7b8">ComputeInputLocationsList</a> (int32 step, int32 part_index, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *input_locations) const</td></tr>
<tr class="separator:a77c85c33bcf54ec797f1bd578bade7b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5777e533fbbccce21952a60cc3312b4a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a5777e533fbbccce21952a60cc3312b4a">SplitByScale</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html">SumDescriptor</a> &amp;descriptor, const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;input_locations_list, std::vector&lt; std::pair&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &gt; &gt; *split_locations_lists) const</td></tr>
<tr class="memdesc:a5777e533fbbccce21952a60cc3312b4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function helps to handle scalar factors in Descriptors (expressions like `Scale(-1.0, &lt;descriptor)`).  <a href="#a5777e533fbbccce21952a60cc3312b4a">More...</a><br /></td></tr>
<tr class="separator:a5777e533fbbccce21952a60cc3312b4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee3c7011e653ea46c0e2081c1eabdc7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#aee3c7011e653ea46c0e2081c1eabdc7f">ComputeValueSubmatLocationsList</a> (const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;input_locations_list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *submat_locations_list) const</td></tr>
<tr class="separator:aee3c7011e653ea46c0e2081c1eabdc7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec7c771a53dc46a920e4f887ba671edf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#aec7c771a53dc46a920e4f887ba671edf">ComputeDerivSubmatLocationsList</a> (const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;input_locations_list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *submat_locations_list) const</td></tr>
<tr class="separator:aec7c771a53dc46a920e4f887ba671edf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00d90f19cbb7852a8fbbe66f91f62e79"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a00d90f19cbb7852a8fbbe66f91f62e79">CompileForwardFromSubmatLocationsList</a> (int32 value_submatrix_index, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_locations, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="memdesc:a00d90f19cbb7852a8fbbe66f91f62e79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds to 'computation' commands for part of the forward computation corresponding to a <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>.  <a href="#a00d90f19cbb7852a8fbbe66f91f62e79">More...</a><br /></td></tr>
<tr class="separator:a00d90f19cbb7852a8fbbe66f91f62e79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97890913f3402626e8d118e77ac8f0e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#ae97890913f3402626e8d118e77ac8f0e">CompileForwardFromSubmatLocations</a> (int32 value_submatrix_index, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;submat_locations, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="memdesc:ae97890913f3402626e8d118e77ac8f0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds to 'computation' commands for part of the forward computation corresponding to a <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>.  <a href="#ae97890913f3402626e8d118e77ac8f0e">More...</a><br /></td></tr>
<tr class="separator:ae97890913f3402626e8d118e77ac8f0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af97c4b9a86c640730eed16c354d8fa54"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#af97c4b9a86c640730eed16c354d8fa54">CompileForwardFromIndexes</a> (int32 value_submatrix_index, int32 input_submatrix_index, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, const std::vector&lt; int32 &gt; &amp;indexes, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="memdesc:af97c4b9a86c640730eed16c354d8fa54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds to `computation` a command that adds to the submatrix in `value_submatrix_index` a quantity consisting of alpha times the submatrix in `input_submatrix_index`, with a row mapping given by `indexes`.  <a href="#af97c4b9a86c640730eed16c354d8fa54">More...</a><br /></td></tr>
<tr class="separator:af97c4b9a86c640730eed16c354d8fa54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d646205bfa16bb5d9cf105a61f3ad47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a3d646205bfa16bb5d9cf105a61f3ad47">CompileBackward</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a3d646205bfa16bb5d9cf105a61f3ad47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a949e60fa8318e1cb73133961395c6b3c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a949e60fa8318e1cb73133961395c6b3c">AddBackwardStepComponent</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a949e60fa8318e1cb73133961395c6b3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affd00ee9da282bcc5e3403dbd514ab41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#affd00ee9da282bcc5e3403dbd514ab41">AddBackwardStepInput</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:affd00ee9da282bcc5e3403dbd514ab41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a706e835d8d14817659647b0ec663c4f2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a706e835d8d14817659647b0ec663c4f2">CompileBackwardDescriptor</a> (int32 step, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a706e835d8d14817659647b0ec663c4f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53bff987650200afc535f874ba0b064d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a53bff987650200afc535f874ba0b064d">CompileBackwardSumDescriptor</a> (int32 step, int32 part_index, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a53bff987650200afc535f874ba0b064d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10860d51f72b88d5efe8e6f31e3db651"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a10860d51f72b88d5efe8e6f31e3db651">CompileBackwardFromSubmatLocationsList</a> (int32 deriv_submatrix_index, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_locations, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a10860d51f72b88d5efe8e6f31e3db651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20fc772c3b6789c79c61e1e389aebe46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a20fc772c3b6789c79c61e1e389aebe46">CompileBackwardFromSubmatLocations</a> (int32 deriv_submatrix_index, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;submat_locations, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a20fc772c3b6789c79c61e1e389aebe46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ac504a97b8b617b3bd4658f6dc552f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a8ac504a97b8b617b3bd4658f6dc552f5">CompileBackwardFromIndexes</a> (int32 deriv_submatrix_index, int32 input_deriv_submatrix_index, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, const std::vector&lt; int32 &gt; &amp;indexes, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a8ac504a97b8b617b3bd4658f6dc552f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69e7e3add33733991062bbe39fd6fd86"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a69e7e3add33733991062bbe39fd6fd86">DeallocateMatrices</a> (const std::vector&lt; int32 &gt; &amp;whole_submatrices, const std::vector&lt; int32 &gt; &amp;step_to_segment, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a69e7e3add33733991062bbe39fd6fd86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77ed06977b3c1e639e2985ada86c5357"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a77ed06977b3c1e639e2985ada86c5357">OutputDebugInfo</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) const</td></tr>
<tr class="separator:a77ed06977b3c1e639e2985ada86c5357"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a218321cdd5637631bb8fc7b2eee008b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a218321cdd5637631bb8fc7b2eee008b3">AddCommands</a> (const std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; &amp;deriv_needed, const std::vector&lt; int32 &gt; &amp;step_to_segment, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a218321cdd5637631bb8fc7b2eee008b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:abdabde99d778f61da27f986b09efe198"><td class="memItemLeft" align="right" valign="top">std::vector&lt; const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a></td></tr>
<tr class="separator:abdabde99d778f61da27f986b09efe198"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbabf05a7702103113a02a113015205f"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a></td></tr>
<tr class="separator:adbabf05a7702103113a02a113015205f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e772505e8a0fc7ead243347658e8d19"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a></td></tr>
<tr class="separator:a6e772505e8a0fc7ead243347658e8d19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25bfe0118cf7458a88e685463d05f895"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Compiler_1_1StepInfo.html">StepInfo</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a></td></tr>
<tr class="separator:a25bfe0118cf7458a88e685463d05f895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4286f6d7e1ff9117ffc8b1a57ded5efb"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">cindex_id_to_location_</a></td></tr>
<tr class="memdesc:a4286f6d7e1ff9117ffc8b1a57ded5efb"><td class="mdescLeft">&#160;</td><td class="mdescRight">This maps each cindex_id to its location.  <a href="#a4286f6d7e1ff9117ffc8b1a57ded5efb">More...</a><br /></td></tr>
<tr class="separator:a4286f6d7e1ff9117ffc8b1a57ded5efb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class creates an initial version of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>, without any optimization or sharing of matrices. </p>
<p>Note: for a user-level interface that includes optimization, see class <a class="el" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html" title="This class enables you to do the compilation and optimization in one call, and also ensures that if t...">CachingOptimizingCompiler</a> in <a class="el" href="nnet-optimize_8h.html">nnet-optimize.h</a>. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile_8h_source.html#l00044">44</a> of file <a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aa41a731616baf5a87051a7a0c18cefa0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa41a731616baf5a87051a7a0c18cefa0">&#9670;&nbsp;</a></span>Compiler() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00029">29</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                     : <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>(nnet) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>.push_back(&amp;request);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a070abb791896f1b516c9f9f251325470"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a070abb791896f1b516c9f9f251325470">&#9670;&nbsp;</a></span>Compiler() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&gt; &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00035">35</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                     : <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>(requests), <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>(nnet) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>.size() &gt;= 1);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">// We are currently not supporting getting model derivatives for multi-segment</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// (online) computations.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>.size() != 1) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;need_model_derivative);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;store_component_stats ==</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                   <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[0]-&gt;store_component_stats);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a949e60fa8318e1cb73133961395c6b3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a949e60fa8318e1cb73133961395c6b3c">&#9670;&nbsp;</a></span>AddBackwardStepComponent()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AddBackwardStepComponent </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01149">1149</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00087">NetworkNode::component_index</a>, <a class="el" href="nnet-compile_8h_source.html#l00074">Compiler::StepInfo::deriv</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kBackprop</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00065">kaldi::nnet3::kBackpropNeedsInput</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00067">kaldi::nnet3::kBackpropNeedsOutput</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kComponent</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kaldi::nnet3::kUpdatableComponent</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00079">kaldi::nnet3::kUsesMemo</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>, and <a class="el" href="nnet-compile_8h_source.html#l00073">Compiler::StepInfo::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01050">Compiler::CompileBackward()</a>.</p>
<div class="fragment"><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                                                                            {</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(step) &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size());</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  int32 input_step = step - 1;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keyword">const</span> StepInfo &amp;input_step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[input_step];</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  int32 node_index = step_info.node_index;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(node_index);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  int32 component_index = node.u.component_index;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keyword">const</span> Component *component = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(component_index);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  int32 properties = component-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>();</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  int32 input_submatrix_index = input_step_info.value,</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      output_submatrix_index = step_info.value,</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      input_deriv_submatrix_index = input_step_info.deriv,</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      output_deriv_submatrix_index = step_info.deriv,</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      memo_index = (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658">kUsesMemo</a> ? step : 0);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_deriv_submatrix_index &gt; 0 &amp;&amp;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;               (input_deriv_submatrix_index &gt; 0 ||</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>));</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (! (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kBackpropNeedsInput</a>))</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    input_submatrix_index = 0;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">if</span> (! (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kBackpropNeedsOutput</a>))</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    output_submatrix_index = 0;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  NnetComputation::Command c(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>,</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                             component_index,</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                             step_info.precomputed_indexes_index,</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                             input_submatrix_index,</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                             output_submatrix_index,</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                             output_deriv_submatrix_index,</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                             input_deriv_submatrix_index,</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                             memo_index);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  computation-&gt;commands.push_back(c);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658">kaldi::nnet3::kUsesMemo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00079">nnet-component-itf.h:79</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kaldi::nnet3::kBackpropNeedsOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00067">nnet-component-itf.h:67</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kaldi::nnet3::kBackpropNeedsInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00065">nnet-component-itf.h:65</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="affd00ee9da282bcc5e3403dbd514ab41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affd00ee9da282bcc5e3403dbd514ab41">&#9670;&nbsp;</a></span>AddBackwardStepInput()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AddBackwardStepInput </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01131">1131</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00975">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kaldi::nnet3::kProvideOutput</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01050">Compiler::CompileBackward()</a>.</p>
<div class="fragment"><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                                                                        {</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(step) &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size());</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  int32 node_index = step_info.node_index,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      deriv_submatrix_index = step_info.deriv;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="keywordflow">if</span> (deriv_submatrix_index == 0)</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// Nothing to do.</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation-&gt;IsWholeMatrix(deriv_submatrix_index));</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(node_index);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="comment">// actually, currently the node type would always be kInput.</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a> || node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  NnetComputation::Command c(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>, deriv_submatrix_index, node_index);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  computation-&gt;commands.push_back(c);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a218321cdd5637631bb8fc7b2eee008b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a218321cdd5637631bb8fc7b2eee008b3">&#9670;&nbsp;</a></span>AddCommands()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AddCommands </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_needed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>step_to_segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00107">107</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l01189">Compiler::AllocateMatrices()</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l01050">Compiler::CompileBackward()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00406">Compiler::CompileForward()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01293">Compiler::DeallocateMatrices()</a>, <a class="el" href="nnet-computation_8cc_source.html#l01173">NnetComputation::GetWholeSubmatrices()</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationMarker</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00442">NnetComputation::need_model_derivative</a>, <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>, <a class="el" href="nnet-compile_8cc_source.html#l01239">Compiler::SetUpPrecomputedIndexes()</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                                                         {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  computation-&gt;need_model_derivative = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[0]-&gt;need_model_derivative;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  int32 arbitrary_factor = 8;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  computation-&gt;commands.reserve(computation-&gt;matrices.size()</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                * arbitrary_factor);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  std::vector&lt;int32&gt; whole_submatrices;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  computation-&gt;GetWholeSubmatrices(&amp;whole_submatrices);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#aae6044721ba4633e603924f34f31e3c0">AllocateMatrices</a>(whole_submatrices, computation);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a4ed330888cafea969ad27813d55b5109">SetUpPrecomputedIndexes</a>(step_to_segment, computation);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  int32 num_steps = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size();</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">for</span> (int32 step = 0; step &lt; num_steps; step++) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a27b3a3bed171a1668597f5ed9784ee26">CompileForward</a>(step, computation);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">if</span> (step + 1 &lt; static_cast&lt;int32&gt;(step_to_segment.size()) &amp;&amp;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        step_to_segment[step + 1] != step_to_segment[step]) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="comment">// insert a marker that separates segments of the computation.</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      computation-&gt;commands.push_back(</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;          NnetComputation::Command(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>));</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// mark the end of the forward phase.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  computation-&gt;commands.push_back(</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      NnetComputation::Command(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>));</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">for</span> (int32 step = num_steps - 1; step &gt;= 0; step--)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">if</span> (deriv_needed[step])</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a3d646205bfa16bb5d9cf105a61f3ad47">CompileBackward</a>(step, computation);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a69e7e3add33733991062bbe39fd6fd86">DeallocateMatrices</a>(whole_submatrices, step_to_segment, computation);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a3d646205bfa16bb5d9cf105a61f3ad47"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a3d646205bfa16bb5d9cf105a61f3ad47">kaldi::nnet3::Compiler::CompileBackward</a></div><div class="ttdeci">void CompileBackward(int32 step, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01050">nnet-compile.cc:1050</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_aae6044721ba4633e603924f34f31e3c0"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#aae6044721ba4633e603924f34f31e3c0">kaldi::nnet3::Compiler::AllocateMatrices</a></div><div class="ttdeci">void AllocateMatrices(const std::vector&lt; int32 &gt; &amp;whole_submatrices, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01189">nnet-compile.cc:1189</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a27b3a3bed171a1668597f5ed9784ee26"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a27b3a3bed171a1668597f5ed9784ee26">kaldi::nnet3::Compiler::CompileForward</a></div><div class="ttdeci">void CompileForward(int32 step, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00406">nnet-compile.cc:406</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a4ed330888cafea969ad27813d55b5109"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a4ed330888cafea969ad27813d55b5109">kaldi::nnet3::Compiler::SetUpPrecomputedIndexes</a></div><div class="ttdeci">void SetUpPrecomputedIndexes(const std::vector&lt; int32 &gt; &amp;step_to_segment, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01239">nnet-compile.cc:1239</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a69e7e3add33733991062bbe39fd6fd86"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a69e7e3add33733991062bbe39fd6fd86">kaldi::nnet3::Compiler::DeallocateMatrices</a></div><div class="ttdeci">void DeallocateMatrices(const std::vector&lt; int32 &gt; &amp;whole_submatrices, const std::vector&lt; int32 &gt; &amp;step_to_segment, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01293">nnet-compile.cc:1293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6463ed0a053c729473149580d518c1b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6463ed0a053c729473149580d518c1b8">&#9670;&nbsp;</a></span>AddForwardStepComponent()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AddForwardStepComponent </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01097">1097</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00087">NetworkNode::component_index</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kComponent</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kPropagate</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00071">kaldi::nnet3::kStoresStats</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00079">kaldi::nnet3::kUsesMemo</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>, and <a class="el" href="nnet-compile_8h_source.html#l00073">Compiler::StepInfo::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00406">Compiler::CompileForward()</a>.</p>
<div class="fragment"><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                                                                           {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(step) &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size());</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  int32 input_step = step - 1;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keyword">const</span> StepInfo &amp;input_step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[input_step];</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  int32 node_index = step_info.node_index;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(node_index);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  int32 component_index = node.u.component_index;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <span class="keyword">const</span> Component *component = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(component_index);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="comment">// note RE memo_index: we&#39;ll renumber them in optimization to get rid of gaps.</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="comment">// The use of &#39;step&#39; as the memo index is OK because step &gt; 0 if we&#39;re doing</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="comment">// forward propagation, there must be preceding steps for inputs or for</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">// component-input nodes).</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  int32 properties = component-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>(),</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      input_submatrix_index = input_step_info.value,</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      output_submatrix_index = step_info.value,</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      memo_index = (step_info.deriv &gt; 0 &amp;&amp; (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658">kUsesMemo</a>) ? step : 0),</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      store_stats = (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[0]-&gt;store_component_stats &amp;&amp;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                     (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827">kStoresStats</a>) ?  1 : 0);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  NnetComputation::Command c(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a>,</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                             component_index,</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                             step_info.precomputed_indexes_index,</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                             input_submatrix_index,</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                             output_submatrix_index,</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                             memo_index,</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                             store_stats);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  computation-&gt;commands.push_back(c);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658">kaldi::nnet3::kUsesMemo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00079">nnet-component-itf.h:79</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827">kaldi::nnet3::kStoresStats</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00071">nnet-component-itf.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5aba4c5309356cf4e0c06b615f4019f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5aba4c5309356cf4e0c06b615f4019f9">&#9670;&nbsp;</a></span>AddForwardStepInput()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AddForwardStepInput </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01080">1080</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00975">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kaldi::nnet3::kAcceptInput</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kInput</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00406">Compiler::CompileForward()</a>.</p>
<div class="fragment"><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                                                                       {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(step) &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size());</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  int32 node_index = step_info.node_index,</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      submatrix_index = step_info.value;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation-&gt;IsWholeMatrix(submatrix_index));</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(node_index);</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="comment">// actually currently the node type would always be kInput.</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a> || node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  NnetComputation::Command c(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>, submatrix_index, node_index);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  computation-&gt;commands.push_back(c);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aae6044721ba4633e603924f34f31e3c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae6044721ba4633e603924f34f31e3c0">&#9670;&nbsp;</a></span>AllocateMatrices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AllocateMatrices </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>whole_submatrices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01189">1189</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8h_source.html#l00074">Compiler::StepInfo::deriv</a>, <a class="el" href="nnet-compile_8h_source.html#l00064">Compiler::graph_</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00055">ComputationGraph::is_input</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kSetConst</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="nnet-compile_8h_source.html#l00089">Compiler::StepInfo::output_cindex_ids</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>, and <a class="el" href="nnet-compile_8h_source.html#l00073">Compiler::StepInfo::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                                                                    {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation-&gt;commands.empty());</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="comment">// Work out which matrices are inputs to the computation (or output-derivs,</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="comment">// which are also supplied as inputs to the computation); we won&#39;t be setting</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="comment">// these up.</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  unordered_set&lt;int32&gt; input_and_oderiv_matrices;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  int32 num_steps = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size();</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">for</span> (int32 step = 0; step &lt; num_steps; step++) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keyword">const</span> StepInfo &amp;this_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span> (this_info.output_cindex_ids.empty())</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    int32 first_cindex_id = this_info.output_cindex_ids.front(),</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        node_index = this_info.node_index;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordtype">bool</span> is_input = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a7038fa9813a5d2c15c5c8a33dcc2ca9b">is_input</a>[first_cindex_id],</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        is_output = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">IsOutputNode</a>(node_index);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">if</span> (is_input) {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      int32 value_submatrix_index = this_info.value,</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;          value_matrix_index =</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;          computation-&gt;submatrices[value_submatrix_index].matrix_index;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      input_and_oderiv_matrices.insert(value_matrix_index);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    }</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="keywordflow">if</span> (is_output &amp;&amp; this_info.deriv != 0) {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      int32 deriv_submatrix_index = this_info.deriv,</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;          deriv_matrix_index =</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          computation-&gt;submatrices[deriv_submatrix_index].matrix_index;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      input_and_oderiv_matrices.insert(deriv_matrix_index);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    }</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  int32 num_matrices = computation-&gt;matrices.size();</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">// We don&#39;t set up the matrices that are inputs to the computation;</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">// this happens when the user provides the input.</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">if</span> (input_and_oderiv_matrices.count(m) == 0) {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="comment">// get a submatrix index that refers to the entire matrix.</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      int32 submatrix_index = whole_submatrices[m];</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      computation-&gt;commands.push_back(</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;          NnetComputation::Command(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>, submatrix_index));</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="comment">// Later in the optimization phase, it turns out that zeroing is not</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="comment">// necessary for some matrices, we&#39;ll remove the redundant kSetConst</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="comment">// commands.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      computation-&gt;commands.push_back(</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;          NnetComputation::Command(0.0, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>, submatrix_index));</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  }</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6e772505e8a0fc7ead243347658e8d19"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">kaldi::nnet3::Compiler::graph_</a></div><div class="ttdeci">ComputationGraph graph_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00064">nnet-compile.h:64</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a6c50812e1be80ab06573493276ec2ca5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">kaldi::nnet3::Nnet::IsOutputNode</a></div><div class="ttdeci">bool IsOutputNode(int32 node) const</div><div class="ttdoc">Returns true if this is an output node, meaning that it is of type kDescriptor and is not directly fo...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00112">nnet-nnet.cc:112</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_a7038fa9813a5d2c15c5c8a33dcc2ca9b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a7038fa9813a5d2c15c5c8a33dcc2ca9b">kaldi::nnet3::ComputationGraph::is_input</a></div><div class="ttdeci">std::vector&lt; bool &gt; is_input</div><div class="ttdoc">For each Cindex this tells us whether it was provided as an input to the network. ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8h_source.html#l00055">nnet-computation-graph.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d646205bfa16bb5d9cf105a61f3ad47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d646205bfa16bb5d9cf105a61f3ad47">&#9670;&nbsp;</a></span>CompileBackward()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileBackward </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01050">1050</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l01149">Compiler::AddBackwardStepComponent()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01131">Compiler::AddBackwardStepInput()</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l01029">Compiler::CompileBackwardDescriptor()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00397">Compiler::IsInputStep()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kDescriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kDimRange</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationPermanent</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                                                                   {</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(step &lt; static_cast&lt;int32&gt;(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size()));</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  int32 node_index = step_info.node_index;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(node_index);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordflow">switch</span> (node.node_type) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a>:</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#affd00ee9da282bcc5e3403dbd514ab41">AddBackwardStepInput</a>(step, computation);</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a7182453a66397f21a9cbb9f33ff1f6ff">IsInputStep</a>(step + 1))  <span class="comment">// Make sure backward computation is nonempty.</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        computation-&gt;commands.push_back(</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            NnetComputation::Command(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>));</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kDimRange</a>:</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="keywordflow">break</span>;  <span class="comment">// Nothing to do.</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>:</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a949e60fa8318e1cb73133961395c6b3c">AddBackwardStepComponent</a>(step, computation);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>:</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a706e835d8d14817659647b0ec663c4f2">CompileBackwardDescriptor</a>(step, computation);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Invalid node type&quot;</span>;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a949e60fa8318e1cb73133961395c6b3c"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a949e60fa8318e1cb73133961395c6b3c">kaldi::nnet3::Compiler::AddBackwardStepComponent</a></div><div class="ttdeci">void AddBackwardStepComponent(int32 step, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01149">nnet-compile.cc:1149</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a706e835d8d14817659647b0ec663c4f2"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a706e835d8d14817659647b0ec663c4f2">kaldi::nnet3::Compiler::CompileBackwardDescriptor</a></div><div class="ttdeci">void CompileBackwardDescriptor(int32 step, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01029">nnet-compile.cc:1029</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kaldi::nnet3::kDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_affd00ee9da282bcc5e3403dbd514ab41"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#affd00ee9da282bcc5e3403dbd514ab41">kaldi::nnet3::Compiler::AddBackwardStepInput</a></div><div class="ttdeci">void AddBackwardStepInput(int32 step, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01131">nnet-compile.cc:1131</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a7182453a66397f21a9cbb9f33ff1f6ff"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a7182453a66397f21a9cbb9f33ff1f6ff">kaldi::nnet3::Compiler::IsInputStep</a></div><div class="ttdeci">bool IsInputStep(int32 step) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00397">nnet-compile.cc:397</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kaldi::nnet3::kDimRange</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a706e835d8d14817659647b0ec663c4f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a706e835d8d14817659647b0ec663c4f2">&#9670;&nbsp;</a></span>CompileBackwardDescriptor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileBackwardDescriptor </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01029">1029</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l00835">Compiler::CompileBackwardSumDescriptor()</a>, <a class="el" href="nnet-compile_8h_source.html#l00074">Compiler::StepInfo::deriv</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00975">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kaldi::nnet3::kAcceptInput</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, and <a class="el" href="nnet-compile_8h_source.html#l00097">Compiler::StepInfo::value_parts</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01050">Compiler::CompileBackward()</a>.</p>
<div class="fragment"><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                                              {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">IsOutputNode</a>(step_info.node_index) &amp;&amp;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      step_info.deriv &gt; 0) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    int32 deriv_submatrix_index = step_info.deriv;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation-&gt;IsWholeMatrix(deriv_submatrix_index));</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    NnetComputation::Command c(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>, deriv_submatrix_index,</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                               step_info.node_index);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    computation-&gt;commands.push_back(c);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="comment">// the top-level descriptor has a bunch of parts that we concatenate features</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="comment">// over.</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  int32 num_parts = step_info.value_parts.size();</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="keywordflow">for</span> (int32 part = 0; part &lt; num_parts; part++)</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a53bff987650200afc535f874ba0b064d">CompileBackwardSumDescriptor</a>(step, part,</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                                       computation);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a53bff987650200afc535f874ba0b064d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a53bff987650200afc535f874ba0b064d">kaldi::nnet3::Compiler::CompileBackwardSumDescriptor</a></div><div class="ttdeci">void CompileBackwardSumDescriptor(int32 step, int32 part_index, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00835">nnet-compile.cc:835</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a6c50812e1be80ab06573493276ec2ca5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">kaldi::nnet3::Nnet::IsOutputNode</a></div><div class="ttdeci">bool IsOutputNode(int32 node) const</div><div class="ttdoc">Returns true if this is an output node, meaning that it is of type kDescriptor and is not directly fo...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00112">nnet-nnet.cc:112</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ac504a97b8b617b3bd4658f6dc552f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ac504a97b8b617b3bd4658f6dc552f5">&#9670;&nbsp;</a></span>CompileBackwardFromIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileBackwardFromIndexes </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>deriv_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_deriv_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00939">939</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00556">kaldi::nnet3::HasContiguousProperty()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00419">NnetComputation::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00430">NnetComputation::indexes_ranges</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kaldi::nnet3::kAddRowRanges</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kAddRows</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kMatrixAdd</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00887">Compiler::CompileBackwardFromSubmatLocations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                                        {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  int32 num_rows = computation-&gt;submatrices[deriv_submatrix_index].num_rows,</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      input_num_rows =</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      computation-&gt;submatrices[input_deriv_submatrix_index].num_rows;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes.size() == num_rows);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keywordflow">if</span> (input_num_rows == num_rows) {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; num_rows; i++)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="keywordflow">if</span> (indexes[i] != i)</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">if</span> (i == num_rows) {  <span class="comment">// Simplest case: just matrix addition.</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        computation-&gt;commands.push_back(</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            NnetComputation::Command(alpha,</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                     <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>,</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                                     input_deriv_submatrix_index,</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                                     deriv_submatrix_index));</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  }</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordflow">if</span> (input_num_rows &gt;= num_rows) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="comment">// If there are no repeated elements in the &quot;indexes&quot; array, we can reverse</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">// the mapping and make it an operation of type kAddRows.  TODO: change this</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">// to use kAddToRows, kCopyToRows, when implemented (will be more</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="comment">// efficient).</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    std::vector&lt;int32&gt; reverse_indexes(input_num_rows, -1);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; num_rows; i++) {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      int32 index_i = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(index_i &gt;= -1 &amp;&amp; index_i &lt; input_num_rows);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordflow">if</span> (index_i &gt;= 0) {</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">if</span> (reverse_indexes[index_i] == -1)</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;          reverse_indexes[index_i] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      }  <span class="comment">// note: there may be -1&#39;s in &#39;indexes&#39;, meaning just use zero.</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span> (i == num_rows) {</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="comment">// There were no repeated elements, and this strategy will work.</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      int32 indexes_index = computation-&gt;indexes.size();</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      computation-&gt;indexes.push_back(reverse_indexes);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        computation-&gt;commands.push_back(</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            NnetComputation::Command(alpha,</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                     <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>,</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                                     input_deriv_submatrix_index,</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                                     deriv_submatrix_index,</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                     indexes_index));</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; ranges;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">HasContiguousProperty</a>(indexes, &amp;ranges)) {</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="comment">// the operation can be set up as AddRowRanges.</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">if</span> (static_cast&lt;int32&gt;(ranges.size()) != input_num_rows) {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;int32&gt;(ranges.size()) &lt; input_num_rows);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="comment">// extend with (-1, -1) pairs.</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      ranges.resize(input_num_rows, std::pair&lt;int32,int32&gt;(-1, -1));</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    int32 indexes_ranges_index = computation-&gt;indexes_ranges.size();</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    computation-&gt;indexes_ranges.push_back(ranges);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    computation-&gt;commands.push_back(</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        NnetComputation::Command(alpha,</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                                 <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>,</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                                 input_deriv_submatrix_index,</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                                 deriv_submatrix_index,</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                                 indexes_ranges_index));</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">// TODO: if any of these ranges are quite long (summing over many rows), the</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="comment">// resulting code could be inefficient because the AddRowRanges kernels</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="comment">// takes time linear in the length of the range.  Using a temporary matrix</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">// with an intermediate size would make this more efficient in that case, so</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="comment">// the one command would be two commands (plus commands to set up and</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">// destroy the temporary matrix).</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="comment">// If you ever reach here, it means someone has used a type of network that we</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="comment">// don&#39;t yet support in the backprop.  Basically this case can be handled by</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="comment">// creating a temporary matrix to reorder the matrix at deriv_submatrix_index,</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">// (using CopyRows), and doing AddRowRanges from that.</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="comment">// It wouldn&#39;t be too much work.</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;This case not implemented yet.&quot;</span>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ae892457066e9b2ac1632188de1aa06f1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">kaldi::nnet3::HasContiguousProperty</a></div><div class="ttdeci">bool HasContiguousProperty(const std::vector&lt; int32 &gt; &amp;indexes, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *reverse_indexes)</div><div class="ttdoc">This function returns true if for each integer i != -1, all the indexes j at which indexes[j] == i ar...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00556">nnet-compile-utils.cc:556</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a20fc772c3b6789c79c61e1e389aebe46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20fc772c3b6789c79c61e1e389aebe46">&#9670;&nbsp;</a></span>CompileBackwardFromSubmatLocations()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileBackwardFromSubmatLocations </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>deriv_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>submat_locations</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00887">887</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l00939">Compiler::CompileBackwardFromIndexes()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00377">kaldi::nnet3::ConvertToIndexes()</a>, <a class="el" href="nnet-computation_8h_source.html#l00425">NnetComputation::indexes_multi</a>, <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kaldi::nnet3::kAddToRowsMulti</a>, and <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00818">Compiler::CompileBackwardFromSubmatLocationsList()</a>.</p>
<div class="fragment"><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                        {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">// This function creates a command to handle an individual piece of the</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="comment">// Descriptor, for backprop.  Note: because the backprop case is a little</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="comment">// trickier to implement efficiently on the GPU, there may be cases</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="comment">// which we will refuse to implement backprop for if we get here.</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  int32 first_value;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  std::vector&lt;int32&gt; second_values;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">ConvertToIndexes</a>(submat_locations, &amp;first_value,</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                       &amp;second_values)) {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    int32 input_deriv_submatrix_index = first_value;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a8ac504a97b8b617b3bd4658f6dc552f5">CompileBackwardFromIndexes</a>(deriv_submatrix_index,</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                               input_deriv_submatrix_index,</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                               alpha,</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                               second_values,</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                               computation);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="comment">// There are multiple source matrices.</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; submat_locations_sorted;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    std::sort(submat_locations_sorted.begin(), submat_locations_sorted.end());</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(submat_locations_sorted)) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="comment">// There are no repeats in any of the submat locations.  This means that</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="comment">// we can just use kAddToRowsMulti (i.e. AddToRows with pointer</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="comment">// destination).  If there were repeats, the CUDA kernel would require</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="comment">// special synchronization so we don&#39;t allow it.</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      int32 indexes_multi_index = computation-&gt;indexes_multi.size();</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      computation-&gt;indexes_multi.push_back(submat_locations);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      computation-&gt;commands.push_back(</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;          NnetComputation::Command(alpha,</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                   <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>,</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                   deriv_submatrix_index,</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                   indexes_multi_index));</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    }</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">// If you reach this point, there is a case that wasn&#39;t handled.  Our</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="comment">// intended strategy to handle it, if it&#39;s ever needed, is to create a</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="comment">// temporary matrix consisting of all the unique submat_locations in the</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="comment">// input.  We would first recurse to CompileBackwardFromIndexes, and</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">// let it write to this temporary matrix; and then do the kAddToRowsMulti</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="comment">// command as above to go from the temporary matrix to the multiple</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">// matrices.</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;This case not handled.&quot;</span>;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  }</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ae99488174e8dde27f8f30d91d61c0cd2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">kaldi::nnet3::ConvertToIndexes</a></div><div class="ttdeci">bool ConvertToIndexes(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;location_vector, int32 *first_value, std::vector&lt; int32 &gt; *second_values)</div><div class="ttdoc">If it is the case for some i &gt;= 0 that all the .first elements of &quot;location_vector&quot; are either i or -...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00377">nnet-compile-utils.cc:377</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a8ac504a97b8b617b3bd4658f6dc552f5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a8ac504a97b8b617b3bd4658f6dc552f5">kaldi::nnet3::Compiler::CompileBackwardFromIndexes</a></div><div class="ttdeci">void CompileBackwardFromIndexes(int32 deriv_submatrix_index, int32 input_deriv_submatrix_index, BaseFloat alpha, const std::vector&lt; int32 &gt; &amp;indexes, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00939">nnet-compile.cc:939</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a10860d51f72b88d5efe8e6f31e3db651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10860d51f72b88d5efe8e6f31e3db651">&#9670;&nbsp;</a></span>CompileBackwardFromSubmatLocationsList()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileBackwardFromSubmatLocationsList </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>deriv_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>submat_locations</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00818">818</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l00887">Compiler::CompileBackwardFromSubmatLocations()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet-compile-utils_8cc_source.html#l00498">kaldi::nnet3::SplitLocationsBackward()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00835">Compiler::CompileBackwardSumDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                                        {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; split_lists;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a230b979419515f453ee5c8f2bc87a4dd">SplitLocationsBackward</a>(submat_lists, &amp;split_lists);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  int32 size = split_lists.size();  <span class="comment">// size may be zero e.g. for unused outputs.</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a20fc772c3b6789c79c61e1e389aebe46">CompileBackwardFromSubmatLocations</a>(</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        deriv_submatrix_index,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        alpha,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        computation);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a20fc772c3b6789c79c61e1e389aebe46"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a20fc772c3b6789c79c61e1e389aebe46">kaldi::nnet3::Compiler::CompileBackwardFromSubmatLocations</a></div><div class="ttdeci">void CompileBackwardFromSubmatLocations(int32 deriv_submatrix_index, BaseFloat alpha, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;submat_locations, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00887">nnet-compile.cc:887</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a230b979419515f453ee5c8f2bc87a4dd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a230b979419515f453ee5c8f2bc87a4dd">kaldi::nnet3::SplitLocationsBackward</a></div><div class="ttdeci">void SplitLocationsBackward(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</div><div class="ttdoc">This function has the same interface as SplitLocations(); however, it ensures certain additional prop...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00498">nnet-compile-utils.cc:498</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a53bff987650200afc535f874ba0b064d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53bff987650200afc535f874ba0b064d">&#9670;&nbsp;</a></span>CompileBackwardSumDescriptor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileBackwardSumDescriptor </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>part_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00835">835</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l00818">Compiler::CompileBackwardFromSubmatLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00531">Compiler::ComputeDerivSubmatLocationsList()</a>, <a class="el" href="nnet-compile_8h_source.html#l00100">Compiler::StepInfo::deriv_parts</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00084">NetworkNode::descriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-compile_8h_source.html#l00108">Compiler::StepInfo::input_locations_list</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00572">Descriptor::Part()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00557">Compiler::SplitByScale()</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01029">Compiler::CompileBackwardDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                                                                      {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  int32 deriv_submatrix_index = step_info.deriv_parts[part_index];</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_submatrix_index &gt; 0);  <span class="comment">// or should not have called this.</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="keyword">const</span> SumDescriptor &amp;descriptor =</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(step_info.node_index).<a class="code" href="structkaldi_1_1nnet3_1_1NetworkNode.html#adb7a941ad767dbe68f14fd44169a47e5">descriptor</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#a52c269dc9630c51a05c6e0c36e439fd6">Part</a>(part_index);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// Note: `offset_term` appeared in the forward computation here but does not</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">// come into the backward computation.</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="comment">// `input_locations_list` is a vector indexed by row-index, with each element</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">// being a list of pairs (step, row_index) representing terms in a weighted</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">// sum.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::vector&lt;std::pair&lt;int32,int32&gt; &gt; &gt;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      &amp;input_locations_list = step_info.input_locations_list[part_index];</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="comment">// `split_locations_lists` is a vector of pairs `(alpha, locations_list)`</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">// where alpha is the scale in which these items appear in the</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">// summation and `locations_list` is the same format as `input_locations_list`</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  std::vector&lt;std::pair&lt;<a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>,</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;   std::vector&lt;std::vector&lt;std::pair&lt;int32,int32&gt; &gt; &gt; &gt; &gt; split_locations_lists;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  BaseFloat shared_alpha = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a5777e533fbbccce21952a60cc3312b4a">SplitByScale</a>(descriptor, input_locations_list,</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                                 &amp;split_locations_lists);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordflow">if</span> (shared_alpha - shared_alpha == 0.0) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="comment">// If the returned value &#39;shared_alpha&#39; is finite, this indicates that there</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// was no need to split up &#39;input_locations_list&#39; because all the alpha</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">// values (scales) were the same.  We treat this case specially for</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="comment">// efficiency reasons; this branch will be the most common branch.</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; submat_locations_list;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#aec7c771a53dc46a920e4f887ba671edf">ComputeDerivSubmatLocationsList</a>(input_locations_list,</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                                    &amp;submat_locations_list);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a10860d51f72b88d5efe8e6f31e3db651">CompileBackwardFromSubmatLocationsList</a>(deriv_submatrix_index,</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                           shared_alpha,</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                                           submat_locations_list,</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                           computation);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_locations_lists.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      BaseFloat this_alpha = split_locations_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(this_alpha - this_alpha == 0.0);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; submat_locations_list;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#aec7c771a53dc46a920e4f887ba671edf">ComputeDerivSubmatLocationsList</a>(split_locations_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second,</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                      &amp;submat_locations_list);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a10860d51f72b88d5efe8e6f31e3db651">CompileBackwardFromSubmatLocationsList</a>(deriv_submatrix_index,</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                                             this_alpha,</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                                             submat_locations_list,</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                             computation);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a5777e533fbbccce21952a60cc3312b4a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a5777e533fbbccce21952a60cc3312b4a">kaldi::nnet3::Compiler::SplitByScale</a></div><div class="ttdeci">BaseFloat SplitByScale(const SumDescriptor &amp;descriptor, const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;input_locations_list, std::vector&lt; std::pair&lt; BaseFloat, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &gt; &gt; *split_locations_lists) const</div><div class="ttdoc">This function helps to handle scalar factors in Descriptors (expressions like `Scale(-1.0, &lt;descriptor)`). </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00557">nnet-compile.cc:557</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a10860d51f72b88d5efe8e6f31e3db651"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a10860d51f72b88d5efe8e6f31e3db651">kaldi::nnet3::Compiler::CompileBackwardFromSubmatLocationsList</a></div><div class="ttdeci">void CompileBackwardFromSubmatLocationsList(int32 deriv_submatrix_index, BaseFloat alpha, const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_locations, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00818">nnet-compile.cc:818</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html_a52c269dc9630c51a05c6e0c36e439fd6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html#a52c269dc9630c51a05c6e0c36e439fd6">kaldi::nnet3::Descriptor::Part</a></div><div class="ttdeci">const SumDescriptor &amp; Part(int32 n) const</div><div class="ttdoc">returns the n&amp;#39;th part. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00572">nnet-descriptor.cc:572</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_aec7c771a53dc46a920e4f887ba671edf"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#aec7c771a53dc46a920e4f887ba671edf">kaldi::nnet3::Compiler::ComputeDerivSubmatLocationsList</a></div><div class="ttdeci">void ComputeDerivSubmatLocationsList(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;input_locations_list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *submat_locations_list) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00531">nnet-compile.cc:531</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NetworkNode_html_adb7a941ad767dbe68f14fd44169a47e5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NetworkNode.html#adb7a941ad767dbe68f14fd44169a47e5">kaldi::nnet3::NetworkNode::descriptor</a></div><div class="ttdeci">Descriptor descriptor</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00084">nnet-nnet.h:84</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27b3a3bed171a1668597f5ed9784ee26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27b3a3bed171a1668597f5ed9784ee26">&#9670;&nbsp;</a></span>CompileForward()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileForward </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00406">406</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l01097">Compiler::AddForwardStepComponent()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01080">Compiler::AddForwardStepInput()</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l00432">Compiler::CompileForwardDescriptor()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00397">Compiler::IsInputStep()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kDescriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kDimRange</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationPermanent</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                                                        {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(step &lt; static_cast&lt;int32&gt;(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size()));</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(step_info.node_index);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">switch</span> (node.node_type) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a>:  <span class="comment">// Note: input nodes appear before other node types.</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a5aba4c5309356cf4e0c06b615f4019f9">AddForwardStepInput</a>(step, computation);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a7182453a66397f21a9cbb9f33ff1f6ff">IsInputStep</a>(step + 1))  <span class="comment">// Make sure forward computation is nonempty.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        computation-&gt;commands.push_back(</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            NnetComputation::Command(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>));</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kDimRange</a>: <span class="keywordflow">break</span>;  <span class="comment">// Nothing to do.</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>:</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6463ed0a053c729473149580d518c1b8">AddForwardStepComponent</a>(step, computation);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>:</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e16f71721f026c39566bf601a91ae9d">CompileForwardDescriptor</a>(step, computation);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Invalid node type&quot;</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a5aba4c5309356cf4e0c06b615f4019f9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a5aba4c5309356cf4e0c06b615f4019f9">kaldi::nnet3::Compiler::AddForwardStepInput</a></div><div class="ttdeci">void AddForwardStepInput(int32 step, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01080">nnet-compile.cc:1080</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6e16f71721f026c39566bf601a91ae9d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6e16f71721f026c39566bf601a91ae9d">kaldi::nnet3::Compiler::CompileForwardDescriptor</a></div><div class="ttdeci">void CompileForwardDescriptor(int32 step, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00432">nnet-compile.cc:432</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kaldi::nnet3::kDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a7182453a66397f21a9cbb9f33ff1f6ff"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a7182453a66397f21a9cbb9f33ff1f6ff">kaldi::nnet3::Compiler::IsInputStep</a></div><div class="ttdeci">bool IsInputStep(int32 step) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00397">nnet-compile.cc:397</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kaldi::nnet3::kDimRange</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6463ed0a053c729473149580d518c1b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6463ed0a053c729473149580d518c1b8">kaldi::nnet3::Compiler::AddForwardStepComponent</a></div><div class="ttdeci">void AddForwardStepComponent(int32 step, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01097">nnet-compile.cc:1097</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e16f71721f026c39566bf601a91ae9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e16f71721f026c39566bf601a91ae9d">&#9670;&nbsp;</a></span>CompileForwardDescriptor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileForwardDescriptor </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00432">432</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l00676">Compiler::CompileForwardSumDescriptor()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00975">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kaldi::nnet3::kProvideOutput</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, and <a class="el" href="nnet-compile_8h_source.html#l00073">Compiler::StepInfo::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00406">Compiler::CompileForward()</a>.</p>
<div class="fragment"><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                                    {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  int32 num_parts = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step].value_parts.size();</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">for</span> (int32 part = 0; part &lt; num_parts; part++)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a4569ec9a6f0b9e96e784ed05116df490">CompileForwardSumDescriptor</a>(step, part, computation);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">IsOutputNode</a>(step_info.node_index)) {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">// If the node is an output then we need to add commands to provide the</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// output to the user, and possibly to get derivatives w.r.t. the output</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// from the user.</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    int32 node_index = step_info.node_index,</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        submatrix_index = step_info.value;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation-&gt;IsWholeMatrix(submatrix_index));</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    NnetComputation::Command c(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>, submatrix_index, node_index);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    computation-&gt;commands.push_back(c);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a6c50812e1be80ab06573493276ec2ca5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">kaldi::nnet3::Nnet::IsOutputNode</a></div><div class="ttdeci">bool IsOutputNode(int32 node) const</div><div class="ttdoc">Returns true if this is an output node, meaning that it is of type kDescriptor and is not directly fo...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00112">nnet-nnet.cc:112</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a4569ec9a6f0b9e96e784ed05116df490"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a4569ec9a6f0b9e96e784ed05116df490">kaldi::nnet3::Compiler::CompileForwardSumDescriptor</a></div><div class="ttdeci">void CompileForwardSumDescriptor(int32 step, int32 part_index, NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00676">nnet-compile.cc:676</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af97c4b9a86c640730eed16c354d8fa54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af97c4b9a86c640730eed16c354d8fa54">&#9670;&nbsp;</a></span>CompileForwardFromIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileForwardFromIndexes </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>value_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds to `computation` a command that adds to the submatrix in `value_submatrix_index` a quantity consisting of alpha times the submatrix in `input_submatrix_index`, with a row mapping given by `indexes`. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00738">738</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00419">NnetComputation::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kAddRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kMatrixAdd</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00772">Compiler::CompileForwardFromSubmatLocations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                        {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  int32 input_num_rows =</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      computation-&gt;submatrices[input_submatrix_index].num_rows,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      num_rows = indexes.size();</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordflow">if</span> (input_num_rows == num_rows) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; num_rows; i++)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="keywordflow">if</span> (indexes[i] != i)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span> (i == num_rows) {  <span class="comment">// Simplest case: just matrix addition.</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      computation-&gt;commands.push_back(</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          NnetComputation::Command(alpha, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>,</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                                   value_submatrix_index,</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                                   input_submatrix_index));</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="comment">// if we got to here, it&#39;s not just a case of matrix-copy or matrix-add,</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="comment">// but it&#39;s still from a single source matrix.</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  int32 indexes_index = computation-&gt;indexes.size();</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  computation-&gt;indexes.push_back(indexes);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  computation-&gt;commands.push_back(</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      NnetComputation::Command(alpha, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>, value_submatrix_index,</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                               input_submatrix_index, indexes_index));</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae97890913f3402626e8d118e77ac8f0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae97890913f3402626e8d118e77ac8f0e">&#9670;&nbsp;</a></span>CompileForwardFromSubmatLocations()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileForwardFromSubmatLocations </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>value_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>submat_locations</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds to 'computation' commands for part of the forward computation corresponding to a <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>. </p>
<p>This is called from CompileForwardFromSubmatLocationsList.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">value_submatrix_index</td><td>The submatrix index of the quanitity we are computing (part of a <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>; it's something like Sum(tdnn1, tdnn2) in general). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alpha</td><td>The scale (1.0 unless Scale(...) expressions are involved in descriptors) with which these terms are present in the summation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">submat_locations</td><td>Indexed by the row index corresponding to the rows of the submatrix referred to by 'value_submatrix_index', this reprenents the source vector which we are adding to this row, in the format (submatrix-index, row-index), or (-1, -1) if in this case there is nothing to add. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">computation</td><td>The computation which we are adding commands to. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00772">772</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l00738">Compiler::CompileForwardFromIndexes()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00377">kaldi::nnet3::ConvertToIndexes()</a>, <a class="el" href="nnet-computation_8h_source.html#l00425">NnetComputation::indexes_multi</a>, and <a class="el" href="nnet-computation_8h_source.html#l00292">kaldi::nnet3::kAddRowsMulti</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00799">Compiler::CompileForwardFromSubmatLocationsList()</a>.</p>
<div class="fragment"><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                        {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  int32 input_submatrix_index = -1;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  std::vector&lt;int32&gt; indexes;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">ConvertToIndexes</a>(submat_locations, &amp;input_submatrix_index, &amp;indexes)) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#af97c4b9a86c640730eed16c354d8fa54">CompileForwardFromIndexes</a>(value_submatrix_index,</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                              input_submatrix_index,</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                              alpha,</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                              indexes,</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                              computation);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">// There are multiple source matrices.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    int32 indexes_multi_index = computation-&gt;indexes_multi.size();</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    computation-&gt;indexes_multi.push_back(submat_locations);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    computation-&gt;commands.push_back(</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        NnetComputation::Command(alpha, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>,</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                                 value_submatrix_index,</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                                 indexes_multi_index));</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ae99488174e8dde27f8f30d91d61c0cd2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">kaldi::nnet3::ConvertToIndexes</a></div><div class="ttdeci">bool ConvertToIndexes(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;location_vector, int32 *first_value, std::vector&lt; int32 &gt; *second_values)</div><div class="ttdoc">If it is the case for some i &gt;= 0 that all the .first elements of &quot;location_vector&quot; are either i or -...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00377">nnet-compile-utils.cc:377</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_af97c4b9a86c640730eed16c354d8fa54"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#af97c4b9a86c640730eed16c354d8fa54">kaldi::nnet3::Compiler::CompileForwardFromIndexes</a></div><div class="ttdeci">void CompileForwardFromIndexes(int32 value_submatrix_index, int32 input_submatrix_index, BaseFloat alpha, const std::vector&lt; int32 &gt; &amp;indexes, NnetComputation *computation) const</div><div class="ttdoc">Adds to `computation` a command that adds to the submatrix in `value_submatrix_index` a quantity cons...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00738">nnet-compile.cc:738</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a00d90f19cbb7852a8fbbe66f91f62e79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00d90f19cbb7852a8fbbe66f91f62e79">&#9670;&nbsp;</a></span>CompileForwardFromSubmatLocationsList()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileForwardFromSubmatLocationsList </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>value_submatrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>submat_locations</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds to 'computation' commands for part of the forward computation corresponding to a <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>. </p>
<p>This is called from CompileForwardSumDescriptor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">value_submatrix_index</td><td>The submatrix index of the quanitity we are computing (part of a <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>; it's something like Sum(tdnn1, tdnn2) in general). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alpha</td><td>The scale (1.0 unless Scale(...) expressions are involved in descriptors) with which these terms are present in the summation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">submat_locations</td><td>Indexed by the row index of the submatrix referred to by 'value_submatrix_index', each element is a list of sources over which we must sum to obtain that row. Each source is a pair (submatrix-index, row-index). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00799">799</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l00772">Compiler::CompileForwardFromSubmatLocations()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet-compile-utils_8cc_source.html#l00337">kaldi::nnet3::SplitLocations()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00676">Compiler::CompileForwardSumDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                                        {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; split_lists;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8">SplitLocations</a>(submat_lists, &amp;split_lists);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  int32 size = split_lists.size();</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">// note: `size` may be empty in unusual cases so don&#39;t assert that it&#39;s</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">// nonzero.</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#ae97890913f3402626e8d118e77ac8f0e">CompileForwardFromSubmatLocations</a>(</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        value_submatrix_index,</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        alpha,</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        computation);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_ae97890913f3402626e8d118e77ac8f0e"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#ae97890913f3402626e8d118e77ac8f0e">kaldi::nnet3::Compiler::CompileForwardFromSubmatLocations</a></div><div class="ttdeci">void CompileForwardFromSubmatLocations(int32 value_submatrix_index, BaseFloat alpha, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;submat_locations, NnetComputation *computation) const</div><div class="ttdoc">Adds to &amp;#39;computation&amp;#39; commands for part of the forward computation corresponding to a Descriptor...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00772">nnet-compile.cc:772</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7c81548b4f8146cd3447b10d556978a8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8">kaldi::nnet3::SplitLocations</a></div><div class="ttdeci">void SplitLocations(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</div><div class="ttdoc">The input to this function is a vector of lists of pairs, and this function splits it up into a list ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00337">nnet-compile-utils.cc:337</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4569ec9a6f0b9e96e784ed05116df490"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4569ec9a6f0b9e96e784ed05116df490">&#9670;&nbsp;</a></span>CompileForwardSumDescriptor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CompileForwardSumDescriptor </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>part_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00676">676</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l00799">Compiler::CompileForwardFromSubmatLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00503">Compiler::ComputeValueSubmatLocationsList()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00084">NetworkNode::descriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html#a0337b219e3aecb3a60c8261820ace1c2">SumDescriptor::GetScaleForNode()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-compile_8h_source.html#l00108">Compiler::StepInfo::input_locations_list</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kSetConst</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00572">Descriptor::Part()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00557">Compiler::SplitByScale()</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, and <a class="el" href="nnet-compile_8h_source.html#l00097">Compiler::StepInfo::value_parts</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00432">Compiler::CompileForwardDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                                                      {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  int32 value_submatrix_index = step_info.value_parts[part_index];</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keyword">const</span> SumDescriptor &amp;descriptor =</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(step_info.node_index).<a class="code" href="structkaldi_1_1nnet3_1_1NetworkNode.html#adb7a941ad767dbe68f14fd44169a47e5">descriptor</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#a52c269dc9630c51a05c6e0c36e439fd6">Part</a>(part_index);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> offset_term = descriptor.GetScaleForNode(-1);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">if</span> (offset_term != 0.0) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    computation-&gt;commands.push_back(</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        NnetComputation::Command(offset_term, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>,</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                 value_submatrix_index));</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">// if offset_term == 0.0 there&#39;s no need to do this, because</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// we zeroed the matrix when we allocated it; search in this</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// file for kSetConst to see the code.  If we are redundantly</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// setting the value, this will later be optimized out (in the</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">// common cases).</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="comment">// `input_locations_list` is a vector indexed by row-index, with each element</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">// being a list of pairs (step, row_index) representing terms in a weighted</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// sum.</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::vector&lt;std::pair&lt;int32,int32&gt; &gt; &gt;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      &amp;input_locations_list = step_info.input_locations_list[part_index];</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="comment">// `split_locations_lists` is a vector of pairs `(alpha, locations_list)`</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="comment">// where alpha is the scale in which these items appear in the</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="comment">// summation and `locations_list` is the same format as `input_locations_list`</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  std::vector&lt;std::pair&lt;<a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>,</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;   std::vector&lt;std::vector&lt;std::pair&lt;int32,int32&gt; &gt; &gt; &gt; &gt; split_locations_lists;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  BaseFloat shared_alpha = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a5777e533fbbccce21952a60cc3312b4a">SplitByScale</a>(descriptor, input_locations_list,</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                 &amp;split_locations_lists);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordflow">if</span> (shared_alpha - shared_alpha == 0.0) {</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// If the returned value &#39;shared_alpha&#39; is finite, this indicates that there was no</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">// need to split up &#39;input_locations_list&#39; because all the alpha values</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// (scales) were the same.  We treat this case specially for efficiency</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// reasons; this branch will be the most common branch.</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; submat_locations_list;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#aee3c7011e653ea46c0e2081c1eabdc7f">ComputeValueSubmatLocationsList</a>(input_locations_list,</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                                    &amp;submat_locations_list);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a00d90f19cbb7852a8fbbe66f91f62e79">CompileForwardFromSubmatLocationsList</a>(</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        value_submatrix_index,</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        shared_alpha,</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        submat_locations_list,</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        computation);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_locations_lists.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      BaseFloat this_alpha = split_locations_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(this_alpha - this_alpha == 0.0);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; submat_locations_list;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#aee3c7011e653ea46c0e2081c1eabdc7f">ComputeValueSubmatLocationsList</a>(split_locations_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                      &amp;submat_locations_list);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a00d90f19cbb7852a8fbbe66f91f62e79">CompileForwardFromSubmatLocationsList</a>(</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        value_submatrix_index,</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        this_alpha,</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        submat_locations_list,</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        computation);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a5777e533fbbccce21952a60cc3312b4a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a5777e533fbbccce21952a60cc3312b4a">kaldi::nnet3::Compiler::SplitByScale</a></div><div class="ttdeci">BaseFloat SplitByScale(const SumDescriptor &amp;descriptor, const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;input_locations_list, std::vector&lt; std::pair&lt; BaseFloat, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &gt; &gt; *split_locations_lists) const</div><div class="ttdoc">This function helps to handle scalar factors in Descriptors (expressions like `Scale(-1.0, &lt;descriptor)`). </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00557">nnet-compile.cc:557</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a00d90f19cbb7852a8fbbe66f91f62e79"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a00d90f19cbb7852a8fbbe66f91f62e79">kaldi::nnet3::Compiler::CompileForwardFromSubmatLocationsList</a></div><div class="ttdeci">void CompileForwardFromSubmatLocationsList(int32 value_submatrix_index, BaseFloat alpha, const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_locations, NnetComputation *computation) const</div><div class="ttdoc">Adds to &amp;#39;computation&amp;#39; commands for part of the forward computation corresponding to a Descriptor...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00799">nnet-compile.cc:799</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html_a52c269dc9630c51a05c6e0c36e439fd6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html#a52c269dc9630c51a05c6e0c36e439fd6">kaldi::nnet3::Descriptor::Part</a></div><div class="ttdeci">const SumDescriptor &amp; Part(int32 n) const</div><div class="ttdoc">returns the n&amp;#39;th part. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00572">nnet-descriptor.cc:572</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_aee3c7011e653ea46c0e2081c1eabdc7f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#aee3c7011e653ea46c0e2081c1eabdc7f">kaldi::nnet3::Compiler::ComputeValueSubmatLocationsList</a></div><div class="ttdeci">void ComputeValueSubmatLocationsList(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;input_locations_list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *submat_locations_list) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00503">nnet-compile.cc:503</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NetworkNode_html_adb7a941ad767dbe68f14fd44169a47e5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NetworkNode.html#adb7a941ad767dbe68f14fd44169a47e5">kaldi::nnet3::NetworkNode::descriptor</a></div><div class="ttdeci">Descriptor descriptor</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00084">nnet-nnet.h:84</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af5001f10346116df587c511fdf6d37c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5001f10346116df587c511fdf6d37c1">&#9670;&nbsp;</a></span>ComputeDerivNeeded()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeDerivNeeded </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>steps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>step_to_segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; *&#160;</td>
          <td class="paramname"><em>deriv_needed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00176">176</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation-graph_8h_source.html#l00046">ComputationGraph::cindexes</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00087">NetworkNode::component_index</a>, <a class="el" href="nnet-compile_8cc_source.html#l00142">Compiler::ComputeStepDependencies()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00063">Nnet::GetNodeNames()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="nnet-compile_8h_source.html#l00064">Compiler::graph_</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8cc_source.html#l00054">ComputationRequest::IndexForInput()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00066">ComputationRequest::IndexForOutput()</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00055">ComputationGraph::is_input</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00132">Nnet::IsComponentNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kaldi::nnet3::kUpdatableComponent</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00505">UpdatableComponent::LearningRate()</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>, and <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                   {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(steps.size() == step_to_segment.size() &amp;&amp;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;               step_to_segment[0] == 0 &amp;&amp;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;               step_to_segment.back() + 1 == <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>.size());</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  deriv_needed-&gt;clear();</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  int32 num_steps = steps.size();</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  deriv_needed-&gt;resize(num_steps, <span class="keyword">false</span>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">for</span> (int32 step = 0; step &lt; num_steps; step++) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;this_step = steps[step];</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (this_step.empty())  <span class="comment">// empty steps are theoretically possible, e.g.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">continue</span>;             <span class="comment">// if a non-simple Component requires no input.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    int32 cindex_id = this_step[0];</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    int32 node_index = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">cindexes</a>[cindex_id].first;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">bool</span> is_input = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a7038fa9813a5d2c15c5c8a33dcc2ca9b">is_input</a>[cindex_id];</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    std::string node_name = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#ad535f900dadd2cbd357d0b6382a9bff6">GetNodeNames</a>()[node_index];</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    unordered_set&lt;int32&gt; input_steps;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a65f01265f204617cc7b138d9d8b8bc5e">ComputeStepDependencies</a>(this_step, step, &amp;input_steps);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    unordered_set&lt;int32&gt;::iterator iter = input_steps.begin(),</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        end = input_steps.end();</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// if some step that we depend on needs a derivative, we need the derivative.</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      int32 dep_step = *iter;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dep_step &lt; step);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">if</span> ((*deriv_needed)[dep_step])</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        (*deriv_needed)[step] = <span class="keyword">true</span>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// if this step is an input and the user requested the derivative w.r.t. that</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// input, we need the derivative.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keyword">const</span> ComputationRequest &amp;request = *(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[step_to_segment[step]]);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (is_input) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      int32 input_index = request.IndexForInput(node_name);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_index != -1);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span> (request.inputs[input_index].has_deriv)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        (*deriv_needed)[step] = <span class="keyword">true</span>;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// if this step is an output and the user is providing the derivative w.r.t. that</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// output, we need a place to store the derivative, so we set (*deriv_needed) to</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// true.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">IsOutputNode</a>(node_index)) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      int32 output_index = request.IndexForOutput(node_name);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_index != -1);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">if</span> (request.outputs[output_index].has_deriv)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        (*deriv_needed)[step] = <span class="keyword">true</span>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// If this is an updatable Component node with a nonzero learning rate and</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// the user requested model derivatives (e.g. during training), we need this</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">// step&#39;s derivative.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a9167816d5d30fa49f76019d83cf6d652">IsComponentNode</a>(node_index) &amp;&amp; request.need_model_derivative) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(node_index);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keyword">const</span> Component *c = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(node.u.component_index);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">if</span> (c-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">const</span> UpdatableComponent *u = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(c);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(u != NULL);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">if</span> (u-&gt;LearningRate() != 0)</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          (*deriv_needed)[step] = <span class="keyword">true</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 5) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;deriv_needed = &quot;</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; deriv_needed-&gt;size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      os &lt;&lt; ((*deriv_needed)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] ? <span class="stringliteral">&quot;t&quot;</span> : <span class="stringliteral">&quot;f&quot;</span>);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(5) &lt;&lt; os.str();</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a9167816d5d30fa49f76019d83cf6d652"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a9167816d5d30fa49f76019d83cf6d652">kaldi::nnet3::Nnet::IsComponentNode</a></div><div class="ttdeci">bool IsComponentNode(int32 node) const</div><div class="ttdoc">Returns true if this is a component node, meaning that it is of type kComponent. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00132">nnet-nnet.cc:132</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6e772505e8a0fc7ead243347658e8d19"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">kaldi::nnet3::Compiler::graph_</a></div><div class="ttdeci">ComputationGraph graph_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00064">nnet-compile.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_a297d5616d3920cb01d699e7a0e4d2a67"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">kaldi::nnet3::ComputationGraph::cindexes</a></div><div class="ttdeci">std::vector&lt; Cindex &gt; cindexes</div><div class="ttdoc">The mapping of cindex_id to Cindex. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8h_source.html#l00046">nnet-computation-graph.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a6c50812e1be80ab06573493276ec2ca5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">kaldi::nnet3::Nnet::IsOutputNode</a></div><div class="ttdeci">bool IsOutputNode(int32 node) const</div><div class="ttdoc">Returns true if this is an output node, meaning that it is of type kDescriptor and is not directly fo...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00112">nnet-nnet.cc:112</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_a7038fa9813a5d2c15c5c8a33dcc2ca9b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a7038fa9813a5d2c15c5c8a33dcc2ca9b">kaldi::nnet3::ComputationGraph::is_input</a></div><div class="ttdeci">std::vector&lt; bool &gt; is_input</div><div class="ttdoc">For each Cindex this tells us whether it was provided as an input to the network. ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8h_source.html#l00055">nnet-computation-graph.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a65f01265f204617cc7b138d9d8b8bc5e"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a65f01265f204617cc7b138d9d8b8bc5e">kaldi::nnet3::Compiler::ComputeStepDependencies</a></div><div class="ttdeci">void ComputeStepDependencies(const std::vector&lt; int32 &gt; &amp;this_step, int32 step_index, unordered_set&lt; int32 &gt; *dep_steps)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00142">nnet-compile.cc:142</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_ad535f900dadd2cbd357d0b6382a9bff6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#ad535f900dadd2cbd357d0b6382a9bff6">kaldi::nnet3::Nnet::GetNodeNames</a></div><div class="ttdeci">const std::vector&lt; std::string &gt; &amp; GetNodeNames() const</div><div class="ttdoc">returns vector of node names (needed by some parsing code, for instance). </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00063">nnet-nnet.cc:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aec7c771a53dc46a920e4f887ba671edf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec7c771a53dc46a920e4f887ba671edf">&#9670;&nbsp;</a></span>ComputeDerivSubmatLocationsList()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeDerivSubmatLocationsList </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_locations_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>submat_locations_list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00531">531</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00835">Compiler::CompileBackwardSumDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  submat_locations_list-&gt;clear();</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  submat_locations_list-&gt;resize(input_locations_list.size());</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  int32 size = submat_locations_list-&gt;size();</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;this_list = input_locations_list[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;this_submat_list = (*submat_locations_list)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    this_submat_list.reserve(this_list.size());</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::const_iterator</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        input_iter = this_list.begin(), input_end = this_list.end();</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">for</span> (; input_iter != input_end; ++input_iter) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      int32 step = input_iter-&gt;first,</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          deriv_submat_index = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step].deriv,</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;          row = input_iter-&gt;second;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">if</span> (deriv_submat_index &gt; 0)</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        this_submat_list.push_back(std::pair&lt;int32,int32&gt;(deriv_submat_index,</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                                          row));</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  }</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a77c85c33bcf54ec797f1bd578bade7b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77c85c33bcf54ec797f1bd578bade7b8">&#9670;&nbsp;</a></span>ComputeInputLocationsList()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeInputLocationsList </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>part_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>input_locations</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00457">457</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8h_source.html#l00161">Compiler::cindex_id_to_location_</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00084">NetworkNode::descriptor</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00028">ComputationGraph::GetCindexId()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-compile_8h_source.html#l00064">Compiler::graph_</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html#aef13aa43e8fb467383121c9d7b71ff1a">SumDescriptor::IsComputable()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-common_8cc_source.html#l00573">kaldi::nnet3::kNoTime</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00572">Descriptor::Part()</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, and <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00279">Compiler::CreateStepInfo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(step) &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size());</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;output_indexes = step_info.output_indexes;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(step_info.node_index);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keyword">const</span> SumDescriptor &amp;descriptor = node.<a class="code" href="structkaldi_1_1nnet3_1_1NetworkNode.html#adb7a941ad767dbe68f14fd44169a47e5">descriptor</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#a52c269dc9630c51a05c6e0c36e439fd6">Part</a>(part_index);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  int32 num_indexes = output_indexes.size();</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  submat_locations_list-&gt;clear();</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  submat_locations_list-&gt;resize(num_indexes);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_indexes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keyword">const</span> Index &amp;index = output_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;this_locations_list =</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        (*submat_locations_list)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span> (index.t != <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="comment">// a real Index, not a &#39;blank&#39; one</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">// (&#39;blank&#39; indexes are inserted by some non-simple Components to</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="comment">// satisfy internal constraints.</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      std::vector&lt;int32&gt; input_cindex_ids;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      std::vector&lt;Cindex&gt; input_cindexes;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      CindexSet cindex_set(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordtype">bool</span> ans = descriptor.IsComputable(index, cindex_set, &amp;input_cindexes);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="comment">// earlier compilation stages should have checked that it is computable,</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="comment">// and the graph should still contain required inputs.</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      std::sort(input_cindexes.begin(), input_cindexes.end());</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      int32 size = input_cindexes.size();</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      input_cindex_ids.resize(size);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; size; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        int32 c = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a5e1647c5b37c6759f88249b823cc90f5">GetCindexId</a>(input_cindexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c != -1);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        input_cindex_ids[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = c;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      this_locations_list.resize(size);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; size; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        this_locations_list[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">cindex_id_to_location_</a>[input_cindex_ids[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]];</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      this_locations_list.clear();</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6e772505e8a0fc7ead243347658e8d19"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">kaldi::nnet3::Compiler::graph_</a></div><div class="ttdeci">ComputationGraph graph_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00064">nnet-compile.h:64</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_a5e1647c5b37c6759f88249b823cc90f5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a5e1647c5b37c6759f88249b823cc90f5">kaldi::nnet3::ComputationGraph::GetCindexId</a></div><div class="ttdeci">int32 GetCindexId(const Cindex &amp;cindex, bool is_input, bool *is_new)</div><div class="ttdoc">Maps a Cindex to an integer cindex_id. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l00028">nnet-computation-graph.cc:28</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html_a52c269dc9630c51a05c6e0c36e439fd6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html#a52c269dc9630c51a05c6e0c36e439fd6">kaldi::nnet3::Descriptor::Part</a></div><div class="ttdeci">const SumDescriptor &amp; Part(int32 n) const</div><div class="ttdoc">returns the n&amp;#39;th part. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00572">nnet-descriptor.cc:572</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NetworkNode_html_adb7a941ad767dbe68f14fd44169a47e5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NetworkNode.html#adb7a941ad767dbe68f14fd44169a47e5">kaldi::nnet3::NetworkNode::descriptor</a></div><div class="ttdeci">Descriptor descriptor</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00084">nnet-nnet.h:84</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a4286f6d7e1ff9117ffc8b1a57ded5efb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">kaldi::nnet3::Compiler::cindex_id_to_location_</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; cindex_id_to_location_</div><div class="ttdoc">This maps each cindex_id to its location. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00161">nnet-compile.h:161</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac952f0840a7950dff80c1a89e69656d7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kaldi::nnet3::kNoTime</a></div><div class="ttdeci">const int kNoTime</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00573">nnet-common.cc:573</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a65f01265f204617cc7b138d9d8b8bc5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65f01265f204617cc7b138d9d8b8bc5e">&#9670;&nbsp;</a></span>ComputeStepDependencies()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeStepDependencies </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>this_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unordered_set&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>dep_steps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00142">142</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8h_source.html#l00161">Compiler::cindex_id_to_location_</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00046">ComputationGraph::cindexes</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00063">ComputationGraph::dependencies</a>, <a class="el" href="nnet-compile_8h_source.html#l00064">Compiler::graph_</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00132">Nnet::IsComponentNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00176">Compiler::ComputeDerivNeeded()</a>.</p>
<div class="fragment"><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                     {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  dep_steps-&gt;clear();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">if</span> (this_step.empty())</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">// steps always have a single node index, we can pick the first.</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  int32 node_index = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">cindexes</a>[this_step[0]].first;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a9167816d5d30fa49f76019d83cf6d652">IsComponentNode</a>(node_index)) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// there is only one step that a component step depends on, and it&#39;s the</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// immediately preceding step (the component-input step).</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(step_index &gt; 0);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    dep_steps-&gt;insert(step_index - 1);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  std::vector&lt;int32&gt;::const_iterator step_iter = this_step.begin(),</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      step_end = this_step.end();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  int32 prev_input_step = -1;  <span class="comment">// this is an optimization for speed.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">for</span> (; step_iter != step_end; ++step_iter) {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    int32 cindex_id = *step_iter;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;dep = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#ac5de41a87e16d0cb72ab76d026525216">dependencies</a>[cindex_id];</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = dep.begin(), end = dep.end();</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      int32 dep_cindex_id = *iter,</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          input_step = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">cindex_id_to_location_</a>[dep_cindex_id].first;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">if</span> (input_step != prev_input_step) {  <span class="comment">// optimization.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        prev_input_step = input_step;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        dep_steps-&gt;insert(input_step);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a9167816d5d30fa49f76019d83cf6d652"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a9167816d5d30fa49f76019d83cf6d652">kaldi::nnet3::Nnet::IsComponentNode</a></div><div class="ttdeci">bool IsComponentNode(int32 node) const</div><div class="ttdoc">Returns true if this is a component node, meaning that it is of type kComponent. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00132">nnet-nnet.cc:132</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6e772505e8a0fc7ead243347658e8d19"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">kaldi::nnet3::Compiler::graph_</a></div><div class="ttdeci">ComputationGraph graph_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00064">nnet-compile.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_a297d5616d3920cb01d699e7a0e4d2a67"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">kaldi::nnet3::ComputationGraph::cindexes</a></div><div class="ttdeci">std::vector&lt; Cindex &gt; cindexes</div><div class="ttdoc">The mapping of cindex_id to Cindex. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8h_source.html#l00046">nnet-computation-graph.h:46</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_ac5de41a87e16d0cb72ab76d026525216"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#ac5de41a87e16d0cb72ab76d026525216">kaldi::nnet3::ComputationGraph::dependencies</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int32 &gt; &gt; dependencies</div><div class="ttdoc">dependencies[cindex_id] gives you the list of other cindex_ids that this particular cindex_id directl...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8h_source.html#l00063">nnet-computation-graph.h:63</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a4286f6d7e1ff9117ffc8b1a57ded5efb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">kaldi::nnet3::Compiler::cindex_id_to_location_</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; cindex_id_to_location_</div><div class="ttdoc">This maps each cindex_id to its location. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00161">nnet-compile.h:161</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aee3c7011e653ea46c0e2081c1eabdc7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee3c7011e653ea46c0e2081c1eabdc7f">&#9670;&nbsp;</a></span>ComputeValueSubmatLocationsList()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeValueSubmatLocationsList </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_locations_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>submat_locations_list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00503">503</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00676">Compiler::CompileForwardSumDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  submat_locations_list-&gt;clear();</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  submat_locations_list-&gt;resize(input_locations_list.size());</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  int32 size = submat_locations_list-&gt;size();</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;this_list =</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        input_locations_list[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;this_submat_list =</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        (*submat_locations_list)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    this_submat_list.resize(this_list.size());</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::const_iterator</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        input_iter = this_list.begin(), input_end = this_list.end();</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::iterator iter =</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        this_submat_list.begin();</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">for</span> (; input_iter != input_end; ++input_iter, ++iter) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      int32 step = input_iter-&gt;first,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;          value_submat_index = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step].value,</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          row = input_iter-&gt;second;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      iter-&gt;first = value_submat_index;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      iter-&gt;second = row;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3ba7e6700716ba8e6dfb85784922001b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ba7e6700716ba8e6dfb85784922001b">&#9670;&nbsp;</a></span>CreateComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CreateComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00050">50</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00298">ComputationGraphBuilder::AllOutputsAreComputable()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l01946">ComputationStepsComputer::Check()</a>, <a class="el" href="nnet-compile_8h_source.html#l00161">Compiler::cindex_id_to_location_</a>, <a class="el" href="nnet-computation_8h_source.html#l00507">NnetComputation::Clear()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00462">ComputationGraphBuilder::Compute()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l01425">kaldi::nnet3::ComputeComputationPhases()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00176">Compiler::ComputeDerivNeeded()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l01554">ComputationStepsComputer::ComputeForSegment()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00869">kaldi::nnet3::ConsolidateIoOperations()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00279">Compiler::CreateStepInfo()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00330">ComputationGraphBuilder::ExplainWhyAllOutputsNotComputable()</a>, <a class="el" href="nnet-compile_8h_source.html#l00064">Compiler::graph_</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00035">CompilerOptions::output_debug_info</a>, <a class="el" href="nnet-compile_8cc_source.html#l01346">Compiler::OutputDebugInfo()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00575">ComputationGraphBuilder::Prune()</a>, and <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00284">kaldi::nnet3::CompileLoopedInternal()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00741">CachingOptimizingCompiler::CompileNoShortcut()</a>, <a class="el" href="nnet-analyze-test_8cc_source.html#l00039">kaldi::nnet3::UnitTestNnetAnalyze()</a>, <a class="el" href="nnet-compile-test_8cc_source.html#l00029">kaldi::nnet3::UnitTestNnetCompile()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">kaldi::nnet3::UnitTestNnetCompute()</a>, and <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">kaldi::nnet3::UnitTestNnetOptimizeWithOptions()</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                                               {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  computation-&gt;Clear();</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  ComputationGraphBuilder builder(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>, &amp;<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// note: there are only &gt;1 segments in a &#39;looped&#39; computation.</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> segment = 0; segment &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>.size(); segment++) {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    builder.Compute(*(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[segment]));</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (!builder.AllOutputsAreComputable()) {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      builder.ExplainWhyAllOutputsNotComputable();  <span class="comment">// prints logging info</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Not all outputs were computable, cannot create computation.&quot;</span>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    builder.Prune();</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// see function declaration&#39;s comment for more on the meaning of &quot;phases&quot; (a</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">// phase will later be decomposed into one or more steps).  for each segment</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">// s, phases_per_segment[s] is a list of phases; each phase is a list of</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// cindex_ids.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  std::vector&lt;std::vector&lt;std::vector&lt;int32&gt; &gt; &gt; phases_per_segment;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2c9e85c299672aa4ef4a0c080d19b3d9">ComputeComputationPhases</a>(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>, <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>, &amp;phases_per_segment);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; steps;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  steps.reserve(1000);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">// maps each step to the segment in which it appears.  in the normal case</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// (non-looped computation), a vector of all zeros.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  std::vector&lt;int32&gt; step_to_segment;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// note: this class will output to &#39;steps&#39; and to &#39;cindex_id_to_location_&#39;.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// it may incidentally change &#39;graph_&#39; by adding a few cindexes.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    ComputationStepsComputer steps_computer(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>, &amp;<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>, &amp;steps,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                            &amp;<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">cindex_id_to_location_</a>);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> segment = 0; segment &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>.size(); segment++) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      steps_computer.ComputeForSegment(*(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[segment]),</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                       phases_per_segment[segment]);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">while</span> (step_to_segment.size() &lt; steps.size())</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        step_to_segment.push_back(segment);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="comment">// save memory, by deleting the phases we just consumed.  the</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="comment">// following two lines just exist to save memory.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      std::vector&lt;std::vector&lt;int32&gt; &gt; temp;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      phases_per_segment[segment].swap(temp);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    steps_computer.Check();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  std::vector&lt;bool&gt; deriv_needed;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#af5001f10346116df587c511fdf6d37c1">ComputeDerivNeeded</a>(steps, step_to_segment, &amp;deriv_needed);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#ac77a6c3ac3e85ee3a02125f13e38e8e2">CreateStepInfo</a>(deriv_needed, step_to_segment, &amp;steps, computation);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a218321cdd5637631bb8fc7b2eee008b3">AddCommands</a>(deriv_needed, step_to_segment, computation);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// the following command reorders commands so kAcceptInput and kProvideOutput</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// appear in the desired places.</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aa6233bfcefa3af15d41a8e565911a249">ConsolidateIoOperations</a>(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>, computation);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">if</span> (opts.output_debug_info)</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a77ed06977b3c1e639e2985ada86c5357">OutputDebugInfo</a>(computation);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa6233bfcefa3af15d41a8e565911a249"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa6233bfcefa3af15d41a8e565911a249">kaldi::nnet3::ConsolidateIoOperations</a></div><div class="ttdeci">void ConsolidateIoOperations(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization puts the input operations (kAcceptInput) and output operations (kProvideOutput) at ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00869">nnet-optimize.cc:869</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_ac77a6c3ac3e85ee3a02125f13e38e8e2"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#ac77a6c3ac3e85ee3a02125f13e38e8e2">kaldi::nnet3::Compiler::CreateStepInfo</a></div><div class="ttdeci">void CreateStepInfo(const std::vector&lt; bool &gt; &amp;deriv_needed, const std::vector&lt; int32 &gt; &amp;step_to_segment, std::vector&lt; std::vector&lt; int32 &gt; &gt; *by_step, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00279">nnet-compile.cc:279</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6e772505e8a0fc7ead243347658e8d19"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">kaldi::nnet3::Compiler::graph_</a></div><div class="ttdeci">ComputationGraph graph_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00064">nnet-compile.h:64</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_af5001f10346116df587c511fdf6d37c1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#af5001f10346116df587c511fdf6d37c1">kaldi::nnet3::Compiler::ComputeDerivNeeded</a></div><div class="ttdeci">void ComputeDerivNeeded(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;steps, const std::vector&lt; int32 &gt; &amp;step_to_segment, std::vector&lt; bool &gt; *deriv_needed)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00176">nnet-compile.cc:176</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2c9e85c299672aa4ef4a0c080d19b3d9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2c9e85c299672aa4ef4a0c080d19b3d9">kaldi::nnet3::ComputeComputationPhases</a></div><div class="ttdeci">void ComputeComputationPhases(const Nnet &amp;nnet, const ComputationGraph &amp;graph, std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; *phases_per_segment)</div><div class="ttdoc">This function divides a computation into &amp;#39;phases&amp;#39;, where a &amp;#39;phase&amp;#39; is a collection of cindexes which ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l01425">nnet-computation-graph.cc:1425</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a77ed06977b3c1e639e2985ada86c5357"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a77ed06977b3c1e639e2985ada86c5357">kaldi::nnet3::Compiler::OutputDebugInfo</a></div><div class="ttdeci">void OutputDebugInfo(NnetComputation *computation) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01346">nnet-compile.cc:1346</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a4286f6d7e1ff9117ffc8b1a57ded5efb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">kaldi::nnet3::Compiler::cindex_id_to_location_</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; cindex_id_to_location_</div><div class="ttdoc">This maps each cindex_id to its location. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00161">nnet-compile.h:161</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a218321cdd5637631bb8fc7b2eee008b3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a218321cdd5637631bb8fc7b2eee008b3">kaldi::nnet3::Compiler::AddCommands</a></div><div class="ttdeci">void AddCommands(const std::vector&lt; bool &gt; &amp;deriv_needed, const std::vector&lt; int32 &gt; &amp;step_to_segment, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00107">nnet-compile.cc:107</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac77a6c3ac3e85ee3a02125f13e38e8e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac77a6c3ac3e85ee3a02125f13e38e8e2">&#9670;&nbsp;</a></span>CreateStepInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CreateStepInfo </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_needed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>step_to_segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>by_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00279">279</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8h_source.html#l00161">Compiler::cindex_id_to_location_</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00046">ComputationGraph::cindexes</a>, <a class="el" href="nnet-compile_8cc_source.html#l00457">Compiler::ComputeInputLocationsList()</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00063">ComputationGraph::dependencies</a>, <a class="el" href="nnet-compile_8h_source.html#l00074">Compiler::StepInfo::deriv</a>, <a class="el" href="nnet-compile_8h_source.html#l00100">Compiler::StepInfo::deriv_parts</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00084">NetworkNode::descriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00101">NetworkNode::dim</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00033">NetworkNode::Dim()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html#a2ad72c8ef42033a0bd1f26157087e5f6">SumDescriptor::Dim()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00531">Descriptor::Dim()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00103">NetworkNode::dim_offset</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00252">Compiler::GetStrideType()</a>, <a class="el" href="nnet-compile_8h_source.html#l00064">Compiler::graph_</a>, <a class="el" href="nnet-compile_8h_source.html#l00108">Compiler::StepInfo::input_locations_list</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00181">KALDI_PARANOID_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kDescriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kDimRange</a>, <a class="el" href="nnet-computation_8cc_source.html#l00128">NnetComputation::NewMatrix()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00102">NnetComputation::NewSubMatrix()</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, <a class="el" href="nnet-descriptor_8h_source.html#l00583">Descriptor::NumParts()</a>, <a class="el" href="nnet-compile_8h_source.html#l00089">Compiler::StepInfo::output_cindex_ids</a>, <a class="el" href="nnet-compile_8h_source.html#l00088">Compiler::StepInfo::output_indexes</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00572">Descriptor::Part()</a>, <a class="el" href="nnet-compile_8h_source.html#l00078">Compiler::StepInfo::segment</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>, <a class="el" href="nnet-compile_8h_source.html#l00073">Compiler::StepInfo::value</a>, and <a class="el" href="nnet-compile_8h_source.html#l00097">Compiler::StepInfo::value_parts</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                  {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!by_step-&gt;empty());</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  int32 num_steps = by_step-&gt;size();</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.resize(num_steps);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">for</span> (int32 step = 0; step &lt; num_steps; step++) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    StepInfo &amp;this_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    this_info.output_cindex_ids.swap((*by_step)[step]);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    this_info.segment = step_to_segment[step];</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    int32 num_ids = this_info.output_cindex_ids.size();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    this_info.output_indexes.resize(num_ids);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">for</span> (int32 row_index = 0; row_index &lt; num_ids; row_index++)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      this_info.output_indexes[row_index] =</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">cindexes</a>[this_info.output_cindex_ids[row_index]].second;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    if (num_ids &gt; 0) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="comment">// node id&#39;s of all Cindexes are the same, so just use first one.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      this_info.node_index =</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">cindexes</a>[this_info.output_cindex_ids.front()].first;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="comment">// it&#39;s possible to have an empty step if it&#39;s the component-input step of</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="comment">// a GeneralComponent that does not always have dependencies, such as the</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">// ConstantFunctionComponent.  This is just a kind of placeholder; it will</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="comment">// generate no commands.  The next command works because the next</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">// step will be the propagate for that Component, whose node-index is one</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="comment">// more than the component-input node.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((step+1) &lt; by_step-&gt;size() &amp;&amp; !(*by_step)[step+1].empty());</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      this_info.node_index =</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">cindexes</a>[(*by_step)[step+1][0]].first - 1;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(this_info.node_index &gt;= 0);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// we don&#39;t need to do anything else for this step.</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(this_info.node_index);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    int32 num_rows = num_ids, num_cols = node.<a class="code" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a5f04a8161c2da905a75f05db1b6dc809">Dim</a>(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (node.node_type != <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kDimRange</a>) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> stride_type = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#aa0b0b44dd99dc3d7b22f7380acd626c8">GetStrideType</a>(this_info.node_index);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      this_info.value = computation-&gt;NewMatrix(num_rows, num_cols,</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                               stride_type);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">if</span> (deriv_needed[step])</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        this_info.deriv = computation-&gt;NewMatrix(num_rows, num_cols,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                                 stride_type);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="comment">// kDimRange.  Will just be a sub-matrix of a Component or Input node.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      std::vector&lt;int32&gt;::const_iterator</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;          iter = this_info.output_cindex_ids.begin(),</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;          end = this_info.output_cindex_ids.end();</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      int32 source_cindex_id = -1;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        int32 cindex_id = *iter;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#ac5de41a87e16d0cb72ab76d026525216">dependencies</a>[cindex_id].empty()) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#ac5de41a87e16d0cb72ab76d026525216">dependencies</a>[cindex_id].size() == 1);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          source_cindex_id = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">graph_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationGraph.html#ac5de41a87e16d0cb72ab76d026525216">dependencies</a>[cindex_id][0];</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(source_cindex_id &gt;= 0);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      int32 input_step = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">cindex_id_to_location_</a>[source_cindex_id].first;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(this_info.output_cindex_ids.size() ==</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                   <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[input_step].output_cindex_ids.size());</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_step &gt;= 0 &amp;&amp; input_step &lt; step);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <a class="code" href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a>(this_info.output_indexes ==</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                            <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[input_step].output_indexes);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      this_info.value = computation-&gt;NewSubMatrix(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[input_step].value,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                                  0, -1,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                                  node.dim_offset, node.dim);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">if</span> (deriv_needed[step])</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        this_info.deriv = computation-&gt;NewSubMatrix(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[input_step].deriv,</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                                    0, -1,</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                                    node.dim_offset, node.dim);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="comment">// we have a couple of things to do: set up input_locations_list which</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="comment">// says where we copy the data from, and also set up value_parts and</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="comment">// possibly deriv_parts.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keyword">const</span> Descriptor &amp;desc = node.descriptor;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      int32 num_parts = desc.NumParts();</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_parts &gt; 0);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="comment">// set up input_locations_list.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      this_info.input_locations_list.resize(num_parts);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordflow">for</span> (int32 part = 0; part &lt; num_parts; part++)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a77c85c33bcf54ec797f1bd578bade7b8">ComputeInputLocationsList</a>(step, part,</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                  &amp;(this_info.input_locations_list[part]));</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="comment">// set up value_parts and deriv_parts.</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">if</span> (num_parts == 1) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        this_info.value_parts.push_back(this_info.value);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">if</span> (deriv_needed[step])</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;          this_info.deriv_parts.push_back(this_info.deriv);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">// num_parts &gt; 1.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        int32 cur_dim_offset = 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="comment">// Have multiple parts, so need to set up sub-matrices.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        this_info.value_parts.resize(num_parts);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">if</span> (deriv_needed[step])</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;          this_info.deriv_parts.resize(num_parts);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">for</span> (int32 p = 0; p &lt; num_parts; p++) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          <span class="keyword">const</span> SumDescriptor &amp;this_part = desc.Part(p);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          int32 this_dim = this_part.Dim(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          this_info.value_parts[p] =</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;              computation-&gt;NewSubMatrix(this_info.value,</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                        0, -1,</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                                        cur_dim_offset, this_dim);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          <span class="keywordflow">if</span> (deriv_needed[step])</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            this_info.deriv_parts[p] =</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                computation-&gt;NewSubMatrix(this_info.deriv,</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                          0, -1,</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                          cur_dim_offset, this_dim);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          cur_dim_offset += this_dim;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cur_dim_offset == desc.Dim(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>));</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;int32&gt;(this_info.output_cindex_ids.size()) ==</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                 computation-&gt;submatrices[this_info.value].num_rows);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a6e772505e8a0fc7ead243347658e8d19"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a6e772505e8a0fc7ead243347658e8d19">kaldi::nnet3::Compiler::graph_</a></div><div class="ttdeci">ComputationGraph graph_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00064">nnet-compile.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_a297d5616d3920cb01d699e7a0e4d2a67"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#a297d5616d3920cb01d699e7a0e4d2a67">kaldi::nnet3::ComputationGraph::cindexes</a></div><div class="ttdeci">std::vector&lt; Cindex &gt; cindexes</div><div class="ttdoc">The mapping of cindex_id to Cindex. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8h_source.html#l00046">nnet-computation-graph.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationGraph_html_ac5de41a87e16d0cb72ab76d026525216"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#ac5de41a87e16d0cb72ab76d026525216">kaldi::nnet3::ComputationGraph::dependencies</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int32 &gt; &gt; dependencies</div><div class="ttdoc">dependencies[cindex_id] gives you the list of other cindex_ids that this particular cindex_id directl...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8h_source.html#l00063">nnet-computation-graph.h:63</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NetworkNode_html_a5f04a8161c2da905a75f05db1b6dc809"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NetworkNode.html#a5f04a8161c2da905a75f05db1b6dc809">kaldi::nnet3::NetworkNode::Dim</a></div><div class="ttdeci">int32 Dim(const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00033">nnet-nnet.cc:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a77c85c33bcf54ec797f1bd578bade7b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a77c85c33bcf54ec797f1bd578bade7b8">kaldi::nnet3::Compiler::ComputeInputLocationsList</a></div><div class="ttdeci">void ComputeInputLocationsList(int32 step, int32 part_index, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *input_locations) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00457">nnet-compile.cc:457</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">kaldi::MatrixStrideType</a></div><div class="ttdeci">MatrixStrideType</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00044">matrix-common.h:44</a></div></div>
<div class="ttc" id="group__error__group_html_ga2c852c1a15c7f195ec8021de2ab119a0"><div class="ttname"><a href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a></div><div class="ttdeci">#define KALDI_PARANOID_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00181">kaldi-error.h:181</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_aa0b0b44dd99dc3d7b22f7380acd626c8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#aa0b0b44dd99dc3d7b22f7380acd626c8">kaldi::nnet3::Compiler::GetStrideType</a></div><div class="ttdeci">MatrixStrideType GetStrideType(int32 node_index) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00252">nnet-compile.cc:252</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kaldi::nnet3::kDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a4286f6d7e1ff9117ffc8b1a57ded5efb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a4286f6d7e1ff9117ffc8b1a57ded5efb">kaldi::nnet3::Compiler::cindex_id_to_location_</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; cindex_id_to_location_</div><div class="ttdoc">This maps each cindex_id to its location. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00161">nnet-compile.h:161</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kaldi::nnet3::kDimRange</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a69e7e3add33733991062bbe39fd6fd86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69e7e3add33733991062bbe39fd6fd86">&#9670;&nbsp;</a></span>DeallocateMatrices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void DeallocateMatrices </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>whole_submatrices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>step_to_segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01293">1293</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8h_source.html#l00074">Compiler::StepInfo::deriv</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00063">Nnet::GetNodeNames()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00120">Nnet::IsInputNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>, and <a class="el" href="nnet-compile_8h_source.html#l00073">Compiler::StepInfo::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                                                                {</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <span class="comment">// This adds the commands to destroy all the matrices- but not the</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="comment">// ones that might be needed as outputs of the computation.  The ones that</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="comment">// are spared from destruction are those corresponding to outputs of the</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  <span class="comment">// computation, and those corresponding to input derivatives that were</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="comment">// requested by the user.</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  int32 num_matrices = computation-&gt;matrices.size();</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  std::vector&lt;bool&gt; will_destroy(num_matrices, <span class="keyword">true</span>);</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  int32 num_steps = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size();</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <span class="keywordflow">for</span> (int32 step = 0; step &lt; num_steps; step++) {</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keyword">const</span> ComputationRequest &amp;request = *(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[step_to_segment[step]]);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">IsOutputNode</a>(step_info.node_index)) {</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="comment">// steps corresponding to output nodes need to have their &quot;value&quot; kept.</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      int32 value_matrix_index =</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;          computation-&gt;submatrices[step_info.value].matrix_index;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      will_destroy[value_matrix_index] = <span class="keyword">false</span>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a514bcd8b42cec993b29ccbc6714457fb">IsInputNode</a>(step_info.node_index)) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <span class="comment">// steps corresponding to input nodes need to have their &quot;deriv&quot; kept, but</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="comment">// only if the corresponding input derivative was requested.  (we don&#39;t</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <span class="comment">// need to worry about whether outputs were requested, because if they</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      <span class="comment">// were not requested we would not be computing them in the first place).</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      std::string input_name = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#ad535f900dadd2cbd357d0b6382a9bff6">GetNodeNames</a>()[step_info.node_index];</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, num_inputs = request.inputs.size();</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordtype">bool</span> has_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      <span class="keywordflow">for</span> (; i &lt; num_inputs; i++) {</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <span class="keywordflow">if</span> (input_name == request.inputs[i].name) {</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;          has_deriv = request.inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].has_deriv;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        }</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      }</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(i != num_inputs); <span class="comment">// assert we found an input-request with</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                                     <span class="comment">// this name</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      <span class="keywordflow">if</span> (has_deriv) {</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        int32 deriv_matrix_index =</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;          computation-&gt;submatrices[step_info.deriv].matrix_index;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        will_destroy[deriv_matrix_index] = <span class="keyword">false</span>;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      }</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  }</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="comment">// note: matrix-index 0 is the empty matrix.</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordflow">if</span> (will_destroy[m]) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      int32 submatrix_index = whole_submatrices[m];</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      computation-&gt;commands.push_back(</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;          NnetComputation::Command(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>, submatrix_index));</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  }</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a514bcd8b42cec993b29ccbc6714457fb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a514bcd8b42cec993b29ccbc6714457fb">kaldi::nnet3::Nnet::IsInputNode</a></div><div class="ttdeci">bool IsInputNode(int32 node) const</div><div class="ttdoc">Returns true if this is an output node, meaning that it is of type kInput. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00120">nnet-nnet.cc:120</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a6c50812e1be80ab06573493276ec2ca5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a6c50812e1be80ab06573493276ec2ca5">kaldi::nnet3::Nnet::IsOutputNode</a></div><div class="ttdeci">bool IsOutputNode(int32 node) const</div><div class="ttdoc">Returns true if this is an output node, meaning that it is of type kDescriptor and is not directly fo...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00112">nnet-nnet.cc:112</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_ad535f900dadd2cbd357d0b6382a9bff6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#ad535f900dadd2cbd357d0b6382a9bff6">kaldi::nnet3::Nnet::GetNodeNames</a></div><div class="ttdeci">const std::vector&lt; std::string &gt; &amp; GetNodeNames() const</div><div class="ttdoc">returns vector of node names (needed by some parsing code, for instance). </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00063">nnet-nnet.cc:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab374736f7b545da4642720f56175118f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab374736f7b545da4642720f56175118f">&#9670;&nbsp;</a></span>DefineMatrices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void DefineMatrices </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac7746483c91dc0506b44f5534f84840b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7746483c91dc0506b44f5534f84840b">&#9670;&nbsp;</a></span>DefineSubmatrices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void DefineSubmatrices </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aa0b0b44dd99dc3d7b22f7380acd626c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0b0b44dd99dc3d7b22f7380acd626c8">&#9670;&nbsp;</a></span>GetStrideType()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> GetStrideType </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>node_index</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00252">252</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8h_source.html#l00087">NetworkNode::component_index</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00172">Nnet::IsComponentInputNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00132">Nnet::IsComponentNode()</a>, <a class="el" href="matrix-common_8h_source.html#l00045">kaldi::kDefaultStride</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00075">kaldi::nnet3::kInputContiguous</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00077">kaldi::nnet3::kOutputContiguous</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00279">Compiler::CreateStepInfo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                                               {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  int32 component_node_index;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">bool</span> is_input;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#ace963c54d5f404914f1ce1953a9112c6">IsComponentInputNode</a>(node_index)) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// this node is for the input to a component.</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    component_node_index = node_index + 1;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    is_input = <span class="keyword">true</span>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a9167816d5d30fa49f76019d83cf6d652">IsComponentNode</a>(node_index)) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    component_node_index = node_index;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    is_input = <span class="keyword">false</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(component_node_index);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keyword">const</span> Component *c = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(node.u.component_index);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span> (is_input) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">return</span> (c-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kInputContiguous</a>) ?</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">return</span> (c-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kOutputContiguous</a>) ?</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kaldi::nnet3::kOutputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00077">nnet-component-itf.h:77</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a9167816d5d30fa49f76019d83cf6d652"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a9167816d5d30fa49f76019d83cf6d652">kaldi::nnet3::Nnet::IsComponentNode</a></div><div class="ttdeci">bool IsComponentNode(int32 node) const</div><div class="ttdoc">Returns true if this is a component node, meaning that it is of type kComponent. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00132">nnet-nnet.cc:132</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kaldi::kDefaultStride</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00045">matrix-common.h:45</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kaldi::nnet3::kInputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00075">nnet-component-itf.h:75</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_ace963c54d5f404914f1ce1953a9112c6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#ace963c54d5f404914f1ce1953a9112c6">kaldi::nnet3::Nnet::IsComponentInputNode</a></div><div class="ttdeci">bool IsComponentInputNode(int32 node) const</div><div class="ttdoc">Returns true if this is component-input node, i.e. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00172">nnet-nnet.cc:172</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7182453a66397f21a9cbb9f33ff1f6ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7182453a66397f21a9cbb9f33ff1f6ff">&#9670;&nbsp;</a></span>IsInputStep()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> IsInputStep </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>step</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00397">397</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kInput</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01050">Compiler::CompileBackward()</a>, and <a class="el" href="nnet-compile_8cc_source.html#l00406">Compiler::CompileForward()</a>.</p>
<div class="fragment"><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                           {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(step &gt;= 0);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">if</span> (step &gt;= <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size())</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(step_info.node_index);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">return</span> (node.node_type == <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a>);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a77ed06977b3c1e639e2985ada86c5357"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77ed06977b3c1e639e2985ada86c5357">&#9670;&nbsp;</a></span>OutputDebugInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void OutputDebugInfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01346">1346</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile_8cc_source.html#l01375">kaldi::nnet3::AppendCindexes()</a>, <a class="el" href="nnet-computation_8h_source.html#l00317">NnetComputation::MatrixDebugInfo::cindexes</a>, <a class="el" href="nnet-compile_8h_source.html#l00074">Compiler::StepInfo::deriv</a>, <a class="el" href="nnet-computation_8h_source.html#l00316">NnetComputation::MatrixDebugInfo::is_deriv</a>, <a class="el" href="nnet-computation_8cc_source.html#l00975">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="nnet-compile_8h_source.html#l00088">Compiler::StepInfo::output_indexes</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>, and <a class="el" href="nnet-compile_8h_source.html#l00073">Compiler::StepInfo::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                                                                 {</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  int32 num_matrices = computation-&gt;matrices.size(),</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      num_steps = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size();</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  computation-&gt;matrix_debug_info.resize(num_matrices);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">for</span> (int32 step = 0; step &lt; num_steps; step++) {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keyword">const</span> StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keywordflow">if</span> (step_info.value == 0)</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// e.g. input step for ConstantComponent.</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">if</span> (!computation-&gt;IsWholeMatrix(step_info.value))</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    int32 value_matrix = computation-&gt;submatrices[step_info.value].matrix_index;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    int32 deriv_matrix = 0;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordflow">if</span> (step_info.deriv != 0 &amp;&amp; computation-&gt;IsWholeMatrix(step_info.deriv))</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      deriv_matrix = computation-&gt;submatrices[step_info.deriv].matrix_index;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    NnetComputation::MatrixDebugInfo &amp;debug_info =</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        computation-&gt;matrix_debug_info[value_matrix];</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    debug_info.is_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#adbaeb0c690e96bd285e79a287882f13e">AppendCindexes</a>(step_info.node_index, step_info.output_indexes,</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                   &amp;debug_info.cindexes);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="keywordflow">if</span> (deriv_matrix != 0) {</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      NnetComputation::MatrixDebugInfo &amp;deriv_debug_info =</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;          computation-&gt;matrix_debug_info[deriv_matrix];</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      deriv_debug_info.is_deriv = <span class="keyword">true</span>;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      deriv_debug_info.cindexes = debug_info.cindexes;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  }</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_adbaeb0c690e96bd285e79a287882f13e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#adbaeb0c690e96bd285e79a287882f13e">kaldi::nnet3::AppendCindexes</a></div><div class="ttdeci">void AppendCindexes(int32 node, const std::vector&lt; Index &gt; &amp;indexes, std::vector&lt; Cindex &gt; *out)</div><div class="ttdoc">Appends to &amp;#39;out&amp;#39; the pairs (node, indexes[0]), (node, indexes[1]), ... </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l01375">nnet-compile.cc:1375</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4ed330888cafea969ad27813d55b5109"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ed330888cafea969ad27813d55b5109">&#9670;&nbsp;</a></span>SetUpPrecomputedIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SetUpPrecomputedIndexes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>step_to_segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01239">1239</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8h_source.html#l00087">NetworkNode::component_index</a>, <a class="el" href="nnet-computation_8h_source.html#l00412">NnetComputation::component_precomputed_indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00379">NnetComputation::PrecomputedIndexesInfo::data</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-computation_8h_source.html#l00380">NnetComputation::PrecomputedIndexesInfo::input_indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kaldi::nnet3::kComponent</a>, <a class="el" href="nnet-computation_8h_source.html#l00130">ComputationRequest::misc_info</a>, <a class="el" href="nnet-computation_8cc_source.html#l00029">ComputationRequest::NeedDerivatives()</a>, <a class="el" href="nnet-compile_8h_source.html#l00063">Compiler::nnet_</a>, <a class="el" href="nnet-compile_8h_source.html#l00072">Compiler::StepInfo::node_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, <a class="el" href="nnet-compile_8h_source.html#l00088">Compiler::StepInfo::output_indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00381">NnetComputation::PrecomputedIndexesInfo::output_indexes</a>, <a class="el" href="nnet-compile_8h_source.html#l00086">Compiler::StepInfo::precomputed_indexes_index</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00302">Component::PrecomputeIndexes()</a>, <a class="el" href="nnet-compile_8h_source.html#l00062">Compiler::requests_</a>, <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>, and <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                                  {</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  int32 num_steps = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size();</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation-&gt;component_precomputed_indexes.empty());</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">// the zeroth commponent is special, contains a NULL pointer.</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  computation-&gt;component_precomputed_indexes.resize(1);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keywordflow">for</span> (int32 step = 0; step &lt; num_steps; step++) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    StepInfo &amp;step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step];</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    int32 node_index = step_info.node_index;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keyword">const</span> NetworkNode &amp;node = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">GetNode</a>(node_index);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="comment">// There is only something to do for nodes of type Component.</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordflow">if</span> (node.node_type != <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keyword">const</span> StepInfo &amp;input_step_info = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step - 1];</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    int32 component_index = node.u.component_index;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    int32 input_node_index = input_step_info.node_index;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_node_index == node_index - 1);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;input_indexes = input_step_info.output_indexes;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;output_indexes = step_info.output_indexes;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keyword">const</span> Component *component = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(component_index);</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keyword">const</span> ComputationRequest &amp;request = *(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">requests_</a>[step_to_segment[step]]);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordtype">bool</span> need_derivs = request.NeedDerivatives();</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    ComponentPrecomputedIndexes *precomputed_indexes =</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        component-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ad3829084b3e064ff320153ff4b6cfd44">PrecomputeIndexes</a>(request.misc_info,</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                                     input_indexes, output_indexes,</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                                     need_derivs);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordflow">if</span> (precomputed_indexes == NULL) {</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="comment">// e.g. simple Components, and some other Components, will return NULL for</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="comment">// precomputed_indexes.</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      step_info.precomputed_indexes_index = 0;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      step_info.precomputed_indexes_index =</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;          computation-&gt;component_precomputed_indexes.size();</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      NnetComputation::PrecomputedIndexesInfo info;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      info.data = precomputed_indexes;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      <span class="keywordflow">if</span> (!input_indexes.empty() &amp;&amp; input_indexes.back().n == 1 &amp;&amp;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;          !output_indexes.empty() &amp;&amp; output_indexes.back().n == 1) {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="comment">// If these conditions are true, it&#39;s *possible* that we are doing</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="comment">// &#39;shortcut&#39; compilation.  So just in case that&#39;s what&#39;s going on, we</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="comment">// store &#39;input_indexes&#39; and &#39;output_indexes, which are needed by</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="comment">// the ExpandComputation() function that is used in that process.</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        info.input_indexes = input_indexes;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        info.output_indexes = output_indexes;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      }</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      computation-&gt;component_precomputed_indexes.push_back(info);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    }</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  }</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::Compiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00063">nnet-compile.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ad3829084b3e064ff320153ff4b6cfd44"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ad3829084b3e064ff320153ff4b6cfd44">kaldi::nnet3::Component::PrecomputeIndexes</a></div><div class="ttdeci">virtual ComponentPrecomputedIndexes * PrecomputeIndexes(const MiscComputationInfo &amp;misc_info, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, bool need_backprop) const</div><div class="ttdoc">This function must return NULL for simple Components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00302">nnet-component-itf.h:302</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a7c9670858b79ae4a8e1c054b5d5231b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a7c9670858b79ae4a8e1c054b5d5231b8">kaldi::nnet3::Nnet::GetNode</a></div><div class="ttdeci">const NetworkNode &amp; GetNode(int32 node) const</div><div class="ttdoc">returns const reference to a particular numbered network node. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00146">nnet-nnet.h:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_abdabde99d778f61da27f986b09efe198"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#abdabde99d778f61da27f986b09efe198">kaldi::nnet3::Compiler::requests_</a></div><div class="ttdeci">std::vector&lt; const ComputationRequest * &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00062">nnet-compile.h:62</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5777e533fbbccce21952a60cc3312b4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5777e533fbbccce21952a60cc3312b4a">&#9670;&nbsp;</a></span>SplitByScale()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> SplitByScale </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html">SumDescriptor</a> &amp;&#160;</td>
          <td class="paramname"><em>descriptor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_locations_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>split_locations_lists</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function helps to handle scalar factors in Descriptors (expressions like `Scale(-1.0, &lt;descriptor)`). </p>
<p>It splits an input_locations_list for one <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html" title="This is an abstract base-class. ">SumDescriptor</a> (consisting of one of the appended-together parts of a <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>) by scale, such that each split-up locations_list corresponds to a single scaling factor. The scaling factors are all 1.0 by default, but may be different from 1.0 if the user uses `Scale(...)` expressions in descriptors, e.g. `Scale(-1.0, lstm1.z)`. To help efficiency, this function treats the case where all the scales in the expression are the same (usually 1.0), as a special case. In this case, 'split_locations_lists' will be empty and the shared scale (e.g. 1.0) is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">descriptor</td><td>The <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html" title="This is an abstract base-class. ">SumDescriptor</a> for which we're getting scalar factors. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_locations_list</td><td>This is one element of the input_locations_list from the <a class="el" href="structkaldi_1_1nnet3_1_1Compiler_1_1StepInfo.html">StepInfo</a> of the step we are computing, corresponding to this <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html" title="This is an abstract base-class. ">SumDescriptor</a> (i.e. one part of the <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>). It is indexed by row-index, then it is a list of pairs (step, row-index), representing source Cindexes of a summation. This function will work out what scaling factors the pairs in these lists have. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">split_locations_lists</td><td>We write to this location. If all the scaling factors are the same this will be set to the empty list and the common scaling factor returned. Otherwise +infinity will be returned and the split-up list will be written to the location. Each element (*split_locations_lists)[i] will be set to a pair (alpha, partial_input_locations_list) where alpha is the scaling factor associated with this split-up piece (e.g. -1.0 if it was part of an expression like `Scale(-1.0, lstm1.z)`), and 'partial_input_locations_list' is a vector with the same dimension as 'input_locations_list' (indexed by row-index), where partial_input_locations_list[r] will contain a subset of the pairs present in input_locations_list[r], and if we were to append together all the (*split_locations_lists)[*].second.partial_input_locations_list[r], we'd get a list with the same members as input_locations_list[r], although not necessarily in the same order. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>In the general case (where multiple scales are used), returns +infinity and sets 'split_locations_lists' to the split-up list. In the special, but more common case where only a single scale is used, return that scale (1.0 will be the most common value) and set 'split_locations_lists' to empty; in this special case, which has been made a special case for efficiency reasons, the user should directly use the un-split locations list in 'input_locations_list'. </dd></dl>

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l00557">557</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html#a2bf5d3d73821575665c7b6f031af7d10">SumDescriptor::GetNodeDependencies()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html#a0337b219e3aecb3a60c8261820ace1c2">SumDescriptor::GetScaleForNode()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, and <a class="el" href="nnet-compile_8h_source.html#l00153">Compiler::steps_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00835">Compiler::CompileBackwardSumDescriptor()</a>, and <a class="el" href="nnet-compile_8cc_source.html#l00676">Compiler::CompileForwardSumDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                  {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  split_locations_lists-&gt;clear();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">// alpha_to_nodes maps from the scale alpha to the list of nodes which are</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// given that scale.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  std::map&lt;BaseFloat, std::vector&lt;int32&gt; &gt; alpha_to_nodes;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  { <span class="comment">// This block compute `alpha_to_nodes`.</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    std::vector&lt;int32&gt; nodes;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    descriptor.GetNodeDependencies(&amp;nodes);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;nodes);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// Now `nodes` is a list of the graph node indexes that are referred to</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">// in the descriptor.  E.g. if the Descriptor represents</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">// &#39;Sum(tdnn1, Offset(tdnn2, -2))&#39; then `nodes` would contain the</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// integer node indexes for graph-nodes &#39;tdnn1&#39; and &#39;tdnn2&#39;.</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nodes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      int32 node = nodes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha = descriptor.GetScaleForNode(node);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(alpha - alpha == 0.0);  <span class="comment">// check it&#39;s not infinity.</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      alpha_to_nodes[alpha].push_back(node);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">if</span> (alpha_to_nodes.size() == 1) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">// If all the alpha values are the same we treat it as a special case</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">// for efficiency, to avoid a redundant copy of the contents of</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// &#39;input_locations_list&#39;.</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">return</span> alpha_to_nodes.begin()-&gt;first;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">// `steps_used` will be a list of all step indexes that appear as `.first`</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">// elements in `input_locations_list`.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  unordered_set&lt;int32&gt; steps_used;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  {  <span class="comment">// This block computes `steps_used`.</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    int32 cur_step = -1000;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    std::vector&lt;std::vector&lt;std::pair&lt;int32,int32&gt; &gt; &gt;::const_iterator</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        iter = input_locations_list.begin(),</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        end = input_locations_list.end();</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      std::vector&lt;std::pair&lt;int32,int32&gt; &gt;::const_iterator</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;          pair_iter = iter-&gt;begin(),</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          pair_end = iter-&gt;end();</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="keywordflow">for</span> (; pair_iter != pair_end; ++pair_iter) {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">if</span> (pair_iter-&gt;first != cur_step) {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          cur_step = pair_iter-&gt;first;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          steps_used.insert(cur_step);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    }</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">// `node_to_steps` will be a map from graph node index to the list of steps</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">// which are present in `steps_used` and which are associated with that graph</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="comment">// node.</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  std::map&lt;int32, std::vector&lt;int32&gt; &gt; node_to_steps;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  {  <span class="comment">// This block computes `node_to_steps`.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    unordered_set&lt;int32&gt;::const_iterator</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        step_iter = steps_used.begin(), step_end = steps_used.end();</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">for</span> (; step_iter != step_end; ++step_iter) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      int32 step_index = *step_iter;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(step_index) &lt; <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size());</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      int32 node_index = <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>[step_index].node_index;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      node_to_steps[node_index].push_back(step_index);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  int32 num_rows = input_locations_list.size();</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  split_locations_lists-&gt;resize(alpha_to_nodes.size());</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">// `step_to_index` will map from the step-index to the index into</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// `split_locations_lists`; each index is associated with a different value of</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// the scale `alpha`.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  std::vector&lt;int32&gt; step_to_locations_index(<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">steps_</a>.size(), -1);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  {  <span class="comment">// This block computes `step_to_index` and also sets the `alpha` values</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;     <span class="comment">// which are present as (*split_locations_lists)[*].first.</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    std::map&lt;BaseFloat, std::vector&lt;int32&gt; &gt;::const_iterator</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        iter = alpha_to_nodes.begin(), end = alpha_to_nodes.end();</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    int32 split_locations_index = 0;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter, ++split_locations_index) {</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha = iter-&gt;first;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;nodes = iter-&gt;second;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      (*split_locations_lists)[split_locations_index].first = alpha;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      (*split_locations_lists)[split_locations_index].second.resize(num_rows);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nodes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        int32 node_index = nodes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node_to_steps.count(node_index) != 0);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;steps = node_to_steps[node_index];</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; steps.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          int32 step_index = steps[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(step_index &gt;= 0 &amp;&amp;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                       step_to_locations_index[step_index] == -1);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          step_to_locations_index[step_index] = split_locations_index;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  {  <span class="comment">// This block populates &#39;split_locations_lists[*].second&#39; with the</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;     <span class="comment">// split-by-alpha version of &#39;input_locations_list&#39;</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32,int32&gt; &gt; &amp;this_list =</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          input_locations_list[r];</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      std::vector&lt;std::pair&lt;int32,int32&gt; &gt;::const_iterator</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;          pair_iter = this_list.begin(),</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          pair_end = this_list.end();</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">for</span> (; pair_iter != pair_end; ++pair_iter) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        int32 step = pair_iter-&gt;first,</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            split_locations_index = step_to_locations_index[step];</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        (*split_locations_lists)[split_locations_index].second[r].push_back(</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            *pair_iter);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keywordflow">return</span> std::numeric_limits&lt;BaseFloat&gt;::infinity();</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a25bfe0118cf7458a88e685463d05f895"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a25bfe0118cf7458a88e685463d05f895">kaldi::nnet3::Compiler::steps_</a></div><div class="ttdeci">std::vector&lt; StepInfo &gt; steps_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00153">nnet-compile.h:153</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a4286f6d7e1ff9117ffc8b1a57ded5efb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4286f6d7e1ff9117ffc8b1a57ded5efb">&#9670;&nbsp;</a></span>cindex_id_to_location_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::pair&lt;int32, int32&gt; &gt; cindex_id_to_location_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This maps each cindex_id to its location. </p>
<p>However, you should not rely on its accuracy for cindex_ids that correspond to the Descriptors at <a class="el" href="classkaldi_1_1nnet3_1_1Component.html" title="Abstract base-class for neural-net components. ">Component</a> inputs, since it's possible in principle for such cindex_ids to exist at &gt;1 location. (This is not a problem in practice, because we only need this for the outputs of component-nodes, and for computation inputs). A location is a pair (step-index, matrix-row-index). </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile_8h_source.html#l00161">161</a> of file <a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00457">Compiler::ComputeInputLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00142">Compiler::ComputeStepDependencies()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, and <a class="el" href="nnet-compile_8cc_source.html#l00279">Compiler::CreateStepInfo()</a>.</p>

</div>
</div>
<a id="a6e772505e8a0fc7ead243347658e8d19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e772505e8a0fc7ead243347658e8d19">&#9670;&nbsp;</a></span>graph_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a> graph_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8h_source.html#l00064">64</a> of file <a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01189">Compiler::AllocateMatrices()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00176">Compiler::ComputeDerivNeeded()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00457">Compiler::ComputeInputLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00142">Compiler::ComputeStepDependencies()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, and <a class="el" href="nnet-compile_8cc_source.html#l00279">Compiler::CreateStepInfo()</a>.</p>

</div>
</div>
<a id="adbabf05a7702103113a02a113015205f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbabf05a7702103113a02a113015205f">&#9670;&nbsp;</a></span>nnet_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a>&amp; nnet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8h_source.html#l00063">63</a> of file <a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01149">Compiler::AddBackwardStepComponent()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01131">Compiler::AddBackwardStepInput()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01097">Compiler::AddForwardStepComponent()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01080">Compiler::AddForwardStepInput()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01189">Compiler::AllocateMatrices()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01050">Compiler::CompileBackward()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01029">Compiler::CompileBackwardDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00835">Compiler::CompileBackwardSumDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00406">Compiler::CompileForward()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00432">Compiler::CompileForwardDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00676">Compiler::CompileForwardSumDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00176">Compiler::ComputeDerivNeeded()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00457">Compiler::ComputeInputLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00142">Compiler::ComputeStepDependencies()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00279">Compiler::CreateStepInfo()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01293">Compiler::DeallocateMatrices()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00252">Compiler::GetStrideType()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00397">Compiler::IsInputStep()</a>, and <a class="el" href="nnet-compile_8cc_source.html#l01239">Compiler::SetUpPrecomputedIndexes()</a>.</p>

</div>
</div>
<a id="abdabde99d778f61da27f986b09efe198"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdabde99d778f61da27f986b09efe198">&#9670;&nbsp;</a></span>requests_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>*&gt; requests_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8h_source.html#l00062">62</a> of file <a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01097">Compiler::AddForwardStepComponent()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00029">Compiler::Compiler()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00176">Compiler::ComputeDerivNeeded()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01293">Compiler::DeallocateMatrices()</a>, and <a class="el" href="nnet-compile_8cc_source.html#l01239">Compiler::SetUpPrecomputedIndexes()</a>.</p>

</div>
</div>
<a id="a25bfe0118cf7458a88e685463d05f895"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25bfe0118cf7458a88e685463d05f895">&#9670;&nbsp;</a></span>steps_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structkaldi_1_1nnet3_1_1Compiler_1_1StepInfo.html">StepInfo</a>&gt; steps_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile_8h_source.html#l00153">153</a> of file <a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01149">Compiler::AddBackwardStepComponent()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01131">Compiler::AddBackwardStepInput()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00107">Compiler::AddCommands()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01097">Compiler::AddForwardStepComponent()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01080">Compiler::AddForwardStepInput()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01189">Compiler::AllocateMatrices()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01050">Compiler::CompileBackward()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01029">Compiler::CompileBackwardDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00835">Compiler::CompileBackwardSumDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00406">Compiler::CompileForward()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00432">Compiler::CompileForwardDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00676">Compiler::CompileForwardSumDescriptor()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00531">Compiler::ComputeDerivSubmatLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00457">Compiler::ComputeInputLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00503">Compiler::ComputeValueSubmatLocationsList()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00279">Compiler::CreateStepInfo()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01293">Compiler::DeallocateMatrices()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00397">Compiler::IsInputStep()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01346">Compiler::OutputDebugInfo()</a>, <a class="el" href="nnet-compile_8cc_source.html#l01239">Compiler::SetUpPrecomputedIndexes()</a>, and <a class="el" href="nnet-compile_8cc_source.html#l00557">Compiler::SplitByScale()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>nnet3/<a class="el" href="nnet-compile_8h_source.html">nnet-compile.h</a></li>
<li>nnet3/<a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li><li class="navelem"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
