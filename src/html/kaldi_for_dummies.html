<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Kaldi for Dummies tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('kaldi_for_dummies.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Kaldi for Dummies tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#kaldi_for_dummies_introduction">Introduction</a></li>
<li class="level1"><a href="#kaldi_for_dummies_environment">Environment</a></li>
<li class="level1"><a href="#kaldi_for_dummies_download">Download Kaldi</a></li>
<li class="level1"><a href="#kaldi_for_dummies_directories">Kaldi directories structure</a></li>
<li class="level1"><a href="#kaldi_for_dummies_project">Your exemplary project</a></li>
<li class="level1"><a href="#kaldi_for_dummies_data">Data preparation</a><ul><li class="level2"><a href="#kaldi_for_dummies_audio">Audio data</a></li>
<li class="level2"><a href="#kaldi_for_dummies_acoustic">Acoustic data</a></li>
<li class="level2"><a href="#kaldi_for_dummies_language">Language data</a></li>
</ul>
</li>
<li class="level1"><a href="#kaldi_for_dummies_finalization">Project finalization</a><ul><li class="level2"><a href="#kaldi_for_dummies_tools">Tools attachment</a></li>
<li class="level2"><a href="#kaldi_for_dummies_scoring">Scoring script</a></li>
<li class="level2"><a href="#kaldi_for_dummies_srilm">SRILM installation</a></li>
<li class="level2"><a href="#kaldi_for_dummies_configuration">Configuration files</a></li>
</ul>
</li>
<li class="level1"><a href="#kaldi_for_dummies_running">Running scripts creation</a></li>
<li class="level1"><a href="#kaldi_for_dummies_results">Getting results</a></li>
<li class="level1"><a href="#kaldi_for_dummies_summary">Summary</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="kaldi_for_dummies_introduction"></a>
Introduction</h1>
<p>This is a step by step tutorial for absolute beginners on how to create a simple ASR (Automatic Speech Recognition) system in Kaldi toolkit using your own set of data. I really would have liked to read something like this when I was starting to deal with Kaldi. This is all based on my experience as an amateur in case of speech recognition subject and script programming as well. If you have ever delved through Kaldi tutorial on the official project site and felt a little bit lost, well, my piece of art might be the choice for you. You will learn how to install Kaldi, how to make it work and how to run an ASR system using your own audio data. As an effect you will get your first speech decoding results. It was created by Wit Zielinski.</p>
<p>First of all - get to know what Kaldi actually is and why you should use it instead of something else. In my opinion Kaldi requires solid knowledge about speech recognition and ASR systems in general. It is also good to know the basics of script programming languages (bash, perl, python). C++ migh be useful in the future (probably you will want to make some modifications in the source code).</p>
<p>To read: <br />
 <a class="el" href="about.html">About the Kaldi project</a> <br />
 <a class="el" href="tutorial_prereqs.html">Kaldi tutorial: Prerequisites</a></p>
<h1><a class="anchor" id="kaldi_for_dummies_environment"></a>
Environment</h1>
<p>Rule number 1 - use Linux. Although it is possible to use Kaldi on Windows, most people I find trustworthy convinced me that Linux will do the job with the less amount of problems. I have chosen Ubuntu 14.10. This was (in 2014/15) a rich and stable Linux representation which I honestly recommend. When you finally have your Linux running properly, please open a terminal and install some necessary stuff (if you do not already have it):</p>
<p>(has to be installed)</p><ul>
<li><code>atlas</code> – automation and optimization of calculations in the field of linear algebra,</li>
<li><code>autoconf</code> – automatic software compilation on different operating systems,</li>
<li><code>automake</code> – creating portable Makefile files,</li>
<li><code>git</code> – distributed revision control system,</li>
<li><code>libtool</code> – creating static and dynamic libraries,</li>
<li><code>svn</code> – revision control system (Subversion), necessary for Kaldi download and installation,</li>
<li><code>wget</code> – data transfer using HTTP, HTTPS and FTP protocols,</li>
<li><code>zlib</code> – data compression,</li>
</ul>
<p>(probably has to be installed)</p><ul>
<li><code>awk</code> – programming language, used for searching and processing patterns in files and data streams,</li>
<li><code>bash</code> – Unix shell and script programming language,</li>
<li><code>grep</code> – command-line utility for searching plain-text data sets for lines matching a regular expression,</li>
<li><code>make</code> – automatically builds executable programs and libraries from source code,</li>
<li><code>perl</code> – dynamic programming language, perfect for text files processing.</li>
</ul>
<p>Done. Operating system and all the necessary Linux tools are ready to go.</p>
<h1><a class="anchor" id="kaldi_for_dummies_download"></a>
Download Kaldi</h1>
<p>Just follow the instruction carefully: <a class="el" href="install.html">Downloading and installing Kaldi</a>. If you do not have much idea about how to use GIT, please read about it: <a class="el" href="tutorial_git.html">Kaldi Tutorial: Version control with Git (5 minutes)</a>.</p>
<p>I installed Kaldi in this directory (called 'Kaldi root path'): <code>/home/{user}/kaldi-trunk</code> </p>
<h1><a class="anchor" id="kaldi_for_dummies_directories"></a>
Kaldi directories structure</h1>
<p>Try to acknowledge where particular Kaldi components are placed. Also it would be nice if you read any <code>README</code> files you find.</p>
<p><code>kaldi-trunk</code> - main Kaldi directory which contains:</p><ul>
<li><code>egs</code> – example scripts allowing you to quickly build ASR systems for over 30 popular speech corporas (documentation is attached for each project),</li>
<li><code>misc</code> – additional tools and supplies, not needed for proper Kaldi functionality,</li>
<li><code>src</code> – Kaldi source code,</li>
<li><code>tools</code> – useful components and external tools,</li>
<li><code>windows</code> – tools for running Kaldi using Windows.</li>
</ul>
<p>The most important directory for you is obviously <code>egs</code>. Here you will create your own ASR system.</p>
<h1><a class="anchor" id="kaldi_for_dummies_project"></a>
Your exemplary project</h1>
<p>For the purpose of this tutorial, imagine that you have the same simple set of data as me (described below, in <a class="el" href="kaldi_for_dummies.html#kaldi_for_dummies_audio">Audio data</a> section). Then try to 'transpose' every action I do straight into your own project. If you completely do not have any audio data or you want to follow my tutorial in an identical way, feel free to record your own tracks - it will be even bigger experience to play with ASR. Here we go.</p>
<h2>Your precondition</h2>
<p>You have some amount of audio data that contain only spoken digits by at least several different speakers. Each audio file is an entire spoken sentence (e.g. 'one, nine, five').</p>
<h2>Your purpose</h2>
<p>You want to divide your data into train and test sets, set up an ASR system, train it, test it and get some decoding results.</p>
<h2>Your first task</h2>
<p>Something to begin with - create a folder <code>digits</code> in <code>kaldi-trunk/egs/</code> directory. This is a place where you will put all the stuff related to your project.</p>
<h1><a class="anchor" id="kaldi_for_dummies_data"></a>
Data preparation</h1>
<h2><a class="anchor" id="kaldi_for_dummies_audio"></a>
Audio data</h2>
<p>I assume that you want to set up an ASR system, basing on your own audio data. For example - let it be a set of 100 files. File format is WAV. Each file contains 3 spoken digits recorded in english language, one by one. Each of these audio files is named in a recognizable way (e.g. <code>1_5_6.wav</code>, which in my pattern means that the spoken sentence is 'one, five, six') and placed in the recognizable folder representing particular speaker during a particular recording session (there may be a situation that you have recordings of the same person but in two different quality/noise environments - put these in separate folders). So to sum up, my exemplary data set looks like this:</p><ul>
<li>10 different speakers (ASR systems must be trained and tested on different speakers, the more speakers you have the better),</li>
<li>each speaker says 10 sentences,</li>
<li>100 senteces/utterances (in 100 *.wav files placed in 10 folders related to particular speakers - 10 *.wav files in each folder),</li>
<li>300 words (digits from zero to nine),</li>
<li>each sentence/utterance consist of 3 words.</li>
</ul>
<p>Whatever your first data set is, adjust my example to your particular case. Be careful with big data sets and complex grammars - start with something simple. Sentences that contain only digits are perfect in this case.</p>
<h2>Task</h2>
<p>Go to <code>kaldi-trunk/egs/digits</code> directory and create <code>digits_audio</code> folder. In <code>kaldi-trunk/egs/digits/digits_audio</code> create two folders: <code>train</code> and <code>test</code>. Select one speaker of your choice to represent testing data set. Use this speaker's 'speakerID' as a name for an another new folder in <code>kaldi-trunk/egs/digits/digits_audio/test</code> directory. Then put there all the audio files related to that person. Put the rest (9 speakers) into <code>train</code> folder - this will be your training data set. Also create subfolders for each speaker.</p>
<h2><a class="anchor" id="kaldi_for_dummies_acoustic"></a>
Acoustic data</h2>
<p>Now you have to create some text files that will allow Kaldi to communicate with your audio data. Consider these files as 'must be done'. Each file that you will create in this section (and in <a class="el" href="kaldi_for_dummies.html#kaldi_for_dummies_language">Language data</a> section as well) can be considered as a text file with some number of strings (each string in a new line). These strings need to be sorted. If you will encounter any sorting issues you can use Kaldi scripts for checking (<code>utils/validate_data_dir.sh</code>) and fixing (<code>utils/fix_data_dir.sh</code>) data order. And for you information - <code>utils</code> directory will be attached to your project in <a class="el" href="kaldi_for_dummies.html#kaldi_for_dummies_tools">Tools attachment</a> section.</p>
<h2>Task</h2>
<p>In <code>kaldi-trunk/egs/digits</code> directory, create a folder <code>data</code>. Then create <code>test</code> and <code>train</code> subfolders inside. Create in each subfolder following files (so you have files named in <b>the same way in <code>test</code> and <code>train</code> subfolders but they relate to two different data sets</b> that you created before):</p>
<p>a.) <code>spk2gender</code> <br />
 This file informs about speakers gender. As we assumed, 'speakerID' is a unique name of each speaker (in this case it is also a 'recordingID' - every speaker has only one audio data folder from one recording session). In my example there are 5 female and 5 male speakers (f = female, m = male).</p>
<p><b>Pattern:</b> &lt;speakerID&gt; &lt;gender&gt; </p><pre class="fragment">cristine f
dad m
josh m
july f
# and so on...
</pre><p>b.) <code>wav.scp</code> <br />
 This file connects every utterance (sentence said by one person during particular recording session) with an audio file related to this utterance. If you stick to my naming approach, 'utteranceID' is nothing more than 'speakerID' (speaker's folder name) glued with *.wav file name without '.wav' ending (look for examples below).</p>
<p><b>Pattern:</b> &lt;uterranceID&gt; &lt;full_path_to_audio_file&gt; </p><pre class="fragment">dad_4_4_2 /home/{user}/kaldi-trunk/egs/digits/digits_audio/train/dad/4_4_2.wav
july_1_2_5 /home/{user}/kaldi-trunk/egs/digits/digits_audio/train/july/1_2_5.wav
july_6_8_3 /home/{user}/kaldi-trunk/egs/digits/digits_audio/train/july/6_8_3.wav
# and so on...
</pre><p>c.) <code>text</code> <br />
 This file contains every utterance matched with its text transcription.</p>
<p><b>Pattern:</b> &lt;uterranceID&gt; &lt;text_transcription&gt; </p><pre class="fragment">dad_4_4_2 four four two
july_1_2_5 one two five
july_6_8_3 six eight three
# and so on...
</pre><p>d.) <code>utt2spk</code> <br />
 This file tells the ASR system which utterance belongs to particular speaker.</p>
<p><b>Pattern:</b> &lt;uterranceID&gt; &lt;speakerID&gt; </p><pre class="fragment">dad_4_4_2 dad
july_1_2_5 july
july_6_8_3 july
# and so on...
</pre><p>e.) <code>corpus.txt</code> <br />
 This file has a slightly different directory. In <code>kaldi-trunk/egs/digits/data</code> create another folder <code>local</code>. In <code>kaldi-trunk/egs/digits/data/local</code> create a file <code>corpus.txt</code> which should contain every single utterance transcription that can occur in your ASR system (in our case it will be 100 lines from 100 audio files).</p>
<p><b>Pattern:</b> &lt;text_transcription&gt; </p><pre class="fragment">one two five
six eight three
four four two
# and so on...
</pre><h2><a class="anchor" id="kaldi_for_dummies_language"></a>
Language data</h2>
<p>This section relates to language modelling files that also need to be considered as 'must be done'. Look for the syntax details here: <a class="el" href="data_prep.html">Data preparation</a> (each file is precisely described). Also feel free to read some examples in other <code>egs</code> scripts. Now is the perfect time.</p>
<h2>Task</h2>
<p>In <code>kaldi-trunk/egs/digits/data/local</code> directory, create a folder <code>dict</code>. In <code>kaldi-trunk/egs/digits/data/local/dict</code> create following files:</p>
<p>a.) <code>lexicon.txt</code> <br />
 This file contains every word from your dictionary with its 'phone transcriptions' (taken from <code>/egs/voxforge</code>).</p>
<p><b>Pattern:</b> &lt;word&gt; &lt;phone 1&gt; &lt;phone 2&gt; ... </p><pre class="fragment">!SIL sil
&lt;UNK&gt; spn
eight ey t
five f ay v
four f ao r
nine n ay n
one hh w ah n
one w ah n
seven s eh v ah n
six s ih k s
three th r iy
two t uw
zero z ih r ow
zero z iy r ow
</pre><p>b.) <code>nonsilence_phones.txt</code> <br />
 This file lists nonsilence phones that are present in your project.</p>
<p><b>Pattern:</b> &lt;phone&gt; </p><pre class="fragment">ah
ao
ay
eh
ey
f
hh
ih
iy
k
n
ow
r
s
t
th
uw
w
v
z
</pre><p>c.) <code>silence_phones.txt</code> <br />
 This file lists silence phones.</p>
<p><b>Pattern:</b> &lt;phone&gt; </p><pre class="fragment">sil
spn
</pre><p>d.) <code>optional_silence.txt</code> <br />
 This file lists optional silence phones.</p>
<p><b>Pattern:</b> &lt;phone&gt; </p><pre class="fragment">sil
</pre><h1><a class="anchor" id="kaldi_for_dummies_finalization"></a>
Project finalization</h1>
<p>Last chapter before runnig scripts creation. Your project structure will become complete.</p>
<h2><a class="anchor" id="kaldi_for_dummies_tools"></a>
Tools attachment</h2>
<p>You need to add necessary Kaldi tools that are widely used in exemplary scripts.</p>
<h2>Task</h2>
<p>From <code>kaldi-trunk/egs/wsj/s5</code> copy two folders (with the whole content) - <code>utils</code> and <code>steps</code> - and put them in your <code>kaldi-trunk/egs/digits</code> directory. You can also create links to these directories. You may find such links in, for example, <code>kaldi-trunk/egs/voxforge/s5</code>.</p>
<h2><a class="anchor" id="kaldi_for_dummies_scoring"></a>
Scoring script</h2>
<p>This script will help you to get decoding results.</p>
<h2>Task</h2>
<p>From <code>kaldi-trunk/egs/voxforge/s5/local</code> copy the script <code>score.sh</code> into similar location in your project (<code>kaldi-trunk/egs/digits/local</code>).</p>
<h2><a class="anchor" id="kaldi_for_dummies_srilm"></a>
SRILM installation</h2>
<p>You also need to install language modelling toolkit that is used in my example - SRI Language Modeling Toolkit (SRILM).</p>
<h2>Task</h2>
<p>For detailed installation instructions go to <code>kaldi-trunk/tools/install_srilm.sh</code> (read all comments inside).</p>
<h2><a class="anchor" id="kaldi_for_dummies_configuration"></a>
Configuration files</h2>
<p>It is not necessary to create configuration files but it can be a good habit for future.</p>
<h2>Task</h2>
<p>In <code>kaldi-trunk/egs/digits</code> create a folder <code>conf</code>. Inside <code>kaldi-trunk/egs/digits/conf</code> create two files (for some configuration modifications in decoding and mfcc feature extraction processes - taken from <code>/egs/voxforge</code>):</p>
<p>a.) <code>decode.config</code> <br />
 </p><pre class="fragment">first_beam=10.0
beam=13.0
lattice_beam=6.0
</pre><p>b.) <code>mfcc.conf</code> <br />
 </p><pre class="fragment">--use-energy=false
</pre><h1><a class="anchor" id="kaldi_for_dummies_running"></a>
Running scripts creation</h1>
<p>Your first ASR system written in Kaldi environment is almost ready. Your last job is to prepare running scripts to create ASR system of your choice. I put some comments in prepared scripts for ease of understanding.</p>
<p>These scripts are based on solution used in <code>/egs/voxforge</code> directory. I decided to use two different training methods:</p><ul>
<li>MONO - monophone training,</li>
<li>TRI1 - simple triphone training (first triphone pass).</li>
</ul>
<p>These two methods are enough to show noticable differences in decoding results using only digits lexicon and small training data set.</p>
<h2>Task</h2>
<p>In <code>kaldi-trunk/egs/digits</code> directory create 3 scripts:</p>
<p>a.) <code>cmd.sh</code> <br />
 </p><div class="fragment"><div class="line"># Setting local system jobs (local CPU - no external clusters)</div><div class="line">export train_cmd=run.pl</div><div class="line">export decode_cmd=run.pl</div></div><!-- fragment --><p>b.) <code>path.sh</code> <br />
 </p><div class="fragment"><div class="line"># Defining Kaldi root directory</div><div class="line">export KALDI_ROOT=`pwd`/../..</div><div class="line"></div><div class="line"># Setting paths to useful tools</div><div class="line">export PATH=$PWD/utils/:$KALDI_ROOT/src/bin:$KALDI_ROOT/tools/openfst/bin:$KALDI_ROOT/src/fstbin/:$KALDI_ROOT/src/gmmbin/:$KALDI_ROOT/src/featbin/:$KALDI_ROOT/src/lmbin/:$KALDI_ROOT/src/sgmm2bin/:$KALDI_ROOT/src/fgmmbin/:$KALDI_ROOT/src/latbin/:$PWD:$PATH</div><div class="line"></div><div class="line"># Defining audio data directory (modify it for your installation directory!)</div><div class="line">export DATA_ROOT=&quot;/home/{user}/kaldi-trunk/egs/digits/digits_audio&quot;</div><div class="line"></div><div class="line"># Enable SRILM</div><div class="line">. $KALDI_ROOT/tools/env.sh</div><div class="line"></div><div class="line"># Variable needed for proper data sorting</div><div class="line">export LC_ALL=C</div></div><!-- fragment --><p>c.) <code>run.sh</code> </p><div class="fragment"><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">. ./path.sh || exit 1</div><div class="line">. ./cmd.sh || exit 1</div><div class="line"></div><div class="line">nj=1       # number of parallel jobs - 1 is perfect for such a small data set</div><div class="line">lm_order=1 # language model order (n-gram quantity) - 1 is enough for digits grammar</div><div class="line"></div><div class="line"># Safety mechanism (possible running this script with modified arguments)</div><div class="line">. utils/parse_options.sh || exit 1</div><div class="line">[[ $# -ge 1 ]] &amp;&amp; { echo &quot;Wrong arguments!&quot;; exit 1; }</div><div class="line"></div><div class="line"># Removing previously created data (from last run.sh execution)</div><div class="line">rm -rf exp mfcc data/train/spk2utt data/train/cmvn.scp data/train/feats.scp data/train/split1 data/test/spk2utt data/test/cmvn.scp data/test/feats.scp data/test/split1 data/local/lang data/lang data/local/tmp data/local/dict/lexiconp.txt</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== PREPARING ACOUSTIC DATA =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line"># Needs to be prepared by hand (or using self written scripts):</div><div class="line">#</div><div class="line"># spk2gender  [&lt;speaker-id&gt; &lt;gender&gt;]</div><div class="line"># wav.scp     [&lt;uterranceID&gt; &lt;full_path_to_audio_file&gt;]</div><div class="line"># text        [&lt;uterranceID&gt; &lt;text_transcription&gt;]</div><div class="line"># utt2spk     [&lt;uterranceID&gt; &lt;speakerID&gt;]</div><div class="line"># corpus.txt  [&lt;text_transcription&gt;]</div><div class="line"></div><div class="line"># Making spk2utt files</div><div class="line">utils/utt2spk_to_spk2utt.pl data/train/utt2spk &gt; data/train/spk2utt</div><div class="line">utils/utt2spk_to_spk2utt.pl data/test/utt2spk &gt; data/test/spk2utt</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== FEATURES EXTRACTION =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line"># Making feats.scp files</div><div class="line">mfccdir=mfcc</div><div class="line"># Uncomment and modify arguments in scripts below if you have any problems with data sorting</div><div class="line"># utils/validate_data_dir.sh data/train     # script for checking prepared data - here: for data/train directory</div><div class="line"># utils/fix_data_dir.sh data/train          # tool for data proper sorting if needed - here: for data/train directory</div><div class="line">steps/make_mfcc.sh --nj $nj --cmd &quot;$train_cmd&quot; data/train exp/make_mfcc/train $mfccdir</div><div class="line">steps/make_mfcc.sh --nj $nj --cmd &quot;$train_cmd&quot; data/test exp/make_mfcc/test $mfccdir</div><div class="line"></div><div class="line"># Making cmvn.scp files</div><div class="line">steps/compute_cmvn_stats.sh data/train exp/make_mfcc/train $mfccdir</div><div class="line">steps/compute_cmvn_stats.sh data/test exp/make_mfcc/test $mfccdir</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== PREPARING LANGUAGE DATA =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line"># Needs to be prepared by hand (or using self written scripts):</div><div class="line">#</div><div class="line"># lexicon.txt           [&lt;word&gt; &lt;phone 1&gt; &lt;phone 2&gt; ...]</div><div class="line"># nonsilence_phones.txt [&lt;phone&gt;]</div><div class="line"># silence_phones.txt    [&lt;phone&gt;]</div><div class="line"># optional_silence.txt  [&lt;phone&gt;]</div><div class="line"></div><div class="line"># Preparing language data</div><div class="line">utils/prepare_lang.sh data/local/dict &quot;&lt;UNK&gt;&quot; data/local/lang data/lang</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== LANGUAGE MODEL CREATION =====&quot;</div><div class="line">echo &quot;===== MAKING lm.arpa =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line">loc=`which ngram-count`;</div><div class="line">if [ -z $loc ]; then</div><div class="line">        if uname -a | grep 64 &gt;/dev/null; then</div><div class="line">                sdir=$KALDI_ROOT/tools/srilm/bin/i686-m64</div><div class="line">        else</div><div class="line">                        sdir=$KALDI_ROOT/tools/srilm/bin/i686</div><div class="line">        fi</div><div class="line">        if [ -f $sdir/ngram-count ]; then</div><div class="line">                        echo &quot;Using SRILM language modelling tool from $sdir&quot;</div><div class="line">                        export PATH=$PATH:$sdir</div><div class="line">        else</div><div class="line">                        echo &quot;SRILM toolkit is probably not installed.</div><div class="line">                                Instructions: tools/install_srilm.sh&quot;</div><div class="line">                        exit 1</div><div class="line">        fi</div><div class="line">fi</div><div class="line"></div><div class="line">local=data/local</div><div class="line">mkdir $local/tmp</div><div class="line">ngram-count -order $lm_order -write-vocab $local/tmp/vocab-full.txt -wbdiscount -text $local/corpus.txt -lm $local/tmp/lm.arpa</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== MAKING G.fst =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line">lang=data/lang</div><div class="line">arpa2fst --disambig-symbol=#0 --read-symbol-table=$lang/words.txt $local/tmp/lm.arpa $lang/G.fst</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== MONO TRAINING =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line">steps/train_mono.sh --nj $nj --cmd &quot;$train_cmd&quot; data/train data/lang exp/mono  || exit 1</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== MONO DECODING =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line">utils/mkgraph.sh --mono data/lang exp/mono exp/mono/graph || exit 1</div><div class="line">steps/decode.sh --config conf/decode.config --nj $nj --cmd &quot;$decode_cmd&quot; exp/mono/graph data/test exp/mono/decode</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== MONO ALIGNMENT =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line">steps/align_si.sh --nj $nj --cmd &quot;$train_cmd&quot; data/train data/lang exp/mono exp/mono_ali || exit 1</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== TRI1 (first triphone pass) TRAINING =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line">steps/train_deltas.sh --cmd &quot;$train_cmd&quot; 2000 11000 data/train data/lang exp/mono_ali exp/tri1 || exit 1</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== TRI1 (first triphone pass) DECODING =====&quot;</div><div class="line">echo</div><div class="line"></div><div class="line">utils/mkgraph.sh data/lang exp/tri1 exp/tri1/graph || exit 1</div><div class="line">steps/decode.sh --config conf/decode.config --nj $nj --cmd &quot;$decode_cmd&quot; exp/tri1/graph data/test exp/tri1/decode</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;===== run.sh script is finished =====&quot;</div><div class="line">echo</div></div><!-- fragment --><h1><a class="anchor" id="kaldi_for_dummies_results"></a>
Getting results</h1>
<p>Now all you have to do is to run <code>run.sh</code> script. If I have made any mistakes in this tutorial, logs from the terminal should guide you how to deal with it.</p>
<p>Besides the fact that you will notice some decoding results in the terminal window, go to newly made <code>kaldi-trunk/egs/digits/exp</code>. You may notice there folders with <code>mono</code> and <code>tri1</code> results as well - directories structure are the same. Go to <code>mono/decode</code> directory. Here you may find result files (named in a <code>wer_{number}</code> way). Logs for decoding process may be found in <code>log</code> folder (same directory).</p>
<h1><a class="anchor" id="kaldi_for_dummies_summary"></a>
Summary</h1>
<p>This is just an example. The point of this short tutorial is to show you how to create 'anything' in Kaldi and to get a better understanding of how to think while using this toolkit. Personally I started with looking for tutorials made by the Kaldi authors/developers. After succesful Kaldi installation I launched some example scripts (Yesno, Voxforge, LibriSpeech - they are relatively easy and have free acoustic/language data to download - I used these three as a base for my own scripts).</p>
<p>Make sure you follow <a href="http://kaldi-asr.org/">http://kaldi-asr.org/</a>- official project website. There are two very useful sections for beginners inside: <br />
 a.) <a class="el" href="tutorial.html">Kaldi tutorial</a> - almost 'step by step' tutorial on how to set up an ASR system; up to some point this can be done without RM dataset. It is good to read it, <br />
 b.) <a class="el" href="data_prep.html">Data preparation</a> - very detailed explaination of how to use your own data in Kaldi.</p>
<p>More useful links about Kaldi I found: <br />
 <a href="https://sites.google.com/site/dpovey/kaldi-lectures">https://sites.google.com/site/dpovey/kaldi-lectures </a> - Kaldi lectures created by the main author <br />
 <a href="http://www.superlectures.com/icassp2011/category.php?lang=en&amp;id=131">http://www.superlectures.com/icassp2011/category.php?lang=en&amp;id=131 </a> - similar; video version <br />
 <a href="http://www.diplomovaprace.cz/133/thesis_oplatek.pdf">http://www.diplomovaprace.cz/133/thesis_oplatek.pdf </a> - some master diploma thesis about speech recognition using Kaldi</p>
<p>This is all from my side. Good luck! </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Kaldi</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
