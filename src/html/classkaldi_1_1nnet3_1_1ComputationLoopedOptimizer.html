<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: ComputationLoopedOptimizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ComputationLoopedOptimizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for ComputationLoopedOptimizer:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer__coll__graph.png" border="0" usemap="#ComputationLoopedOptimizer_coll__map" alt="Collaboration graph"/></div>
<map name="ComputationLoopedOptimizer_coll__map" id="ComputationLoopedOptimizer_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab3fd960e56dece4b5af4efa3fc35d98f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ab3fd960e56dece4b5af4efa3fc35d98f">ComputationLoopedOptimizer</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:ab3fd960e56dece4b5af4efa3fc35d98f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdecf85ba9844b9db2d0649ff34139c8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#acdecf85ba9844b9db2d0649ff34139c8">Optimize</a> ()</td></tr>
<tr class="separator:acdecf85ba9844b9db2d0649ff34139c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a40b93bc9e9fe7dccea10334ecf8edf2a"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a40b93bc9e9fe7dccea10334ecf8edf2a">FindTimeShift</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation)</td></tr>
<tr class="separator:a40b93bc9e9fe7dccea10334ecf8edf2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afffba6e2f4c37c755f2ab63893d2d8b9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#afffba6e2f4c37c755f2ab63893d2d8b9">CreateMatrixPairs</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *matrix_to_pair)</td></tr>
<tr class="separator:afffba6e2f4c37c755f2ab63893d2d8b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75060dc1f93ff9085cc6a6f0bf2d2f30"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a75060dc1f93ff9085cc6a6f0bf2d2f30">NormalizeCindexes</a> (std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *cindexes)</td></tr>
<tr class="separator:a75060dc1f93ff9085cc6a6f0bf2d2f30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac797c8d6a701fb10dc8de13d2db3dcbe"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac797c8d6a701fb10dc8de13d2db3dcbe">GetPairToMatrixMap</a> (std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;matrix_to_pair, unordered_map&lt; std::pair&lt; int32, int32 &gt;, int32, <a class="el" href="structkaldi_1_1PairHasher.html">PairHasher</a>&lt; int32 &gt; &gt; *pair_to_matrix)</td></tr>
<tr class="separator:ac797c8d6a701fb10dc8de13d2db3dcbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72907a94f0ef8ddc489134dad4fba1aa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a72907a94f0ef8ddc489134dad4fba1aa">ConvertListsToPairLists</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;active_matrices, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;matrix_to_pair, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *active_pairs)</td></tr>
<tr class="separator:a72907a94f0ef8ddc489134dad4fba1aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0208954d6ae356dca488033ecea40274"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a0208954d6ae356dca488033ecea40274">ListsAreEqualExceptForPossibleShift</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;a, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;b, int32 shift)</td></tr>
<tr class="separator:a0208954d6ae356dca488033ecea40274"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45761855efc1786f2089e550ec71712a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a45761855efc1786f2089e550ec71712a">FindFirstRepeat</a> (const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;active_pairs, int32 time_shift_per_segment, int32 *seg1, int32 *seg2)</td></tr>
<tr class="separator:a45761855efc1786f2089e550ec71712a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50e8cbb0a710d4d2862d8b19c72902bc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a50e8cbb0a710d4d2862d8b19c72902bc">GetIdentifiedMatrices</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;pair_list1, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;pair_list2, const unordered_map&lt; std::pair&lt; int32, int32 &gt;, int32, <a class="el" href="structkaldi_1_1PairHasher.html">PairHasher</a>&lt; int32 &gt; &gt; &amp;pair_to_matrix, std::vector&lt; int32 &gt; *matrix_list1, std::vector&lt; int32 &gt; *matrix_list2)</td></tr>
<tr class="separator:a50e8cbb0a710d4d2862d8b19c72902bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a283d532b71865991e14f83433b440332"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a283d532b71865991e14f83433b440332">CheckIdentifiedMatrices</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, const std::vector&lt; int32 &gt; &amp;list1, const std::vector&lt; int32 &gt; &amp;list2, int32 time_difference)</td></tr>
<tr class="separator:a283d532b71865991e14f83433b440332"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70c1595b263268a6a0ec5bd2468151bc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a70c1595b263268a6a0ec5bd2468151bc">FormInfiniteLoop</a> (int32 command1, int32 command2, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a70c1595b263268a6a0ec5bd2468151bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae93293e76f4dc9049065601362e9bc2e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ae93293e76f4dc9049065601362e9bc2e">AddMatrixSwapCommands</a> (const std::vector&lt; int32 &gt; &amp;matrices1, const std::vector&lt; int32 &gt; &amp;matrices2, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:ae93293e76f4dc9049065601362e9bc2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69d4034713b69fe896cf7fd0566c3216"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a69d4034713b69fe896cf7fd0566c3216">GetMatrixSwapOrder</a> (const std::vector&lt; int32 &gt; &amp;matrices1, const std::vector&lt; int32 &gt; &amp;matrices2, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *swaps)</td></tr>
<tr class="separator:a69d4034713b69fe896cf7fd0566c3216"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a768ce6ef8c9f2cd1b13dee1164c38213"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a768ce6ef8c9f2cd1b13dee1164c38213">FindActiveMatrices</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, const <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;analyzer, const std::vector&lt; int32 &gt; &amp;splice_point_commands, std::vector&lt; std::vector&lt; int32 &gt; &gt; *active_matrices)</td></tr>
<tr class="memdesc:a768ce6ef8c9f2cd1b13dee1164c38213"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a list of command indexes ('splice_point_commands') which are expected to be command indexes of the kNoOperationMarker at segment boundaries, this function outputs for each of these command indexes a list of matrices which are 'active' at that point in time.  <a href="#a768ce6ef8c9f2cd1b13dee1164c38213">More...</a><br /></td></tr>
<tr class="separator:a768ce6ef8c9f2cd1b13dee1164c38213"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:adbabf05a7702103113a02a113015205f"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a></td></tr>
<tr class="separator:adbabf05a7702103113a02a113015205f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36d13565d1302a2bf74127b141ba3537"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a></td></tr>
<tr class="separator:a36d13565d1302a2bf74127b141ba3537"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8ca96df1ecdb635738c59a88cff8835"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a></td></tr>
<tr class="separator:ac8ca96df1ecdb635738c59a88cff8835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0eab3be8e97f0ed110d0998bc2bc0a1"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac0eab3be8e97f0ed110d0998bc2bc0a1">matrix_to_pair_</a></td></tr>
<tr class="separator:ac0eab3be8e97f0ed110d0998bc2bc0a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8364fb4b69f001a20545ea5b1a2c65f"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int32 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#af8364fb4b69f001a20545ea5b1a2c65f">splice_point_commands_</a></td></tr>
<tr class="separator:af8364fb4b69f001a20545ea5b1a2c65f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03890">3890</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ab3fd960e56dece4b5af4efa3fc35d98f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3fd960e56dece4b5af4efa3fc35d98f">&#9670;&nbsp;</a></span>ComputationLoopedOptimizer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html">ComputationLoopedOptimizer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03892">3892</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize_8cc_source.html#l00501">kaldi::nnet3::Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;                                                          :</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>(nnet), <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>(computation) { }</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::ComputationLoopedOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04061">nnet-optimize-utils.cc:4061</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::ComputationLoopedOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04062">nnet-optimize-utils.cc:4062</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ae93293e76f4dc9049065601362e9bc2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae93293e76f4dc9049065601362e9bc2e">&#9670;&nbsp;</a></span>AddMatrixSwapCommands()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AddMatrixSwapCommands </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>matrices1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>matrices2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04419">4419</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-computation_8cc_source.html#l01173">NnetComputation::GetWholeSubmatrices()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kaldi::nnet3::kGotoLabel</a>, and <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kSwapMatrix</a>.</p>
<div class="fragment"><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;                                  {</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; swaps;</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;  <span class="comment">// Note: in &#39;easy&#39; cases where matrices1 and matrices2 are disjoint,</span></div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;  <span class="comment">// &#39;swaps&#39; will just be the vector { (matrices1[0],matrices2[0]),</span></div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;  <span class="comment">// (matrices1[1],matrices2[1]), ... },</span></div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;  <span class="comment">// but in some cases these may need to get reordered.</span></div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a69d4034713b69fe896cf7fd0566c3216">GetMatrixSwapOrder</a>(matrices1, matrices2, &amp;swaps);</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;  NnetComputation::Command goto_label_command = computation-&gt;commands.back();</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(goto_label_command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>);</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;  computation-&gt;commands.pop_back();</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;  <span class="comment">// the following vector gives us, for each matrix index, a submatrix index</span></div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;  <span class="comment">// that covers the whole of that matrix (needed because the commands</span></div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;  <span class="comment">// require submatrix indexes)</span></div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;  std::vector&lt;int32&gt; whole_submatrices;</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;  computation-&gt;GetWholeSubmatrices(&amp;whole_submatrices);</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;  <span class="keywordtype">size_t</span> num_matrices = whole_submatrices.size();</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; swaps.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;    int32 m1 = swaps[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first, m2 = swaps[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(m1) &lt; num_matrices &amp;&amp;</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;                 static_cast&lt;size_t&gt;(m2) &lt; num_matrices);</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;    int32 s1 = whole_submatrices[m1], s2 = whole_submatrices[m2];</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;    computation-&gt;commands.push_back(</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;        NnetComputation::Command(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>, s1, s2));</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;  }</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;  computation-&gt;commands.push_back(goto_label_command);</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a69d4034713b69fe896cf7fd0566c3216"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a69d4034713b69fe896cf7fd0566c3216">kaldi::nnet3::ComputationLoopedOptimizer::GetMatrixSwapOrder</a></div><div class="ttdeci">static void GetMatrixSwapOrder(const std::vector&lt; int32 &gt; &amp;matrices1, const std::vector&lt; int32 &gt; &amp;matrices2, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *swaps)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04367">nnet-optimize-utils.cc:4367</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a283d532b71865991e14f83433b440332"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a283d532b71865991e14f83433b440332">&#9670;&nbsp;</a></span>CheckIdentifiedMatrices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CheckIdentifiedMatrices </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>list1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>list2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>time_difference</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04331">4331</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00317">NnetComputation::MatrixDebugInfo::cindexes</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00316">NnetComputation::MatrixDebugInfo::is_deriv</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-common_8cc_source.html#l00573">kaldi::nnet3::kNoTime</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, <a class="el" href="nnet-computation_8h_source.html#l00306">NnetComputation::MatrixInfo::num_cols</a>, <a class="el" href="nnet-computation_8h_source.html#l00305">NnetComputation::MatrixInfo::num_rows</a>, and <a class="el" href="nnet-computation_8h_source.html#l00307">NnetComputation::MatrixInfo::stride_type</a>.</p>
<div class="fragment"><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;                           {</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(time_difference &gt; 0);</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(list1.size() == list2.size());</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!computation.matrix_debug_info.empty());</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; list1.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;    int32 m1 = list1[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], m2 = list2[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;    <span class="keyword">const</span> NnetComputation::MatrixInfo</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;        &amp;matrix_info1 = computation.matrices[m1],</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;        &amp;matrix_info2 = computation.matrices[m2];</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(matrix_info1.num_rows == matrix_info2.num_rows &amp;&amp;</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;                 matrix_info1.num_cols == matrix_info2.num_cols &amp;&amp;</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;                 matrix_info1.stride_type == matrix_info2.stride_type);</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;    <span class="keyword">const</span> NnetComputation::MatrixDebugInfo</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;        &amp;debug_info1 = computation.matrix_debug_info[m1],</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        &amp;debug_info2 = computation.matrix_debug_info[m2];</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(debug_info1.is_deriv == debug_info2.is_deriv);</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(debug_info1.cindexes.size() == debug_info2.cindexes.size());</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;    std::vector&lt;Cindex&gt;::const_iterator iter1 = debug_info1.cindexes.begin(),</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;        end1 = debug_info1.cindexes.end(),</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;        iter2 = debug_info2.cindexes.begin();</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;    <span class="keywordflow">for</span> (; iter1 != end1; iter1++,iter2++) {</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter2-&gt;first == iter1-&gt;first &amp;&amp;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;                   iter2-&gt;second.n == iter1-&gt;second.n &amp;&amp;</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;                   ((iter1-&gt;second.t == <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a> &amp;&amp; iter2-&gt;second.t == <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>) ||</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;                    iter2-&gt;second.t == iter1-&gt;second.t + time_difference) &amp;&amp;</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;                   iter2-&gt;second.x == iter1-&gt;second.x);</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    }</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;  }</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac952f0840a7950dff80c1a89e69656d7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kaldi::nnet3::kNoTime</a></div><div class="ttdeci">const int kNoTime</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00573">nnet-common.cc:573</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72907a94f0ef8ddc489134dad4fba1aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72907a94f0ef8ddc489134dad4fba1aa">&#9670;&nbsp;</a></span>ConvertListsToPairLists()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ConvertListsToPairLists </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>active_matrices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>matrix_to_pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>active_pairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04189">4189</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;                                                                   {</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;  active_pairs-&gt;clear();</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;  active_pairs-&gt;resize(active_matrices.size());</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;  int32 num_matrices = matrix_to_pair.size();</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> seg = 0; seg &lt; active_matrices.size(); seg++) {</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;    <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;this_active_matrix_list = active_matrices[seg];</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;this_active_pair_list =</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;        (*active_pairs)[seg];</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;    this_active_pair_list.resize(this_active_matrix_list.size());</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = this_active_matrix_list.begin(),</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;        end = this_active_matrix_list.end();</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::iterator</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;        out_iter = this_active_pair_list.begin();</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter, ++out_iter) {</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(*iter &gt; 0 &amp;&amp; *iter &lt; num_matrices);</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;      *out_iter = matrix_to_pair[*iter];</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    }</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;  }</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afffba6e2f4c37c755f2ab63893d2d8b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afffba6e2f4c37c755f2ab63893d2d8b9">&#9670;&nbsp;</a></span>CreateMatrixPairs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CreateMatrixPairs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>matrix_to_pair</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04144">4144</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, and <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>.</p>
<div class="fragment"><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;                                                       {</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;  <span class="keyword">typedef</span> unordered_map&lt;std::vector&lt;Cindex&gt;, int32,</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;                        CindexVectorHasher&gt; MapType;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;  int32 cur_vector_id = 1;</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;  <span class="comment">// Note: cindex_map just maps the vector&lt;Cindex&gt; to a unique value,</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;  <span class="comment">// and then we manually work out a unique id that takes into</span></div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;  <span class="comment">// account the &#39;is_deriv&#39; values.</span></div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;  MapType cindex_map;</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;  int32 num_matrices = computation.matrices.size();</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;  matrix_to_pair-&gt;resize(num_matrices);</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation.matrix_debug_info.size() == num_matrices);</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!computation.matrix_debug_info[m].cindexes.empty());</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;    std::vector&lt;Cindex&gt; cindexes = computation.matrix_debug_info[m].cindexes;</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;    int32 t_offset = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a75060dc1f93ff9085cc6a6f0bf2d2f30">NormalizeCindexes</a>(&amp;cindexes);</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;    MapType::const_iterator iter = cindex_map.find(cindexes);</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;    int32 vector_id;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;    <span class="keywordflow">if</span> (iter != cindex_map.end()) {</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;      vector_id = iter-&gt;second;</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      vector_id = cur_vector_id++;</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;      cindex_map[cindexes] = vector_id;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;    }</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;    <span class="keywordtype">bool</span> is_deriv = computation.matrix_debug_info[m].is_deriv;</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;    int32 unique_id = 2 * vector_id + (is_deriv ? 1 : 0);</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;    (*matrix_to_pair)[m].first = unique_id;</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;    (*matrix_to_pair)[m].second = t_offset;</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;  }</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a75060dc1f93ff9085cc6a6f0bf2d2f30"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a75060dc1f93ff9085cc6a6f0bf2d2f30">kaldi::nnet3::ComputationLoopedOptimizer::NormalizeCindexes</a></div><div class="ttdeci">static int32 NormalizeCindexes(std::vector&lt; Cindex &gt; *cindexes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04121">nnet-optimize-utils.cc:4121</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a768ce6ef8c9f2cd1b13dee1164c38213"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a768ce6ef8c9f2cd1b13dee1164c38213">&#9670;&nbsp;</a></span>FindActiveMatrices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void FindActiveMatrices </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;&#160;</td>
          <td class="paramname"><em>analyzer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>splice_point_commands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>active_matrices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Given a list of command indexes ('splice_point_commands') which are expected to be command indexes of the kNoOperationMarker at segment boundaries, this function outputs for each of these command indexes a list of matrices which are 'active' at that point in time. </p>
<p>By 'active' we mean that the matrix has been written to before that time (including zeroing), and will be read after that time. These is the list of matrices that 'need to be in scope' at those points in time. '*active_matrices' is indexed by the same index as 'splice_point_commands', and is then a list of active matrices, in numerical order of matrix index. Note: for each i, (*active_matrices)[i] will be sorted and unique. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04293">4293</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8cc_source.html#l01182">ComputationAnalysis::FirstNontrivialAccess()</a>, <a class="el" href="nnet-computation_8cc_source.html#l01173">NnetComputation::GetWholeSubmatrices()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01264">ComputationAnalysis::LastAccess()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>.</p>
<div class="fragment"><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;                                                   {</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;  int32 num_matrices = computation.matrices.size();</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;  int32 num_splice_points = splice_point_commands.size();</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;  active_matrices-&gt;clear();</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;  active_matrices-&gt;resize(num_splice_points);</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;  <span class="comment">// this object just makes available some extra functions, vs. the Analyzer</span></div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;  <span class="comment">// object.</span></div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;  ComputationAnalysis analysis(computation, analyzer);</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(splice_point_commands));</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;  <span class="comment">// the following vector gives us, for each matrix index, a submatrix index</span></div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;  <span class="comment">// that covers the whole of that matrix (needed by interface of &#39;analysis&#39; object).</span></div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;  std::vector&lt;int32&gt; whole_submatrices;</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;  computation.GetWholeSubmatrices(&amp;whole_submatrices);</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;    <span class="comment">// the following are command indexes, comparable with the indexes</span></div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;    <span class="comment">// in &#39;splice_point_commands&#39;.</span></div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;    int32 s = whole_submatrices[m],  <span class="comment">// submatrix consisting of the whole of</span></div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;                                     <span class="comment">// &#39;m&#39;.</span></div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        first_access = analysis.FirstNontrivialAccess(s),</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;        last_access = analysis.LastAccess(s);</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_splice_points; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;      int32 splice_point = splice_point_commands[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;      <span class="keywordflow">if</span> (first_access &lt; splice_point &amp;&amp; last_access &gt; splice_point) {</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        <span class="comment">// If the block of time during which the matrix is accessed, includes</span></div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        <span class="comment">// this command index, then the matrix is considered &#39;active&#39; at this</span></div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;        <span class="comment">// time.</span></div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;        (*active_matrices)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].push_back(m);</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;      }</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;    }</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;  }</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45761855efc1786f2089e550ec71712a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45761855efc1786f2089e550ec71712a">&#9670;&nbsp;</a></span>FindFirstRepeat()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> FindFirstRepeat </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>active_pairs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>time_shift_per_segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>seg1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>seg2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04232">4232</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;                              {</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;  int32 num_segments = active_pairs.size();</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;  <span class="comment">// This algorithm may seem like it would be very slow, but the number of</span></div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;  <span class="comment">// segments will normally be quite small (e.g. 10), and the comparison of</span></div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;  <span class="comment">// elements of &#39;active_pairs&#39; should be fast in cases where they</span></div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;  <span class="comment">// differ.</span></div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_segments &gt;= 2);</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;  <span class="keywordflow">for</span> (int32 s = 0; s &lt; num_segments; s++) {</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;    <span class="keywordflow">for</span> (int32 t = s + 1; t &lt; num_segments; t++) {</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a0208954d6ae356dca488033ecea40274">ListsAreEqualExceptForPossibleShift</a>(active_pairs[s],</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;                                              active_pairs[t],</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;                                              (t - s) * time_shift_per_segment)) {</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;        *seg1 = s;</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;        *seg2 = t;</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;      }</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;    }</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;  }</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a0208954d6ae356dca488033ecea40274"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a0208954d6ae356dca488033ecea40274">kaldi::nnet3::ComputationLoopedOptimizer::ListsAreEqualExceptForPossibleShift</a></div><div class="ttdeci">static bool ListsAreEqualExceptForPossibleShift(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;a, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;b, int32 shift)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04213">nnet-optimize-utils.cc:4213</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40b93bc9e9fe7dccea10334ecf8edf2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40b93bc9e9fe7dccea10334ecf8edf2a">&#9670;&nbsp;</a></span>FindTimeShift()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 FindTimeShift </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04070">4070</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01429">kaldi::nnet3::GetCommandsOfType()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00975">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationMarker</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kaldi::nnet3::kProvideOutput</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;                                        {</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;  std::vector&lt;int32&gt; segment_ends;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a0a04e946fa68432f4e723944ce8ab281">GetCommandsOfType</a>(computation, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>, &amp;segment_ends);</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(segment_ends.size() &gt;= 3);</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;  <span class="comment">// Ignore the first segment as it tends to be a special case</span></div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;  <span class="comment">// (it has more left context),</span></div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;  int32 second_segment_begin = segment_ends[0],</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;      third_segment_begin = segment_ends[1],</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;      fourth_segment_begin = segment_ends[2];</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;  int32 first_output_command_seg2 = -1,</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;      first_output_command_seg3 = -1;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;  <span class="keywordflow">for</span> (int32 c = second_segment_begin; c &lt; third_segment_begin; c++)</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;    <span class="keywordflow">if</span> (computation.commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a> &amp;&amp;</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;        first_output_command_seg2 &lt; 0)</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;      first_output_command_seg2 = c;</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;  <span class="keywordflow">for</span> (int32 c = third_segment_begin; c &lt; fourth_segment_begin; c++)</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    <span class="keywordflow">if</span> (computation.commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a> &amp;&amp;</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;        first_output_command_seg3 &lt; 0)</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;      first_output_command_seg3 = c;</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;  <span class="keywordflow">if</span> (first_output_command_seg2 &lt; 0 ||</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;      first_output_command_seg3 &lt; 0)</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Could not locate output commands for segments 2 and 3.&quot;</span>;</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;  <span class="keyword">const</span> NnetComputation::Command</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;      &amp;command2 = computation.commands[first_output_command_seg2],</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;      &amp;command3 = computation.commands[first_output_command_seg3];</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;  int32 seg2_node = command2.arg2, seg3_node = command3.arg2;</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(seg2_node == seg3_node);</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;  int32 seg2_submatrix = command2.arg1,</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;      seg3_submatrix = command3.arg1;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation.IsWholeMatrix(seg2_submatrix) &amp;&amp;</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;               computation.IsWholeMatrix(seg3_submatrix));</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;  int32 seg2_matrix = computation.submatrices[seg2_submatrix].matrix_index,</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;      seg3_matrix = computation.submatrices[seg3_submatrix].matrix_index;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation.matrices[seg2_matrix].num_rows ==</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;               computation.matrices[seg3_matrix].num_rows);</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!computation.matrix_debug_info.empty());</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;  <span class="keyword">const</span> NnetComputation::MatrixDebugInfo</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;      &amp;debug_info2 = computation.matrix_debug_info[seg2_matrix],</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;      &amp;debug_info3 = computation.matrix_debug_info[seg3_matrix];</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  int32 t_offset = debug_info3.cindexes[0].second.t -</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;      debug_info2.cindexes[0].second.t;</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;  int32 num_rows = debug_info2.cindexes.size();</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;  <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(debug_info3.cindexes[r].second.t ==</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;                 debug_info2.cindexes[r].second.t + t_offset);</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;  }</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  <span class="keywordflow">return</span> t_offset;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a0a04e946fa68432f4e723944ce8ab281"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0a04e946fa68432f4e723944ce8ab281">kaldi::nnet3::GetCommandsOfType</a></div><div class="ttdeci">void GetCommandsOfType(const NnetComputation &amp;computation, CommandType t, std::vector&lt; int32 &gt; *command_indexes)</div><div class="ttdoc">This utility function works out from a computation, the command-indexes of the commands of the given ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01429">nnet-analyze.cc:1429</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a70c1595b263268a6a0ec5bd2468151bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70c1595b263268a6a0ec5bd2468151bc">&#9670;&nbsp;</a></span>FormInfiniteLoop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void FormInfiniteLoop </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>command1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>command2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04453">4453</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kaldi::nnet3::kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationLabel</a>, and <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationPermanent</a>.</p>
<div class="fragment"><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;                                  {</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;int32&gt;(computation-&gt;commands.size()) &gt;=</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;               command2 + 1 &amp;&amp; command1 &lt; command2);</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;      computation-&gt;commands[command1].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a> &amp;&amp;</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;      computation-&gt;commands[command2].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>);</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;  <span class="comment">// Remove any commands after &#39;command2&#39;.</span></div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;  computation-&gt;commands.resize(command2 + 1);</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;  computation-&gt;commands[command2].command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>;</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;  computation-&gt;commands[command2].arg1 = command1;</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;  NnetComputation::Command c(<a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>);</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;  computation-&gt;commands.insert(computation-&gt;commands.begin() + command1,</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;                               c);</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;  <span class="comment">// Now the kNoOperationLabel command is at position &#39;command1&#39;.</span></div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kaldi::nnet3::kNoOperationLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a50e8cbb0a710d4d2862d8b19c72902bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50e8cbb0a710d4d2862d8b19c72902bc">&#9670;&nbsp;</a></span>GetIdentifiedMatrices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void GetIdentifiedMatrices </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>pair_list1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>pair_list2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unordered_map&lt; std::pair&lt; int32, int32 &gt;, int32, <a class="el" href="structkaldi_1_1PairHasher.html">PairHasher</a>&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>pair_to_matrix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>matrix_list1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>matrix_list2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04258">4258</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>.</p>
<div class="fragment"><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;                                    {</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;  <span class="keywordtype">size_t</span> size = pair_list1.size();</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(pair_list2.size() == size);</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;  matrix_list1-&gt;clear();</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;  matrix_list2-&gt;clear();</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;  matrix_list1-&gt;reserve(size);</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;  matrix_list2-&gt;reserve(size);</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::const_iterator</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;      iter1 = pair_list1.begin(), end1 = pair_list1.end(),</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;      iter2 = pair_list2.begin();</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;  <span class="keywordflow">for</span> (; iter1 != end1; ++iter1, ++iter2) {</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;    <span class="keywordflow">if</span> (iter1-&gt;second == iter2-&gt;second)</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;    <span class="comment">// skip those that have no time shift, we won&#39;t have to do any swapping for</span></div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;    <span class="comment">// those.</span></div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;    unordered_map&lt;std::pair&lt;int32, int32&gt;, int32,</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;                  PairHasher&lt;int32&gt; &gt;::const_iterator</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;        map_iter1 = pair_to_matrix.find(*iter1),</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        map_iter2 = pair_to_matrix.find(*iter2);</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;    <span class="keywordflow">if</span> (map_iter1 == pair_to_matrix.end() ||</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;        map_iter2 == pair_to_matrix.end())</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Could not find pair in map (code error)&quot;</span>;</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;    matrix_list1-&gt;push_back(map_iter1-&gt;second);</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;    matrix_list2-&gt;push_back(map_iter2-&gt;second);</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;  }</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a69d4034713b69fe896cf7fd0566c3216"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69d4034713b69fe896cf7fd0566c3216">&#9670;&nbsp;</a></span>GetMatrixSwapOrder()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void GetMatrixSwapOrder </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>matrices1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>matrices2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>swaps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04367">4367</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;                                              {</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(matrices1.size() == matrices2.size());</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;  swaps-&gt;clear();</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;  int32 num_matrices = matrices1.size();</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;  std::vector&lt;bool&gt; processed(num_matrices, <span class="keyword">false</span>);</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;  std::vector&lt;int32&gt; queue;</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;  <span class="comment">// num_loops is just for infinite-loop detection.</span></div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;  int32 num_loops = 0;</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;  <span class="keywordflow">for</span> (; <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(swaps-&gt;size()) &lt; num_matrices; num_loops++) {</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_matrices; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;      <span class="keywordflow">if</span> (processed[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;      int32 m1 = matrices1[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], m2 = matrices2[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;      std::vector&lt;int32&gt;::const_iterator iter =</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;          std::lower_bound(matrices2.begin(), matrices2.end(), m1);</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;      <span class="keywordflow">if</span> (iter == matrices2.end() || *iter != m1) {</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;        <span class="comment">// Matrix m1 does not appear in the list &#39;matrices2&#39;, so</span></div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        <span class="comment">// we are safe to process it at any time.</span></div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;        swaps-&gt;push_back(std::pair&lt;int32,int32&gt;(m1, m2));</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;        processed[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;        int32 m1_pos_in_matrices2 = iter - matrices2.begin();</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;        <span class="keywordflow">if</span> (processed[m1_pos_in_matrices2]) {</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;          <span class="comment">// We&#39;re safe to do this swap now, because the matrix m1 has already</span></div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;          <span class="comment">// appeared on the RHS of a swap, and by this point has been</span></div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;          <span class="comment">// deallocated, in effect.</span></div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;          swaps-&gt;push_back(std::pair&lt;int32,int32&gt;(m1, m2));</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;          processed[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;        }</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;        <span class="comment">// else do nothing, we cannot process m1 yet because</span></div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;        <span class="comment">// at this point in the computation it is still allocated.</span></div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;      }</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;    }</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;    <span class="comment">// The following assert is to check that we don&#39;t loop infinitely.  We can</span></div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <span class="comment">// prove that infinite looping won&#39;t happen, after on proving that there can</span></div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;    <span class="comment">// be no cycles like (m1, m2), (m2, m3), (m3, m1) (the length of 3 is chosen</span></div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;    <span class="comment">// arbitrarily as an example).  If such a cycle existed, we can reach a</span></div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;    <span class="comment">// contradiction based on the time-index (t) of the first cindex in m1.</span></div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;    <span class="comment">// Define t1 = that time index, t2 the same for m2, t3 the same for m3.  The</span></div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;    <span class="comment">// existence of the three pairs [as pairs like (matrices1[i], matrices2[i])]</span></div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;    <span class="comment">// implies that t2 &gt; t1, t3 &gt; t2, and t1 &gt; t3 respectively, but this is</span></div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;    <span class="comment">// impossible.</span></div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;    <span class="comment">// This shows that all chains of dependencies must terminate.</span></div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_loops &lt;= num_matrices);</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;  }</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac797c8d6a701fb10dc8de13d2db3dcbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac797c8d6a701fb10dc8de13d2db3dcbe">&#9670;&nbsp;</a></span>GetPairToMatrixMap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void GetPairToMatrixMap </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>matrix_to_pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unordered_map&lt; std::pair&lt; int32, int32 &gt;, int32, <a class="el" href="structkaldi_1_1PairHasher.html">PairHasher</a>&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>pair_to_matrix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04177">4177</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;                                                                                       {</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;  int32 num_matrices = matrix_to_pair.size();</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;  <span class="comment">// actually there are one fewer matrices than num_matrices.</span></div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;  pair_to_matrix-&gt;clear();</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++)</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;    (*pair_to_matrix)[matrix_to_pair[m]] = m;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a0208954d6ae356dca488033ecea40274"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0208954d6ae356dca488033ecea40274">&#9670;&nbsp;</a></span>ListsAreEqualExceptForPossibleShift()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ListsAreEqualExceptForPossibleShift </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>shift</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04213">4213</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>
<div class="fragment"><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;                 {</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;  <span class="keywordtype">size_t</span> size = a.size();</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;  <span class="keywordflow">if</span> (b.size() != size)</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    <span class="keyword">const</span> std::pair&lt;int32, int32&gt; &amp;p1 = a[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;        &amp;p2 = b[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;    <span class="keywordflow">if</span> (p1.first != p2.first)</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;    <span class="keywordflow">if</span> (p2.second != p1.second + shift &amp;&amp; p2.second != p1.second)</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;  }</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a75060dc1f93ff9085cc6a6f0bf2d2f30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75060dc1f93ff9085cc6a6f0bf2d2f30">&#9670;&nbsp;</a></span>NormalizeCindexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 NormalizeCindexes </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *&#160;</td>
          <td class="paramname"><em>cindexes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04121">4121</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="nnet-common_8cc_source.html#l00573">kaldi::nnet3::kNoTime</a>.</p>
<div class="fragment"><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;                                 {</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;  std::vector&lt;Cindex&gt;::iterator iter = cindexes-&gt;begin(),</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;      end = cindexes-&gt;end();</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  int32 ans;</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;  <span class="keywordflow">for</span> (; iter != end; iter++) {</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;    <span class="keywordflow">if</span> (iter-&gt;second.t != <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>) {</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;      ans = iter-&gt;second.t;</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;    }</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;  }</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;  <span class="keywordflow">if</span> (iter == end) {</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;    <span class="comment">// this should not happen.</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;All t values are kNoTime in matrix.&quot;</span>;</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  }</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;  iter = cindexes-&gt;begin();</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;  <span class="keywordflow">for</span> (; iter != end; iter++)</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;    <span class="keywordflow">if</span> (iter-&gt;second.t != <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>)</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;      iter-&gt;second.t -= ans;</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac952f0840a7950dff80c1a89e69656d7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kaldi::nnet3::kNoTime</a></div><div class="ttdeci">const int kNoTime</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00573">nnet-common.cc:573</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acdecf85ba9844b9db2d0649ff34139c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdecf85ba9844b9db2d0649ff34139c8">&#9670;&nbsp;</a></span>Optimize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> Optimize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04473">4473</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04552">kaldi::nnet3::FixGotoLabel()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01429">kaldi::nnet3::GetCommandsOfType()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationPermanent</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00335">DerivativeTimeLimiter::nnet_</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">kaldi::nnet3::RenumberComputation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l04544">kaldi::nnet3::OptimizeLoopedComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;                                          {</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">Init</a>(<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>, *<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>.empty() &amp;&amp;</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;               <span class="stringliteral">&quot;You must request matrix debug info when compiling &quot;</span></div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;               <span class="stringliteral">&quot;looped computations.&quot;</span>);</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;  <span class="comment">// get the indexes of potential splice points, one per segment of the</span></div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;  <span class="comment">// computation.  We locate the splice points where kNoOperationPermanent is.</span></div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;  <span class="comment">// This is guaranteed to be after the inputs have been received, and before</span></div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;  <span class="comment">// the bulk of the computation in the segment, and of course before we provide</span></div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;  <span class="comment">// the output.  It happens that by choosing this as the splice point we avoid</span></div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;  <span class="comment">// certain problems that would arise, for instance, if we chose the segment</span></div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;  <span class="comment">// boundaries (kNoOperationMarker).</span></div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;  std::vector&lt;int32&gt; splice_points;</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a0a04e946fa68432f4e723944ce8ab281">GetCommandsOfType</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>,</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;                    &amp;splice_points);</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;  int32 time_shift_per_segment = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a40b93bc9e9fe7dccea10334ecf8edf2a">FindTimeShift</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; active_matrices;</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;  <span class="comment">// Find the list of matrices active at each of the potential splice points.</span></div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a768ce6ef8c9f2cd1b13dee1164c38213">FindActiveMatrices</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>, splice_points,</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;                     &amp;active_matrices);</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;  <span class="comment">// Find a representation of the matrices of the computation as pairs</span></div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;  <span class="comment">// (unique_id, time_offset) that are more amenable to finding</span></div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;  <span class="comment">// matrices that represet lists of Cindexes that differ only by</span></div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;  <span class="comment">// a time offset.</span></div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; matrix_to_pair;</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#afffba6e2f4c37c755f2ab63893d2d8b9">CreateMatrixPairs</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, &amp;matrix_to_pair);</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;  <span class="comment">// Create the reverse map from pair to matrix index; we&#39;ll need it later.</span></div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;  unordered_map&lt;std::pair&lt;int32, int32&gt;, int32, PairHasher&lt;int32&gt; &gt; pair_to_matrix;</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac797c8d6a701fb10dc8de13d2db3dcbe">GetPairToMatrixMap</a>(matrix_to_pair, &amp;pair_to_matrix);</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;  <span class="comment">// get lists of matrix per splice-point in the pair representation.</span></div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;  std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; pair_lists;</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a72907a94f0ef8ddc489134dad4fba1aa">ConvertListsToPairLists</a>(active_matrices, matrix_to_pair,</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;                          &amp;pair_lists);</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;  <span class="comment">// Note: seg1 and seg2 are indexes into &#39;splice_points&#39;, representing</span></div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;  <span class="comment">// potential splice points (located near the beginnings of segments).</span></div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;  int32 seg1, seg2;</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a45761855efc1786f2089e550ec71712a">FindFirstRepeat</a>(pair_lists,</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;                       time_shift_per_segment,</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;                       &amp;seg1, &amp;seg2)) {</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Could not find repeats of variables.&quot;</span>;</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;  }</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;  std::vector&lt;int32&gt; seg1_matrices, seg2_matrices;</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a50e8cbb0a710d4d2862d8b19c72902bc">GetIdentifiedMatrices</a>(pair_lists[seg1], pair_lists[seg2],</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;                        pair_to_matrix,</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;                        &amp;seg1_matrices, &amp;seg2_matrices);</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;  int32 time_difference = time_shift_per_segment * (seg2 - seg1);</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a283d532b71865991e14f83433b440332">CheckIdentifiedMatrices</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, seg1_matrices, seg2_matrices,</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;                          time_difference);</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a70c1595b263268a6a0ec5bd2468151bc">FormInfiniteLoop</a>(splice_points[seg1], splice_points[seg2], <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ae93293e76f4dc9049065601362e9bc2e">AddMatrixSwapCommands</a>(seg1_matrices, seg2_matrices, <a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">RenumberComputation</a>(<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">FixGotoLabel</a>(<a class="code" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a72907a94f0ef8ddc489134dad4fba1aa"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a72907a94f0ef8ddc489134dad4fba1aa">kaldi::nnet3::ComputationLoopedOptimizer::ConvertListsToPairLists</a></div><div class="ttdeci">static void ConvertListsToPairLists(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;active_matrices, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;matrix_to_pair, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *active_pairs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04189">nnet-optimize-utils.cc:4189</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a0a04e946fa68432f4e723944ce8ab281"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0a04e946fa68432f4e723944ce8ab281">kaldi::nnet3::GetCommandsOfType</a></div><div class="ttdeci">void GetCommandsOfType(const NnetComputation &amp;computation, CommandType t, std::vector&lt; int32 &gt; *command_indexes)</div><div class="ttdoc">This utility function works out from a computation, the command-indexes of the commands of the given ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01429">nnet-analyze.cc:1429</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ad608a50eef55fe012c53acb48f1de02b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">kaldi::nnet3::NnetComputation::matrix_debug_info</a></div><div class="ttdeci">std::vector&lt; MatrixDebugInfo &gt; matrix_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00394">nnet-computation.h:394</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6828e427bd8883455705e0c9b99b5f2f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">kaldi::nnet3::RenumberComputation</a></div><div class="ttdeci">void RenumberComputation(NnetComputation *computation)</div><div class="ttdoc">This function detects submatrices and matrices that are never used (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00693">nnet-optimize-utils.cc:693</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_ae93293e76f4dc9049065601362e9bc2e"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ae93293e76f4dc9049065601362e9bc2e">kaldi::nnet3::ComputationLoopedOptimizer::AddMatrixSwapCommands</a></div><div class="ttdeci">static void AddMatrixSwapCommands(const std::vector&lt; int32 &gt; &amp;matrices1, const std::vector&lt; int32 &gt; &amp;matrices2, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04419">nnet-optimize-utils.cc:4419</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a50e8cbb0a710d4d2862d8b19c72902bc"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a50e8cbb0a710d4d2862d8b19c72902bc">kaldi::nnet3::ComputationLoopedOptimizer::GetIdentifiedMatrices</a></div><div class="ttdeci">static void GetIdentifiedMatrices(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;pair_list1, const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;pair_list2, const unordered_map&lt; std::pair&lt; int32, int32 &gt;, int32, PairHasher&lt; int32 &gt; &gt; &amp;pair_to_matrix, std::vector&lt; int32 &gt; *matrix_list1, std::vector&lt; int32 &gt; *matrix_list2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04258">nnet-optimize-utils.cc:4258</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_ac797c8d6a701fb10dc8de13d2db3dcbe"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac797c8d6a701fb10dc8de13d2db3dcbe">kaldi::nnet3::ComputationLoopedOptimizer::GetPairToMatrixMap</a></div><div class="ttdeci">static void GetPairToMatrixMap(std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;matrix_to_pair, unordered_map&lt; std::pair&lt; int32, int32 &gt;, int32, PairHasher&lt; int32 &gt; &gt; *pair_to_matrix)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04177">nnet-optimize-utils.cc:4177</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::ComputationLoopedOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04063">nnet-optimize-utils.cc:4063</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a283d532b71865991e14f83433b440332"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a283d532b71865991e14f83433b440332">kaldi::nnet3::ComputationLoopedOptimizer::CheckIdentifiedMatrices</a></div><div class="ttdeci">static void CheckIdentifiedMatrices(const NnetComputation &amp;computation, const std::vector&lt; int32 &gt; &amp;list1, const std::vector&lt; int32 &gt; &amp;list2, int32 time_difference)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04331">nnet-optimize-utils.cc:4331</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_aab8a145e53802c80302dc498e388a2ad"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">kaldi::nnet3::Analyzer::Init</a></div><div class="ttdeci">void Init(const Nnet &amp;nnet, const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01421">nnet-analyze.cc:1421</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::ComputationLoopedOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04061">nnet-optimize-utils.cc:4061</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a768ce6ef8c9f2cd1b13dee1164c38213"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a768ce6ef8c9f2cd1b13dee1164c38213">kaldi::nnet3::ComputationLoopedOptimizer::FindActiveMatrices</a></div><div class="ttdeci">static void FindActiveMatrices(const NnetComputation &amp;computation, const Analyzer &amp;analyzer, const std::vector&lt; int32 &gt; &amp;splice_point_commands, std::vector&lt; std::vector&lt; int32 &gt; &gt; *active_matrices)</div><div class="ttdoc">Given a list of command indexes (&amp;#39;splice_point_commands&amp;#39;) which are expected to be command indexes of...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04293">nnet-optimize-utils.cc:4293</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_afffba6e2f4c37c755f2ab63893d2d8b9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#afffba6e2f4c37c755f2ab63893d2d8b9">kaldi::nnet3::ComputationLoopedOptimizer::CreateMatrixPairs</a></div><div class="ttdeci">static void CreateMatrixPairs(const NnetComputation &amp;computation, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *matrix_to_pair)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04144">nnet-optimize-utils.cc:4144</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a45761855efc1786f2089e550ec71712a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a45761855efc1786f2089e550ec71712a">kaldi::nnet3::ComputationLoopedOptimizer::FindFirstRepeat</a></div><div class="ttdeci">static bool FindFirstRepeat(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;active_pairs, int32 time_shift_per_segment, int32 *seg1, int32 *seg2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04232">nnet-optimize-utils.cc:4232</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8953a6af8e449d7cc12efeb115c5f8d2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">kaldi::nnet3::FixGotoLabel</a></div><div class="ttdeci">void FixGotoLabel(NnetComputation *computation)</div><div class="ttdoc">This function ensures that the arg1 of a final command of type kGotoLabel is the same as the command ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04552">nnet-optimize-utils.cc:4552</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a70c1595b263268a6a0ec5bd2468151bc"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a70c1595b263268a6a0ec5bd2468151bc">kaldi::nnet3::ComputationLoopedOptimizer::FormInfiniteLoop</a></div><div class="ttdeci">static void FormInfiniteLoop(int32 command1, int32 command2, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04453">nnet-optimize-utils.cc:4453</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a40b93bc9e9fe7dccea10334ecf8edf2a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a40b93bc9e9fe7dccea10334ecf8edf2a">kaldi::nnet3::ComputationLoopedOptimizer::FindTimeShift</a></div><div class="ttdeci">static int32 FindTimeShift(const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04070">nnet-optimize-utils.cc:4070</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::ComputationLoopedOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04062">nnet-optimize-utils.cc:4062</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ac8ca96df1ecdb635738c59a88cff8835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8ca96df1ecdb635738c59a88cff8835">&#9670;&nbsp;</a></span>analyzer_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> analyzer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04063">4063</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="a36d13565d1302a2bf74127b141ba3537"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36d13565d1302a2bf74127b141ba3537">&#9670;&nbsp;</a></span>computation_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>* computation_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04062">4062</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="ac0eab3be8e97f0ed110d0998bc2bc0a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0eab3be8e97f0ed110d0998bc2bc0a1">&#9670;&nbsp;</a></span>matrix_to_pair_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::pair&lt;int32, int32&gt; &gt; matrix_to_pair_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04064">4064</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="adbabf05a7702103113a02a113015205f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbabf05a7702103113a02a113015205f">&#9670;&nbsp;</a></span>nnet_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a>&amp; nnet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04061">4061</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="af8364fb4b69f001a20545ea5b1a2c65f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8364fb4b69f001a20545ea5b1a2c65f">&#9670;&nbsp;</a></span>splice_point_commands_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;int32&gt; splice_point_commands_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04066">4066</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>nnet3/<a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li><li class="navelem"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html">ComputationLoopedOptimizer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
