<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: kaldi::nnet3::time_height_convolution Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacekaldi_1_1nnet3_1_1time__height__convolution.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">kaldi::nnet3::time_height_convolution Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This struct represents the structure of a convolution computation.  <a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This struct contains options for compiling the convolutional computation.  <a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This comment explains the basic framework used for everything related to time-height convolution.  <a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7c809b8ac794279b0362a4717b676509"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c809b8ac794279b0362a4717b676509">GetRandomConvolutionModel</a> (<a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *model)</td></tr>
<tr class="separator:a7c809b8ac794279b0362a4717b676509"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84391d2d348e03e12429d5066ae29234"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a84391d2d348e03e12429d5066ae29234">GetRandomConvolutionIndexes</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *input_indexes, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *output_indexes)</td></tr>
<tr class="separator:a84391d2d348e03e12429d5066ae29234"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7886201ac80e02bca20d2879f5c00b3e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7886201ac80e02bca20d2879f5c00b3e">UnitTestTimeHeightConvolutionIo</a> ()</td></tr>
<tr class="separator:a7886201ac80e02bca20d2879f5c00b3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a365c3f4e2917faa32eebde2962736b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a5a365c3f4e2917faa32eebde2962736b">TestComputationIo</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;computation)</td></tr>
<tr class="separator:a5a365c3f4e2917faa32eebde2962736b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d385f0ba4d4950c67e633631359ea88"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes, <a class="el" href="classkaldi_1_1CuMatrix.html">CuMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *matrix)</td></tr>
<tr class="separator:a2d385f0ba4d4950c67e633631359ea88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81fe4d0c3eaa483dca9e0f75059c2226"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a81fe4d0c3eaa483dca9e0f75059c2226">ConvolveForwardSimple</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;input_indexes, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;output_indexes, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input_cu, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params_cu, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *output_cu)</td></tr>
<tr class="separator:a81fe4d0c3eaa483dca9e0f75059c2226"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af415681e595230c3b3ab8fe8e07c8856"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af415681e595230c3b3ab8fe8e07c8856">TestRunningComputation</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;conv_model, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;input_indexes, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;output_indexes, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;computation)</td></tr>
<tr class="separator:af415681e595230c3b3ab8fe8e07c8856"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12f0d904ea77665399e945f2fb38d550"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a12f0d904ea77665399e945f2fb38d550">TestDataBackprop</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;conv_model, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;input_indexes, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;output_indexes, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;computation)</td></tr>
<tr class="separator:a12f0d904ea77665399e945f2fb38d550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6ba0f24470a4f71e30599a3a39960b1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af6ba0f24470a4f71e30599a3a39960b1">TestParamsBackprop</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;conv_model, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;input_indexes, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;output_indexes, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;computation)</td></tr>
<tr class="separator:af6ba0f24470a4f71e30599a3a39960b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d9af4dc497e084315685f891b8b2675"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a8d9af4dc497e084315685f891b8b2675">UnitTestTimeHeightConvolutionCompile</a> ()</td></tr>
<tr class="separator:a8d9af4dc497e084315685f891b8b2675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22985b60e47cb4dda7283da145cd5175"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a22985b60e47cb4dda7283da145cd5175">UnitTestTimeHeightConvolution</a> ()</td></tr>
<tr class="separator:a22985b60e47cb4dda7283da145cd5175"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2402a67cb01294ac92b7587d838dcd72"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2402a67cb01294ac92b7587d838dcd72">ReverseColumnMapping</a> (const std::vector&lt; int32 &gt; &amp;columns, int32 input_dim, std::vector&lt; std::vector&lt; int32 &gt; &gt; *backward_columns)</td></tr>
<tr class="memdesc:a2402a67cb01294ac92b7587d838dcd72"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function, used in <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html#a9d601955f7a16a2d9492240166a8e569">ConvolutionComputation::ComputeDerived()</a>, reverses a mapping that may not be unique.  <a href="#a2402a67cb01294ac92b7587d838dcd72">More...</a><br /></td></tr>
<tr class="separator:a2402a67cb01294ac92b7587d838dcd72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3b5f58dc778b471a98dace82d84ed1a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af3b5f58dc778b471a98dace82d84ed1a">VectorIsContiguous</a> (const std::vector&lt; int32 &gt; &amp;vec)</td></tr>
<tr class="separator:af3b5f58dc778b471a98dace82d84ed1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b1ace22a4e6edbfc7c475ab711b1930"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4b1ace22a4e6edbfc7c475ab711b1930">ConvolveForwardInternal</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;cc, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *temp_mat, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *output)</td></tr>
<tr class="separator:a4b1ace22a4e6edbfc7c475ab711b1930"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1cde1ebf0949cbc13fb9678bde0a70c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">ConvolveForward</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;conv_comp, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *output)</td></tr>
<tr class="memdesc:ad1cde1ebf0949cbc13fb9678bde0a70c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This does the forward computation of convolution.  <a href="#ad1cde1ebf0949cbc13fb9678bde0a70c">More...</a><br /></td></tr>
<tr class="separator:ad1cde1ebf0949cbc13fb9678bde0a70c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4867698b8c802d67dc2f2d313c98af2e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4867698b8c802d67dc2f2d313c98af2e">ConvolveBackwardDataInternal</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;cc, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;output_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *temp_mat, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *input_deriv)</td></tr>
<tr class="separator:a4867698b8c802d67dc2f2d313c98af2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c24c02ba2b5c29ad1854da071902744"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c24c02ba2b5c29ad1854da071902744">ConvolveBackwardData</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;conv_comp, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;output_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *input_deriv)</td></tr>
<tr class="memdesc:a7c24c02ba2b5c29ad1854da071902744"><td class="mdescLeft">&#160;</td><td class="mdescRight">This does the part of the backward derivative computation of convolution, that propagates derivatives back to the input data.  <a href="#a7c24c02ba2b5c29ad1854da071902744">More...</a><br /></td></tr>
<tr class="separator:a7c24c02ba2b5c29ad1854da071902744"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cf8fc06d67e83fd9c4257bf69e33ffa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3cf8fc06d67e83fd9c4257bf69e33ffa">ConvolveBackwardParamsInternal</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;cc, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;output_deriv, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *temp_mat, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *params_deriv)</td></tr>
<tr class="separator:a3cf8fc06d67e83fd9c4257bf69e33ffa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55135cbe454ca7d1333962ed8bdb1476"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a55135cbe454ca7d1333962ed8bdb1476">ConvolveBackwardParams</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;conv_comp, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;output_deriv, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *params_deriv)</td></tr>
<tr class="memdesc:a55135cbe454ca7d1333962ed8bdb1476"><td class="mdescLeft">&#160;</td><td class="mdescRight">This does the part of the backward derivative computation of convolution, that computes derivatives w.r.t.  <a href="#a55135cbe454ca7d1333962ed8bdb1476">More...</a><br /></td></tr>
<tr class="separator:a55135cbe454ca7d1333962ed8bdb1476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8eaf9d986968b634b59294d1beac7e39"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a8eaf9d986968b634b59294d1beac7e39">PadModelHeight</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *model_padded)</td></tr>
<tr class="memdesc:a8eaf9d986968b634b59294d1beac7e39"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes a model that might require zero padding in the height dimension and outputs a model accepting a possibly-larger input dimension which does not require zero padding.  <a href="#a8eaf9d986968b634b59294d1beac7e39">More...</a><br /></td></tr>
<tr class="separator:a8eaf9d986968b634b59294d1beac7e39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62189e199d074c5393e2b3838f23601e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a62189e199d074c5393e2b3838f23601e">ComputeTempMatrixSize</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;opts, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *computation)</td></tr>
<tr class="memdesc:a62189e199d074c5393e2b3838f23601e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function sets 'temp_rows' and 'temp_cols' in 'computation'.  <a href="#a62189e199d074c5393e2b3838f23601e">More...</a><br /></td></tr>
<tr class="separator:a62189e199d074c5393e2b3838f23601e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae29d8557b8598f2eb6f449f8fa6f2eff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ae29d8557b8598f2eb6f449f8fa6f2eff">UnPadModelHeight</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;opts, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model_padded, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *computation)</td></tr>
<tr class="memdesc:ae29d8557b8598f2eb6f449f8fa6f2eff"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function modifies, if necessary, a computation that has been built for the model 'model_padded', so that it can work for the original model 'model'.  <a href="#ae29d8557b8598f2eb6f449f8fa6f2eff">More...</a><br /></td></tr>
<tr class="separator:ae29d8557b8598f2eb6f449f8fa6f2eff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcb71a0f9a1a1170eea7c1f30637eb51"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#adcb71a0f9a1a1170eea7c1f30637eb51">PadComputationInputTime</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *io)</td></tr>
<tr class="memdesc:adcb71a0f9a1a1170eea7c1f30637eb51"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function extends the set of input indexes that the computation has, to account for any required zero-padding in the time dimension.  <a href="#adcb71a0f9a1a1170eea7c1f30637eb51">More...</a><br /></td></tr>
<tr class="separator:adcb71a0f9a1a1170eea7c1f30637eb51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b212f6dc4c682d9c3be9cea85e844c2"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3b212f6dc4c682d9c3be9cea85e844c2">RoundDownToMultipleOf</a> (int32 i, int32 n)</td></tr>
<tr class="separator:a3b212f6dc4c682d9c3be9cea85e844c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac06942821d2dcf18b5253290f60eec79"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ac06942821d2dcf18b5253290f60eec79">ShiftAllTimeOffsets</a> (int32 shift, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *model)</td></tr>
<tr class="separator:ac06942821d2dcf18b5253290f60eec79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a578fd54bb77245b4e9c173eea9dbb26e"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a578fd54bb77245b4e9c173eea9dbb26e">PrepareIoForAppending</a> (<a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *io, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *io_appended)</td></tr>
<tr class="separator:a578fd54bb77245b4e9c173eea9dbb26e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47f39055ac1392988d58a331b6557715"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a47f39055ac1392988d58a331b6557715">AppendInputFrames</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *io, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *model_appended, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *io_appended)</td></tr>
<tr class="memdesc:a47f39055ac1392988d58a331b6557715"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes an input model and I/O specification, and it modifies both of them if necessary to ensure that the output 'io_appended' object has the same input and output time strides (i.e.  <a href="#a47f39055ac1392988d58a331b6557715">More...</a><br /></td></tr>
<tr class="separator:a47f39055ac1392988d58a331b6557715"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ac460dc43c9fe1341da246f1dfa1a1d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a9ac460dc43c9fe1341da246f1dfa1a1d">TimeValueInInput</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;io, int32 t)</td></tr>
<tr class="separator:a9ac460dc43c9fe1341da246f1dfa1a1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fd1345b28f79b4202490ef8136c8ab0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3fd1345b28f79b4202490ef8136c8ab0">CheckModelAndIo</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;io, <a class="el" href="classbool.html">bool</a> allow_extra_input=false)</td></tr>
<tr class="memdesc:a3fd1345b28f79b4202490ef8136c8ab0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check that this model and this I/O request are compatible in terms of required context, etc, and crash if not.  <a href="#a3fd1345b28f79b4202490ef8136c8ab0">More...</a><br /></td></tr>
<tr class="separator:a3fd1345b28f79b4202490ef8136c8ab0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a8674224a035c83c521b9a5eccaaeb5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3a8674224a035c83c521b9a5eccaaeb5">CompileConvolutionComputation</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;input_indexes, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;output_indexes, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;opts, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *computation, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *input_indexes_modified, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *output_indexes_modified)</td></tr>
<tr class="memdesc:a3a8674224a035c83c521b9a5eccaaeb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function does the compilation for a convolution computation; it's a wrapper for the functions below, which should not have to be called by the end user.  <a href="#a3a8674224a035c83c521b9a5eccaaeb5">More...</a><br /></td></tr>
<tr class="separator:a3a8674224a035c83c521b9a5eccaaeb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a134a07f0958a06bd608d33aec94b38d4"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a134a07f0958a06bd608d33aec94b38d4">FindGcdOfDifferences</a> (std::vector&lt; int32 &gt; &amp;vec)</td></tr>
<tr class="separator:a134a07f0958a06bd608d33aec94b38d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0a0b7715e12a97dd292c8b2830e3814"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af0a0b7715e12a97dd292c8b2830e3814">RegularizeTList</a> (std::vector&lt; int32 &gt; &amp;t_values, int32 *start, int32 *step, int32 *num_values)</td></tr>
<tr class="separator:af0a0b7715e12a97dd292c8b2830e3814"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd0c0fe6e93d0e45d4cad6f25cc966a3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#abd0c0fe6e93d0e45d4cad6f25cc966a3">CreateIndexes</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;n_x_pairs, int32 t_start, int32 t_step, int32 num_t_values, int32 reorder_t, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *indexes)</td></tr>
<tr class="memdesc:abd0c0fe6e93d0e45d4cad6f25cc966a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a vector of indexes with a regular structure, according to these specifications.  <a href="#abd0c0fe6e93d0e45d4cad6f25cc966a3">More...</a><br /></td></tr>
<tr class="separator:abd0c0fe6e93d0e45d4cad6f25cc966a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a640f155cf7f6deba113985c6d947017a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a640f155cf7f6deba113985c6d947017a">SetSomeIndexesBlank</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;ref_indexes, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *indexes)</td></tr>
<tr class="memdesc:a640f155cf7f6deba113985c6d947017a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function modifies 'indexes' by, for any Indexes which was not present in 'ref_indexes', setting the 't' value to kNoTime.  <a href="#a640f155cf7f6deba113985c6d947017a">More...</a><br /></td></tr>
<tr class="separator:a640f155cf7f6deba113985c6d947017a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae62a1a6a9f5852ccbac183045ab6815e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ae62a1a6a9f5852ccbac183045ab6815e">GetComputationIo</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;input_indexes, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;output_indexes, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *io)</td></tr>
<tr class="memdesc:ae62a1a6a9f5852ccbac183045ab6815e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes lists of input and output indexes to a computation (e.g.  <a href="#ae62a1a6a9f5852ccbac183045ab6815e">More...</a><br /></td></tr>
<tr class="separator:ae62a1a6a9f5852ccbac183045ab6815e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69d36c7781410ae1890ad1fd30b4cb50"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a69d36c7781410ae1890ad1fd30b4cb50">GetIndexesForComputation</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;io, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;orig_input_indexes, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;orig_output_indexes, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *input_indexes, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *output_indexes)</td></tr>
<tr class="memdesc:a69d36c7781410ae1890ad1fd30b4cb50"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function computes the reordered and possibly padded indexes corresponding to the computation in 'io'.  <a href="#a69d36c7781410ae1890ad1fd30b4cb50">More...</a><br /></td></tr>
<tr class="separator:a69d36c7781410ae1890ad1fd30b4cb50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a078ae274f46ec580d9906969502be607"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a078ae274f46ec580d9906969502be607">MakeComputation</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;model, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;io, const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;opts, <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *computation)</td></tr>
<tr class="separator:a078ae274f46ec580d9906969502be607"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a47f39055ac1392988d58a331b6557715"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47f39055ac1392988d58a331b6557715">&#9670;&nbsp;</a></span>AppendInputFrames()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AppendInputFrames </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *&#160;</td>
          <td class="paramname"><em>model_appended</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *&#160;</td>
          <td class="paramname"><em>io_appended</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes an input model and I/O specification, and it modifies both of them if necessary to ensure that the output 'io_appended' object has the same input and output time strides (i.e. </p>
<p>t_stride_in == t_stride_out). This is done by appending the input frames across several time values and viewing them as single frames of larger dimension.</p>
<p>The reason why 'io' is non-const is that it may be necessary to pad the number of input frames to ensure that the number of input frames is divisible by a multiple of t_stride_out / t_stride_in (if we pad the input frames, we pad to the right).</p>
<p>The model in 'model_appended' may have larger height_in, and different values of 'offsets' and derived variables thereof, versus the model in 'model'.</p>
<p>This is stage 3 of compilation. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01203">1203</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8h_source.html#l00173">ConvolutionModel::all_time_offsets</a>, <a class="el" href="convolution_8cc_source.html#l00130">ConvolutionModel::Check()</a>, <a class="el" href="convolution_8cc_source.html#l00109">ConvolutionModel::ComputeDerived()</a>, <a class="el" href="convolution_8h_source.html#l00128">ConvolutionModel::height_in</a>, <a class="el" href="convolution_8h_source.html#l00137">ConvolutionModel::Offset::height_offset</a>, <a class="el" href="convolution_8h_source.html#l00129">ConvolutionModel::height_out</a>, <a class="el" href="convolution_8h_source.html#l00132">ConvolutionModel::height_subsample_out</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="convolution_8h_source.html#l00126">ConvolutionModel::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00127">ConvolutionModel::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00157">ConvolutionModel::offsets</a>, <a class="el" href="convolution_8cc_source.html#l01158">PrepareIoForAppending()</a>, <a class="el" href="convolution_8h_source.html#l00169">ConvolutionModel::required_time_offsets</a>, <a class="el" href="convolution_8cc_source.html#l01103">RoundDownToMultipleOf()</a>, <a class="el" href="convolution_8cc_source.html#l01110">ShiftAllTimeOffsets()</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::start_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::start_t_out</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::t_step_out</a>, and <a class="el" href="convolution_8h_source.html#l00136">ConvolutionModel::Offset::time_offset</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                                                              {</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  int32 ratio = <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a578fd54bb77245b4e9c173eea9dbb26e">PrepareIoForAppending</a>(io, io_appended);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="keywordflow">if</span> (ratio == 1) {</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="comment">// we are not doing any appending of frames.</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    *model_appended = model;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  }</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="comment">// we also need the time-step of the output (which is also now the</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <span class="comment">// time-step of the appended input).</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="comment">// We know that the time step is not zero, because in that case we would</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="comment">// have ratio == 1 and would have returned above.</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  int32 time_step_out = io_appended-&gt;t_step_out;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(time_step_out == io_appended-&gt;t_step_in &amp;&amp; time_step_out != 0);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  int32 orig_time_step_in = io-&gt;t_step_in;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(orig_time_step_in * ratio == time_step_out);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="comment">// make sure the difference between first input and output frames is what we</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  <span class="comment">// expect, else something could go wrong here.</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  int32 first_time_offset = *(model.all_time_offsets.begin());</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io-&gt;start_t_in - io-&gt;start_t_out == first_time_offset);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  ConvolutionModel model_temp(model);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="comment">// shift so that the first time offset is zero.  this makes</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="comment">// the model conversion easier.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ac06942821d2dcf18b5253290f60eec79">ShiftAllTimeOffsets</a>(-first_time_offset, &amp;model_temp);</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  model_appended-&gt;num_filters_in = model.num_filters_in;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  model_appended-&gt;num_filters_out = model.num_filters_out;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  model_appended-&gt;height_in = ratio * model.height_in;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  model_appended-&gt;height_out = model.height_out;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  model_appended-&gt;height_subsample_out = model.height_subsample_out;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  int32 num_offsets = model_temp.offsets.size(),</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      old_height = model.height_in;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  model_appended-&gt;offsets.resize(num_offsets);</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  model_appended-&gt;all_time_offsets.clear();</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_offsets; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keyword">const</span> ConvolutionModel::Offset &amp;old_offset = model_temp.offsets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    ConvolutionModel::Offset &amp;new_offset = model_appended-&gt;offsets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="comment">// The following two lines are important!!  They are the core of how</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="comment">// we handle subsampling in this framework.</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    new_offset.time_offset = <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3b212f6dc4c682d9c3be9cea85e844c2">RoundDownToMultipleOf</a>(old_offset.time_offset,</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                                                   time_step_out);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((old_offset.time_offset - new_offset.time_offset) %</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                 orig_time_step_in == 0);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    int32 row_offset = (old_offset.time_offset - new_offset.time_offset) /</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        orig_time_step_in;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    new_offset.height_offset = old_offset.height_offset +</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        row_offset * old_height;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    model_appended-&gt;all_time_offsets.insert(new_offset.time_offset);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  }</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="comment">// Because the &#39;appended&#39; model will always be used after zero-padding on the</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">// time axis, we can just pretend that all desired time-offsets are required.</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="comment">// It&#39;s a kind of free error-checking.</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  model_appended-&gt;required_time_offsets = model_appended-&gt;all_time_offsets;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="comment">// Undo the time-shifting that we did before.</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ac06942821d2dcf18b5253290f60eec79">ShiftAllTimeOffsets</a>(first_time_offset, model_appended);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  model_appended-&gt;ComputeDerived();</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(model_appended-&gt;Check(<span class="keyword">false</span>, <span class="keyword">false</span>));</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a3b212f6dc4c682d9c3be9cea85e844c2"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3b212f6dc4c682d9c3be9cea85e844c2">kaldi::nnet3::time_height_convolution::RoundDownToMultipleOf</a></div><div class="ttdeci">static int32 RoundDownToMultipleOf(int32 i, int32 n)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01103">convolution.cc:1103</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a578fd54bb77245b4e9c173eea9dbb26e"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a578fd54bb77245b4e9c173eea9dbb26e">kaldi::nnet3::time_height_convolution::PrepareIoForAppending</a></div><div class="ttdeci">static int32 PrepareIoForAppending(ConvolutionComputationIo *io, ConvolutionComputationIo *io_appended)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01158">convolution.cc:1158</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_ac06942821d2dcf18b5253290f60eec79"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ac06942821d2dcf18b5253290f60eec79">kaldi::nnet3::time_height_convolution::ShiftAllTimeOffsets</a></div><div class="ttdeci">static void ShiftAllTimeOffsets(int32 shift, ConvolutionModel *model)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01110">convolution.cc:1110</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3fd1345b28f79b4202490ef8136c8ab0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fd1345b28f79b4202490ef8136c8ab0">&#9670;&nbsp;</a></span>CheckModelAndIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckModelAndIo </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>allow_extra_input</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check that this model and this I/O request are compatible in terms of required context, etc, and crash if not. </p>
<p>if allow_extra_input == false, this will crash if the input 'io' object has time values that would never be used because they are before/after the first/last desired time values. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01329">1329</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8h_source.html#l00173">ConvolutionModel::all_time_offsets</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::num_t_out</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="convolution_8h_source.html#l00169">ConvolutionModel::required_time_offsets</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::start_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::start_t_out</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::t_step_out</a>, and <a class="el" href="convolution_8cc_source.html#l01321">TimeValueInInput()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                                             {</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io.num_t_in &gt; 0 &amp;&amp; io.num_t_out &gt; 0 &amp;&amp;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;               !model.required_time_offsets.empty() &amp;&amp;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;               !model.all_time_offsets.empty());</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keywordflow">if</span> (!allow_extra_input) {</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io.start_t_in &gt;= io.start_t_out +</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                 *model.all_time_offsets.begin());</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    int32 last_t_in = io.start_t_in + io.t_step_in * (io.num_t_in - 1),</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        last_t_out = io.start_t_out + io.t_step_out * (io.num_t_out - 1);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(last_t_in &lt;= last_t_out +</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                 *model.all_time_offsets.rbegin());</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  std::set&lt;int32&gt; input_times_to_check;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; std::min(5, io.num_t_out); <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    int32 t_out = io.start_t_out +</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, io.num_t_out - 1) * io.t_step_out;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">for</span> (std::set&lt;int32&gt;::const_iterator iter =</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;             model.required_time_offsets.begin();</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;         iter != model.required_time_offsets.end();</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;         ++iter) {</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      int32 offset = *iter;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      input_times_to_check.insert(t_out + offset);</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    }</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <span class="keywordflow">for</span> (std::set&lt;int32&gt;::const_iterator iter = input_times_to_check.begin();</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;       iter != input_times_to_check.end(); ++iter) {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    int32 t = *iter;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a9ac460dc43c9fe1341da246f1dfa1a1d">TimeValueInInput</a>(io, t)) {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Error checking model and IO: time &quot;</span> &lt;&lt; t</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; is required but not in the input.&quot;</span>;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    }</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  }</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a9ac460dc43c9fe1341da246f1dfa1a1d"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a9ac460dc43c9fe1341da246f1dfa1a1d">kaldi::nnet3::time_height_convolution::TimeValueInInput</a></div><div class="ttdeci">static bool TimeValueInInput(const ConvolutionComputationIo &amp;io, int32 t)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01321">convolution.cc:1321</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a8674224a035c83c521b9a5eccaaeb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a8674224a035c83c521b9a5eccaaeb5">&#9670;&nbsp;</a></span>CompileConvolutionComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CompileConvolutionComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_indexes_modified</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>output_indexes_modified</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function does the compilation for a convolution computation; it's a wrapper for the functions below, which should not have to be called by the end user. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">model</td><td>The convolution model that this computation is for. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_indexes</td><td>The list of Indexes available at the input of the computation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">output_indexes</td><td>The list of Indexes requested to be computed at the output of the computation. It is an error if all dependencies are not satisfied (specifically: for each <a class="el" href="structkaldi_1_1nnet3_1_1Index.html" title="struct Index is intended to represent the various indexes by which we number the rows of the matrices...">Index</a> (n,t,x) in 'output_indexes', the <a class="el" href="structkaldi_1_1nnet3_1_1Index.html" title="struct Index is intended to represent the various indexes by which we number the rows of the matrices...">Index</a> (n,t+time_offset,x) must be present in 'input_indexes' for each time_offset in model.required_time_offsets. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">computation</td><td>If non-NULL, the compiled computation will be written to this location. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01367">1367</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l01203">AppendInputFrames()</a>, <a class="el" href="convolution_8cc_source.html#l01329">CheckModelAndIo()</a>, <a class="el" href="convolution_8cc_source.html#l01519">GetComputationIo()</a>, <a class="el" href="convolution_8cc_source.html#l01543">GetIndexesForComputation()</a>, <a class="el" href="convolution_8cc_source.html#l01568">MakeComputation()</a>, <a class="el" href="convolution_8cc_source.html#l01051">PadComputationInputTime()</a>, <a class="el" href="convolution_8cc_source.html#l00918">PadModelHeight()</a>, and <a class="el" href="convolution_8cc_source.html#l01001">UnPadModelHeight()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-convolutional-component_8cc_source.html#l00559">TimeHeightConvolutionComponent::PrecomputeIndexes()</a>, <a class="el" href="nnet-convolutional-component_8cc_source.html#l00407">TimeHeightConvolutionComponent::ReorderIndexes()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                                               {</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="comment">// stage zero [preparing the input and output in a regular grid.]</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  ConvolutionComputationIo io;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ae62a1a6a9f5852ccbac183045ab6815e">GetComputationIo</a>(input_indexes, output_indexes, &amp;io);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3fd1345b28f79b4202490ef8136c8ab0">CheckModelAndIo</a>(model, io, <span class="keyword">false</span>);</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="comment">// stage 1.</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#adcb71a0f9a1a1170eea7c1f30637eb51">PadComputationInputTime</a>(model, &amp;io);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3fd1345b28f79b4202490ef8136c8ab0">CheckModelAndIo</a>(model, io, <span class="keyword">false</span>);</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="comment">// stage 2.</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  ConvolutionModel model_padded;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a8eaf9d986968b634b59294d1beac7e39">PadModelHeight</a>(model, &amp;model_padded);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3fd1345b28f79b4202490ef8136c8ab0">CheckModelAndIo</a>(model_padded, io, <span class="keyword">false</span>);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="comment">// stage 3.</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  ConvolutionModel model_appended;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  ConvolutionComputationIo io_appended;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="comment">// make a &#39;fake&#39; model and io for possibly-appended input frames.  &#39;io&#39; is</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="comment">// non-const because we may need to pad with a few extra frames.</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a47f39055ac1392988d58a331b6557715">AppendInputFrames</a>(model_padded, &amp;io,</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                    &amp;model_appended, &amp;io_appended);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3fd1345b28f79b4202490ef8136c8ab0">CheckModelAndIo</a>(model_appended, io_appended, <span class="keyword">true</span>);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="comment">// stage 4.</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a078ae274f46ec580d9906969502be607">MakeComputation</a>(model_appended, io_appended, opts, computation);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="comment">// &#39;reverse&#39; of stage 2.  [stage 3 kind of does its own</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="comment">// &#39;reverse&#39; by modifying its input IO object.]</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="comment">// The computation is still specified for the appended input,</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="comment">// but the execution code can figure that out itself.</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ae29d8557b8598f2eb6f449f8fa6f2eff">UnPadModelHeight</a>(opts, model, model_padded, computation);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a69d36c7781410ae1890ad1fd30b4cb50">GetIndexesForComputation</a>(io, input_indexes, output_indexes,</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                           input_indexes_modified, output_indexes_modified);</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a69d36c7781410ae1890ad1fd30b4cb50"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a69d36c7781410ae1890ad1fd30b4cb50">kaldi::nnet3::time_height_convolution::GetIndexesForComputation</a></div><div class="ttdeci">void GetIndexesForComputation(const ConvolutionComputationIo &amp;io, const std::vector&lt; Index &gt; &amp;orig_input_indexes, const std::vector&lt; Index &gt; &amp;orig_output_indexes, std::vector&lt; Index &gt; *input_indexes, std::vector&lt; Index &gt; *output_indexes)</div><div class="ttdoc">This function computes the reordered and possibly padded indexes corresponding to the computation in ...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01543">convolution.cc:1543</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_ae29d8557b8598f2eb6f449f8fa6f2eff"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ae29d8557b8598f2eb6f449f8fa6f2eff">kaldi::nnet3::time_height_convolution::UnPadModelHeight</a></div><div class="ttdeci">void UnPadModelHeight(const ConvolutionComputationOptions &amp;opts, const ConvolutionModel &amp;model, const ConvolutionModel &amp;model_padded, ConvolutionComputation *computation)</div><div class="ttdoc">This function modifies, if necessary, a computation that has been built for the model &amp;#39;model_padded&amp;#39;...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01001">convolution.cc:1001</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a078ae274f46ec580d9906969502be607"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a078ae274f46ec580d9906969502be607">kaldi::nnet3::time_height_convolution::MakeComputation</a></div><div class="ttdeci">void MakeComputation(const ConvolutionModel &amp;model, ConvolutionComputationIo &amp;io, const ConvolutionComputationOptions &amp;opts, ConvolutionComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01568">convolution.cc:1568</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a47f39055ac1392988d58a331b6557715"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a47f39055ac1392988d58a331b6557715">kaldi::nnet3::time_height_convolution::AppendInputFrames</a></div><div class="ttdeci">void AppendInputFrames(const ConvolutionModel &amp;model, ConvolutionComputationIo *io, ConvolutionModel *model_appended, ConvolutionComputationIo *io_appended)</div><div class="ttdoc">This function takes an input model and I/O specification, and it modifies both of them if necessary t...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01203">convolution.cc:1203</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a8eaf9d986968b634b59294d1beac7e39"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a8eaf9d986968b634b59294d1beac7e39">kaldi::nnet3::time_height_convolution::PadModelHeight</a></div><div class="ttdeci">void PadModelHeight(const ConvolutionModel &amp;model, ConvolutionModel *model_padded)</div><div class="ttdoc">This function takes a model that might require zero padding in the height dimension and outputs a mod...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00918">convolution.cc:918</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_ae62a1a6a9f5852ccbac183045ab6815e"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ae62a1a6a9f5852ccbac183045ab6815e">kaldi::nnet3::time_height_convolution::GetComputationIo</a></div><div class="ttdeci">void GetComputationIo(const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, ConvolutionComputationIo *io)</div><div class="ttdoc">This function takes lists of input and output indexes to a computation (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01519">convolution.cc:1519</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a3fd1345b28f79b4202490ef8136c8ab0"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3fd1345b28f79b4202490ef8136c8ab0">kaldi::nnet3::time_height_convolution::CheckModelAndIo</a></div><div class="ttdeci">void CheckModelAndIo(const ConvolutionModel &amp;model, const ConvolutionComputationIo &amp;io, bool allow_extra_input)</div><div class="ttdoc">Check that this model and this I/O request are compatible in terms of required context, etc, and crash if not. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01329">convolution.cc:1329</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_adcb71a0f9a1a1170eea7c1f30637eb51"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#adcb71a0f9a1a1170eea7c1f30637eb51">kaldi::nnet3::time_height_convolution::PadComputationInputTime</a></div><div class="ttdeci">void PadComputationInputTime(const ConvolutionModel &amp;model, ConvolutionComputationIo *io)</div><div class="ttdoc">This function extends the set of input indexes that the computation has, to account for any required ...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01051">convolution.cc:1051</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a62189e199d074c5393e2b3838f23601e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62189e199d074c5393e2b3838f23601e">&#9670;&nbsp;</a></span>ComputeTempMatrixSize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::ComputeTempMatrixSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function sets 'temp_rows' and 'temp_cols' in 'computation'. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00956">956</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_in</a>, <a class="el" href="convolution_8h_source.html#l00313">ConvolutionComputation::ConvolutionStep::height_map</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="convolution_8h_source.html#l00366">ConvolutionComputationOptions::max_memory_mb</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_out</a>, <a class="el" href="convolution_8h_source.html#l00343">ConvolutionComputation::steps</a>, <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_cols</a>, <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_rows</a>, and <a class="el" href="convolution_8cc_source.html#l00077">VectorIsContiguous()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01568">MakeComputation()</a>, and <a class="el" href="convolution_8cc_source.html#l01001">UnPadModelHeight()</a>.</p>
<div class="fragment"><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                                                                       {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  int32 temp_rows = 0, temp_cols = 0;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; computation-&gt;steps.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keyword">const</span> ConvolutionComputation::ConvolutionStep &amp;step = computation-&gt;steps[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    int32 height_map_size = step.height_map.size(),</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        this_num_cols = height_map_size * computation-&gt;num_filters_in;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordtype">bool</span> columns_are_contiguous =</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        (step.height_map[0] != -1 &amp;&amp; <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af3b5f58dc778b471a98dace82d84ed1a">VectorIsContiguous</a>(step.height_map));</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordtype">bool</span> need_temp_matrix = <span class="keyword">true</span>;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">if</span> (columns_are_contiguous &amp;&amp; step.height_map[0] == 0 &amp;&amp;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        this_num_cols == computation-&gt;num_filters_in * computation-&gt;height_in) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="comment">// the only situation in which we wouldn&#39;t need the temporary matrix</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="comment">// for this step, is where the columns are all of the input matrix.</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      need_temp_matrix = <span class="keyword">false</span>;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">if</span> (need_temp_matrix &amp;&amp; this_num_cols &gt; temp_cols)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      temp_cols = this_num_cols;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  }</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">if</span> (temp_cols &gt; 0) {</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// work out how many rows the temporary matrix should have, taking</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">// into account the specified memory limit.</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    temp_rows = computation-&gt;num_t_out * computation-&gt;num_images;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> num_megabytes = (4 * temp_rows * temp_cols) / 1000000.0,</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        megabyte_limit = opts.max_memory_mb;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// C++ rounds down; here, we want to round up so we add one.</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    int32 ratio = 1.0 + num_megabytes / megabyte_limit;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">// divide the number of time steps into &#39;ratio&#39; pieces that are as equal as</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">// possible; round up when dividing, to make sure that new_temp_rows * ratio</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// &gt;= temp_rows so that we don&#39;t have a small leftover piece.</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    int32 new_num_t_out = (computation-&gt;num_t_out + ratio - 1) / ratio;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    temp_rows = new_num_t_out * computation-&gt;num_images;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> new_num_megabytes = (4 * temp_rows * temp_cols) / 1000000.0;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="comment">// make sure we&#39;re within the memory limit.</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">if</span> (new_num_megabytes &gt; 1.01 * megabyte_limit) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Memory consumed in convolution is more than requested &quot;</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;(maybe very long time sequence?)&quot;</span>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  computation-&gt;temp_rows = temp_rows;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  computation-&gt;temp_cols = temp_cols;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_af3b5f58dc778b471a98dace82d84ed1a"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af3b5f58dc778b471a98dace82d84ed1a">kaldi::nnet3::time_height_convolution::VectorIsContiguous</a></div><div class="ttdeci">static bool VectorIsContiguous(const std::vector&lt; int32 &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00077">convolution.cc:77</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7c24c02ba2b5c29ad1854da071902744"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c24c02ba2b5c29ad1854da071902744">&#9670;&nbsp;</a></span>ConvolveBackwardData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConvolveBackwardData </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>conv_comp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This does the part of the backward derivative computation of convolution, that propagates derivatives back to the input data. </p>
<p>See also <a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a55135cbe454ca7d1333962ed8bdb1476" title="This does the part of the backward derivative computation of convolution, that computes derivatives w...">ConvolveBackwardParams()</a>, which is for the parameter derivative.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conv_comp</td><td>A struct that describes the convolution computation (should be the same as in the corresponding forward pass). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">params</td><td>The parameters used in the forward convolution. This should be of dimension num_filters_out by (X * num_filters_in), where X is the total number of pixels in the patches, which equals model.offsets.size() in the model for which the computation was compiled. E.g. for a regular 3x3 kernel, X would be 9. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">output_deriv</td><td>The derivative of the objective function w.r.t. the output of the convolution. Should be of dimension conv_comp.num_t_out * conv_comp.num_images by conv_comp.height_out num_filters_out. It must satisfy output_deriv.NumCols() == output_deriv.Stride(). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">input_deriv</td><td>If non-NULL, the backpropagated derivative of the objective function w.r.t. the input will be *added to* this matrix. Should be the same dimension as the input to the original <a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c" title="This does the forward computation of convolution. ">ConvolveForward()</a> call. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00682">682</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00603">ConvolveBackwardDataInternal()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_in</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="matrix-common_8h_source.html#l00038">kaldi::kSetZero</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_out</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>, <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_cols</a>, and <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_rows</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-convolutional-component_8cc_source.html#l00301">TimeHeightConvolutionComponent::Backprop()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00308">TestDataBackprop()</a>.</p>
<div class="fragment"><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                                          {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_deriv-&gt;NumCols() == input_deriv-&gt;Stride() &amp;&amp;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;               output_deriv.NumCols() == output_deriv.Stride());</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumRows() == cc.num_filters_out);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_deriv.NumRows() == cc.num_t_out * cc.num_images &amp;&amp;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;               output_deriv.NumCols() == cc.height_out * cc.num_filters_out);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="comment">// the input might need to be reshaped but we can check its total size.</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_deriv-&gt;NumRows() * input_deriv-&gt;NumCols() ==</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;               cc.num_images * cc.num_t_in * cc.height_in * cc.num_filters_in);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  int32 input_rows = input_deriv-&gt;NumRows(),</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      required_input_rows = cc.num_images * cc.num_t_in;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// this if-statement handles reshaping the input and recursing if there</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="comment">// is subsampling.</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordflow">if</span> (input_rows != required_input_rows) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span> (input_rows % required_input_rows != 0)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Input matrix has wrong size.&quot;</span>;  <span class="comment">// error in calling code.</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">// nr is a multiple of required_nr.  Reshape the matrix.</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="comment">// we already checked that its Stride() == NumCols();</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    int32 num_cols = input_deriv-&gt;NumCols(),</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        multiple = input_rows / required_input_rows,</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        new_num_cols = num_cols * multiple,</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        new_stride = new_num_cols;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; input_deriv_reshaped(</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        input_deriv-&gt;Data(), required_input_rows,</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        new_num_cols, new_stride);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c24c02ba2b5c29ad1854da071902744">ConvolveBackwardData</a>(cc, params, output_deriv, &amp;input_deriv_reshaped);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  CuMatrix&lt;BaseFloat&gt; temp_mat(cc.temp_rows, cc.temp_cols,</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                               <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">// this if-statement handles breaking up the arguments</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">// and the computation into row-ranges if the temporary</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">// matrix would have been excessively large, and we&#39;ve decided</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="comment">// to give it fewer rows than the output (this saves</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">// memory).  normally we won&#39;t take this if-statement</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="comment">// so ignore it if you&#39;re trying to understand the framework.</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordflow">if</span> (cc.temp_rows != 0 &amp;&amp; cc.temp_rows != input_rows) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cc.temp_rows % cc.num_images == 0);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    int32 num_time_steps_per_chunk = cc.temp_rows / cc.num_images;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    int32 num_extra_in = cc.num_t_in - cc.num_t_out;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">for</span> (int32 t_start = 0; t_start &lt; cc.num_t_out;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;         t_start += num_time_steps_per_chunk) {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      int32 num_t_left = cc.num_t_out - t_start,</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;          this_num_t_out = std::min&lt;int32&gt;(num_t_left,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                                           num_time_steps_per_chunk),</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          this_num_t_in = this_num_t_out + num_extra_in;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; input_deriv_part(</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;          *input_deriv, t_start * cc.num_images,</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          this_num_t_in * cc.num_images,</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          0, input_deriv-&gt;NumCols());</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; output_deriv_part(</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;          output_deriv, t_start * cc.num_images,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          this_num_t_out * cc.num_images,</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;          0, output_deriv.NumCols());</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_part(</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          temp_mat, 0, this_num_t_out * cc.num_images,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          0, temp_mat.NumCols());</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4867698b8c802d67dc2f2d313c98af2e">ConvolveBackwardDataInternal</a>(cc, params, output_deriv_part,</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                   &amp;temp_part, &amp;input_deriv_part);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  }</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4867698b8c802d67dc2f2d313c98af2e">ConvolveBackwardDataInternal</a>(cc, params, output_deriv,</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                               &amp;temp_mat, input_deriv);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a4867698b8c802d67dc2f2d313c98af2e"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4867698b8c802d67dc2f2d313c98af2e">kaldi::nnet3::time_height_convolution::ConvolveBackwardDataInternal</a></div><div class="ttdeci">static void ConvolveBackwardDataInternal(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, const CuMatrixBase&lt; BaseFloat &gt; &amp;output_deriv, CuMatrixBase&lt; BaseFloat &gt; *temp_mat, CuMatrixBase&lt; BaseFloat &gt; *input_deriv)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00603">convolution.cc:603</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a7c24c02ba2b5c29ad1854da071902744"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c24c02ba2b5c29ad1854da071902744">kaldi::nnet3::time_height_convolution::ConvolveBackwardData</a></div><div class="ttdeci">void ConvolveBackwardData(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, const CuMatrixBase&lt; BaseFloat &gt; &amp;output_deriv, CuMatrixBase&lt; BaseFloat &gt; *input_deriv)</div><div class="ttdoc">This does the part of the backward derivative computation of convolution, that propagates derivatives...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00682">convolution.cc:682</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kaldi::kSetZero</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00038">matrix-common.h:38</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4867698b8c802d67dc2f2d313c98af2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4867698b8c802d67dc2f2d313c98af2e">&#9670;&nbsp;</a></span>ConvolveBackwardDataInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::ConvolveBackwardDataInternal </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>cc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>temp_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00603">603</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="convolution_8h_source.html#l00332">ConvolutionComputation::ConvolutionStep::backward_columns</a>, <a class="el" href="convolution_8h_source.html#l00323">ConvolutionComputation::ConvolutionStep::columns</a>, <a class="el" href="convolution_8h_source.html#l00337">ConvolutionComputation::ConvolutionStep::columns_are_contiguous</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-array_8h_source.html#l00049">CuArrayBase&lt; T &gt;::Dim()</a>, <a class="el" href="convolution_8h_source.html#l00341">ConvolutionComputation::ConvolutionStep::first_column</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="convolution_8h_source.html#l00296">ConvolutionComputation::ConvolutionStep::input_time_shift</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="convolution_8h_source.html#l00301">ConvolutionComputation::ConvolutionStep::params_start_col</a>, <a class="el" href="convolution_8h_source.html#l00343">ConvolutionComputation::steps</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l00682">ConvolveBackwardData()</a>.</p>
<div class="fragment"><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                          {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(temp_mat-&gt;Stride() == temp_mat-&gt;NumCols());</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">// num_t_out supersedes cc.num_t_out (they&#39;ll only be different in</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">// cases where we are doing the computation in pieces to save memory).</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  int32 input_rows = input_deriv-&gt;NumRows(),</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      output_rows = output_deriv.NumRows();</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_rows &lt;= input_rows &amp;&amp;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;               input_rows % cc.num_images == 0 &amp;&amp;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;               output_rows % cc.num_images == 0);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  int32 num_steps = cc.steps.size();</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="keywordflow">for</span> (int32 s = 0; s &lt; num_steps; s++) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keyword">const</span> ConvolutionComputation::ConvolutionStep &amp;step = cc.steps[s];</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    int32 input_row_start = step.input_time_shift * cc.num_images;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; input_deriv_part(*input_deriv,</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                            input_row_start, output_rows,</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                            0, input_deriv-&gt;NumCols());</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    int32 temp_num_cols = step.columns.Dim(),</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        param_cols = temp_num_cols / cc.height_out;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; params_part(params,</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                       0, params.NumRows(),</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                       step.params_start_col,</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                       param_cols);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; output_deriv_reshaped(</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        output_deriv.Data(), output_rows * cc.height_out,</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        cc.num_filters_out, cc.num_filters_out);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> (!step.columns_are_contiguous ||</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        temp_num_cols != input_deriv-&gt;NumCols()) {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="comment">// In most cases we will take this branch, where we have to propagate the</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="comment">// input-derivative via a temporary matrix.  (however, different steps may</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="comment">// require different num-cols of the temporary matrix, so we create</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="comment">// sub-parts of &#39;temp_mat&#39;.</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="comment">// We create the sub-matrix &#39;temp_mat_part&#39; in a lower-level way, using</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="comment">// pointers, because we need to ensure that its num-cols and the stride</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="comment">// are the same (this is necessary so that we can do reshaping in</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">// ConvolutionReshapedMultiply()).</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_mat_part(temp_mat-&gt;Data(),</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                           temp_mat-&gt;NumRows(),</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                           temp_num_cols, temp_num_cols),</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          temp_mat_part_reshaped(</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;              temp_mat_part.Data(), temp_mat_part.NumRows() * cc.height_out,</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;              temp_num_cols / cc.height_out, temp_num_cols / cc.height_out);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      temp_mat_part_reshaped.AddMatMat(1.0, output_deriv_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                       params_part, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">if</span> (!step.columns_are_contiguous) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; step.backward_columns.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          input_deriv_part.AddCols(temp_mat_part, step.backward_columns[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="comment">// we&#39;re just taking a sub-matrix of the input matrix, but we still need</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="comment">// to make a copy because we need the stride == num-cols (so that the</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="comment">// reshaping will work).</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        int32 num_cols = step.columns.Dim();</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        input_deriv_part.ColRange(step.first_column,</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                                  num_cols).AddMat(1.0, temp_mat_part);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; input_deriv_reshaped(</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          input_deriv_part.Data(), input_deriv_part.NumRows() * cc.height_out,</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;          input_deriv_part.NumCols() / cc.height_out,</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;          input_deriv_part.NumCols() / cc.height_out);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      input_deriv_reshaped.AddMatMat(1.0, output_deriv_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                                     params_part, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a55135cbe454ca7d1333962ed8bdb1476"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55135cbe454ca7d1333962ed8bdb1476">&#9670;&nbsp;</a></span>ConvolveBackwardParams()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConvolveBackwardParams </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>conv_comp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This does the part of the backward derivative computation of convolution, that computes derivatives w.r.t. </p>
<p>the parameters. See also <a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c24c02ba2b5c29ad1854da071902744" title="This does the part of the backward derivative computation of convolution, that propagates derivatives...">ConvolveBackwardData()</a>, which computes derivatives w.r.t. the input data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conv_comp</td><td>A struct that describes the computation that was performed in the forward pass. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>The input to the original forward convolution. This should be of dimension (or should be reshapable to the dimension) conv_comp.num_t_in * conv_comp.num_images by conv_comp.height_in * num_filters_in. [highest-stride indexes come first in these multiplications]. It must satisfy input.NumCols() == input.Stride(). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">output_deriv</td><td>The derivative of the objective function w.r.t. the output of the convolution. Should be of dimension conv_comp.num_t_out * conv_comp.num_images by conv_comp.height_out num_filters_out. It must satisfy output_deriv.NumCols() == output_deriv.Stride(). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alpha</td><td>This scalar is multiplied into the derivative when we add to params_deriv, i.e. *params_deriv += alpha * derivative. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">params_deriv</td><td>The derivative of the objective function w.r.t the parameters (the 'params' given to the ConvolveForward function) is *added* to this location. This matrix should be of dimension conv_comp.NumRows() by conv_comp.NumCols(). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00840">840</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00763">ConvolveBackwardParamsInternal()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_in</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_out</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>, <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_cols</a>, and <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_rows</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00350">TestParamsBackprop()</a>, <a class="el" href="nnet-convolutional-component_8cc_source.html#l00353">TimeHeightConvolutionComponent::UpdateNaturalGradient()</a>, and <a class="el" href="nnet-convolutional-component_8cc_source.html#l00333">TimeHeightConvolutionComponent::UpdateSimple()</a>.</p>
<div class="fragment"><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                           {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input.NumCols() == input.Stride() &amp;&amp;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;              output_deriv.NumCols() == output_deriv.Stride());</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params_deriv-&gt;NumRows() == cc.num_filters_out);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_deriv.NumRows() == cc.num_t_out * cc.num_images &amp;&amp;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;               output_deriv.NumCols() == cc.height_out * cc.num_filters_out);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="comment">// the input might need to be reshaped but we can check its total size.</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input.NumRows() * input.NumCols() == cc.num_images *</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;               cc.num_t_in * cc.height_in * cc.num_filters_in);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  int32 input_rows = input.NumRows(),</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      required_input_rows = cc.num_images * cc.num_t_in;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="comment">// this if-statement handles reshaping the input and recursing if there</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="comment">// is subsampling.</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">if</span> (input_rows != required_input_rows) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">if</span> (input_rows % required_input_rows != 0)</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Input matrix has wrong size.&quot;</span>;  <span class="comment">// error in calling code.</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// nr is a multiple of required_nr.  Reshape the matrix.</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">// we already checked that its Stride() == NumCols();</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    int32 num_cols = input.NumCols(),</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        multiple = input_rows / required_input_rows,</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        new_num_cols = num_cols * multiple,</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        new_stride = new_num_cols;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; input_reshaped(</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        input.Data(), required_input_rows, new_num_cols, new_stride);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a55135cbe454ca7d1333962ed8bdb1476">ConvolveBackwardParams</a>(cc, input_reshaped, output_deriv, alpha,</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                           params_deriv);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  CuMatrix&lt;BaseFloat&gt; temp_mat(cc.temp_rows, cc.temp_cols,</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                               <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// this if-statement handles breaking up the arguments</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">// and the computation into row-ranges if the temporary</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// matrix would have been excessively large, and we&#39;ve decided</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">// to give it fewer rows than the output (this saves</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="comment">// memory).  normally we won&#39;t take this if-statement</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// so ignore it if you&#39;re trying to understand the framework.</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordflow">if</span> (cc.temp_rows != 0 &amp;&amp; cc.temp_rows != input_rows) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cc.temp_rows % cc.num_images == 0);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    int32 num_time_steps_per_chunk = cc.temp_rows / cc.num_images;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    int32 num_extra_in = cc.num_t_in - cc.num_t_out;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">for</span> (int32 t_start = 0; t_start &lt; cc.num_t_out;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;         t_start += num_time_steps_per_chunk) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      int32 num_t_left = cc.num_t_out - t_start,</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          this_num_t_out = std::min&lt;int32&gt;(num_t_left,</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                           num_time_steps_per_chunk),</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;          this_num_t_in = this_num_t_out + num_extra_in;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; input_part(</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          input, t_start * cc.num_images,</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;          this_num_t_in * cc.num_images,</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          0, input.NumCols());</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; output_deriv_part(</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          output_deriv, t_start * cc.num_images,</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;          this_num_t_out * cc.num_images,</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;          0, output_deriv.NumCols());</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_part(temp_mat,</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                       0, this_num_t_out * cc.num_images,</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                       0, temp_mat.NumCols());</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3cf8fc06d67e83fd9c4257bf69e33ffa">ConvolveBackwardParamsInternal</a>(cc, input_part, output_deriv_part,</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                                     alpha, &amp;temp_part, params_deriv);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3cf8fc06d67e83fd9c4257bf69e33ffa">ConvolveBackwardParamsInternal</a>(cc, input, output_deriv,</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                 alpha, &amp;temp_mat, params_deriv);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a55135cbe454ca7d1333962ed8bdb1476"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a55135cbe454ca7d1333962ed8bdb1476">kaldi::nnet3::time_height_convolution::ConvolveBackwardParams</a></div><div class="ttdeci">void ConvolveBackwardParams(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;output_deriv, BaseFloat alpha, CuMatrixBase&lt; BaseFloat &gt; *params_deriv)</div><div class="ttdoc">This does the part of the backward derivative computation of convolution, that computes derivatives w...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00840">convolution.cc:840</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a3cf8fc06d67e83fd9c4257bf69e33ffa"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3cf8fc06d67e83fd9c4257bf69e33ffa">kaldi::nnet3::time_height_convolution::ConvolveBackwardParamsInternal</a></div><div class="ttdeci">static void ConvolveBackwardParamsInternal(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;output_deriv, BaseFloat alpha, CuMatrixBase&lt; BaseFloat &gt; *temp_mat, CuMatrixBase&lt; BaseFloat &gt; *params_deriv)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00763">convolution.cc:763</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3cf8fc06d67e83fd9c4257bf69e33ffa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cf8fc06d67e83fd9c4257bf69e33ffa">&#9670;&nbsp;</a></span>ConvolveBackwardParamsInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::ConvolveBackwardParamsInternal </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>cc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>temp_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00763">763</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="convolution_8h_source.html#l00323">ConvolutionComputation::ConvolutionStep::columns</a>, <a class="el" href="convolution_8h_source.html#l00337">ConvolutionComputation::ConvolutionStep::columns_are_contiguous</a>, <a class="el" href="cu-matrix_8cc_source.html#l02623">CuMatrixBase&lt; Real &gt;::CopyCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-array_8h_source.html#l00049">CuArrayBase&lt; T &gt;::Dim()</a>, <a class="el" href="convolution_8h_source.html#l00341">ConvolutionComputation::ConvolutionStep::first_column</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="convolution_8h_source.html#l00296">ConvolutionComputation::ConvolutionStep::input_time_shift</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="convolution_8h_source.html#l00301">ConvolutionComputation::ConvolutionStep::params_start_col</a>, <a class="el" href="convolution_8h_source.html#l00343">ConvolutionComputation::steps</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l00840">ConvolveBackwardParams()</a>.</p>
<div class="fragment"><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                           {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(temp_mat-&gt;Stride() == temp_mat-&gt;NumCols());</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="comment">// num_t_out supersedes cc.num_t_out (they&#39;ll only be different in</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// cases where we are doing the computation in pieces to save memory).</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  int32 input_rows = input.NumRows(),</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      output_rows = output_deriv.NumRows();</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_rows &lt;= input_rows &amp;&amp;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;               input_rows % cc.num_images == 0 &amp;&amp;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;               output_rows % cc.num_images == 0);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  int32 num_steps = cc.steps.size();</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordflow">for</span> (int32 s = 0; s &lt; num_steps; s++) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keyword">const</span> ConvolutionComputation::ConvolutionStep &amp;step = cc.steps[s];</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    int32 input_row_start = step.input_time_shift * cc.num_images;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// note: &#39;input_part&#39; will normally be almost all of &#39;input&#39;, perhaps</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// minus one or two time steps at the start or end.</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; input_part(input,</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                                      input_row_start, output_rows,</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                                      0, input.NumCols());</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    int32 temp_num_cols = step.columns.Dim(),</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        param_cols = temp_num_cols / cc.height_out;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; params_deriv_part(*params_deriv,</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                                       0, params_deriv-&gt;NumRows(),</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                                       step.params_start_col,</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                                       param_cols);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; output_deriv_reshaped(</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        output_deriv.Data(), output_rows * cc.height_out,</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        cc.num_filters_out, cc.num_filters_out);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">if</span> (!step.columns_are_contiguous ||</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        temp_num_cols != input.NumCols()) {</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="comment">// In most cases we will take this branch, where we have to copy the input</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="comment">// to a temporary matrix.  (however, different steps may require different</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="comment">// num-cols of the temporary matrix, so we create sub-parts of &#39;temp_mat&#39;.</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="comment">// We create the sub-matrix &#39;temp_mat_part&#39; in a lower-level way, using</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <span class="comment">// pointers, because we need to ensure that its num-cols and the stride</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      <span class="comment">// are the same (this is necessary so that we can do reshaping in</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="comment">// ConvolutionReshapedMultiply()).</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_mat_part(temp_mat-&gt;Data(),</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                                           temp_mat-&gt;NumRows(),</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                           temp_num_cols, temp_num_cols);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">if</span> (!step.columns_are_contiguous) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">// we&#39;re doing a column mapping.</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        temp_mat_part.CopyCols(input_part, step.columns);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="comment">// we&#39;re just taking a sub-matrix of the input matrix, but we still need</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="comment">// to make a copy because we need the stride == num-cols (so that the</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="comment">// reshaping will work).</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        temp_mat_part.CopyFromMat(input_part.ColRange(step.first_column,</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                                      step.columns.Dim()));</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_mat_part_reshaped(</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;          temp_mat_part.Data(), temp_mat_part.NumRows() * cc.height_out,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;          temp_num_cols / cc.height_out, temp_num_cols / cc.height_out);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      params_deriv_part.AddMatMat(alpha, output_deriv_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>,</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                  temp_mat_part_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; input_reshaped(</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;          input_part.Data(), input_part.NumRows() * cc.height_out,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          input_part.NumCols() / cc.height_out,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;          input_part.NumCols() / cc.height_out);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      params_deriv_part.AddMatMat(alpha, output_deriv_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>,</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                                  input_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  }</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad1cde1ebf0949cbc13fb9678bde0a70c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1cde1ebf0949cbc13fb9678bde0a70c">&#9670;&nbsp;</a></span>ConvolveForward()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConvolveForward </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>conv_comp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This does the forward computation of convolution. </p>
<p>(note: this is convolution without a bias term; you have to handle that separately).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conv_comp</td><td>A struct that describes the computation to be performed. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>The input to the convolution. This should be of dimension (or should be reshapable to the dimension) conv_comp.num_t_in * conv_comp.num_images by conv_comp.height_in * num_filters_in. [highest-stride indexes come first in these multiplications]. It must satisfy input.NumCols() == input.Stride(). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">params</td><td>The parameters of the convolution. This should be of dimension conv_comp.ParamRows() by conv_comp.ParamCols(). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">output</td><td>The output of the convolution (this function adds to* the output). Should be of dimension conv_comp.num_t_out * conv_comp.num_images by conv_comp.height_out * num_filters_out. It must satisfy output.NumCols() == output.Stride(). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00524">524</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00448">ConvolveForwardInternal()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_in</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_out</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>, <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_cols</a>, and <a class="el" href="convolution_8h_source.html#l00282">ConvolutionComputation::temp_rows</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-convolutional-component_8cc_source.html#l00282">TimeHeightConvolutionComponent::Propagate()</a>, <a class="el" href="convolution-test_8cc_source.html#l00308">TestDataBackprop()</a>, <a class="el" href="convolution-test_8cc_source.html#l00350">TestParamsBackprop()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00280">TestRunningComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                     {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input.NumCols() == input.Stride() &amp;&amp;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;               output-&gt;NumCols() == output-&gt;Stride());</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumRows() == cc.num_filters_out);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;NumRows() == cc.num_t_out * cc.num_images &amp;&amp;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;               output-&gt;NumCols() == cc.height_out * cc.num_filters_out);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">// the input might need to be reshaped but we can check its total size.</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input.NumRows() * input.NumCols() == cc.num_images *</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;               cc.num_t_in * cc.height_in * cc.num_filters_in);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  int32 input_rows = input.NumRows(),</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      required_input_rows = cc.num_images * cc.num_t_in;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">// this if-statement handles reshaping the input and recursing if there</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">// is subsampling.</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordflow">if</span> (input_rows != required_input_rows) {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">if</span> (input_rows % required_input_rows != 0)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Input matrix has wrong size.&quot;</span>;  <span class="comment">// error in calling code.</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">// nr is a multiple of required_nr.  Reshape the matrix.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// we already checked that its Stride() == NumCols();</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    int32 num_cols = input.NumCols(),</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        multiple = input_rows / required_input_rows,</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        new_num_cols = num_cols * multiple,</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        new_stride = new_num_cols;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; input_reshaped(</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        input.Data(), required_input_rows, new_num_cols, new_stride);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">ConvolveForward</a>(cc, input_reshaped, params, output);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  CuMatrix&lt;BaseFloat&gt; temp_mat(cc.temp_rows, cc.temp_cols,</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                               <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">// this if-statement handles breaking up the arguments</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="comment">// and the computation into row-ranges if the temporary</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">// matrix would have been excessively large, and we&#39;ve decided</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">// to give it fewer rows than the output (this saves</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// memory).  normally we won&#39;t take this if-statement</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// so ignore it if you&#39;re trying to understand the framework.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">if</span> (cc.temp_rows != 0 &amp;&amp; cc.temp_rows != input_rows) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cc.temp_rows % cc.num_images == 0);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    int32 num_time_steps_per_chunk = cc.temp_rows / cc.num_images;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    int32 num_extra_in = cc.num_t_in - cc.num_t_out;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">for</span> (int32 t_start = 0; t_start &lt; cc.num_t_out;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;         t_start += num_time_steps_per_chunk) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      int32 num_t_left = cc.num_t_out - t_start,</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          this_num_t_out = std::min&lt;int32&gt;(num_t_left,</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                           num_time_steps_per_chunk),</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          this_num_t_in = this_num_t_out + num_extra_in;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; input_part(input, t_start * cc.num_images,</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                                        this_num_t_in * cc.num_images,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                        0, input.NumCols());</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; output_part(*output, t_start * cc.num_images,</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                         this_num_t_out * cc.num_images,</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                                         0, output-&gt;NumCols());</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_part(temp_mat, 0,</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                       this_num_t_out * cc.num_images,</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                                       0, temp_mat.NumCols());</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4b1ace22a4e6edbfc7c475ab711b1930">ConvolveForwardInternal</a>(cc, input_part, params,</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                              &amp;temp_part, &amp;output_part);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4b1ace22a4e6edbfc7c475ab711b1930">ConvolveForwardInternal</a>(cc, input, params, &amp;temp_mat, output);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a4b1ace22a4e6edbfc7c475ab711b1930"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a4b1ace22a4e6edbfc7c475ab711b1930">kaldi::nnet3::time_height_convolution::ConvolveForwardInternal</a></div><div class="ttdeci">static void ConvolveForwardInternal(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, CuMatrixBase&lt; BaseFloat &gt; *temp_mat, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00448">convolution.cc:448</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_ad1cde1ebf0949cbc13fb9678bde0a70c"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">kaldi::nnet3::time_height_convolution::ConvolveForward</a></div><div class="ttdeci">void ConvolveForward(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdoc">This does the forward computation of convolution. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00524">convolution.cc:524</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b1ace22a4e6edbfc7c475ab711b1930"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b1ace22a4e6edbfc7c475ab711b1930">&#9670;&nbsp;</a></span>ConvolveForwardInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::ConvolveForwardInternal </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>cc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>temp_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00448">448</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="convolution_8h_source.html#l00323">ConvolutionComputation::ConvolutionStep::columns</a>, <a class="el" href="convolution_8h_source.html#l00337">ConvolutionComputation::ConvolutionStep::columns_are_contiguous</a>, <a class="el" href="cu-matrix_8cc_source.html#l02623">CuMatrixBase&lt; Real &gt;::CopyCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-array_8h_source.html#l00049">CuArrayBase&lt; T &gt;::Dim()</a>, <a class="el" href="convolution_8h_source.html#l00341">ConvolutionComputation::ConvolutionStep::first_column</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="convolution_8h_source.html#l00296">ConvolutionComputation::ConvolutionStep::input_time_shift</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="convolution_8h_source.html#l00301">ConvolutionComputation::ConvolutionStep::params_start_col</a>, <a class="el" href="convolution_8h_source.html#l00343">ConvolutionComputation::steps</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l00524">ConvolveForward()</a>.</p>
<div class="fragment"><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                     {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(temp_mat-&gt;Stride() == temp_mat-&gt;NumCols());</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// num_t_out supersedes cc.num_t_out (they&#39;ll only be different in</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">// cases where we are doing the computation in pieces to save memory).</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  int32 input_rows = input.NumRows(),</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      output_rows = output-&gt;NumRows();</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_rows &lt;= input_rows &amp;&amp;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;               input_rows % cc.num_images == 0 &amp;&amp;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;               output_rows % cc.num_images == 0);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  int32 num_steps = cc.steps.size();</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">for</span> (int32 s = 0; s &lt; num_steps; s++) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keyword">const</span> ConvolutionComputation::ConvolutionStep &amp;step = cc.steps[s];</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    int32 input_row_start = step.input_time_shift * cc.num_images;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// note: &#39;input_part&#39; will normally be almost all of &#39;input&#39;, perhaps</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// minus one or two time steps at the start or end.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; input_part(input,</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                      input_row_start, output_rows,</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                                      0, input.NumCols());</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    int32 temp_num_cols = step.columns.Dim(),</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        param_cols = temp_num_cols / cc.height_out;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; params_part(params,</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                                       0, params.NumRows(),</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                                       step.params_start_col,</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                                       param_cols);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    CuSubMatrix&lt;BaseFloat&gt; output_reshaped(</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        output-&gt;Data(), output_rows * cc.height_out,</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        cc.num_filters_out, cc.num_filters_out);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (!step.columns_are_contiguous ||</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        temp_num_cols != input.NumCols()) {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">// In most cases we will take this branch, where we have to copy the input</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="comment">// to a temporary matrix.  (however, different steps may require different</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="comment">// num-cols of the temporary matrix, so we create sub-parts of &#39;temp_mat&#39;.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="comment">// We create the sub-matrix &#39;temp_mat_part&#39; in a lower-level way, using</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="comment">// pointers, because we need to ensure that its num-cols and the stride</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="comment">// are the same (this is necessary so that we can do reshaping in</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="comment">// ConvolutionReshapedMultiply()).</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_mat_part(temp_mat-&gt;Data(),</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                           temp_mat-&gt;NumRows(),</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                           temp_num_cols, temp_num_cols);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keywordflow">if</span> (!step.columns_are_contiguous) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">// we&#39;re doing a column mapping.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        temp_mat_part.CopyCols(input_part, step.columns);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment">// we&#39;re just taking a sub-matrix of the input matrix, but we still need</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment">// to make a copy because we need the stride == num-cols (so that the</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">// reshaping will work).</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        temp_mat_part.CopyFromMat(input_part.ColRange(step.first_column,</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                                                      step.columns.Dim()));</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; temp_mat_part_reshaped(</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          temp_mat_part.Data(), temp_mat_part.NumRows() * cc.height_out,</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;          temp_num_cols / cc.height_out, temp_num_cols / cc.height_out);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      output_reshaped.AddMatMat(1.0, temp_mat_part_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                params_part, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 1.0);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      CuSubMatrix&lt;BaseFloat&gt; input_reshaped(</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          input_part.Data(), input_part.NumRows() * cc.height_out,</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          input_part.NumCols() / cc.height_out,</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          input_part.NumCols() / cc.height_out);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      output_reshaped.AddMatMat(1.0, input_reshaped, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                                params_part, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 1.0);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a81fe4d0c3eaa483dca9e0f75059c2226"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81fe4d0c3eaa483dca9e0f75059c2226">&#9670;&nbsp;</a></span>ConvolveForwardSimple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::ConvolveForwardSimple </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_cu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params_cu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>output_cu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00218">218</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="convolution_8h_source.html#l00128">ConvolutionModel::height_in</a>, <a class="el" href="convolution_8h_source.html#l00129">ConvolutionModel::height_out</a>, <a class="el" href="convolution_8h_source.html#l00132">ConvolutionModel::height_subsample_out</a>, <a class="el" href="nnet-common_8cc_source.html#l00573">kaldi::nnet3::kNoTime</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="convolution_8h_source.html#l00126">ConvolutionModel::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00127">ConvolutionModel::num_filters_out</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="convolution_8h_source.html#l00157">ConvolutionModel::offsets</a>, and <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00280">TestRunningComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                        {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// these loops will be very slow on GPU, so do it all on CPU.</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> input(input_cu), params(params_cu),</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      output(*output_cu);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  std::unordered_map&lt;Index, int32, IndexHasher&gt; index_to_row;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  int32 input_rows = input.NumRows(),</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      output_rows = output.NumRows();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">for</span> (int32 r_in = 0; r_in &lt; input_rows; r_in++) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (input_indexes[r_in].t != <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>) {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      index_to_row[input_indexes[r_in]] = r_in;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  int32 num_offsets = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">offsets</a>.size(),</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      num_filters_in = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a15d88b7dff4152f85b8e864454d7be56">num_filters_in</a>,</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      num_filters_out = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab6517e72f4d0632f883d78c5b7ea8ef4">num_filters_out</a>,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      height_in = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a6d3d2e1318a0bff4f829953108391f17">height_in</a>,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      height_out = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">height_out</a>,</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      height_subsample_out = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ae8f1f2846a9eaabfec6b665ad055a850">height_subsample_out</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">for</span> (int32 r_out = 0; r_out &lt; output_rows; r_out++) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> index_out = output_indexes[r_out];</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (index_out.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> == <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> output_row(output, r_out);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span> (int32 o = 0; o &lt; num_offsets; o++) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      int32 time_offset = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">offsets</a>[o].time_offset,</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;          height_offset = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">offsets</a>[o].height_offset;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> index_in(index_out);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      index_in.t += time_offset;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      std::unordered_map&lt;Index, int32, IndexHasher&gt;::const_iterator iter =</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          index_to_row.find(index_in);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">if</span> (iter != index_to_row.end()) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <a class="code" href="classkaldi_1_1SubMatrix.html">SubMatrix&lt;BaseFloat&gt;</a> params_part(params, 0, params.NumRows(),</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                         o * num_filters_in, num_filters_in);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        int32 r_in = iter-&gt;second;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> input_row(input, r_in);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">for</span> (int32 h_out_subsampled = 0;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;             h_out_subsampled &lt; height_out;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;             h_out_subsampled++) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          int32 h_out = h_out_subsampled * height_subsample_out,</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;              h_in = h_out + height_offset;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;          <span class="keywordflow">if</span> (h_in &lt; 0 || h_in &gt;= height_in)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> output_part(output_row,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                           h_out_subsampled * num_filters_out,</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                                           num_filters_out),</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;              input_part(input_row, h_in * num_filters_in, num_filters_in);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;          output_part.AddMatVec(1.0, params_part, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, input_part, 1.0);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  output_cu-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a79817f1cbd9d8478d4137d6dd815a584">CopyFromMat</a>(output);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a79817f1cbd9d8478d4137d6dd815a584"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a79817f1cbd9d8478d4137d6dd815a584">kaldi::CuMatrixBase::CopyFromMat</a></div><div class="ttdeci">void CopyFromMat(const MatrixBase&lt; OtherReal &gt; &amp;src, MatrixTransposeType trans=kNoTrans)</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l00339">cu-matrix.cc:339</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ae8f1f2846a9eaabfec6b665ad055a850"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ae8f1f2846a9eaabfec6b665ad055a850">kaldi::nnet3::time_height_convolution::ConvolutionModel::height_subsample_out</a></div><div class="ttdeci">int32 height_subsample_out</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00132">convolution.h:132</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a6d3d2e1318a0bff4f829953108391f17"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a6d3d2e1318a0bff4f829953108391f17">kaldi::nnet3::time_height_convolution::ConvolutionModel::height_in</a></div><div class="ttdeci">int32 height_in</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00128">convolution.h:128</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ab6517e72f4d0632f883d78c5b7ea8ef4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab6517e72f4d0632f883d78c5b7ea8ef4">kaldi::nnet3::time_height_convolution::ConvolutionModel::num_filters_out</a></div><div class="ttdeci">int32 num_filters_out</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00127">convolution.h:127</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a15d88b7dff4152f85b8e864454d7be56"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a15d88b7dff4152f85b8e864454d7be56">kaldi::nnet3::time_height_convolution::ConvolutionModel::num_filters_in</a></div><div class="ttdeci">int32 num_filters_in</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00126">convolution.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html">kaldi::nnet3::Index</a></div><div class="ttdoc">struct Index is intended to represent the various indexes by which we number the rows of the matrices...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00044">nnet-common.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a2b4b07f084195f0a2563065b7d7ebbf9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">kaldi::nnet3::time_height_convolution::ConvolutionModel::offsets</a></div><div class="ttdeci">std::vector&lt; Offset &gt; offsets</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00157">convolution.h:157</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ab83e84168a713d1f7350d5f16d82a3a0"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">kaldi::nnet3::time_height_convolution::ConvolutionModel::height_out</a></div><div class="ttdeci">int32 height_out</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00129">convolution.h:129</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_a5aa18a99c28265c00e81554208124038"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">kaldi::nnet3::Index::t</a></div><div class="ttdeci">int32 t</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00046">nnet-common.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1SubMatrix_html"><div class="ttname"><a href="classkaldi_1_1SubMatrix.html">kaldi::SubMatrix</a></div><div class="ttdoc">Sub-matrix representation. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00942">kaldi-matrix.h:942</a></div></div>
<div class="ttc" id="classkaldi_1_1SubVector_html"><div class="ttname"><a href="classkaldi_1_1SubVector.html">kaldi::SubVector</a></div><div class="ttdoc">Represents a non-allocating general vector which can be defined as a sub-vector of higher-level vecto...</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00485">kaldi-vector.h:485</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac952f0840a7950dff80c1a89e69656d7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kaldi::nnet3::kNoTime</a></div><div class="ttdeci">const int kNoTime</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00573">nnet-common.cc:573</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abd0c0fe6e93d0e45d4cad6f25cc966a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd0c0fe6e93d0e45d4cad6f25cc966a3">&#9670;&nbsp;</a></span>CreateIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::CreateIndexes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>n_x_pairs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>t_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>t_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_t_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>reorder_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates a vector of indexes with a regular structure, according to these specifications. </p>
<p>'n_x_pairs' is the list of (n,x) pairs to include; they will appear in this order.</p>
<p>'t_start', 't_step' and 'num_t_values' define the set of 't' values to include (note: t_step &gt;= 0; they will appear in the natural order).</p>
<p>If reorder_t == 1 (the normal case), then the order is simple: 't' has the higher stride, then (n, x). So we'll output first all (n, x) pairs for t_start, then all pairs for t_start + t_step, and so on.</p>
<p>If instead reorder_t &gt; 1, then the order is a little different [note: we expect that num_t_values % reorder_t == 0). Consider, for example, reorder_t == 2. In that case the first block has the first two t values, the second block has the next two t values, and so on. And within each block, the 't' values have the smallest stride (of 1). </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01470">1470</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01543">GetIndexesForComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                                                                      {</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(reorder_t &gt;= 1 &amp;&amp; num_t_values % reorder_t == 0 &amp;&amp; t_step &gt;= 0);</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="keywordflow">if</span> (t_step == 0) {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_t_values == 1);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    t_step = 1;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  }</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  int32 num_n_x_pairs = n_x_pairs.size();</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  indexes-&gt;clear();</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  indexes-&gt;reserve(num_n_x_pairs * num_t_values);</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  int32 outer_t_step = t_step * reorder_t,</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      t_end = t_start + (num_t_values * t_step);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  Index index;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <span class="keywordflow">for</span> (int32 t_block = t_start; t_block &lt; t_end; t_block += outer_t_step) {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordflow">for</span> (int32 nx = 0; nx &lt; num_n_x_pairs; nx++) {</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      index.n = n_x_pairs[nx].first;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      index.x = n_x_pairs[nx].second;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="keywordflow">for</span> (int32 t = t_block; t &lt; t_block + outer_t_step; t += t_step) {</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        index.t = t;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        indexes-&gt;push_back(index);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      }</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    }</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  }</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="comment">// we can remove the next assert after a while.</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes-&gt;size() == num_n_x_pairs * num_t_values);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a134a07f0958a06bd608d33aec94b38d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a134a07f0958a06bd608d33aec94b38d4">&#9670;&nbsp;</a></span>FindGcdOfDifferences()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::time_height_convolution::FindGcdOfDifferences </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01420">1420</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00296">kaldi::Gcd()</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01431">RegularizeTList()</a>.</p>
<div class="fragment"><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                                                         {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordtype">size_t</span> size = vec.size();</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    int32 diff = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] - vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="comment">// diff should not be zero.</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    ans = <a class="code" href="namespacekaldi.html#a75dfcbc8c8e6254466874ee4b2e69d31">Gcd</a>(ans, diff);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  }</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a75dfcbc8c8e6254466874ee4b2e69d31"><div class="ttname"><a href="namespacekaldi.html#a75dfcbc8c8e6254466874ee4b2e69d31">kaldi::Gcd</a></div><div class="ttdeci">I Gcd(I m, I n)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00296">kaldi-math.h:296</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae62a1a6a9f5852ccbac183045ab6815e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae62a1a6a9f5852ccbac183045ab6815e">&#9670;&nbsp;</a></span>GetComputationIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetComputationIo </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *&#160;</td>
          <td class="paramname"><em>io</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes lists of input and output indexes to a computation (e.g. </p>
<p>as supplied to ReorderIndexes()), and figures out a regular structure for them (i.e. the smallest grid that will completely cover all the t,n pairs). This function ignores any 't' values that are kNoTime. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01519">1519</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils_8cc_source.html#l00603">kaldi::nnet3::GetNxList()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00621">kaldi::nnet3::GetTList()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="convolution_8h_source.html#l00381">ConvolutionComputationIo::num_images</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::num_t_out</a>, <a class="el" href="convolution_8cc_source.html#l01431">RegularizeTList()</a>, <a class="el" href="convolution_8h_source.html#l00411">ConvolutionComputationIo::reorder_t_in</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::start_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::start_t_out</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>, and <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::t_step_out</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00388">RestrictedAttentionComponent::GetComputationStructure()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00537">TdnnComponent::PrecomputeIndexes()</a>, and <a class="el" href="nnet-tdnn-component_8cc_source.html#l00348">TdnnComponent::ReorderIndexes()</a>.</p>
<div class="fragment"><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                                  {</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; n_x_pairs;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a88f25f27da8a794033590e7e322d7673">GetNxList</a>(input_indexes, &amp;n_x_pairs);</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!n_x_pairs.empty());</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  io-&gt;num_images = n_x_pairs.size();</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3) {  <span class="comment">// a debugging step.</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; n_x_pairs_2;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a88f25f27da8a794033590e7e322d7673">GetNxList</a>(output_indexes, &amp;n_x_pairs_2);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(n_x_pairs_2 == n_x_pairs);</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  }</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  std::vector&lt;int32&gt; t_values;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a391f07e5812ae93c5950791cb56cbbb3">GetTList</a>(input_indexes, &amp;t_values);</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af0a0b7715e12a97dd292c8b2830e3814">RegularizeTList</a>(t_values, &amp;(io-&gt;start_t_in),</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                  &amp;(io-&gt;t_step_in), &amp;(io-&gt;num_t_in));</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a391f07e5812ae93c5950791cb56cbbb3">GetTList</a>(output_indexes, &amp;t_values);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af0a0b7715e12a97dd292c8b2830e3814">RegularizeTList</a>(t_values, &amp;(io-&gt;start_t_out),</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                  &amp;(io-&gt;t_step_out), &amp;(io-&gt;num_t_out));</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  io-&gt;reorder_t_in = 1;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a391f07e5812ae93c5950791cb56cbbb3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a391f07e5812ae93c5950791cb56cbbb3">kaldi::nnet3::GetTList</a></div><div class="ttdeci">void GetTList(const std::vector&lt; Index &gt; &amp;indexes, std::vector&lt; int32 &gt; *t_values)</div><div class="ttdoc">This function outputs a sorted, unique list of the &amp;#39;t&amp;#39; values that are encountered in the provided li...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00621">nnet-compile-utils.cc:621</a></div></div>
<div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_af0a0b7715e12a97dd292c8b2830e3814"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af0a0b7715e12a97dd292c8b2830e3814">kaldi::nnet3::time_height_convolution::RegularizeTList</a></div><div class="ttdeci">static void RegularizeTList(std::vector&lt; int32 &gt; &amp;t_values, int32 *start, int32 *step, int32 *num_values)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01431">convolution.cc:1431</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a88f25f27da8a794033590e7e322d7673"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a88f25f27da8a794033590e7e322d7673">kaldi::nnet3::GetNxList</a></div><div class="ttdeci">void GetNxList(const std::vector&lt; Index &gt; &amp;indexes, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *pairs)</div><div class="ttdoc">This function outputs a unique, lexicographically sorted list of the pairs of (n, x) values that are ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00603">nnet-compile-utils.cc:603</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a69d36c7781410ae1890ad1fd30b4cb50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69d36c7781410ae1890ad1fd30b4cb50">&#9670;&nbsp;</a></span>GetIndexesForComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetIndexesForComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>orig_input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>orig_output_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>output_indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function computes the reordered and possibly padded indexes corresponding to the computation in 'io'. </p>
<p>Note: the computation may have undergone various manipulations (padding, etc.) after being obtained by the function <a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ae62a1a6a9f5852ccbac183045ab6815e" title="This function takes lists of input and output indexes to a computation (e.g. ">GetComputationIo()</a>. The original input and output indexes are needed because they dictate the set of (n, x) pairs; and because they determine when to use 'real' indexes and when to use 'blank' padding values (i.e. when to replace the t values in the indexes by kNoTime). </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01543">1543</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l01470">CreateIndexes()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00603">kaldi::nnet3::GetNxList()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="convolution_8h_source.html#l00381">ConvolutionComputationIo::num_images</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::num_t_out</a>, <a class="el" href="convolution_8h_source.html#l00411">ConvolutionComputationIo::reorder_t_in</a>, <a class="el" href="convolution_8cc_source.html#l01505">SetSomeIndexesBlank()</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::start_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::start_t_out</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>, and <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::t_step_out</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00537">TdnnComponent::PrecomputeIndexes()</a>, and <a class="el" href="nnet-tdnn-component_8cc_source.html#l00348">TdnnComponent::ReorderIndexes()</a>.</p>
<div class="fragment"><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                                      {</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  std::unordered_set&lt;Index, IndexHasher&gt; input_set, output_set;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;Index&gt;::const_iterator iter = orig_input_indexes.begin();</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;       iter != orig_input_indexes.end(); ++iter)</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    input_set.insert(*iter);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;Index&gt;::const_iterator iter = orig_output_indexes.begin();</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;       iter != orig_output_indexes.end(); ++iter)</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    output_set.insert(*iter);</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; n_x_pairs;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a88f25f27da8a794033590e7e322d7673">GetNxList</a>(orig_input_indexes, &amp;n_x_pairs);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(n_x_pairs.size() == io.num_images);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#abd0c0fe6e93d0e45d4cad6f25cc966a3">CreateIndexes</a>(n_x_pairs, io.start_t_in, io.t_step_in, io.num_t_in,</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                io.reorder_t_in, input_indexes);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a640f155cf7f6deba113985c6d947017a">SetSomeIndexesBlank</a>(orig_input_indexes, input_indexes);</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#abd0c0fe6e93d0e45d4cad6f25cc966a3">CreateIndexes</a>(n_x_pairs, io.start_t_out, io.t_step_out, io.num_t_out,</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                1, output_indexes);</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a640f155cf7f6deba113985c6d947017a">SetSomeIndexesBlank</a>(orig_output_indexes, output_indexes);</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_abd0c0fe6e93d0e45d4cad6f25cc966a3"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#abd0c0fe6e93d0e45d4cad6f25cc966a3">kaldi::nnet3::time_height_convolution::CreateIndexes</a></div><div class="ttdeci">static void CreateIndexes(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;n_x_pairs, int32 t_start, int32 t_step, int32 num_t_values, int32 reorder_t, std::vector&lt; Index &gt; *indexes)</div><div class="ttdoc">Creates a vector of indexes with a regular structure, according to these specifications. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01470">convolution.cc:1470</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a640f155cf7f6deba113985c6d947017a"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a640f155cf7f6deba113985c6d947017a">kaldi::nnet3::time_height_convolution::SetSomeIndexesBlank</a></div><div class="ttdeci">static void SetSomeIndexesBlank(const std::vector&lt; Index &gt; &amp;ref_indexes, std::vector&lt; Index &gt; *indexes)</div><div class="ttdoc">This function modifies &amp;#39;indexes&amp;#39; by, for any Indexes which was not present in &amp;#39;ref_indexes&amp;#39;, setting the &amp;#39;t&amp;#39; value to kNoTime. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01505">convolution.cc:1505</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a88f25f27da8a794033590e7e322d7673"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a88f25f27da8a794033590e7e322d7673">kaldi::nnet3::GetNxList</a></div><div class="ttdeci">void GetNxList(const std::vector&lt; Index &gt; &amp;indexes, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *pairs)</div><div class="ttdoc">This function outputs a unique, lexicographically sorted list of the pairs of (n, x) values that are ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00603">nnet-compile-utils.cc:603</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a84391d2d348e03e12429d5066ae29234"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84391d2d348e03e12429d5066ae29234">&#9670;&nbsp;</a></span>GetRandomConvolutionIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::GetRandomConvolutionIndexes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>output_indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00078">78</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8h_source.html#l00173">ConvolutionModel::all_time_offsets</a>, <a class="el" href="convolution_8cc_source.html#l00130">ConvolutionModel::Check()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="convolution_8h_source.html#l00169">ConvolutionModel::required_time_offsets</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                                                          {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#adc9de3c767c99e452604ceae022f20a4">Check</a>());</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; n_x_pairs;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  int32 num_n_x_pairs = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_n_x_pairs; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3), x = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    n_x_pairs.push_back(std::pair&lt;int32, int32&gt;(n, x));</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;n_x_pairs);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  num_n_x_pairs = n_x_pairs.size();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// &#39;output_t_values&#39; is the set of *possible* output</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// t values; we&#39;ll later sub-sample from these.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  std::vector&lt;int32&gt; output_t_values;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    int32 out_t_start = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-5, 5), out_t_step = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        num_t_out = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 4);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_t_out; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      output_t_values.push_back(out_t_start + <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> * out_t_step);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  input_indexes-&gt;clear();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  output_indexes-&gt;clear();</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_x_pairs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    std::vector&lt;int32&gt; chosen_output_t_values;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">while</span> (chosen_output_t_values.empty()) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; output_t_values.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) != 0)</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          chosen_output_t_values.push_back(output_t_values[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(chosen_output_t_values));</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    std::set&lt;int32&gt; required_input_t_values,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        usable_input_t_values;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; chosen_output_t_values.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      std::set&lt;int32&gt;::const_iterator iter;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      int32 t_out = chosen_output_t_values[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">for</span> (iter = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa8bc343695c77d80bab06500c84b4240">required_time_offsets</a>.begin();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;           iter != model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa8bc343695c77d80bab06500c84b4240">required_time_offsets</a>.end(); iter++) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        int32 offset = *iter;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        required_input_t_values.insert(t_out + offset);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="keywordflow">for</span> (iter = model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#afb30663cba0bd5956f528c27102b2445">all_time_offsets</a>.begin();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;           iter != model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#afb30663cba0bd5956f528c27102b2445">all_time_offsets</a>.end(); iter++) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        int32 offset = *iter;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        usable_input_t_values.insert(t_out + offset);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// add to output_indexes</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; chosen_output_t_values.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      int32 t_out = chosen_output_t_values[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> index;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aad8b608072a1b6dcd9e91de38ee2925f">n</a> = n_x_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">x</a> = n_x_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = t_out;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      output_indexes-&gt;push_back(index);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    std::vector&lt;int32&gt; chosen_input_t_values(required_input_t_values.begin(),</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                             required_input_t_values.end());</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">for</span> (std::set&lt;int32&gt;::const_iterator iter = usable_input_t_values.begin();</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;         iter != usable_input_t_values.end(); ++iter) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      int32 t = *iter;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        chosen_input_t_values.push_back(t);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;chosen_input_t_values);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// add to input_indexes</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; chosen_input_t_values.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      int32 t_in = chosen_input_t_values[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> index;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aad8b608072a1b6dcd9e91de38ee2925f">n</a> = n_x_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">x</a> = n_x_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = t_in;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      input_indexes-&gt;push_back(index);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_adc9de3c767c99e452604ceae022f20a4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#adc9de3c767c99e452604ceae022f20a4">kaldi::nnet3::time_height_convolution::ConvolutionModel::Check</a></div><div class="ttdeci">bool Check(bool check_heights_used=true, bool allow_height_padding=true) const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00130">convolution.cc:130</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html">kaldi::nnet3::Index</a></div><div class="ttdoc">struct Index is intended to represent the various indexes by which we number the rows of the matrices...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00044">nnet-common.h:44</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_afb30663cba0bd5956f528c27102b2445"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#afb30663cba0bd5956f528c27102b2445">kaldi::nnet3::time_height_convolution::ConvolutionModel::all_time_offsets</a></div><div class="ttdeci">std::set&lt; int32 &gt; all_time_offsets</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00173">convolution.h:173</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_aade28f62e276833462f1b79c4e41ec7e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">kaldi::nnet3::Index::x</a></div><div class="ttdeci">int32 x</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00047">nnet-common.h:47</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_aad8b608072a1b6dcd9e91de38ee2925f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#aad8b608072a1b6dcd9e91de38ee2925f">kaldi::nnet3::Index::n</a></div><div class="ttdeci">int32 n</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00045">nnet-common.h:45</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aa8bc343695c77d80bab06500c84b4240"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa8bc343695c77d80bab06500c84b4240">kaldi::nnet3::time_height_convolution::ConvolutionModel::required_time_offsets</a></div><div class="ttdeci">std::set&lt; int32 &gt; required_time_offsets</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00169">convolution.h:169</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_a5aa18a99c28265c00e81554208124038"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">kaldi::nnet3::Index::t</a></div><div class="ttdeci">int32 t</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00046">nnet-common.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7c809b8ac794279b0362a4717b676509"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c809b8ac794279b0362a4717b676509">&#9670;&nbsp;</a></span>GetRandomConvolutionModel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::GetRandomConvolutionModel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *&#160;</td>
          <td class="paramname"><em>model</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00028">28</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00130">ConvolutionModel::Check()</a>, <a class="el" href="convolution_8cc_source.html#l00109">ConvolutionModel::ComputeDerived()</a>, <a class="el" href="convolution_8h_source.html#l00128">ConvolutionModel::height_in</a>, <a class="el" href="convolution_8h_source.html#l00137">ConvolutionModel::Offset::height_offset</a>, <a class="el" href="convolution_8h_source.html#l00129">ConvolutionModel::height_out</a>, <a class="el" href="convolution_8h_source.html#l00132">ConvolutionModel::height_subsample_out</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="convolution_8cc_source.html#l00087">ConvolutionModel::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="convolution_8h_source.html#l00126">ConvolutionModel::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00127">ConvolutionModel::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00157">ConvolutionModel::offsets</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="convolution_8h_source.html#l00169">ConvolutionModel::required_time_offsets</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, and <a class="el" href="convolution_8h_source.html#l00136">ConvolutionModel::Offset::time_offset</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00165">UnitTestTimeHeightConvolutionIo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                                                               {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;start:</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a15d88b7dff4152f85b8e864454d7be56">num_filters_in</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab6517e72f4d0632f883d78c5b7ea8ef4">num_filters_out</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a6d3d2e1318a0bff4f829953108391f17">height_in</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    int32 min_height_offset = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-2, 0),</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        max_height_offset = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 2),</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        min_time_offset = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-2, 0),</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        max_time_offset = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 2);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">height_out</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a6d3d2e1318a0bff4f829953108391f17">height_in</a>);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ae8f1f2846a9eaabfec6b665ad055a850">height_subsample_out</a> = 1;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordflow">if</span> (model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">height_out</a> % 2 == 0) {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">height_out</a> /= 2;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ae8f1f2846a9eaabfec6b665ad055a850">height_subsample_out</a> = 2;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">height_out</a> % 3 == 0) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">height_out</a> /= 3;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ae8f1f2846a9eaabfec6b665ad055a850">height_subsample_out</a> = 3;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    std::vector&lt;int32&gt; all_time_offsets;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    int32 max_offsets = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">offsets</a>.clear();</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa8bc343695c77d80bab06500c84b4240">required_time_offsets</a>.clear();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_offsets; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset.html">ConvolutionModel::Offset</a> o;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      o.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset.html#a4adac825f9358b8874b67fc2e0468c06">time_offset</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(min_time_offset, max_time_offset);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      o.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset.html#a996d6f8e43a0f31cf66adf57dc8b266a">height_offset</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(min_height_offset, max_height_offset);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      all_time_offsets.push_back(o.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset.html#a4adac825f9358b8874b67fc2e0468c06">time_offset</a>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">offsets</a>.push_back(o);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;(model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">offsets</a>));</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;all_time_offsets);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    std::random_shuffle(all_time_offsets.begin(), all_time_offsets.end());</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    int32 num_required_offsets = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, all_time_offsets.size());</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_required_offsets; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa8bc343695c77d80bab06500c84b4240">required_time_offsets</a>.insert(all_time_offsets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a9d601955f7a16a2d9492240166a8e569">ComputeDerived</a>();</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">if</span> (!model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#adc9de3c767c99e452604ceae022f20a4">Check</a>()) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Regenerating model because it didn&#39;t pass the check: &quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;               &lt;&lt; model-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a245d65d566725422b859c99bff7623f8">Info</a>();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ae8f1f2846a9eaabfec6b665ad055a850"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ae8f1f2846a9eaabfec6b665ad055a850">kaldi::nnet3::time_height_convolution::ConvolutionModel::height_subsample_out</a></div><div class="ttdeci">int32 height_subsample_out</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00132">convolution.h:132</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a6d3d2e1318a0bff4f829953108391f17"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a6d3d2e1318a0bff4f829953108391f17">kaldi::nnet3::time_height_convolution::ConvolutionModel::height_in</a></div><div class="ttdeci">int32 height_in</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00128">convolution.h:128</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_adc9de3c767c99e452604ceae022f20a4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#adc9de3c767c99e452604ceae022f20a4">kaldi::nnet3::time_height_convolution::ConvolutionModel::Check</a></div><div class="ttdeci">bool Check(bool check_heights_used=true, bool allow_height_padding=true) const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00130">convolution.cc:130</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::time_height_convolution::ConvolutionModel::Info</a></div><div class="ttdeci">std::string Info() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00087">convolution.cc:87</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ab6517e72f4d0632f883d78c5b7ea8ef4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab6517e72f4d0632f883d78c5b7ea8ef4">kaldi::nnet3::time_height_convolution::ConvolutionModel::num_filters_out</a></div><div class="ttdeci">int32 num_filters_out</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00127">convolution.h:127</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a15d88b7dff4152f85b8e864454d7be56"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a15d88b7dff4152f85b8e864454d7be56">kaldi::nnet3::time_height_convolution::ConvolutionModel::num_filters_in</a></div><div class="ttdeci">int32 num_filters_in</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00126">convolution.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset_html_a996d6f8e43a0f31cf66adf57dc8b266a"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset.html#a996d6f8e43a0f31cf66adf57dc8b266a">kaldi::nnet3::time_height_convolution::ConvolutionModel::Offset::height_offset</a></div><div class="ttdeci">int32 height_offset</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00137">convolution.h:137</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a9d601955f7a16a2d9492240166a8e569"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a9d601955f7a16a2d9492240166a8e569">kaldi::nnet3::time_height_convolution::ConvolutionModel::ComputeDerived</a></div><div class="ttdeci">void ComputeDerived()</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00109">convolution.cc:109</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset.html">kaldi::nnet3::time_height_convolution::ConvolutionModel::Offset</a></div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00135">convolution.h:135</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a2b4b07f084195f0a2563065b7d7ebbf9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a2b4b07f084195f0a2563065b7d7ebbf9">kaldi::nnet3::time_height_convolution::ConvolutionModel::offsets</a></div><div class="ttdeci">std::vector&lt; Offset &gt; offsets</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00157">convolution.h:157</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ab83e84168a713d1f7350d5f16d82a3a0"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ab83e84168a713d1f7350d5f16d82a3a0">kaldi::nnet3::time_height_convolution::ConvolutionModel::height_out</a></div><div class="ttdeci">int32 height_out</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00129">convolution.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aa8bc343695c77d80bab06500c84b4240"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa8bc343695c77d80bab06500c84b4240">kaldi::nnet3::time_height_convolution::ConvolutionModel::required_time_offsets</a></div><div class="ttdeci">std::set&lt; int32 &gt; required_time_offsets</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00169">convolution.h:169</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset_html_a4adac825f9358b8874b67fc2e0468c06"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_1_1Offset.html#a4adac825f9358b8874b67fc2e0468c06">kaldi::nnet3::time_height_convolution::ConvolutionModel::Offset::time_offset</a></div><div class="ttdeci">int32 time_offset</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00136">convolution.h:136</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a078ae274f46ec580d9906969502be607"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a078ae274f46ec580d9906969502be607">&#9670;&nbsp;</a></span>MakeComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MakeComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01568">1568</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00956">ComputeTempMatrixSize()</a>, <a class="el" href="convolution_8h_source.html#l00128">ConvolutionModel::height_in</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_in</a>, <a class="el" href="convolution_8h_source.html#l00313">ConvolutionComputation::ConvolutionStep::height_map</a>, <a class="el" href="convolution_8h_source.html#l00129">ConvolutionModel::height_out</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="convolution_8h_source.html#l00132">ConvolutionModel::height_subsample_out</a>, <a class="el" href="convolution_8h_source.html#l00296">ConvolutionComputation::ConvolutionStep::input_time_shift</a>, <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="convolution_8h_source.html#l00126">ConvolutionModel::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_in</a>, <a class="el" href="convolution_8h_source.html#l00127">ConvolutionModel::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00254">ConvolutionComputation::num_filters_out</a>, <a class="el" href="convolution_8h_source.html#l00267">ConvolutionComputation::num_images</a>, <a class="el" href="convolution_8h_source.html#l00381">ConvolutionComputationIo::num_images</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00263">ConvolutionComputation::num_t_out</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::num_t_out</a>, <a class="el" href="convolution_8h_source.html#l00157">ConvolutionModel::offsets</a>, <a class="el" href="convolution_8h_source.html#l00301">ConvolutionComputation::ConvolutionStep::params_start_col</a>, <a class="el" href="convolution_8h_source.html#l00411">ConvolutionComputationIo::reorder_t_in</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::start_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::start_t_out</a>, <a class="el" href="convolution_8h_source.html#l00343">ConvolutionComputation::steps</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>, and <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::t_step_out</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                                                          {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io.t_step_in == io.t_step_out);</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  computation-&gt;num_filters_in = model.num_filters_in;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  computation-&gt;num_filters_out = model.num_filters_out;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  computation-&gt;height_in = model.height_in;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  computation-&gt;height_out = model.height_out;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  computation-&gt;num_t_in = io.num_t_in;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  computation-&gt;num_t_out = io.num_t_out;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  computation-&gt;num_images = io.num_images;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io.reorder_t_in == 1);</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="comment">// first work out the steps of the computation, then</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="comment">// work out the dim of the temp matrix</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(model.offsets));</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  <span class="comment">// Each distinct value of &#39;time_offset&#39; in model.offsets</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="comment">// becomes one step of the computation.</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="comment">// if io.t_step_in was zero, use 1 (so divisions and the like will work as</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <span class="comment">// expected).</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  int32 t_step = std::max&lt;int32&gt;(1, io.t_step_in),</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      num_t_extra = io.num_t_in - io.num_t_out;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  computation-&gt;steps.clear();</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  int32 num_offsets = model.offsets.size(),</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      cur_start_offset = 0, cur_end_offset = 0;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="keywordflow">for</span>(; cur_start_offset &lt; num_offsets; cur_start_offset = cur_end_offset) {</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    cur_end_offset = cur_start_offset;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keywordflow">while</span> (cur_end_offset &lt; num_offsets &amp;&amp;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;           model.offsets[cur_end_offset].time_offset ==</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;           model.offsets[cur_start_offset].time_offset)</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      cur_end_offset++;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <span class="comment">// we are processing the range of indexes into &#39;offsets&#39;</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="comment">// from cur_start_offset to cur_end_offset - 1.</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    int32 this_num_offsets = cur_end_offset - cur_start_offset;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    int32 time_offset = model.offsets[cur_start_offset].time_offset;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    ConvolutionComputation::ConvolutionStep step;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="comment">// modified_time_offset will be used in working out the &#39;input_time_shift&#39;</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="comment">// that determines which submatrix of the input matrix we&#39;ll use.</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    <span class="comment">// It equals the time-offset corrected for any time-difference between</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="comment">// the start of the output and of the input.</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    int32 modified_time_offset = time_offset + io.start_t_out - io.start_t_in;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(modified_time_offset &gt;= 0 &amp;&amp;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                 modified_time_offset % t_step == 0);</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    step.input_time_shift = modified_time_offset / t_step;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(step.input_time_shift &lt;= num_t_extra);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    step.params_start_col = model.num_filters_in * cur_start_offset;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    step.height_map.clear();</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    step.height_map.reserve(model.height_out * this_num_offsets);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="keywordflow">for</span> (int32 h_out = 0;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;         h_out &lt; model.height_out * model.height_subsample_out;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;         h_out += model.height_subsample_out) {</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <span class="keywordflow">for</span> (int32 o = cur_start_offset; o &lt; cur_end_offset; o++) {</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        int32 this_height_offset = model.offsets[o].height_offset,</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            h_in = h_out + this_height_offset;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <span class="comment">// by the time we call MakeComputation, the user should already have</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        <span class="comment">// called PadModelHeight, so there should be no need for zero padding on</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <span class="comment">// the height axis, hence the following check.  [we&#39;ll later modify the</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        <span class="comment">// resulting computation in UnPadModelHeight, and that&#39;s where</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="comment">// zero-padding gets taken account of.]</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(h_in &gt;= 0 &amp;&amp; h_in &lt; model.height_in);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        step.height_map.push_back(h_in);</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      }</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    }</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    computation-&gt;steps.push_back(step);</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  }</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a62189e199d074c5393e2b3838f23601e">ComputeTempMatrixSize</a>(opts, computation);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a62189e199d074c5393e2b3838f23601e"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a62189e199d074c5393e2b3838f23601e">kaldi::nnet3::time_height_convolution::ComputeTempMatrixSize</a></div><div class="ttdeci">static void ComputeTempMatrixSize(const ConvolutionComputationOptions &amp;opts, ConvolutionComputation *computation)</div><div class="ttdoc">This function sets &amp;#39;temp_rows&amp;#39; and &amp;#39;temp_cols&amp;#39; in &amp;#39;computation&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00956">convolution.cc:956</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adcb71a0f9a1a1170eea7c1f30637eb51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcb71a0f9a1a1170eea7c1f30637eb51">&#9670;&nbsp;</a></span>PadComputationInputTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PadComputationInputTime </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *&#160;</td>
          <td class="paramname"><em>io</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function extends the set of input indexes that the computation has, to account for any required zero-padding in the time dimension. </p>
<p>It reads model.all_time_offsets and model.time_offsets_modulus; and it may modify members start_t_in t_stride_in and num_t_in of *io.</p>
<p>This is stage 1 of compilation. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01051">1051</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8h_source.html#l00173">ConvolutionModel::all_time_offsets</a>, <a class="el" href="kaldi-math_8h_source.html#l00296">kaldi::Gcd()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::num_t_out</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::start_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::start_t_out</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::t_step_out</a>, and <a class="el" href="convolution_8h_source.html#l00180">ConvolutionModel::time_offsets_modulus</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                                                           {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keywordflow">if</span> (model.time_offsets_modulus == 0) {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="comment">// this can only happen if model-&gt;all_time_offsets.size() == 1,</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="comment">// and no padding could be required here. W return to avoid</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="comment">// special cases below in Gcd().</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  }</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  int32 min_time_offset = *model.all_time_offsets.begin(),</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      max_time_offset = *model.all_time_offsets.rbegin();</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="comment">// it makes everything much simpler if we just enforce that the stride of the</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="comment">// input divides model.time_offsets_modulus and also the output stride.</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="comment">// (enforcing this may make the input stride smaller).  This may in certain</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">// very odd cases cause us to require more inputs [actually &#39;blanks&#39;] than</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="comment">// we really need, but it avoids a lot of careful thought.</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  int32 old_t_step_in = io-&gt;t_step_in;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  io-&gt;t_step_in = <a class="code" href="namespacekaldi.html#a75dfcbc8c8e6254466874ee4b2e69d31">Gcd</a>(io-&gt;t_step_in, model.time_offsets_modulus);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordflow">if</span> (io-&gt;t_step_out != 0)</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    io-&gt;t_step_in = <a class="code" href="namespacekaldi.html#a75dfcbc8c8e6254466874ee4b2e69d31">Gcd</a>(io-&gt;t_step_in, io-&gt;t_step_out);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="comment">// to ensure that we cover all the original input points, now that</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="comment">// we changed the stride we may need to increase num_t_in.</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  io-&gt;num_t_in = 1 + (old_t_step_in * (io-&gt;num_t_in - 1)) / io-&gt;t_step_in;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="comment">// by &#39;desired&#39; we mean usable as an input, not necessarily</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="comment">// required in the sense of &#39;required_time_offsets&#39;.</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  int32 first_desired_input_t = io-&gt;start_t_out + min_time_offset;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">if</span> (first_desired_input_t &lt; io-&gt;start_t_in) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((io-&gt;start_t_in - first_desired_input_t) %</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                 io-&gt;t_step_in == 0);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    io-&gt;num_t_in += (io-&gt;start_t_in - first_desired_input_t) / io-&gt;t_step_in;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    io-&gt;start_t_in = first_desired_input_t;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  }</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  int32 last_desired_input_t =</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      io-&gt;start_t_out + (io-&gt;num_t_out - 1) * io-&gt;t_step_out + max_time_offset,</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      last_input_t = io-&gt;start_t_in + (io-&gt;num_t_in - 1) * io-&gt;t_step_in;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="comment">// if the following assert fails, it means we had provided more input than was</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="comment">// needed, which is not expected.  This could cause problems later, in</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="comment">// AppendInputFrames().</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(last_desired_input_t &gt;= last_input_t);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">if</span> (last_desired_input_t &gt; last_input_t) {</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((last_desired_input_t - last_input_t) %</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                 io-&gt;t_step_in == 0);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    io-&gt;num_t_in += (last_desired_input_t - last_input_t) / io-&gt;t_step_in;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  }</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a75dfcbc8c8e6254466874ee4b2e69d31"><div class="ttname"><a href="namespacekaldi.html#a75dfcbc8c8e6254466874ee4b2e69d31">kaldi::Gcd</a></div><div class="ttdeci">I Gcd(I m, I n)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00296">kaldi-math.h:296</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8eaf9d986968b634b59294d1beac7e39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8eaf9d986968b634b59294d1beac7e39">&#9670;&nbsp;</a></span>PadModelHeight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PadModelHeight </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *&#160;</td>
          <td class="paramname"><em>model_padded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes a model that might require zero padding in the height dimension and outputs a model accepting a possibly-larger input dimension which does not require zero padding. </p>
<p>*model_padded may differ from 'model' in its height_in and its 'offsets' variable (the height-offsets need to be shifted if we pad at the bottom). We then work out the computation in terms of the model that doesn't need padding (which is easier), and later convert it back to work in the space where there is no padding.</p>
<p>This is stage 2 of compilation. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00918">918</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00130">ConvolutionModel::Check()</a>, <a class="el" href="convolution_8h_source.html#l00128">ConvolutionModel::height_in</a>, <a class="el" href="convolution_8h_source.html#l00129">ConvolutionModel::height_out</a>, <a class="el" href="convolution_8h_source.html#l00132">ConvolutionModel::height_subsample_out</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="convolution_8h_source.html#l00157">ConvolutionModel::offsets</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                                    {</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  *model_padded = model;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!model.offsets.empty());</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  int32 min_height_offset = model.offsets[0].height_offset,</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      max_height_offset = model.offsets[0].height_offset,</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      num_offsets = model.offsets.size();</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_offsets; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    min_height_offset = std::min&lt;int32&gt;(min_height_offset,</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                        model.offsets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].height_offset);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    max_height_offset = std::max&lt;int32&gt;(max_height_offset,</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                        model.offsets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].height_offset);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  int32 max_output_height = model.height_subsample_out * (model.height_out - 1),</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      max_required_input = max_height_offset + max_output_height,</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      min_required_input = min_height_offset + 0;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  int32 bottom_padding = -min_required_input,</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      top_padding = max_required_input - (model.height_in - 1);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordflow">if</span> (bottom_padding &lt; 0)</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    bottom_padding = 0;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordflow">if</span> (top_padding &lt; 0)</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    top_padding = 0;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  model_padded-&gt;height_in += bottom_padding + top_padding;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_offsets; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    model_padded-&gt;offsets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].height_offset += bottom_padding;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">// The reason why we say &#39;allow_height_padding = false&#39; below is obvious--</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="comment">// we&#39;ve &#39;manually&#39; padded by changing the model, so this modified model</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="comment">// should not require height padding.  The reason we set &#39;check_heights_used&#39;</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// is a little more non-obvious.  The very lowest and hightest heights</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="comment">// should always be used, but there may, in unusual models, be other heights</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="comment">// that are not used.  We found this in random testing.</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(model_padded-&gt;Check(<span class="keyword">false</span>, <span class="keyword">false</span>));</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a578fd54bb77245b4e9c173eea9dbb26e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a578fd54bb77245b4e9c173eea9dbb26e">&#9670;&nbsp;</a></span>PrepareIoForAppending()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::time_height_convolution::PrepareIoForAppending </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> *&#160;</td>
          <td class="paramname"><em>io_appended</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01158">1158</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::num_t_out</a>, <a class="el" href="convolution_8h_source.html#l00411">ConvolutionComputationIo::reorder_t_in</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>, and <a class="el" href="convolution_8h_source.html#l00394">ConvolutionComputationIo::t_step_out</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01203">AppendInputFrames()</a>.</p>
<div class="fragment"><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                                                                          {</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="comment">// first make sure that the output has nonzero stride (it would only have zero</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">// stride if there was only one output time index, which is unusual).  if</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="comment">// there&#39;s only one output time index we can set the stride to whatever we</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="comment">// want without affecting the list of output indexes.</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  int32 ratio;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">if</span> (io-&gt;t_step_out == 0) {</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io-&gt;num_t_out == 1);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    io-&gt;t_step_out = io-&gt;t_step_in;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  }</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keywordflow">if</span> (io-&gt;t_step_out == io-&gt;t_step_in) {</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// there is nothing to do; the output and input strides are the same.</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    *io_appended = *io;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    ratio = 1;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">return</span> ratio;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  }</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="comment">// Now, we ensured in PadComputationInputTime that if the output stride is</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="comment">// nonzero, then the input stride must divide the output stride; and if the</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="comment">// output stride was zero then we would have set it to the input stride just</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="comment">// above; and if both were zero we would have returned above.  So we can just</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="comment">// assert that the input stride divides the output stride.</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io-&gt;t_step_out % io-&gt;t_step_in == 0);</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  ratio = io-&gt;t_step_out / io-&gt;t_step_in;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="comment">// ratio says how many input indexes we have for each output index,</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">// ignoring end effects.  It is the number of input indexes we will</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="comment">// append together and &#39;pretend&#39;</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="comment">// record this ratio in the &#39;input&#39; I/O object, which we are also</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="comment">// modifying to record the extra required padding.</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  io-&gt;reorder_t_in = ratio;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordflow">if</span> (io-&gt;num_t_in % ratio != 0) {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="comment">// Round up the number of input frames to the nearest multiple (via</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="comment">// zero-padding) so we get an whole number of appended input frames.</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    io-&gt;num_t_in += ratio - (io-&gt;num_t_in % ratio);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="comment">// OK, from this point we create the output io object.</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  *io_appended = *io;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  io_appended-&gt;reorder_t_in = 1;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  io_appended-&gt;t_step_in = io-&gt;t_step_out;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  io_appended-&gt;num_t_in /= ratio;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordflow">return</span> ratio;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af0a0b7715e12a97dd292c8b2830e3814"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0a0b7715e12a97dd292c8b2830e3814">&#9670;&nbsp;</a></span>RegularizeTList()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::RegularizeTList </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>t_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01431">1431</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l01420">FindGcdOfDifferences()</a>, <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01519">GetComputationIo()</a>.</p>
<div class="fragment"><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                                               {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!t_values.empty() &amp;&amp; <a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(t_values));</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  *start = t_values[0];</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  *step = <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a134a07f0958a06bd608d33aec94b38d4">FindGcdOfDifferences</a>(t_values);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <span class="keywordflow">if</span> (*step == 0) {</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(t_values.size() == 1);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    *num_values = 1;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    int32 last_value = t_values.back();</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    *num_values = 1 + (last_value - *start) / *step;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((last_value - *start) % *step == 0);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  }</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a134a07f0958a06bd608d33aec94b38d4"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a134a07f0958a06bd608d33aec94b38d4">kaldi::nnet3::time_height_convolution::FindGcdOfDifferences</a></div><div class="ttdeci">static int32 FindGcdOfDifferences(std::vector&lt; int32 &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01420">convolution.cc:1420</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2402a67cb01294ac92b7587d838dcd72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2402a67cb01294ac92b7587d838dcd72">&#9670;&nbsp;</a></span>ReverseColumnMapping()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::ReverseColumnMapping </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>columns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>backward_columns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function, used in <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html#a9d601955f7a16a2d9492240166a8e569">ConvolutionComputation::ComputeDerived()</a>, reverses a mapping that may not be unique. </p>
<p>'columns' is a column mapping where each member is either -1 (meaning, copy a zero), or a number between 0 and input_dim - 1.</p>
<p>Its output, 'backward_columns', is the reverse mapping, but it's a vector of vectors instead of just a vector because the mapping may have been many-to-one. Each element of 'backward_columns' will be of dimension input_dim. For each columns[i] = j such that j != -1, for some k we will have (*backward_columns)[k][j] = i. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00044">44</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01271">ConvolutionComputation::ComputeDerived()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                    {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  int32 columns_dim = columns.size();</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; temp(input_dim);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; columns_dim; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = columns[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(j &gt;= -1 &amp;&amp; j &lt; input_dim);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (j != -1)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      temp[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  }</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// &#39;max_overlap&#39; is the largest number of times that some j &gt;= 0 appears in</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">// &#39;columns&#39;.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  int32 max_overlap = 0;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">for</span> (int32 j = 0; j &lt; input_dim; j++)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    max_overlap = std::max(max_overlap,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                           static_cast&lt;int32&gt;(temp[j].size()));</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  backward_columns-&gt;resize(max_overlap);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">for</span> (int32 k = 0; k &lt; max_overlap; k++) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    (*backward_columns)[k].clear();</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    (*backward_columns)[k].resize(input_dim, -1);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">for</span> (int32 j = 0; j &lt; input_dim; j++) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">for</span> (int32 k = 0; k &lt; static_cast&lt;int32&gt;(temp[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].size()); k++) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = temp[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][k];</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      (*backward_columns)[k][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3b212f6dc4c682d9c3be9cea85e844c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b212f6dc4c682d9c3be9cea85e844c2">&#9670;&nbsp;</a></span>RoundDownToMultipleOf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::time_height_convolution::RoundDownToMultipleOf </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01103">1103</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00286">kaldi::DivideRoundingDown()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01203">AppendInputFrames()</a>.</p>
<div class="fragment"><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                                                     {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> * <a class="code" href="namespacekaldi.html#a1218567d64e05b4e092577270c0bdd98">DivideRoundingDown</a>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a1218567d64e05b4e092577270c0bdd98"><div class="ttname"><a href="namespacekaldi.html#a1218567d64e05b4e092577270c0bdd98">kaldi::DivideRoundingDown</a></div><div class="ttdeci">static int32 DivideRoundingDown(int32 a, int32 b)</div><div class="ttdoc">Returns a / b, rounding towards negative infinity in all cases. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00286">kaldi-math.h:286</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a640f155cf7f6deba113985c6d947017a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a640f155cf7f6deba113985c6d947017a">&#9670;&nbsp;</a></span>SetSomeIndexesBlank()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::SetSomeIndexesBlank </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>ref_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function modifies 'indexes' by, for any Indexes which was not present in 'ref_indexes', setting the 't' value to kNoTime. </p>
<p>This will cause the <a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a> framework to ignore such Indexes for certain purposes, it supresses certain error conditions that would otherwise happen from inserting unnecessary indexes into the input and output. </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01505">1505</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-common_8cc_source.html#l00573">kaldi::nnet3::kNoTime</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01543">GetIndexesForComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                                                           {</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  std::unordered_set&lt;Index, IndexHasher&gt; ref_set;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;Index&gt;::const_iterator iter = ref_indexes.begin();</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;       iter != ref_indexes.end(); ++iter)</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    ref_set.insert(*iter);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;Index&gt;::iterator iter = indexes-&gt;begin();</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;       iter != indexes-&gt;end(); ++iter) {</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">if</span> (ref_set.count(*iter) == 0)</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      iter-&gt;t = <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  }</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ac952f0840a7950dff80c1a89e69656d7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kaldi::nnet3::kNoTime</a></div><div class="ttdeci">const int kNoTime</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00573">nnet-common.cc:573</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac06942821d2dcf18b5253290f60eec79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac06942821d2dcf18b5253290f60eec79">&#9670;&nbsp;</a></span>ShiftAllTimeOffsets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::time_height_convolution::ShiftAllTimeOffsets </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> *&#160;</td>
          <td class="paramname"><em>model</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01110">1110</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8h_source.html#l00173">ConvolutionModel::all_time_offsets</a>, <a class="el" href="convolution_8h_source.html#l00157">ConvolutionModel::offsets</a>, and <a class="el" href="convolution_8h_source.html#l00169">ConvolutionModel::required_time_offsets</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01203">AppendInputFrames()</a>.</p>
<div class="fragment"><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                                                         {</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  { <span class="comment">// shift &#39;offsets&#39;.</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    std::vector&lt;ConvolutionModel::Offset&gt;::iterator</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        iter = model-&gt;offsets.begin(),</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        end = model-&gt;offsets.end();</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      iter-&gt;time_offset += shift;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  std::set&lt;int32&gt; temp;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  std::set&lt;int32&gt;::const_iterator iter;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordflow">for</span> (iter = model-&gt;required_time_offsets.begin();</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;       iter != model-&gt;required_time_offsets.end(); ++iter)</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    temp.insert(*iter + shift);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  model-&gt;required_time_offsets.swap(temp);</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  temp.clear();</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordflow">for</span> (iter = model-&gt;all_time_offsets.begin();</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;       iter != model-&gt;all_time_offsets.end(); ++iter)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    temp.insert(*iter + shift);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  model-&gt;all_time_offsets.swap(temp);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a5a365c3f4e2917faa32eebde2962736b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a365c3f4e2917faa32eebde2962736b">&#9670;&nbsp;</a></span>TestComputationIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::TestComputationIo </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00182">182</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="convolution_8cc_source.html#l00315">ConvolutionComputation::Read()</a>, and <a class="el" href="convolution_8cc_source.html#l00283">ConvolutionComputation::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                                                  {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  std::ostringstream os1, os2;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  computation.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html#a68f354fd5f096134162f01719096e6fc">Write</a>(os1, binary);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  std::istringstream is(os1.str());</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> computation2;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  computation2.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html#a8e7d2790fc7e94fe9780ccc937de1270">Read</a>(is, binary);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  computation2.Write(os2, binary);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os1.str() == os2.str());</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  computation2.Check();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation_html_a8e7d2790fc7e94fe9780ccc937de1270"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html#a8e7d2790fc7e94fe9780ccc937de1270">kaldi::nnet3::time_height_convolution::ConvolutionComputation::Read</a></div><div class="ttdeci">void Read(std::istream &amp;is, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00315">convolution.cc:315</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">kaldi::nnet3::time_height_convolution::ConvolutionComputation</a></div><div class="ttdoc">This struct represents the structure of a convolution computation. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00252">convolution.h:252</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation_html_a68f354fd5f096134162f01719096e6fc"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html#a68f354fd5f096134162f01719096e6fc">kaldi::nnet3::time_height_convolution::ConvolutionComputation::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;os, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00283">convolution.cc:283</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a12f0d904ea77665399e945f2fb38d550"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12f0d904ea77665399e945f2fb38d550">&#9670;&nbsp;</a></span>TestDataBackprop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::TestDataBackprop </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>conv_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00308">308</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="convolution_8cc_source.html#l00682">ConvolveBackwardData()</a>, <a class="el" href="convolution_8cc_source.html#l00524">ConvolveForward()</a>, <a class="el" href="convolution_8h_source.html#l00203">ConvolutionModel::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="matrix-common_8h_source.html#l00038">kaldi::kSetZero</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="convolution_8h_source.html#l00204">ConvolutionModel::OutputDim()</a>, <a class="el" href="convolution_8h_source.html#l00208">ConvolutionModel::ParamCols()</a>, <a class="el" href="convolution_8h_source.html#l00206">ConvolutionModel::ParamRows()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00198">ZeroBlankRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                                                 {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      input_deriv(input_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa5083adaff49881915d61ebf045e96db">InputDim</a>(),</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                  <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      input(input_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa5083adaff49881915d61ebf045e96db">InputDim</a>(),</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      output(output_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">OutputDim</a>(),</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;             <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      output_deriv(output_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">OutputDim</a>(),</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                   <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      params(conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ac3fa74c7d37d13f40316563099322153">ParamRows</a>(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aaf781d073deb0b09dd89cefc0804979f">ParamCols</a>());</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  input.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  params.SetRandn();</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  output_deriv.SetRandn();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(output_indexes, &amp;output_deriv);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c24c02ba2b5c29ad1854da071902744">ConvolveBackwardData</a>(computation, params, output_deriv, &amp;input_deriv);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(input_indexes, &amp;input_deriv);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(input_indexes, &amp;input);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="comment">// define the objf as TraceMatMat(output_deriv, output, kTrans).</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// we can work it out from the backpropagated data-derivative.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> expected_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(input_deriv, input, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">ConvolveForward</a>(computation, input, params, &amp;output);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(output_indexes, &amp;output);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> observed_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output, output_deriv, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Expected objf = &quot;</span> &lt;&lt; expected_objf</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, observed objf = &quot;</span> &lt;&lt; observed_objf;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(expected_objf, observed_objf, 0.1) &amp;&amp;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      fabs(expected_objf) &lt; 1.0) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Difference in objf too large.&quot;</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aaf781d073deb0b09dd89cefc0804979f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aaf781d073deb0b09dd89cefc0804979f">kaldi::nnet3::time_height_convolution::ConvolutionModel::ParamCols</a></div><div class="ttdeci">int32 ParamCols() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00208">convolution.h:208</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aa5083adaff49881915d61ebf045e96db"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa5083adaff49881915d61ebf045e96db">kaldi::nnet3::time_height_convolution::ConvolutionModel::InputDim</a></div><div class="ttdeci">int32 InputDim() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00203">convolution.h:203</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ac3fa74c7d37d13f40316563099322153"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ac3fa74c7d37d13f40316563099322153">kaldi::nnet3::time_height_convolution::ConvolutionModel::ParamRows</a></div><div class="ttdeci">int32 ParamRows() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00206">convolution.h:206</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_af97474cce492a0b8305e8ec2c798509b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">kaldi::nnet3::time_height_convolution::ConvolutionModel::OutputDim</a></div><div class="ttdeci">int32 OutputDim() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00204">convolution.h:204</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a7c24c02ba2b5c29ad1854da071902744"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c24c02ba2b5c29ad1854da071902744">kaldi::nnet3::time_height_convolution::ConvolveBackwardData</a></div><div class="ttdeci">void ConvolveBackwardData(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, const CuMatrixBase&lt; BaseFloat &gt; &amp;output_deriv, CuMatrixBase&lt; BaseFloat &gt; *input_deriv)</div><div class="ttdoc">This does the part of the backward derivative computation of convolution, that propagates derivatives...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00682">convolution.cc:682</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a2d385f0ba4d4950c67e633631359ea88"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">kaldi::nnet3::time_height_convolution::ZeroBlankRows</a></div><div class="ttdeci">void ZeroBlankRows(const std::vector&lt; Index &gt; &amp;indexes, CuMatrix&lt; BaseFloat &gt; *matrix)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00198">convolution-test.cc:198</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kaldi::kSetZero</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00038">matrix-common.h:38</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_ad1cde1ebf0949cbc13fb9678bde0a70c"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">kaldi::nnet3::time_height_convolution::ConvolveForward</a></div><div class="ttdeci">void ConvolveForward(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdoc">This does the forward computation of convolution. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00524">convolution.cc:524</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af6ba0f24470a4f71e30599a3a39960b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6ba0f24470a4f71e30599a3a39960b1">&#9670;&nbsp;</a></span>TestParamsBackprop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::TestParamsBackprop </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>conv_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00350">350</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="convolution_8cc_source.html#l00840">ConvolveBackwardParams()</a>, <a class="el" href="convolution_8cc_source.html#l00524">ConvolveForward()</a>, <a class="el" href="convolution_8h_source.html#l00203">ConvolutionModel::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="matrix-common_8h_source.html#l00038">kaldi::kSetZero</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="convolution_8h_source.html#l00204">ConvolutionModel::OutputDim()</a>, <a class="el" href="convolution_8h_source.html#l00208">ConvolutionModel::ParamCols()</a>, <a class="el" href="convolution_8h_source.html#l00206">ConvolutionModel::ParamRows()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00198">ZeroBlankRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                                                   {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      input(input_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa5083adaff49881915d61ebf045e96db">InputDim</a>(),</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      output(output_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">OutputDim</a>(),</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;             <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      output_deriv(output_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">OutputDim</a>(),</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                   <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      params(conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ac3fa74c7d37d13f40316563099322153">ParamRows</a>(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aaf781d073deb0b09dd89cefc0804979f">ParamCols</a>()),</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      params_deriv(conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ac3fa74c7d37d13f40316563099322153">ParamRows</a>(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aaf781d073deb0b09dd89cefc0804979f">ParamCols</a>());</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  input.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  params.SetRandn();</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  output_deriv.SetRandn();</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha = 0.5 * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(output_indexes, &amp;output_deriv);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(input_indexes, &amp;input);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a55135cbe454ca7d1333962ed8bdb1476">ConvolveBackwardParams</a>(computation, input, output_deriv, alpha,</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                         &amp;params_deriv);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> expected_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(params_deriv, params, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>) / alpha;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">ConvolveForward</a>(computation, input, params, &amp;output);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(output_indexes, &amp;output);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> observed_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output, output_deriv, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Expected objf = &quot;</span> &lt;&lt; expected_objf</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, observed objf = &quot;</span> &lt;&lt; observed_objf;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(expected_objf, observed_objf, 0.1) &amp;&amp;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      fabs(expected_objf) &lt; 1.0) {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Difference in objf too large.&quot;</span>;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a55135cbe454ca7d1333962ed8bdb1476"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a55135cbe454ca7d1333962ed8bdb1476">kaldi::nnet3::time_height_convolution::ConvolveBackwardParams</a></div><div class="ttdeci">void ConvolveBackwardParams(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;output_deriv, BaseFloat alpha, CuMatrixBase&lt; BaseFloat &gt; *params_deriv)</div><div class="ttdoc">This does the part of the backward derivative computation of convolution, that computes derivatives w...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00840">convolution.cc:840</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aaf781d073deb0b09dd89cefc0804979f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aaf781d073deb0b09dd89cefc0804979f">kaldi::nnet3::time_height_convolution::ConvolutionModel::ParamCols</a></div><div class="ttdeci">int32 ParamCols() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00208">convolution.h:208</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aa5083adaff49881915d61ebf045e96db"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa5083adaff49881915d61ebf045e96db">kaldi::nnet3::time_height_convolution::ConvolutionModel::InputDim</a></div><div class="ttdeci">int32 InputDim() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00203">convolution.h:203</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ac3fa74c7d37d13f40316563099322153"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ac3fa74c7d37d13f40316563099322153">kaldi::nnet3::time_height_convolution::ConvolutionModel::ParamRows</a></div><div class="ttdeci">int32 ParamRows() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00206">convolution.h:206</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_af97474cce492a0b8305e8ec2c798509b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">kaldi::nnet3::time_height_convolution::ConvolutionModel::OutputDim</a></div><div class="ttdeci">int32 OutputDim() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00204">convolution.h:204</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a2d385f0ba4d4950c67e633631359ea88"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">kaldi::nnet3::time_height_convolution::ZeroBlankRows</a></div><div class="ttdeci">void ZeroBlankRows(const std::vector&lt; Index &gt; &amp;indexes, CuMatrix&lt; BaseFloat &gt; *matrix)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00198">convolution-test.cc:198</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kaldi::kSetZero</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00038">matrix-common.h:38</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_ad1cde1ebf0949cbc13fb9678bde0a70c"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">kaldi::nnet3::time_height_convolution::ConvolveForward</a></div><div class="ttdeci">void ConvolveForward(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdoc">This does the forward computation of convolution. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00524">convolution.cc:524</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af415681e595230c3b3ab8fe8e07c8856"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af415681e595230c3b3ab8fe8e07c8856">&#9670;&nbsp;</a></span>TestRunningComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::TestRunningComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>conv_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00280">280</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00524">ConvolveForward()</a>, <a class="el" href="convolution-test_8cc_source.html#l00218">ConvolveForwardSimple()</a>, <a class="el" href="convolution_8cc_source.html#l00087">ConvolutionModel::Info()</a>, <a class="el" href="convolution_8h_source.html#l00203">ConvolutionModel::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="matrix-common_8h_source.html#l00038">kaldi::kSetZero</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="convolution_8h_source.html#l00204">ConvolutionModel::OutputDim()</a>, <a class="el" href="convolution_8h_source.html#l00208">ConvolutionModel::ParamCols()</a>, <a class="el" href="convolution_8h_source.html#l00206">ConvolutionModel::ParamRows()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00198">ZeroBlankRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                                                       {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input(input_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa5083adaff49881915d61ebf045e96db">InputDim</a>(),</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                            <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      output(output_indexes.size(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">OutputDim</a>(),</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;             <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a>),</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      output2(output),</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      params(conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ac3fa74c7d37d13f40316563099322153">ParamRows</a>(), conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aaf781d073deb0b09dd89cefc0804979f">ParamCols</a>());</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  input.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  params.SetRandn();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(input_indexes, &amp;input);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">ConvolveForward</a>(computation, input, params, &amp;output);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">ZeroBlankRows</a>(output_indexes, &amp;output);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a81fe4d0c3eaa483dca9e0f75059c2226">ConvolveForwardSimple</a>(conv_model, input_indexes, output_indexes,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        input, params, &amp;output2);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Tested convolution for model: &quot;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            &lt;&lt; conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a245d65d566725422b859c99bff7623f8">Info</a>();</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">if</span> (!output.ApproxEqual(output2, 0.001)) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output is: &quot;</span> &lt;&lt; output;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output2 is: &quot;</span> &lt;&lt; output2;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Convolution test failure.&quot;</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aaf781d073deb0b09dd89cefc0804979f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aaf781d073deb0b09dd89cefc0804979f">kaldi::nnet3::time_height_convolution::ConvolutionModel::ParamCols</a></div><div class="ttdeci">int32 ParamCols() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00208">convolution.h:208</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_aa5083adaff49881915d61ebf045e96db"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#aa5083adaff49881915d61ebf045e96db">kaldi::nnet3::time_height_convolution::ConvolutionModel::InputDim</a></div><div class="ttdeci">int32 InputDim() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00203">convolution.h:203</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::time_height_convolution::ConvolutionModel::Info</a></div><div class="ttdeci">std::string Info() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00087">convolution.cc:87</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_ac3fa74c7d37d13f40316563099322153"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#ac3fa74c7d37d13f40316563099322153">kaldi::nnet3::time_height_convolution::ConvolutionModel::ParamRows</a></div><div class="ttdeci">int32 ParamRows() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00206">convolution.h:206</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_af97474cce492a0b8305e8ec2c798509b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#af97474cce492a0b8305e8ec2c798509b">kaldi::nnet3::time_height_convolution::ConvolutionModel::OutputDim</a></div><div class="ttdeci">int32 OutputDim() const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00204">convolution.h:204</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a2d385f0ba4d4950c67e633631359ea88"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a2d385f0ba4d4950c67e633631359ea88">kaldi::nnet3::time_height_convolution::ZeroBlankRows</a></div><div class="ttdeci">void ZeroBlankRows(const std::vector&lt; Index &gt; &amp;indexes, CuMatrix&lt; BaseFloat &gt; *matrix)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00198">convolution-test.cc:198</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a81fe4d0c3eaa483dca9e0f75059c2226"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a81fe4d0c3eaa483dca9e0f75059c2226">kaldi::nnet3::time_height_convolution::ConvolveForwardSimple</a></div><div class="ttdeci">void ConvolveForwardSimple(const ConvolutionModel &amp;model, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, const CuMatrixBase&lt; BaseFloat &gt; &amp;input_cu, const CuMatrixBase&lt; BaseFloat &gt; &amp;params_cu, CuMatrixBase&lt; BaseFloat &gt; *output_cu)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00218">convolution-test.cc:218</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kaldi::kSetZero</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00038">matrix-common.h:38</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_ad1cde1ebf0949cbc13fb9678bde0a70c"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#ad1cde1ebf0949cbc13fb9678bde0a70c">kaldi::nnet3::time_height_convolution::ConvolveForward</a></div><div class="ttdeci">void ConvolveForward(const ConvolutionComputation &amp;cc, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, const CuMatrixBase&lt; BaseFloat &gt; &amp;params, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdoc">This does the forward computation of convolution. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00524">convolution.cc:524</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9ac460dc43c9fe1341da246f1dfa1a1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ac460dc43c9fe1341da246f1dfa1a1d">&#9670;&nbsp;</a></span>TimeValueInInput()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::time_height_convolution::TimeValueInInput </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationIo.html">ConvolutionComputationIo</a> &amp;&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01321">1321</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::num_t_in</a>, <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::start_t_in</a>, and <a class="el" href="convolution_8h_source.html#l00393">ConvolutionComputationIo::t_step_in</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01329">CheckModelAndIo()</a>.</p>
<div class="fragment"><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                                      {</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  int32 t_step_in = std::max&lt;int32&gt;(1, io.t_step_in);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="keywordflow">return</span> (t &gt;= io.start_t_in &amp;&amp;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;          t &lt; io.start_t_in + (t_step_in * io.num_t_in) &amp;&amp;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          (t - io.start_t_in) % t_step_in == 0);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a22985b60e47cb4dda7283da145cd5175"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22985b60e47cb4dda7283da145cd5175">&#9670;&nbsp;</a></span>UnitTestTimeHeightConvolution()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::UnitTestTimeHeightConvolution </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00437">437</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution-test_8cc_source.html#l00394">UnitTestTimeHeightConvolutionCompile()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00165">UnitTestTimeHeightConvolutionIo()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00449">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                     {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7886201ac80e02bca20d2879f5c00b3e">UnitTestTimeHeightConvolutionIo</a>();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a8d9af4dc497e084315685f891b8b2675">UnitTestTimeHeightConvolutionCompile</a>();</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a8d9af4dc497e084315685f891b8b2675"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a8d9af4dc497e084315685f891b8b2675">kaldi::nnet3::time_height_convolution::UnitTestTimeHeightConvolutionCompile</a></div><div class="ttdeci">void UnitTestTimeHeightConvolutionCompile()</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00394">convolution-test.cc:394</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a7886201ac80e02bca20d2879f5c00b3e"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7886201ac80e02bca20d2879f5c00b3e">kaldi::nnet3::time_height_convolution::UnitTestTimeHeightConvolutionIo</a></div><div class="ttdeci">void UnitTestTimeHeightConvolutionIo()</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00165">convolution-test.cc:165</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8d9af4dc497e084315685f891b8b2675"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d9af4dc497e084315685f891b8b2675">&#9670;&nbsp;</a></span>UnitTestTimeHeightConvolutionCompile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::UnitTestTimeHeightConvolutionCompile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00394">394</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>, <a class="el" href="convolution-test_8cc_source.html#l00078">GetRandomConvolutionIndexes()</a>, <a class="el" href="convolution-test_8cc_source.html#l00028">GetRandomConvolutionModel()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="convolution-test_8cc_source.html#l00182">TestComputationIo()</a>, <a class="el" href="convolution-test_8cc_source.html#l00308">TestDataBackprop()</a>, <a class="el" href="convolution-test_8cc_source.html#l00350">TestParamsBackprop()</a>, <a class="el" href="convolution-test_8cc_source.html#l00280">TestRunningComputation()</a>, and <a class="el" href="nnet-common_8cc_source.html#l00126">kaldi::nnet3::WriteIndexVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00437">UnitTestTimeHeightConvolution()</a>.</p>
<div class="fragment"><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                            {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 10; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;iter = &quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">// Create a ConvolutionModel</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> conv_model;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c809b8ac794279b0362a4717b676509">GetRandomConvolutionModel</a>(&amp;conv_model);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    std::vector&lt;Index&gt; input_indexes, output_indexes;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a84391d2d348e03e12429d5066ae29234">GetRandomConvolutionIndexes</a>(conv_model, &amp;input_indexes, &amp;output_indexes);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> opts;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> computation;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    std::vector&lt;Index&gt; input_indexes_modified, output_indexes_modified;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3a8674224a035c83c521b9a5eccaaeb5">CompileConvolutionComputation</a>(conv_model, input_indexes, output_indexes,</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                  opts, &amp;computation,</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                  &amp;input_indexes_modified,</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                  &amp;output_indexes_modified);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a5a365c3f4e2917faa32eebde2962736b">TestComputationIo</a>(computation);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af415681e595230c3b3ab8fe8e07c8856">TestRunningComputation</a>(conv_model,</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                           input_indexes_modified,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                           output_indexes_modified,</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                           computation);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a12f0d904ea77665399e945f2fb38d550">TestDataBackprop</a>(conv_model,</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                     input_indexes_modified,</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                     output_indexes_modified,</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                     computation);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af6ba0f24470a4f71e30599a3a39960b1">TestParamsBackprop</a>(conv_model,</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                       input_indexes_modified,</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                       output_indexes_modified,</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                       computation);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\nInput-indexes: &quot;</span>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a>(os, <span class="keyword">false</span>, input_indexes);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\nInput-indexes-modified: &quot;</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a>(os, <span class="keyword">false</span>, input_indexes_modified);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\nOutput-indexes: &quot;</span>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a>(os, <span class="keyword">false</span>, output_indexes);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\nOutput-indexes-modified: &quot;</span>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a>(os, <span class="keyword">false</span>, output_indexes_modified);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; os.str();</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a6d9bd2f8bc49b5d2d7dec9b2d354ffc9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">kaldi::nnet3::WriteIndexVector</a></div><div class="ttdeci">void WriteIndexVector(std::ostream &amp;os, bool binary, const std::vector&lt; Index &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00126">nnet-common.cc:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">kaldi::nnet3::time_height_convolution::ConvolutionModel</a></div><div class="ttdoc">This comment explains the basic framework used for everything related to time-height convolution...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00125">convolution.h:125</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a84391d2d348e03e12429d5066ae29234"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a84391d2d348e03e12429d5066ae29234">kaldi::nnet3::time_height_convolution::GetRandomConvolutionIndexes</a></div><div class="ttdeci">static void GetRandomConvolutionIndexes(const ConvolutionModel &amp;model, std::vector&lt; Index &gt; *input_indexes, std::vector&lt; Index &gt; *output_indexes)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00078">convolution-test.cc:78</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_af415681e595230c3b3ab8fe8e07c8856"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af415681e595230c3b3ab8fe8e07c8856">kaldi::nnet3::time_height_convolution::TestRunningComputation</a></div><div class="ttdeci">void TestRunningComputation(const ConvolutionModel &amp;conv_model, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, const ConvolutionComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00280">convolution-test.cc:280</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a5a365c3f4e2917faa32eebde2962736b"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a5a365c3f4e2917faa32eebde2962736b">kaldi::nnet3::time_height_convolution::TestComputationIo</a></div><div class="ttdeci">void TestComputationIo(const ConvolutionComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00182">convolution-test.cc:182</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a3a8674224a035c83c521b9a5eccaaeb5"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a3a8674224a035c83c521b9a5eccaaeb5">kaldi::nnet3::time_height_convolution::CompileConvolutionComputation</a></div><div class="ttdeci">void CompileConvolutionComputation(const ConvolutionModel &amp;model, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, const ConvolutionComputationOptions &amp;opts, ConvolutionComputation *computation, std::vector&lt; Index &gt; *input_indexes_modified, std::vector&lt; Index &gt; *output_indexes_modified)</div><div class="ttdoc">This function does the compilation for a convolution computation; it&amp;#39;s a wrapper for the functions be...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l01367">convolution.cc:1367</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">kaldi::nnet3::time_height_convolution::ConvolutionComputation</a></div><div class="ttdoc">This struct represents the structure of a convolution computation. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00252">convolution.h:252</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_af6ba0f24470a4f71e30599a3a39960b1"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#af6ba0f24470a4f71e30599a3a39960b1">kaldi::nnet3::time_height_convolution::TestParamsBackprop</a></div><div class="ttdeci">void TestParamsBackprop(const ConvolutionModel &amp;conv_model, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, const ConvolutionComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00350">convolution-test.cc:350</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">kaldi::nnet3::time_height_convolution::ConvolutionComputationOptions</a></div><div class="ttdoc">This struct contains options for compiling the convolutional computation. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00362">convolution.h:362</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a7c809b8ac794279b0362a4717b676509"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c809b8ac794279b0362a4717b676509">kaldi::nnet3::time_height_convolution::GetRandomConvolutionModel</a></div><div class="ttdeci">static void GetRandomConvolutionModel(ConvolutionModel *model)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00028">convolution-test.cc:28</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a12f0d904ea77665399e945f2fb38d550"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a12f0d904ea77665399e945f2fb38d550">kaldi::nnet3::time_height_convolution::TestDataBackprop</a></div><div class="ttdeci">void TestDataBackprop(const ConvolutionModel &amp;conv_model, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, const ConvolutionComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00308">convolution-test.cc:308</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7886201ac80e02bca20d2879f5c00b3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7886201ac80e02bca20d2879f5c00b3e">&#9670;&nbsp;</a></span>UnitTestTimeHeightConvolutionIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::UnitTestTimeHeightConvolutionIo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00165">165</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution-test_8cc_source.html#l00028">GetRandomConvolutionModel()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="convolution_8cc_source.html#l00252">ConvolutionModel::Read()</a>, and <a class="el" href="convolution_8cc_source.html#l00225">ConvolutionModel::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00437">UnitTestTimeHeightConvolution()</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                       {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 10; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;iter = &quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// Create a ConvolutionModel and test its I/O.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> conv_model;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c809b8ac794279b0362a4717b676509">GetRandomConvolutionModel</a>(&amp;conv_model);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    std::ostringstream os1, os2;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    conv_model.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a68f354fd5f096134162f01719096e6fc">Write</a>(os1, binary);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    std::istringstream is(os1.str());</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> conv_model2;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    conv_model2.<a class="code" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a8e7d2790fc7e94fe9780ccc937de1270">Read</a>(is, binary);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    conv_model2.Write(os2, binary);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os1.str() == os2.str() &amp;&amp; conv_model2.Check());</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a68f354fd5f096134162f01719096e6fc"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a68f354fd5f096134162f01719096e6fc">kaldi::nnet3::time_height_convolution::ConvolutionModel::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;os, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00225">convolution.cc:225</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">kaldi::nnet3::time_height_convolution::ConvolutionModel</a></div><div class="ttdoc">This comment explains the basic framework used for everything related to time-height convolution...</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8h_source.html#l00125">convolution.h:125</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel_html_a8e7d2790fc7e94fe9780ccc937de1270"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html#a8e7d2790fc7e94fe9780ccc937de1270">kaldi::nnet3::time_height_convolution::ConvolutionModel::Read</a></div><div class="ttdeci">void Read(std::istream &amp;is, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00252">convolution.cc:252</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a7c809b8ac794279b0362a4717b676509"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a7c809b8ac794279b0362a4717b676509">kaldi::nnet3::time_height_convolution::GetRandomConvolutionModel</a></div><div class="ttdeci">static void GetRandomConvolutionModel(ConvolutionModel *model)</div><div class="ttdef"><b>Definition:</b> <a href="convolution-test_8cc_source.html#l00028">convolution-test.cc:28</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae29d8557b8598f2eb6f449f8fa6f2eff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae29d8557b8598f2eb6f449f8fa6f2eff">&#9670;&nbsp;</a></span>UnPadModelHeight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UnPadModelHeight </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputationOptions.html">ConvolutionComputationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionModel.html">ConvolutionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>model_padded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1time__height__convolution_1_1ConvolutionComputation.html">ConvolutionComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function modifies, if necessary, a computation that has been built for the model 'model_padded', so that it can work for the original model 'model'. </p>
<p>This may involve modifying the members 'height_in', 'temp_cols', and the column-related members of the elements of the 'steps' array. View it as the reverse step for 'PadModelHeight'.</p>
<p>This function has to be aware that the computation will have been compiled after '<a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a47f39055ac1392988d58a331b6557715" title="This function takes an input model and I/O specification, and it modifies both of them if necessary t...">AppendInputFrames()</a>' was called [this makes a difference in setups with subsampling], so the computation may have been built for input frames that were appended over several of the frames that 'model_padded' would require.</p>
<p>This is the reverse step for stage 2 of compilation (it's a transformation of the computation). </p>

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l01001">1001</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="convolution_8cc_source.html#l00349">ConvolutionComputation::Check()</a>, <a class="el" href="convolution_8cc_source.html#l01271">ConvolutionComputation::ComputeDerived()</a>, <a class="el" href="convolution_8cc_source.html#l00956">ComputeTempMatrixSize()</a>, <a class="el" href="convolution_8h_source.html#l00128">ConvolutionModel::height_in</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_in</a>, <a class="el" href="convolution_8h_source.html#l00313">ConvolutionComputation::ConvolutionStep::height_map</a>, <a class="el" href="convolution_8h_source.html#l00129">ConvolutionModel::height_out</a>, <a class="el" href="convolution_8h_source.html#l00257">ConvolutionComputation::height_out</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="convolution_8h_source.html#l00157">ConvolutionModel::offsets</a>, and <a class="el" href="convolution_8h_source.html#l00343">ConvolutionComputation::steps</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01367">CompileConvolutionComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                                                           {</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// First work out how much padding was done in PadModelHeight().</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  int32 bottom_padding = (model_padded.offsets[0].height_offset -</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                          model.offsets[0].height_offset),</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      total_padding = model_padded.height_in - model.height_in,</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      top_padding = total_padding - bottom_padding;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  int32 old_computation_height_in = computation-&gt;height_in;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="comment">// The computation may have been built for the input appended over</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">// several frames. Check that it is for an input height that&#39;s a multiple of</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="comment">// the model input height.</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(old_computation_height_in % model_padded.height_in == 0 &amp;&amp;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;               computation-&gt;height_out == model.height_out);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="comment">// &#39;ratio&#39; is the same ratio from AppendInputFrames(), it&#39;s the number</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <span class="comment">// of input frames in &#39;model&#39; and &#39;model_padded&#39; that get appended</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="comment">// to form a single frame in the computation.</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  int32 num_steps = computation-&gt;steps.size(),</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      unpadded_input_height = model.height_in,</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      padded_input_height = model_padded.height_in,</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      ratio = old_computation_height_in / padded_input_height;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  computation-&gt;height_in = ratio * unpadded_input_height;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">for</span> (int32 s = 0; s &lt; num_steps; s++) {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    ConvolutionComputation::ConvolutionStep &amp;step = computation-&gt;steps[s];</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    int32 height_map_size = step.height_map.size();</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; height_map_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      int32 c = step.height_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c &gt;= 0);  <span class="comment">// there should be no -1&#39;s in the padded computation.</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="comment">// below, h is the actual height in terms of the padded computation, and m</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="comment">// is an index that goes from zero to (num-appended-frames - 1).</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      int32 h = c % padded_input_height,</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;          m = c / padded_input_height;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(m &lt; ratio);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="keywordflow">if</span> (h &lt; bottom_padding || h &gt;= padded_input_height - top_padding) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        step.height_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -1;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        step.height_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (h - bottom_padding) + m * unpadded_input_height;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      }</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a62189e199d074c5393e2b3838f23601e">ComputeTempMatrixSize</a>(opts, computation);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  computation-&gt;ComputeDerived();</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  computation-&gt;Check();</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1time__height__convolution_html_a62189e199d074c5393e2b3838f23601e"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html#a62189e199d074c5393e2b3838f23601e">kaldi::nnet3::time_height_convolution::ComputeTempMatrixSize</a></div><div class="ttdeci">static void ComputeTempMatrixSize(const ConvolutionComputationOptions &amp;opts, ConvolutionComputation *computation)</div><div class="ttdoc">This function sets &amp;#39;temp_rows&amp;#39; and &amp;#39;temp_cols&amp;#39; in &amp;#39;computation&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="convolution_8cc_source.html#l00956">convolution.cc:956</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af3b5f58dc778b471a98dace82d84ed1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3b5f58dc778b471a98dace82d84ed1a">&#9670;&nbsp;</a></span>VectorIsContiguous()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::time_height_convolution::VectorIsContiguous </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution_8cc_source.html#l00077">77</a> of file <a class="el" href="convolution_8cc_source.html">convolution.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01271">ConvolutionComputation::ComputeDerived()</a>, and <a class="el" href="convolution_8cc_source.html#l00956">ComputeTempMatrixSize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                                            {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!vec.empty());</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  int32 s = vec.size();</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; s; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> (vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] != vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] + 1)</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2d385f0ba4d4950c67e633631359ea88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d385f0ba4d4950c67e633631359ea88">&#9670;&nbsp;</a></span>ZeroBlankRows()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::time_height_convolution::ZeroBlankRows </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrix.html">CuMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>matrix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="convolution-test_8cc_source.html#l00198">198</a> of file <a class="el" href="convolution-test_8cc_source.html">convolution-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-common_8cc_source.html#l00573">kaldi::nnet3::kNoTime</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="cu-matrix_8cc_source.html#l00779">CuMatrixBase&lt; Real &gt;::MulRowsVec()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00336">VectorBase&lt; Real &gt;::Set()</a>, and <a class="el" href="cu-vector_8cc_source.html#l00987">CuVector&lt; Real &gt;::Swap()</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution-test_8cc_source.html#l00308">TestDataBackprop()</a>, <a class="el" href="convolution-test_8cc_source.html#l00350">TestParamsBackprop()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00280">TestRunningComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                                {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;int32&gt;(indexes.size()) == matrix-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>());</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  int32 num_rows = matrix-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>();</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">if</span> (num_rows == 0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> mask(num_rows, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  mask.Set(1.0);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> *indexes_ptr = &amp;(indexes[0]);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *mask_ptr = mask.Data();</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (indexes_ptr[r].t == <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      mask_ptr[r] = 0.0;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> cu_mask;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  cu_mask.<a class="code" href="classkaldi_1_1CuVector.html#ae4516a7255ef9b1833040526710f88b5">Swap</a>(&amp;mask);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  matrix-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a9316d4a8c6a73dfadbf9e8417e70a514">MulRowsVec</a>(cu_mask);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVector_html"><div class="ttname"><a href="classkaldi_1_1CuVector.html">kaldi::CuVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00074">matrix-common.h:74</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html">kaldi::nnet3::Index</a></div><div class="ttdoc">struct Index is intended to represent the various indexes by which we number the rows of the matrices...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00044">nnet-common.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVector_html_ae4516a7255ef9b1833040526710f88b5"><div class="ttname"><a href="classkaldi_1_1CuVector.html#ae4516a7255ef9b1833040526710f88b5">kaldi::CuVector::Swap</a></div><div class="ttdeci">void Swap(CuVector&lt; Real &gt; *vec)</div><div class="ttdef"><b>Definition:</b> <a href="cu-vector_8cc_source.html#l00987">cu-vector.cc:987</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::CuMatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Dimensions. </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00214">cu-matrix.h:214</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a9316d4a8c6a73dfadbf9e8417e70a514"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a9316d4a8c6a73dfadbf9e8417e70a514">kaldi::CuMatrixBase::MulRowsVec</a></div><div class="ttdeci">void MulRowsVec(const CuVectorBase&lt; Real &gt; &amp;scale)</div><div class="ttdoc">scale i&amp;#39;th row by scale[i] </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l00779">cu-matrix.cc:779</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac952f0840a7950dff80c1a89e69656d7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kaldi::nnet3::kNoTime</a></div><div class="ttdeci">const int kNoTime</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00573">nnet-common.cc:573</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html">time_height_convolution</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
