<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: kaldi::nnet3 Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacekaldi_1_1nnet3.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">kaldi::nnet3 Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacekaldi_1_1nnet3_1_1attention"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1attention.html">attention</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespacekaldi_1_1nnet3_1_1computation__graph"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1computation__graph.html">computation_graph</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespacekaldi_1_1nnet3_1_1time__height__convolution"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3_1_1time__height__convolution.html">time_height_convolution</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1Access.html">Access</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1AffineComponent.html">AffineComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1AmNnetSimple.html">AmNnetSimple</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This struct exists to set up various pieces of analysis; it helps avoid the repetition of code where we compute all these things in sequence.  <a href="structkaldi_1_1nnet3_1_1Analyzer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1BackpropTruncationComponent.html">BackpropTruncationComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1BackpropTruncationComponentPrecomputedIndexes.html">BackpropTruncationComponentPrecomputedIndexes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1BatchNormComponent.html">BatchNormComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1BinarySumDescriptor.html">BinarySumDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1BinarySumDescriptor.html" title="BinarySumDescriptor can represent either A + B, or (A if defined, else B). ">BinarySumDescriptor</a> can represent either A + B, or (A if defined, else B).  <a href="classkaldi_1_1nnet3_1_1BinarySumDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1BlockAffineComponent.html">BlockAffineComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class implements an affine transform using a block diagonal matrix e.g., one whose weight matrix is all zeros except for blocks on the diagonal.  <a href="classkaldi_1_1nnet3_1_1BlockAffineComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">CachingOptimizingCompiler</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class enables you to do the compilation and optimization in one call, and also ensures that if the <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> is identical to the previous one, the compilation process is not repeated.  <a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">CachingOptimizingCompilerOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ChainExampleMerger.html">ChainExampleMerger</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is responsible for arranging examples in groups that have the same strucure (i.e.  <a href="classkaldi_1_1nnet3_1_1ChainExampleMerger.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ChainObjectiveInfo.html">ChainObjectiveInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ChainTrainerMemoryHolder.html">ChainTrainerMemoryHolder</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">CheckComputationOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html">ChunkTimeInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">struct <a class="el" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html" title="struct ChunkTimeInfo is used by class UtteranceSplitter to output information about how we split an u...">ChunkTimeInfo</a> is used by class <a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a> to output information about how we split an utterance into chunks.  <a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CindexHasher.html">CindexHasher</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1CindexSet.html">CindexSet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CindexVectorHasher.html">CindexVectorHasher</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ClipGradientComponent.html">ClipGradientComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CollapseModelConfig.html">CollapseModelConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Config class for the CollapseModel function.  <a href="structkaldi_1_1nnet3_1_1CollapseModelConfig.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CommandPairComparator.html">CommandPairComparator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ComparePair.html">ComparePair</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class creates an initial version of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>, without any optimization or sharing of matrices.  <a href="classkaldi_1_1nnet3_1_1Compiler.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Abstract base-class for neural-net components.  <a href="classkaldi_1_1nnet3_1_1Component.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1CompositeComponent.html">CompositeComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1CompositeComponent.html" title="CompositeComponent is a component representing a sequence of [simple] components. ...">CompositeComponent</a> is a component representing a sequence of [simple] components.  <a href="classkaldi_1_1nnet3_1_1CompositeComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html">ComputationAnalysis</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class performs various kinds of specific analysis on top of what class <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html" title="This struct exists to set up various pieces of analysis; it helps avoid the repetition of code where ...">Analyzer</a> gives you immediately.  <a href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationCache.html">ComputationCache</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class <a class="el" href="classkaldi_1_1nnet3_1_1ComputationCache.html" title="Class ComputationCache is used inside class CachingOptimizingCompiler to cache previously computed co...">ComputationCache</a> is used inside class <a class="el" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html" title="This class enables you to do the compilation and optimization in one call, and also ensures that if t...">CachingOptimizingCompiler</a> to cache previously computed computations.  <a href="classkaldi_1_1nnet3_1_1ComputationCache.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html">ComputationExpander</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The first step in compilation is to turn the ComputationSpecification into a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html" title="The first step in compilation is to turn the ComputationSpecification into a ComputationGraph, where for each Cindex we have a list of other Cindexes that it depends on. ">ComputationGraph</a>, where for each Cindex we have a list of other Cindexes that it depends on.  <a href="structkaldi_1_1nnet3_1_1ComputationGraph.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationGraphBuilder.html">ComputationGraphBuilder</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An abstract representation of a set of Cindexes.  <a href="classkaldi_1_1nnet3_1_1ComputationGraphBuilder.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationLoopedOptimizer.html">ComputationLoopedOptimizer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationRenumberer.html">ComputationRenumberer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html">ComputationRequestHasher</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequestPtrEqual.html">ComputationRequestPtrEqual</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationStepsComputer.html">ComputationStepsComputer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class arranges the cindex_ids of the computation into a sequence of lists called "steps", which will correspond roughly to the commands in the compiled computation.  <a href="classkaldi_1_1nnet3_1_1ComputationStepsComputer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class relates the matrices and sub-matrices in the computation to imaginary "variables", such that we can think of the operations as operating on sets of individual variables, and we can then do analysis that lets us do optimization.  <a href="classkaldi_1_1nnet3_1_1ComputationVariables.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is responsible for parsing input like hi-there xx=yyy a=b c empty= f-oo=Append(bar, sss) ba_z=123 bing='a b c' baz="a b c d='a b' e" and giving you access to the fields, in this case.  <a href="classkaldi_1_1nnet3_1_1ConfigLine.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ConstantComponent.html">ConstantComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ConstantFunctionComponent.html">ConstantFunctionComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ConstantSumDescriptor.html">ConstantSumDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is an alternative base-case of <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html" title="This is an abstract base-class. ">SumDescriptor</a> (an alternative to <a class="el" href="classkaldi_1_1nnet3_1_1SimpleSumDescriptor.html" title="This is the normal base-case of SumDescriptor which just wraps a ForwardingDescriptor. ">SimpleSumDescriptor</a>) which represents a constant term, e.g.  <a href="classkaldi_1_1nnet3_1_1ConstantSumDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ConvolutionComponent.html">ConvolutionComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">WARNING, this component is deprecated in favor of <a class="el" href="classkaldi_1_1nnet3_1_1TimeHeightConvolutionComponent.html" title="TimeHeightConvolutionComponent implements 2-dimensional convolution where one of the dimensions of co...">TimeHeightConvolutionComponent</a>, and will be deleted.  <a href="classkaldi_1_1nnet3_1_1ConvolutionComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableAmNnetLoopedOnline.html">DecodableAmNnetLoopedOnline</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableAmNnetSimple.html">DecodableAmNnetSimple</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableAmNnetSimpleLooped.html">DecodableAmNnetSimpleLooped</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableAmNnetSimpleParallel.html">DecodableAmNnetSimpleParallel</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableNnetLoopedOnline.html">DecodableNnetLoopedOnline</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableNnetLoopedOnlineBase.html">DecodableNnetLoopedOnlineBase</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableNnetSimple.html">DecodableNnetSimple</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLooped.html">DecodableNnetSimpleLooped</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLoopedInfo.html">DecodableNnetSimpleLoopedInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">When you instantiate class <a class="el" href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLooped.html">DecodableNnetSimpleLooped</a>, you should give it a const reference to this class, that has been previously initialized.  <a href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLoopedInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DerivativeTimeLimiter.html">DerivativeTimeLimiter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DiscriminativeExampleMerger.html">DiscriminativeExampleMerger</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is responsible for arranging examples in groups that have the same strucure (i.e.  <a href="classkaldi_1_1nnet3_1_1DiscriminativeExampleMerger.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1DiscriminativeObjectiveFunctionInfo.html">DiscriminativeObjectiveFunctionInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DistributeComponent.html">DistributeComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This <a class="el" href="classkaldi_1_1nnet3_1_1Component.html" title="Abstract base-class for neural-net components. ">Component</a> takes a larger input-dim than output-dim, where the input-dim must be a multiple of the output-dim, and distributes different blocks of the input dimension to different 'x' values.  <a href="classkaldi_1_1nnet3_1_1DistributeComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DistributeComponentPrecomputedIndexes.html">DistributeComponentPrecomputedIndexes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DropoutComponent.html">DropoutComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1DropoutMaskComponent.html">DropoutMaskComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ElementwiseProductComponent.html">ElementwiseProductComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ExampleGenerationConfig.html">ExampleGenerationConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMerger.html">ExampleMerger</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is responsible for arranging examples in groups that have the same strucure (i.e.  <a href="classkaldi_1_1nnet3_1_1ExampleMerger.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingConfig.html">ExampleMergingConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html">ExampleMergingStats</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is responsible for storing, and displaying in log messages, statistics about how examples of different sizes (c.f.  <a href="classkaldi_1_1nnet3_1_1ExampleMergingStats.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1FirstElementComparator.html">FirstElementComparator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1FirstElementIsEqualComparator.html">FirstElementIsEqualComparator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1FixedAffineComponent.html">FixedAffineComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1FixedAffineComponent.html" title="FixedAffineComponent is an affine transform that is supplied at network initialization time and is no...">FixedAffineComponent</a> is an affine transform that is supplied at network initialization time and is not trainable.  <a href="classkaldi_1_1nnet3_1_1FixedAffineComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1FixedBiasComponent.html">FixedBiasComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1FixedBiasComponent.html" title="FixedBiasComponent applies a fixed per-element bias; it&#39;s similar to the AddShift component in the nn...">FixedBiasComponent</a> applies a fixed per-element bias; it's similar to the AddShift component in the <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> setup (and only needed for <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> model conversion.  <a href="classkaldi_1_1nnet3_1_1FixedBiasComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1FixedScaleComponent.html">FixedScaleComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1FixedScaleComponent.html" title="FixedScaleComponent applies a fixed per-element scale; it&#39;s similar to the Rescale component in the n...">FixedScaleComponent</a> applies a fixed per-element scale; it's similar to the Rescale component in the <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> setup (and only needed for <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> model conversion).  <a href="classkaldi_1_1nnet3_1_1FixedScaleComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html">ForwardingDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A <a class="el" href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html" title="A ForwardingDescriptor describes how we copy data from another NetworkNode, or from multiple other Ne...">ForwardingDescriptor</a> describes how we copy data from another <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html" title="NetworkNode is used to represent, three types of thing: either an input of the network (which pretty ...">NetworkNode</a>, or from multiple other NetworkNodes, possibly with a scalar weight.  <a href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html">GeneralDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is only used when parsing Descriptors.  <a href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1GeneralDropoutComponent.html">GeneralDropoutComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1GeneralDropoutComponent.html" title="GeneralDropoutComponent implements dropout, including a continuous variant where the thing we multipl...">GeneralDropoutComponent</a> implements dropout, including a continuous variant where the thing we multiply is not just zero or one, but may be a continuous value.  <a href="classkaldi_1_1nnet3_1_1GeneralDropoutComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1GeneralDropoutComponentPrecomputedIndexes.html">GeneralDropoutComponentPrecomputedIndexes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html">ImageAugmentationConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">struct <a class="el" href="structkaldi_1_1nnet3_1_1Index.html" title="struct Index is intended to represent the various indexes by which we number the rows of the matrices...">Index</a> is intended to represent the various indexes by which we number the rows of the matrices that the Components process: mainly 'n', the index of the member of the minibatch, 't', used for the frame index in speech recognition, and 'x', which is a catch-all extra index which we might use in convolutional setups or for other reasons.  <a href="structkaldi_1_1nnet3_1_1Index.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1IndexHasher.html">IndexHasher</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1IndexLessNxt.html">IndexLessNxt</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1IndexSet.html">IndexSet</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An abstract representation of a set of Indexes.  <a href="classkaldi_1_1nnet3_1_1IndexSet.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1IndexVectorHasher.html">IndexVectorHasher</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1IoSpecificationHasher.html">IoSpecificationHasher</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1LinearComponent.html">LinearComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1LogSoftmaxComponent.html">LogSoftmaxComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1LstmNonlinearityComponent.html">LstmNonlinearityComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MatrixExtender.html">MatrixExtender</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MaxpoolingComponent.html">MaxpoolingComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html">MemoryCompressionOptimizer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is used in the function <a class="el" href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade" title="Performs optimization to reduce memory usage where possible, making use of the kCompressMatrix and kD...">OptimizeMemoryCompression()</a>, once we determine that there is some potential to do memory compression for this computation.  <a href="classkaldi_1_1nnet3_1_1MemoryCompressionOptimizer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ModelCollapser.html">ModelCollapser</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator.html">ModelUpdateConsolidator</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is responsible for consolidating the model-update part of backprop commands, for components in (e.g.) recurrent networks that need to have many separate backprop commands, into more efficient single commands operating on consolidated data in larger matrices.  <a href="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NaturalGradientAffineComponent.html">NaturalGradientAffineComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NaturalGradientPerElementScaleComponent.html">NaturalGradientPerElementScaleComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1NaturalGradientPerElementScaleComponent.html" title="NaturalGradientPerElementScaleComponent is like PerElementScaleComponent but it uses a natural gradie...">NaturalGradientPerElementScaleComponent</a> is like <a class="el" href="classkaldi_1_1nnet3_1_1PerElementScaleComponent.html" title="PerElementScaleComponent scales each dimension of its input with a separate trainable scale; it&#39;s lik...">PerElementScaleComponent</a> but it uses a natural gradient update for the per-element scales.  <a href="classkaldi_1_1nnet3_1_1NaturalGradientPerElementScaleComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NaturalGradientRepeatedAffineComponent.html">NaturalGradientRepeatedAffineComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html">NetworkNode</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html" title="NetworkNode is used to represent, three types of thing: either an input of the network (which pretty ...">NetworkNode</a> is used to represent, three types of thing: either an input of the network (which pretty much just states the dimension of the input vector); a <a class="el" href="classkaldi_1_1nnet3_1_1Component.html" title="Abstract base-class for neural-net components. ">Component</a> (e.g.  <a href="structkaldi_1_1nnet3_1_1NetworkNode.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetChainComputeProb.html">NnetChainComputeProb</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is for computing objective-function values in a nnet3+chain setup, for diagnostics.  <a href="classkaldi_1_1nnet3_1_1NnetChainComputeProb.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html" title="NnetChainExample is like NnetExample, but specialized for lattice-free (chain) training. ">NnetChainExample</a> is like <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a>, but specialized for lattice-free (chain) training.  <a href="structkaldi_1_1nnet3_1_1NnetChainExample.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExampleStructureCompare.html">NnetChainExampleStructureCompare</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This comparator object compares just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html" title="NnetChainExample is like NnetExample, but specialized for lattice-free (chain) training. ">NnetChainExample</a> without looking at the value of the features.  <a href="structkaldi_1_1nnet3_1_1NnetChainExampleStructureCompare.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExampleStructureHasher.html">NnetChainExampleStructureHasher</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This hashing object hashes just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> without looking at the value of the features.  <a href="structkaldi_1_1nnet3_1_1NnetChainExampleStructureHasher.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainSupervision.html">NnetChainSupervision</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetChainTrainer.html">NnetChainTrainer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is for single-threaded training of neural nets using the 'chain' model.  <a href="classkaldi_1_1nnet3_1_1NnetChainTrainer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainTrainingOptions.html">NnetChainTrainingOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">NnetComputeOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetComputeProb.html">NnetComputeProb</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is for computing cross-entropy and accuracy values in a neural network, for diagnostics.  <a href="classkaldi_1_1nnet3_1_1NnetComputeProb.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputeProbOptions.html">NnetComputeProbOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">class <a class="el" href="classkaldi_1_1nnet3_1_1NnetComputer.html" title="class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...">NnetComputer</a> is responsible for executing the computation described in the "computation" object.  <a href="classkaldi_1_1nnet3_1_1NnetComputer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetComputerFromEg.html">NnetComputerFromEg</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetDiscriminativeComputeObjf.html">NnetDiscriminativeComputeObjf</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is for computing objective-function values in a <a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a> discriminative training, for diagnostics.  <a href="classkaldi_1_1nnet3_1_1NnetDiscriminativeComputeObjf.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html" title="NnetDiscriminativeExample is like NnetExample, but specialized for sequence training. ">NnetDiscriminativeExample</a> is like <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a>, but specialized for sequence training.  <a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExampleStructureCompare.html">NnetDiscriminativeExampleStructureCompare</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This comparator object compares just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html" title="NnetDiscriminativeExample is like NnetExample, but specialized for sequence training. ">NnetDiscriminativeExample</a> without looking at the value of the features.  <a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExampleStructureCompare.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExampleStructureHasher.html">NnetDiscriminativeExampleStructureHasher</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This hashing object hashes just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> without looking at the value of the features.  <a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExampleStructureHasher.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeOptions.html">NnetDiscriminativeOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision.html">NnetDiscriminativeSupervision</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetDiscriminativeTrainer.html">NnetDiscriminativeTrainer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is for single-threaded discriminative training of neural nets.  <a href="classkaldi_1_1nnet3_1_1NnetDiscriminativeTrainer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> is the input data and corresponding label (or labels) for one or more frames of input, used for standard cross-entropy training of neural nets (and possibly for other objective functions).  <a href="structkaldi_1_1nnet3_1_1NnetExample.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExampleStructureCompare.html">NnetExampleStructureCompare</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This comparator object compares just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> without looking at the value of the features.  <a href="structkaldi_1_1nnet3_1_1NnetExampleStructureCompare.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExampleStructureHasher.html">NnetExampleStructureHasher</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This hashing object hashes just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> without looking at the value of the features.  <a href="structkaldi_1_1nnet3_1_1NnetExampleStructureHasher.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetIoStructureCompare.html">NnetIoStructureCompare</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This comparison object compares just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> object (name, indexes, feature dimension) without looking at the value of features.  <a href="structkaldi_1_1nnet3_1_1NnetIoStructureCompare.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetIoStructureHasher.html">NnetIoStructureHasher</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This hashing object hashes just the structural aspects of the <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> object (name, indexes, feature dimension) without looking at the value of features.  <a href="structkaldi_1_1nnet3_1_1NnetIoStructureHasher.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetLdaStatsAccumulator.html">NnetLdaStatsAccumulator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetSimpleComputationOptions.html">NnetSimpleComputationOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetSimpleLoopedComputationOptions.html">NnetSimpleLoopedComputationOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NnetTrainer.html">NnetTrainer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is for single-threaded training of neural nets using standard objective functions such as cross-entropy (implemented with logsoftmax nonlinearity and a linear objective function) and quadratic loss.  <a href="classkaldi_1_1nnet3_1_1NnetTrainer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1NnetTrainerOptions.html">NnetTrainerOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NonlinearComponent.html">NonlinearComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NoOpComponent.html">NoOpComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1NoOpComponent.html" title="NoOpComponent just duplicates its input. ">NoOpComponent</a> just duplicates its input.  <a href="classkaldi_1_1nnet3_1_1NoOpComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1NormalizeComponent.html">NormalizeComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1ObjectiveFunctionInfo.html">ObjectiveFunctionInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1OffsetForwardingDescriptor.html">OffsetForwardingDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Offsets in 't' and 'x' values of other ForwardingDescriptors.  <a href="classkaldi_1_1nnet3_1_1OffsetForwardingDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html">OnlineNaturalGradient</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Keywords for search: natural gradient, naturalgradient, NG-SGD.  <a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple.html">OnlineNaturalGradientSimple</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1OptionalSumDescriptor.html">OptionalSumDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the case of class <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html" title="This is an abstract base-class. ">SumDescriptor</a>, in which we contain just one term, and that term is optional (an IfDefined() expression).  <a href="classkaldi_1_1nnet3_1_1OptionalSumDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1PairIsEqualComparator.html">PairIsEqualComparator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1PerDimObjectiveInfo.html">PerDimObjectiveInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1PerElementOffsetComponent.html">PerElementOffsetComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1PerElementScaleComponent.html">PerElementScaleComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1PerElementScaleComponent.html" title="PerElementScaleComponent scales each dimension of its input with a separate trainable scale; it&#39;s lik...">PerElementScaleComponent</a> scales each dimension of its input with a separate trainable scale; it's like a linear component with a diagonal matrix.  <a href="classkaldi_1_1nnet3_1_1PerElementScaleComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1PermuteComponent.html">PermuteComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1PermuteComponent.html" title="PermuteComponent changes the order of the columns (i.e. ">PermuteComponent</a> changes the order of the columns (i.e.  <a href="classkaldi_1_1nnet3_1_1PermuteComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1PnormComponent.html">PnormComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1RectifiedLinearComponent.html">RectifiedLinearComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1RepeatedAffineComponent.html">RepeatedAffineComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ReplaceIndexForwardingDescriptor.html">ReplaceIndexForwardingDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This <a class="el" href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html" title="A ForwardingDescriptor describes how we copy data from another NetworkNode, or from multiple other Ne...">ForwardingDescriptor</a> modifies the indexes (n, t, x) by replacing one of them (normally t) with a constant value and keeping the rest.  <a href="classkaldi_1_1nnet3_1_1ReplaceIndexForwardingDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1RestrictedAttentionComponent.html">RestrictedAttentionComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1RestrictedAttentionComponent.html" title="RestrictedAttentionComponent implements an attention model with restricted temporal context...">RestrictedAttentionComponent</a> implements an attention model with restricted temporal context.  <a href="classkaldi_1_1nnet3_1_1RestrictedAttentionComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1RoundingForwardingDescriptor.html">RoundingForwardingDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">For use in clockwork RNNs and the like, this forwarding-descriptor rounds the time-index t down to the the closest t' &lt;= t that is an exact multiple of t_modulus_.  <a href="classkaldi_1_1nnet3_1_1RoundingForwardingDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1RowOpsSplitter.html">RowOpsSplitter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ScaleAndOffsetComponent.html">ScaleAndOffsetComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SigmoidComponent.html">SigmoidComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SimpleForwardingDescriptor.html">SimpleForwardingDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1SimpleForwardingDescriptor.html" title="SimpleForwardingDescriptor is the base-case of ForwardingDescriptor, consisting of a source node in t...">SimpleForwardingDescriptor</a> is the base-case of <a class="el" href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html" title="A ForwardingDescriptor describes how we copy data from another NetworkNode, or from multiple other Ne...">ForwardingDescriptor</a>, consisting of a source node in the graph with a given scalar weight (which will in the normal case be 1.0).  <a href="classkaldi_1_1nnet3_1_1SimpleForwardingDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1SimpleObjectiveInfo.html">SimpleObjectiveInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SimpleSumDescriptor.html">SimpleSumDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the normal base-case of <a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html" title="This is an abstract base-class. ">SumDescriptor</a> which just wraps a <a class="el" href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html" title="A ForwardingDescriptor describes how we copy data from another NetworkNode, or from multiple other Ne...">ForwardingDescriptor</a>.  <a href="classkaldi_1_1nnet3_1_1SimpleSumDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SoftmaxComponent.html">SoftmaxComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1StatisticsExtractionComponent.html">StatisticsExtractionComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1StatisticsExtractionComponentPrecomputedIndexes.html">StatisticsExtractionComponentPrecomputedIndexes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1StatisticsPoolingComponent.html">StatisticsPoolingComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1StatisticsPoolingComponentPrecomputedIndexes.html">StatisticsPoolingComponentPrecomputedIndexes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SumBlockComponent.html">SumBlockComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1SumBlockComponent.html" title="SumBlockComponent sums over blocks of its input: for instance, if you create one with the config &quot;inp...">SumBlockComponent</a> sums over blocks of its input: for instance, if you create one with the config "input-dim=400 output-dim=100", its output will be the sum over the 4 100-dimensional blocks of the input.  <a href="classkaldi_1_1nnet3_1_1SumBlockComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html">SumDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is an abstract base-class.  <a href="classkaldi_1_1nnet3_1_1SumDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SumGroupComponent.html">SumGroupComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1SumGroupComponent.html" title="SumGroupComponent is used to sum up groups of posteriors. ">SumGroupComponent</a> is used to sum up groups of posteriors.  <a href="classkaldi_1_1nnet3_1_1SumGroupComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SvdApplier.html">SvdApplier</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1SwitchingForwardingDescriptor.html">SwitchingForwardingDescriptor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Chooses from different inputs based on the the time index modulo (the number of ForwardingDescriptors given as inputs).  <a href="classkaldi_1_1nnet3_1_1SwitchingForwardingDescriptor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1TanhComponent.html">TanhComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet3_1_1TarjanNode.html">TarjanNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1TdnnComponent.html">TdnnComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1TdnnComponent.html" title="TdnnComponent is a more memory-efficient alternative to manually splicing several frames of input and...">TdnnComponent</a> is a more memory-efficient alternative to manually splicing several frames of input and then using a <a class="el" href="classkaldi_1_1nnet3_1_1NaturalGradientAffineComponent.html">NaturalGradientAffineComponent</a> or a <a class="el" href="classkaldi_1_1nnet3_1_1LinearComponent.html">LinearComponent</a>.  <a href="classkaldi_1_1nnet3_1_1TdnnComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1TimeHeightConvolutionComponent.html">TimeHeightConvolutionComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet3_1_1TimeHeightConvolutionComponent.html" title="TimeHeightConvolutionComponent implements 2-dimensional convolution where one of the dimensions of co...">TimeHeightConvolutionComponent</a> implements 2-dimensional convolution where one of the dimensions of convolution (which traditionally would be called the width axis) is identified with time (i.e.  <a href="classkaldi_1_1nnet3_1_1TimeHeightConvolutionComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html" title="Class UpdatableComponent is a Component which has trainable parameters; it extends the interface of C...">UpdatableComponent</a> is a <a class="el" href="classkaldi_1_1nnet3_1_1Component.html" title="Abstract base-class for neural-net components. ">Component</a> which has trainable parameters; it extends the interface of <a class="el" href="classkaldi_1_1nnet3_1_1Component.html" title="Abstract base-class for neural-net components. ">Component</a>.  <a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">VariableMergingOptimizer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class is responsible for merging matrices, although you probably want to access it via the the function <a class="el" href="namespacekaldi_1_1nnet3.html#a7918fc2d6dfa22dbc84913c63be8771b" title="This wraps class VariableMergingOptimizer in a simplified interface. ">VariableMergingOptimization()</a>.  <a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:af80630a0ede7fd145e56dcf05a2de731"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af80630a0ede7fd145e56dcf05a2de731">NnetChainExampleWriter</a></td></tr>
<tr class="separator:af80630a0ede7fd145e56dcf05a2de731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a0cce988bd256578ca8edc61cc1d4c6"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8a0cce988bd256578ca8edc61cc1d4c6">SequentialNnetChainExampleReader</a></td></tr>
<tr class="separator:a8a0cce988bd256578ca8edc61cc1d4c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08f703c9f73aca60a0fe3226c0b6bf3b"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a08f703c9f73aca60a0fe3226c0b6bf3b">RandomAccessNnetChainExampleReader</a></td></tr>
<tr class="separator:a08f703c9f73aca60a0fe3226c0b6bf3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8344e7587df9247d6cc492874901d4d"><td class="memItemLeft" align="right" valign="top">typedef std::pair&lt; int32, <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a></td></tr>
<tr class="separator:ac8344e7587df9247d6cc492874901d4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdfc2ad7f1c7dbba13a2d991e6a4d004"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#acdfc2ad7f1c7dbba13a2d991e6a4d004">NnetDiscriminativeExampleWriter</a></td></tr>
<tr class="separator:acdfc2ad7f1c7dbba13a2d991e6a4d004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6317f17ee7f9b20d4fb3915a3b8d185a"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6317f17ee7f9b20d4fb3915a3b8d185a">SequentialNnetDiscriminativeExampleReader</a></td></tr>
<tr class="separator:a6317f17ee7f9b20d4fb3915a3b8d185a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ba30fe45cf1049b8f91f220829dddc8"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1ba30fe45cf1049b8f91f220829dddc8">RandomAccessNnetDiscriminativeExampleReader</a></td></tr>
<tr class="separator:a1ba30fe45cf1049b8f91f220829dddc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2246cc04a2596de3c09fad3c3513671"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a></td></tr>
<tr class="separator:af2246cc04a2596de3c09fad3c3513671"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a206084ee5d66f24aeb8828c6bf8cb13d"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a></td></tr>
<tr class="separator:a206084ee5d66f24aeb8828c6bf8cb13d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96242234768bbde2864c47396903675e"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a96242234768bbde2864c47396903675e">RandomAccessNnetExampleReader</a></td></tr>
<tr class="separator:a96242234768bbde2864c47396903675e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ad8aff9e545a5f496a179a16667431478"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478">AccessType</a> { <a class="el" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>
 }</td></tr>
<tr class="separator:ad8aff9e545a5f496a179a16667431478"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36da016976f88292c0d31653a20cbfe3"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3">ComponentProperties</a> { <br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5530b2f8f01fac9e6e73fd29a65d4127">kSimpleComponent</a> = 0x001, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a> = 0x002, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d">kPropagateInPlace</a> = 0x004, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7">kPropagateAdds</a> = 0x008, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67">kReordersIndexes</a> = 0x010, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90">kBackpropAdds</a> = 0x020, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kBackpropNeedsInput</a> = 0x040, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kBackpropNeedsOutput</a> = 0x080, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df">kBackpropInPlace</a> = 0x100, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827">kStoresStats</a> = 0x200, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kInputContiguous</a> = 0x400, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kOutputContiguous</a> = 0x800, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658">kUsesMemo</a> = 0x1000, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a7526d98193f4d5b839d6026397f6ce0b">kRandomComponent</a> = 0x2000
<br />
 }</td></tr>
<tr class="separator:a36da016976f88292c0d31653a20cbfe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21e038f5b8958e203d28bc4f18472352"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352">CommandType</a> { <br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>
<br />
 }<tr class="memdesc:a21e038f5b8958e203d28bc4f18472352"><td class="mdescLeft">&#160;</td><td class="mdescRight">CommandType is an enum that describes the category of the command used in the NnetComputation.  <a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352">More...</a><br /></td></tr>
</td></tr>
<tr class="separator:a21e038f5b8958e203d28bc4f18472352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45660f9909187129a953fa05e664576e"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576e">ObjectiveType</a> { <a class="el" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d">kLinear</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2">kQuadratic</a>
 }<tr class="memdesc:a45660f9909187129a953fa05e664576e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This enum is for a kind of annotation we associate with output nodes of the network; it's for the convenience of calling code so that if the objective is one of a few standard types, we can compute it directly and know how to interpret the supervision labels.  <a href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576e">More...</a><br /></td></tr>
</td></tr>
<tr class="separator:a45660f9909187129a953fa05e664576e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac9cbaeea226ed297804c012dc12b16"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16">NodeType</a> { <br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kDimRange</a>, 
<br />
&#160;&#160;<a class="el" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a634ee767a8e90ff4d56e140459cca31f">kNone</a>
<br />
 }</td></tr>
<tr class="separator:acac9cbaeea226ed297804c012dc12b16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75a9acd74effffae38daed55136b0980"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980">FillMode</a> { <a class="el" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738">kNearest</a>, 
<a class="el" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee">kReflect</a>
 }</td></tr>
<tr class="separator:a75a9acd74effffae38daed55136b0980"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7012eb43a414f870091986ffeec55aea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7012eb43a414f870091986ffeec55aea">UnitTestPreconditionDirectionsOnline</a> ()</td></tr>
<tr class="separator:a7012eb43a414f870091986ffeec55aea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add0941dcac8fe7e6bfe5d65979c9d388"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#add0941dcac8fe7e6bfe5d65979c9d388">PrintCommand</a> (int32 num_commands, int32 command)</td></tr>
<tr class="separator:add0941dcac8fe7e6bfe5d65979c9d388"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cc6a3d60ce5fb425830d97903d51aa2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4cc6a3d60ce5fb425830d97903d51aa2">UnitTestNnetAnalyze</a> ()</td></tr>
<tr class="separator:a4cc6a3d60ce5fb425830d97903d51aa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79ed08ad0dcf1b82a23e4e3c96967502"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a79ed08ad0dcf1b82a23e4e3c96967502">IndexesMultiToSubmatrixIndexes</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;indexes_multi, std::vector&lt; int32 &gt; *submatrix_indexes)</td></tr>
<tr class="memdesc:a79ed08ad0dcf1b82a23e4e3c96967502"><td class="mdescLeft">&#160;</td><td class="mdescRight">given a vector of pairs from computation.indexes_multi_indexes containing paris (submatrix-index, row-index), this function outputs to "submatrix_indexes" all (unique) submatrix indexes that appear; and it outputs to "contains_null_marker" true if the pair (-1, -1) appears anywhere in indexes_multi, and false otherwise.  <a href="#a79ed08ad0dcf1b82a23e4e3c96967502">More...</a><br /></td></tr>
<tr class="separator:a79ed08ad0dcf1b82a23e4e3c96967502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa02a576b6e9aa0977f3eb52471742b85"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa02a576b6e9aa0977f3eb52471742b85">ComputeCommandAttributes</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a> &amp;vars, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; *attributes)</td></tr>
<tr class="separator:aa02a576b6e9aa0977f3eb52471742b85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a474b6a19fd42f428dd178f9af05150a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a474b6a19fd42f428dd178f9af05150a8">ComputeVariableAccesses</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a> &amp;variables, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; &amp;command_attributes, std::vector&lt; std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Access.html">Access</a> &gt; &gt; *variable_accesses)</td></tr>
<tr class="memdesc:a474b6a19fd42f428dd178f9af05150a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">After the command-level attributes have been computed, this function organizes them per variable (see class <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html" title="This class relates the matrices and sub-matrices in the computation to imaginary &quot;variables&quot;, such that we can think of the operations as operating on sets of individual variables, and we can then do analysis that lets us do optimization. ">ComputationVariables</a> for how a variable is defined; it is part of a matrix).  <a href="#a474b6a19fd42f428dd178f9af05150a8">More...</a><br /></td></tr>
<tr class="separator:a474b6a19fd42f428dd178f9af05150a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f107eabc73f1b70436ed117375778c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2f107eabc73f1b70436ed117375778c1">ComputeMatrixAccesses</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a> &amp;variables, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; &amp;command_attributes, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a> &gt; *matrix_accesses)</td></tr>
<tr class="memdesc:a2f107eabc73f1b70436ed117375778c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function organizes information in the <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> in a way that is convenient to access per matrix.  <a href="#a2f107eabc73f1b70436ed117375778c1">More...</a><br /></td></tr>
<tr class="separator:a2f107eabc73f1b70436ed117375778c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb55a5b6af7e1eeacfdba4dc68e3d995"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abb55a5b6af7e1eeacfdba4dc68e3d995">CheckComputationOnline</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation, <a class="el" href="classbool.html">bool</a> check_rewrite)</td></tr>
<tr class="separator:abb55a5b6af7e1eeacfdba4dc68e3d995"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfaf4324ca78917f262c1c733846370e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, <a class="el" href="classbool.html">bool</a> check_rewrite=false)</td></tr>
<tr class="memdesc:acfaf4324ca78917f262c1c733846370e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a convenience interface for class <a class="el" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a>.  <a href="#acfaf4324ca78917f262c1c733846370e">More...</a><br /></td></tr>
<tr class="separator:acfaf4324ca78917f262c1c733846370e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7468a5d6108f9a2f81b9b79b82866354"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7468a5d6108f9a2f81b9b79b82866354">ComputeMatrixToSubmatrix</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, std::vector&lt; std::vector&lt; int32 &gt; &gt; *mat_to_submat)</td></tr>
<tr class="memdesc:a7468a5d6108f9a2f81b9b79b82866354"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function computes a vector 'mat_to_submat', indexed by matrix index, such that (*mat_to_submat)[m] is a list of all the submatrix indexes that refer to matrix m.  <a href="#a7468a5d6108f9a2f81b9b79b82866354">More...</a><br /></td></tr>
<tr class="separator:a7468a5d6108f9a2f81b9b79b82866354"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa09a3995a6335eb986c2fb6432ff785c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa09a3995a6335eb986c2fb6432ff785c">PrintMatrixAccesses</a> (std::ostream &amp;os, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a> &gt; &amp;matrix_accesses)</td></tr>
<tr class="memdesc:aa09a3995a6335eb986c2fb6432ff785c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is to be used in debugging; it produces human-readable output.  <a href="#aa09a3995a6335eb986c2fb6432ff785c">More...</a><br /></td></tr>
<tr class="separator:aa09a3995a6335eb986c2fb6432ff785c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4f9689026c0962fecfe5cc56194840d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa4f9689026c0962fecfe5cc56194840d">PrintCommandAttributes</a> (std::ostream &amp;os, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; &amp;attributes)</td></tr>
<tr class="memdesc:aa4f9689026c0962fecfe5cc56194840d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is to be used in debugging; it produces human-readable output.  <a href="#aa4f9689026c0962fecfe5cc56194840d">More...</a><br /></td></tr>
<tr class="separator:aa4f9689026c0962fecfe5cc56194840d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a04e946fa68432f4e723944ce8ab281"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a0a04e946fa68432f4e723944ce8ab281">GetCommandsOfType</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, <a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352">CommandType</a> t, std::vector&lt; int32 &gt; *command_indexes)</td></tr>
<tr class="memdesc:a0a04e946fa68432f4e723944ce8ab281"><td class="mdescLeft">&#160;</td><td class="mdescRight">This utility function works out from a computation, the command-indexes of the commands of the given type.  <a href="#a0a04e946fa68432f4e723944ce8ab281">More...</a><br /></td></tr>
<tr class="separator:a0a04e946fa68432f4e723944ce8ab281"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab753d835b665dd1b444b16f045c3e1a3"><td class="memItemLeft" align="right" valign="top">int64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab753d835b665dd1b444b16f045c3e1a3">GetMaxMemoryUse</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation)</td></tr>
<tr class="separator:ab753d835b665dd1b444b16f045c3e1a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82b64d14f92892efd68998d19e012c1c"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a82b64d14f92892efd68998d19e012c1c">MaxMemoryUsage</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation)</td></tr>
<tr class="memdesc:a82b64d14f92892efd68998d19e012c1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the total memory, in bytes, used by the computation (just the temporary memory, not counting the memory used by the nnet itself).  <a href="#a82b64d14f92892efd68998d19e012c1c">More...</a><br /></td></tr>
<tr class="separator:a82b64d14f92892efd68998d19e012c1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24b5d0f8d0614e04abf2c8ec7a496d34"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a24b5d0f8d0614e04abf2c8ec7a496d34">HasXentOutputs</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="separator:a24b5d0f8d0614e04abf2c8ec7a496d34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b0e1736653b8fa4462642888883ad8e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a5b0e1736653b8fa4462642888883ad8e">RecomputeStats</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &amp;egs, const chain::ChainTrainingOptions &amp;chain_config, const <a class="el" href="namespacefst.html#a88a968cc6f6d68c2b3dd6aa90385f65c">fst::StdVectorFst</a> &amp;den_fst, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a5b0e1736653b8fa4462642888883ad8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function zeros the stored component-level stats in the nnet using <a class="el" href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea" title="Zeroes the component stats in all nonlinear components in the nnet. ">ZeroComponentStats()</a>, then recomputes them with the supplied egs.  <a href="#a5b0e1736653b8fa4462642888883ad8e">More...</a><br /></td></tr>
<tr class="separator:a5b0e1736653b8fa4462642888883ad8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56c6f4427fb48f1e38b8b3b250b687ec"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a56c6f4427fb48f1e38b8b3b250b687ec">MergeSupervision</a> (const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainSupervision.html">NnetChainSupervision</a> *&gt; &amp;inputs, <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainSupervision.html">NnetChainSupervision</a> *output)</td></tr>
<tr class="separator:a56c6f4427fb48f1e38b8b3b250b687ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe0183368d988b0e08258b864232c472"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abe0183368d988b0e08258b864232c472">MergeChainExamples</a> (<a class="el" href="classbool.html">bool</a> compress, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; *input, <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> *output)</td></tr>
<tr class="memdesc:abe0183368d988b0e08258b864232c472"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function merges a list of <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html" title="NnetChainExample is like NnetExample, but specialized for lattice-free (chain) training. ">NnetChainExample</a> objects into a single one&ndash; intended to be used when forming minibatches for neural net training.  <a href="#abe0183368d988b0e08258b864232c472">More...</a><br /></td></tr>
<tr class="separator:abe0183368d988b0e08258b864232c472"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc0bb79239b07e7a8b8c26abbf05657b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afc0bb79239b07e7a8b8c26abbf05657b">GetChainComputationRequest</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &amp;eg, <a class="el" href="classbool.html">bool</a> need_model_derivative, <a class="el" href="classbool.html">bool</a> store_component_stats, <a class="el" href="classbool.html">bool</a> use_xent_regularization, <a class="el" href="classbool.html">bool</a> use_xent_derivative, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *computation_request)</td></tr>
<tr class="memdesc:afc0bb79239b07e7a8b8c26abbf05657b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes a <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html" title="NnetChainExample is like NnetExample, but specialized for lattice-free (chain) training. ">NnetChainExample</a> and produces a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>.  <a href="#afc0bb79239b07e7a8b8c26abbf05657b">More...</a><br /></td></tr>
<tr class="separator:afc0bb79239b07e7a8b8c26abbf05657b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae01be70ef8559aef9dd5a01a4028198c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae01be70ef8559aef9dd5a01a4028198c">ShiftChainExampleTimes</a> (int32 frame_shift, const std::vector&lt; std::string &gt; &amp;exclude_names, <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> *eg)</td></tr>
<tr class="memdesc:ae01be70ef8559aef9dd5a01a4028198c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shifts the time-index t of everything in the input of "eg" by adding "t_offset" to all "t" values&ndash; but excluding those with names listed in "exclude_names", e.g.  <a href="#ae01be70ef8559aef9dd5a01a4028198c">More...</a><br /></td></tr>
<tr class="separator:ae01be70ef8559aef9dd5a01a4028198c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a048d60a5963f83c612918824a02e56f9"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a048d60a5963f83c612918824a02e56f9">GetNnetChainExampleSize</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &amp;a)</td></tr>
<tr class="separator:a048d60a5963f83c612918824a02e56f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe23a2ca349827db2a73933ee42d208d"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abe23a2ca349827db2a73933ee42d208d">GetChainNnetExampleSize</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &amp;a)</td></tr>
<tr class="memdesc:abe23a2ca349827db2a73933ee42d208d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the 'size' of a chain example as defined for purposes of merging egs, which is defined as the largest number of Indexes in any of the inputs or outputs of the example.  <a href="#abe23a2ca349827db2a73933ee42d208d">More...</a><br /></td></tr>
<tr class="separator:abe23a2ca349827db2a73933ee42d208d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a839780fb74682622f06524a99a653f88"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a839780fb74682622f06524a99a653f88">UnitTestIndexIo</a> ()</td></tr>
<tr class="separator:a839780fb74682622f06524a99a653f88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4b18d4f3a9eecf00c445ce091e41030"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa4b18d4f3a9eecf00c445ce091e41030">UnitTestCindexIo</a> ()</td></tr>
<tr class="separator:aa4b18d4f3a9eecf00c445ce091e41030"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aebb785e5823e55aa1d45d473f13a8e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2aebb785e5823e55aa1d45d473f13a8e">WriteIndexVectorElementBinary</a> (std::ostream &amp;os, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;vec, int32 i)</td></tr>
<tr class="separator:a2aebb785e5823e55aa1d45d473f13a8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada744dcd7dc25034e74e7a1f076fa05b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ada744dcd7dc25034e74e7a1f076fa05b">ReadIndexVectorElementBinary</a> (std::istream &amp;is, int32 i, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *vec)</td></tr>
<tr class="separator:ada744dcd7dc25034e74e7a1f076fa05b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d9bd2f8bc49b5d2d7dec9b2d354ffc9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a> (std::ostream &amp;os, <a class="el" href="classbool.html">bool</a> binary, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;vec)</td></tr>
<tr class="separator:a6d9bd2f8bc49b5d2d7dec9b2d354ffc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2069492e6a46f0c6b003a52cf87e2f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af2069492e6a46f0c6b003a52cf87e2f7">ReadIndexVector</a> (std::istream &amp;is, <a class="el" href="classbool.html">bool</a> binary, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *vec)</td></tr>
<tr class="separator:af2069492e6a46f0c6b003a52cf87e2f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f0c2f315140acd374d630c0804f3a07"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1f0c2f315140acd374d630c0804f3a07">WriteCindexVectorElementBinary</a> (std::ostream &amp;os, const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;vec, int32 i)</td></tr>
<tr class="separator:a1f0c2f315140acd374d630c0804f3a07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6250805a562082c954662a7311f4cd1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af6250805a562082c954662a7311f4cd1">ReadCindexVectorElementBinary</a> (std::istream &amp;is, int32 i, std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *vec)</td></tr>
<tr class="separator:af6250805a562082c954662a7311f4cd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab8af7cc27e3dad18e9262e62245c4b1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aab8af7cc27e3dad18e9262e62245c4b1">WriteCindexVector</a> (std::ostream &amp;os, <a class="el" href="classbool.html">bool</a> binary, const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;vec)</td></tr>
<tr class="separator:aab8af7cc27e3dad18e9262e62245c4b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a181c197e76d410f285809f04dc2bc23e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a181c197e76d410f285809f04dc2bc23e">ReadCindexVector</a> (std::istream &amp;is, <a class="el" href="classbool.html">bool</a> binary, std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *vec)</td></tr>
<tr class="separator:a181c197e76d410f285809f04dc2bc23e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5001f1f230fce8994722a8d211ab0b81"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a5001f1f230fce8994722a8d211ab0b81">operator&lt;&lt;</a> (std::ostream &amp;ostream, const <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &amp;index)</td></tr>
<tr class="separator:a5001f1f230fce8994722a8d211ab0b81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4f4752f24d0cdba07dd92e93430b965"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af4f4752f24d0cdba07dd92e93430b965">operator&lt;&lt;</a> (std::ostream &amp;ostream, const <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &amp;cindex)</td></tr>
<tr class="separator:af4f4752f24d0cdba07dd92e93430b965"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5b506b12f6ee61fbe53115f474df376"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab5b506b12f6ee61fbe53115f474df376">PrintCindex</a> (std::ostream &amp;os, const <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &amp;cindex, const std::vector&lt; std::string &gt; &amp;node_names)</td></tr>
<tr class="separator:ab5b506b12f6ee61fbe53115f474df376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af952225c01896b2850ffdb09ea2f0ba6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af952225c01896b2850ffdb09ea2f0ba6">PrintIndexes</a> (std::ostream &amp;ostream, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes)</td></tr>
<tr class="memdesc:af952225c01896b2850ffdb09ea2f0ba6"><td class="mdescLeft">&#160;</td><td class="mdescRight">this will only be used for pretty-printing.  <a href="#af952225c01896b2850ffdb09ea2f0ba6">More...</a><br /></td></tr>
<tr class="separator:af952225c01896b2850ffdb09ea2f0ba6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a610537b433bd5824688a70413c9905c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a610537b433bd5824688a70413c9905c6">PrintCindexes</a> (std::ostream &amp;ostream, const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;cindexes, const std::vector&lt; std::string &gt; &amp;node_names)</td></tr>
<tr class="memdesc:a610537b433bd5824688a70413c9905c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">this will only be used for pretty-printing.  <a href="#a610537b433bd5824688a70413c9905c6">More...</a><br /></td></tr>
<tr class="separator:a610537b433bd5824688a70413c9905c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91ad7b2e440d9b50c196a361f559a427"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a91ad7b2e440d9b50c196a361f559a427">PrintIntegerVector</a> (std::ostream &amp;os, const std::vector&lt; int32 &gt; &amp;ints)</td></tr>
<tr class="separator:a91ad7b2e440d9b50c196a361f559a427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbaeb0c690e96bd285e79a287882f13e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#adbaeb0c690e96bd285e79a287882f13e">AppendCindexes</a> (int32 node, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes, std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *out)</td></tr>
<tr class="memdesc:adbaeb0c690e96bd285e79a287882f13e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Appends to 'out' the pairs (node, indexes[0]), (node, indexes[1]), ...  <a href="#adbaeb0c690e96bd285e79a287882f13e">More...</a><br /></td></tr>
<tr class="separator:adbaeb0c690e96bd285e79a287882f13e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a944dbd968a2a1a9e8998083101702b79"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a944dbd968a2a1a9e8998083101702b79">ModifyNnetIvectorPeriod</a> (int32 ivector_period, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a944dbd968a2a1a9e8998083101702b79"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function modifies the descriptors in the neural network to change the periodicity with which it expects to read an iVector at its input.  <a href="#a944dbd968a2a1a9e8998083101702b79">More...</a><br /></td></tr>
<tr class="separator:a944dbd968a2a1a9e8998083101702b79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50c94226ad499267fedd4630bd2b5516"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a50c94226ad499267fedd4630bd2b5516">GetChunkSize</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 frame_subsampling_factor, int32 advised_chunk_size)</td></tr>
<tr class="separator:a50c94226ad499267fedd4630bd2b5516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06e0193dd98dcb1fcebf89a9dd483df6"><td class="memTemplParams" colspan="2">template&lt;class I &gt; </td></tr>
<tr class="memitem:a06e0193dd98dcb1fcebf89a9dd483df6"><td class="memTemplItemLeft" align="right" valign="top">I&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a06e0193dd98dcb1fcebf89a9dd483df6">Mod</a> (I m, I n)</td></tr>
<tr class="memdesc:a06e0193dd98dcb1fcebf89a9dd483df6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mod(m, n), defined for integers m and n where n &gt; 0, returns the modulus m % n, defined as the integer 0 &lt;= i &lt; n such that i and m are congruent modulo n; for instance, Mod(13, 10) = 3.  <a href="#a06e0193dd98dcb1fcebf89a9dd483df6">More...</a><br /></td></tr>
<tr class="separator:a06e0193dd98dcb1fcebf89a9dd483df6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e904151f4a628424a90335e58c9dbe0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1e904151f4a628424a90335e58c9dbe0">CreateComputationRequestInternal</a> (int32 begin_input_t, int32 end_input_t, int32 begin_output_t, int32 end_output_t, int32 num_sequences, int32 frame_subsampling_factor, const std::set&lt; int32 &gt; &amp;ivector_times, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request)</td></tr>
<tr class="separator:a1e904151f4a628424a90335e58c9dbe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51bcc44735a1576f1c1adfe056652595"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a51bcc44735a1576f1c1adfe056652595">CreateLoopedComputationRequest</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 chunk_size, int32 frame_subsampling_factor, int32 ivector_period, int32 left_context_begin, int32 right_context, int32 num_sequences, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request1, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request2, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request3)</td></tr>
<tr class="memdesc:a51bcc44735a1576f1c1adfe056652595"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function creates computation request suitable for giving to ComputeLooped().  <a href="#a51bcc44735a1576f1c1adfe056652595">More...</a><br /></td></tr>
<tr class="separator:a51bcc44735a1576f1c1adfe056652595"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef1d1a23b16cf461b7e7e049ae0be89b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aef1d1a23b16cf461b7e7e049ae0be89b">AddTimeOffsetToComputationRequest</a> (int32 t_offset, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request)</td></tr>
<tr class="separator:aef1d1a23b16cf461b7e7e049ae0be89b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cf8122407d1c438a044739d389a64ae"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1cf8122407d1c438a044739d389a64ae">ExtrapolateComputationRequest</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request1, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request2, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request3)</td></tr>
<tr class="separator:a1cf8122407d1c438a044739d389a64ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c667a8c24645dfc95df6dd93d0d80f1"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2c667a8c24645dfc95df6dd93d0d80f1">CompileLoopedInternal</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> optimize_opts, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request1, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request2, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request3, int32 num_requests, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a2c667a8c24645dfc95df6dd93d0d80f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addb1bb9cfaba76d930fa05d16d19bc4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a">CompileLooped</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;optimize_opts, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request1, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request2, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request3, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:addb1bb9cfaba76d930fa05d16d19bc4a"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a" title="CompileLooped() provides an internal interface for &#39;looped&#39; computation. ">CompileLooped()</a> provides an internal interface for 'looped' computation.  <a href="#addb1bb9cfaba76d930fa05d16d19bc4a">More...</a><br /></td></tr>
<tr class="separator:addb1bb9cfaba76d930fa05d16d19bc4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9f1d373569ff5f67ec7bbffb7c9cf5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae9f1d373569ff5f67ec7bbffb7c9cf5f">CreateLoopedComputationRequestSimple</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 chunk_size, int32 frame_subsampling_factor, int32 ivector_period, int32 extra_left_context_begin, int32 extra_right_context, int32 num_sequences, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request1, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request2, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request3)</td></tr>
<tr class="memdesc:ae9f1d373569ff5f67ec7bbffb7c9cf5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is deprecated.  <a href="#ae9f1d373569ff5f67ec7bbffb7c9cf5f">More...</a><br /></td></tr>
<tr class="separator:ae9f1d373569ff5f67ec7bbffb7c9cf5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68c5b8e70a4f632063af6c4a8c397189"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a68c5b8e70a4f632063af6c4a8c397189">UnitTestNnetCompile</a> ()</td></tr>
<tr class="separator:a68c5b8e70a4f632063af6c4a8c397189"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ab0d765a44c8a69eb704b5b1a12caa8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8ab0d765a44c8a69eb704b5b1a12caa8">UnitTestNnetCompileMulti</a> ()</td></tr>
<tr class="separator:a8ab0d765a44c8a69eb704b5b1a12caa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae416c14b4ec347fb1467f8e7e15d113f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae416c14b4ec347fb1467f8e7e15d113f">UnitTestNnetCompileLooped</a> ()</td></tr>
<tr class="separator:ae416c14b4ec347fb1467f8e7e15d113f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2fee0700fd475dc0d6b4a9d618e9a72"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab2fee0700fd475dc0d6b4a9d618e9a72">PrintVectorVectorPair</a> (std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; vec_vec_pair)</td></tr>
<tr class="separator:ab2fee0700fd475dc0d6b4a9d618e9a72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8d72d1c711cbf1c6cb14e49fa474a51"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae8d72d1c711cbf1c6cb14e49fa474a51">UnitTestSplitLocationsBackward</a> (<a class="el" href="classbool.html">bool</a> verbose)</td></tr>
<tr class="separator:ae8d72d1c711cbf1c6cb14e49fa474a51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07e09944d36b367d8e7b5978184826c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a07e09944d36b367d8e7b5978184826c2">UnitTestHasContiguousProperty</a> ()</td></tr>
<tr class="separator:a07e09944d36b367d8e7b5978184826c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26164e97ad97a37e3401b95d0d82098b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a26164e97ad97a37e3401b95d0d82098b">UnitTestEnsureContiguousProperty</a> ()</td></tr>
<tr class="separator:a26164e97ad97a37e3401b95d0d82098b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6242a8c5b093373663b9ec8210946b8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6242a8c5b093373663b9ec8210946b8a">UnitTestSplitLocations</a> (<a class="el" href="classbool.html">bool</a> verbose)</td></tr>
<tr class="separator:a6242a8c5b093373663b9ec8210946b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfcccae5ab2f658419cedbd126f574f0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#adfcccae5ab2f658419cedbd126f574f0">SecondElementComparator</a> (const std::pair&lt; int32, int32 &gt; &amp;first_pair, const std::pair&lt; int32, int32 &gt; &amp;second_pair)</td></tr>
<tr class="separator:adfcccae5ab2f658419cedbd126f574f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed1893395273c5cb53ea3606c2bad94a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aed1893395273c5cb53ea3606c2bad94a">SortSubmatLists</a> (const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, int32 *max_submat_list_size)</td></tr>
<tr class="separator:aed1893395273c5cb53ea3606c2bad94a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a602adf8e3c912ce0b74cbc5700255867"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a602adf8e3c912ce0b74cbc5700255867">ComputeSubmatIndexHistogram</a> (const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; sorted_submat_lists, unordered_map&lt; int32, std::vector&lt; int32 &gt; &gt; *submat_histogram)</td></tr>
<tr class="separator:a602adf8e3c912ce0b74cbc5700255867"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abff8a093b516f579b1bce94a954f6e7c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abff8a093b516f579b1bce94a954f6e7c">FindSubmatIndexInSubmatLists</a> (int32 submat_index, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;::iterator &gt; *output_iterator_list, int32 *max_remaining_submat_list_size)</td></tr>
<tr class="separator:abff8a093b516f579b1bce94a954f6e7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3395b82092a47a75b581f5f4a55a503"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac3395b82092a47a75b581f5f4a55a503">ExtractGivenPairsFromSubmatLists</a> (std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;::iterator &gt; &amp;input_iterator_list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *list_of_pairs)</td></tr>
<tr class="separator:ac3395b82092a47a75b581f5f4a55a503"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a078fe7414bf11ee4f33567cb85b2b202"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a078fe7414bf11ee4f33567cb85b2b202">ExtractLastPairFromSubmatLists</a> (std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *list_of_pairs)</td></tr>
<tr class="separator:a078fe7414bf11ee4f33567cb85b2b202"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab45cba0a2a0446179a2741e19949afcd"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab45cba0a2a0446179a2741e19949afcd">SplitLocationsUsingSubmatHistogram</a> (int32 max_submat_list_size, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *submat_histogram_vector, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</td></tr>
<tr class="separator:ab45cba0a2a0446179a2741e19949afcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c81548b4f8146cd3447b10d556978a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8">SplitLocations</a> (const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</td></tr>
<tr class="memdesc:a7c81548b4f8146cd3447b10d556978a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">The input to this function is a vector of lists of pairs, and this function splits it up into a list of vectors of pairs.  <a href="#a7c81548b4f8146cd3447b10d556978a8">More...</a><br /></td></tr>
<tr class="separator:a7c81548b4f8146cd3447b10d556978a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae99488174e8dde27f8f30d91d61c0cd2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">ConvertToIndexes</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;location_vector, int32 *first_value, std::vector&lt; int32 &gt; *second_values)</td></tr>
<tr class="memdesc:ae99488174e8dde27f8f30d91d61c0cd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">If it is the case for some i &gt;= 0 that all the .first elements of "location_vector" are either i or -1, then output i to first_value and the .second elements into "second_values", and return true.  <a href="#ae99488174e8dde27f8f30d91d61c0cd2">More...</a><br /></td></tr>
<tr class="separator:ae99488174e8dde27f8f30d91d61c0cd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84ff5e289907fa63155ee9bec0f9c631"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a84ff5e289907fa63155ee9bec0f9c631">EnsureContiguousProperty</a> (const std::vector&lt; int32 &gt; &amp;indexes, std::vector&lt; std::vector&lt; int32 &gt; &gt; *indexes_out)</td></tr>
<tr class="memdesc:a84ff5e289907fa63155ee9bec0f9c631"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes a vector of indexes and splits it up into as separate vectors of the same size, as needed to ensure that the 'contiguous property' holds.  <a href="#a84ff5e289907fa63155ee9bec0f9c631">More...</a><br /></td></tr>
<tr class="separator:a84ff5e289907fa63155ee9bec0f9c631"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1df4b00a6ceed8cc071e249ed8c931d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1df4b00a6ceed8cc071e249ed8c931d0">SplitPairList</a> (std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</td></tr>
<tr class="memdesc:a1df4b00a6ceed8cc071e249ed8c931d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function splits a vector of pairs into a list of vectors of pairs.  <a href="#a1df4b00a6ceed8cc071e249ed8c931d0">More...</a><br /></td></tr>
<tr class="separator:a1df4b00a6ceed8cc071e249ed8c931d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a230b979419515f453ee5c8f2bc87a4dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a230b979419515f453ee5c8f2bc87a4dd">SplitLocationsBackward</a> (const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</td></tr>
<tr class="memdesc:a230b979419515f453ee5c8f2bc87a4dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function has the same interface as <a class="el" href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8" title="The input to this function is a vector of lists of pairs, and this function splits it up into a list ...">SplitLocations()</a>; however, it ensures certain additional properties of the output "split_lists", which are necessary because of the way it is used in backprop code.  <a href="#a230b979419515f453ee5c8f2bc87a4dd">More...</a><br /></td></tr>
<tr class="separator:a230b979419515f453ee5c8f2bc87a4dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae892457066e9b2ac1632188de1aa06f1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">HasContiguousProperty</a> (const std::vector&lt; int32 &gt; &amp;indexes, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *reverse_indexes)</td></tr>
<tr class="memdesc:ae892457066e9b2ac1632188de1aa06f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns true if for each integer i != -1, all the indexes j at which indexes[j] == i are consecutive with no gaps (more formally: if j1 &lt; j2 &lt; j3 and indexes[j1] != -1 and indexes[j1] == indexes[j3], then indexes[j1] == indexes[j2]).  <a href="#ae892457066e9b2ac1632188de1aa06f1">More...</a><br /></td></tr>
<tr class="separator:ae892457066e9b2ac1632188de1aa06f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88f25f27da8a794033590e7e322d7673"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a88f25f27da8a794033590e7e322d7673">GetNxList</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *pairs)</td></tr>
<tr class="memdesc:a88f25f27da8a794033590e7e322d7673"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function outputs a unique, lexicographically sorted list of the pairs of (n, x) values that are encountered in the provided list of Indexes.  <a href="#a88f25f27da8a794033590e7e322d7673">More...</a><br /></td></tr>
<tr class="separator:a88f25f27da8a794033590e7e322d7673"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a391f07e5812ae93c5950791cb56cbbb3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a391f07e5812ae93c5950791cb56cbbb3">GetTList</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes, std::vector&lt; int32 &gt; *t_values)</td></tr>
<tr class="memdesc:a391f07e5812ae93c5950791cb56cbbb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function outputs a sorted, unique list of the 't' values that are encountered in the provided list of Indexes If 't' values equal to kNoTime are encountered, they are ignored and are not output.  <a href="#a391f07e5812ae93c5950791cb56cbbb3">More...</a><br /></td></tr>
<tr class="separator:a391f07e5812ae93c5950791cb56cbbb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ed7d5044f00b6a0d18737b660c52ad0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">ResetSeed</a> (int32 rand_seed, const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;c)</td></tr>
<tr class="separator:a7ed7d5044f00b6a0d18737b660c52ad0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dcc4499fe158f988c4b26b757b213e9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">CheckStringsApproxEqual</a> (const std::string &amp;a, const std::string &amp;b, int32 tolerance=3)</td></tr>
<tr class="separator:a3dcc4499fe158f988c4b26b757b213e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee5e219c905cd82d682bc00a0de72d74"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aee5e219c905cd82d682bc00a0de72d74">TestNnetComponentIo</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c)</td></tr>
<tr class="separator:aee5e219c905cd82d682bc00a0de72d74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7d4b74958e0a63a4e52bef63e71f394"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af7d4b74958e0a63a4e52bef63e71f394">TestNnetComponentCopy</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c)</td></tr>
<tr class="separator:af7d4b74958e0a63a4e52bef63e71f394"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a554b097cfc8c22c7fe43dec7ceca8839"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a554b097cfc8c22c7fe43dec7ceca8839">TestNnetComponentAddScale</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c)</td></tr>
<tr class="separator:a554b097cfc8c22c7fe43dec7ceca8839"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a179079a64f06a09c80c757753016b094"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a179079a64f06a09c80c757753016b094">TestNnetComponentVectorizeUnVectorize</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c)</td></tr>
<tr class="separator:a179079a64f06a09c80c757753016b094"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b28b95264b6db2e9ce5658f8f939a8b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a0b28b95264b6db2e9ce5658f8f939a8b">TestNnetComponentUpdatable</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c)</td></tr>
<tr class="separator:a0b28b95264b6db2e9ce5658f8f939a8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa92ca6ce1ae303070bc390ec4cf19e46"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa92ca6ce1ae303070bc390ec4cf19e46">GetPrecomputedIndexes</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;c, int32 num_rows)</td></tr>
<tr class="separator:aa92ca6ce1ae303070bc390ec4cf19e46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d2f85463a6a7b714692a2e84160f137"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3d2f85463a6a7b714692a2e84160f137">TestSimpleComponentPropagateProperties</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;c)</td></tr>
<tr class="separator:a3d2f85463a6a7b714692a2e84160f137"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1a1dc9b5063b680db3bb5e8ce670a21"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac1a1dc9b5063b680db3bb5e8ce670a21">TestSimpleComponentDataDerivative</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;c, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> perturb_delta)</td></tr>
<tr class="separator:ac1a1dc9b5063b680db3bb5e8ce670a21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72a20443febb349c12d3f34ea6d5bdc5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;c, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> perturb_delta, <a class="el" href="classbool.html">bool</a> test_derivative)</td></tr>
<tr class="separator:a72a20443febb349c12d3f34ea6d5bdc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32b068b357bfea7bf051d6f644e1912d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a32b068b357bfea7bf051d6f644e1912d">UnitTestNnetComponent</a> ()</td></tr>
<tr class="separator:a32b068b357bfea7bf051d6f644e1912d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a170051dd847dd17ea4826fe55635fb72"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a170051dd847dd17ea4826fe55635fb72">operator&lt;&lt;</a> (std::ostream &amp;os, const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationGraphBuilder.html#a4da89c69c9a5840ecaa70959af36c492">ComputationGraphBuilder::ComputableInfo</a> &amp;info)</td></tr>
<tr class="memdesc:a170051dd847dd17ea4826fe55635fb72"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is to be used in logging only.  <a href="#a170051dd847dd17ea4826fe55635fb72">More...</a><br /></td></tr>
<tr class="separator:a170051dd847dd17ea4826fe55635fb72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a9dab13d6db9f89fb2693d37b08ebe1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a9a9dab13d6db9f89fb2693d37b08ebe1">ComputeComputationGraph</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a> *graph)</td></tr>
<tr class="separator:a9a9dab13d6db9f89fb2693d37b08ebe1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49f9f182fa8dc05d6672c4b7fcad737f"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a49f9f182fa8dc05d6672c4b7fcad737f">SumVectorSizes</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;vec)</td></tr>
<tr class="separator:a49f9f182fa8dc05d6672c4b7fcad737f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b3c3728dced52837e749f0d4d4f3b40"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8b3c3728dced52837e749f0d4d4f3b40">SumVectorSizes</a> (const std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; &amp;vec)</td></tr>
<tr class="separator:a8b3c3728dced52837e749f0d4d4f3b40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac598e840c9ed7da8b25b98f8243672d4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac598e840c9ed7da8b25b98f8243672d4">ComputeComputationPhasesForEpoch</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a> &amp;graph, const std::vector&lt; int32 &gt; &amp;this_epoch, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;dependencies_subset, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;depend_on_subset, <a class="el" href="classbool.html">bool</a> epoch_is_trivial, std::vector&lt; int32 &gt; *phase_indexes, std::vector&lt; std::vector&lt; int32 &gt; &gt; *phases)</td></tr>
<tr class="separator:ac598e840c9ed7da8b25b98f8243672d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c9e85c299672aa4ef4a0c080d19b3d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2c9e85c299672aa4ef4a0c080d19b3d9">ComputeComputationPhases</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a> &amp;computation_graph, std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; *phases_per_segment)</td></tr>
<tr class="memdesc:a2c9e85c299672aa4ef4a0c080d19b3d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function divides a computation into 'phases', where a 'phase' is a collection of cindexes which can (as far as the computation graph is concerned) all be computed at the same time, and depend only on cindexes previously computed in earlier phases.  <a href="#a2c9e85c299672aa4ef4a0c080d19b3d9">More...</a><br /></td></tr>
<tr class="separator:a2c9e85c299672aa4ef4a0c080d19b3d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69c7aa23d0e3d87413ce4de4be66f7a6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a69c7aa23d0e3d87413ce4de4be66f7a6">GetIndexesStrings</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, std::vector&lt; std::string &gt; *indexes_strings)</td></tr>
<tr class="separator:a69c7aa23d0e3d87413ce4de4be66f7a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e3228381d1a400e113f12dffce84ec0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2e3228381d1a400e113f12dffce84ec0">GetIndexesMultiStrings</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, std::vector&lt; std::string &gt; *indexes_multi_strings)</td></tr>
<tr class="separator:a2e3228381d1a400e113f12dffce84ec0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9a2ce289b10aff70bac5d2ace3f7fa7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa9a2ce289b10aff70bac5d2ace3f7fa7">PrintCommand</a> (std::ostream &amp;os_out, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, int32 command_index, const std::vector&lt; std::string &gt; &amp;submatrix_strings, const std::vector&lt; std::string &gt; &amp;indexes_strings, const std::vector&lt; std::string &gt; &amp;indexes_multi_strings)</td></tr>
<tr class="separator:aa9a2ce289b10aff70bac5d2ace3f7fa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84e0b21f2d4f6d5eaf3edb65595b417c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a84e0b21f2d4f6d5eaf3edb65595b417c">PrintComputationPreamble</a> (std::ostream &amp;os, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;c, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const std::vector&lt; std::string &gt; &amp;submatrix_strings, const std::vector&lt; std::string &gt; &amp;indexes_strings, const std::vector&lt; std::string &gt; &amp;indexes_multi_strings)</td></tr>
<tr class="separator:a84e0b21f2d4f6d5eaf3edb65595b417c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63bbb226b5063936684810e9cc6f830a"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a63bbb226b5063936684810e9cc6f830a">operator&lt;&lt;</a> (std::ostream &amp;os, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation)</td></tr>
<tr class="separator:a63bbb226b5063936684810e9cc6f830a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73c7d7120264caaefed196288122dca6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a73c7d7120264caaefed196288122dca6">UnitTestNnetComputationIo</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a73c7d7120264caaefed196288122dca6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76dbacc17a4a046b8d9addf0f4214b7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a76dbacc17a4a046b8d9addf0f4214b7f">UnitTestComputationRequestIo</a> (<a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request)</td></tr>
<tr class="separator:a76dbacc17a4a046b8d9addf0f4214b7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3aff0be4a71c5f484a787d889f5d6be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa3aff0be4a71c5f484a787d889f5d6be">TestNnetDecodable</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="separator:aa3aff0be4a71c5f484a787d889f5d6be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72aa26595d9be2bf06aa61db33ed362f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a72aa26595d9be2bf06aa61db33ed362f">UnitTestNnetCompute</a> ()</td></tr>
<tr class="separator:a72aa26595d9be2bf06aa61db33ed362f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12fab71b9fb0d11733b8d9e452da5eda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a12fab71b9fb0d11733b8d9e452da5eda">ComputeMinAndMaxTimes</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes, int32 *min_t, int32 *max_t)</td></tr>
<tr class="separator:a12fab71b9fb0d11733b8d9e452da5eda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfc29da249703fa1e9c54cf85f6f0ef1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abfc29da249703fa1e9c54cf85f6f0ef1">SetDerivTimesOptions</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request, <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> *opt_config)</td></tr>
<tr class="separator:abfc29da249703fa1e9c54cf85f6f0ef1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a557038a07d45e34088f4943c2a668b2b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a557038a07d45e34088f4943c2a668b2b">UnitTestNnetModelDerivatives</a> ()</td></tr>
<tr class="separator:a557038a07d45e34088f4943c2a668b2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8666ffad3ea0232ebaa3cff139a32629"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8666ffad3ea0232ebaa3cff139a32629">UnitTestNnetInputDerivatives</a> ()</td></tr>
<tr class="separator:a8666ffad3ea0232ebaa3cff139a32629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdefaf0453649dae0c96bf6cd516bd69"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html">ForwardingDescriptor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">GenRandForwardingDescriptor</a> (int32 num_nodes)</td></tr>
<tr class="separator:afdefaf0453649dae0c96bf6cd516bd69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9b08e079998e1eea6db1c2b5a403a28"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html">SumDescriptor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae9b08e079998e1eea6db1c2b5a403a28">GenRandSumDescriptor</a> (int32 num_nodes)</td></tr>
<tr class="separator:ae9b08e079998e1eea6db1c2b5a403a28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2465e8e47256304999d4cd892e7162b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2465e8e47256304999d4cd892e7162b9">GenRandDescriptor</a> (int32 num_nodes, <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> *desc)</td></tr>
<tr class="separator:a2465e8e47256304999d4cd892e7162b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa84775bbab03ebc20020d57dbefb2586"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa84775bbab03ebc20020d57dbefb2586">UnitTestDescriptorIo</a> ()</td></tr>
<tr class="separator:aa84775bbab03ebc20020d57dbefb2586"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e3fd435407cfc4dec9e51a07d3c4f26"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2e3fd435407cfc4dec9e51a07d3c4f26">UnitTestGeneralDescriptor</a> ()</td></tr>
<tr class="separator:a2e3fd435407cfc4dec9e51a07d3c4f26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59f9bf54d192e760e406499f997327be"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a> (const std::vector&lt; std::string &gt; &amp;node_names, const std::string &amp;desc_str)</td></tr>
<tr class="separator:a59f9bf54d192e760e406499f997327be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9ae443db1f79c1de816ace0cee8706f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac9ae443db1f79c1de816ace0cee8706f">UnitTestGeneralDescriptorSpecial</a> ()</td></tr>
<tr class="separator:ac9ae443db1f79c1de816ace0cee8706f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3fbd67899f39d18e85c03f06e0c69bf"><td class="memItemLeft" align="right" valign="top">static std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa3fbd67899f39d18e85c03f06e0c69bf">ParsingContext</a> (const std::string *token_ptr)</td></tr>
<tr class="separator:aa3fbd67899f39d18e85c03f06e0c69bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41114607233f11aab89539abf08cf922"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a41114607233f11aab89539abf08cf922">ExpectToken</a> (const std::string &amp;token, const std::string &amp;what_we_are_parsing, const std::string **next_token)</td></tr>
<tr class="separator:a41114607233f11aab89539abf08cf922"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a556f73d99d4fcebed0e0bde2c2d34094"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a556f73d99d4fcebed0e0bde2c2d34094">ReadIntegerToken</a> (const std::string &amp;what_we_are_parsing, const std::string **next_token)</td></tr>
<tr class="separator:a556f73d99d4fcebed0e0bde2c2d34094"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3bf20c2ae341e8ba04b5e13ef2507a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa3bf20c2ae341e8ba04b5e13ef2507a0">ComputeAccuracy</a> (const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;supervision, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;nnet_output, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *tot_weight, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *tot_accuracy, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *tot_weight_vec=NULL, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *tot_accuracy_vec=NULL)</td></tr>
<tr class="memdesc:aa3bf20c2ae341e8ba04b5e13ef2507a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function computes the frame accuracy for this minibatch.  <a href="#aa3bf20c2ae341e8ba04b5e13ef2507a0">More...</a><br /></td></tr>
<tr class="separator:aa3bf20c2ae341e8ba04b5e13ef2507a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d3932735b1229a9b7e8bdce64f3cf1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8d3932735b1229a9b7e8bdce64f3cf1a">MergeSupervision</a> (const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision.html">NnetDiscriminativeSupervision</a> *&gt; &amp;inputs, <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision.html">NnetDiscriminativeSupervision</a> *output)</td></tr>
<tr class="separator:a8d3932735b1229a9b7e8bdce64f3cf1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbbb286d5e95ff4078c057af5a5b6139"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afbbb286d5e95ff4078c057af5a5b6139">MergeDiscriminativeExamples</a> (<a class="el" href="classbool.html">bool</a> compress, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; *input, <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> *output)</td></tr>
<tr class="separator:afbbb286d5e95ff4078c057af5a5b6139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ba3000fa54c53ed52e22225edbc7c94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1ba3000fa54c53ed52e22225edbc7c94">GetDiscriminativeComputationRequest</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &amp;eg, <a class="el" href="classbool.html">bool</a> need_model_derivative, <a class="el" href="classbool.html">bool</a> store_component_stats, <a class="el" href="classbool.html">bool</a> use_xent_regularization, <a class="el" href="classbool.html">bool</a> use_xent_derivative, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *computation_request)</td></tr>
<tr class="memdesc:a1ba3000fa54c53ed52e22225edbc7c94"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes a <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html" title="NnetDiscriminativeExample is like NnetExample, but specialized for sequence training. ">NnetDiscriminativeExample</a> and produces a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>.  <a href="#a1ba3000fa54c53ed52e22225edbc7c94">More...</a><br /></td></tr>
<tr class="separator:a1ba3000fa54c53ed52e22225edbc7c94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a841fd1955e1fe57fd1ee29459a1f6f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6a841fd1955e1fe57fd1ee29459a1f6f">ShiftDiscriminativeExampleTimes</a> (int32 frame_shift, const std::vector&lt; std::string &gt; &amp;exclude_names, <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> *eg)</td></tr>
<tr class="memdesc:a6a841fd1955e1fe57fd1ee29459a1f6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shifts the time-index t of everything in the input of "eg" by adding "t_offset" to all "t" values&ndash; but excluding those with names listed in "exclude_names", e.g.  <a href="#a6a841fd1955e1fe57fd1ee29459a1f6f">More...</a><br /></td></tr>
<tr class="separator:a6a841fd1955e1fe57fd1ee29459a1f6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a530c70214ef7a623bbb77ab3f2bff173"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a530c70214ef7a623bbb77ab3f2bff173">GetNnetDiscriminativeExampleSize</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &amp;a)</td></tr>
<tr class="separator:a530c70214ef7a623bbb77ab3f2bff173"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcc977fd1ccb4dd285c01c9a13ebdef0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afcc977fd1ccb4dd285c01c9a13ebdef0">MergeDiscriminativeExamples</a> (std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; *input, <a class="el" href="classbool.html">bool</a> compress, <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> *output)</td></tr>
<tr class="memdesc:afcc977fd1ccb4dd285c01c9a13ebdef0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Appends the given vector of examples (which must be non-empty) into a single output example.  <a href="#afcc977fd1ccb4dd285c01c9a13ebdef0">More...</a><br /></td></tr>
<tr class="separator:afcc977fd1ccb4dd285c01c9a13ebdef0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacd1505cb6a2a191d0e2cccdb57e90fa"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aacd1505cb6a2a191d0e2cccdb57e90fa">GetDiscriminativeNnetExampleSize</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &amp;a)</td></tr>
<tr class="memdesc:aacd1505cb6a2a191d0e2cccdb57e90fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the 'size' of a discriminative example as defined for purposes of merging egs, which is defined as the largest number of Indexes in any of the inputs or outputs of the example.  <a href="#aacd1505cb6a2a191d0e2cccdb57e90fa">More...</a><br /></td></tr>
<tr class="separator:aacd1505cb6a2a191d0e2cccdb57e90fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60b81dcaa89e17f1f362e45f559d734c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a60b81dcaa89e17f1f362e45f559d734c">UnitTestNnetExample</a> ()</td></tr>
<tr class="separator:a60b81dcaa89e17f1f362e45f559d734c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc5c658def484ea9be939487a4b60465"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#acc5c658def484ea9be939487a4b60465">UnitTestNnetMergeExamples</a> ()</td></tr>
<tr class="separator:acc5c658def484ea9be939487a4b60465"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f2093173e902d1445fcd80def82ea4b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2f2093173e902d1445fcd80def82ea4b">GetIoNames</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;src, std::vector&lt; std::string &gt; *names_vec)</td></tr>
<tr class="separator:a2f2093173e902d1445fcd80def82ea4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cffcda7d561b7a342c1e268364e7583"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a9cffcda7d561b7a342c1e268364e7583">GetIoSizes</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;src, const std::vector&lt; std::string &gt; &amp;names, std::vector&lt; int32 &gt; *sizes)</td></tr>
<tr class="separator:a9cffcda7d561b7a342c1e268364e7583"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1308684fa0a80a9163906b4cdbf0c04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af1308684fa0a80a9163906b4cdbf0c04">MergeIo</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;src, const std::vector&lt; std::string &gt; &amp;names, const std::vector&lt; int32 &gt; &amp;sizes, <a class="el" href="classbool.html">bool</a> compress, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *merged_eg)</td></tr>
<tr class="separator:af1308684fa0a80a9163906b4cdbf0c04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ceebc46ef1be292f6b2ff71cc1128ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee">MergeExamples</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;src, <a class="el" href="classbool.html">bool</a> compress, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *dest)</td></tr>
<tr class="memdesc:a4ceebc46ef1be292f6b2ff71cc1128ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Merge a set of input examples into a single example (typically the size of "src" will be the minibatch size).  <a href="#a4ceebc46ef1be292f6b2ff71cc1128ee">More...</a><br /></td></tr>
<tr class="separator:a4ceebc46ef1be292f6b2ff71cc1128ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a372bbe2bbd902e2f572a04d4c5e80f06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a372bbe2bbd902e2f572a04d4c5e80f06">ShiftExampleTimes</a> (int32 t_offset, const std::vector&lt; std::string &gt; &amp;exclude_names, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *eg)</td></tr>
<tr class="memdesc:a372bbe2bbd902e2f572a04d4c5e80f06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shifts the time-index t of everything in the "eg" by adding "t_offset" to all "t" values.  <a href="#a372bbe2bbd902e2f572a04d4c5e80f06">More...</a><br /></td></tr>
<tr class="separator:a372bbe2bbd902e2f572a04d4c5e80f06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66f879097cf9cba7482bad03a4030f72"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a66f879097cf9cba7482bad03a4030f72">GetComputationRequest</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;eg, <a class="el" href="classbool.html">bool</a> need_model_derivative, <a class="el" href="classbool.html">bool</a> store_component_stats, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *computation_request)</td></tr>
<tr class="memdesc:a66f879097cf9cba7482bad03a4030f72"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes a <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> (which should already have been frame-selected, if desired, and merged into a minibatch) and produces a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>.  <a href="#a66f879097cf9cba7482bad03a4030f72">More...</a><br /></td></tr>
<tr class="separator:a66f879097cf9cba7482bad03a4030f72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf96445e5bcabbb284bd6aa2340d553a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#acf96445e5bcabbb284bd6aa2340d553a">WriteVectorAsChar</a> (std::ostream &amp;os, <a class="el" href="classbool.html">bool</a> binary, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;vec)</td></tr>
<tr class="separator:acf96445e5bcabbb284bd6aa2340d553a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0cef9b2b234213283405e33de875310"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab0cef9b2b234213283405e33de875310">ReadVectorAsChar</a> (std::istream &amp;is, <a class="el" href="classbool.html">bool</a> binary, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *vec)</td></tr>
<tr class="separator:ab0cef9b2b234213283405e33de875310"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a764cf3de97d7029d256a28164142b89c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a764cf3de97d7029d256a28164142b89c">RoundUpNumFrames</a> (int32 frame_subsampling_factor, int32 *num_frames, int32 *num_frames_overlap)</td></tr>
<tr class="separator:a764cf3de97d7029d256a28164142b89c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc8032deb3521ad4396a277b8c098b54"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afc8032deb3521ad4396a277b8c098b54">GetNnetExampleSize</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;a)</td></tr>
<tr class="memdesc:afc8032deb3521ad4396a277b8c098b54"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the 'size' of a nnet-example as defined for purposes of merging egs, which is defined as the largest number of Indexes in any of the inputs or outputs of the example.  <a href="#afc8032deb3521ad4396a277b8c098b54">More...</a><br /></td></tr>
<tr class="separator:afc8032deb3521ad4396a277b8c098b54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8124e07bfb116ca78c0137eecf0f8a8"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af8124e07bfb116ca78c0137eecf0f8a8">CopyPairVector</a> (const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; <a class="el" href="structInt32Pair.html">Int32Pair</a> &gt; &amp;in, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *out)</td></tr>
<tr class="separator:af8124e07bfb116ca78c0137eecf0f8a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54bb6572c1c41a08dbadd1ec50d7876f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a54bb6572c1c41a08dbadd1ec50d7876f">CopyPairVector</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;in, <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; <a class="el" href="structInt32Pair.html">Int32Pair</a> &gt; *out)</td></tr>
<tr class="separator:a54bb6572c1c41a08dbadd1ec50d7876f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b9cf952746776c000ad16fcc9a9f990"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1b9cf952746776c000ad16fcc9a9f990">AssertGraphEqual</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph1, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph2)</td></tr>
<tr class="separator:a1b9cf952746776c000ad16fcc9a9f990"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60bde0a269254ed7c2471823ba362d75"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a60bde0a269254ed7c2471823ba362d75">AssertVectorEqual</a> (const std::vector&lt; int32 &gt; &amp;vec1, const std::vector&lt; int32 &gt; &amp;vec2)</td></tr>
<tr class="separator:a60bde0a269254ed7c2471823ba362d75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cf1ba5597d79505ed5fd378338740bb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2cf1ba5597d79505ed5fd378338740bb">BuildTestGraph</a> (std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</td></tr>
<tr class="separator:a2cf1ba5597d79505ed5fd378338740bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d0ace1de8245a113abc6674f184a19f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a0d0ace1de8245a113abc6674f184a19f">BuildTestGraphTranspose</a> (std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</td></tr>
<tr class="separator:a0d0ace1de8245a113abc6674f184a19f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0081c3d0993ad39f10df0eb4857188f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a0081c3d0993ad39f10df0eb4857188f5">BuildTestSccs</a> (std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</td></tr>
<tr class="separator:a0081c3d0993ad39f10df0eb4857188f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa97309456d46852962866b097697c6b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa97309456d46852962866b097697c6b7">BuildTestSccGraph</a> (std::vector&lt; std::vector&lt; int32 &gt; &gt; *scc_graph)</td></tr>
<tr class="separator:aa97309456d46852962866b097697c6b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a8af0bfaf3239fc5f740444edc92874"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1a8af0bfaf3239fc5f740444edc92874">BuildTestTopSortOrder</a> (std::vector&lt; int32 &gt; *node_to_order)</td></tr>
<tr class="separator:a1a8af0bfaf3239fc5f740444edc92874"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63c8dc97af58bac620a4754a6dcc49ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a63c8dc97af58bac620a4754a6dcc49ec">UnitTestComputeGraphTranspose</a> ()</td></tr>
<tr class="separator:a63c8dc97af58bac620a4754a6dcc49ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af092740ce1ecc4592e3d5c70425baf7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af092740ce1ecc4592e3d5c70425baf7b">UnitTestFindSccs</a> ()</td></tr>
<tr class="separator:af092740ce1ecc4592e3d5c70425baf7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8bfac0b4fadf2d70853d050f21bb2db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af8bfac0b4fadf2d70853d050f21bb2db">UnitTestMakeSccGraph</a> ()</td></tr>
<tr class="separator:af8bfac0b4fadf2d70853d050f21bb2db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09c05c0131617f375bfa70bc5a88ef6c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a09c05c0131617f375bfa70bc5a88ef6c">UnitTestComputeTopSortOrder</a> ()</td></tr>
<tr class="separator:a09c05c0131617f375bfa70bc5a88ef6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f3c9ebf01438c2d85581ad0ef35b0e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4f3c9ebf01438c2d85581ad0ef35b0e8">UnitTestComputeTopSortOrder2</a> ()</td></tr>
<tr class="separator:a4f3c9ebf01438c2d85581ad0ef35b0e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a679a6d66a5e4a3993124bc35597dd06b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a679a6d66a5e4a3993124bc35597dd06b">NnetToDirectedGraph</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</td></tr>
<tr class="memdesc:a679a6d66a5e4a3993124bc35597dd06b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes an nnet and turns it to a directed graph on nodes.  <a href="#a679a6d66a5e4a3993124bc35597dd06b">More...</a><br /></td></tr>
<tr class="separator:a679a6d66a5e4a3993124bc35597dd06b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4457943f315ab2e900b1f81606404f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac4457943f315ab2e900b1f81606404f8">ComputeGraphTranspose</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph_transpose)</td></tr>
<tr class="memdesc:ac4457943f315ab2e900b1f81606404f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Outputs a graph in which the order of arcs is reversed.  <a href="#ac4457943f315ab2e900b1f81606404f8">More...</a><br /></td></tr>
<tr class="separator:ac4457943f315ab2e900b1f81606404f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a145f09473f55df6f338ac4d69cff8bf1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a145f09473f55df6f338ac4d69cff8bf1">TarjanSccRecursive</a> (int32 node, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, int32 *global_index, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1TarjanNode.html">TarjanNode</a> &gt; *tarjan_nodes, std::vector&lt; int32 &gt; *tarjan_stack, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</td></tr>
<tr class="separator:a145f09473f55df6f338ac4d69cff8bf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee48ed6add62e6cef7918e3f6a94ffc7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aee48ed6add62e6cef7918e3f6a94ffc7">FindSccsTarjan</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</td></tr>
<tr class="separator:aee48ed6add62e6cef7918e3f6a94ffc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae72c79fbb6ec81b69aaee02701fa23e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae72c79fbb6ec81b69aaee02701fa23e5">FindSccs</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</td></tr>
<tr class="memdesc:ae72c79fbb6ec81b69aaee02701fa23e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a directed graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming from the current node), partition it into strongly connected components (i.e.  <a href="#ae72c79fbb6ec81b69aaee02701fa23e5">More...</a><br /></td></tr>
<tr class="separator:ae72c79fbb6ec81b69aaee02701fa23e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9efe2804eba8c2da73af3aa4eff4a2fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a9efe2804eba8c2da73af3aa4eff4a2fc">MakeSccGraph</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;sccs, std::vector&lt; std::vector&lt; int32 &gt; &gt; *scc_graph)</td></tr>
<tr class="memdesc:a9efe2804eba8c2da73af3aa4eff4a2fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a list of sccs of a graph (e.g.  <a href="#a9efe2804eba8c2da73af3aa4eff4a2fc">More...</a><br /></td></tr>
<tr class="separator:a9efe2804eba8c2da73af3aa4eff4a2fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76f6120092b06acc2556c7b9e40c990e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a76f6120092b06acc2556c7b9e40c990e">ComputeTopSortOrderRecursive</a> (int32 node, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; *cycle_detector, std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; *is_visited, std::vector&lt; int32 &gt; *reversed_orders)</td></tr>
<tr class="separator:a76f6120092b06acc2556c7b9e40c990e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4c2ac8a9e96d220776910b2a9ae2971"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae4c2ac8a9e96d220776910b2a9ae2971">ComputeTopSortOrder</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; int32 &gt; *node_to_order)</td></tr>
<tr class="memdesc:ae4c2ac8a9e96d220776910b2a9ae2971"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given an acyclic graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming from the current node), compute a topological ordering of the graph nodes.  <a href="#ae4c2ac8a9e96d220776910b2a9ae2971">More...</a><br /></td></tr>
<tr class="separator:ae4c2ac8a9e96d220776910b2a9ae2971"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a794312260c52d2eb93f30302ee0a7173"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a794312260c52d2eb93f30302ee0a7173">PrintGraphToString</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph)</td></tr>
<tr class="memdesc:a794312260c52d2eb93f30302ee0a7173"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints a graph to a string in a pretty way for human readability, e.g.  <a href="#a794312260c52d2eb93f30302ee0a7173">More...</a><br /></td></tr>
<tr class="separator:a794312260c52d2eb93f30302ee0a7173"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a380175b61aef188f214827ad6c2faca2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a380175b61aef188f214827ad6c2faca2">ComputeNnetComputationEpochs</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, std::vector&lt; int32 &gt; *node_to_epoch)</td></tr>
<tr class="memdesc:a380175b61aef188f214827ad6c2faca2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function computes the order in which we need to compute each node in the graph, where each node-index n maps to an epoch-index t = 0, 1, ...  <a href="#a380175b61aef188f214827ad6c2faca2">More...</a><br /></td></tr>
<tr class="separator:a380175b61aef188f214827ad6c2faca2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f107ff3c34b1e2522a1754d9581de0d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6f107ff3c34b1e2522a1754d9581de0d">GraphHasCycles</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph)</td></tr>
<tr class="memdesc:a6f107ff3c34b1e2522a1754d9581de0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns 'true' if the graph represented in 'graph' contains cycles (including cycles where a single node has an arc to itself).  <a href="#a6f107ff3c34b1e2522a1754d9581de0d">More...</a><br /></td></tr>
<tr class="separator:a6f107ff3c34b1e2522a1754d9581de0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b4b0e8d73b17875e8bc5cc492e79b71"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2b4b0e8d73b17875e8bc5cc492e79b71">UnitTestNnetIo</a> ()</td></tr>
<tr class="separator:a2b4b0e8d73b17875e8bc5cc492e79b71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8871c28ddb5af8735abd397019ba409d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a> (int32 srand_seed, <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> opt_config, <a class="el" href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">CachingOptimizingCompilerOptions</a> compiler_config)</td></tr>
<tr class="separator:a8871c28ddb5af8735abd397019ba409d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838307c42c116ba041c7df5f051f3fb9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a838307c42c116ba041c7df5f051f3fb9">UnitTestNnetOptimizeInternal</a> (int32 srand_seed)</td></tr>
<tr class="separator:a838307c42c116ba041c7df5f051f3fb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d3983f63fe3e84e488bc3e27a67e540"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a0d3983f63fe3e84e488bc3e27a67e540">UnitTestNnetOptimize</a> ()</td></tr>
<tr class="separator:a0d3983f63fe3e84e488bc3e27a67e540"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec833031232462f45b425a8a5503489"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2ec833031232462f45b425a8a5503489">IdentifySubmatrixArgs</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *command, std::vector&lt; int32 * &gt; *submatrix_args)</td></tr>
<tr class="memdesc:a2ec833031232462f45b425a8a5503489"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function outputs to "submatrix_args" the addresses of a subset of arguments arg1 through arg6 in "command", that correspond to the indexes of submatrices.  <a href="#a2ec833031232462f45b425a8a5503489">More...</a><br /></td></tr>
<tr class="separator:a2ec833031232462f45b425a8a5503489"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac8664deabb618f4c3dc3d99d8462ea1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aac8664deabb618f4c3dc3d99d8462ea1">IdentifySubmatrixArgs</a> (std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *commands, std::vector&lt; int32 * &gt; *submatrix_args)</td></tr>
<tr class="memdesc:aac8664deabb618f4c3dc3d99d8462ea1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function outputs to "submatrix_args" the addresses of the args (arguments arg1 through arg6) in the vector "commands", that correspond to the indexes of submatrices.  <a href="#aac8664deabb618f4c3dc3d99d8462ea1">More...</a><br /></td></tr>
<tr class="separator:aac8664deabb618f4c3dc3d99d8462ea1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8592f4c16a6a1b36c06dccda5511316"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae8592f4c16a6a1b36c06dccda5511316">IdentifyMatrixArgsInComputation</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation, std::vector&lt; int32 *&gt; *matrix_args)</td></tr>
<tr class="separator:ae8592f4c16a6a1b36c06dccda5511316"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af96b480d0b6d2b5890e1490f8c2e6ac0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af96b480d0b6d2b5890e1490f8c2e6ac0">IdentifyIndexesMultiArgs</a> (std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *commands, std::vector&lt; int32 * &gt; *indexes_multi_args)</td></tr>
<tr class="memdesc:af96b480d0b6d2b5890e1490f8c2e6ac0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Identifies in the vector of commands, arguments that correspond to indexes into the computation's indexes_multi array, and outputs a list of pointers to those arguments to 'indexes_multi_args'.  <a href="#af96b480d0b6d2b5890e1490f8c2e6ac0">More...</a><br /></td></tr>
<tr class="separator:af96b480d0b6d2b5890e1490f8c2e6ac0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17acd598bf1ced7e83e0c8a8569d224f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a17acd598bf1ced7e83e0c8a8569d224f">IdentifyIndexesRangesArgs</a> (std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *commands, std::vector&lt; int32 * &gt; *indexes_ranges_args)</td></tr>
<tr class="memdesc:a17acd598bf1ced7e83e0c8a8569d224f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Identifies in the vector of commands, arguments that correspond to indexes into the computation's 'indexes_ranges' array, and outputs a list of pointers to those arguments to 'indexes_ranges_args'.  <a href="#a17acd598bf1ced7e83e0c8a8569d224f">More...</a><br /></td></tr>
<tr class="separator:a17acd598bf1ced7e83e0c8a8569d224f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6950699c83d835e55f003f89bb92bc80"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6950699c83d835e55f003f89bb92bc80">IdentifyIndexesArgs</a> (std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *commands, std::vector&lt; int32 * &gt; *indexes_args)</td></tr>
<tr class="memdesc:a6950699c83d835e55f003f89bb92bc80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Identifies in the vector of commands, arguments that correspond to indexes into the computation's 'indexes' array, and outputs a list of pointers to those arguments to 'indexes_args'.  <a href="#a6950699c83d835e55f003f89bb92bc80">More...</a><br /></td></tr>
<tr class="separator:a6950699c83d835e55f003f89bb92bc80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af87da4e8a0e1880438bf77e8a34b4143"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af87da4e8a0e1880438bf77e8a34b4143">IdentifySubmatrixArgsInComputation</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation, std::vector&lt; int32 * &gt; *submatrix_args)</td></tr>
<tr class="memdesc:af87da4e8a0e1880438bf77e8a34b4143"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function outputs to "submatrix_args" the addresses of integers in 'computation' that correspond to submatrices.  <a href="#af87da4e8a0e1880438bf77e8a34b4143">More...</a><br /></td></tr>
<tr class="separator:af87da4e8a0e1880438bf77e8a34b4143"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6828e427bd8883455705e0c9b99b5f2f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">RenumberComputation</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a6828e427bd8883455705e0c9b99b5f2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function detects submatrices and matrices that are never used (e.g.  <a href="#a6828e427bd8883455705e0c9b99b5f2f">More...</a><br /></td></tr>
<tr class="separator:a6828e427bd8883455705e0c9b99b5f2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3ebe9f7e8bfc061d7582b3964698e4e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae3ebe9f7e8bfc061d7582b3964698e4e">IsNoop</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;command)</td></tr>
<tr class="separator:ae3ebe9f7e8bfc061d7582b3964698e4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1146f4efa141a56210f9dbf1090b20f0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">RemoveNoOps</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a1146f4efa141a56210f9dbf1090b20f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes commands of type kNoOperation in the computation.  <a href="#a1146f4efa141a56210f9dbf1090b20f0">More...</a><br /></td></tr>
<tr class="separator:a1146f4efa141a56210f9dbf1090b20f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86704308a1467b6000867cc9ed198482"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1SubMatrixInfo.html">NnetComputation::SubMatrixInfo</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a86704308a1467b6000867cc9ed198482">GetSubMatrixOfSubMatrix</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, int32 submat_a, int32 submat_b)</td></tr>
<tr class="memdesc:a86704308a1467b6000867cc9ed198482"><td class="mdescLeft">&#160;</td><td class="mdescRight">This static function returns a SubMatrixInfo corresponding to replacing the matrix-index in a's "matrix_index" with, essentially, sub-matrix b.  <a href="#a86704308a1467b6000867cc9ed198482">More...</a><br /></td></tr>
<tr class="separator:a86704308a1467b6000867cc9ed198482"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1adea5ddcf5f2d26ee01d796ec13510c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1adea5ddcf5f2d26ee01d796ec13510c">ExtendMatrices</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a1adea5ddcf5f2d26ee01d796ec13510c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is not really an optimization in itself but it can make things easier for class <a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html" title="This class is responsible for merging matrices, although you probably want to access it via the the f...">VariableMergingOptimizer</a> (usually called by its wrapper <a class="el" href="namespacekaldi_1_1nnet3.html#a7918fc2d6dfa22dbc84913c63be8771b" title="This wraps class VariableMergingOptimizer in a simplified interface. ">VariableMergingOptimization()</a>).  <a href="#a1adea5ddcf5f2d26ee01d796ec13510c">More...</a><br /></td></tr>
<tr class="separator:a1adea5ddcf5f2d26ee01d796ec13510c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af512f7de6c401fbdf7013d62295df9c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af512f7de6c401fbdf7013d62295df9c2">ConsolidateModelUpdate</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:af512f7de6c401fbdf7013d62295df9c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This optimization consolidates the model-update part of backprop commands, for components in (e.g.) recurrent networks that need to have many separate backprop commands, into more efficient single commands operating on consolidated data in larger matrices.  <a href="#af512f7de6c401fbdf7013d62295df9c2">More...</a><br /></td></tr>
<tr class="separator:af512f7de6c401fbdf7013d62295df9c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ed9b871bd28649b80165dc1af5d1a98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6ed9b871bd28649b80165dc1af5d1a98">LimitDerivativeTimes</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 min_deriv_time, int32 max_deriv_time, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:a6ed9b871bd28649b80165dc1af5d1a98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68068a73dabd55faade8d658a56f277b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a68068a73dabd55faade8d658a56f277b">IndexesHaveSpecialStructure</a> (const std::vector&lt; int32 &gt; &amp;indexes, int32 *first_nonnegative_pos, int32 *first_nonnegative_value, int32 *num_nonnegative_indexes)</td></tr>
<tr class="separator:a68068a73dabd55faade8d658a56f277b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a281a103d9beaef2e5d64370754800cd1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a281a103d9beaef2e5d64370754800cd1">ReplaceRowWithMatrixOps</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a281a103d9beaef2e5d64370754800cd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function detects cases where commands of type kCopyRows, kAddRows or kAddToRows can be converted to commands of type kMatrixCopy or kMatrixAdd, and converts them (this may involve adding submatrices).  <a href="#a281a103d9beaef2e5d64370754800cd1">More...</a><br /></td></tr>
<tr class="separator:a281a103d9beaef2e5d64370754800cd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba9b56c9f5c5545ab2ab957cec8c56cc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aba9b56c9f5c5545ab2ab957cec8c56cc">FindNumLeadingAndTrailingNegatives</a> (const std::vector&lt; int32 &gt; &amp;vec, int32 *num_leading_negatives, int32 *num_trailing_negatives)</td></tr>
<tr class="separator:aba9b56c9f5c5545ab2ab957cec8c56cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59e6e35ab79257514b799d2ebe48ed20"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a59e6e35ab79257514b799d2ebe48ed20">SnipSingleRowOp</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation, int32 command_index)</td></tr>
<tr class="separator:a59e6e35ab79257514b799d2ebe48ed20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbf4a43da0663edcee53e2942e53ae2e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abbf4a43da0663edcee53e2942e53ae2e">FindNumLeadingAndTrailingNegatives</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;vec, int32 *num_leading_negatives, int32 *num_trailing_negatives)</td></tr>
<tr class="separator:abbf4a43da0663edcee53e2942e53ae2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8b9a053089365f8c8d0f3e5436d66a4"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af8b9a053089365f8c8d0f3e5436d66a4">SnipMultiRowOp</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation, int32 command_index)</td></tr>
<tr class="separator:af8b9a053089365f8c8d0f3e5436d66a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd9243d8740392f619af25f0653afa9e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abd9243d8740392f619af25f0653afa9e">FindNumLeadingAndTrailingIdenticals</a> (const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;vec, int32 *num_leading_identicals, int32 *num_trailing_identicals)</td></tr>
<tr class="separator:abd9243d8740392f619af25f0653afa9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c29cb7ac7e40e18309451b6f8a193bd"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3c29cb7ac7e40e18309451b6f8a193bd">SnipRangesRowOp</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation, int32 command_index)</td></tr>
<tr class="separator:a3c29cb7ac7e40e18309451b6f8a193bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a590c38bb0c9acc4ad1f626237f1a4169"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a590c38bb0c9acc4ad1f626237f1a4169">SnipRowOps</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a590c38bb0c9acc4ad1f626237f1a4169"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function detects cases where commands of type kCopyRows, kAddRows, kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti or kAddRowRanges use indexes that start or end with -1's or equivalents, and replace them with similar commands that act on a sub-matrix of the matrices they are currently acting on.  <a href="#a590c38bb0c9acc4ad1f626237f1a4169">More...</a><br /></td></tr>
<tr class="separator:a590c38bb0c9acc4ad1f626237f1a4169"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd48d2ca65dc0a73952effbec24ccfb1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#acd48d2ca65dc0a73952effbec24ccfb1">SplitRowOps</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:acd48d2ca65dc0a73952effbec24ccfb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function detects cases where commands of type kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti use indexes that correspond to at most two submatrices, in two distinct ranges without gaps filled by -1's, and could be converted to at most two commands of type kMatrixAdd, kMatrixCopy, kAddRows or kCopyRows.  <a href="#acd48d2ca65dc0a73952effbec24ccfb1">More...</a><br /></td></tr>
<tr class="separator:acd48d2ca65dc0a73952effbec24ccfb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79122735e3f124a6865ff339f40ec191"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a79122735e3f124a6865ff339f40ec191">FindNStride</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes, <a class="el" href="classbool.html">bool</a> full_check)</td></tr>
<tr class="separator:a79122735e3f124a6865ff339f40ec191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4426490c64581d8189bf8c671e5a893"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af4426490c64581d8189bf8c671e5a893">FindNStride</a> (const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;cindexes, <a class="el" href="classbool.html">bool</a> full_check)</td></tr>
<tr class="separator:af4426490c64581d8189bf8c671e5a893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1bed82d2cb5fbdc695bf32053117ad"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4a1bed82d2cb5fbdc695bf32053117ad">ConvertNumNValues</a> (int32 n_stride, int32 old_N, int32 new_N, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes_in, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *indexes_out)</td></tr>
<tr class="separator:a4a1bed82d2cb5fbdc695bf32053117ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8007bfceb176a3f8f7f3efb765c9062"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af8007bfceb176a3f8f7f3efb765c9062">ExpandComputation</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> &amp;misc_info, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, <a class="el" href="classbool.html">bool</a> need_debug_info, int32 num_n_values, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *expanded_computation)</td></tr>
<tr class="memdesc:af8007bfceb176a3f8f7f3efb765c9062"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used in 'shortcut' compilation to expand a computation that has been compiled for exactly 2 'n' values, to one that is suitable for some num_n_values &gt; 2.  <a href="#af8007bfceb176a3f8f7f3efb765c9062">More...</a><br /></td></tr>
<tr class="separator:af8007bfceb176a3f8f7f3efb765c9062"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d88467d1a24ad6a2b21d4b8923615ca"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4d88467d1a24ad6a2b21d4b8923615ca">IoSpecificationIsDecomposable</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a> &amp;io_spec, <a class="el" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a> *mini_io_spec, int32 *num_n_values_out)</td></tr>
<tr class="separator:a4d88467d1a24ad6a2b21d4b8923615ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54a0b9eb6a79c232605aa83476d44bb0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a54a0b9eb6a79c232605aa83476d44bb0">RequestIsDecomposable</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *mini_request, int32 *num_n_values)</td></tr>
<tr class="memdesc:a54a0b9eb6a79c232605aa83476d44bb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function, used in 'shortcut' compilation where we first compile a smaller computation with the same structure but only 2 distinct 'n' values, works out whether a computation is 'decomposable'; if so, it returns true and outputs the 'mini_request' with the same structure, and the number of 'n' values.  <a href="#a54a0b9eb6a79c232605aa83476d44bb0">More...</a><br /></td></tr>
<tr class="separator:a54a0b9eb6a79c232605aa83476d44bb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb347167ff71d1cd8a2ab35b6eb2f636"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#abb347167ff71d1cd8a2ab35b6eb2f636">OptimizeLoopedComputation</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:abb347167ff71d1cd8a2ab35b6eb2f636"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function tries to optimize computation 'computation' for an 'looped' computation.  <a href="#abb347167ff71d1cd8a2ab35b6eb2f636">More...</a><br /></td></tr>
<tr class="separator:abb347167ff71d1cd8a2ab35b6eb2f636"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8953a6af8e449d7cc12efeb115c5f8d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">FixGotoLabel</a> (<a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a8953a6af8e449d7cc12efeb115c5f8d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function ensures that the arg1 of a final command of type kGotoLabel is the same as the command with type kNoOperationLabel.  <a href="#a8953a6af8e449d7cc12efeb115c5f8d2">More...</a><br /></td></tr>
<tr class="separator:a8953a6af8e449d7cc12efeb115c5f8d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac879380727c26962a7aaa4a6de9dc4d4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac879380727c26962a7aaa4a6de9dc4d4">MatrixIsUnused</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;analyzer, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, int32 m)</td></tr>
<tr class="memdesc:ac879380727c26962a7aaa4a6de9dc4d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns true if matrix 1 &lt;= m &lt; computation-&gt;matrices.size() is unused, defined as: it is not an input or an output, and is not accessed other than via commands of type kAllocMatrix, kDeallocMatrix, and kSetConst.  <a href="#ac879380727c26962a7aaa4a6de9dc4d4">More...</a><br /></td></tr>
<tr class="separator:ac879380727c26962a7aaa4a6de9dc4d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af53fca33c55f05968eab8ec1009509e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af53fca33c55f05968eab8ec1009509e6">RemoveCommandsForUnusedMatrix</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;analyzer, int32 m, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:af53fca33c55f05968eab8ec1009509e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function removes from 'computation' the commands accessing matrix 'm', which is assumed to be unused according to the <a class="el" href="namespacekaldi_1_1nnet3.html#ac879380727c26962a7aaa4a6de9dc4d4" title="This function returns true if matrix 1 &lt;= m &lt; computation-&gt;matrices.size() is unused, defined as: it is not an input or an output, and is not accessed other than via commands of type kAllocMatrix, kDeallocMatrix, and kSetConst. ">MatrixIsUnused()</a> command above.  <a href="#af53fca33c55f05968eab8ec1009509e6">More...</a><br /></td></tr>
<tr class="separator:af53fca33c55f05968eab8ec1009509e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cc731e05d6603b7d4d0191f9f1c9d32"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a0cc731e05d6603b7d4d0191f9f1c9d32">InsertCommands</a> (std::vector&lt; std::pair&lt; int32, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; &gt; *commands, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a0cc731e05d6603b7d4d0191f9f1c9d32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inserts commands into the computation at the requested places.  <a href="#a0cc731e05d6603b7d4d0191f9f1c9d32">More...</a><br /></td></tr>
<tr class="separator:a0cc731e05d6603b7d4d0191f9f1c9d32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10b449e04f7115cc85d295440638fade"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade">OptimizeMemoryCompression</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 memory_compression_level, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a10b449e04f7115cc85d295440638fade"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs optimization to reduce memory usage where possible, making use of the kCompressMatrix and kDecompressMatrix commands.  <a href="#a10b449e04f7115cc85d295440638fade">More...</a><br /></td></tr>
<tr class="separator:a10b449e04f7115cc85d295440638fade"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac580549257041c725612ff223c99e43c"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">MaxOutputTimeInRequest</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request)</td></tr>
<tr class="separator:ac580549257041c725612ff223c99e43c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20e1e086f75487fe19752fd2b34ca627"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a20e1e086f75487fe19752fd2b34ca627">MoveSizingCommands</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a20e1e086f75487fe19752fd2b34ca627"><td class="mdescLeft">&#160;</td><td class="mdescRight">This optimization moves commands that allocate and zero matrices to as late as possible, and moves commands that deallocate matrices to as early as possible.  <a href="#a20e1e086f75487fe19752fd2b34ca627">More...</a><br /></td></tr>
<tr class="separator:a20e1e086f75487fe19752fd2b34ca627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae053839b5ed781f2f7408489a1528dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd">RemoveUnnecessaryZeroing</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:aae053839b5ed781f2f7408489a1528dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This optimization function removes, where possible, commands of type type kSetConst.  <a href="#aae053839b5ed781f2f7408489a1528dd">More...</a><br /></td></tr>
<tr class="separator:aae053839b5ed781f2f7408489a1528dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4874b04bb051028a1b6cb08cff2d1994"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4874b04bb051028a1b6cb08cff2d1994">ComputeCommandPairs</a> (const std::pair&lt; std::vector&lt; int32 &gt;, std::vector&lt; int32 &gt; &gt; &amp;lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *pairs)</td></tr>
<tr class="separator:a4874b04bb051028a1b6cb08cff2d1994"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92c251003c3f612c5cfbcbd72cbd030b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a92c251003c3f612c5cfbcbd72cbd030b">RemoveUnnecessaryAllocation</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a92c251003c3f612c5cfbcbd72cbd030b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This optimization detects cases where we deallocate a matrix, and then later allocate another matrix of the same size; and replaces them with commands of type kAllocFromOther or kAllocFromOtherZeroed.  <a href="#a92c251003c3f612c5cfbcbd72cbd030b">More...</a><br /></td></tr>
<tr class="separator:a92c251003c3f612c5cfbcbd72cbd030b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7918fc2d6dfa22dbc84913c63be8771b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7918fc2d6dfa22dbc84913c63be8771b">VariableMergingOptimization</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;config, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a7918fc2d6dfa22dbc84913c63be8771b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This wraps class <a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html" title="This class is responsible for merging matrices, although you probably want to access it via the the f...">VariableMergingOptimizer</a> in a simplified interface.  <a href="#a7918fc2d6dfa22dbc84913c63be8771b">More...</a><br /></td></tr>
<tr class="separator:a7918fc2d6dfa22dbc84913c63be8771b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac759ea60772df625784bcc714f7a41da"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac759ea60772df625784bcc714f7a41da">ConvertAdditionToAssignment</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:ac759ea60772df625784bcc714f7a41da"><td class="mdescLeft">&#160;</td><td class="mdescRight">This converts addition operations (things with Add in their names) to copy operations (things with Copy in their names).  <a href="#ac759ea60772df625784bcc714f7a41da">More...</a><br /></td></tr>
<tr class="separator:ac759ea60772df625784bcc714f7a41da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a602819d33d3a59c128aa4e865e610e14"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14">Optimize</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;config, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 max_output_time_in_request, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:a602819d33d3a59c128aa4e865e610e14"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the top-level function for optimizing a computation.  <a href="#a602819d33d3a59c128aa4e865e610e14">More...</a><br /></td></tr>
<tr class="separator:a602819d33d3a59c128aa4e865e610e14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad12ff98370e4200e533b92aa369444bf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ad12ff98370e4200e533b92aa369444bf">SplitComputationIntoSegments</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *segments)</td></tr>
<tr class="memdesc:ad12ff98370e4200e533b92aa369444bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Split the computation up into segments bounded by kNoOperationMarker.  <a href="#ad12ff98370e4200e533b92aa369444bf">More...</a><br /></td></tr>
<tr class="separator:ad12ff98370e4200e533b92aa369444bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6233bfcefa3af15d41a8e565911a249"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa6233bfcefa3af15d41a8e565911a249">ConsolidateIoOperations</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:aa6233bfcefa3af15d41a8e565911a249"><td class="mdescLeft">&#160;</td><td class="mdescRight">This optimization puts the input operations (kAcceptInput) and output operations (kProvideOutput) at the very beginning or end of segments of computation, respectively.  <a href="#aa6233bfcefa3af15d41a8e565911a249">More...</a><br /></td></tr>
<tr class="separator:aa6233bfcefa3af15d41a8e565911a249"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbc06e3c26b68f19c01aad13eeb95205"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#adbc06e3c26b68f19c01aad13eeb95205">LimitDerivativeTimes</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;opts, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="memdesc:adbc06e3c26b68f19c01aad13eeb95205"><td class="mdescLeft">&#160;</td><td class="mdescRight">This optimization, which has no effect unless you set &ndash;min-deriv-time or &ndash;max-deriv-time, modifies the backprop operations for efficiency based on the assumption that derivatives for any Cindex with t &lt; min_deriv_time or t &gt; max_deriv_time are zero.  <a href="#adbc06e3c26b68f19c01aad13eeb95205">More...</a><br /></td></tr>
<tr class="separator:adbc06e3c26b68f19c01aad13eeb95205"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a013e6098460707cee578712638ce37dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a013e6098460707cee578712638ce37dd">UnitTestConfigLineParse</a> ()</td></tr>
<tr class="separator:a013e6098460707cee578712638ce37dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad179bd30fedc76b302f19fb2cb1e6a60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ad179bd30fedc76b302f19fb2cb1e6a60">UnitTestReadConfig</a> ()</td></tr>
<tr class="separator:ad179bd30fedc76b302f19fb2cb1e6a60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac447841fa736f8af0f8c64e8cd415644"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac447841fa736f8af0f8c64e8cd415644">UnitTestDescriptorTokenize</a> ()</td></tr>
<tr class="separator:ac447841fa736f8af0f8c64e8cd415644"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a7353c9f73e07a4f64149e67d737482"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1a7353c9f73e07a4f64149e67d737482">UnitTestSummarizeVector</a> ()</td></tr>
<tr class="separator:a1a7353c9f73e07a4f64149e67d737482"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a820ea34d40d78ff98f9800e7e4de45d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a820ea34d40d78ff98f9800e7e4de45d4">UnitTestNameMatchesPattern</a> ()</td></tr>
<tr class="separator:a820ea34d40d78ff98f9800e7e4de45d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9d34dcbb48b22bb0c34f699721b33bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac9d34dcbb48b22bb0c34f699721b33bc">ExpectOneOrTwoTokens</a> (std::istream &amp;is, <a class="el" href="classbool.html">bool</a> binary, const std::string &amp;token1, const std::string &amp;token2)</td></tr>
<tr class="memdesc:ac9d34dcbb48b22bb0c34f699721b33bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is like ExpectToken but for two tokens, and it will either accept token1 and then token2, or just token2.  <a href="#ac9d34dcbb48b22bb0c34f699721b33bc">More...</a><br /></td></tr>
<tr class="separator:ac9d34dcbb48b22bb0c34f699721b33bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e18825b4c5b0834e638296b2f5bb35a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a> (const std::string &amp;name, std::string *string, int32 *param)</td></tr>
<tr class="memdesc:a0e18825b4c5b0834e638296b2f5bb35a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function used in Init routines.  <a href="#a0e18825b4c5b0834e638296b2f5bb35a">More...</a><br /></td></tr>
<tr class="separator:a0e18825b4c5b0834e638296b2f5bb35a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c170854db9a3b5bb3915dfb52380c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a06c170854db9a3b5bb3915dfb52380c2">ParseFromString</a> (const std::string &amp;name, std::string *string, <a class="el" href="classbool.html">bool</a> *param)</td></tr>
<tr class="memdesc:a06c170854db9a3b5bb3915dfb52380c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of ParseFromString is for parameters of type bool, which can appear as any string beginning with f, F, t or T.  <a href="#a06c170854db9a3b5bb3915dfb52380c2">More...</a><br /></td></tr>
<tr class="separator:a06c170854db9a3b5bb3915dfb52380c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eac951c4af19775f3ba550efa12f385"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7eac951c4af19775f3ba550efa12f385">ParseFromString</a> (const std::string &amp;name, std::string *string, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *param)</td></tr>
<tr class="memdesc:a7eac951c4af19775f3ba550efa12f385"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of ParseFromString is for parameters of type BaseFloat.  <a href="#a7eac951c4af19775f3ba550efa12f385">More...</a><br /></td></tr>
<tr class="separator:a7eac951c4af19775f3ba550efa12f385"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd5f31afe3e5137b700d0af4fbb13211"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afd5f31afe3e5137b700d0af4fbb13211">ParseFromString</a> (const std::string &amp;name, std::string *string, std::string *param)</td></tr>
<tr class="memdesc:afd5f31afe3e5137b700d0af4fbb13211"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of ParseFromString is for parsing strings.  <a href="#afd5f31afe3e5137b700d0af4fbb13211">More...</a><br /></td></tr>
<tr class="separator:afd5f31afe3e5137b700d0af4fbb13211"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f7f50f1457000af31efe2ecd53f983a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7f7f50f1457000af31efe2ecd53f983a">ParseFromString</a> (const std::string &amp;name, std::string *string, std::vector&lt; int32 &gt; *param)</td></tr>
<tr class="memdesc:a7f7f50f1457000af31efe2ecd53f983a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of ParseFromString handles colon-separated or comma-separated lists of integers.  <a href="#a7f7f50f1457000af31efe2ecd53f983a">More...</a><br /></td></tr>
<tr class="separator:a7f7f50f1457000af31efe2ecd53f983a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6b64008b19bbb6e8769769cbf96fa68"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a> (const std::string &amp;input, std::vector&lt; std::string &gt; *tokens)</td></tr>
<tr class="memdesc:ac6b64008b19bbb6e8769769cbf96fa68"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function tokenizes input when parsing <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> configuration values.  <a href="#ac6b64008b19bbb6e8769769cbf96fa68">More...</a><br /></td></tr>
<tr class="separator:ac6b64008b19bbb6e8769769cbf96fa68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30e2d3a7507084b838f420b5e10b37f9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a30e2d3a7507084b838f420b5e10b37f9">IsValidName</a> (const std::string &amp;name)</td></tr>
<tr class="memdesc:a30e2d3a7507084b838f420b5e10b37f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if 'name' would be a valid name for a component or node in a <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a>.  <a href="#a30e2d3a7507084b838f420b5e10b37f9">More...</a><br /></td></tr>
<tr class="separator:a30e2d3a7507084b838f420b5e10b37f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a331cfb436079c33852b5514e6691f6be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a331cfb436079c33852b5514e6691f6be">ReadConfigLines</a> (std::istream &amp;is, std::vector&lt; std::string &gt; *lines)</td></tr>
<tr class="memdesc:a331cfb436079c33852b5514e6691f6be"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reads in a config file and *appends* its contents to a vector of lines; it is responsible for removing comments (anything after '#') and stripping out any lines that contain only whitespace after comment removal.  <a href="#a331cfb436079c33852b5514e6691f6be">More...</a><br /></td></tr>
<tr class="separator:a331cfb436079c33852b5514e6691f6be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c1330ecd1ee31afb2214977a2a88e10"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4c1330ecd1ee31afb2214977a2a88e10">ErrorContext</a> (std::istream &amp;is)</td></tr>
<tr class="memdesc:a4c1330ecd1ee31afb2214977a2a88e10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a string used in error messages.  <a href="#a4c1330ecd1ee31afb2214977a2a88e10">More...</a><br /></td></tr>
<tr class="separator:a4c1330ecd1ee31afb2214977a2a88e10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2904394bf025a2757bd2ab32f2caea36"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2904394bf025a2757bd2ab32f2caea36">ErrorContext</a> (const std::string &amp;str)</td></tr>
<tr class="separator:a2904394bf025a2757bd2ab32f2caea36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55b3c5fd7a70b59070dfec3be993ff80"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a55b3c5fd7a70b59070dfec3be993ff80">PrintFloatSuccinctly</a> (std::ostream &amp;os, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> f)</td></tr>
<tr class="separator:a55b3c5fd7a70b59070dfec3be993ff80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2468421b230db50c66c8d40975205c3"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab2468421b230db50c66c8d40975205c3">SummarizeVector</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;vec)</td></tr>
<tr class="memdesc:ab2468421b230db50c66c8d40975205c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a string that summarizes a vector fairly succintly, for printing stats in info lines.  <a href="#ab2468421b230db50c66c8d40975205c3">More...</a><br /></td></tr>
<tr class="separator:ab2468421b230db50c66c8d40975205c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a999cb66904d782669117981b27dffa21"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a999cb66904d782669117981b27dffa21">SummarizeVector</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; double &gt; &amp;vec)</td></tr>
<tr class="separator:a999cb66904d782669117981b27dffa21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f8b12eaddd9c81766f37c1bdea637ca"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">SummarizeVector</a> (const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;cu_vec)</td></tr>
<tr class="separator:a6f8b12eaddd9c81766f37c1bdea637ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34aff1eb4a29f66dee3a093eed6db9fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a34aff1eb4a29f66dee3a093eed6db9fa">PrintParameterStats</a> (std::ostringstream &amp;os, const std::string &amp;name, const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params, <a class="el" href="classbool.html">bool</a> include_mean=false)</td></tr>
<tr class="memdesc:a34aff1eb4a29f66dee3a093eed6db9fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print to 'os' some information about the mean and standard deviation of some parameters, used in Info() functions in <a class="el" href="nnet-simple-component_8cc.html">nnet-simple-component.cc</a>.  <a href="#a34aff1eb4a29f66dee3a093eed6db9fa">More...</a><br /></td></tr>
<tr class="separator:a34aff1eb4a29f66dee3a093eed6db9fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a805df9186e7287ba645a159d9566a315"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a805df9186e7287ba645a159d9566a315">PrintParameterStats</a> (std::ostringstream &amp;os, const std::string &amp;name, const <a class="el" href="classkaldi_1_1CuMatrix.html">CuMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params, <a class="el" href="classbool.html">bool</a> include_mean=false, <a class="el" href="classbool.html">bool</a> include_row_norms=false, <a class="el" href="classbool.html">bool</a> include_column_norms=false, <a class="el" href="classbool.html">bool</a> include_singular_values=false)</td></tr>
<tr class="memdesc:a805df9186e7287ba645a159d9566a315"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print to 'os' some information about the mean and standard deviation of some parameters, used in Info() functions in <a class="el" href="nnet-simple-component_8cc.html">nnet-simple-component.cc</a>.  <a href="#a805df9186e7287ba645a159d9566a315">More...</a><br /></td></tr>
<tr class="separator:a805df9186e7287ba645a159d9566a315"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f86f51631eb5ef716068c6320f1a19c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3f86f51631eb5ef716068c6320f1a19c">ParseConfigLines</a> (const std::vector&lt; std::string &gt; &amp;lines, std::vector&lt; <a class="el" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> &gt; *config_lines)</td></tr>
<tr class="memdesc:a3f86f51631eb5ef716068c6320f1a19c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function converts config-lines from a simple sequence of strings as output by <a class="el" href="namespacekaldi_1_1nnet3.html#a331cfb436079c33852b5514e6691f6be" title="This function reads in a config file and *appends* its contents to a vector of lines; it is responsib...">ReadConfigLines()</a>, into a sequence of first-tokens and name-value pairs.  <a href="#a3f86f51631eb5ef716068c6320f1a19c">More...</a><br /></td></tr>
<tr class="separator:a3f86f51631eb5ef716068c6320f1a19c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7670f1519ac3d653ed7af20ffaf388f8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a> (const char *name, const char *pattern)</td></tr>
<tr class="separator:a7670f1519ac3d653ed7af20ffaf388f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a264b986f95f2cb1e5bc7032967c69a27"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a264b986f95f2cb1e5bc7032967c69a27">YzxVectorIndex</a> (int32 x, int32 y, int32 z, int32 input_x_dim, int32 input_y_dim, int32 input_z_dim)</td></tr>
<tr class="separator:a264b986f95f2cb1e5bc7032967c69a27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25b3b76367d2844fb0f48334f1bd5691"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a25b3b76367d2844fb0f48334f1bd5691">ZyxVectorIndex</a> (int32 x, int32 y, int32 z, int32 input_x_dim, int32 input_y_dim, int32 input_z_dim)</td></tr>
<tr class="separator:a25b3b76367d2844fb0f48334f1bd5691"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac37caf62dbe225383341d770509b2d55"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac37caf62dbe225383341d770509b2d55">RearrangeIndexes</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;in, std::vector&lt; std::vector&lt; int32 &gt; &gt; *out)</td></tr>
<tr class="separator:ac37caf62dbe225383341d770509b2d55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3855432311c60a3aba3f3ef77871a9eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3855432311c60a3aba3f3ef77871a9eb">GenerateConfigSequenceSimplest</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a3855432311c60a3aba3f3ef77871a9eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a020e04f5594e00affc4c2bf231687e65"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a020e04f5594e00affc4c2bf231687e65">GenerateConfigSequenceSimpleContext</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a020e04f5594e00affc4c2bf231687e65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51af5c2c6da3b32c75666de9852dc74c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a51af5c2c6da3b32c75666de9852dc74c">GenerateConfigSequenceSimple</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a51af5c2c6da3b32c75666de9852dc74c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab23082de0da09ca5e9e4384bc51eb940"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab23082de0da09ca5e9e4384bc51eb940">GenerateConfigSequenceStatistics</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:ab23082de0da09ca5e9e4384bc51eb940"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a380783b4b5f4a192930cb5e5b00d0143"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a380783b4b5f4a192930cb5e5b00d0143">GenerateConfigSequenceRnn</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a380783b4b5f4a192930cb5e5b00d0143"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a410289847ba049a50141e38f95d4a3c5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a410289847ba049a50141e38f95d4a3c5">GenerateConfigSequenceRnnClockwork</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a410289847ba049a50141e38f95d4a3c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa50641f28c6aecba5e74d7604b4ef650"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa50641f28c6aecba5e74d7604b4ef650">GenerateConfigSequenceLstm</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:aa50641f28c6aecba5e74d7604b4ef650"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70f72e5f56f05e3a1005e54b4aa92673"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a70f72e5f56f05e3a1005e54b4aa92673">GenerateConfigSequenceLstmWithTruncation</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a70f72e5f56f05e3a1005e54b4aa92673"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a151e0713f1dd005df56e3c3c5bad845e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a151e0713f1dd005df56e3c3c5bad845e">GenerateConfigSequenceLstmType2</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a151e0713f1dd005df56e3c3c5bad845e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44d5ec3eab77bbbf0f6a9140db62e0bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a44d5ec3eab77bbbf0f6a9140db62e0bd">GenerateConfigSequenceCnn</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a44d5ec3eab77bbbf0f6a9140db62e0bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2ae4db1fcbacfa2823a40e9cbe979f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac2ae4db1fcbacfa2823a40e9cbe979f8">GenerateConfigSequenceCnnNew</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:ac2ae4db1fcbacfa2823a40e9cbe979f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa14a929fe7917b3ba3adf610aa27a643"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa14a929fe7917b3ba3adf610aa27a643">GenerateConfigSequenceRestrictedAttention</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:aa14a929fe7917b3ba3adf610aa27a643"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3855b8fdbe81b37928ccc530d22b91a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3855b8fdbe81b37928ccc530d22b91a3">GenerateConfigSequenceDistribute</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="separator:a3855b8fdbe81b37928ccc530d22b91a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3af6a7b7d8ad5235dfbccfd6ea387b1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3af6a7b7d8ad5235dfbccfd6ea387b1b">GenerateConfigSequenceCompositeBlock</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="memdesc:a3af6a7b7d8ad5235dfbccfd6ea387b1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a config string with a composite component composed only of block affine, repeated affine, and natural gradient repeated affine components.  <a href="#a3af6a7b7d8ad5235dfbccfd6ea387b1b">More...</a><br /></td></tr>
<tr class="separator:a3af6a7b7d8ad5235dfbccfd6ea387b1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a6ec6b257d100e7dab22ce3feac226f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;opts, std::vector&lt; std::string &gt; *configs)</td></tr>
<tr class="memdesc:a9a6ec6b257d100e7dab22ce3feac226f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a sequence of at least one config files, output as strings, where the first in the sequence is the initial nnet, and the remaining ones may do things like add layers.  <a href="#a9a6ec6b257d100e7dab22ce3feac226f">More...</a><br /></td></tr>
<tr class="separator:a9a6ec6b257d100e7dab22ce3feac226f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2370ad59bd8f6a9f348193b491d88d8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request, std::vector&lt; <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &gt; *inputs)</td></tr>
<tr class="memdesc:a2370ad59bd8f6a9f348193b491d88d8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function computes an example computation request, for testing purposes.  <a href="#a2370ad59bd8f6a9f348193b491d88d8a">More...</a><br /></td></tr>
<tr class="separator:a2370ad59bd8f6a9f348193b491d88d8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb5a70eadfcda218c3833859bf7ceb27"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afb5a70eadfcda218c3833859bf7ceb27">GenerateRandomComponentConfig</a> (std::string *component_type, std::string *config)</td></tr>
<tr class="separator:afb5a70eadfcda218c3833859bf7ceb27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dccdf514f810b334ee5baa954eb88f8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3dccdf514f810b334ee5baa954eb88f8">GenerateRandomSimpleComponent</a> ()</td></tr>
<tr class="memdesc:a3dccdf514f810b334ee5baa954eb88f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates random simple component for testing.  <a href="#a3dccdf514f810b334ee5baa954eb88f8">More...</a><br /></td></tr>
<tr class="separator:a3dccdf514f810b334ee5baa954eb88f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac25c4eeb172565878e12ca4355ad9147"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac25c4eeb172565878e12ca4355ad9147">NnetParametersAreIdentical</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet1, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet2, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> threshold)</td></tr>
<tr class="memdesc:ac25c4eeb172565878e12ca4355ad9147"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used for testing that the updatable parameters in two networks are the same.  <a href="#ac25c4eeb172565878e12ca4355ad9147">More...</a><br /></td></tr>
<tr class="separator:ac25c4eeb172565878e12ca4355ad9147"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8263b0802f12a823d6c072b53c4ee236"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8263b0802f12a823d6c072b53c4ee236">GenerateSimpleNnetTrainingExample</a> (int32 num_supervised_frames, int32 left_context, int32 right_context, int32 input_dim, int32 output_dim, int32 ivector_dim, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *example)</td></tr>
<tr class="memdesc:a8263b0802f12a823d6c072b53c4ee236"><td class="mdescLeft">&#160;</td><td class="mdescRight">Low-level function that generates an nnet training example.  <a href="#a8263b0802f12a823d6c072b53c4ee236">More...</a><br /></td></tr>
<tr class="separator:a8263b0802f12a823d6c072b53c4ee236"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a54fa7479670b5b34951fdacd2c9b1d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7a54fa7479670b5b34951fdacd2c9b1d">ExampleApproxEqual</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;eg1, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;eg2, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> delta)</td></tr>
<tr class="memdesc:a7a54fa7479670b5b34951fdacd2c9b1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the examples are approximately equal (only intended to be used in testing).  <a href="#a7a54fa7479670b5b34951fdacd2c9b1d">More...</a><br /></td></tr>
<tr class="separator:a7a54fa7479670b5b34951fdacd2c9b1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f2fefdb7c8c1cc2fd30b5e102e8e979"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2f2fefdb7c8c1cc2fd30b5e102e8e979">ComputeObjectiveFunction</a> (const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;supervision, <a class="el" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576e">ObjectiveType</a> objective_type, const std::string &amp;output_name, <a class="el" href="classbool.html">bool</a> supply_deriv, <a class="el" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> *computer, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *tot_weight, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *tot_objf)</td></tr>
<tr class="memdesc:a2f2fefdb7c8c1cc2fd30b5e102e8e979"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function computes the objective function, and if supply_deriv = true, supplies its derivative to the <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> object.  <a href="#a2f2fefdb7c8c1cc2fd30b5e102e8e979">More...</a><br /></td></tr>
<tr class="separator:a2f2fefdb7c8c1cc2fd30b5e102e8e979"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a666e24f4c79af6ec57eeaf005b00b5dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a666e24f4c79af6ec57eeaf005b00b5dd">UnitTestNnetContext</a> ()</td></tr>
<tr class="separator:a666e24f4c79af6ec57eeaf005b00b5dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f4676f01f9cf14b8e74e4698f5c4777"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6f4676f01f9cf14b8e74e4698f5c4777">UnitTestConvertRepeatedToBlockAffine</a> ()</td></tr>
<tr class="separator:a6f4676f01f9cf14b8e74e4698f5c4777"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ef2d5ac32418499886aba3a9054eed4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6ef2d5ac32418499886aba3a9054eed4">UnitTestConvertRepeatedToBlockAffineComposite</a> ()</td></tr>
<tr class="separator:a6ef2d5ac32418499886aba3a9054eed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0c3bad5386ea02d61e9596ba76b77eb"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab0c3bad5386ea02d61e9596ba76b77eb">NumOutputNodes</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="memdesc:ab0c3bad5386ea02d61e9596ba76b77eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns the number of output nodes of this nnet.  <a href="#ab0c3bad5386ea02d61e9596ba76b77eb">More...</a><br /></td></tr>
<tr class="separator:ab0c3bad5386ea02d61e9596ba76b77eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ce1aea23a558c0461ff1ab72f41ebb6"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2ce1aea23a558c0461ff1ab72f41ebb6">NumInputNodes</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="memdesc:a2ce1aea23a558c0461ff1ab72f41ebb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns the number of input nodes of this nnet.  <a href="#a2ce1aea23a558c0461ff1ab72f41ebb6">More...</a><br /></td></tr>
<tr class="separator:a2ce1aea23a558c0461ff1ab72f41ebb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a672e127a288d02b4a8e292b86aadfc04"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04">IsSimpleNnet</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="memdesc:a672e127a288d02b4a8e292b86aadfc04"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns true if the nnet has the following properties: It has an output called "output" (other outputs are allowed but may be ignored).  <a href="#a672e127a288d02b4a8e292b86aadfc04">More...</a><br /></td></tr>
<tr class="separator:a672e127a288d02b4a8e292b86aadfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5683058729bb42a5e8462f9912484050"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a5683058729bb42a5e8462f9912484050">EvaluateComputationRequest</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request, std::vector&lt; std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; &gt; *is_computable)</td></tr>
<tr class="memdesc:a5683058729bb42a5e8462f9912484050"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given an nnet and a computation request, this function works out which requested outputs in the computation request are computable; it outputs this information as a vector "is_computable" indexed by the same indexes as request.outputs.  <a href="#a5683058729bb42a5e8462f9912484050">More...</a><br /></td></tr>
<tr class="separator:a5683058729bb42a5e8462f9912484050"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02fd3958c7eb4423610d526c73d4926a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a02fd3958c7eb4423610d526c73d4926a">ComputeSimpleNnetContextForShift</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 input_start, int32 window_size, int32 *left_context, int32 *right_context)</td></tr>
<tr class="separator:a02fd3958c7eb4423610d526c73d4926a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88aa85d232ba1ad6e430f6f6dcda29c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">ComputeSimpleNnetContext</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, int32 *left_context, int32 *right_context)</td></tr>
<tr class="memdesc:a88aa85d232ba1ad6e430f6f6dcda29c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComputeSimpleNnetContext computes the left-context and right-context of a nnet.  <a href="#a88aa85d232ba1ad6e430f6f6dcda29c1">More...</a><br /></td></tr>
<tr class="separator:a88aa85d232ba1ad6e430f6f6dcda29c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ca498bb15fc664236fdd7316a1b8831"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2ca498bb15fc664236fdd7316a1b8831">PerturbParams</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> stddev, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a2ca498bb15fc664236fdd7316a1b8831"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calls PerturbParams (with the given stddev) on all updatable components of the nnet.  <a href="#a2ca498bb15fc664236fdd7316a1b8831">More...</a><br /></td></tr>
<tr class="separator:a2ca498bb15fc664236fdd7316a1b8831"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa155fe7eed7775fce35d644ca845dd9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa155fe7eed7775fce35d644ca845dd9d">ComponentDotProducts</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet1, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet2, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *dot_prod)</td></tr>
<tr class="memdesc:aa155fe7eed7775fce35d644ca845dd9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns dot products between two networks of the same structure (calls the DotProduct functions of the Updatable components and fill in the output vector).  <a href="#aa155fe7eed7775fce35d644ca845dd9d">More...</a><br /></td></tr>
<tr class="separator:aa155fe7eed7775fce35d644ca845dd9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cbf9817f25ef1302ede1ed03897394a"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a6cbf9817f25ef1302ede1ed03897394a">PrintVectorPerUpdatableComponent</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;vec)</td></tr>
<tr class="memdesc:a6cbf9817f25ef1302ede1ed03897394a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is for printing, to a string, a vector with one element per updatable component of the nnet (e.g.  <a href="#a6cbf9817f25ef1302ede1ed03897394a">More...</a><br /></td></tr>
<tr class="separator:a6cbf9817f25ef1302ede1ed03897394a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dc8f245e845514d33d24ecf1a054406"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4dc8f245e845514d33d24ecf1a054406">DotProduct</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet1, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet2)</td></tr>
<tr class="memdesc:a4dc8f245e845514d33d24ecf1a054406"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns dot product between two networks of the same structure (calls the DotProduct functions of the Updatable components and sums up the return values).  <a href="#a4dc8f245e845514d33d24ecf1a054406">More...</a><br /></td></tr>
<tr class="separator:a4dc8f245e845514d33d24ecf1a054406"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca9d819d3ed85b506db090905d4c1cea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea">ZeroComponentStats</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:aca9d819d3ed85b506db090905d4c1cea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Zeroes the component stats in all nonlinear components in the nnet.  <a href="#aca9d819d3ed85b506db090905d4c1cea">More...</a><br /></td></tr>
<tr class="separator:aca9d819d3ed85b506db090905d4c1cea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3936ad79463d7cfd23ba1efd54f56084"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3936ad79463d7cfd23ba1efd54f56084">SetLearningRate</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a3936ad79463d7cfd23ba1efd54f56084"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the underlying learning rate for all the components in the nnet to this value.  <a href="#a3936ad79463d7cfd23ba1efd54f56084">More...</a><br /></td></tr>
<tr class="separator:a3936ad79463d7cfd23ba1efd54f56084"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5c7a956c7fc10e9e5d67f351498c243"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab5c7a956c7fc10e9e5d67f351498c243">SetNnetAsGradient</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:ab5c7a956c7fc10e9e5d67f351498c243"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets nnet as gradient by Setting is_gradient_ to true and learning_rate_ to 1 for each <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html" title="Class UpdatableComponent is a Component which has trainable parameters; it extends the interface of C...">UpdatableComponent</a> in nnet.  <a href="#ab5c7a956c7fc10e9e5d67f351498c243">More...</a><br /></td></tr>
<tr class="separator:ab5c7a956c7fc10e9e5d67f351498c243"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b3a3e7be6ebc2a2af34bdb347ec76a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">ScaleNnet</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a62b3a3e7be6ebc2a2af34bdb347ec76a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scales the nnet parameters and stats by this scale.  <a href="#a62b3a3e7be6ebc2a2af34bdb347ec76a">More...</a><br /></td></tr>
<tr class="separator:a62b3a3e7be6ebc2a2af34bdb347ec76a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad24a2545a15f4ffa0e76652742767aac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ad24a2545a15f4ffa0e76652742767aac">AddNnetComponents</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;src, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;alphas, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *dest)</td></tr>
<tr class="memdesc:ad24a2545a15f4ffa0e76652742767aac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does *dest += alpha * src for updatable components (affects nnet parameters), and *dest += scale * src for other components (affects stored stats).  <a href="#ad24a2545a15f4ffa0e76652742767aac">More...</a><br /></td></tr>
<tr class="separator:ad24a2545a15f4ffa0e76652742767aac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9680bf4ad4dd4fd305f913ff398c14e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac9680bf4ad4dd4fd305f913ff398c14e">AddNnet</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;src, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *dest)</td></tr>
<tr class="memdesc:ac9680bf4ad4dd4fd305f913ff398c14e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does *dest += alpha * src (affects nnet parameters and stored stats).  <a href="#ac9680bf4ad4dd4fd305f913ff398c14e">More...</a><br /></td></tr>
<tr class="separator:ac9680bf4ad4dd4fd305f913ff398c14e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96164bd20d5a66c3c0ca62e30250d46a"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">NumParameters</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;src)</td></tr>
<tr class="memdesc:a96164bd20d5a66c3c0ca62e30250d46a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the total of the number of parameters in the updatable components of the nnet.  <a href="#a96164bd20d5a66c3c0ca62e30250d46a">More...</a><br /></td></tr>
<tr class="separator:a96164bd20d5a66c3c0ca62e30250d46a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9b9bd865f19f604b00235336168c3ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ad9b9bd865f19f604b00235336168c3ee">VectorizeNnet</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;src, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *params)</td></tr>
<tr class="memdesc:ad9b9bd865f19f604b00235336168c3ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the nnet parameters to *params, whose dimension must be equal to NumParameters(src).  <a href="#ad9b9bd865f19f604b00235336168c3ee">More...</a><br /></td></tr>
<tr class="separator:ad9b9bd865f19f604b00235336168c3ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aded8b769020aeb041c148c931c44a040"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aded8b769020aeb041c148c931c44a040">UnVectorizeNnet</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;params, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *dest)</td></tr>
<tr class="memdesc:aded8b769020aeb041c148c931c44a040"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the parameters from params to *dest.  <a href="#aded8b769020aeb041c148c931c44a040">More...</a><br /></td></tr>
<tr class="separator:aded8b769020aeb041c148c931c44a040"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25df665b8f7a712a34469e53fc875851"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">NumUpdatableComponents</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;dest)</td></tr>
<tr class="memdesc:a25df665b8f7a712a34469e53fc875851"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of updatable components in the nnet.  <a href="#a25df665b8f7a712a34469e53fc875851">More...</a><br /></td></tr>
<tr class="separator:a25df665b8f7a712a34469e53fc875851"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa665cb6bf2afd82ee21658d7d5d9c410"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa665cb6bf2afd82ee21658d7d5d9c410">FreezeNaturalGradient</a> (<a class="el" href="classbool.html">bool</a> freeze, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:aa665cb6bf2afd82ee21658d7d5d9c410"><td class="mdescLeft">&#160;</td><td class="mdescRight">Controls if natural gradient will be updated.  <a href="#aa665cb6bf2afd82ee21658d7d5d9c410">More...</a><br /></td></tr>
<tr class="separator:aa665cb6bf2afd82ee21658d7d5d9c410"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52b9ed9b365e986bbbc29a310aae2f8f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a52b9ed9b365e986bbbc29a310aae2f8f">ConvertRepeatedToBlockAffine</a> (<a class="el" href="classkaldi_1_1nnet3_1_1CompositeComponent.html">CompositeComponent</a> *c_component)</td></tr>
<tr class="separator:a52b9ed9b365e986bbbc29a310aae2f8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30d342f16140837bd5ca9f384d62478e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a30d342f16140837bd5ca9f384d62478e">ConvertRepeatedToBlockAffine</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a30d342f16140837bd5ca9f384d62478e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert all components of type <a class="el" href="classkaldi_1_1nnet3_1_1RepeatedAffineComponent.html">RepeatedAffineComponent</a> or <a class="el" href="classkaldi_1_1nnet3_1_1NaturalGradientRepeatedAffineComponent.html">NaturalGradientRepeatedAffineComponent</a> to <a class="el" href="classkaldi_1_1nnet3_1_1BlockAffineComponent.html" title="This class implements an affine transform using a block diagonal matrix e.g., one whose weight matrix...">BlockAffineComponent</a> in nnet.  <a href="#a30d342f16140837bd5ca9f384d62478e">More...</a><br /></td></tr>
<tr class="separator:a30d342f16140837bd5ca9f384d62478e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81eeaabd042c236a1e0276c353a7d450"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a81eeaabd042c236a1e0276c353a7d450">NnetInfo</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="memdesc:a81eeaabd042c236a1e0276c353a7d450"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns various info about the neural net.  <a href="#a81eeaabd042c236a1e0276c353a7d450">More...</a><br /></td></tr>
<tr class="separator:a81eeaabd042c236a1e0276c353a7d450"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eb3426f75b0e6c1be855ff7477e2f98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7eb3426f75b0e6c1be855ff7477e2f98">SetDropoutProportion</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> dropout_proportion, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a7eb3426f75b0e6c1be855ff7477e2f98"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function sets the dropout proportion in all dropout components to dropout_proportion value.  <a href="#a7eb3426f75b0e6c1be855ff7477e2f98">More...</a><br /></td></tr>
<tr class="separator:a7eb3426f75b0e6c1be855ff7477e2f98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affc407d1e7d567d46e9214000cb500d6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#affc407d1e7d567d46e9214000cb500d6">HasBatchnorm</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="memdesc:affc407d1e7d567d46e9214000cb500d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if nnet has at least one component of type <a class="el" href="classkaldi_1_1nnet3_1_1BatchNormComponent.html">BatchNormComponent</a>.  <a href="#affc407d1e7d567d46e9214000cb500d6">More...</a><br /></td></tr>
<tr class="separator:affc407d1e7d567d46e9214000cb500d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f1b6df80b7997a8958d2672c40b05c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a40f1b6df80b7997a8958d2672c40b05c">ScaleBatchnormStats</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> batchnorm_stats_scale, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a40f1b6df80b7997a8958d2672c40b05c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function scales the batchorm stats of any batchnorm components (components of type <a class="el" href="classkaldi_1_1nnet3_1_1BatchNormComponent.html">BatchNormComponent</a>) in 'nnet' by the scale 'batchnorm_stats_scale'.  <a href="#a40f1b6df80b7997a8958d2672c40b05c">More...</a><br /></td></tr>
<tr class="separator:a40f1b6df80b7997a8958d2672c40b05c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91966187f28cae11565e07bd759b044d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a91966187f28cae11565e07bd759b044d">RecomputeStats</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;egs, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a91966187f28cae11565e07bd759b044d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function zeros the stored component-level stats in the nnet using <a class="el" href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea" title="Zeroes the component stats in all nonlinear components in the nnet. ">ZeroComponentStats()</a>, then recomputes them with the supplied egs.  <a href="#a91966187f28cae11565e07bd759b044d">More...</a><br /></td></tr>
<tr class="separator:a91966187f28cae11565e07bd759b044d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8f15bc7a244b05a3f04e15d562043dc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac8f15bc7a244b05a3f04e15d562043dc">SetBatchnormTestMode</a> (<a class="el" href="classbool.html">bool</a> test_mode, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:ac8f15bc7a244b05a3f04e15d562043dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function affects only components of type <a class="el" href="classkaldi_1_1nnet3_1_1BatchNormComponent.html">BatchNormComponent</a>.  <a href="#ac8f15bc7a244b05a3f04e15d562043dc">More...</a><br /></td></tr>
<tr class="separator:ac8f15bc7a244b05a3f04e15d562043dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9757843e049a91502f6fa39782b1ffc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#af9757843e049a91502f6fa39782b1ffc">SetDropoutTestMode</a> (<a class="el" href="classbool.html">bool</a> test_mode, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:af9757843e049a91502f6fa39782b1ffc"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function affects components of child-classes of <a class="el" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a>.  <a href="#af9757843e049a91502f6fa39782b1ffc">More...</a><br /></td></tr>
<tr class="separator:af9757843e049a91502f6fa39782b1ffc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c2029913de309432ceda98856ca5819"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3c2029913de309432ceda98856ca5819">ResetGenerators</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a3c2029913de309432ceda98856ca5819"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function calls 'ResetGenerator()' on all components in 'nnet' that inherit from class <a class="el" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a>.  <a href="#a3c2029913de309432ceda98856ca5819">More...</a><br /></td></tr>
<tr class="separator:a3c2029913de309432ceda98856ca5819"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea1816d4314c548a5099cfa5a328ef63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aea1816d4314c548a5099cfa5a328ef63">FindOrphanComponents</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, std::vector&lt; int32 &gt; *components)</td></tr>
<tr class="memdesc:aea1816d4314c548a5099cfa5a328ef63"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function finds a list of components that are never used, and outputs the integer comopnent indexes (you can use these to index nnet.GetComponentNames() to get their names).  <a href="#aea1816d4314c548a5099cfa5a328ef63">More...</a><br /></td></tr>
<tr class="separator:aea1816d4314c548a5099cfa5a328ef63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9a664caafab064813da57f956a55701"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa9a664caafab064813da57f956a55701">FindOrphanNodes</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, std::vector&lt; int32 &gt; *nodes)</td></tr>
<tr class="memdesc:aa9a664caafab064813da57f956a55701"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function finds a list of nodes that are never used to compute any output, and outputs the integer node indexes (you can use these to index nnet.GetNodeNames() to get their names).  <a href="#aa9a664caafab064813da57f956a55701">More...</a><br /></td></tr>
<tr class="separator:aa9a664caafab064813da57f956a55701"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa586e633b1a081bc50483c9041761fd7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa586e633b1a081bc50483c9041761fd7">ConstrainOrthonormalInternal</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *M)</td></tr>
<tr class="separator:aa586e633b1a081bc50483c9041761fd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f170223a0b8d8f515dbc03279e78a4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8f170223a0b8d8f515dbc03279e78a4a">ConstrainOrthonormal</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a8f170223a0b8d8f515dbc03279e78a4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function, to be called after processing every minibatch, is responsible for enforcing the orthogonality constraint for any components of type <a class="el" href="classkaldi_1_1nnet3_1_1LinearComponent.html">LinearComponent</a> or inheriting from <a class="el" href="classkaldi_1_1nnet3_1_1AffineComponent.html">AffineComponent</a> that have the "orthonormal_constraint" value set.  <a href="#a8f170223a0b8d8f515dbc03279e78a4a">More...</a><br /></td></tr>
<tr class="separator:a8f170223a0b8d8f515dbc03279e78a4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a322efc02a286b646c40b65235c432893"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a322efc02a286b646c40b65235c432893">ConsolidateMemory</a> (<a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a322efc02a286b646c40b65235c432893"><td class="mdescLeft">&#160;</td><td class="mdescRight">This just calls <a class="el" href="namespacekaldi_1_1nnet3.html#a322efc02a286b646c40b65235c432893" title="This just calls ConsolidateMemory() on all the components of the nnet. ">ConsolidateMemory()</a> on all the components of the nnet.  <a href="#a322efc02a286b646c40b65235c432893">More...</a><br /></td></tr>
<tr class="separator:a322efc02a286b646c40b65235c432893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac484c16402247b8c538022ee736bb4a2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac484c16402247b8c538022ee736bb4a2">ReduceRankOfComponents</a> (const std::string component_name_pattern, int32 rank, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="separator:ac484c16402247b8c538022ee736bb4a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad587de6247cba206672dafb6ef70dc12"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ad587de6247cba206672dafb6ef70dc12">ReadEditConfig</a> (std::istream &amp;config_file, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:ad587de6247cba206672dafb6ef70dc12"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="namespacekaldi_1_1nnet3.html#ad587de6247cba206672dafb6ef70dc12" title="ReadEditConfig() reads a file with a similar-looking format to the config file read by Nnet::ReadConf...">ReadEditConfig()</a> reads a file with a similar-looking format to the config file read by <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">Nnet::ReadConfig()</a>, but this consists of a sequence of operations to perform on an existing network, mostly modifying components.  <a href="#ad587de6247cba206672dafb6ef70dc12">More...</a><br /></td></tr>
<tr class="separator:ad587de6247cba206672dafb6ef70dc12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cda4da2254dd2dfe1800e4dfeebec38"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a4cda4da2254dd2dfe1800e4dfeebec38">NnetIsRecurrent</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="memdesc:a4cda4da2254dd2dfe1800e4dfeebec38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if 'nnet' has some kind of recurrency.  <a href="#a4cda4da2254dd2dfe1800e4dfeebec38">More...</a><br /></td></tr>
<tr class="separator:a4cda4da2254dd2dfe1800e4dfeebec38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34c5db7f905e0ab11b678443cb65f930"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a34c5db7f905e0ab11b678443cb65f930">CollapseModel</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1CollapseModelConfig.html">CollapseModelConfig</a> &amp;config, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a34c5db7f905e0ab11b678443cb65f930"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function modifies the neural net for efficiency, in a way that suitable to be done in test time.  <a href="#a34c5db7f905e0ab11b678443cb65f930">More...</a><br /></td></tr>
<tr class="separator:a34c5db7f905e0ab11b678443cb65f930"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1386d6c6a6d3e9bd00fed536d63cb847"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a1386d6c6a6d3e9bd00fed536d63cb847">UpdateNnetWithMaxChange</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;delta_nnet, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_param_change, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_change_scale, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet, std::vector&lt; int32 &gt; *num_max_change_per_component_applied, int32 *num_max_change_global_applied)</td></tr>
<tr class="memdesc:a1386d6c6a6d3e9bd00fed536d63cb847"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function does the operation '*nnet += scale * delta_nnet', while respecting any max-parameter-change (max-param-change) specified in the updatable components, and also the global max-param-change specified as 'max_param_change'.  <a href="#a1386d6c6a6d3e9bd00fed536d63cb847">More...</a><br /></td></tr>
<tr class="separator:a1386d6c6a6d3e9bd00fed536d63cb847"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a433fdafbe9ea5093a2742b5451ba674f"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a433fdafbe9ea5093a2742b5451ba674f">GetNumNvalues</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> &gt; &amp;io_vec, <a class="el" href="classbool.html">bool</a> exhaustive)</td></tr>
<tr class="memdesc:a433fdafbe9ea5093a2742b5451ba674f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This utility function can be used to obtain the number of distinct 'n' values in a training example.  <a href="#a433fdafbe9ea5093a2742b5451ba674f">More...</a><br /></td></tr>
<tr class="separator:a433fdafbe9ea5093a2742b5451ba674f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5240f2d016ad928b0034835c77f5b2cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a5240f2d016ad928b0034835c77f5b2cb">ApplyL2Regularization</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> l2_regularize_scale, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *delta_nnet)</td></tr>
<tr class="memdesc:a5240f2d016ad928b0034835c77f5b2cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used as part of the regular training workflow, prior to <a class="el" href="namespacekaldi_1_1nnet3.html#a1386d6c6a6d3e9bd00fed536d63cb847" title="This function does the operation &#39;*nnet += scale * delta_nnet&#39;, while respecting any max-parameter-ch...">UpdateNnetWithMaxChange()</a>.  <a href="#a5240f2d016ad928b0034835c77f5b2cb">More...</a><br /></td></tr>
<tr class="separator:a5240f2d016ad928b0034835c77f5b2cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04165cf9403194c5a77e922f8f14d5f9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a04165cf9403194c5a77e922f8f14d5f9">KlDivergence</a> (const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;p, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;q)</td></tr>
<tr class="separator:a04165cf9403194c5a77e922f8f14d5f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1a1184cd1146007ebf5403444309b69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#aa1a1184cd1146007ebf5403444309b69">PrintPriorDiagnostics</a> (const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;old_priors, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;new_priors)</td></tr>
<tr class="separator:aa1a1184cd1146007ebf5403444309b69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad96e7aef845800f1dc88fa2ad1aade28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ad96e7aef845800f1dc88fa2ad1aade28">SetPriors</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;transition_accs, double prior_floor, <a class="el" href="classkaldi_1_1nnet3_1_1AmNnetSimple.html">AmNnetSimple</a> *am_nnet)</td></tr>
<tr class="separator:ad96e7aef845800f1dc88fa2ad1aade28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b0d1bf88132455db1909b9b4dc91120"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2b0d1bf88132455db1909b9b4dc91120">ComputeObjf</a> (<a class="el" href="classbool.html">bool</a> batchnorm_test_mode, <a class="el" href="classbool.html">bool</a> dropout_test_mode, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;egs, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="classkaldi_1_1nnet3_1_1NnetComputeProb.html">NnetComputeProb</a> *prob_computer)</td></tr>
<tr class="separator:a2b0d1bf88132455db1909b9b4dc91120"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11f61b746e0773ae070094b9baa1b815"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a11f61b746e0773ae070094b9baa1b815">UpdateNnetMovingAverage</a> (int32 num_models, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *moving_average_nnet)</td></tr>
<tr class="separator:a11f61b746e0773ae070094b9baa1b815"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab732a05694363a8a666b7e860a1206ae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ab732a05694363a8a666b7e860a1206ae">RenameOutputs</a> (const std::string &amp;new_name, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *eg)</td></tr>
<tr class="separator:ab732a05694363a8a666b7e860a1206ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e66a1549640fddc06015648df4167bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a9e66a1549640fddc06015648df4167bc">ScaleSupervisionWeight</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> weight, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *eg)</td></tr>
<tr class="separator:a9e66a1549640fddc06015648df4167bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a270955c18c82f5de1e707ec094998283"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a270955c18c82f5de1e707ec094998283">GetCount</a> (double expected_count)</td></tr>
<tr class="separator:a270955c18c82f5de1e707ec094998283"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d106dafc23aa3dc2359adc0bb2a94bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a9d106dafc23aa3dc2359adc0bb2a94bd">ContainsSingleExample</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;eg, int32 *min_input_t, int32 *max_input_t, int32 *min_output_t, int32 *max_output_t)</td></tr>
<tr class="memdesc:a9d106dafc23aa3dc2359adc0bb2a94bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the "eg" contains just a single example, meaning that all the "n" values in the indexes are zero, and the example has <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> members named both "input" and "output".  <a href="#a9d106dafc23aa3dc2359adc0bb2a94bd">More...</a><br /></td></tr>
<tr class="separator:a9d106dafc23aa3dc2359adc0bb2a94bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae235076d32848d3ce99ecd4a763e0961"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ae235076d32848d3ce99ecd4a763e0961">FilterExample</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;eg, int32 min_input_t, int32 max_input_t, int32 min_output_t, int32 max_output_t, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *eg_out)</td></tr>
<tr class="memdesc:ae235076d32848d3ce99ecd4a763e0961"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function filters the indexes (and associated feature rows) in a <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a>, removing any index/row in an <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> named "input" with t &lt; min_input_t or t &gt; max_input_t and any index/row in an <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> named "output" with t &lt; min_output_t or t &gt; max_output_t.  <a href="#ae235076d32848d3ce99ecd4a763e0961">More...</a><br /></td></tr>
<tr class="separator:ae235076d32848d3ce99ecd4a763e0961"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c1cb3ecc86f15353f90fab03073c77d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a3c1cb3ecc86f15353f90fab03073c77d">SelectFromExample</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;eg, std::string frame_str, int32 left_context, int32 right_context, int32 frame_shift, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *eg_out)</td></tr>
<tr class="memdesc:a3c1cb3ecc86f15353f90fab03073c77d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is responsible for possibly selecting one frame from multiple supervised frames, and reducing the left and right context as specified.  <a href="#a3c1cb3ecc86f15353f90fab03073c77d">More...</a><br /></td></tr>
<tr class="separator:a3c1cb3ecc86f15353f90fab03073c77d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc93395c770a7f80de373381c8b8b569"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#afc93395c770a7f80de373381c8b8b569">ProcessFile</a> (const <a class="el" href="structkaldi_1_1discriminative_1_1SplitDiscriminativeSupervisionOptions.html">discriminative::SplitDiscriminativeSupervisionOptions</a> &amp;config, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;feats, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *ivector_feats, int32 ivector_period, const <a class="el" href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html">discriminative::DiscriminativeSupervision</a> &amp;supervision, const std::string &amp;utt_id, <a class="el" href="classbool.html">bool</a> compress, <a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a> *utt_splitter, <a class="el" href="namespacekaldi_1_1nnet3.html#acdfc2ad7f1c7dbba13a2d991e6a4d004">NnetDiscriminativeExampleWriter</a> *example_writer)</td></tr>
<tr class="separator:afc93395c770a7f80de373381c8b8b569"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf6dcdd416f3076af7f4d00cc53f7e57"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#acf6dcdd416f3076af7f4d00cc53f7e57">ApplyAffineTransform</a> (<a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;transform, int32 num_channels, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *image, <a class="el" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980">FillMode</a> fill_mode)</td></tr>
<tr class="memdesc:acf6dcdd416f3076af7f4d00cc53f7e57"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function applies a geometric transformation 'transform' to the image.  <a href="#acf6dcdd416f3076af7f4d00cc53f7e57">More...</a><br /></td></tr>
<tr class="separator:acf6dcdd416f3076af7f4d00cc53f7e57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a807b8aabb93f3ae097cc93629d5b8410"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a807b8aabb93f3ae097cc93629d5b8410">PerturbImage</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html">ImageAugmentationConfig</a> &amp;config, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *image)</td></tr>
<tr class="memdesc:a807b8aabb93f3ae097cc93629d5b8410"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function randomly modifies (perturbs) the image by applying different geometric transformations according to the options in 'config'.  <a href="#a807b8aabb93f3ae097cc93629d5b8410">More...</a><br /></td></tr>
<tr class="separator:a807b8aabb93f3ae097cc93629d5b8410"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a059ad04cefd0a3c450efa6ca7c1c0211"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a059ad04cefd0a3c450efa6ca7c1c0211">PerturbImageInNnetExample</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html">ImageAugmentationConfig</a> &amp;config, <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *eg)</td></tr>
<tr class="memdesc:a059ad04cefd0a3c450efa6ca7c1c0211"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function does image perturbation as directed by 'config' The example 'eg' is expected to contain a <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> member with the name 'input', representing an image.  <a href="#a059ad04cefd0a3c450efa6ca7c1c0211">More...</a><br /></td></tr>
<tr class="separator:a059ad04cefd0a3c450efa6ca7c1c0211"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c182569762d114b5d2a2619a7f885e9"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8c182569762d114b5d2a2619a7f885e9">ProcessFile</a> (const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;feats, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *ivector_feats, int32 ivector_period, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;targets, const std::string &amp;utt_id, <a class="el" href="classbool.html">bool</a> compress, int32 num_targets, int32 length_tolerance, <a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a> *utt_splitter, <a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *example_writer)</td></tr>
<tr class="separator:a8c182569762d114b5d2a2619a7f885e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a66448c7056b839a87410d5a9dfd35a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8a66448c7056b839a87410d5a9dfd35a">ProcessFile</a> (const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;feats, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *ivector_feats, int32 ivector_period, const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;pdf_post, const std::string &amp;utt_id, <a class="el" href="classbool.html">bool</a> compress, int32 num_pdfs, int32 length_tolerance, <a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a> *utt_splitter, <a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *example_writer)</td></tr>
<tr class="separator:a8a66448c7056b839a87410d5a9dfd35a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aaea01bc54e382c47d9a0a205489a97"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a2aaea01bc54e382c47d9a0a205489a97">NumOutputIndexes</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;eg)</td></tr>
<tr class="separator:a2aaea01bc54e382c47d9a0a205489a97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7257d6fb1ae554317c5937d386cf88d1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a7257d6fb1ae554317c5937d386cf88d1">RunNnetComputation</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;features, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">CachingOptimizingCompiler</a> *compiler, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *xvector)</td></tr>
<tr class="separator:a7257d6fb1ae554317c5937d386cf88d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21d7e0dc98beba206f0d12d28242d2e7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a21d7e0dc98beba206f0d12d28242d2e7">ProcessRangeFile</a> (const std::string &amp;range_rxfilename, unordered_map&lt; std::string, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a> *&gt; &gt; *utt_to_chunks)</td></tr>
<tr class="separator:a21d7e0dc98beba206f0d12d28242d2e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8774992c5665f6f346ad306771b8e34e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a8774992c5665f6f346ad306771b8e34e">WriteExamples</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;feats, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a> *&gt; &amp;chunks, const std::string &amp;utt, <a class="el" href="classbool.html">bool</a> compress, int32 num_pdfs, int32 *num_egs_written, std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *&gt; *example_writers)</td></tr>
<tr class="separator:a8774992c5665f6f346ad306771b8e34e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a661a5133ac17b002930d5eea66d9632c"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#a661a5133ac17b002930d5eea66d9632c">computation_checker_warned_unused_input</a> = false</td></tr>
<tr class="memdesc:a661a5133ac17b002930d5eea66d9632c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks that we never use variables before they are allocated or after they are deallocated, and some other checks that can be done from the <a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a>.  <a href="#a661a5133ac17b002930d5eea66d9632c">More...</a><br /></td></tr>
<tr class="separator:a661a5133ac17b002930d5eea66d9632c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac952f0840a7950dff80c1a89e69656d7"><td class="memItemLeft" align="right" valign="top">const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a> = std::numeric_limits&lt;int32&gt;::min()</td></tr>
<tr class="separator:ac952f0840a7950dff80c1a89e69656d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ac8344e7587df9247d6cc492874901d4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8344e7587df9247d6cc492874901d4d">&#9670;&nbsp;</a></span>Cindex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::pair&lt;int32, <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a>&gt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8h_source.html#l00115">115</a> of file <a class="el" href="nnet-common_8h_source.html">nnet-common.h</a>.</p>

</div>
</div>
<a id="af80630a0ede7fd145e56dcf05a2de731"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af80630a0ede7fd145e56dcf05a2de731">&#9670;&nbsp;</a></span>NnetChainExampleWriter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#af80630a0ede7fd145e56dcf05a2de731">NnetChainExampleWriter</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8h_source.html#l00220">220</a> of file <a class="el" href="nnet-chain-example_8h_source.html">nnet-chain-example.h</a>.</p>

</div>
</div>
<a id="acdfc2ad7f1c7dbba13a2d991e6a4d004"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdfc2ad7f1c7dbba13a2d991e6a4d004">&#9670;&nbsp;</a></span>NnetDiscriminativeExampleWriter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#acdfc2ad7f1c7dbba13a2d991e6a4d004">NnetDiscriminativeExampleWriter</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8h_source.html#l00214">214</a> of file <a class="el" href="nnet-discriminative-example_8h_source.html">nnet-discriminative-example.h</a>.</p>

</div>
</div>
<a id="af2246cc04a2596de3c09fad3c3513671"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2246cc04a2596de3c09fad3c3513671">&#9670;&nbsp;</a></span>NnetExampleWriter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-example_8h_source.html#l00170">170</a> of file <a class="el" href="nnet3_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<a id="a08f703c9f73aca60a0fe3226c0b6bf3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08f703c9f73aca60a0fe3226c0b6bf3b">&#9670;&nbsp;</a></span>RandomAccessNnetChainExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#a08f703c9f73aca60a0fe3226c0b6bf3b">RandomAccessNnetChainExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8h_source.html#l00222">222</a> of file <a class="el" href="nnet-chain-example_8h_source.html">nnet-chain-example.h</a>.</p>

</div>
</div>
<a id="a1ba30fe45cf1049b8f91f220829dddc8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ba30fe45cf1049b8f91f220829dddc8">&#9670;&nbsp;</a></span>RandomAccessNnetDiscriminativeExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#a1ba30fe45cf1049b8f91f220829dddc8">RandomAccessNnetDiscriminativeExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8h_source.html#l00216">216</a> of file <a class="el" href="nnet-discriminative-example_8h_source.html">nnet-discriminative-example.h</a>.</p>

</div>
</div>
<a id="a96242234768bbde2864c47396903675e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96242234768bbde2864c47396903675e">&#9670;&nbsp;</a></span>RandomAccessNnetExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#a96242234768bbde2864c47396903675e">RandomAccessNnetExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-example_8h_source.html#l00172">172</a> of file <a class="el" href="nnet3_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<a id="a8a0cce988bd256578ca8edc61cc1d4c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a0cce988bd256578ca8edc61cc1d4c6">&#9670;&nbsp;</a></span>SequentialNnetChainExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#a8a0cce988bd256578ca8edc61cc1d4c6">SequentialNnetChainExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8h_source.html#l00221">221</a> of file <a class="el" href="nnet-chain-example_8h_source.html">nnet-chain-example.h</a>.</p>

</div>
</div>
<a id="a6317f17ee7f9b20d4fb3915a3b8d185a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6317f17ee7f9b20d4fb3915a3b8d185a">&#9670;&nbsp;</a></span>SequentialNnetDiscriminativeExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#a6317f17ee7f9b20d4fb3915a3b8d185a">SequentialNnetDiscriminativeExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8h_source.html#l00215">215</a> of file <a class="el" href="nnet-discriminative-example_8h_source.html">nnet-discriminative-example.h</a>.</p>

</div>
</div>
<a id="a206084ee5d66f24aeb8828c6bf8cb13d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a206084ee5d66f24aeb8828c6bf8cb13d">&#9670;&nbsp;</a></span>SequentialNnetExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet3.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-example_8h_source.html#l00171">171</a> of file <a class="el" href="nnet3_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ad8aff9e545a5f496a179a16667431478"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8aff9e545a5f496a179a16667431478">&#9670;&nbsp;</a></span>AccessType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478">AccessType</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3"></a>kReadAccess&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"></a>kWriteAccess&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e"></a>kReadWriteAccess&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8h_source.html#l00075">75</a> of file <a class="el" href="nnet-analyze_8h_source.html">nnet-analyze.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>,</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;};</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kaldi::nnet3::kReadAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00076">nnet-analyze.h:76</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kaldi::nnet3::kReadWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00078">nnet-analyze.h:78</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kaldi::nnet3::kWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00077">nnet-analyze.h:77</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a21e038f5b8958e203d28bc4f18472352"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21e038f5b8958e203d28bc4f18472352">&#9670;&nbsp;</a></span>CommandType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352">CommandType</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CommandType is an enum that describes the category of the command used in the <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>. </p>
<p>We declare it outside that class because it's so frequently used and we got tired of typing <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>:: everywhere. We document the commands here. Note: for operations that naturally need to operate on entire matrices (i.e. allocation commands and input and output commands), we use the submatrix indexes of them, which turns out to be more convenient for optimization; but these submatrix indexes must refer to the whole of a matrix.</p>
<ul>
<li>kAllocMatrix. Allocate a matrix (its values will be undefined). arg1 = submatrix index, which must refer to a whole matrix.</li>
<li>kDeallocMatrix: Deallocate a matrix. arg1 = submatrix index.</li>
<li>kSwapMatrix: initialize matrix with submatrix index arg1 using memory from matrix with submatrix index arg2 (using shallow swap). Both submatrices must refer to whole matrices. The expectation is that prior to the swap, arg1 was empty and arg2 was nonempty, but the execution code does not enforce this.</li>
<li>kSetConst: set all elements of submatrix index 'arg1' to the value 'alpha'.</li>
<li>kPropagate: Forward computation of neural net, see <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958" title="Propagate function. ">Component::Propagate()</a><ul>
<li>arg1 is is component-index in neural net</li>
<li>arg2 is index into <a class="el" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a> (0 if NULL; always 0 for simple Components)</li>
<li>arg3 is sub-matrix index of input</li>
<li>arg4 is sub-matrix index of output</li>
<li>arg5 is the index of the memo saved from Propagate()'s return value, or 0 if it saves no memo.</li>
<li>arg6 is 1 if we need to call StoreStats() after the Propagate, or 0 if we don't. We used to have a separate command for storing the stats, but that has been removed.</li>
</ul>
</li>
<li>kBackprop: Do the back-propagation operation, see <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca" title="Backprop function; depending on which of the arguments &#39;to_update&#39; and &#39;in_deriv&#39; are non-NULL...">Component::Backprop()</a><ul>
<li>arg1 is index of component in neural net</li>
<li>arg2 is index into <a class="el" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a> (0 if NULL; always 0 for simple Components)</li>
<li>arg3 is submatrix-index of input value (input to Propagate()); 0 if unused</li>
<li>arg4 is submatrix-index of output value (output of Propagate()); 0 if unused</li>
<li>arg5 is submatrix-index of output derivative</li>
<li>arg6 is submatrix-index of input derivative; 0 if unused.</li>
<li>arg7 is the index of the memo which is generated from the corresponding Propagate() function if the flag kUsesMemo is set; 0 if unused.</li>
</ul>
</li>
<li>kBackpropNoModelUpdate: as kBackprop, but does not set the 'to_update' argument to the Backprop call, even if the model is updatable, so it skips the model-update phase of backprop.</li>
<li>kMatrixCopy: Copy (alpha times contents of sub-matrix arg2) to sub-matrix arg1, currently implemented as copy then scale. Note: to implement scaling a matrix, you can use kMatrixCopy with arg1 == arg2 and it won't do any redundant copying.</li>
<li>kMatrixAdd: Add (alpha times contents of sub-matrix arg2) to sub-matrix arg1</li>
<li>kCopyRows: call <a class="el" href="classkaldi_1_1CuMatrixBase.html#ab3c837bb106bfab035db4ea22906acef">CopyRows()</a> on sub-matrix arg1 with sub-matrix arg2 and indexes[arg3] as arguments, then if alpha != 1.0, scale sub-matrix arg1 by alpha.</li>
<li>kAddRows: call <a class="el" href="classkaldi_1_1CuMatrixBase.html#a62c46e6440ae6045cb2f0af43f26c1d5">AddRows()</a> on sub-matrix arg1 with alpha, sub-matrix arg2 and indexes[arg3] as arguments.</li>
<li>kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti: Call the corresponding function in class <a class="el" href="classkaldi_1_1CuMatrix.html" title="This class represents a matrix that&#39;s stored on the GPU if we have one, and in memory if not...">CuMatrix</a> (Actually the names do not have 'Multi' in them, but they are the ones that accept a vector of 'Real*'.<ul>
<li>arg1 is sub-matrix index of *this matrix in operation</li>
<li>arg2 is index into "indexes_multi", of which each pair is (sub-matrix index, row index) (or (-1,-1) for NULL marker), which is turned into a vector of BaseFloat* (pointers to matrix rows) before being given as the argument to the function. In the 'Add' functions 'alpha' is provided as an argument; for the 'Copy' functions, we scale the destination by 'alpha' after the copy, if alpha != 1.0. (However, for implementation reasons, kCopyToRowsMulti does not currently support alpha != 1.0 and will crash, so we avoid generating this code).</li>
</ul>
</li>
<li>kAddRowRanges: call <a class="el" href="classkaldi_1_1CuMatrixBase.html#ae4eb60ca0d96773b8e5b33df26d8595f">AddRowRanges()</a> on sub-matrix arg1, with arg2 as source sub-matrix, and indexes given indexes_ranges[arg3]. We use the "alpha" as if AddRowRanges() accepted that argument, even though it doesn't (we fake it using other calls, if alpha != 1.0).</li>
<li>kCompressMatrix: Compresses the matrix which should be referred to by submatrix-index arg1. arg2 is a number that determines the compression type (it's converted from the enum CuCompressedMatrixType; 1=int8, 2=uint8, 3=int16, 4=uint16), and alpha determines the 'range' parameter (c.f. <a class="el" href="namespacekaldi.html#ab30898c3621f787ea17ac4ad4c6c9655" title="This function allocates a new CuCompressedMatrix with type determined by t, and with the &#39;range&#39; and ...">NewCuCompressedMatrix()</a>). arg3 will be converted to the 'truncate' argument to the class <a class="el" href="classkaldi_1_1CuCompressedMatrix.html" title="Class CuCompressedMatrix, templated on an integer type (expected to be one of: int8, uint8, int16, uint16), this provides a way to approximate a CuMatrix in a more memory-efficient format. ">CuCompressedMatrix</a>; it should be false (0) if you know that the input is limited to the allowed range, and true (1) if the input may exceed that range (see docs for CuCompresedMatrix).</li>
<li>kDecompressMatrix: Decompresses the matrix which is referred to by submatrix-index arg1 (it should previously have been compressed).</li>
<li>kAcceptInput: accepts a matrix of input from the user, which may be either features, or derivatives w.r.t. the output. arg1 is the submatrix index of a whole matrix that the input goes to, and arg2 is the index of the network node associated with it (e.g. the node of "input" or "ivector"), for puroses of double checking.</li>
<li>kProvideOutput: outputs a matrix to the user: either a network output, or a matrix of derivatives w.r.t. an input. arg1 is the submatrix index of the output (which we expect to be a whole matrix), arg2 is the index of the network node associated with it (e.g. the node for "output").</li>
<li>kNoOperation: does nothing, and will be removed by optimization code (sometimes useful during optimization)</li>
<li>kNoOperationPermanent: like kNoOperation, but won't be removed by optimization code. This is used to ensure that for 'trivial' computations, which just copy the input to the output, the block of commands for the forward or backward propagation is nonempty (to avoid confusing the computation code).</li>
<li>kNoOperationMarker: does nothing, but used to mark end of a block of commands (like forward commands).</li>
<li>kNoOperationLabel: does nothing, but is the destination for the kGotoLabel command.</li>
<li>kGotoLabel: jumps to the kNoOperationLabel command. arg1 must be set to the location of that command. Since there are no conditionals, the kGotoLabel command should be the last command, as remaining commands will be unreachable. </li>
</ul>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"></a>kAllocMatrix&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"></a>kDeallocMatrix&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"></a>kSwapMatrix&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"></a>kSetConst&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"></a>kPropagate&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"></a>kBackprop&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"></a>kBackpropNoModelUpdate&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"></a>kMatrixCopy&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"></a>kMatrixAdd&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"></a>kCopyRows&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"></a>kAddRows&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"></a>kCopyRowsMulti&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"></a>kCopyToRowsMulti&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"></a>kAddRowsMulti&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"></a>kAddToRowsMulti&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"></a>kAddRowRanges&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9"></a>kCompressMatrix&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada"></a>kDecompressMatrix&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"></a>kAcceptInput&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"></a>kProvideOutput&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"></a>kNoOperation&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"></a>kNoOperationPermanent&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"></a>kNoOperationMarker&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"></a>kNoOperationLabel&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"></a>kGotoLabel&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="nnet-computation_8h_source.html#l00288">288</a> of file <a class="el" href="nnet-computation_8h_source.html">nnet-computation.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                 {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>,</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>,</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>,</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a> };</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kaldi::nnet3::kCompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kaldi::nnet3::kBackpropNoModelUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kaldi::nnet3::kNoOperationLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kaldi::nnet3::kDecompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a36da016976f88292c0d31653a20cbfe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36da016976f88292c0d31653a20cbfe3">&#9670;&nbsp;</a></span>ComponentProperties</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3">ComponentProperties</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a5530b2f8f01fac9e6e73fd29a65d4127"></a>kSimpleComponent&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"></a>kUpdatableComponent&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d"></a>kPropagateInPlace&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7"></a>kPropagateAdds&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67"></a>kReordersIndexes&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90"></a>kBackpropAdds&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7"></a>kBackpropNeedsInput&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841"></a>kBackpropNeedsOutput&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df"></a>kBackpropInPlace&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827"></a>kStoresStats&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94"></a>kInputContiguous&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9"></a>kOutputContiguous&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658"></a>kUsesMemo&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a36da016976f88292c0d31653a20cbfe3a7526d98193f4d5b839d6026397f6ce0b"></a>kRandomComponent&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="nnet-component-itf_8h_source.html#l00037">37</a> of file <a class="el" href="nnet-component-itf_8h_source.html">nnet-component-itf.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                         {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5530b2f8f01fac9e6e73fd29a65d4127">kSimpleComponent</a> = 0x001,  <span class="comment">// true if number of rows of input equals number of rows</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                             <span class="comment">// of output and this component doesn&#39;t care about the indexes</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                             <span class="comment">// (i.e. it maps each row of input to each row of output without</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                             <span class="comment">// regard to the index values).  Will normally be true.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a> = 0x002,  <span class="comment">// true if the component has parameters that can</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                <span class="comment">// be updated.  Components that return this flag</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                                <span class="comment">// must be dynamic_castable to type</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                <span class="comment">// UpdatableComponent (but components of type</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                <span class="comment">// UpdatableComponent do not have to return this</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                <span class="comment">// flag, e.g.  if this instance is not really</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                <span class="comment">// updatable).</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d">kPropagateInPlace</a> = 0x004,  <span class="comment">// true if we can do the propagate operation in-place</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                              <span class="comment">// (input and output matrices are the same).</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                              <span class="comment">// Note: if doing backprop, you&#39;d also need to check</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                              <span class="comment">// that the kBackpropNeedsInput property is not true.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7">kPropagateAdds</a> = 0x008,  <span class="comment">// true if the Propagate function adds to, rather</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                           <span class="comment">// than setting, its output, for non-in-place</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                           <span class="comment">// propagation.  The Component chooses whether to add</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                           <span class="comment">// or set, and the calling code has to accommodate</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                           <span class="comment">// it.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67">kReordersIndexes</a> = 0x010,  <span class="comment">// true if the ReorderIndexes function might reorder</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                             <span class="comment">// the indexes (otherwise we can skip calling it).</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                             <span class="comment">// Must not be set for simple components.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90">kBackpropAdds</a> = 0x020,   <span class="comment">// true if the Backprop function adds to, rather than</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                           <span class="comment">// setting, the &quot;in_deriv&quot; output for non-in-place</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                           <span class="comment">// backprop.  The Component chooses whether to add or</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                           <span class="comment">// set, and the calling code has to accommodate it.</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kBackpropNeedsInput</a> = 0x040,  <span class="comment">// true if backprop operation needs access to</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                <span class="comment">// forward-pass input.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kBackpropNeedsOutput</a> = 0x080,  <span class="comment">// true if backprop operation needs access to</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                                 <span class="comment">// forward-pass output (e.g. true for Sigmoid).</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df">kBackpropInPlace</a> = 0x100,   <span class="comment">// true if we can do the backprop operation in-place</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                             <span class="comment">// (input and output matrices may be the same).</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827">kStoresStats</a> = 0x200,      <span class="comment">// true if the StoreStats operation stores</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                             <span class="comment">// statistics e.g. on average node activations and</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                             <span class="comment">// derivatives of the nonlinearity, (as it does for</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                             <span class="comment">// Tanh, Sigmoid, ReLU and Softmax).</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kInputContiguous</a> = 0x400,  <span class="comment">// true if the component requires its input data (and</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                              <span class="comment">// input derivatives) to have Stride()== NumCols().</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kOutputContiguous</a> = 0x800,  <span class="comment">// true if the component requires its input data (and</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                               <span class="comment">// output derivatives) to have Stride()== NumCols().</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658">kUsesMemo</a> = 0x1000,  <span class="comment">// true if the component returns a void* pointer from its</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                       <span class="comment">// Propagate() function that needs to be passed into the</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                       <span class="comment">// corresponding Backprop function.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a7526d98193f4d5b839d6026397f6ce0b">kRandomComponent</a> = 0x2000   <span class="comment">// true if the component has some kind of</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                              <span class="comment">// randomness, like DropoutComponent (these should</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                              <span class="comment">// inherit from class RandomComponent.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;};</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kaldi::nnet3::kOutputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00077">nnet-component-itf.h:77</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a7526d98193f4d5b839d6026397f6ce0b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a7526d98193f4d5b839d6026397f6ce0b">kaldi::nnet3::kRandomComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00082">nnet-component-itf.h:82</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a1713e609229066c956d4c7d544c69658">kaldi::nnet3::kUsesMemo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00079">nnet-component-itf.h:79</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kaldi::nnet3::kBackpropNeedsOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00067">nnet-component-itf.h:67</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d">kaldi::nnet3::kPropagateInPlace</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00049">nnet-component-itf.h:49</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a5530b2f8f01fac9e6e73fd29a65d4127"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5530b2f8f01fac9e6e73fd29a65d4127">kaldi::nnet3::kSimpleComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00038">nnet-component-itf.h:38</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3affff5abfeafd5643bee15f1daafe6827">kaldi::nnet3::kStoresStats</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00071">nnet-component-itf.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kaldi::nnet3::kBackpropNeedsInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00065">nnet-component-itf.h:65</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7">kaldi::nnet3::kPropagateAdds</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00053">nnet-component-itf.h:53</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df">kaldi::nnet3::kBackpropInPlace</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00069">nnet-component-itf.h:69</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kaldi::nnet3::kInputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00075">nnet-component-itf.h:75</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67">kaldi::nnet3::kReordersIndexes</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00058">nnet-component-itf.h:58</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90">kaldi::nnet3::kBackpropAdds</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00061">nnet-component-itf.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a75a9acd74effffae38daed55136b0980"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75a9acd74effffae38daed55136b0980">&#9670;&nbsp;</a></span>FillMode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980">FillMode</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738"></a>kNearest&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee"></a>kReflect&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet3-egs-augment-image_8cc_source.html">nnet3-egs-augment-image.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{ <a class="code" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738">kNearest</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee">kReflect</a> };</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee">kaldi::nnet3::kReflect</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00031">nnet3-egs-augment-image.cc:31</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738">kaldi::nnet3::kNearest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00031">nnet3-egs-augment-image.cc:31</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acac9cbaeea226ed297804c012dc12b16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acac9cbaeea226ed297804c012dc12b16">&#9670;&nbsp;</a></span>NodeType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16">NodeType</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"></a>kInput&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b"></a>kDescriptor&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"></a>kComponent&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db"></a>kDimRange&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="acac9cbaeea226ed297804c012dc12b16a634ee767a8e90ff4d56e140459cca31f"></a>kNone&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="_2nnet-nnet_8h_source.html#l00055">55</a> of file <a class="el" href="_2nnet-nnet_8h_source.html">nnet-nnet.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{ <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kDimRange</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a634ee767a8e90ff4d56e140459cca31f">kNone</a> };</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a634ee767a8e90ff4d56e140459cca31f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a634ee767a8e90ff4d56e140459cca31f">kaldi::nnet3::kNone</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kaldi::nnet3::kDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kaldi::nnet3::kDimRange</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45660f9909187129a953fa05e664576e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45660f9909187129a953fa05e664576e">&#9670;&nbsp;</a></span>ObjectiveType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576e">ObjectiveType</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This enum is for a kind of annotation we associate with output nodes of the network; it's for the convenience of calling code so that if the objective is one of a few standard types, we can compute it directly and know how to interpret the supervision labels. </p>
<p>However, the core of the framework never makes use of the objective types, other than making them available to calling code which then supplies the derivatives.</p><ul>
<li>Objective type kLinear is intended for Neural nets where the final component is a <a class="el" href="classkaldi_1_1nnet3_1_1LogSoftmaxComponent.html">LogSoftmaxComponent</a>, so the log-prob (negative cross-entropy) objective is just a linear function of the input.</li>
<li>Objective type kQuadratic is used to mean the objective function f(x, y) = -0.5 (x-y).(x-y), which is to be maximized, as in the kLinear case. </li>
</ul>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d"></a>kLinear&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2"></a>kQuadratic&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="_2nnet-nnet_8h_source.html#l00052">52</a> of file <a class="el" href="_2nnet-nnet_8h_source.html">nnet-nnet.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{ <a class="code" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d">kLinear</a>, <a class="code" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2">kQuadratic</a> };</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d">kaldi::nnet3::kLinear</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00052">nnet-nnet.h:52</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2">kaldi::nnet3::kQuadratic</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00052">nnet-nnet.h:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac9680bf4ad4dd4fd305f913ff398c14e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9680bf4ad4dd4fd305f913ff398c14e">&#9670;&nbsp;</a></span>AddNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does *dest += alpha * src (affects nnet parameters and stored stats). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00340">340</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-component-itf_8h_source.html#l00370">Component::Add()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-average_8cc_source.html#l00079">main()</a>, <a class="el" href="nnet3-average_8cc_source.html#l00057">kaldi::ReadModels()</a>, <a class="el" href="nnet-discriminative-training_8cc_source.html#l00063">NnetDiscriminativeTrainer::Train()</a>, and <a class="el" href="nnet3-combine_8cc_source.html#l00066">UpdateNnetMovingAverage()</a>.</p>
<div class="fragment"><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                                           {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (src.NumComponents() != dest-&gt;NumComponents())</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Trying to add incompatible nnets.&quot;</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; src.NumComponents(); c++) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keyword">const</span> Component *src_comp = src.GetComponent(c);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    Component *dest_comp = dest-&gt;GetComponent(c);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    dest_comp-&gt;Add(alpha, *src_comp);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad24a2545a15f4ffa0e76652742767aac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad24a2545a15f4ffa0e76652742767aac">&#9670;&nbsp;</a></span>AddNnetComponents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddNnetComponents </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>alphas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does *dest += alpha * src for updatable components (affects nnet parameters), and *dest += scale * src for other components (affects stored stats). </p>
<p>Here, alphas is a vector of size equal to the number of updatable components </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00313">313</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-component-itf_8h_source.html#l00370">Component::Add()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l02013">UpdateNnetWithMaxChange()</a>.</p>
<div class="fragment"><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                                    {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">if</span> (src.NumComponents() != dest-&gt;NumComponents())</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Trying to add incompatible nnets.&quot;</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; src.NumComponents(); c++) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keyword">const</span> Component *src_comp = src.GetComponent(c);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    Component *dest_comp = dest-&gt;GetComponent(c);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">if</span> (src_comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="comment">// For now all updatable components inherit from class UpdatableComponent.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="comment">// If that changes in future, we will change this code.</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keyword">const</span> UpdatableComponent *src_uc =</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(src_comp);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      UpdatableComponent *dest_uc =</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;          <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(dest_comp);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">if</span> (src_uc == NULL || dest_uc == NULL)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Updatable component does not inherit from class &quot;</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="stringliteral">&quot;UpdatableComponent; change this code.&quot;</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(i &lt; alphas.Dim());</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      dest_uc-&gt;Add(alphas(i++), *src_uc);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// add stored stats</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      dest_comp-&gt;Add(scale, *src_comp);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(i == alphas.Dim());</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef1d1a23b16cf461b7e7e049ae0be89b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef1d1a23b16cf461b7e7e049ae0be89b">&#9670;&nbsp;</a></span>AddTimeOffsetToComputationRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::AddTimeOffsetToComputationRequest </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>t_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00235">235</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, and <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00251">ExtrapolateComputationRequest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                                                    {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request-&gt;inputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">size_t</span> size = request-&gt;inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; size; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      request-&gt;inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].t += t_offset;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request-&gt;outputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordtype">size_t</span> size = request-&gt;outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; size; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      request-&gt;outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].t += t_offset;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adbaeb0c690e96bd285e79a287882f13e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbaeb0c690e96bd285e79a287882f13e">&#9670;&nbsp;</a></span>AppendCindexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AppendCindexes </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Appends to 'out' the pairs (node, indexes[0]), (node, indexes[1]), ... </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile_8cc_source.html#l01375">1375</a> of file <a class="el" href="nnet-compile_8cc_source.html">nnet-compile.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l01346">Compiler::OutputDebugInfo()</a>.</p>
<div class="fragment"><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                                            {</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="keywordtype">size_t</span> indexes_size = indexes.size();</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keywordflow">if</span> (indexes_size &gt; out-&gt;size())</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    out-&gt;reserve(out-&gt;size() + indexes_size);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; indexes_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    out-&gt;push_back(<a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a>(node, indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8344e7587df9247d6cc492874901d4d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">kaldi::nnet3::Cindex</a></div><div class="ttdeci">std::pair&lt; int32, Index &gt; Cindex</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00115">nnet-common.h:115</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf6dcdd416f3076af7f4d00cc53f7e57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf6dcdd416f3076af7f4d00cc53f7e57">&#9670;&nbsp;</a></span>ApplyAffineTransform()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ApplyAffineTransform </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>transform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_channels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980">FillMode</a>&#160;</td>
          <td class="paramname"><em>fill_mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function applies a geometric transformation 'transform' to the image. </p>
<p>Reference: Digital Image Processing book by Gonzalez and Woods. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">transform</td><td>The 3x3 geometric transformation matrix to apply. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_channels</td><td>Number of channels (i.e. colors) of the image </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">image</td><td>The image matrix to be modified. image-&gt;NumRows() is the width (number of x values) in the image; image-&gt;NumCols() is the height times number of channels (channel varies the fastest). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00110">110</a> of file <a class="el" href="nnet3-egs-augment-image_8cc_source.html">nnet3-egs-augment-image.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00031">kNearest</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00034">ImageAugmentationConfig::num_channels</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00205">PerturbImage()</a>.</p>
<div class="fragment"><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                              {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  int32 num_rows = image-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(),</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        num_cols = image-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>(),</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        height = num_cols / num_channels,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        width = num_rows;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_cols % num_channels == 0);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> original_image(*image);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">for</span> (int32 r = 0; r &lt; width; r++) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">for</span> (int32 c = 0; c &lt; height; c++) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">// (r_old, c_old) is the coordinate of the pixel in the original image</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="comment">// while (r, c) is the coordinate in the new (transformed) image.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> r_old = transform(0, 0) * r +</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                          transform(0, 1) * c + transform(0, 2);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> c_old = transform(1, 0) * r +</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                          transform(1, 1) * c + transform(1, 2);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="comment">// We are going to do bilinear interpolation between 4 closest points</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="comment">// to the point (r_old, c_old) of the original image. We have:</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="comment">// r1  &lt;=  r_old  &lt;=  r2</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="comment">// c1  &lt;=  c_old  &lt;=  c2</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      int32 r1 = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(floor(r_old));</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      int32 c1 = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(floor(c_old));</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      int32 r2 = r1 + 1;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      int32 c2 = c1 + 1;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="comment">// These weights determine how much each of the 4 points contributes</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="comment">// to the final interpolated value:</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> weight_11 = (r2 - r_old) * (c2 - c_old),</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;          weight_12 = (r2 - r_old) * (c_old - c1),</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          weight_21 = (r_old - r1) * (c2 - c_old),</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          weight_22 = (r_old - r1) * (c_old - c1);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">// Handle edge conditions:</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keywordflow">if</span> (fill_mode == <a class="code" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738">kNearest</a>) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">if</span> (r1 &lt; 0) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;          r1 = 0;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          <span class="keywordflow">if</span> (r2 &lt; 0) r2 = 0;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span> (r2 &gt;= width) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          r2 = width - 1;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          <span class="keywordflow">if</span> (r1 &gt;= width) r1 = width - 1;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> (c1 &lt; 0) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          c1 = 0;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          <span class="keywordflow">if</span> (c2 &lt; 0) c2 = 0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">if</span> (c2 &gt;= height) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;          c2 = height - 1;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          <span class="keywordflow">if</span> (c1 &gt;= height) c1 = height - 1;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(fill_mode == <a class="code" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee">kReflect</a>);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">if</span> (r1 &lt; 0) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;          r1 = - r1;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;          <span class="keywordflow">if</span> (r2 &lt; 0) r2 = - r2;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">if</span> (r2 &gt;= width) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;          r2 = 2 * width - 2 - r2;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <span class="keywordflow">if</span> (r1 &gt;= width) r1 = 2 * width - 2 - r1;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">if</span> (c1 &lt; 0) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;          c1 = - c1;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          <span class="keywordflow">if</span> (c2 &lt; 0) c2 = -c2;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span> (c2 &gt;= height) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;          c2 = 2 * height - 2 - c2;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <span class="keywordflow">if</span> (c1 &gt;= height) c1 = 2 * height - 2 - c1;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">for</span> (int32 ch = 0; ch &lt; num_channels; ch++) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// find the values at the 4 points</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> p11 = original_image(r1, num_channels * c1 + ch),</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            p12 = original_image(r1, num_channels * c2 + ch),</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            p21 = original_image(r2, num_channels * c1 + ch),</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            p22 = original_image(r2, num_channels * c2 + ch);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        (*image)(r, num_channels * c + ch) = weight_11 * p11 + weight_12 * p12 +</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            weight_21 * p21 + weight_22 * p22;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div><div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a0900081aab4c53cf6a952488b0df93ee">kaldi::nnet3::kReflect</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00031">nnet3-egs-augment-image.cc:31</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980a2a2cb3d726afad6784bef51552684738">kaldi::nnet3::kNearest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00031">nnet3-egs-augment-image.cc:31</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5240f2d016ad928b0034835c77f5b2cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5240f2d016ad928b0034835c77f5b2cb">&#9670;&nbsp;</a></span>ApplyL2Regularization()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ApplyL2Regularization </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>l2_regularize_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>delta_nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is used as part of the regular training workflow, prior to <a class="el" href="namespacekaldi_1_1nnet3.html#a1386d6c6a6d3e9bd00fed536d63cb847" title="This function does the operation &#39;*nnet += scale * delta_nnet&#39;, while respecting any max-parameter-ch...">UpdateNnetWithMaxChange()</a>. </p>
<p>For each updatable component c in the neural net, suppose it has a l2-regularization constant alpha set at the component level (see <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a1a7ae7b8e4ffb6ada1a81ae36e951041" title="Returns the l2 regularization constant, which may be set in any updatable component (usually from the...">UpdatableComponent::L2Regularization()</a>), and a learning-rate eta, then this function does (and this is not real code):</p>
<p>delta_nnet-&gt;c -= 2.0 * l2_regularize_scale * alpha * eta * nnet.c</p>
<p>The factor of -1.0 comes from the fact that we are maximizing, and we'd add the l2 regularization term (of the form ||||_2^2, i.e. squared l2 norm) in the objective function with negative sign; the factor of 2.0 comes from the derivative of the squared parameters. The factor 'l2_regularize_scale' is provided to this function, see below for an explanation.</p>
<p>Note: the way we do it is a little bit approximate, due to the interaction with natural gradient. The issue is that the regular gradients are multiplied by the inverse of the approximated, smoothed and factored inverse Fisher matrix, but the l2 gradients are not. This means that what we're optimizing is not exactly the (regular objective plus the L2 term)&ndash; we could view it as optimizing (regular objective plus the l2 term times the Fisher matrix)&ndash; with the proviso that the Fisher matrix has been scaled in such a way that the amount of parameter change is not affected, so this is not an issue of affecting the overall strength of l2, just an issue of the direction-wise weighting. In effect, the l2 term will be larger, relative to the gradient contribution, in directions where the Fisher matrix is large. This is probably not ideal&ndash; but it's hard to judge without experiments. Anyway the l2 effect is small enough, and the Fisher matrix sufficiently smoothed with the identity, that I doubt this makes much of a difference.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nnet</td><td>The neural net that is being trained; expected to be different from delta_nnet </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">l2_regularize_scale</td><td>A scale on the l2 regularization. Usually this will be equal to the number of distinct examples (e.g. the number of chunks of speech&ndash; more precisely, the number of distinct 'n' values) in the minibatch, but this is multiplied by a configuration value &ndash;l2-regularize-factor passed in from the command line. The reason for making l2 proportional to the number of elements in the minibatch is that we add the parameter gradients over the minibatch (we don't average), so multiplying the l2 factor by the number of elements in the minibatch is necessary to make the amount of l2 vs. gradient contribution stay the same when we vary the minibatch size. The &ndash;l2-regularize-factor option is provided so that the calling script can correct for the effects of parallelization via model-averaging (we'd normally set this to 1/num-parallel-jobs). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">delta_nnet</td><td>The neural net containing the parameter updates; this is a copy of 'nnet' that is used for purposes of momentum and applying max-change values. This is what this code adds to. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l02151">2151</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-component-itf_8h_source.html#l00370">Component::Add()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00522">UpdatableComponent::L2Regularization()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00505">UpdatableComponent::LearningRate()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00170">NnetChainTrainer::TrainInternal()</a>, <a class="el" href="nnet-training_8cc_source.html#l00093">NnetTrainer::TrainInternal()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00223">NnetChainTrainer::TrainInternalBackstitch()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00133">NnetTrainer::TrainInternalBackstitch()</a>.</p>
<div class="fragment"><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                                             {</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="keywordflow">if</span> (l2_regularize_scale == 0.0)</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet.NumComponents(); c++) {</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="keyword">const</span> Component *src_component_in = nnet.GetComponent(c);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    <span class="keywordflow">if</span> (src_component_in-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <span class="keyword">const</span> UpdatableComponent *src_component =</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(src_component_in);</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      UpdatableComponent *dest_component =</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;          <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(delta_nnet-&gt;GetComponent(c));</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="comment">// The following code will segfault if they aren&#39;t both updatable, which</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <span class="comment">// would be a bug in the calling code.</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> lrate = dest_component-&gt;LearningRate(),</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;          l2_regularize = dest_component-&gt;L2Regularization();</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lrate &gt;= 0 &amp;&amp; l2_regularize &gt;= 0);</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale = -2.0 * l2_regularize_scale * lrate * l2_regularize;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      <span class="keywordflow">if</span> (scale != 0.0)</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        dest_component-&gt;Add(scale, *src_component);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    }</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;  }</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1b9cf952746776c000ad16fcc9a9f990"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b9cf952746776c000ad16fcc9a9f990">&#9670;&nbsp;</a></span>AssertGraphEqual()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::AssertGraphEqual </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00026">26</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00148">UnitTestComputeGraphTranspose()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00160">UnitTestFindSccs()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00172">UnitTestMakeSccGraph()</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                                                  {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">if</span> (graph1.size() != graph2.size()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; graph1.size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">if</span> (graph1[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size() != graph2[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; graph1[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); ++<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      <span class="keywordflow">if</span> (graph1[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] != graph2[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a60bde0a269254ed7c2471823ba362d75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60bde0a269254ed7c2471823ba362d75">&#9670;&nbsp;</a></span>AssertVectorEqual()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::AssertVectorEqual </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00038">38</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00187">UnitTestComputeTopSortOrder()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00199">UnitTestComputeTopSortOrder2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                                     {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">if</span> (vec1.size() != vec2.size()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; vec1.size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">if</span> (vec1[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != vec2[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2cf1ba5597d79505ed5fd378338740bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cf1ba5597d79505ed5fd378338740bb">&#9670;&nbsp;</a></span>BuildTestGraph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::BuildTestGraph </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00047">47</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00148">UnitTestComputeGraphTranspose()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00160">UnitTestFindSccs()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00172">UnitTestMakeSccGraph()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                         {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(graph != NULL);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  graph-&gt;clear();</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  graph-&gt;resize(8);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// We create the following graph for testing.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// 0 --&gt; 4</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// 1 --&gt; 0</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// 2 --&gt; 1 3</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// 3 --&gt; 2</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">// 4 --&gt; 1</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">// 5 --&gt; 1 4 6</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">// 6 --&gt; 5</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">// 7 --&gt; 7 3 6</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  std::vector&lt;int32&gt; tmp;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  tmp.resize(1); tmp[0] = 4; (*graph)[0] = tmp;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  tmp.resize(1); tmp[0] = 0; (*graph)[1] = tmp;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  tmp.resize(2); tmp[0] = 1; tmp[1] = 3; (*graph)[2] = tmp;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  tmp.resize(1); tmp[0] = 2; (*graph)[3] = tmp;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  tmp.resize(1); tmp[0] = 1; (*graph)[4] = tmp;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  tmp.resize(3); tmp[0] = 1; tmp[1] = 4; tmp[2] = 6; (*graph)[5] = tmp;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  tmp.resize(1); tmp[0] = 5; (*graph)[6] = tmp;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  tmp.resize(3); tmp[0] = 7; tmp[1] = 3; tmp[2] = 6; (*graph)[7] = tmp;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d0ace1de8245a113abc6674f184a19f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d0ace1de8245a113abc6674f184a19f">&#9670;&nbsp;</a></span>BuildTestGraphTranspose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::BuildTestGraphTranspose </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00072">72</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00148">UnitTestComputeGraphTranspose()</a>.</p>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                                                                  {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(graph != NULL);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  graph-&gt;clear();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  graph-&gt;resize(8);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// We create the following graph for testing.</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// 0 --&gt; 1</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// 1 --&gt; 2 4 5</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">// 2 --&gt; 3</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// 3 --&gt; 2 7</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// 4 --&gt; 0 5</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// 5 --&gt; 6</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// 6 --&gt; 5 7</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// 7 --&gt; 7</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  std::vector&lt;int32&gt; tmp;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  tmp.resize(1); tmp[0] = 1; (*graph)[0] = tmp;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  tmp.resize(3); tmp[0] = 2; tmp[1] = 4; tmp[2] = 5; (*graph)[1] = tmp;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  tmp.resize(1); tmp[0] = 3; (*graph)[2] = tmp;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  tmp.resize(2); tmp[0] = 2; tmp[1] = 7; (*graph)[3] = tmp;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  tmp.resize(2); tmp[0] = 0; tmp[1] = 5; (*graph)[4] = tmp;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  tmp.resize(1); tmp[0] = 6; (*graph)[5] = tmp;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  tmp.resize(2); tmp[0] = 5; tmp[1] = 7; (*graph)[6] = tmp;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  tmp.resize(1); tmp[0] = 7; (*graph)[7] = tmp;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa97309456d46852962866b097697c6b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa97309456d46852962866b097697c6b7">&#9670;&nbsp;</a></span>BuildTestSccGraph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::BuildTestSccGraph </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>scc_graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00114">114</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00187">UnitTestComputeTopSortOrder()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00172">UnitTestMakeSccGraph()</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                                                {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(scc_graph != NULL);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  scc_graph-&gt;clear();</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  scc_graph-&gt;resize(4);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// We create the following SCC graph for testing.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// 0 --&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// 1 --&gt; 0</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// 2 --&gt; 0</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// 3 --&gt; 1 2</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  std::vector&lt;int32&gt; tmp;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  tmp.resize(0); (*scc_graph)[0] = tmp;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  tmp.resize(1); tmp[0] = 0; (*scc_graph)[1] = tmp;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  tmp.resize(1); tmp[0] = 0; (*scc_graph)[2] = tmp;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  tmp.resize(2); tmp[0] = 1; tmp[1] = 2; (*scc_graph)[3] = tmp;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0081c3d0993ad39f10df0eb4857188f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0081c3d0993ad39f10df0eb4857188f5">&#9670;&nbsp;</a></span>BuildTestSccs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::BuildTestSccs </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sccs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00097">97</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00160">UnitTestFindSccs()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00172">UnitTestMakeSccGraph()</a>.</p>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                                                       {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sccs != NULL);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  sccs-&gt;clear();</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  sccs-&gt;resize(4);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// We create the following SCCs for testing.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// 0 --&gt; 1 4 0</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// 1 --&gt; 3 2</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">// 2 --&gt; 6 5</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// 3 --&gt; 7</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  std::vector&lt;int32&gt; tmp;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  tmp.resize(3); tmp[0] = 1; tmp[1] = 4; tmp[2] = 0; (*sccs)[0] = tmp;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  tmp.resize(2); tmp[0] = 3; tmp[1] = 2; (*sccs)[1] = tmp;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  tmp.resize(2); tmp[0] = 6; tmp[1] = 5; (*sccs)[2] = tmp;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  tmp.resize(1); tmp[0] = 7; (*sccs)[3] = tmp;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1a8af0bfaf3239fc5f740444edc92874"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a8af0bfaf3239fc5f740444edc92874">&#9670;&nbsp;</a></span>BuildTestTopSortOrder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::BuildTestTopSortOrder </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>node_to_order</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00131">131</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00187">UnitTestComputeTopSortOrder()</a>.</p>
<div class="fragment"><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                                            {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node_to_order != NULL);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  node_to_order-&gt;clear();</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  node_to_order-&gt;resize(4);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// The topological sorting order of the above SCC graph is as follows (from</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// our particular algorithm):</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// 0 --&gt; 3</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// 1 --&gt; 2</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// 2 --&gt; 1</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">// 3 --&gt; 0</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  (*node_to_order)[0] = 3;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  (*node_to_order)[1] = 2;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  (*node_to_order)[2] = 1;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  (*node_to_order)[3] = 0;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acfaf4324ca78917f262c1c733846370e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfaf4324ca78917f262c1c733846370e">&#9670;&nbsp;</a></span>CheckComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>check_rewrite</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is a convenience interface for class <a class="el" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a>. </p>
<p>Call it with check_rewrite = true only if the computation is pre-optimization. If the computation is an 'online' computation, this function treats it specially. </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l01145">1145</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8cc_source.html#l00579">ComputationChecker::Check()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00394">CheckComputationOptions::check_rewrite</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01118">CheckComputationOnline()</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00808">CachingOptimizingCompiler::CompileViaShortcut()</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                                          {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">if</span> (!computation.commands.empty() &amp;&amp;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        computation.commands.back().command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>) {</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="comment">// Online computations need to be treated specially.</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#abb55a5b6af7e1eeacfdba4dc68e3d995">CheckComputationOnline</a>(nnet, computation, check_rewrite);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      CheckComputationOptions opts;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      opts.check_rewrite = check_rewrite;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      ComputationChecker checker(opts, nnet, computation);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      checker.Check();</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    computation.Print(std::cerr, nnet);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Computation check failed for computation printed above &quot;</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="stringliteral">&quot;(actual error message is above computation)&quot;</span>;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  }</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_abb55a5b6af7e1eeacfdba4dc68e3d995"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abb55a5b6af7e1eeacfdba4dc68e3d995">kaldi::nnet3::CheckComputationOnline</a></div><div class="ttdeci">static void CheckComputationOnline(const Nnet &amp;nnet, NnetComputation computation, bool check_rewrite)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01118">nnet-analyze.cc:1118</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb55a5b6af7e1eeacfdba4dc68e3d995"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb55a5b6af7e1eeacfdba4dc68e3d995">&#9670;&nbsp;</a></span>CheckComputationOnline()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::CheckComputationOnline </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>check_rewrite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l01118">1118</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8cc_source.html#l00579">ComputationChecker::Check()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00394">CheckComputationOptions::check_rewrite</a>, <a class="el" href="nnet-analyze_8h_source.html#l00400">CheckComputationOptions::check_unused_variables</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSwapMatrix</a>, and <a class="el" href="basic-filebuf_8h_source.html#l00275">kaldi::swap()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-analyze_8cc_source.html#l01145">CheckComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                                                       {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  int32 num_commands = computation.commands.size();</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation.commands[num_commands-1].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="keywordflow">for</span> (int32 c = num_commands - 2;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;       c &gt;= 0 &amp;&amp; computation.commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;       c--) {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="comment">// this command can be interpreted as &quot;initialize matrix referred to by</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="comment">// c.arg2 with the matrix referred to by c.arg2&quot;.</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="comment">// Because this would be interpreted by the analysis code as initializing a</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="comment">// matrix that has already been initialized, we turn this into a command</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">// that just deallocates the matrix in c.arg2. [note: all these indexes</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="comment">// are actually submatrix indexes].</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    computation.commands[c].command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <a class="code" href="namespacekaldi.html#aa3e99328db564bc2bf6397fa1eaee4d7">std::swap</a>(computation.commands[c].arg1, computation.commands[c].arg2);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  CheckComputationOptions opts;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  opts.check_rewrite = check_rewrite;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  opts.check_unused_variables = <span class="keyword">false</span>;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="comment">// We can always do this check with online computations, since they do not</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="comment">// have the RemoveUnnecessaryAllocation() optimization applied.</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  ComputationChecker checker(opts, nnet, computation);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  checker.Check();</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa3e99328db564bc2bf6397fa1eaee4d7"><div class="ttname"><a href="namespacekaldi.html#aa3e99328db564bc2bf6397fa1eaee4d7">kaldi::swap</a></div><div class="ttdeci">void swap(basic_filebuf&lt; CharT, Traits &gt; &amp;x, basic_filebuf&lt; CharT, Traits &gt; &amp;y)</div><div class="ttdef"><b>Definition:</b> <a href="basic-filebuf_8h_source.html#l00275">basic-filebuf.h:275</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3dcc4499fe158f988c4b26b757b213e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dcc4499fe158f988c4b26b757b213e9">&#9670;&nbsp;</a></span>CheckStringsApproxEqual()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::CheckStringsApproxEqual </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>tolerance</em> = <code>3</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00039">39</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, and <a class="el" href="text-utils_8cc_source.html#l00335">kaldi::StringsApproxEqual()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00076">TestNnetComponentAddScale()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00052">TestNnetComponentIo()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00109">TestNnetComponentUpdatable()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00086">TestNnetComponentVectorizeUnVectorize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                                  {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39775d63fc4873bac0e3b3009b275547">StringsApproxEqual</a>(a, b, tolerance)) {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Strings differ: &quot;</span> &lt;&lt; a</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;\nvs.\n&quot;</span> &lt;&lt; b;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a39775d63fc4873bac0e3b3009b275547"><div class="ttname"><a href="namespacekaldi.html#a39775d63fc4873bac0e3b3009b275547">kaldi::StringsApproxEqual</a></div><div class="ttdeci">bool StringsApproxEqual(const std::string &amp;a, const std::string &amp;b, int32 decimal_places_tolerance)</div><div class="ttdoc">This function returns true when two text strings are approximately equal, and false when they are not...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00335">text-utils.cc:335</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a34c5db7f905e0ab11b678443cb65f930"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34c5db7f905e0ab11b678443cb65f930">&#9670;&nbsp;</a></span>CollapseModel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CollapseModel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1CollapseModelConfig.html">CollapseModelConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function modifies the neural net for efficiency, in a way that suitable to be done in test time. </p>
<p>For example, it tries to get rid of dropout, batchnorm and fixed-scale components, and to collapse subsequent affine components if doing so won't hurt speed. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l02007">2007</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l01358">ModelCollapser::Collapse()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, <a class="el" href="nnet3-align-compiled_8cc_source.html#l00035">main()</a>, and <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>.</p>
<div class="fragment"><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                               {</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  ModelCollapser c(config, nnet);</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  c.Collapse();</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="addb1bb9cfaba76d930fa05d16d19bc4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addb1bb9cfaba76d930fa05d16d19bc4a">&#9670;&nbsp;</a></span>CompileLooped()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CompileLooped </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>optimize_opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a" title="CompileLooped() provides an internal interface for &#39;looped&#39; computation. ">CompileLooped()</a> provides an internal interface for 'looped' computation. </p>
<p>It's usable for inference only (not training), meaning that backprop is not supported (for now, at least). <a class="el" href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a" title="CompileLooped() provides an internal interface for &#39;looped&#39; computation. ">CompileLooped()</a> allows you to do the neural net computation for small chunks with increasing 't' values, and naturally cache the intermediate activations (rather than recomputing them every time you see new input data).</p>
<p>This function does both compilation and optimization, so it's like a combination of <a class="el" href="classkaldi_1_1nnet3_1_1Compiler.html#a3ba7e6700716ba8e6dfb85784922001b">Compiler::CreateComputation()</a> [<a class="el" href="nnet-compile_8h.html">nnet-compile.h</a>] and <a class="el" href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14" title="This is the top-level function for optimizing a computation. ">Optimize()</a> [<a class="el" href="nnet-optimize_8h.html">nnet-optimize.h</a>].</p>
<p>You provide 3 computation requests. request1 is the first computation request of an utterance (or other type of segment) that contains any required extra left context in the input. request2 and request3 are the second and third computation request, and must have exactly the same structure, except for a fixed time offset (change in 't' index) between them. This will be extrapolated to an infinite sequence of further requests (request4, request5, etc.). In practice the way it's done is that we extrapolate to a small finite number of requests (like 10), and then attempt to identify a common structure in the computation where, after processing, as an example, the 3nd computation request, the active variables can be identified with those present at, say, the 7th computation request, and we then cut and splice the computation together at this points, like making a tape loop, by adding a goto statement that jumps from the end of the 7th computation request to the end of the 3rd computation request. We also have to identify the variables with each other (merge variables).</p>
<p>That's done in the optimization code. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00329">329</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-looped_8cc_source.html#l00284">CompileLoopedInternal()</a>, <a class="el" href="timer_8h_source.html#l00074">Timer::Elapsed()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, and <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="decodable-simple-looped_8cc_source.html#l00056">DecodableNnetSimpleLoopedInfo::Init()</a>, and <a class="el" href="nnet-compile-test_8cc_source.html#l00120">UnitTestNnetCompileLooped()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                                 {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  int32 num_requests1 = 5, factor = 2, max_requests = 100,</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      num_requests;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  Timer timer;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">for</span> (num_requests = num_requests1; num_requests &lt;= max_requests;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;       num_requests *= factor) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a2c667a8c24645dfc95df6dd93d0d80f1">CompileLoopedInternal</a>(nnet, optimize_opts,</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                             request1, request2, request3,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                             num_requests, computation)) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Spent &quot;</span> &lt;&lt; timer.Elapsed()</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; seconds in looped compilation.&quot;</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Looped compilation failed with &quot;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    &lt;&lt; num_requests &lt;&lt; <span class="stringliteral">&quot; requests, trying &quot;</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    &lt;&lt; (num_requests * factor);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Looped compilation failed with &quot;</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            &lt;&lt; (num_requests/factor) &lt;&lt; <span class="stringliteral">&quot; requests, which &quot;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;we expect should be enough... something &quot;</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;went wrong.&quot;</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a2c667a8c24645dfc95df6dd93d0d80f1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2c667a8c24645dfc95df6dd93d0d80f1">kaldi::nnet3::CompileLoopedInternal</a></div><div class="ttdeci">static bool CompileLoopedInternal(const Nnet &amp;nnet, NnetOptimizeOptions optimize_opts, const ComputationRequest &amp;request1, const ComputationRequest &amp;request2, const ComputationRequest &amp;request3, int32 num_requests, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00284">nnet-compile-looped.cc:284</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2c667a8c24645dfc95df6dd93d0d80f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c667a8c24645dfc95df6dd93d0d80f1">&#9670;&nbsp;</a></span>CompileLoopedInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::CompileLoopedInternal </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a>&#160;</td>
          <td class="paramname"><em>optimize_opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_requests</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00284">284</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, <a class="el" href="nnet-compile-looped_8cc_source.html#l00251">ExtrapolateComputationRequest()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00484">MaxOutputTimeInRequest()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00060">NnetOptimizeOptions::optimize_looped_computation</a>, and <a class="el" href="nnet-computation_8cc_source.html#l01092">ComputationRequest::Print()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00329">CompileLooped()</a>.</p>
<div class="fragment"><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                  {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_requests &gt;= 3);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  std::vector&lt;ComputationRequest&gt; extra_requests(num_requests - 3);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keyword">const</span> ComputationRequest *prev_request = &amp;request2;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keyword">const</span> ComputationRequest *cur_request = &amp;request3;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_requests - 3; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a1cf8122407d1c438a044739d389a64ae">ExtrapolateComputationRequest</a>(*prev_request, *cur_request,</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                       &amp;(extra_requests[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]))) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;prev_request is:&quot;</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      prev_request-&gt;Print(std::cerr);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;cur_request is:&quot;</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      cur_request-&gt;Print(std::cerr);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Computation requests do not have the right relationship&quot;</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    prev_request = cur_request;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    cur_request = &amp;(extra_requests[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  std::vector&lt;const ComputationRequest*&gt; requests;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  requests.push_back(&amp;request1);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  requests.push_back(&amp;request2);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  requests.push_back(&amp;request3);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0; i &lt; num_requests - 3; i++)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    requests.push_back(&amp;(extra_requests[i]));</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  Compiler compiler(requests, nnet);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  CompilerOptions compiler_opts;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  compiler.CreateComputation(compiler_opts, computation);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  optimize_opts.optimize_looped_computation = <span class="keyword">true</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  int32 dont_really_care = <a class="code" href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">MaxOutputTimeInRequest</a>(request3);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14">Optimize</a>(optimize_opts, nnet,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;           dont_really_care, computation);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">return</span> computation-&gt;commands.size() != 0 &amp;&amp;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      computation-&gt;commands.back().command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a1cf8122407d1c438a044739d389a64ae"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1cf8122407d1c438a044739d389a64ae">kaldi::nnet3::ExtrapolateComputationRequest</a></div><div class="ttdeci">static bool ExtrapolateComputationRequest(const ComputationRequest &amp;request1, const ComputationRequest &amp;request2, ComputationRequest *request3)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00251">nnet-compile-looped.cc:251</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac580549257041c725612ff223c99e43c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">kaldi::nnet3::MaxOutputTimeInRequest</a></div><div class="ttdeci">int32 MaxOutputTimeInRequest(const ComputationRequest &amp;request)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00484">nnet-optimize.cc:484</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a602819d33d3a59c128aa4e865e610e14"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14">kaldi::nnet3::Optimize</a></div><div class="ttdeci">void Optimize(const NnetOptimizeOptions &amp;config, const Nnet &amp;nnet, int32 max_output_time_in_request, NnetComputation *computation)</div><div class="ttdoc">This is the top-level function for optimizing a computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00501">nnet-optimize.cc:501</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa155fe7eed7775fce35d644ca845dd9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa155fe7eed7775fce35d644ca845dd9d">&#9670;&nbsp;</a></span>ComponentDotProducts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComponentDotProducts </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>dot_prod</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns dot products between two networks of the same structure (calls the DotProduct functions of the Updatable components and fill in the output vector). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00211">211</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-show-progress_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                                                           {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nnet1.NumComponents() == nnet2.NumComponents());</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  int32 updatable_c = 0;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet1.NumComponents(); c++) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keyword">const</span> Component *comp1 = nnet1.GetComponent(c),</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    *comp2 = nnet2.GetComponent(c);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (comp1-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keyword">const</span> UpdatableComponent</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;          *u_comp1 = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(comp1),</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;          *u_comp2 = dynamic_cast&lt;const UpdatableComponent*&gt;(comp2);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(u_comp1 != NULL &amp;&amp; u_comp2 != NULL);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      dot_prod-&gt;Data()[updatable_c] = u_comp1-&gt;DotProduct(*u_comp2);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      updatable_c++;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(updatable_c == dot_prod-&gt;Dim());</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3bf20c2ae341e8ba04b5e13ef2507a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3bf20c2ae341e8ba04b5e13ef2507a0">&#9670;&nbsp;</a></span>ComputeAccuracy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeAccuracy </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>supervision</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnet_output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>tot_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>tot_accuracy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>tot_weight_vec</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>tot_accuracy_vec</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function computes the frame accuracy for this minibatch. </p>
<p>It interprets the supervision information in "supervision" as labels or soft labels; it picks the maximum element in each row and treats that as the label for purposes of computing the accuracy (in situations where you would care about the accuracy, there will normally be just one nonzero label). The hypothesized labels are computed by taking the neural net output (supplied as a <a class="el" href="classkaldi_1_1CuMatrix.html" title="This class represents a matrix that&#39;s stored on the GPU if we have one, and in memory if not...">CuMatrix</a>), and finding the maximum element in each row. See also the function ComputeObjectiveFunction, declared in <a class="el" href="nnet-training_8h.html">nnet-training.h</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">supervision</td><td>The supervision information (no elements may be negative); only the maximum in each row matters (although we expect that usually there will be just one nonzero element in each row); and the sum of each row is interpreted as a weighting factor (although we expect that this sum will usually be one).</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nnet_output</td><td>The neural net output must have the same dimensions as the supervision. Only the index of the maximum value in each row matters. Ties will be broken in an unspecified way. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tot_weight</td><td>The sum of the values in the supervision matrix </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tot_accuracy</td><td>The total accuracy, equal to the sum over all row indexes r such that the maximum column index of row r of supervision and nnet_output is the same, of the sum of the r'th row of supervision (i.e. the row's weight). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tot_weight_vec</td><td>If non-NULL, we write to this location the counts per-class in the supervision matrix. This is expected to have the same dimension as the corresponding output in the network. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tot_accuracy_vec</td><td>If non-NULL, we write to this location the accuracy per-class. For index j, the value is equal to the sum over all row indexes r such that the maximum column index of row r of supervision is j and nnet_output is also j, of the sum of the r'th row of supervision (i.e. the row's weight) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-diagnostics_8cc_source.html#l00206">206</a> of file <a class="el" href="nnet-diagnostics_8cc_source.html">nnet-diagnostics.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-array-inl_8h_source.html#l00173">CuArrayBase&lt; T &gt;::CopyToVec()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01813">CuMatrixBase&lt; Real &gt;::FindRowMaxId()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00877">GeneralMatrix::GetFullMatrix()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00816">GeneralMatrix::GetMatrix()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00853">GeneralMatrix::GetSparseMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="sparse-matrix_8h_source.html#l00273">kaldi::kCompressedMatrix</a>, <a class="el" href="sparse-matrix_8h_source.html#l00272">kaldi::kFullMatrix</a>, <a class="el" href="sparse-matrix_8h_source.html#l00274">kaldi::kSparseMatrix</a>, <a class="el" href="sparse-matrix_8cc_source.html#l01166">SparseVector&lt; Real &gt;::Max()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00579">VectorBase&lt; Real &gt;::Max()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00791">GeneralMatrix::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00781">GeneralMatrix::NumRows()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00543">SparseMatrix&lt; Real &gt;::Row()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00336">VectorBase&lt; Real &gt;::Set()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00048">SparseVector&lt; Real &gt;::Sum()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>, and <a class="el" href="sparse-matrix_8cc_source.html#l00772">GeneralMatrix::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-diagnostics_8cc_source.html#l00097">NnetComputeProb::ProcessOutputs()</a>.</p>
<div class="fragment"><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                                              {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  int32 num_rows = nnet_output.NumRows(),</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      num_cols = nnet_output.NumCols();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(supervision.NumRows() == num_rows &amp;&amp;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;               supervision.NumCols() == num_cols);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">if</span> (tot_accuracy_vec || tot_weight_vec)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tot_accuracy_vec &amp;&amp; tot_weight_vec &amp;&amp;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                 tot_accuracy_vec-&gt;Dim() == num_cols &amp;&amp;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                 tot_weight_vec-&gt;Dim() == num_cols);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">if</span> (tot_accuracy_vec) tot_accuracy_vec-&gt;Set(0.0);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">if</span> (tot_weight_vec) tot_weight_vec-&gt;Set(0.0);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  CuArray&lt;int32&gt; best_index(num_rows);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  nnet_output.FindRowMaxId(&amp;best_index);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  std::vector&lt;int32&gt; best_index_cpu;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">// wasteful copy, but doesn&#39;t dominate.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  best_index.CopyToVec(&amp;best_index_cpu);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">double</span> tot_weight = 0.0,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      tot_accuracy = 0.0;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">// note: we expect that in most cases where this code is called,</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">// supervision.Type() will be kSparseMatrix.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">switch</span> (supervision.Type()) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3a87ea862fefb9f41cf20a2de202b4a9f9">kCompressedMatrix</a>: {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      Matrix&lt;BaseFloat&gt; mat;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      supervision.GetMatrix(&amp;mat);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        SubVector&lt;BaseFloat&gt; vec(mat, r);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> row_sum = vec.Sum();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        int32 best_index;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        vec.Max(&amp;best_index);  <span class="comment">// discard max value.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        tot_weight += row_sum;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span> (tot_weight_vec)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          (*tot_weight_vec)(best_index) += row_sum;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">if</span> (best_index == best_index_cpu[r]) {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;          tot_accuracy += row_sum;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          <span class="keywordflow">if</span> (tot_accuracy_vec)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            (*tot_accuracy_vec)(best_index) += row_sum;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3af872badd576ccf234e1bccf54f263863">kFullMatrix</a>: {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keyword">const</span> Matrix&lt;BaseFloat&gt; &amp;mat = supervision.GetFullMatrix();</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        SubVector&lt;BaseFloat&gt; vec(mat, r);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> row_sum = vec.Sum();</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        int32 best_index;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        vec.Max(&amp;best_index);  <span class="comment">// discard max value.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        tot_weight += row_sum;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">if</span> (tot_weight_vec)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          (*tot_weight_vec)(best_index) += row_sum;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">if</span> (best_index == best_index_cpu[r]) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          tot_accuracy += row_sum;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;          <span class="keywordflow">if</span> (tot_accuracy_vec)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            (*tot_accuracy_vec)(best_index) += row_sum;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3aef253b40b2456ff5af4ad398301f8aef">kSparseMatrix</a>: {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keyword">const</span> SparseMatrix&lt;BaseFloat&gt; &amp;smat = supervision.GetSparseMatrix();</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keyword">const</span> SparseVector&lt;BaseFloat&gt; &amp;row = smat.Row(r);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> row_sum = row.Sum();</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        int32 best_index;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        row.Max(&amp;best_index);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(best_index &lt; num_cols);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        tot_weight += row_sum;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">if</span> (tot_weight_vec)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          (*tot_weight_vec)(best_index) += row_sum;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span> (best_index == best_index_cpu[r]) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          tot_accuracy += row_sum;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          <span class="keywordflow">if</span> (tot_accuracy_vec)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            (*tot_accuracy_vec)(best_index) += row_sum;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">default</span>: <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad general-matrix type.&quot;</span>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  *tot_weight_out = tot_weight;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  *tot_accuracy_out = tot_accuracy;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div><div class="ttc" id="group__matrix__group_html_gga1b44c0ec7cf5c76c910fd41756787be3af872badd576ccf234e1bccf54f263863"><div class="ttname"><a href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3af872badd576ccf234e1bccf54f263863">kaldi::kFullMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00272">sparse-matrix.h:272</a></div></div>
<div class="ttc" id="group__matrix__group_html_gga1b44c0ec7cf5c76c910fd41756787be3aef253b40b2456ff5af4ad398301f8aef"><div class="ttname"><a href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3aef253b40b2456ff5af4ad398301f8aef">kaldi::kSparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00274">sparse-matrix.h:274</a></div></div>
<div class="ttc" id="group__matrix__group_html_gga1b44c0ec7cf5c76c910fd41756787be3a87ea862fefb9f41cf20a2de202b4a9f9"><div class="ttname"><a href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3a87ea862fefb9f41cf20a2de202b4a9f9">kaldi::kCompressedMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00273">sparse-matrix.h:273</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa02a576b6e9aa0977f3eb52471742b85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa02a576b6e9aa0977f3eb52471742b85">&#9670;&nbsp;</a></span>ComputeCommandAttributes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeCommandAttributes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a> &amp;&#160;</td>
          <td class="paramname"><em>vars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; *&#160;</td>
          <td class="paramname"><em>attributes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l00284">284</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00344">NnetComputation::Command::arg4</a>, <a class="el" href="nnet-computation_8h_source.html#l00345">NnetComputation::Command::arg5</a>, <a class="el" href="nnet-computation_8h_source.html#l00346">NnetComputation::Command::arg6</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="arpa-file-parser-test_8cc_source.html#l00066">count</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00065">CommandAttributes::has_side_effects</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00419">NnetComputation::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00425">NnetComputation::indexes_multi</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00264">IndexesMultiToSubmatrixIndexes()</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kAcceptInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kAddRowRanges</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kAddRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddToRowsMulti</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kBackprop</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00061">kBackpropAdds</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kBackpropNoModelUpdate</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kCompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kCopyRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyToRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kDecompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixAdd</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixCopy</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationMarker</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationPermanent</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kPropagate</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00053">kPropagateAdds</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kProvideOutput</a>, <a class="el" href="nnet-analyze_8h_source.html#l00076">kReadAccess</a>, <a class="el" href="nnet-analyze_8h_source.html#l00078">kReadWriteAccess</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSetConst</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSwapMatrix</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="nnet-analyze_8h_source.html#l00077">kWriteAccess</a>, <a class="el" href="nnet-analyze_8h_source.html#l00059">CommandAttributes::matrices_read</a>, <a class="el" href="nnet-analyze_8h_source.html#l00061">CommandAttributes::matrices_written</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00168">ComputationVariables::RecordAccessForSubmatrix()</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00054">CommandAttributes::submatrices_read</a>, <a class="el" href="nnet-analyze_8h_source.html#l00056">CommandAttributes::submatrices_written</a>, <a class="el" href="nnet-analyze_8h_source.html#l00049">CommandAttributes::variables_read</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00051">CommandAttributes::variables_written</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00048">NnetComputer::Init()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01421">Analyzer::Init()</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00152">MoveSizingCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                              {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  int32 num_commands = computation.commands.size();</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  attributes-&gt;clear();</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  attributes-&gt;resize(num_commands);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">for</span> (int32 command_index = 0; command_index &lt; num_commands; command_index++) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keyword">const</span> NnetComputation::Command &amp;c = computation.commands[command_index];</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    CommandAttributes &amp;attr = (*attributes)[command_index];</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>:</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>:</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">break</span>;  <span class="comment">// the commands above leave the matrix undefined.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>:</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a>:</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        vars.RecordAccessForSubmatrix(c.arg3, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">if</span> (nnet.GetComponent(c.arg1)-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7">kPropagateAdds</a>)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;          vars.RecordAccessForSubmatrix(c.arg4, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          vars.RecordAccessForSubmatrix(c.arg4, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>:</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>:</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        vars.RecordAccessForSubmatrix(c.arg3, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        vars.RecordAccessForSubmatrix(c.arg4, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        vars.RecordAccessForSubmatrix(c.arg5, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span> (nnet.GetComponent(c.arg1)-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90">kBackpropAdds</a>)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;          vars.RecordAccessForSubmatrix(c.arg6, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          vars.RecordAccessForSubmatrix(c.arg6, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">if</span> (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a> &amp;&amp;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            nnet.GetComponent(c.arg1)-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;          attr.has_side_effects = <span class="keyword">true</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>:</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        vars.RecordAccessForSubmatrix(c.arg2, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>:</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        vars.RecordAccessForSubmatrix(c.arg2, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        vars.RecordAccessForSubmatrix(c.arg2, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>: {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;indexes = computation.indexes[c.arg3];</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="comment">// if there are -1&#39;s in &quot;indexes&quot;, then the result of the operation</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="comment">// will depend on the initial value of the matrix, so it&#39;s</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="comment">// a &quot;rw&quot; operation, not a &quot;write&quot; operation.</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">std::count</a>(indexes.begin(), indexes.end(), -1) &gt; 0)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        vars.RecordAccessForSubmatrix(c.arg2, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>: {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        std::vector&lt;int32&gt; submatrix_indexes;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a79ed08ad0dcf1b82a23e4e3c96967502">IndexesMultiToSubmatrixIndexes</a>(computation.indexes_multi[c.arg2],</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                       &amp;submatrix_indexes);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; submatrix_indexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          vars.RecordAccessForSubmatrix(submatrix_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                        <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>: {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        std::vector&lt;int32&gt; submatrix_indexes;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a79ed08ad0dcf1b82a23e4e3c96967502">IndexesMultiToSubmatrixIndexes</a>(computation.indexes_multi[c.arg2],</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                       &amp;submatrix_indexes);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="comment">// note: the CopyRows command assigns zero in cases where</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">// there is no source for some row</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; submatrix_indexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          vars.RecordAccessForSubmatrix(submatrix_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                        <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>:</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>: {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="comment">// if the submatrixes we&#39;re writing to (in kCopyToRowsMulti) had all</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="comment">// rows covered, it would be a pure write operation.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        std::vector&lt;int32&gt; submatrix_indexes;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a79ed08ad0dcf1b82a23e4e3c96967502">IndexesMultiToSubmatrixIndexes</a>(computation.indexes_multi[c.arg2],</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                       &amp;submatrix_indexes);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; submatrix_indexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          vars.RecordAccessForSubmatrix(submatrix_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>,</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                        &amp;attr);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>: {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        vars.RecordAccessForSubmatrix(c.arg2, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>: {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>: {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>: {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>, &amp;attr);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>: {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        vars.RecordAccessForSubmatrix(c.arg1, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>, &amp;attr);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>:</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>:</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>:</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>:</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>:</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unknown command type.&quot;</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;attr.variables_read);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;attr.variables_written);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;attr.submatrices_read);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;attr.submatrices_written);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;attr.matrices_read);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;attr.matrices_written);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kaldi::nnet3::kReadAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00076">nnet-analyze.h:76</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kaldi::nnet3::kCompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a79ed08ad0dcf1b82a23e4e3c96967502"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a79ed08ad0dcf1b82a23e4e3c96967502">kaldi::nnet3::IndexesMultiToSubmatrixIndexes</a></div><div class="ttdeci">static void IndexesMultiToSubmatrixIndexes(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;indexes_multi, std::vector&lt; int32 &gt; *submatrix_indexes)</div><div class="ttdoc">given a vector of pairs from computation.indexes_multi_indexes containing paris (submatrix-index, row-index), this function outputs to &quot;submatrix_indexes&quot; all (unique) submatrix indexes that appear; and it outputs to &quot;contains_null_marker&quot; true if the pair (-1, -1) appears anywhere in indexes_multi, and false otherwise. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00264">nnet-analyze.cc:264</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="arpa-file-parser-test_8cc_html_a951345011b75d2e8d9bfc18ca63510d2"><div class="ttname"><a href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a></div><div class="ttdeci">const size_t count</div><div class="ttdef"><b>Definition:</b> <a href="arpa-file-parser-test_8cc_source.html#l00066">arpa-file-parser-test.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kaldi::nnet3::kReadWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00078">nnet-analyze.h:78</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7">kaldi::nnet3::kPropagateAdds</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00053">nnet-component-itf.h:53</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kaldi::nnet3::kWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00077">nnet-analyze.h:77</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kaldi::nnet3::kBackpropNoModelUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90">kaldi::nnet3::kBackpropAdds</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00061">nnet-component-itf.h:61</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kaldi::nnet3::kNoOperationLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kaldi::nnet3::kDecompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4874b04bb051028a1b6cb08cff2d1994"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4874b04bb051028a1b6cb08cff2d1994">&#9670;&nbsp;</a></span>ComputeCommandPairs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ComputeCommandPairs </td>
          <td>(</td>
          <td class="paramtype">const std::pair&lt; std::vector&lt; int32 &gt;, std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>pairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00328">328</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="stl-utils_8h_source.html#l00174">kaldi::CopyVectorToSet()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, and <a class="el" href="kaldi-error_8h_source.html#l00181">KALDI_PARANOID_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00355">RemoveUnnecessaryAllocation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                             {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  std::vector&lt;int32&gt; d_list = lists.first;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  std::set&lt;int32&gt; a_set;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <a class="code" href="namespacekaldi.html#a3197e8bd3abedae8ba7ea37c38b08225">CopyVectorToSet</a>(lists.second, &amp;a_set);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  std::vector&lt;int32&gt;::reverse_iterator iter = d_list.rbegin(),</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      end = d_list.rend();</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="comment">// from the latest to the earliest deallocation command...</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    int32 <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = *iter;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    std::set&lt;int32&gt;::iterator a_iter = a_set.upper_bound(d);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// a_iter is an iterator to the first element a of the set &#39;a_set&#39; such</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// that a &gt; d, or a_set.end() if no such element exists.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> (a_iter == a_set.end())</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// we will output no pair for this d.</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    int32 a = *a_iter;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a>(a &gt; d);  <span class="comment">// or code error</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    a_set.erase(a_iter);  <span class="comment">// remove this a from &#39;a_set&#39; so it doesn&#39;t get used</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                          <span class="comment">// twice</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    pairs-&gt;push_back(std::pair&lt;int32,int32&gt;(d, a));</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a3197e8bd3abedae8ba7ea37c38b08225"><div class="ttname"><a href="namespacekaldi.html#a3197e8bd3abedae8ba7ea37c38b08225">kaldi::CopyVectorToSet</a></div><div class="ttdeci">void CopyVectorToSet(const std::vector&lt; A &gt; &amp;v, std::set&lt; A &gt; *s)</div><div class="ttdoc">Copies the contents of a vector to a set. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00174">stl-utils.h:174</a></div></div>
<div class="ttc" id="group__error__group_html_ga2c852c1a15c7f195ec8021de2ab119a0"><div class="ttname"><a href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a></div><div class="ttdeci">#define KALDI_PARANOID_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00181">kaldi-error.h:181</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9a9dab13d6db9f89fb2693d37b08ebe1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a9dab13d6db9f89fb2693d37b08ebe1">&#9670;&nbsp;</a></span>ComputeComputationGraph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ComputeComputationGraph </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a> *&#160;</td>
          <td class="paramname"><em>graph</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation-graph_8cc_source.html#l01171">1171</a> of file <a class="el" href="nnet-computation-graph_8cc_source.html">nnet-computation-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation-graph_8cc_source.html#l01013">kaldi::nnet3::computation_graph::AddInputToGraph()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00990">kaldi::nnet3::computation_graph::AddOutputToGraph()</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00046">ComputationGraph::cindexes</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00087">NetworkNode::component_index</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00063">ComputationGraph::dependencies</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00084">NetworkNode::descriptor</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00028">ComputationGraph::GetCindexId()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00068">Descriptor::GetDependencies()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00197">Component::GetInputIndexes()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00055">ComputationGraph::is_input</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kDescriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kDimRange</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00130">ComputationRequest::misc_info</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00090">NetworkNode::node_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, and <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>.</p>
<div class="fragment"><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                                                      {</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keyword">using namespace </span>computation_graph;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="comment">// make sure graph is empty at the start.</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(graph-&gt;cindexes.empty());</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1computation__graph.html#ade326e1f7b5aed9de211eb7327ecde6b">AddInputToGraph</a>(request, nnet, graph);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1computation__graph.html#abcf4ea50e642bf894660a735b0fa3f5c">AddOutputToGraph</a>(request, nnet, graph);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="comment">// queue of cindex_ids to process.</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  std::vector&lt;int32&gt; queue(graph-&gt;cindexes.size());</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; graph-&gt;cindexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    queue.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="keywordflow">while</span> (!queue.empty()) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    int32 cindex_id = queue.back();</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    queue.pop_back();</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (static_cast&lt;int32&gt;(graph-&gt;dependencies.size()) &lt;= cindex_id)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      graph-&gt;dependencies.resize(cindex_id + 1);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordflow">if</span> (graph-&gt;is_input[cindex_id])</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> cindex = graph-&gt;cindexes[cindex_id];</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="comment">// find the dependencies of this cindex.</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = cindex.first;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keyword">const</span> Index &amp;index = cindex.second;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keyword">const</span> NetworkNode &amp;node = nnet.GetNode(n);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    std::vector&lt;Cindex&gt; input_cindexes;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="comment">// the following switch statement sets up &quot;input_cindexes&quot;.</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordflow">switch</span> (node.node_type) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>: {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="comment">// desc describes how this node obtains its input from other nodes.</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="keyword">const</span> Descriptor &amp;desc = node.descriptor;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        desc.GetDependencies(index, &amp;input_cindexes);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      }</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>: {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        int32 c = node.u.component_index;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keyword">const</span> Component *component = nnet.GetComponent(c);</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        std::vector&lt;Index&gt; input_indexes;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        component-&gt;GetInputIndexes(request.misc_info, index,</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                                   &amp;input_indexes);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="comment">// each Component node should be preceded by a node that describes its</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="comment">// input, of type kDescriptor</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nnet.GetNode(n-1).node_type ==</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                     <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        input_cindexes.resize(input_indexes.size());</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; input_indexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          input_cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first = n - 1;  <span class="comment">// preceding node.</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;          input_cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second = input_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kDimRange</a>: {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        input_cindexes.resize(1);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        input_cindexes[0] = <a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a>(node.u.node_index, index);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a>: <span class="keywordflow">default</span>:</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="comment">// for kInput, you should have hit the &quot;continue&quot; statement above.</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Invalid node type&quot;</span>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    }</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    std::vector&lt;int32&gt; &amp;this_dep = graph-&gt;dependencies[cindex_id];</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    int32 num_dependencies = input_cindexes.size();</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    this_dep.resize(num_dependencies);</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_dependencies; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <span class="keywordtype">bool</span> is_input = <span class="keyword">false</span>, is_new;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      int32 dep_cindex_id = graph-&gt;GetCindexId(input_cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                                               is_input, &amp;is_new);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      this_dep[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = dep_cindex_id;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <span class="keywordflow">if</span> (is_new)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        queue.push_back(dep_cindex_id);</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="comment">// remove duplicates of dependencies.</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;this_dep);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1computation__graph_html_ade326e1f7b5aed9de211eb7327ecde6b"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1computation__graph.html#ade326e1f7b5aed9de211eb7327ecde6b">kaldi::nnet3::computation_graph::AddInputToGraph</a></div><div class="ttdeci">void AddInputToGraph(const ComputationRequest &amp;request, const Nnet &amp;nnet, ComputationGraph *graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l01013">nnet-computation-graph.cc:1013</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8344e7587df9247d6cc492874901d4d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">kaldi::nnet3::Cindex</a></div><div class="ttdeci">std::pair&lt; int32, Index &gt; Cindex</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00115">nnet-common.h:115</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1computation__graph_html_abcf4ea50e642bf894660a735b0fa3f5c"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1computation__graph.html#abcf4ea50e642bf894660a735b0fa3f5c">kaldi::nnet3::computation_graph::AddOutputToGraph</a></div><div class="ttdeci">void AddOutputToGraph(const ComputationRequest &amp;request, const Nnet &amp;nnet, ComputationGraph *graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l00990">nnet-computation-graph.cc:990</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kaldi::nnet3::kDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kaldi::nnet3::kDimRange</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2c9e85c299672aa4ef4a0c080d19b3d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c9e85c299672aa4ef4a0c080d19b3d9">&#9670;&nbsp;</a></span>ComputeComputationPhases()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeComputationPhases </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a> &amp;&#160;</td>
          <td class="paramname"><em>computation_graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>phases_per_segment</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function divides a computation into 'phases', where a 'phase' is a collection of cindexes which can (as far as the computation graph is concerned) all be computed at the same time, and depend only on cindexes previously computed in earlier phases. </p>
<p>So the phases are an ordering of the Cindexes in the computation, but an ordering that depends on graph-theoretic considerations only, and not practical concerns like whether the cindexes belong to the same node [for that, see the notion of steps].</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nnet</td><td>The neural network this computation is for </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">graph</td><td>The computation graph that we're computing phases for. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">phases_per_segment</td><td>The phases, listed separately for each segment of the computation [there will be just one segment in the normal case, more in the online-recognition case]. Consider just one segment for now. Suppose the computation can be completed in 20 phases, then (*phases)[0].size() will be 20 at exit, and (*phases)[0][0] will be a sorted list of cindex_ids. that belong to the first phase, and so on. (Remember, a cindex_id is an index into graph-&gt;cindexes; it compactly identifies a cindex.) The sets represented by the int32's in 'phases_per_segment' will be disjoint and will cover all elements in [0 .. computation.cindexes.size() - 1].</td></tr>
  </table>
  </dd>
</dl>
<p>Note: we assume you have called PruneComputationGraph() before this function. Even so, this function will be crash if the computation cannot actually be computed&ndash; there are some mal-formed computations where you can build the computation graph but not the ordering of cindexes because there are dependencies forward and backward in time that intertwine. </p>

<p class="definition">Definition at line <a class="el" href="nnet-computation-graph_8cc_source.html#l01425">1425</a> of file <a class="el" href="nnet-computation-graph_8cc_source.html">nnet-computation-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation-graph_8h_source.html#l00046">ComputationGraph::cindexes</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l01326">ComputeComputationPhasesForEpoch()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l01047">kaldi::nnet3::computation_graph::ComputeDependenciesSubset()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l01101">kaldi::nnet3::computation_graph::ComputeEpochInfo()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00063">ComputeGraphTranspose()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00080">ComputationGraph::segment_ends</a>, and <a class="el" href="nnet-computation-graph_8cc_source.html#l01257">SumVectorSizes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                                                                  {</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keyword">using namespace </span>computation_graph;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  int32 num_cindex_ids = graph.cindexes.size();</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  std::vector&lt;int32&gt; cindex_id_to_segment_and_epoch;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  std::vector&lt;std::vector&lt;std::vector&lt;int32 &gt; &gt; &gt; epochs_per_segment;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  std::vector&lt;bool&gt; epoch_is_trivial;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1computation__graph.html#a0085866e63cd0b15d4295476f08a3a68">ComputeEpochInfo</a>(nnet, graph, &amp;cindex_id_to_segment_and_epoch,</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                   &amp;epochs_per_segment, &amp;epoch_is_trivial);</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a8b3c3728dced52837e749f0d4d4f3b40">SumVectorSizes</a>(epochs_per_segment) == num_cindex_ids);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">// dependencies_subset contains just the subset of dependencies</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="comment">// of each cindex_id, that have the same epoch index as</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="comment">// cindex_id itself.  This will be used to correctly order</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="comment">// cindexes within a certain epoch (relevant for things like</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="comment">// LSTMs).</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; dependencies_subset;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3_1_1computation__graph.html#a3763a49ed71b20704d8479482659a9b8">ComputeDependenciesSubset</a>(graph, cindex_id_to_segment_and_epoch,</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                            &amp;dependencies_subset);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="comment">// destroy cindex_id_to_segment_and_epoch, it&#39;s no longer needed.</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  { std::vector&lt;int32&gt; temp; temp.swap(cindex_id_to_segment_and_epoch);  }</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="comment">// depend_on_subset is a subset of the normal &quot;depend_on&quot; list (i.e. a list of</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="comment">// all cindex_ids that depend on the current cindex_id), limited to just those</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  <span class="comment">// cindex_ids that have the same epoch index.</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; depend_on_subset;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ac4457943f315ab2e900b1f81606404f8">ComputeGraphTranspose</a>(dependencies_subset, &amp;depend_on_subset);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  int32 num_epoch_indexes = epoch_is_trivial.size(),</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      num_segments = graph.segment_ends.size();</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <span class="comment">// &quot;phase_indexes&quot; is used inside ComputeComputationPhasesForEpoch.</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  std::vector&lt;int32&gt; phase_indexes(num_cindex_ids, -1);</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  phases_per_segment-&gt;clear();</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  phases_per_segment-&gt;resize(num_segments);</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordflow">for</span> (int32 segment = 0; segment &lt; num_segments; segment++) {</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    phases_per_segment-&gt;reserve(50);  <span class="comment">// minimize unnecessary copies.  50 is</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                                      <span class="comment">// very arbitrarily chosen.</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">for</span> (int32 epoch = 0; epoch &lt; num_epoch_indexes; epoch++)</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ac598e840c9ed7da8b25b98f8243672d4">ComputeComputationPhasesForEpoch</a>(nnet, graph,</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                                       epochs_per_segment[segment][epoch],</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                                       dependencies_subset,</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                                       depend_on_subset,</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                                       epoch_is_trivial[epoch],</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                                       &amp;phase_indexes,</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                                       &amp;((*phases_per_segment)[segment]));</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  }</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="comment">// make sure everything was computable.  If the next assert fails it&#39;s likely</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="comment">// a bug in this function or in PruneComputataionGraph.</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a8b3c3728dced52837e749f0d4d4f3b40">SumVectorSizes</a>(*phases_per_segment) == num_cindex_ids);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_1_1computation__graph_html_a0085866e63cd0b15d4295476f08a3a68"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1computation__graph.html#a0085866e63cd0b15d4295476f08a3a68">kaldi::nnet3::computation_graph::ComputeEpochInfo</a></div><div class="ttdeci">static void ComputeEpochInfo(const Nnet &amp;nnet, const ComputationGraph &amp;graph, std::vector&lt; int32 &gt; *cindex_id_to_segment_and_epoch, std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; *epochs_per_segment, std::vector&lt; bool &gt; *epoch_is_trivial)</div><div class="ttdoc">This function computes certain information about &quot;epochs&quot; of cindex_ids. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l01101">nnet-computation-graph.cc:1101</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8b3c3728dced52837e749f0d4d4f3b40"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8b3c3728dced52837e749f0d4d4f3b40">kaldi::nnet3::SumVectorSizes</a></div><div class="ttdeci">static int32 SumVectorSizes(const std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l01266">nnet-computation-graph.cc:1266</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac4457943f315ab2e900b1f81606404f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac4457943f315ab2e900b1f81606404f8">kaldi::nnet3::ComputeGraphTranspose</a></div><div class="ttdeci">void ComputeGraphTranspose(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph_transpose)</div><div class="ttdoc">Outputs a graph in which the order of arcs is reversed. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00063">nnet-graph.cc:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac598e840c9ed7da8b25b98f8243672d4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac598e840c9ed7da8b25b98f8243672d4">kaldi::nnet3::ComputeComputationPhasesForEpoch</a></div><div class="ttdeci">static void ComputeComputationPhasesForEpoch(const Nnet &amp;nnet, const ComputationGraph &amp;graph, const std::vector&lt; int32 &gt; &amp;this_epoch, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;dependencies_subset, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;depend_on_subset, bool epoch_is_trivial, std::vector&lt; int32 &gt; *phase_indexes, std::vector&lt; std::vector&lt; int32 &gt; &gt; *phases)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l01326">nnet-computation-graph.cc:1326</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_1_1computation__graph_html_a3763a49ed71b20704d8479482659a9b8"><div class="ttname"><a href="namespacekaldi_1_1nnet3_1_1computation__graph.html#a3763a49ed71b20704d8479482659a9b8">kaldi::nnet3::computation_graph::ComputeDependenciesSubset</a></div><div class="ttdeci">static void ComputeDependenciesSubset(const ComputationGraph &amp;graph, const std::vector&lt; int32 &gt; &amp;cindex_id_to_segment_and_epoch, std::vector&lt; std::vector&lt; int32 &gt; &gt; *dependencies_subset)</div><div class="ttdoc">This function outputs to dependencies_subset[c], for each cindex_id c, the subset of elements d of gr...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l01047">nnet-computation-graph.cc:1047</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac598e840c9ed7da8b25b98f8243672d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac598e840c9ed7da8b25b98f8243672d4">&#9670;&nbsp;</a></span>ComputeComputationPhasesForEpoch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ComputeComputationPhasesForEpoch </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationGraph.html">ComputationGraph</a> &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>this_epoch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>dependencies_subset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>depend_on_subset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>epoch_is_trivial</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>phase_indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>phases</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation-graph_8cc_source.html#l01326">1326</a> of file <a class="el" href="nnet-computation-graph_8cc_source.html">nnet-computation-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation-graph_8cc_source.html#l01425">ComputeComputationPhases()</a>.</p>
<div class="fragment"><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                                          {</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  std::vector&lt;int32&gt; this_phase, next_phase_candidates;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordflow">if</span> (this_epoch.empty())</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="keywordflow">if</span> (epoch_is_trivial) { <span class="comment">// an optimization</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    this_phase = this_epoch;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="comment">// Start out with all elements of this epoch that have no</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// dependencies within the same epoch (i.e. those that</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">// can be computed first).</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = this_epoch.begin(),</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        end = this_epoch.end();</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      int32 cindex_id = *iter;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="keywordflow">if</span> (dependencies_subset[cindex_id].empty())</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        this_phase.push_back(cindex_id);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    }</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="comment">// if the next assert fails, the graph at the level of cindex_ids is not acyclic.</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!this_phase.empty() &amp;&amp;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;               <span class="stringliteral">&quot;Trying to process computation with cycles&quot;</span>);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="keywordflow">while</span> (!this_phase.empty()) {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="comment">// The next two lines are a more efficient version of:</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="comment">// phases-&gt;push_back(this_phase);</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    phases-&gt;resize(phases-&gt;size() + 1);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    phases-&gt;back().swap(this_phase);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="comment">// The next if-statement is an optimization: if for this epoch index</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="comment">// there is just one node, we can skip the rest of this loop.  Note: if</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="comment">// epoch == 0, even if there is just one node, cindex_ids from</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="comment">// multiple nodes may be put here because of the rule that cindex_ids which</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="comment">// are inputs always get epoch 0.  But it&#39;s still true that they</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="comment">// will have no dependencies, so we can still skip the code below.</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">if</span> (epoch_is_trivial)</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    int32 cur_phase_index = phases-&gt;size() - 1;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="comment">// next_phases_candidates is a list of cindexes that we should check</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="comment">// whether they are computable now, because one of the things they depend</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="comment">// on just became computable.</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    next_phase_candidates.clear();</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    std::vector&lt;int32&gt;::const_iterator this_phase_iter = phases-&gt;back().begin(),</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        this_phase_end = phases-&gt;back().end();</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordflow">for</span> (; this_phase_iter != this_phase_end; ++this_phase_iter) {</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      int32 c = *this_phase_iter;  <span class="comment">// c is a cindex_id with phase cur_phase_index.</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      (*phase_indexes)[c] = cur_phase_index;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      std::vector&lt;int32&gt;::const_iterator iter = depend_on_subset[c].begin(),</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;          end = depend_on_subset[c].end();</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        int32 <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = *iter;  <span class="comment">// cindex_id that depends on c.</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        next_phase_candidates.push_back(d);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      }</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    }</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;next_phase_candidates);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="comment">// note, at this point &#39;this_phase&#39; will be the empty vector [see the &#39;swap&#39;</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="comment">// above].</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    this_phase.reserve(next_phase_candidates.size());</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="comment">// now check the candidates that might be in the next phase, and put any</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="comment">// members that we are currently able to compute into &quot;this_phase&quot;.</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = next_phase_candidates.begin(),</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        end = next_phase_candidates.end();</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      int32 c = *iter;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      std::vector&lt;int32&gt;::const_iterator</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;          dep_iter = dependencies_subset[c].begin(),</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;          dep_end = dependencies_subset[c].end();</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      <span class="keywordflow">for</span> (; dep_iter != dep_end; ++dep_iter) {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        int32 <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = *dep_iter;  <span class="comment">// d is cindex_id that c depends on.</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        <span class="keywordflow">if</span> ((*phase_indexes)[d] &lt; 0)  <span class="comment">// we can&#39;t compute c yet because something we depend</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;          <span class="keywordflow">break</span>;                      <span class="comment">// on has not yet been computed.</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      }</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="keywordflow">if</span> (dep_iter == dep_end) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="comment">// we reached the end and did not break -&gt; all dependencies satisfied</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        this_phase.push_back(c);</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      }</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">if</span> (!next_phase_candidates.empty() &amp;&amp; this_phase.empty())  {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <span class="comment">// this should have been caught earlier so likely a code error rather than</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <span class="comment">// a problem with user input.</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Your model has a type of recurrence that cannot be computed. &quot;</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;E.g. if x[t] depends on both x[t+1] and x[t-1]... no order &quot;</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;of computation will work.&quot;</span>;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    }</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  }</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2370ad59bd8f6a9f348193b491d88d8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2370ad59bd8f6a9f348193b491d88d8a">&#9670;&nbsp;</a></span>ComputeExampleComputationRequestSimple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeExampleComputationRequestSimple </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &gt; *&#160;</td>
          <td class="paramname"><em>inputs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function computes an example computation request, for testing purposes. </p>
<p>The "Simple" in the name means that it currently only supports neural nets that satisfy IsSimple(nnet) (defined in nnet-utils.h). If there are 2 inputs, the "input" will be first, followed by "ivector".</p>
<p>In order to expand the range of things you can test with this (mainly to stop crashes with statistics-pooling/statistics-extraction components), this function always generates computation-requests where at least 3 successive frames of input are requested. </p>

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01338">1338</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00146">ComputeSimpleNnetContext()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00669">Nnet::InputDim()</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="nnet-utils_8cc_source.html#l00052">IsSimpleNnet()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00126">ComputationRequest::store_component_stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8h_source.html#l00048">NnetGenerationOptions::NnetGenerationOptions()</a>, <a class="el" href="nnet-analyze-test_8cc_source.html#l00039">UnitTestNnetAnalyze()</a>, <a class="el" href="nnet-compile-test_8cc_source.html#l00029">UnitTestNnetCompile()</a>, <a class="el" href="nnet-compile-test_8cc_source.html#l00063">UnitTestNnetCompileMulti()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00246">UnitTestNnetInputDerivatives()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>, and <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">UnitTestNnetOptimizeWithOptions()</a>.</p>
<div class="fragment"><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                                           {</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04">IsSimpleNnet</a>(nnet));</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  int32 left_context, right_context;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">ComputeSimpleNnetContext</a>(nnet, &amp;left_context, &amp;right_context);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  int32 num_output_frames = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      output_start_frame = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      num_examples = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4,</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      output_end_frame = output_start_frame + num_output_frames,</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      input_start_frame = output_start_frame - left_context - (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3),</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      input_end_frame = output_end_frame + right_context + (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3),</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      n_offset = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  <span class="keywordtype">bool</span> need_deriv = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="comment">// make sure there are at least 3 frames of input available.  this makes a</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <span class="comment">// difference for our tests of statistics-pooling and statistics-extraction</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  <span class="comment">// component.</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <span class="keywordflow">if</span> (input_end_frame &lt; input_start_frame + 3)</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    input_end_frame = input_start_frame + 3;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  request-&gt;inputs.clear();</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  request-&gt;outputs.clear();</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  inputs-&gt;clear();</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  std::vector&lt;Index&gt; input_indexes, ivector_indexes, output_indexes;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = n_offset; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; n_offset + num_examples; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">for</span> (int32 t = input_start_frame; t &lt; input_end_frame; t++)</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      input_indexes.push_back(Index(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, t, 0));</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordflow">for</span> (int32 t = output_start_frame; t &lt; output_end_frame; t++)</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      output_indexes.push_back(Index(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, t, 0));</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    ivector_indexes.push_back(Index(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, 0, 0));</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  }</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  request-&gt;outputs.push_back(IoSpecification(<span class="stringliteral">&quot;output&quot;</span>, output_indexes));</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordflow">if</span> (need_deriv || (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0))</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    request-&gt;outputs.back().has_deriv = <span class="keyword">true</span>;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  request-&gt;inputs.push_back(IoSpecification(<span class="stringliteral">&quot;input&quot;</span>, input_indexes));</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="keywordflow">if</span> (need_deriv &amp;&amp; (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0))</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    request-&gt;inputs.back().has_deriv = <span class="keyword">true</span>;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  int32 input_dim = nnet.InputDim(<span class="stringliteral">&quot;input&quot;</span>);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_dim &gt; 0);</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  inputs-&gt;push_back(</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      Matrix&lt;BaseFloat&gt;((input_end_frame - input_start_frame) * num_examples,</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                        input_dim));</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  inputs-&gt;back().SetRandn();</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  int32 ivector_dim = nnet.InputDim(<span class="stringliteral">&quot;ivector&quot;</span>);  <span class="comment">// may not exist.</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordflow">if</span> (ivector_dim != -1) {</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    request-&gt;inputs.push_back(IoSpecification(<span class="stringliteral">&quot;ivector&quot;</span>, ivector_indexes));</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    inputs-&gt;push_back(Matrix&lt;BaseFloat&gt;(num_examples, ivector_dim));</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    inputs-&gt;back().SetRandn();</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="keywordflow">if</span> (need_deriv &amp;&amp; (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0))</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      request-&gt;inputs.back().has_deriv = <span class="keyword">true</span>;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  }</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0)</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    request-&gt;need_model_derivative = need_deriv;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0)</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    request-&gt;store_component_stats = <span class="keyword">true</span>;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a88aa85d232ba1ad6e430f6f6dcda29c1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">kaldi::nnet3::ComputeSimpleNnetContext</a></div><div class="ttdeci">void ComputeSimpleNnetContext(const Nnet &amp;nnet, int32 *left_context, int32 *right_context)</div><div class="ttdoc">ComputeSimpleNnetContext computes the left-context and right-context of a nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00146">nnet-utils.cc:146</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a672e127a288d02b4a8e292b86aadfc04"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04">kaldi::nnet3::IsSimpleNnet</a></div><div class="ttdeci">bool IsSimpleNnet(const Nnet &amp;nnet)</div><div class="ttdoc">This function returns true if the nnet has the following properties: It has an output called &quot;output&quot;...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00052">nnet-utils.cc:52</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac4457943f315ab2e900b1f81606404f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4457943f315ab2e900b1f81606404f8">&#9670;&nbsp;</a></span>ComputeGraphTranspose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeGraphTranspose </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>graph_transpose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Outputs a graph in which the order of arcs is reversed. </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00063">63</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation-graph_8cc_source.html#l01425">ComputeComputationPhases()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00598">FindOrphanNodes()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00148">UnitTestComputeGraphTranspose()</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                                                                          {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  int32 size = graph.size();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  graph_transpose-&gt;clear();</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  graph_transpose-&gt;resize(size);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; size; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;nodes = graph[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>];</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = nodes.begin(), end = nodes.end();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      int32 dest = *iter;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      (*graph_transpose)[dest].push_back(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2f107eabc73f1b70436ed117375778c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f107eabc73f1b70436ed117375778c1">&#9670;&nbsp;</a></span>ComputeMatrixAccesses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeMatrixAccesses </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a> &amp;&#160;</td>
          <td class="paramname"><em>variables</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>command_attributes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a> &gt; *&#160;</td>
          <td class="paramname"><em>matrix_accesses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function organizes information in the <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> in a way that is convenient to access per matrix. </p>
<p>See the declaration of struct <a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a> for the output format; the output "matrix_accesses" is indexed by matrix index (the same index as computation.matrices). </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l00467">467</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00975">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kAcceptInput</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kProvideOutput</a>, <a class="el" href="nnet-analyze_8h_source.html#l00076">kReadAccess</a>, <a class="el" href="nnet-analyze_8h_source.html#l00078">kReadWriteAccess</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSwapMatrix</a>, <a class="el" href="nnet-analyze_8h_source.html#l00077">kWriteAccess</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-analyze_8h_source.html#l00059">CommandAttributes::matrices_read</a>, <a class="el" href="nnet-analyze_8h_source.html#l00061">CommandAttributes::matrices_written</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-analyze_8cc_source.html#l01421">Analyzer::Init()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00271">MatrixAccesses::MatrixAccesses()</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00152">MoveSizingCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                                {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  int32 num_matrices = computation.matrices.size(),</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      num_commands = command_attributes.size();</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  matrix_accesses-&gt;clear();</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  matrix_accesses-&gt;resize(num_matrices);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_commands; c++) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keyword">const</span> CommandAttributes &amp;attr = command_attributes[c];</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(attr.matrices_read));</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(attr.matrices_written));</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    std::vector&lt;int32&gt; all_matrices;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    all_matrices.reserve(attr.matrices_read.size() +</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                          attr.matrices_written.size());</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    all_matrices.insert(all_matrices.end(), attr.matrices_read.begin(),</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                         attr.matrices_read.end());</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    all_matrices.insert(all_matrices.end(), attr.matrices_written.begin(),</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                         attr.matrices_written.end());</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;all_matrices);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = all_matrices.begin(),</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        end = all_matrices.end();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      int32 matrix_index = *iter;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordtype">bool</span> is_read = std::binary_search(attr.matrices_read.begin(),</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                        attr.matrices_read.end(),</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                        matrix_index),</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          is_written = (!is_read ? <span class="keyword">true</span> :</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                        std::binary_search(attr.matrices_written.begin(),</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                                           attr.matrices_written.end(),</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                           matrix_index));</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">if</span> (is_read &amp;&amp; is_written) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        (*matrix_accesses)[matrix_index].accesses.push_back(</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            Access(c, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>));</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_read) {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        (*matrix_accesses)[matrix_index].accesses.push_back(</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            Access(c, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>));</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        (*matrix_accesses)[matrix_index].accesses.push_back(</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            Access(c, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>));</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// Now set up allocate_command, deallocate_command,</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="comment">// is_input and is_output.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keyword">const</span> NnetComputation::Command &amp;command = computation.commands[c];</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    int32 matrix_index1, matrix_index2;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">switch</span> (command.command_type) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>:</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">if</span> (!computation.IsWholeMatrix(command.arg1))</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Command does not operate on whole matrix&quot;</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        matrix_index1 = computation.submatrices[command.arg1].matrix_index;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span> ((*matrix_accesses)[matrix_index1].allocate_command != -1)</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Matrix &quot;</span> &lt;&lt; matrix_index1 &lt;&lt; <span class="stringliteral">&quot; initialized twice.&quot;</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        (*matrix_accesses)[matrix_index1].allocate_command = c;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>:</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">if</span> (!computation.IsWholeMatrix(command.arg1))</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Command does not operate on whole matrix&quot;</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        matrix_index1 = computation.submatrices[command.arg1].matrix_index;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation.IsWholeMatrix(command.arg2));</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        matrix_index2 = computation.submatrices[command.arg2].matrix_index;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">if</span> ((*matrix_accesses)[matrix_index1].allocate_command != -1)</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Matrix &quot;</span> &lt;&lt; matrix_index1 &lt;&lt; <span class="stringliteral">&quot; initialized twice.&quot;</span>;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        (*matrix_accesses)[matrix_index1].allocate_command = c;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordflow">if</span> ((*matrix_accesses)[matrix_index2].deallocate_command != -1)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Matrix &quot;</span> &lt;&lt; matrix_index2 &lt;&lt; <span class="stringliteral">&quot; destroyed twice.&quot;</span>;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        (*matrix_accesses)[matrix_index2].deallocate_command = c;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>:</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">if</span> (!computation.IsWholeMatrix(command.arg1))</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Command does not operate on whole matrix&quot;</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        matrix_index1 = computation.submatrices[command.arg1].matrix_index;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">if</span> ((*matrix_accesses)[matrix_index1].deallocate_command != -1)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Matrix &quot;</span> &lt;&lt; matrix_index1 &lt;&lt; <span class="stringliteral">&quot; destroyed twice.&quot;</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        (*matrix_accesses)[matrix_index1].deallocate_command = c;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>:</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">if</span> (!computation.IsWholeMatrix(command.arg1))</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Command does not operate on whole matrix&quot;</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        matrix_index1 = computation.submatrices[command.arg1].matrix_index;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        (*matrix_accesses)[matrix_index1].is_input = <span class="keyword">true</span>;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="comment">// If a certain matrix is accepted as input multiple times, we</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="comment">// count the first one as allocating it (the second will just</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="comment">// allocate it again, which is harmless).</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">if</span> ((*matrix_accesses)[matrix_index1].allocate_command == -1)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          (*matrix_accesses)[matrix_index1].allocate_command = c;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>:</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">if</span> (!computation.IsWholeMatrix(command.arg1))</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Command does not operate on whole matrix&quot;</span>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        matrix_index1 = computation.submatrices[command.arg1].matrix_index;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        (*matrix_accesses)[matrix_index1].is_output = <span class="keyword">true</span>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        ;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  }</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kaldi::nnet3::kReadAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00076">nnet-analyze.h:76</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kaldi::nnet3::kReadWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00078">nnet-analyze.h:78</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kaldi::nnet3::kWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00077">nnet-analyze.h:77</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7468a5d6108f9a2f81b9b79b82866354"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7468a5d6108f9a2f81b9b79b82866354">&#9670;&nbsp;</a></span>ComputeMatrixToSubmatrix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeMatrixToSubmatrix </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>mat_to_submat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function computes a vector 'mat_to_submat', indexed by matrix index, such that (*mat_to_submat)[m] is a list of all the submatrix indexes that refer to matrix m. </p>
<p>Note, (*mat_to_submat)[0] will be the empty vector. </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l01166">1166</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00711">VariableMergingOptimizer::VariableMergingOptimizer()</a>.</p>
<div class="fragment"><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                                                 {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  int32 num_matrices = computation.matrices.size(),</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      num_submatrices = computation.submatrices.size();</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  mat_to_submat-&gt;clear();</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  mat_to_submat-&gt;resize(num_matrices);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">for</span> (int32 submatrix_index = 1;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;       submatrix_index &lt; num_submatrices;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;       submatrix_index++) {</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    int32 matrix_index = computation.submatrices[submatrix_index].matrix_index;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(matrix_index &gt; 0 &amp;&amp; matrix_index &lt; num_matrices);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    (*mat_to_submat)[matrix_index].push_back(submatrix_index);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  }</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a12fab71b9fb0d11733b8d9e452da5eda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12fab71b9fb0d11733b8d9e452da5eda">&#9670;&nbsp;</a></span>ComputeMinAndMaxTimes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ComputeMinAndMaxTimes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>min_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>max_t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-derivative-test_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet-derivative-test_8cc_source.html">nnet-derivative-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-derivative-test_8cc_source.html#l00046">SetDerivTimesOptions()</a>.</p>
<div class="fragment"><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                                         {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!indexes.empty());</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  *min_t = indexes[0].t;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  *max_t = *min_t;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 1; n &lt; static_cast&lt;int32&gt;(indexes.size()); <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    *min_t = std::min(*min_t, indexes[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>].t);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    *max_t = std::max(*max_t, indexes[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>].t);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a380175b61aef188f214827ad6c2faca2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a380175b61aef188f214827ad6c2faca2">&#9670;&nbsp;</a></span>ComputeNnetComputationEpochs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeNnetComputationEpochs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>node_to_epoch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function computes the order in which we need to compute each node in the graph, where each node-index n maps to an epoch-index t = 0, 1, ... </p>
<p>that says when we should compute it. Nodes that are part of a strongly connected component (SCC) will all be computed at the same time, but any two nodes that are not part of an SCC will have different epoch-index, and these epoch-indexes will be such that a node computed at a larger epoch-index may depend on a node computed at a smaller epoch-index, but not vice versa.</p>
<p>Internally it calls NnetToDirectedGraph, FindSccs, MakeSccGraph and ComputeTopSortOrder. </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00265">265</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph_8cc_source.html#l00223">ComputeTopSortOrder()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00156">FindSccs()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="nnet-graph_8cc_source.html#l00164">MakeSccGraph()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00030">NnetToDirectedGraph()</a>, and <a class="el" href="nnet-graph_8cc_source.html#l00248">PrintGraphToString()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation-graph_8cc_source.html#l01101">kaldi::nnet3::computation_graph::ComputeEpochInfo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                                                   {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node_to_epoch != NULL);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; graph;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a679a6d66a5e4a3993124bc35597dd06b">NnetToDirectedGraph</a>(nnet, &amp;graph);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(6) &lt;&lt; <span class="stringliteral">&quot;graph is: &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a794312260c52d2eb93f30302ee0a7173">PrintGraphToString</a>(graph);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; sccs;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ae72c79fbb6ec81b69aaee02701fa23e5">FindSccs</a>(graph, &amp;sccs);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; scc_graph;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a9efe2804eba8c2da73af3aa4eff4a2fc">MakeSccGraph</a>(graph, sccs, &amp;scc_graph);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(6) &lt;&lt; <span class="stringliteral">&quot;scc graph is: &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a794312260c52d2eb93f30302ee0a7173">PrintGraphToString</a>(scc_graph);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  std::vector&lt;int32&gt; scc_node_to_epoch;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ae4c2ac8a9e96d220776910b2a9ae2971">ComputeTopSortOrder</a>(scc_graph, &amp;scc_node_to_epoch);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 6) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; scc_node_to_epoch.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      os &lt;&lt; scc_node_to_epoch[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(6) &lt;&lt; <span class="stringliteral">&quot;scc_node_to_epoch is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  node_to_epoch-&gt;clear();</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  node_to_epoch-&gt;resize(graph.size());</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sccs.size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); ++<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      int32 node = sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node &gt;= 0 &amp;&amp; node &lt; graph.size());</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      (*node_to_epoch)[node] = scc_node_to_epoch[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a679a6d66a5e4a3993124bc35597dd06b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a679a6d66a5e4a3993124bc35597dd06b">kaldi::nnet3::NnetToDirectedGraph</a></div><div class="ttdeci">void NnetToDirectedGraph(const Nnet &amp;nnet, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</div><div class="ttdoc">This function takes an nnet and turns it to a directed graph on nodes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00030">nnet-graph.cc:30</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae4c2ac8a9e96d220776910b2a9ae2971"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae4c2ac8a9e96d220776910b2a9ae2971">kaldi::nnet3::ComputeTopSortOrder</a></div><div class="ttdeci">void ComputeTopSortOrder(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; int32 &gt; *node_to_order)</div><div class="ttdoc">Given an acyclic graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00223">nnet-graph.cc:223</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae72c79fbb6ec81b69aaee02701fa23e5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae72c79fbb6ec81b69aaee02701fa23e5">kaldi::nnet3::FindSccs</a></div><div class="ttdeci">void FindSccs(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdoc">Given a directed graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00156">nnet-graph.cc:156</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9efe2804eba8c2da73af3aa4eff4a2fc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9efe2804eba8c2da73af3aa4eff4a2fc">kaldi::nnet3::MakeSccGraph</a></div><div class="ttdeci">void MakeSccGraph(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;sccs, std::vector&lt; std::vector&lt; int32 &gt; &gt; *scc_graph)</div><div class="ttdoc">Given a list of sccs of a graph (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00164">nnet-graph.cc:164</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a794312260c52d2eb93f30302ee0a7173"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a794312260c52d2eb93f30302ee0a7173">kaldi::nnet3::PrintGraphToString</a></div><div class="ttdeci">std::string PrintGraphToString(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph)</div><div class="ttdoc">Prints a graph to a string in a pretty way for human readability, e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00248">nnet-graph.cc:248</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2f2fefdb7c8c1cc2fd30b5e102e8e979"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f2fefdb7c8c1cc2fd30b5e102e8e979">&#9670;&nbsp;</a></span>ComputeObjectiveFunction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeObjectiveFunction </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>supervision</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576e">ObjectiveType</a>&#160;</td>
          <td class="paramname"><em>objective_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>output_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>supply_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> *&#160;</td>
          <td class="paramname"><em>computer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>tot_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>tot_objf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function computes the objective function, and if supply_deriv = true, supplies its derivative to the <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> object. </p>
<p>See also the function <a class="el" href="namespacekaldi_1_1nnet3.html#aa3bf20c2ae341e8ba04b5e13ef2507a0" title="This function computes the frame accuracy for this minibatch. ">ComputeAccuracy()</a>, declared in <a class="el" href="nnet-diagnostics_8h.html">nnet-diagnostics.h</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">supervision</td><td>A <a class="el" href="classkaldi_1_1GeneralMatrix.html" title="This class is a wrapper that enables you to store a matrix in one of three forms: either as a Matrix&lt;...">GeneralMatrix</a>, typically derived from a <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a>, containing the supervision posteriors or features. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">objective_type</td><td>The objective function type: kLinear = output * supervision, or kQuadratic = -0.5 * (output - supervision)^2. kLinear is used for softmax objectives; the network contains a LogSoftmax layer which correctly normalizes its output. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">output_name</td><td>The name of the output node (e.g. "output"), used to look up the output in the <a class="el" href="classkaldi_1_1nnet3_1_1NnetComputer.html" title="class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...">NnetComputer</a> object.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">supply_deriv</td><td>If this is true, this function will compute the derivative of the objective function and supply it to the network using the function NnetComputer::AcceptOutputDeriv </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">computer</td><td>The <a class="el" href="classkaldi_1_1nnet3_1_1NnetComputer.html" title="class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...">NnetComputer</a> object, from which we get the output using GetOutput and to which we may supply the derivatives using AcceptOutputDeriv. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tot_weight</td><td>The total weight of the training examples. In the kLinear case, this is the sum of the supervision matrix; in the kQuadratic case, it is the number of rows of the supervision matrix. In order to make it possible to weight samples with quadratic objective functions, we may at some point make it possible for the supervision matrix to have an extra column containing weights. At the moment, this is not supported. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tot_objf</td><td>The total objective function; divide this by the tot_weight to get the normalized objective function. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-training_8cc_source.html#l00370">370</a> of file <a class="el" href="nnet-training_8cc_source.html">nnet-training.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00542">NnetComputer::AcceptInput()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03063">CuMatrixBase&lt; Real &gt;::CopyFromGeneralMat()</a>, <a class="el" href="cu-sparse-matrix_8cc_source.html#l00622">CuSparseMatrix&lt; Real &gt;::CopyToMat()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00877">GeneralMatrix::GetFullMatrix()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00816">GeneralMatrix::GetMatrix()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00573">NnetComputer::GetOutput()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00853">GeneralMatrix::GetSparseMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="sparse-matrix_8h_source.html#l00273">kaldi::kCompressedMatrix</a>, <a class="el" href="sparse-matrix_8h_source.html#l00272">kaldi::kFullMatrix</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00052">kLinear</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00052">kQuadratic</a>, <a class="el" href="sparse-matrix_8h_source.html#l00274">kaldi::kSparseMatrix</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00791">GeneralMatrix::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00781">GeneralMatrix::NumRows()</a>, <a class="el" href="cu-sparse-matrix_8cc_source.html#l00082">CuSparseMatrix&lt; Real &gt;::Sum()</a>, <a class="el" href="cu-matrix_8cc_source.html#l02979">CuMatrixBase&lt; Real &gt;::Sum()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00122">CuMatrix&lt; Real &gt;::Swap()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00704">kaldi::TraceMatSmat()</a>, and <a class="el" href="sparse-matrix_8cc_source.html#l00772">GeneralMatrix::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-diagnostics_8cc_source.html#l00097">NnetComputeProb::ProcessOutputs()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00192">NnetTrainer::ProcessOutputs()</a>.</p>
<div class="fragment"><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                                   {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keyword">const</span> CuMatrixBase&lt;BaseFloat&gt; &amp;output = computer-&gt;GetOutput(output_name);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">if</span> (output.NumCols() != supervision.NumCols())</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Nnet versus example output dimension (num-classes) &quot;</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;mismatch for &#39;&quot;</span> &lt;&lt; output_name &lt;&lt; <span class="stringliteral">&quot;&#39;: &quot;</span> &lt;&lt; output.NumCols()</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (nnet) vs. &quot;</span> &lt;&lt; supervision.NumCols() &lt;&lt; <span class="stringliteral">&quot; (egs)\n&quot;</span>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordflow">switch</span> (objective_type) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d">kLinear</a>: {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="comment">// objective is x * y.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">switch</span> (supervision.Type()) {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3aef253b40b2456ff5af4ad398301f8aef">kSparseMatrix</a>: {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <span class="keyword">const</span> SparseMatrix&lt;BaseFloat&gt; &amp;post = supervision.GetSparseMatrix();</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          CuSparseMatrix&lt;BaseFloat&gt; cu_post(post);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;          <span class="comment">// The cross-entropy objective is computed by a simple dot product,</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          <span class="comment">// because after the LogSoftmaxLayer, the output is already in the form</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          <span class="comment">// of log-likelihoods that are normalized to sum to one.</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          *tot_weight = cu_post.Sum();</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          *tot_objf = <a class="code" href="group__matrix__group.html#ga488f773f3606a469f29a1df41d6debb7">TraceMatSmat</a>(output, cu_post, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          <span class="keywordflow">if</span> (supply_deriv) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            CuMatrix&lt;BaseFloat&gt; output_deriv(output.NumRows(), output.NumCols(),</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                             <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            cu_post.CopyToMat(&amp;output_deriv);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            computer-&gt;AcceptInput(output_name, &amp;output_deriv);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3af872badd576ccf234e1bccf54f263863">kFullMatrix</a>: {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          <span class="comment">// there is a redundant matrix copy in here if we&#39;re not using a GPU</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          <span class="comment">// but we don&#39;t anticipate this code branch being used in many cases.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          CuMatrix&lt;BaseFloat&gt; cu_post(supervision.GetFullMatrix());</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          *tot_weight = cu_post.Sum();</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          *tot_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output, cu_post, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          <span class="keywordflow">if</span> (supply_deriv)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            computer-&gt;AcceptInput(output_name, &amp;cu_post);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3a87ea862fefb9f41cf20a2de202b4a9f9">kCompressedMatrix</a>: {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          Matrix&lt;BaseFloat&gt; post;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          supervision.GetMatrix(&amp;post);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;          CuMatrix&lt;BaseFloat&gt; cu_post;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;          cu_post.Swap(&amp;post);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          *tot_weight = cu_post.Sum();</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;          *tot_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output, cu_post, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="keywordflow">if</span> (supply_deriv)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            computer-&gt;AcceptInput(output_name, &amp;cu_post);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2">kQuadratic</a>: {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="comment">// objective is -0.5 (x - y)^2</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      CuMatrix&lt;BaseFloat&gt; diff(supervision.NumRows(),</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                               supervision.NumCols(),</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                               <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      diff.CopyFromGeneralMat(supervision);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      diff.AddMat(-1.0, output);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      *tot_weight = diff.NumRows();</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      *tot_objf = -0.5 * <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(diff, diff, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">if</span> (supply_deriv)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        computer-&gt;AcceptInput(output_name, &amp;diff);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Objective function type &quot;</span> &lt;&lt; objective_type</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; not handled.&quot;</span>;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div><div class="ttc" id="group__matrix__group_html_gga1b44c0ec7cf5c76c910fd41756787be3af872badd576ccf234e1bccf54f263863"><div class="ttname"><a href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3af872badd576ccf234e1bccf54f263863">kaldi::kFullMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00272">sparse-matrix.h:272</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576eac188c019178783e5be55110601309d7d">kaldi::nnet3::kLinear</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00052">nnet-nnet.h:52</a></div></div>
<div class="ttc" id="group__matrix__group_html_gga1b44c0ec7cf5c76c910fd41756787be3aef253b40b2456ff5af4ad398301f8aef"><div class="ttname"><a href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3aef253b40b2456ff5af4ad398301f8aef">kaldi::kSparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00274">sparse-matrix.h:274</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="group__matrix__group_html_gga1b44c0ec7cf5c76c910fd41756787be3a87ea862fefb9f41cf20a2de202b4a9f9"><div class="ttname"><a href="group__matrix__group.html#gga1b44c0ec7cf5c76c910fd41756787be3a87ea862fefb9f41cf20a2de202b4a9f9">kaldi::kCompressedMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00273">sparse-matrix.h:273</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a45660f9909187129a953fa05e664576ea7ec873b684c76347a4567ff59f649af2">kaldi::nnet3::kQuadratic</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00052">nnet-nnet.h:52</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="group__matrix__group_html_ga488f773f3606a469f29a1df41d6debb7"><div class="ttname"><a href="group__matrix__group.html#ga488f773f3606a469f29a1df41d6debb7">kaldi::TraceMatSmat</a></div><div class="ttdeci">Real TraceMatSmat(const MatrixBase&lt; Real &gt; &amp;A, const SparseMatrix&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l00704">sparse-matrix.cc:704</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2b0d1bf88132455db1909b9b4dc91120"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b0d1bf88132455db1909b9b4dc91120">&#9670;&nbsp;</a></span>ComputeObjf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double kaldi::nnet3::ComputeObjf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>batchnorm_test_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>dropout_test_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>egs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1NnetComputeProb.html">NnetComputeProb</a> *&#160;</td>
          <td class="paramname"><em>prob_computer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-combine_8cc_source.html#l00035">35</a> of file <a class="el" href="nnet3-combine_8cc_source.html">nnet3-combine.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-diagnostics_8cc_source.html#l00079">NnetComputeProb::Compute()</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00309">NnetComputeProb::GetTotalObjective()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00069">NnetComputeProb::Reset()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00555">SetBatchnormTestMode()</a>, and <a class="el" href="nnet-utils_8cc_source.html#l00564">SetDropoutTestMode()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-combine_8cc_source.html#l00076">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                                                   {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span> (batchnorm_test_mode || dropout_test_mode) {</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet_copy(nnet);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> (batchnorm_test_mode)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ac8f15bc7a244b05a3f04e15d562043dc">SetBatchnormTestMode</a>(<span class="keyword">true</span>, &amp;nnet_copy);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">if</span> (dropout_test_mode)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#af9757843e049a91502f6fa39782b1ffc">SetDropoutTestMode</a>(<span class="keyword">true</span>, &amp;nnet_copy);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeProbOptions.html">NnetComputeProbOptions</a> compute_prob_opts;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputeProb.html">NnetComputeProb</a> prob_computer_test(compute_prob_opts, nnet_copy);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a2b0d1bf88132455db1909b9b4dc91120">ComputeObjf</a>(<span class="keyword">false</span>, <span class="keyword">false</span>, egs, nnet_copy, &amp;prob_computer_test);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    prob_computer-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1NnetComputeProb.html#a372de693ad40b3f42839c8ec6ac845f4">Reset</a>();</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    std::vector&lt;NnetExample&gt;::const_iterator iter = egs.begin(),</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                              end = egs.end();</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      prob_computer-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1NnetComputeProb.html#a53888d6625f14935c28bc045bd5f8f80">Compute</a>(*iter);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordtype">double</span> tot_weights,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        tot_objf = prob_computer-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1NnetComputeProb.html#a3c14d15e4ffc8d57e30b61e1aea7e499">GetTotalObjective</a>(&amp;tot_weights);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tot_weights &gt; 0.0);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// inf/nan tot_objf-&gt;return -inf objective.</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (!(tot_objf == tot_objf &amp;&amp; tot_objf - tot_objf == 0))</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keywordflow">return</span> -std::numeric_limits&lt;double&gt;::infinity();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// we prefer to deal with normalized objective functions.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">return</span> tot_objf / tot_weights;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputeProb_html_a53888d6625f14935c28bc045bd5f8f80"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputeProb.html#a53888d6625f14935c28bc045bd5f8f80">kaldi::nnet3::NnetComputeProb::Compute</a></div><div class="ttdeci">void Compute(const NnetExample &amp;eg)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-diagnostics_8cc_source.html#l00079">nnet-diagnostics.cc:79</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8f15bc7a244b05a3f04e15d562043dc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8f15bc7a244b05a3f04e15d562043dc">kaldi::nnet3::SetBatchnormTestMode</a></div><div class="ttdeci">void SetBatchnormTestMode(bool test_mode, Nnet *nnet)</div><div class="ttdoc">This function affects only components of type BatchNormComponent. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00555">nnet-utils.cc:555</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputeProb_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputeProb.html">kaldi::nnet3::NnetComputeProb</a></div><div class="ttdoc">This class is for computing cross-entropy and accuracy values in a neural network, for diagnostics. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-diagnostics_8h_source.html#l00107">nnet-diagnostics.h:107</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2b0d1bf88132455db1909b9b4dc91120"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2b0d1bf88132455db1909b9b4dc91120">kaldi::nnet3::ComputeObjf</a></div><div class="ttdeci">double ComputeObjf(bool batchnorm_test_mode, bool dropout_test_mode, const std::vector&lt; NnetExample &gt; &amp;egs, const Nnet &amp;nnet, NnetComputeProb *prob_computer)</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-combine_8cc_source.html#l00035">nnet3-combine.cc:35</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af9757843e049a91502f6fa39782b1ffc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af9757843e049a91502f6fa39782b1ffc">kaldi::nnet3::SetDropoutTestMode</a></div><div class="ttdeci">void SetDropoutTestMode(bool test_mode, Nnet *nnet)</div><div class="ttdoc">This function affects components of child-classes of RandomComponent. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00564">nnet-utils.cc:564</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeProbOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeProbOptions.html">kaldi::nnet3::NnetComputeProbOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-diagnostics_8h_source.html#l00055">nnet-diagnostics.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputeProb_html_a3c14d15e4ffc8d57e30b61e1aea7e499"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputeProb.html#a3c14d15e4ffc8d57e30b61e1aea7e499">kaldi::nnet3::NnetComputeProb::GetTotalObjective</a></div><div class="ttdeci">double GetTotalObjective(double *tot_weight) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-diagnostics_8cc_source.html#l00309">nnet-diagnostics.cc:309</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputeProb_html_a372de693ad40b3f42839c8ec6ac845f4"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputeProb.html#a372de693ad40b3f42839c8ec6ac845f4">kaldi::nnet3::NnetComputeProb::Reset</a></div><div class="ttdeci">void Reset()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-diagnostics_8cc_source.html#l00069">nnet-diagnostics.cc:69</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a88aa85d232ba1ad6e430f6f6dcda29c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88aa85d232ba1ad6e430f6f6dcda29c1">&#9670;&nbsp;</a></span>ComputeSimpleNnetContext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeSimpleNnetContext </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>left_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>right_context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ComputeSimpleNnetContext computes the left-context and right-context of a nnet. </p>
<p>The nnet must satisfy IsSimpleNnet(nnet).</p>
<p>It does this by constructing a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> with a certain number of inputs available, outputs can be computed.. It does the same after shifting the time index of the output to all values 0, 1, ... n-1, where n is the output of nnet.Modulus(). Then it returns the largest left context and the largest right context that it infers from any of these computation requests. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00146">146</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00092">ComputeSimpleNnetContextForShift()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00052">IsSimpleNnet()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00658">Nnet::Modulus()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="nnet-compile-looped_8cc_source.html#l00361">CreateLoopedComputationRequestSimple()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00656">CachingOptimizingCompiler::GetSimpleNnetContext()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00821">Nnet::Info()</a>, <a class="el" href="decodable-simple-looped_8cc_source.html#l00056">DecodableNnetSimpleLoopedInfo::Init()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00483">NnetInfo()</a>, <a class="el" href="am-nnet-simple_8cc_source.html#l00096">AmNnetSimple::SetContext()</a>, and <a class="el" href="nnet-utils-test_8cc_source.html#l00029">UnitTestNnetContext()</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                                    {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04">IsSimpleNnet</a>(nnet));</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  int32 modulus = nnet.Modulus();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">// modulus &gt;= 1 is a number such that the network ought to be</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">// invariant to time shifts (of both the input and output) that</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// are a multiple of this number.  We need to test all shifts modulo</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">// this number in case the left and right context vary at all within</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// this range.</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  std::vector&lt;int32&gt; left_contexts(modulus + 1);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  std::vector&lt;int32&gt; right_contexts(modulus + 1);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// window_size is a number which needs to be greater than the total context</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">// of the nnet, else we won&#39;t be able to work out the context.  Large window</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// size will make this code slow, so we start off with small window size, and</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// if it isn&#39;t enough, we keep doubling it up to a maximum.</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  int32 window_size = 40, max_window_size = 800;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">while</span> (window_size &lt; max_window_size) {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// by going &quot;&lt;= modulus&quot; instead of &quot;&lt; modulus&quot; we do one more computation</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// than we really need; it becomes a sanity check.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    int32 input_start;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">for</span> (input_start = 0; input_start &lt;= modulus; input_start++) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a02fd3958c7eb4423610d526c73d4926a">ComputeSimpleNnetContextForShift</a>(nnet, input_start, window_size,</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                            &amp;(left_contexts[input_start]),</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                            &amp;(right_contexts[input_start])))</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (input_start &lt;= modulus) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="comment">// We broke from the loop over &#39;input_start&#39;, which means there was</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="comment">// a failure in ComputeSimpleNnextContextForShift-- we assume at</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="comment">// this point that it was because window_size was too small.</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      window_size *= 2;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(left_contexts[0] == left_contexts[modulus] &amp;&amp;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                 <span class="stringliteral">&quot;nnet does not have the properties we expect.&quot;</span>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(right_contexts[0] == right_contexts[modulus] &amp;&amp;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                 <span class="stringliteral">&quot;nnet does not have the properties we expect.&quot;</span>);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    *left_context =</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        *std::max_element(left_contexts.begin(), left_contexts.end());</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    *right_context =</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        *std::max_element(right_contexts.begin(), right_contexts.end());</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// Success.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Failure in ComputeSimpleNnetContext (perhaps not a simple nnet?)&quot;</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a02fd3958c7eb4423610d526c73d4926a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a02fd3958c7eb4423610d526c73d4926a">kaldi::nnet3::ComputeSimpleNnetContextForShift</a></div><div class="ttdeci">static bool ComputeSimpleNnetContextForShift(const Nnet &amp;nnet, int32 input_start, int32 window_size, int32 *left_context, int32 *right_context)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00092">nnet-utils.cc:92</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a672e127a288d02b4a8e292b86aadfc04"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04">kaldi::nnet3::IsSimpleNnet</a></div><div class="ttdeci">bool IsSimpleNnet(const Nnet &amp;nnet)</div><div class="ttdoc">This function returns true if the nnet has the following properties: It has an output called &quot;output&quot;...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00052">nnet-utils.cc:52</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a02fd3958c7eb4423610d526c73d4926a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02fd3958c7eb4423610d526c73d4926a">&#9670;&nbsp;</a></span>ComputeSimpleNnetContextForShift()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::ComputeSimpleNnetContextForShift </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>window_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>left_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>right_context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00092">92</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00071">EvaluateComputationRequest()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00466">Nnet::GetNodeIndex()</a>, <a class="el" href="nnet-computation_8h_source.html#l00074">IoSpecification::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00658">Nnet::Modulus()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8h_source.html#l00073">IoSpecification::name</a>, and <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l00146">ComputeSimpleNnetContext()</a>.</p>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                          {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  int32 input_end = input_start + window_size;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  IoSpecification input;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  input.name = <span class="stringliteral">&quot;input&quot;</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  IoSpecification output;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  output.name = <span class="stringliteral">&quot;output&quot;</span>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  IoSpecification ivector;  <span class="comment">// we might or might not use this.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  ivector.name = <span class="stringliteral">&quot;ivector&quot;</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = rand() % 10;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// in the IoSpecification for now we we will request all the same indexes at</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// output that we requested at input.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">for</span> (int32 t = input_start; t &lt; input_end; t++) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    input.indexes.push_back(Index(n, t));</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    output.indexes.push_back(Index(n, t));</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">// most networks will just require the ivector at time t = 0,</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// but this might not always be the case, and some might use rounding</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// descriptors with the iVector which might require it at an earlier</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// frame than the regular input, so we provide the iVector in as wide a range</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// as it might possibly be needed.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">for</span> (int32 t = input_start - nnet.Modulus(); t &lt; input_end; t++) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    ivector.indexes.push_back(Index(n, t));</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  ComputationRequest request;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  request.inputs.push_back(input);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  request.outputs.push_back(output);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">if</span> (nnet.GetNodeIndex(<span class="stringliteral">&quot;ivector&quot;</span>) != -1)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    request.inputs.push_back(ivector);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  std::vector&lt;std::vector&lt;bool&gt; &gt; computable;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a5683058729bb42a5e8462f9912484050">EvaluateComputationRequest</a>(nnet, request, &amp;computable);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computable.size() == 1);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  std::vector&lt;bool&gt; &amp;output_ok = computable[0];</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  std::vector&lt;bool&gt;::iterator iter =</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      std::find(output_ok.begin(), output_ok.end(), <span class="keyword">true</span>);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  int32 first_ok = iter - output_ok.begin();</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  int32 first_not_ok = std::find(iter, output_ok.end(), <span class="keyword">false</span>) -</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      output_ok.begin();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">if</span> (first_ok == window_size || first_not_ok &lt;= first_ok)</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  *left_context = first_ok;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  *right_context = window_size - first_not_ok;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a5683058729bb42a5e8462f9912484050"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a5683058729bb42a5e8462f9912484050">kaldi::nnet3::EvaluateComputationRequest</a></div><div class="ttdeci">void EvaluateComputationRequest(const Nnet &amp;nnet, const ComputationRequest &amp;request, std::vector&lt; std::vector&lt; bool &gt; &gt; *is_computable)</div><div class="ttdoc">Given an nnet and a computation request, this function works out which requested outputs in the compu...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00071">nnet-utils.cc:71</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a602adf8e3c912ce0b74cbc5700255867"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a602adf8e3c912ce0b74cbc5700255867">&#9670;&nbsp;</a></span>ComputeSubmatIndexHistogram()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ComputeSubmatIndexHistogram </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt;&#160;</td>
          <td class="paramname"><em>sorted_submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unordered_map&lt; int32, std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>submat_histogram</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00113">113</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00337">SplitLocations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sorted_submat_lists.size() &gt; 0);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// computing the submat_histogram</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// counting the occurrences of each element in the current submat_list;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// each new occurrence of the same element, in this list, is counted</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// as a seperate symbol for frequency counts</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sorted_submat_lists.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    unordered_map&lt;int32, std::vector&lt;int32&gt; &gt;::iterator histogram_iterator</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        = submat_histogram-&gt;end();</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    int32 repetition_count = 0;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">while</span> (j &lt; sorted_submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size()) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">if</span> ((histogram_iterator == submat_histogram-&gt;end()) ||</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          (histogram_iterator-&gt;first != sorted_submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][j].first)) {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        histogram_iterator =</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            submat_histogram-&gt;find(sorted_submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][j].first);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        repetition_count = 0;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// if a histogram entry was not found for this submat_index, add one</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span> (histogram_iterator == submat_histogram-&gt;end()) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          (*submat_histogram)[sorted_submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].first];</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;          histogram_iterator = submat_histogram-&gt;find(</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;              sorted_submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][j].first);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">if</span> (repetition_count &gt;= (histogram_iterator-&gt;second).size()) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment">// this is the first time the submat_index repeated this many times</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">// so add an entry for this in the count vector</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        (histogram_iterator-&gt;second).push_back(1);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        (histogram_iterator-&gt;second)[repetition_count]++;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      repetition_count++;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      j++;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae4c2ac8a9e96d220776910b2a9ae2971"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4c2ac8a9e96d220776910b2a9ae2971">&#9670;&nbsp;</a></span>ComputeTopSortOrder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeTopSortOrder </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>node_to_order</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given an acyclic graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming from the current node), compute a topological ordering of the graph nodes. </p>
<p>The output format is that node_to_order[n] contains an integer t = 0, 1, ... which is the order of node n in a topological sorting. node_to_order should contain some permutation of the numbers 0 ... graph.size() - 1. This function should crash if the graph contains cycles. </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00223">223</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph_8cc_source.html#l00196">ComputeTopSortOrderRecursive()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00265">ComputeNnetComputationEpochs()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00187">UnitTestComputeTopSortOrder()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00199">UnitTestComputeTopSortOrder2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                                          {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// Internally we use DFS, but we only put the node to &lt;node_to_order&gt; when all</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">// its parents have been visited.</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node_to_order != NULL);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  node_to_order-&gt;resize(graph.size());</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  std::vector&lt;bool&gt; cycle_detector(graph.size(), <span class="keyword">false</span>);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  std::vector&lt;bool&gt; is_visited(graph.size(), <span class="keyword">false</span>);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  std::vector&lt;int32&gt; reversed_orders;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">for</span>(int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; graph.size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span> (!is_visited[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a76f6120092b06acc2556c7b9e40c990e">ComputeTopSortOrderRecursive</a>(i, graph, &amp;cycle_detector,</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                   &amp;is_visited, &amp;reversed_orders);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node_to_order-&gt;size() == reversed_orders.size());</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; reversed_orders.size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(reversed_orders[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &gt;= 0 &amp;&amp; reversed_orders[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; graph.size());</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    (*node_to_order)[reversed_orders[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]] = graph.size() - <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a76f6120092b06acc2556c7b9e40c990e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a76f6120092b06acc2556c7b9e40c990e">kaldi::nnet3::ComputeTopSortOrderRecursive</a></div><div class="ttdeci">void ComputeTopSortOrderRecursive(int32 node, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; bool &gt; *cycle_detector, std::vector&lt; bool &gt; *is_visited, std::vector&lt; int32 &gt; *reversed_orders)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00196">nnet-graph.cc:196</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a76f6120092b06acc2556c7b9e40c990e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76f6120092b06acc2556c7b9e40c990e">&#9670;&nbsp;</a></span>ComputeTopSortOrderRecursive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ComputeTopSortOrderRecursive </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; *&#160;</td>
          <td class="paramname"><em>cycle_detector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; *&#160;</td>
          <td class="paramname"><em>is_visited</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>reversed_orders</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00196">196</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00223">ComputeTopSortOrder()</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                                                     {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node &gt;= 0 &amp;&amp; node &lt; graph.size());</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cycle_detector != NULL);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(is_visited != NULL);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(reversed_orders != NULL);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">if</span> ((*cycle_detector)[node]) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Cycle detected when computing the topological sorting order&quot;</span>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">if</span> (!(*is_visited)[node]) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    (*cycle_detector)[node] = <span class="keyword">true</span>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; graph[node].size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a76f6120092b06acc2556c7b9e40c990e">ComputeTopSortOrderRecursive</a>(graph[node][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], graph,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                                   cycle_detector, is_visited, reversed_orders);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    (*cycle_detector)[node] = <span class="keyword">false</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    (*is_visited)[node] = <span class="keyword">true</span>;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// At this point we have added all the children to &lt;reversed_orders&gt;, so we</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// can add the current now.</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    reversed_orders-&gt;push_back(node);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a76f6120092b06acc2556c7b9e40c990e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a76f6120092b06acc2556c7b9e40c990e">kaldi::nnet3::ComputeTopSortOrderRecursive</a></div><div class="ttdeci">void ComputeTopSortOrderRecursive(int32 node, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; bool &gt; *cycle_detector, std::vector&lt; bool &gt; *is_visited, std::vector&lt; int32 &gt; *reversed_orders)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00196">nnet-graph.cc:196</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a474b6a19fd42f428dd178f9af05150a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a474b6a19fd42f428dd178f9af05150a8">&#9670;&nbsp;</a></span>ComputeVariableAccesses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeVariableAccesses </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a> &amp;&#160;</td>
          <td class="paramname"><em>variables</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>command_attributes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Access.html">Access</a> &gt; &gt; *&#160;</td>
          <td class="paramname"><em>variable_accesses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>After the command-level attributes have been computed, this function organizes them per variable (see class <a class="el" href="classkaldi_1_1nnet3_1_1ComputationVariables.html" title="This class relates the matrices and sub-matrices in the computation to imaginary &quot;variables&quot;, such that we can think of the operations as operating on sets of individual variables, and we can then do analysis that lets us do optimization. ">ComputationVariables</a> for how a variable is defined; it is part of a matrix). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">variables</td><td>The definition of variables for this computation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">command_attributes</td><td>A vector of attributes, one per command, as obtained from <a class="el" href="namespacekaldi_1_1nnet3.html#aa02a576b6e9aa0977f3eb52471742b85">ComputeCommandAttributes()</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">variable_accesses</td><td>The output will have a size equal to the number of variables, and each element will be a vector of accesses, sorted by command index; each command will only be listed once in this vector. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l00421">421</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="stl-utils_8h_source.html#l00063">kaldi::IsSortedAndUniq()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-analyze_8h_source.html#l00076">kReadAccess</a>, <a class="el" href="nnet-analyze_8h_source.html#l00078">kReadWriteAccess</a>, <a class="el" href="nnet-analyze_8h_source.html#l00077">kWriteAccess</a>, <a class="el" href="nnet-analyze_8h_source.html#l00155">ComputationVariables::NumVariables()</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00049">CommandAttributes::variables_read</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00051">CommandAttributes::variables_written</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-analyze_8cc_source.html#l01421">Analyzer::Init()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00152">MoveSizingCommands()</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00226">Access::operator&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                                      {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  int32 num_variables = variables.NumVariables(),</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      num_commands = command_attributes.size();</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  variable_accesses-&gt;clear();</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  variable_accesses-&gt;resize(num_variables);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_commands; c++) {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keyword">const</span> CommandAttributes &amp;attr = command_attributes[c];</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(attr.variables_read));</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(attr.variables_written));</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    std::vector&lt;int32&gt; all_variables;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    all_variables.reserve(attr.variables_read.size() +</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                          attr.variables_written.size());</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    all_variables.insert(all_variables.end(), attr.variables_read.begin(),</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                         attr.variables_read.end());</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    all_variables.insert(all_variables.end(), attr.variables_written.begin(),</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                         attr.variables_written.end());</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;all_variables);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = all_variables.begin(),</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        end = all_variables.end();</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      int32 variable_index = *iter;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordtype">bool</span> is_read = std::binary_search(attr.variables_read.begin(),</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                                        attr.variables_read.end(),</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                        variable_index),</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          is_written = (!is_read ? <span class="keyword">true</span> :</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        std::binary_search(attr.variables_written.begin(),</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                           attr.variables_written.end(),</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                           variable_index));</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="keywordflow">if</span> (is_read &amp;&amp; is_written) {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        (*variable_accesses)[variable_index].push_back(</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            Access(c, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kReadWriteAccess</a>));</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_read) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        (*variable_accesses)[variable_index].push_back(</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            Access(c, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a>));</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        (*variable_accesses)[variable_index].push_back(</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            Access(c, <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>));</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kaldi::nnet3::kReadAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00076">nnet-analyze.h:76</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478af796329d6cdaaccf1b74d1811d17162e">kaldi::nnet3::kReadWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00078">nnet-analyze.h:78</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kaldi::nnet3::kWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00077">nnet-analyze.h:77</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00063">stl-utils.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa6233bfcefa3af15d41a8e565911a249"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6233bfcefa3af15d41a8e565911a249">&#9670;&nbsp;</a></span>ConsolidateIoOperations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConsolidateIoOperations </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This optimization puts the input operations (kAcceptInput) and output operations (kProvideOutput) at the very beginning or end of segments of computation, respectively. </p>
<p>This is actually necessary for computations to be run easily, because if these commands were interspersed with the regular commands, you'd have to call computer.Run() between the individual AcceptInput() and <a class="el" href="namespacekaldi.html#a16fbd0e97a7e1964c9c946fbeffc0651">GetOutput()</a> function calls. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00869">869</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kAcceptInput</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationMarker</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kProvideOutput</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00852">SplitComputationIntoSegments()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                                                           {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="comment">// These segments, represented as (start-index, end-index),</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">// are segments of the computation separated by kNoOperationMarker.</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; segments;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ad12ff98370e4200e533b92aa369444bf">SplitComputationIntoSegments</a>(*computation, &amp;segments);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  int32 num_commands = computation-&gt;commands.size();</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  std::vector&lt;NnetComputation::Command&gt; reordered_commands(num_commands);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// put kNoOperationMarker between all segments in the reordered commands.</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> s = 0; s + 1 &lt; segments.size(); s++)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    reordered_commands[segments[s].second].command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">// for each segment we&#39;ll divide the commands up into those that must appear</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="comment">// at the left of the segment (kAcceptInput for inputs and output-derivs), those</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// that must appear in the middle (most commands), those that must appear</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">// on the right (kProvideOutput for output nodes and input derivatives).</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  std::vector&lt;int32&gt; left_commands, middle_commands, right_commands;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> s = 0; s &lt; segments.size(); s++) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    int32 segment_start = segments[s].first,</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        segment_end = segments[s].second;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    left_commands.clear();</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    middle_commands.clear();</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    right_commands.clear();</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">for</span> (int32 c = segment_start; c &lt; segment_end; c++) {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordflow">if</span> (computation-&gt;commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>) {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        right_commands.push_back(c);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (computation-&gt;commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        left_commands.push_back(c);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        middle_commands.push_back(c);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = left_commands.begin(),</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        end = left_commands.end();</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    int32 c = segment_start;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter, ++c)</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      reordered_commands[c] = computation-&gt;commands[*iter];</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    iter = middle_commands.begin();</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    end = middle_commands.end();</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter, ++c)</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      reordered_commands[c] = computation-&gt;commands[*iter];</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    iter = right_commands.begin();</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    end = right_commands.end();</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter, ++c)</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      reordered_commands[c] = computation-&gt;commands[*iter];</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c == segment_end);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  computation-&gt;commands.swap(reordered_commands);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad12ff98370e4200e533b92aa369444bf"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad12ff98370e4200e533b92aa369444bf">kaldi::nnet3::SplitComputationIntoSegments</a></div><div class="ttdeci">static void SplitComputationIntoSegments(const NnetComputation &amp;computation, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *segments)</div><div class="ttdoc">Split the computation up into segments bounded by kNoOperationMarker. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00852">nnet-optimize.cc:852</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a322efc02a286b646c40b65235c432893"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a322efc02a286b646c40b65235c432893">&#9670;&nbsp;</a></span>ConsolidateMemory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConsolidateMemory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This just calls <a class="el" href="namespacekaldi_1_1nnet3.html#a322efc02a286b646c40b65235c432893" title="This just calls ConsolidateMemory() on all the components of the nnet. ">ConsolidateMemory()</a> on all the components of the nnet. </p>
<p>This is called by the training code after processing the first minibatch. On some components this will do nothing; on some components it will reallocate certain quantities that have been allocated during training (mostly the contents of NaturalGradientOnline objects, and stats for NonlinearComponents) so that they can be put into low memory. This will tend to minimize memory fragmentation. Read comments in ../cudamatrix/cu-allocator.h for more explanation. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l01061">1061</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-component-itf_8h_source.html#l00394">Component::ConsolidateMemory()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00620">NonlinearComponent::OutputDim()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00062">NnetChainTrainer::Train()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00059">NnetTrainer::Train()</a>.</p>
<div class="fragment"><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                                   {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordtype">bool</span> print_memory_info = (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 1);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keywordflow">if</span> (print_memory_info) {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(1) &lt;&lt; <span class="stringliteral">&quot;Consolidating memory; will print memory usage before &quot;</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;          <span class="stringliteral">&quot;and after consolidating:&quot;</span>;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      g_cuda_allocator.PrintMemoryUsage();</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    }</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      comp-&gt;ConsolidateMemory();</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (print_memory_info) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      g_cuda_allocator.PrintMemoryUsage();</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div><div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af512f7de6c401fbdf7013d62295df9c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af512f7de6c401fbdf7013d62295df9c2">&#9670;&nbsp;</a></span>ConsolidateModelUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConsolidateModelUpdate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This optimization consolidates the model-update part of backprop commands, for components in (e.g.) recurrent networks that need to have many separate backprop commands, into more efficient single commands operating on consolidated data in larger matrices. </p>
<p>This consolidates the model-update parts of the backprop into larger operations (applicable mostly to recurrent setups)&ndash; internally it uses class <a class="el" href="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator.html" title="This class is responsible for consolidating the model-update part of backprop commands, for components in (e.g.) recurrent networks that need to have many separate backprop commands, into more efficient single commands operating on consolidated data in larger matrices. ">ModelUpdateConsolidator</a>.</p>
<p>This is useful for recurrent networks. The resulting computation separates the backprop for data-derivatives from the model-update part of backprop.</p>
<p>Will fail if called a second time. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l01551">1551</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l01515">ModelUpdateConsolidator::ConsolidateModelUpdate()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00442">NnetComputation::need_model_derivative</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                                                          {</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="comment">// This following if-statement is an optimization: if the computation</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="comment">// request(s) had need_model_derivative == false, there would be nothing to</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="comment">// optimize, so don&#39;t bother trying.</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="keywordflow">if</span> (!computation-&gt;need_model_derivative)</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  ModelUpdateConsolidator consolidator(nnet, computation);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  consolidator.ConsolidateModelUpdate();</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a8f170223a0b8d8f515dbc03279e78a4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f170223a0b8d8f515dbc03279e78a4a">&#9670;&nbsp;</a></span>ConstrainOrthonormal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConstrainOrthonormal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function, to be called after processing every minibatch, is responsible for enforcing the orthogonality constraint for any components of type <a class="el" href="classkaldi_1_1nnet3_1_1LinearComponent.html">LinearComponent</a> or inheriting from <a class="el" href="classkaldi_1_1nnet3_1_1AffineComponent.html">AffineComponent</a> that have the "orthonormal_constraint" value set. </p>
<p>This function, to be called after processing every minibatch, is responsible for enforcing the orthogonality constraint for any components of type <a class="el" href="classkaldi_1_1nnet3_1_1LinearComponent.html">LinearComponent</a> or inheriting from <a class="el" href="classkaldi_1_1nnet3_1_1AffineComponent.html">AffineComponent</a> that have the "orthonormal-constraint" value set to a nonzero value.</p>
<p>Technically what we are doing is constraining the parameter matrix M to be a "semi-orthogonal" matrix times a constant alpha. That is: if num-rows &gt; num-cols, this amounts to asserting that M M^T == alpha^2 I; otherwise, that M^T M == alpha^2 I.</p>
<p>If, for a particular component, orthonormal-constraint &gt; 0.0, then that value becomes the "alpha" mentioned above. If orthonormal-constraint == 0.0, then nothing is done. If orthonormal-constraint &lt; 0.0, then it's like letting alpha "float", i.e. we try to make M closer to (any constant alpha) times a semi-orthogonal matrix.</p>
<p>In order to make it efficient on GPU, it doesn't make it completely orthonormal, it just makes it closer to being orthonormal (times the 'orthonormal_constraint' value). Over multiple iterations this rapidly makes it almost exactly orthonormal.</p>
<p>See <a href="http://www.danielpovey.com/files/2018_interspeech_tdnnf.pdf">http://www.danielpovey.com/files/2018_interspeech_tdnnf.pdf</a> </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l01022">1022</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00896">ConstrainOrthonormalInternal()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00457">AffineComponent::LinearParams()</a>, <a class="el" href="_2nnet-convolutional-component_8h_source.html#l00554">TdnnComponent::LinearParams()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00411">AffineComponent::OrthonormalConstraint()</a>, <a class="el" href="_2nnet-convolutional-component_8h_source.html#l00560">TdnnComponent::OrthonormalConstraint()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00971">LinearComponent::OrthonormalConstraint()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00972">LinearComponent::Params()</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00170">NnetChainTrainer::TrainInternal()</a>, <a class="el" href="nnet-training_8cc_source.html#l00093">NnetTrainer::TrainInternal()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00223">NnetChainTrainer::TrainInternalBackstitch()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00133">NnetTrainer::TrainInternalBackstitch()</a>.</p>
<div class="fragment"><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                      {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    Component *component = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    CuMatrixBase&lt;BaseFloat&gt; *params = NULL;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> orthonormal_constraint = 0.0;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    LinearComponent *lc = <span class="keyword">dynamic_cast&lt;</span>LinearComponent*<span class="keyword">&gt;</span>(component);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">if</span> (lc != NULL &amp;&amp; lc-&gt;OrthonormalConstraint() != 0.0) {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      orthonormal_constraint = lc-&gt;OrthonormalConstraint();</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      params = &amp;(lc-&gt;Params());</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    AffineComponent *ac = <span class="keyword">dynamic_cast&lt;</span>AffineComponent*<span class="keyword">&gt;</span>(component);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">if</span> (ac != NULL &amp;&amp; ac-&gt;OrthonormalConstraint() != 0.0) {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      orthonormal_constraint = ac-&gt;OrthonormalConstraint();</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      params = &amp;(ac-&gt;LinearParams());</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    TdnnComponent *tc = <span class="keyword">dynamic_cast&lt;</span>TdnnComponent*<span class="keyword">&gt;</span>(component);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">if</span> (tc != NULL &amp;&amp; tc-&gt;OrthonormalConstraint() != 0.0) {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      orthonormal_constraint = tc-&gt;OrthonormalConstraint();</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      params = &amp;(tc-&gt;LinearParams());</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">if</span> (orthonormal_constraint == 0.0 || <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) != 0) {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="comment">// For efficiency, only do this every 4 or so minibatches-- it won&#39;t have</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="comment">// time stray far from the constraint in between.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    int32 rows = params-&gt;NumRows(), cols = params-&gt;NumCols();</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keywordflow">if</span> (rows &lt;= cols) {</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#aa586e633b1a081bc50483c9041761fd7">ConstrainOrthonormalInternal</a>(orthonormal_constraint, params);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      CuMatrix&lt;BaseFloat&gt; params_trans(*params, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#aa586e633b1a081bc50483c9041761fd7">ConstrainOrthonormalInternal</a>(orthonormal_constraint, &amp;params_trans);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      params-&gt;CopyFromMat(params_trans, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  }</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa586e633b1a081bc50483c9041761fd7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa586e633b1a081bc50483c9041761fd7">kaldi::nnet3::ConstrainOrthonormalInternal</a></div><div class="ttdeci">void ConstrainOrthonormalInternal(BaseFloat scale, CuMatrixBase&lt; BaseFloat &gt; *M)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00896">nnet-utils.cc:896</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa586e633b1a081bc50483c9041761fd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa586e633b1a081bc50483c9041761fd7">&#9670;&nbsp;</a></span>ConstrainOrthonormalInternal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ConstrainOrthonormalInternal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>M</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00896">896</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l00941">CuMatrixBase&lt; Real &gt;::AddMat()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00570">CuMatrixBase&lt; Real &gt;::AddToDiag()</a>, <a class="el" href="cu-matrix_8cc_source.html#l02936">CuMatrixBase&lt; Real &gt;::CopyLowerToUpper()</a>, <a class="el" href="cu-matrix_8h_source.html#l00225">CuMatrixBase&lt; Real &gt;::FrobeniusNorm()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01340">CuMatrixBase&lt; Real &gt;::SymAddMat2()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03042">CuMatrixBase&lt; Real &gt;::Trace()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l01022">ConstrainOrthonormal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                                                               {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(scale != 0.0);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">// We&#39;d like to enforce the rows of M to be orthonormal.</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="comment">// define P = M M^T.  If P is unit then M has orthonormal rows.</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// We actually want P to equal scale^2 * I, so that M&#39;s rows are</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// orthogonal with 2-norms equal to &#39;scale&#39;.</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// We (notionally) add to the objective function, the value</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// -alpha times the sum of squared elements of Q = (P - scale^2 * I).</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  int32 rows = M-&gt;NumRows(), cols = M-&gt;NumCols();</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  CuMatrix&lt;BaseFloat&gt; M_update(rows, cols);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  CuMatrix&lt;BaseFloat&gt; P(rows, rows);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  P.SymAddMat2(1.0, *M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  P.CopyLowerToUpper();</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// The &#39;update_speed&#39; is a constant that determines how fast we approach a</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">// matrix with the desired properties (larger -&gt; faster).  Larger values will</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">// update faster but will be more prone to instability.  0.125 (1/8) is the</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="comment">// value that gives us the fastest possible convergence when we are already</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="comment">// close to be a semi-orthogonal matrix (in fact, it will lead to quadratic</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">// convergence).</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">// See  http://www.danielpovey.com/files/2018_interspeech_tdnnf.pdf</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">// for more details.</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> update_speed = 0.125;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordtype">bool</span> floating_scale = (scale &lt; 0.0);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordflow">if</span> (floating_scale) {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">// This (letting the scale &quot;float&quot;) is described in Sec. 2.3 of</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="comment">// http://www.danielpovey.com/files/2018_interspeech_tdnnf.pdf,</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="comment">// where &#39;scale&#39; here is written &#39;alpha&#39; in the paper.</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">// We pick the scale that will give us an update to M that is</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="comment">// orthogonal to M (viewed as a vector): i.e., if we&#39;re doing</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="comment">// an update M := M + X, then we want to have tr(M X^T) == 0.</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="comment">// The following formula is what gives us that.</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">// With P = M M^T, our update formula is doing to be:</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="comment">//  M := M + (-4 * alpha * (P - scale^2 I) * M).</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">// (The math below explains this update formula; for now, it&#39;s</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="comment">// best to view it as an established fact).</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">// So X (the change in M) is -4 * alpha * (P - scale^2 I) * M,</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="comment">// where alpha == update_speed / scale^2.</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="comment">// We want tr(M X^T) == 0.  First, forget the -4*alpha, because</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="comment">// we don&#39;t care about constant factors.  So we want:</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">//  tr(M * M^T * (P - scale^2 I)) == 0.</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="comment">// Since M M^T == P, that means:</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="comment">//  tr(P^2 - scale^2 P) == 0,</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="comment">// or scale^2 = tr(P^2) / tr(P).</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">// Note: P is symmetric so it doesn&#39;t matter whether we use tr(P P) or</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="comment">// tr(P^T P); we use tr(P^T P) because I believe it&#39;s faster to compute.</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> trace_P = P.Trace(), trace_P_P = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(P, P, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    scale = std::sqrt(trace_P_P / trace_P);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">// The following is a tweak to avoid divergence when the eigenvalues aren&#39;t</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="comment">// close to being the same.  trace_P is the sum of eigenvalues of P, and</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="comment">// trace_P_P is the sum-square of eigenvalues of P.  Treat trace_P as a sum</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// of positive values, and trace_P_P as their sumsq.  Then mean = trace_P /</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">// dim, and trace_P_P cannot be less than dim * (trace_P / dim)^2,</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="comment">// i.e. trace_P_P &gt;= trace_P^2 / dim.  If ratio = trace_P_P * dim /</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">// trace_P^2, then ratio &gt;= 1.0, and the excess above 1.0 is a measure of</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">// how far we are from convergence.  If we&#39;re far from convergence, we make</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">// the learning rate slower to reduce the risk of divergence, since the</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="comment">// update may not be stable for starting points far from equilibrium.</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ratio = (trace_P_P * P.NumRows() / (trace_P * trace_P));</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ratio &gt; 0.999);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span> (ratio &gt; 1.02) {</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      update_speed *= 0.5;  <span class="comment">// Slow down the update speed to reduce the risk of divergence.</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <span class="keywordflow">if</span> (ratio &gt; 1.1) update_speed *= 0.5;  <span class="comment">// Slow it down even more.</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  }</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  P.AddToDiag(-1.0 * scale * scale);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="comment">// We may want to un-comment the following code block later on if we have a</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="comment">// problem with instability in setups with a non-floating orthonormal</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="comment">// constraint.</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">  if (!floating_scale) {</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">    // This is analogous to the stuff with &#39;ratio&#39; above, but when we don&#39;t have</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">    // a floating scale.  It reduces the chances of divergence when we have</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">    // a bad initialization.</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">    BaseFloat error = P.FrobeniusNorm(),</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">        error_proportion = error * error / P.NumRows();</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">    // &#39;error_proportion&#39; is the sumsq of elements in (P - I) divided by the</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">    // sumsq of elements of I.  It should be much less than one (i.e. close to</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">    // zero) if the error is small.</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">    if (error_proportion &gt; 0.02) {</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">      update_speed *= 0.5;</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">      if (error_proportion &gt; 0.1)</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">        update_speed *= 0.5;</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 1) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> error = P.FrobeniusNorm();</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Error in orthogonality is &quot;</span> &lt;&lt; error;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// see Sec. 2.2 of http://www.danielpovey.com/files/2018_interspeech_tdnnf.pdf</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="comment">// for explanation of the 1/(scale*scale) factor, but there is a difference in</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="comment">// notation; &#39;scale&#39; here corresponds to &#39;alpha&#39; in the paper, and</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="comment">// &#39;update_speed&#39; corresponds to &#39;nu&#39; in the paper.</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha = update_speed / (scale * scale);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="comment">// At this point, the matrix P contains what, in the math, would be Q =</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">// P-scale^2*I.  The derivative of the objective function w.r.t. an element q(i,j)</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// of Q is now equal to -2*alpha*q(i,j), i.e. we could write q_deriv(i,j)</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="comment">// = -2*alpha*q(i,j) This is also the derivative of the objective function</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// w.r.t. p(i,j): i.e. p_deriv(i,j) = -2*alpha*q(i,j).</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="comment">// Suppose we have define this matrix as &#39;P_deriv&#39;.</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="comment">// The derivative of the objective w.r.t M equals</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="comment">// 2 * P_deriv * M, which equals -4*alpha*(P-scale^2*I)*M.</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">// (Currently the matrix P contains what, in the math, is P-scale^2*I).</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  M_update.AddMatMat(-4.0 * alpha, P, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, *M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  M-&gt;AddMat(1.0, M_update);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;}</div><div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d106dafc23aa3dc2359adc0bb2a94bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d106dafc23aa3dc2359adc0bb2a94bd">&#9670;&nbsp;</a></span>ContainsSingleExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::ContainsSingleExample </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>min_input_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>max_input_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>min_output_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>max_output_t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if the "eg" contains just a single example, meaning that all the "n" values in the indexes are zero, and the example has <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> members named both "input" and "output". </p>
<p>Also computes the minimum and maximum "t" values in the "input" and "output" <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> members. </p>

<p class="definition">Definition at line <a class="el" href="nnet3-copy-egs_8cc_source.html#l00082">82</a> of file <a class="el" href="nnet3-copy-egs_8cc_source.html">nnet3-copy-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, and <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-copy-egs_8cc_source.html#l00222">SelectFromExample()</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                                                {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">bool</span> done_input = <span class="keyword">false</span>, done_output = <span class="keyword">false</span>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  int32 num_indexes = eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.size();</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_indexes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> &amp;io = eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    std::vector&lt;Index&gt;::const_iterator iter = io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.begin(),</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                                        end = io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.end();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// Should not have an empty input/output type.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.empty());</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">name</a> == <span class="stringliteral">&quot;input&quot;</span> || io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">name</a> == <span class="stringliteral">&quot;output&quot;</span>) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      int32 min_t = iter-&gt;t, max_t = iter-&gt;t;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        int32 this_t = iter-&gt;t;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        min_t = std::min(min_t, this_t);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        max_t = std::max(max_t, this_t);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;n != 0) {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Example does not contain just a single example; &quot;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;too late to do frame selection or reduce context.&quot;</span>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keywordflow">if</span> (io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">name</a> == <span class="stringliteral">&quot;input&quot;</span>) {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        done_input = <span class="keyword">true</span>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        *min_input_t = min_t;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        *max_input_t = max_t;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">name</a> == <span class="stringliteral">&quot;output&quot;</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        done_output = <span class="keyword">true</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        *min_output_t = min_t;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        *max_output_t = max_t;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;n != 0) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Example does not contain just a single example; &quot;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;too late to do frame selection or reduce context.&quot;</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">if</span> (!done_input) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Example does not have any input named &#39;input&#39;&quot;</span>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">if</span> (!done_output) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Example does not have any output named &#39;output&#39;&quot;</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html">kaldi::nnet3::NnetIo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00033">nnet-example.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_aa3daaa77b972f8dace077e94b418aab1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">kaldi::nnet3::NnetIo::indexes</a></div><div class="ttdeci">std::vector&lt; Index &gt; indexes</div><div class="ttdoc">&quot;indexes&quot; is a vector the same length as features.NumRows(), explaining the meaning of each row of th...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00042">nnet-example.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">kaldi::nnet3::NnetIo::name</a></div><div class="ttdeci">std::string name</div><div class="ttdoc">the name of the input in the neural net; in simple setups it will just be &quot;input&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00036">nnet-example.h:36</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac759ea60772df625784bcc714f7a41da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac759ea60772df625784bcc714f7a41da">&#9670;&nbsp;</a></span>ConvertAdditionToAssignment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConvertAdditionToAssignment </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This converts addition operations (things with Add in their names) to copy operations (things with Copy in their names). </p>
<p>This is slightly more efficient, and it may later allow us to remove unnecessary zeroing. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00430">430</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00340">NnetComputation::Command::alpha</a>, <a class="el" href="nnet-analyze_8h_source.html#l00296">Analyzer::command_attributes</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01182">ComputationAnalysis::FirstNontrivialAccess()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01421">Analyzer::Init()</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kAddRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddToRowsMulti</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kCopyRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyToRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixAdd</a>, and <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixCopy</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                                                               {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  Analyzer analyzer;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  analyzer.Init(nnet, *computation);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  ComputationAnalysis analysis(*computation, analyzer);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  int32 num_commands = computation-&gt;commands.size();</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">for</span> (int32 command = 0; command &lt; num_commands; command++) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    NnetComputation::Command &amp;c = computation-&gt;commands[command];</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>:</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>: {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;submatrices_written =</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            analyzer.command_attributes[command].submatrices_written;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!submatrices_written.empty());</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        std::vector&lt;int32&gt;::const_iterator iter = submatrices_written.begin(),</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            end = submatrices_written.end();</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordtype">bool</span> can_convert = <span class="keyword">true</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          int32 submatrix_written = *iter;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          int32 first_access_command = analysis.FirstNontrivialAccess(</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;              submatrix_written);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          <span class="comment">// first_access_command is first command other than zeroing and</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;          <span class="comment">// allocation that accesses this submatrix.  It can be assumed to be a</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          <span class="comment">// write command, since it makes no sense to read a variable before</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;          <span class="comment">// it&#39;s written to.  If it&#39;s before this command then we need to add</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;          <span class="comment">// rather than copy; we can&#39;t do the conversion to a copy command.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;          <span class="keywordflow">if</span> (first_access_command != command) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            can_convert = <span class="keyword">false</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;          }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">if</span> (can_convert) {  <span class="comment">// convert to a copy command.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>: c.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>: c.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>: c.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="comment">// note: kCopyToRowsMulti does not currently support alpha != 1.0.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>: <span class="keywordflow">if</span> (c.alpha == 1.0) c.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">default</span>: <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected command type.&quot;</span>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;          }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4a1bed82d2cb5fbdc695bf32053117ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a1bed82d2cb5fbdc695bf32053117ad">&#9670;&nbsp;</a></span>ConvertNumNValues()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ConvertNumNValues </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>n_stride</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>old_N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>new_N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>indexes_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03106">3106</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, and <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l03794">ComputationExpander::ExpandIndexes()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l03822">IoSpecificationIsDecomposable()</a>.</p>
<div class="fragment"><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                                                             {</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;  int32 size_in = indexes_in.size();</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(size_in &gt; 0 &amp;&amp; indexes_in[size_in - 1].<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> == old_N - 1);</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  int32 block_size_in = n_stride * old_N,</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      block_size_out = n_stride * new_N;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;  indexes_out-&gt;resize((size_in / old_N) * new_N);</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;  <span class="keywordflow">for</span> (int32 i_in = 0; i_in &lt; size_in; i_in++) {</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    <span class="keywordflow">if</span> (indexes_in[i_in].<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> != 0)</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    Index index(indexes_in[i_in]);</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;    int32 block_index = i_in / block_size_in,</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        offset_within_block = i_in % block_size_in;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    int32 i_out = block_index * block_size_out +</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        offset_within_block;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; new_N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++, i_out += n_stride) {</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;      index.n = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      (*indexes_out)[i_out] = index;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    }</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;  }</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a52b9ed9b365e986bbbc29a310aae2f8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52b9ed9b365e986bbbc29a310aae2f8f">&#9670;&nbsp;</a></span>ConvertRepeatedToBlockAffine() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ConvertRepeatedToBlockAffine </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1CompositeComponent.html">CompositeComponent</a> *&#160;</td>
          <td class="paramname"><em>c_component</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00438">438</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-simple-component_8cc_source.html#l05542">CompositeComponent::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02558">CompositeComponent::NumComponents()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05547">CompositeComponent::SetComponent()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l00459">ConvertRepeatedToBlockAffine()</a>, <a class="el" href="nnet3-am-copy_8cc_source.html#l00028">main()</a>, <a class="el" href="nnet-utils-test_8cc_source.html#l00050">UnitTestConvertRepeatedToBlockAffine()</a>, and <a class="el" href="nnet-utils-test_8cc_source.html#l00082">UnitTestConvertRepeatedToBlockAffineComposite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                                                                   {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">for</span>(int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; c_component-&gt;NumComponents(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keyword">const</span> Component *c = c_component-&gt;GetComponent(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c-&gt;Type() != <span class="stringliteral">&quot;CompositeComponent&quot;</span> &amp;&amp;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                 <span class="stringliteral">&quot;Nesting CompositeComponent within CompositeComponent is not allowed.\n&quot;</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                 <span class="stringliteral">&quot;(We may change this as more complicated components are introduced.)&quot;</span>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">if</span>(c-&gt;Type() == <span class="stringliteral">&quot;RepeatedAffineComponent&quot;</span> ||</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;       c-&gt;Type() == <span class="stringliteral">&quot;NaturalGradientRepeatedAffineComponent&quot;</span>) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="comment">// N.B.: NaturalGradientRepeatedAffineComponent is a subclass of</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="comment">// RepeatedAffineComponent.</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keyword">const</span> RepeatedAffineComponent *rac =</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>RepeatedAffineComponent*<span class="keyword">&gt;</span>(c);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(rac != NULL);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      BlockAffineComponent *bac = <span class="keyword">new</span> BlockAffineComponent(*rac);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">// following call deletes rac</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      c_component-&gt;SetComponent(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, bac);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a30d342f16140837bd5ca9f384d62478e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30d342f16140837bd5ca9f384d62478e">&#9670;&nbsp;</a></span>ConvertRepeatedToBlockAffine() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConvertRepeatedToBlockAffine </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert all components of type <a class="el" href="classkaldi_1_1nnet3_1_1RepeatedAffineComponent.html">RepeatedAffineComponent</a> or <a class="el" href="classkaldi_1_1nnet3_1_1NaturalGradientRepeatedAffineComponent.html">NaturalGradientRepeatedAffineComponent</a> to <a class="el" href="classkaldi_1_1nnet3_1_1BlockAffineComponent.html" title="This class implements an affine transform using a block diagonal matrix e.g., one whose weight matrix...">BlockAffineComponent</a> in nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00459">459</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00438">ConvertRepeatedToBlockAffine()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00155">Nnet::SetComponent()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>
<div class="fragment"><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                              {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">for</span>(int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nnet-&gt;NumComponents(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keyword">const</span> Component *const_c = nnet-&gt;GetComponent(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span>(const_c-&gt;Type() == <span class="stringliteral">&quot;RepeatedAffineComponent&quot;</span> ||</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;       const_c-&gt;Type() == <span class="stringliteral">&quot;NaturalGradientRepeatedAffineComponent&quot;</span>) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="comment">// N.B.: NaturalGradientRepeatedAffineComponent is a subclass of</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="comment">// RepeatedAffineComponent.</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keyword">const</span> RepeatedAffineComponent *rac =</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>RepeatedAffineComponent*<span class="keyword">&gt;</span>(const_c);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(rac != NULL);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      BlockAffineComponent *bac = <span class="keyword">new</span> BlockAffineComponent(*rac);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="comment">// following call deletes rac</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      nnet-&gt;SetComponent(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, bac);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (const_c-&gt;Type() == <span class="stringliteral">&quot;CompositeComponent&quot;</span>) {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="comment">// We must modify the composite component, so we use the</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="comment">// non-const GetComponent() call here.</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      Component *c = nnet-&gt;GetComponent(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      CompositeComponent *cc = <span class="keyword">dynamic_cast&lt;</span>CompositeComponent*<span class="keyword">&gt;</span>(c);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cc != NULL);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a30d342f16140837bd5ca9f384d62478e">ConvertRepeatedToBlockAffine</a>(cc);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a30d342f16140837bd5ca9f384d62478e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a30d342f16140837bd5ca9f384d62478e">kaldi::nnet3::ConvertRepeatedToBlockAffine</a></div><div class="ttdeci">void ConvertRepeatedToBlockAffine(Nnet *nnet)</div><div class="ttdoc">Convert all components of type RepeatedAffineComponent or NaturalGradientRepeatedAffineComponent to B...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00459">nnet-utils.cc:459</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae99488174e8dde27f8f30d91d61c0cd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae99488174e8dde27f8f30d91d61c0cd2">&#9670;&nbsp;</a></span>ConvertToIndexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ConvertToIndexes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>location_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>first_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>second_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If it is the case for some i &gt;= 0 that all the .first elements of "location_vector" are either i or -1, then output i to first_value and the .second elements into "second_values", and return true. </p>
<p>Otherwise return false and the outputs are don't-cares. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00377">377</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00887">Compiler::CompileBackwardFromSubmatLocations()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00772">Compiler::CompileForwardFromSubmatLocations()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00498">SplitLocationsBackward()</a>, <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00275">UnitTestSplitLocations()</a>, and <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00070">UnitTestSplitLocationsBackward()</a>.</p>
<div class="fragment"><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                      {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  *first_value = -1;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  second_values-&gt;clear();</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  second_values-&gt;reserve(location_vector.size());</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::const_iterator iter;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">for</span> (iter = location_vector.begin(); iter &lt; location_vector.end(); ++iter)  {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (iter-&gt;first != -1) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">if</span> (*first_value == -1)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        *first_value = iter-&gt;first;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordflow">if</span> (iter-&gt;first != *first_value)</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      second_values-&gt;push_back(iter-&gt;second);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    } <span class="keywordflow">else</span>  {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      second_values-&gt;push_back(-1);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="af8124e07bfb116ca78c0137eecf0f8a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8124e07bfb116ca78c0137eecf0f8a8">&#9670;&nbsp;</a></span>CopyPairVector() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::CopyPairVector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; <a class="el" href="structInt32Pair.html">Int32Pair</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-general-component_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet-general-component_8cc_source.html">nnet-general-component.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-array-inl_8h_source.html#l00173">CuArrayBase&lt; T &gt;::CopyToVec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-general-component_8cc_source.html#l00271">StatisticsExtractionComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00540">StatisticsPoolingComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00256">StatisticsExtractionComponentPrecomputedIndexes::Write()</a>, and <a class="el" href="nnet-general-component_8cc_source.html#l00528">StatisticsPoolingComponentPrecomputedIndexes::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                                                {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  in.<a class="code" href="classkaldi_1_1CuArrayBase.html#a01939563b08e485324adbf1b68e4ae73">CopyToVec</a>(<span class="keyword">reinterpret_cast&lt;</span>std::vector&lt;Int32Pair&gt;*<span class="keyword">&gt;</span>(out));</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuArrayBase_html_a01939563b08e485324adbf1b68e4ae73"><div class="ttname"><a href="classkaldi_1_1CuArrayBase.html#a01939563b08e485324adbf1b68e4ae73">kaldi::CuArrayBase::CopyToVec</a></div><div class="ttdeci">void CopyToVec(std::vector&lt; T &gt; *dst) const</div><div class="ttdoc">This function resizes *dst if needed. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array-inl_8h_source.html#l00173">cu-array-inl.h:173</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a54bb6572c1c41a08dbadd1ec50d7876f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54bb6572c1c41a08dbadd1ec50d7876f">&#9670;&nbsp;</a></span>CopyPairVector() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::CopyPairVector </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; <a class="el" href="structInt32Pair.html">Int32Pair</a> &gt; *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-general-component_8cc_source.html#l00036">36</a> of file <a class="el" href="nnet-general-component_8cc_source.html">nnet-general-component.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-array-inl_8h_source.html#l00119">CuArray&lt; T &gt;::CopyFromVec()</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                                                 {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keyword">const</span> std::vector&lt;Int32Pair&gt; *in_cast =</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>std::vector&lt;Int32Pair&gt;*<span class="keyword">&gt;</span>(&amp;in);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  out-&gt;<a class="code" href="classkaldi_1_1CuArray.html#a406d7bbca5f16c2b7a17534ec2cd58f6">CopyFromVec</a>(*in_cast);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuArray_html_a406d7bbca5f16c2b7a17534ec2cd58f6"><div class="ttname"><a href="classkaldi_1_1CuArray.html#a406d7bbca5f16c2b7a17534ec2cd58f6">kaldi::CuArray::CopyFromVec</a></div><div class="ttdeci">void CopyFromVec(const std::vector&lt; T &gt; &amp;src)</div><div class="ttdoc">This function resizes if needed. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array-inl_8h_source.html#l00119">cu-array-inl.h:119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e904151f4a628424a90335e58c9dbe0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e904151f4a628424a90335e58c9dbe0">&#9670;&nbsp;</a></span>CreateComputationRequestInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::CreateComputationRequestInternal </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>begin_input_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>end_input_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>begin_output_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>end_output_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_sequences</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_subsampling_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::set&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>ivector_times</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00113">113</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00164">CreateLoopedComputationRequest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                 {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  request-&gt;inputs.reserve(2);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  request-&gt;inputs.clear();</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  request-&gt;inputs.resize(1 + (ivector_times.empty() ? 0 : 1));</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  request-&gt;inputs[0].name = <span class="stringliteral">&quot;input&quot;</span>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  request-&gt;inputs[0].has_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  request-&gt;outputs.clear();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  request-&gt;outputs.resize(1);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  request-&gt;outputs[0].name = <span class="stringliteral">&quot;output&quot;</span>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  request-&gt;outputs[0].has_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">if</span> (!ivector_times.empty()) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    request-&gt;inputs[1].name = <span class="stringliteral">&quot;ivector&quot;</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    request-&gt;inputs[1].has_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// in the computation request the &#39;n&#39; indexes (the sequence/utterance indexes)</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// have the larger stride than &#39;t&#39;, although this is opposite to the way it&#39;s</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// done inside the computation.  This is for user convenience where it may be</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// easier to deal with submatrixes per sequence.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_sequences; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    int32 x = 0;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">for</span> (int32 t = begin_input_t; t &lt; end_input_t; t++) {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      request-&gt;inputs[0].indexes.push_back(Index(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, t, x));</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">for</span> (int32 t = begin_output_t;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;         t &lt; end_output_t;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;         t += frame_subsampling_factor)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      request-&gt;outputs[0].indexes.push_back(Index(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, t, x));</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span> (!ivector_times.empty()) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    request-&gt;inputs.resize(2);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    request-&gt;inputs[1].name = <span class="stringliteral">&quot;ivector&quot;</span>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    request-&gt;inputs[1].has_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_sequences; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="comment">// note: std::sets store things in sorted order.</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">for</span> (std::set&lt;int32&gt;::const_iterator iter = ivector_times.begin();</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;           iter != ivector_times.end(); ++iter) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        int32 t = *iter, x = 0;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        request-&gt;inputs[1].indexes.push_back(Index(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, t, x));</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a51bcc44735a1576f1c1adfe056652595"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51bcc44735a1576f1c1adfe056652595">&#9670;&nbsp;</a></span>CreateLoopedComputationRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CreateLoopedComputationRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>chunk_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_subsampling_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>ivector_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>left_context_begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>right_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_sequences</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request3</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function creates computation request suitable for giving to ComputeLooped(). </p>
<p>It's intended for use with a 'simple' nnet (one satisfying <a class="el" href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04" title="This function returns true if the nnet has the following properties: It has an output called &quot;output&quot;...">IsSimpleNnet()</a>), and this basically means that the inputs must be named "input" and possibly "ivector", and that there is an output named "output", and that those are the ones you care about (it won't generate any other outputs or use any other inputs).</p>
<p>If you want to use looped computation for different types of neural net, you should use the deeper interface, <a class="el" href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a" title="CompileLooped() provides an internal interface for &#39;looped&#39; computation. ">CompileLooped()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nnet</td><td>The neural net this computation request is to be used with. This is used to check whether the neural net accepts iVectors, and to work out the left-context and right-context required by the network. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">chunk_size</td><td>The number of frames of output that will be generated for each chunk (note: this is the shift in the t-index, which will not equal the number of output frames if frame_subsampling_factor != 1). Note: it is required that chunk_size be a multiple of ivector_period, frame_subsampling_factor, and nnet.Modulus(). You should use <a class="el" href="namespacekaldi_1_1nnet3.html#a50c94226ad499267fedd4630bd2b5516">GetChunkSize()</a> to compute the chunk size, giving it an advisory/ minimum chunksize, to make sure it satisfies these properties. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">frame_subsampling_factor</td><td>This will normally be 1, but may be more than 1 (e.g. 3) in chain systems; it determines the frame-skipping on the output, so we evaluate the output with 't' at multiples of this value. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ivector_period</td><td>The period with which iVectors are to be supplied to the network (if you're using iVectors). Not necessarily the same as the period with which the ivectors are extracted or stored on disk (&ndash;online-ivector-period). You will normally set this to the chunk size. It must divide the chunk size (if you're using iVectors) Note: you should call ModifyNnetIvectorPeriod on 'nnet' before calling this function; otherwise the neural net will most likely not actually be able to consume the iVector with this frequency. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">left_context_begin</td><td>This should be the left-context of the network plus any additional left-context (provided via the option &ndash;extra-left-context-begin) that should be supplied to the network on top of the minimum that the network requires. We call this left_context_begin because this only relates to the start of the utterance (t=0). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">right_context</td><td>This should be the right-context of the network, plus any additional right-context ("extra-right-context") that should be supplied to the network on top of the minimum that the network requires (currently extra-right-context != 0 is is not supported at the command-line level). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_sequences</td><td>The number of separate 'n' values to put in the computation; normally this will be just 1, but it can be increased to allow simultaneous operation on multiple streams of input. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">request1</td><td>The first of the 3 requests that this function generates, that the user should then supply to <a class="el" href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a" title="CompileLooped() provides an internal interface for &#39;looped&#39; computation. ">CompileLooped()</a>. Note: this will tend to be the largest computation request in terms of input, because we have to provide enough left and right context that it can evaluate the first chunk. Note: as elsewhere, the job of duplicating first and last frames enough to provide the required left/right context to the network, is left to the caller (at runtime, not during compilation). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">request2</td><td>The second of the 3 requests that this function generates. Caution: none of the inputs and outputs should overlap. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">request3</td><td>The third of the 3 requests that this function generates. It will be the same as request2, except for a time offset. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00164">164</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-looped_8cc_source.html#l00113">CreateComputationRequestInternal()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00669">Nnet::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-compile-looped_8cc_source.html#l00106">Mod()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00658">Nnet::Modulus()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00361">CreateLoopedComputationRequestSimple()</a>, and <a class="el" href="decodable-simple-looped_8cc_source.html#l00056">DecodableNnetSimpleLoopedInfo::Init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                                                  {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">bool</span> has_ivector = (nnet.InputDim(<span class="stringliteral">&quot;ivector&quot;</span>) &gt; 0);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(chunk_size % frame_subsampling_factor == 0 &amp;&amp;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;               chunk_size % nnet.Modulus() == 0 &amp;&amp;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;               chunk_size % ivector_period == 0);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(left_context_begin &gt;= 0 &amp;&amp; right_context &gt;= 0);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// note, &#39;end&#39; is one past the last one.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  int32 chunk1_input_begin_t = - left_context_begin,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      chunk1_input_end_t = chunk_size + right_context,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      chunk2_input_begin_t = chunk1_input_end_t,</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      chunk2_input_end_t = chunk2_input_begin_t + chunk_size,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      chunk3_input_begin_t = chunk2_input_end_t,</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      chunk3_input_end_t = chunk3_input_begin_t + chunk_size;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// work out the times at which i-vectors are required.</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  std::set&lt;int32&gt; ivector_times1, ivector_times2, ivector_times3;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">if</span> (has_ivector) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">for</span> (int32 t = chunk1_input_begin_t; t &lt; chunk1_input_end_t; t++) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      int32 ivector_t = t - <a class="code" href="namespacekaldi_1_1nnet3.html#a06e0193dd98dcb1fcebf89a9dd483df6">Mod</a>(t, ivector_period);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      ivector_times1.insert(ivector_t);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">for</span> (int32 t = chunk2_input_begin_t; t &lt; chunk2_input_end_t; t++) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      int32 ivector_t = t - <a class="code" href="namespacekaldi_1_1nnet3.html#a06e0193dd98dcb1fcebf89a9dd483df6">Mod</a>(t, ivector_period);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">if</span> (ivector_times2.count(ivector_t) == 0 &amp;&amp;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          ivector_times1.count(ivector_t) == 0)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        ivector_times2.insert(ivector_t);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">for</span> (int32 t = chunk3_input_begin_t; t &lt; chunk3_input_end_t; t++) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      int32 ivector_t = t - <a class="code" href="namespacekaldi_1_1nnet3.html#a06e0193dd98dcb1fcebf89a9dd483df6">Mod</a>(t, ivector_period);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">if</span> (ivector_times3.count(ivector_t) == 0 &amp;&amp;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;          ivector_times2.count(ivector_t) == 0 &amp;&amp;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          ivector_times1.count(ivector_t) == 0)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        ivector_times3.insert(ivector_t);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a1e904151f4a628424a90335e58c9dbe0">CreateComputationRequestInternal</a>(</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      chunk1_input_begin_t, chunk1_input_end_t,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      0, chunk_size,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      num_sequences, frame_subsampling_factor,</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      ivector_times1,</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      request1);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a1e904151f4a628424a90335e58c9dbe0">CreateComputationRequestInternal</a>(</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      chunk2_input_begin_t, chunk2_input_end_t,</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      chunk_size, chunk_size * 2,</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      num_sequences, frame_subsampling_factor,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      ivector_times2,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      request2);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a1e904151f4a628424a90335e58c9dbe0">CreateComputationRequestInternal</a>(</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      chunk3_input_begin_t, chunk3_input_end_t,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      chunk_size * 2, chunk_size * 3,</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      num_sequences, frame_subsampling_factor,</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      ivector_times3,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      request3);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a1e904151f4a628424a90335e58c9dbe0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1e904151f4a628424a90335e58c9dbe0">kaldi::nnet3::CreateComputationRequestInternal</a></div><div class="ttdeci">static void CreateComputationRequestInternal(int32 begin_input_t, int32 end_input_t, int32 begin_output_t, int32 end_output_t, int32 num_sequences, int32 frame_subsampling_factor, const std::set&lt; int32 &gt; &amp;ivector_times, ComputationRequest *request)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00113">nnet-compile-looped.cc:113</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a06e0193dd98dcb1fcebf89a9dd483df6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a06e0193dd98dcb1fcebf89a9dd483df6">kaldi::nnet3::Mod</a></div><div class="ttdeci">I Mod(I m, I n)</div><div class="ttdoc">Mod(m, n), defined for integers m and n where n &gt; 0, returns the modulus m % n, defined as the intege...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00106">nnet-compile-looped.cc:106</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae9f1d373569ff5f67ec7bbffb7c9cf5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9f1d373569ff5f67ec7bbffb7c9cf5f">&#9670;&nbsp;</a></span>CreateLoopedComputationRequestSimple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CreateLoopedComputationRequestSimple </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>chunk_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_subsampling_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>ivector_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>extra_left_context_begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>extra_right_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_sequences</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request3</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is deprecated. </p>
<p>It has the same interface as <a class="el" href="namespacekaldi_1_1nnet3.html#a51bcc44735a1576f1c1adfe056652595" title="This function creates computation request suitable for giving to ComputeLooped(). ...">CreateLoopedComputationRequest()</a>, except that the left and right context are specified in a different way (as just the 'extra' part). It is deprecated because this function has to work out the left and right context of the network, which turns out to be quite slow if it's done after you call <a class="el" href="namespacekaldi_1_1nnet3.html#a944dbd968a2a1a9e8998083101702b79" title="This function modifies the descriptors in the neural network to change the periodicity with which it ...">ModifyNnetIvectorPeriod()</a>. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00361">361</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00146">ComputeSimpleNnetContext()</a>, and <a class="el" href="nnet-compile-looped_8cc_source.html#l00164">CreateLoopedComputationRequest()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-test_8cc_source.html#l00120">UnitTestNnetCompileLooped()</a>.</p>
<div class="fragment"><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                                                        {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  int32 left_context, right_context;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">ComputeSimpleNnetContext</a>(nnet, &amp;left_context, &amp;right_context);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a51bcc44735a1576f1c1adfe056652595">CreateLoopedComputationRequest</a>(nnet, chunk_size, frame_subsampling_factor,</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                 ivector_period,</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                 extra_left_context_begin + left_context,</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                 extra_right_context + right_context,</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                 num_sequences, request1, request2, request3);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a51bcc44735a1576f1c1adfe056652595"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a51bcc44735a1576f1c1adfe056652595">kaldi::nnet3::CreateLoopedComputationRequest</a></div><div class="ttdeci">void CreateLoopedComputationRequest(const Nnet &amp;nnet, int32 chunk_size, int32 frame_subsampling_factor, int32 ivector_period, int32 left_context_begin, int32 right_context, int32 num_sequences, ComputationRequest *request1, ComputationRequest *request2, ComputationRequest *request3)</div><div class="ttdoc">This function creates computation request suitable for giving to ComputeLooped(). ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00164">nnet-compile-looped.cc:164</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a88aa85d232ba1ad6e430f6f6dcda29c1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">kaldi::nnet3::ComputeSimpleNnetContext</a></div><div class="ttdeci">void ComputeSimpleNnetContext(const Nnet &amp;nnet, int32 *left_context, int32 *right_context)</div><div class="ttdoc">ComputeSimpleNnetContext computes the left-context and right-context of a nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00146">nnet-utils.cc:146</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac6b64008b19bbb6e8769769cbf96fa68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6b64008b19bbb6e8769769cbf96fa68">&#9670;&nbsp;</a></span>DescriptorTokenize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> DescriptorTokenize </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>tokens</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function tokenizes input when parsing <a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> configuration values. </p>
<p>A token in this context is not the same as a generic Kaldi token, e.g. as defined in <a class="el" href="namespacekaldi.html#a30db4b2b32d39051a72d3eec42e819a8" title="Returns true if &quot;token&quot; is nonempty, and all characters are printable and whitespace-free. ">IsToken()</a> in util/text_utils.h, which just means a non-empty whitespace-free string. Here a token is more like a programming-language token, and currently the following are allowed as tokens: "(" ")" ","</p><ul>
<li>A nonempty string beginning with A-Za-z_, and containing only -_A-Za-z0-9.</li>
<li>An integer, optionally beginning with - or + and then a nonempty sequence of 0-9.</li>
</ul>
<p>This function should return false and print an informative error with local context if it can't tokenize the input. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00377">377</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="text-utils_8cc_source.html#l00238">kaldi::ConvertStringToReal()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00451">ErrorContext()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00425">IsValidName()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00180">NormalizeTextDescriptor()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00286">Nnet::ProcessComponentNodeConfigLine()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00368">Nnet::ProcessOutputNodeConfigLine()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00881">Nnet::RemoveSomeNodes()</a>, <a class="el" href="nnet-utils_8cc_source.html#l01478">ModelCollapser::ReplaceNodeInDescriptor()</a>, <a class="el" href="nnet-descriptor-test_8cc_source.html#l00089">UnitTestDescriptorIo()</a>, <a class="el" href="nnet-parse-test_8cc_source.html#l00214">UnitTestDescriptorTokenize()</a>, and <a class="el" href="nnet-descriptor-test_8cc_source.html#l00135">UnitTestGeneralDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                                      {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tokens != NULL);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordtype">size_t</span> start = input.find_first_not_of(<span class="stringliteral">&quot; \t&quot;</span>), size = input.size();</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  tokens-&gt;clear();</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">while</span> (start &lt; size) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!isspace(input[start]));</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (input[start] == <span class="charliteral">&#39;(&#39;</span> || input[start] == <span class="charliteral">&#39;)&#39;</span> || input[start] == <span class="charliteral">&#39;,&#39;</span>) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      tokens-&gt;push_back(std::string(input, start, 1));</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      start = input.find_first_not_of(<span class="stringliteral">&quot; \t&quot;</span>, start + 1);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordtype">size_t</span> found = input.find_first_of(<span class="stringliteral">&quot; \t(),&quot;</span>, start);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(found != start);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">if</span> (found == std::string::npos) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        std::string str(input, start, input.size() - start);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tmp;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a30e2d3a7507084b838f420b5e10b37f9">IsValidName</a>(str) &amp;&amp; !<a class="code" href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">ConvertStringToReal</a>(str, &amp;tmp)) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Could not tokenize line &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a2904394bf025a2757bd2ab32f2caea36">ErrorContext</a>(std::string(input, start));</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        tokens-&gt;push_back(str);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">if</span> (input[found] == <span class="charliteral">&#39;(&#39;</span> || input[found] == <span class="charliteral">&#39;)&#39;</span> || input[found] == <span class="charliteral">&#39;,&#39;</span>) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          std::string str(input, start, found - start);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tmp;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a30e2d3a7507084b838f420b5e10b37f9">IsValidName</a>(str) &amp;&amp; !<a class="code" href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">ConvertStringToReal</a>(str, &amp;tmp)) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Could not tokenize line &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a2904394bf025a2757bd2ab32f2caea36">ErrorContext</a>(std::string(input, start));</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          }</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          tokens-&gt;push_back(str);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          start = found;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          std::string str(input, start, found - start);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tmp;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a30e2d3a7507084b838f420b5e10b37f9">IsValidName</a>(str) &amp;&amp; !<a class="code" href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">ConvertStringToReal</a>(str, &amp;tmp)) {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Could not tokenize line &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a2904394bf025a2757bd2ab32f2caea36">ErrorContext</a>(std::string(input, start));</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          tokens-&gt;push_back(str);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;          start = input.find_first_not_of(<span class="stringliteral">&quot; \t&quot;</span>, found);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2904394bf025a2757bd2ab32f2caea36"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2904394bf025a2757bd2ab32f2caea36">kaldi::nnet3::ErrorContext</a></div><div class="ttdeci">std::string ErrorContext(const std::string &amp;str)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00461">nnet-parse.cc:461</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa624cc5f189fcc01469558a0865c1f3c"><div class="ttname"><a href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">kaldi::ConvertStringToReal</a></div><div class="ttdeci">bool ConvertStringToReal(const std::string &amp;str, T *out)</div><div class="ttdoc">ConvertStringToReal converts a string into either float or double and returns false if there was any ...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00238">text-utils.cc:238</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a30e2d3a7507084b838f420b5e10b37f9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a30e2d3a7507084b838f420b5e10b37f9">kaldi::nnet3::IsValidName</a></div><div class="ttdeci">bool IsValidName(const std::string &amp;name)</div><div class="ttdoc">Returns true if &amp;#39;name&amp;#39; would be a valid name for a component or node in a Nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00425">nnet-parse.cc:425</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4dc8f245e845514d33d24ecf1a054406"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dc8f245e845514d33d24ecf1a054406">&#9670;&nbsp;</a></span>DotProduct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> DotProduct </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns dot product between two networks of the same structure (calls the DotProduct functions of the Updatable components and sums up the return values). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00250">250</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8h_source.html#l00879">AffineComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01189">BlockAffineComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01744">Convolutional1dComponent::BackpropNeedsOutput()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01892">ScaleAndOffsetComponent::Copy()</a>, <a class="el" href="nnet-general-component_8h_source.html#l00666">ConstantComponent::IsComputable()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00952">LinearComponent::LinearComponent()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00418">AffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00515">BlockAffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00581">RepeatedAffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01523">PerElementScaleComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01625">PerElementOffsetComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01695">ConstantFunctionComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02050">ConvolutionComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02254">LstmNonlinearityComponent::Properties()</a>, <a class="el" href="nnet-discriminative-training_8cc_source.html#l00063">NnetDiscriminativeTrainer::Train()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02506">CompositeComponent::Type()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>, and <a class="el" href="_2nnet-component_8h_source.html#l00299">UpdatableComponent::~UpdatableComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                        {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nnet1.NumComponents() == nnet2.NumComponents());</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ans = 0.0;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet1.NumComponents(); c++) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keyword">const</span> Component *comp1 = nnet1.GetComponent(c),</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    *comp2 = nnet2.GetComponent(c);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (comp1-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keyword">const</span> UpdatableComponent</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          *u_comp1 = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(comp1),</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          *u_comp2 = dynamic_cast&lt;const UpdatableComponent*&gt;(comp2);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(u_comp1 != NULL &amp;&amp; u_comp2 != NULL);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      ans += u_comp1-&gt;DotProduct(*u_comp2);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a84ff5e289907fa63155ee9bec0f9c631"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84ff5e289907fa63155ee9bec0f9c631">&#9670;&nbsp;</a></span>EnsureContiguousProperty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnsureContiguousProperty </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>indexes_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes a vector of indexes and splits it up into as separate vectors of the same size, as needed to ensure that the 'contiguous property' holds. </p>
<p>This is done via padding with -1's. An example will clarify this. Suppose the input is: [ -1 1 1 1 2 2 1 1 ] which lacks the contiguous property because 1's appear in 2 different places, it would split it up as [ -1 1 1 1 2 2 -1 -1 ] [ -1 -1 -1 -1 -1 -1 1 1 ] If 'indexes' is empty or only contains -1's, 'indexes_out' will be empty. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00401">401</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00498">SplitLocationsBackward()</a>, and <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00222">UnitTestEnsureContiguousProperty()</a>.</p>
<div class="fragment"><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                               {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  indexes_out-&gt;clear();</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  indexes_out-&gt;reserve(3);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">if</span> (indexes.empty()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  int32 max_value = *std::max_element(indexes.begin(), indexes.end());</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (max_value == -1) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  std::vector&lt;int32&gt; num_segments_seen(max_value + 1, 0);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  int32 dim = indexes.size(), num_output_vectors = 0;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim;) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// note, we increment i within the loop.</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> (indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    int32 value = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], start_index = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">for</span> (; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim &amp;&amp; indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] == value; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    int32 end_index = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;  <span class="comment">// one past the end.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// the input &#39;indexes&#39; contains a sequence of possibly-repeated instances of</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// the value &#39;value&#39;, starting at index &#39;start_index&#39;, with &#39;end_index&#39; as</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// one past the end.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    int32 this_num_segments_seen = num_segments_seen[value]++;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">if</span> (this_num_segments_seen &gt;= num_output_vectors) {  <span class="comment">// we have nowhere to</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                                         <span class="comment">// put it.</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      indexes_out-&gt;resize(++num_output_vectors);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      indexes_out-&gt;back().resize(dim, -1);  <span class="comment">// fill newly added vector with -1&#39;s.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    std::vector&lt;int32&gt; &amp;this_out_vec((*indexes_out)[this_num_segments_seen]);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    std::vector&lt;int32&gt;::iterator iter = this_out_vec.begin() + start_index,</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        end = this_out_vec.begin() + end_index;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// Fill the appropriate range of the output vector with &#39;value&#39;</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) *iter = value;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4c1330ecd1ee31afb2214977a2a88e10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c1330ecd1ee31afb2214977a2a88e10">&#9670;&nbsp;</a></span>ErrorContext() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string ErrorContext </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a string used in error messages. </p>
<p>Here, "is" will be from an istringstream derived from a single line or part of a line. If "is" is at EOF or in error state, this should just say "end of line", else if the contents of "is" before EOF is &lt;20 characters it should return it all, else it should return the first 20 characters followed by "...". </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00451">451</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse_8cc_source.html#l00377">DescriptorTokenize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                       {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span> (!is.good()) <span class="keywordflow">return</span> <span class="stringliteral">&quot;end of line&quot;</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordtype">char</span> buf[21];</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  is.read(buf, 21);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordflow">if</span> (is) {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">return</span> (std::string(buf, 20) + <span class="stringliteral">&quot;...&quot;</span>);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">return</span> std::string(buf, is.gcount());</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a2904394bf025a2757bd2ab32f2caea36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2904394bf025a2757bd2ab32f2caea36">&#9670;&nbsp;</a></span>ErrorContext() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string ErrorContext </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>str</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00461">461</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                             {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">if</span> (str.size() == 0) <span class="keywordflow">return</span> <span class="stringliteral">&quot;end of line&quot;</span>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordflow">if</span> (str.size() &lt;= 20) <span class="keywordflow">return</span> str;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">return</span> std::string(str, 0, 20) + <span class="stringliteral">&quot;...&quot;</span>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a5683058729bb42a5e8462f9912484050"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5683058729bb42a5e8462f9912484050">&#9670;&nbsp;</a></span>EvaluateComputationRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EvaluateComputationRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt; &gt; *&#160;</td>
          <td class="paramname"><em>is_computable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given an nnet and a computation request, this function works out which requested outputs in the computation request are computable; it outputs this information as a vector "is_computable" indexed by the same indexes as request.outputs. </p>
<p>It does this by executing some of the early stages of compilation. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00071">71</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation-graph_8cc_source.html#l00462">ComputationGraphBuilder::Compute()</a>, <a class="el" href="nnet-computation-graph_8cc_source.html#l00801">ComputationGraphBuilder::GetComputableInfo()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00063">Nnet::GetNodeNames()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, and <a class="el" href="nnet-computation-graph_8cc_source.html#l00175">ComputationGraph::Print()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l00092">ComputeSimpleNnetContextForShift()</a>.</p>
<div class="fragment"><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                                                {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  ComputationGraph graph;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  ComputationGraphBuilder builder(nnet, &amp;graph);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  builder.Compute(request);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  builder.GetComputableInfo(is_computable);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    std::ostringstream graph_pretty;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    graph.Print(graph_pretty, nnet.GetNodeNames());</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(4) &lt;&lt; <span class="stringliteral">&quot;Graph is &quot;</span> &lt;&lt; graph_pretty.str();</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a54fa7479670b5b34951fdacd2c9b1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a54fa7479670b5b34951fdacd2c9b1d">&#9670;&nbsp;</a></span>ExampleApproxEqual()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ExampleApproxEqual </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if the examples are approximately equal (only intended to be used in testing). </p>

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01869">1869</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00046">NnetIo::features</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00816">GeneralMatrix::GetMatrix()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, and <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8h_source.html#l00048">NnetGenerationOptions::NnetGenerationOptions()</a>, and <a class="el" href="nnet-example-test_8cc_source.html#l00035">UnitTestNnetExample()</a>.</p>
<div class="fragment"><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                                         {</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="keywordflow">if</span> (eg1.io.size() != eg2.io.size())</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg1.io.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    NnetIo io1 = eg1.io[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], io2 = eg2.io[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordflow">if</span> (io1.name != io2.name || io1.indexes != io2.indexes)</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    Matrix&lt;BaseFloat&gt; feat1, feat2;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    io1.features.GetMatrix(&amp;feat1);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    io2.features.GetMatrix(&amp;feat2);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(feat1, feat2, delta))</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;  }</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af8007bfceb176a3f8f7f3efb765c9062"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8007bfceb176a3f8f7f3efb765c9062">&#9670;&nbsp;</a></span>ExpandComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ExpandComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>misc_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>need_debug_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_n_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>expanded_computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is used in 'shortcut' compilation to expand a computation that has been compiled for exactly 2 'n' values, to one that is suitable for some num_n_values &gt; 2. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nnet</td><td>The neural network for which this computation is being built. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">misc_info</td><td>The same <a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> object that was present in the ComputationRequests that were originally used to generate the computation (required to generated the PrecomputedIndexes) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">computation</td><td>The computation that was compiled for exactly 2 'n' values (n=0 and n=1) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">need_debug_info</td><td>True if we want to retain the 'debug_info' in the output 'expanded_computation'. In any case, the 'debug_info' is required in the input computation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_n_values</td><td>The number of 'n' values we want in the output computation </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">expanded_computation</td><td>The expanded computation. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03804">3804</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l03573">ComputationExpander::Expand()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00808">CachingOptimizingCompiler::CompileViaShortcut()</a>.</p>
<div class="fragment"><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;                                                              {</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;  ComputationExpander expander(nnet, misc_info, computation,</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;                               need_debug_info, num_n_values,</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;                               expanded_computation);</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;  expander.Expand();</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ac9d34dcbb48b22bb0c34f699721b33bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9d34dcbb48b22bb0c34f699721b33bc">&#9670;&nbsp;</a></span>ExpectOneOrTwoTokens()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ExpectOneOrTwoTokens </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>token1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>token2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is like ExpectToken but for two tokens, and it will either accept token1 and then token2, or just token2. </p>
<p>This is useful in Read functions where the first token may already have been consumed. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00224">224</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-descriptor_8cc_source.html#l00045">ExpectToken()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="io-funcs_8cc_source.html#l00154">kaldi::ReadToken()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8cc_source.html#l00076">PnormComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00247">DistributeComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00095">DistributeComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00472">RestrictedAttentionComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00300">ElementwiseProductComponent::Read()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00660">RestrictedAttentionComponent::PrecomputedIndexes::Read()</a>, <a class="el" href="nnet-normalize-component_8cc_source.html#l00589">BatchNormComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00501">StatisticsExtractionComponent::Read()</a>, <a class="el" href="convolution_8cc_source.html#l00252">ConvolutionModel::Read()</a>, <a class="el" href="nnet-convolutional-component_8cc_source.html#l00659">TimeHeightConvolutionComponent::PrecomputedIndexes::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00271">StatisticsExtractionComponentPrecomputedIndexes::Read()</a>, <a class="el" href="convolution_8cc_source.html#l00315">ConvolutionComputation::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00600">StatisticsPoolingComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00540">StatisticsPoolingComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00891">BackpropTruncationComponent::Read()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00686">TdnnComponent::PrecomputedIndexes::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00962">BackpropTruncationComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00472">NonlinearComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01469">DropoutMaskComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01616">GeneralDropoutComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01775">GeneralDropoutComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03415">FixedAffineComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03491">SumGroupComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03703">FixedScaleComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03778">FixedBiasComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00484">NoOpComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05938">SumBlockComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00531">ClipGradientComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l04941">PermuteComponent::Read()</a>, and <a class="el" href="nnet-simple-component_8cc_source.html#l04816">MaxpoolingComponent::Read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                                   {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(token1 != token2);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  std::string temp;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="group__io__funcs__basic.html#gacbf9367cd910befefa0bc98055979bea">ReadToken</a>(is, binary, &amp;temp);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">if</span> (temp == token1) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">ExpectToken</a>(is, binary, token2);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span> (temp != token2) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expecting token &quot;</span> &lt;&lt; token1 &lt;&lt; <span class="stringliteral">&quot; or &quot;</span> &lt;&lt; token2</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span> &lt;&lt; temp;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div><div class="ttc" id="group__io__funcs__basic_html_gacbf9367cd910befefa0bc98055979bea"><div class="ttname"><a href="group__io__funcs__basic.html#gacbf9367cd910befefa0bc98055979bea">kaldi::ReadToken</a></div><div class="ttdeci">void ReadToken(std::istream &amp;is, bool binary, std::string *str)</div><div class="ttdoc">ReadToken gets the next token and puts it in str (exception on failure). </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00154">io-funcs.cc:154</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga4c7a80f758e878578e78b667f62463a5"><div class="ttname"><a href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">kaldi::ExpectToken</a></div><div class="ttdeci">void ExpectToken(std::istream &amp;is, bool binary, const char *token)</div><div class="ttdoc">ExpectToken tries to read in the given token, and throws an exception on failure. ...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00194">io-funcs.cc:194</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a41114607233f11aab89539abf08cf922"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41114607233f11aab89539abf08cf922">&#9670;&nbsp;</a></span>ExpectToken()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ExpectToken </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>what_we_are_parsing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string **&#160;</td>
          <td class="paramname"><em>next_token</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor_8cc_source.html#l00045">45</a> of file <a class="el" href="nnet-descriptor_8cc_source.html">nnet-descriptor.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="nnet-descriptor_8cc_source.html#l00029">ParsingContext()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse_8cc_source.html#l00224">ExpectOneOrTwoTokens()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00585">GeneralDescriptor::Parse()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00690">GeneralDescriptor::ParseConst()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00668">GeneralDescriptor::ParseFailover()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00661">GeneralDescriptor::ParseIfDefined()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00710">GeneralDescriptor::ParseOffset()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00736">GeneralDescriptor::ParseReplaceIndex()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00726">GeneralDescriptor::ParseRound()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00677">GeneralDescriptor::ParseScale()</a>, <a class="el" href="am-nnet-simple_8cc_source.html#l00047">AmNnetSimple::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00076">PnormComponent::Read()</a>, <a class="el" href="nnet-common_8cc_source.html#l00037">Index::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00247">DistributeComponent::Read()</a>, <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00038">NnetIo::Read()</a>, <a class="el" href="nnet-discriminative-example_8cc_source.html#l00045">NnetDiscriminativeSupervision::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l01006">IoSpecification::Read()</a>, <a class="el" href="nnet-normalize-component_8cc_source.html#l00057">NormalizeComponent::Read()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00045">NnetChainSupervision::Read()</a>, <a class="el" href="nnet-discriminative-example_8cc_source.html#l00150">NnetDiscriminativeExample::Read()</a>, <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00116">NnetExample::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00196">DropoutComponent::Read()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00157">NnetChainExample::Read()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00030">NnetOptimizeOptions::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00095">DistributeComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00472">RestrictedAttentionComponent::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l01034">ComputationRequest::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00300">ElementwiseProductComponent::Read()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00660">RestrictedAttentionComponent::PrecomputedIndexes::Read()</a>, <a class="el" href="nnet-normalize-component_8cc_source.html#l00589">BatchNormComponent::Read()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00586">Nnet::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00501">StatisticsExtractionComponent::Read()</a>, <a class="el" href="convolution_8cc_source.html#l00252">ConvolutionModel::Read()</a>, <a class="el" href="nnet-convolutional-component_8cc_source.html#l00451">TimeHeightConvolutionComponent::Read()</a>, <a class="el" href="nnet-convolutional-component_8cc_source.html#l00659">TimeHeightConvolutionComponent::PrecomputedIndexes::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00271">StatisticsExtractionComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00144">NnetComputation::MatrixInfo::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00181">NnetComputation::MatrixDebugInfo::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00203">NnetComputation::SubMatrixInfo::Read()</a>, <a class="el" href="convolution_8cc_source.html#l00315">ConvolutionComputation::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00236">NnetComputation::Command::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00600">StatisticsPoolingComponent::Read()</a>, <a class="el" href="convolution_8cc_source.html#l01656">ConvolutionComputationIo::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01280">AffineComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00540">StatisticsPoolingComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00732">NnetComputation::Read()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00407">TdnnComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00891">BackpropTruncationComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01887">BlockAffineComponent::Read()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00686">TdnnComponent::PrecomputedIndexes::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l00962">BackpropTruncationComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01521">RepeatedAffineComponent::Read()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00472">NonlinearComponent::Read()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l05018">ComputationCache::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01266">ConstantComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01469">DropoutMaskComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02771">NaturalGradientAffineComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01616">GeneralDropoutComponent::Read()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01775">GeneralDropoutComponentPrecomputedIndexes::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03054">LinearComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03415">FixedAffineComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03703">FixedScaleComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03778">FixedBiasComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00484">NoOpComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05938">SumBlockComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l00531">ClipGradientComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l04941">PermuteComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02066">PerElementScaleComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02258">PerElementOffsetComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02642">ConstantFunctionComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03785">NaturalGradientPerElementScaleComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02350">ScaleAndOffsetComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l04496">ConvolutionComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05564">LstmNonlinearityComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l04816">MaxpoolingComponent::Read()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05113">CompositeComponent::Read()</a>, <a class="el" href="nnet-common_8cc_source.html#l00309">ReadCindexVector()</a>, and <a class="el" href="nnet-common_8cc_source.html#l00143">ReadIndexVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                      {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (**next_token != token)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expected &#39;&quot;</span> &lt;&lt; token &lt;&lt; <span class="stringliteral">&quot;&#39; while parsing &quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;              &lt;&lt; what_we_are_parsing &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;              &lt;&lt; **next_token &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#aa3fbd67899f39d18e85c03f06e0c69bf">ParsingContext</a>(*next_token);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">else</span>  <span class="comment">// advance token pointer.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    (*next_token)++;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_aa3fbd67899f39d18e85c03f06e0c69bf"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa3fbd67899f39d18e85c03f06e0c69bf">kaldi::nnet3::ParsingContext</a></div><div class="ttdeci">static std::string ParsingContext(const std::string *token_ptr)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00029">nnet-descriptor.cc:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1adea5ddcf5f2d26ee01d796ec13510c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1adea5ddcf5f2d26ee01d796ec13510c">&#9670;&nbsp;</a></span>ExtendMatrices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ExtendMatrices </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is not really an optimization in itself but it can make things easier for class <a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html" title="This class is responsible for merging matrices, although you probably want to access it via the the f...">VariableMergingOptimizer</a> (usually called by its wrapper <a class="el" href="namespacekaldi_1_1nnet3.html#a7918fc2d6dfa22dbc84913c63be8771b" title="This wraps class VariableMergingOptimizer in a simplified interface. ">VariableMergingOptimization()</a>). </p>
<p>It looks for a case where most of a matrix (but not its final rows) are copied to some submatrix of another matrix, where the row-range of that submatrix extends to the last row of the other matrix; and it extends the other matrix with additional rows so that the entire source matrix can be copied to the destination. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l01270">1270</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l01174">MatrixExtender::ExtendMatrices()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                                  {</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  MatrixExtender ext(computation);</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  ext.ExtendMatrices();</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ac3395b82092a47a75b581f5f4a55a503"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3395b82092a47a75b581f5f4a55a503">&#9670;&nbsp;</a></span>ExtractGivenPairsFromSubmatLists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ExtractGivenPairsFromSubmatLists </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;::iterator &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_iterator_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sorted_submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>list_of_pairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00203">203</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00243">SplitLocationsUsingSubmatHistogram()</a>.</p>
<div class="fragment"><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                                      {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  list_of_pairs-&gt;reserve(sorted_submat_lists-&gt;size());</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; input_iterator_list.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (input_iterator_list[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != (*sorted_submat_lists)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].end()) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="comment">// there was an element with the submat_index in the current list</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      list_of_pairs-&gt;push_back(*input_iterator_list[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      (*sorted_submat_lists)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].erase(input_iterator_list[i]);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    } <span class="keywordflow">else</span>  {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="comment">// insert a dummy element. Callers of this function expect the dummy</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="comment">// element to be (-1, -1)</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      list_of_pairs-&gt;push_back(std::make_pair(-1, -1));</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a078fe7414bf11ee4f33567cb85b2b202"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a078fe7414bf11ee4f33567cb85b2b202">&#9670;&nbsp;</a></span>ExtractLastPairFromSubmatLists()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ExtractLastPairFromSubmatLists </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sorted_submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>list_of_pairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00224">224</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00243">SplitLocationsUsingSubmatHistogram()</a>.</p>
<div class="fragment"><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                                      {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  list_of_pairs-&gt;reserve(sorted_submat_lists-&gt;size());</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sorted_submat_lists-&gt;size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span> ((*sorted_submat_lists)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size() == 0)  {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="comment">// the value of the dummy has to be (-1, -1) as down stream code has</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="comment">// expects -1 values for dummies</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      list_of_pairs-&gt;push_back(std::make_pair(-1, -1));</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    list_of_pairs-&gt;push_back((*sorted_submat_lists)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].back());</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    (*sorted_submat_lists)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].pop_back();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1cf8122407d1c438a044739d389a64ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cf8122407d1c438a044739d389a64ae">&#9670;&nbsp;</a></span>ExtrapolateComputationRequest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::ExtrapolateComputationRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request3</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00251">251</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-looped_8cc_source.html#l00235">AddTimeOffsetToComputationRequest()</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00284">CompileLoopedInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                  {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// accepts two computation requests &#39;request1&#39; and &#39;request2&#39; that</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">// must be identical except for a time offset, and creates &#39;request3&#39;</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">// that is the extrapolation of the next term in sequence.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  *request3 = request2;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!request1.inputs.empty() &amp;&amp; !request1.inputs[0].indexes.empty() &amp;&amp;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;               !request2.inputs.empty() &amp;&amp; !request2.inputs[0].indexes.empty());</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  int32 t_offset = request2.inputs[0].indexes[0].t -</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      request1.inputs[0].indexes[0].t;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// the following is just to make sure that the inputs are structurally</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// equivalent.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aef1d1a23b16cf461b7e7e049ae0be89b">AddTimeOffsetToComputationRequest</a>(-t_offset, request3);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">if</span> (!(*request3 == request1))</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// there is somse structural difference, or</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                   <span class="comment">// the time offset is not consistent.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// the following reverses the last call to AddTimeOffsetToComputationRequest,</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// then adds the offset we want.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aef1d1a23b16cf461b7e7e049ae0be89b">AddTimeOffsetToComputationRequest</a>(2 * t_offset, request3);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aef1d1a23b16cf461b7e7e049ae0be89b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aef1d1a23b16cf461b7e7e049ae0be89b">kaldi::nnet3::AddTimeOffsetToComputationRequest</a></div><div class="ttdeci">void AddTimeOffsetToComputationRequest(int32 t_offset, ComputationRequest *request)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00235">nnet-compile-looped.cc:235</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae235076d32848d3ce99ecd4a763e0961"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae235076d32848d3ce99ecd4a763e0961">&#9670;&nbsp;</a></span>FilterExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::FilterExample </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>min_input_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>max_input_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>min_output_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>max_output_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function filters the indexes (and associated feature rows) in a <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a>, removing any index/row in an <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> named "input" with t &lt; min_input_t or t &gt; max_input_t and any index/row in an <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> named "output" with t &lt; min_output_t or t &gt; max_output_t. </p>
<p>Will crash if filtering removes all Indexes of "input" or "output". </p>

<p class="definition">Definition at line <a class="el" href="nnet3-copy-egs_8cc_source.html#l00145">145</a> of file <a class="el" href="nnet3-copy-egs_8cc_source.html">nnet3-copy-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8h_source.html#l00046">NnetIo::features</a>, <a class="el" href="sparse-matrix_8cc_source.html#l01100">kaldi::FilterGeneralMatrixRows()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>, and <a class="el" href="sparse-matrix_8cc_source.html#l00781">GeneralMatrix::NumRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-copy-egs_8cc_source.html#l00222">SelectFromExample()</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                        {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  eg_out-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.clear();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  eg_out-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.resize(eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.size());</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">bool</span> is_input_or_output;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    int32 min_t, max_t;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> &amp;io_in = eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> &amp;io_out = eg_out-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keyword">const</span> std::string &amp;name = io_in.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">name</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    io_out.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">name</a> = name;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;input&quot;</span>) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      min_t = min_input_t;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      max_t = max_input_t;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      is_input_or_output = <span class="keyword">true</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;output&quot;</span>) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      min_t = min_output_t;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      max_t = max_output_t;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      is_input_or_output = <span class="keyword">true</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      is_input_or_output = <span class="keyword">false</span>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (!is_input_or_output) {  <span class="comment">// Just copy everything.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      io_out.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a> = io_in.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      io_out.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a> = io_in.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;indexes_in = io_in.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      std::vector&lt;Index&gt; &amp;indexes_out = io_out.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      indexes_out.reserve(indexes_in.size());</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      int32 num_indexes = indexes_in.size(), num_kept = 0;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io_in.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a>.<a class="code" href="classkaldi_1_1GeneralMatrix.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() == num_indexes);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      std::vector&lt;bool&gt; keep(num_indexes, <span class="keyword">false</span>);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      std::vector&lt;Index&gt;::const_iterator iter_in = indexes_in.begin(),</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                          end_in = indexes_in.end();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      std::vector&lt;bool&gt;::iterator iter_out = keep.begin();</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">for</span> (; iter_in != end_in; ++iter_in,++iter_out) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        int32 t = iter_in-&gt;t;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordtype">bool</span> is_within_range = (t &gt;= min_t &amp;&amp; t &lt;= max_t);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        *iter_out = is_within_range;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (is_within_range) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          indexes_out.push_back(*iter_in);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          num_kept++;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter_out == keep.end());</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (num_kept == 0)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;FilterExample removed all indexes for &#39;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <a class="code" href="group__matrix__group.html#gad382f719d6c9fb0f63e78f686c8a04b8">FilterGeneralMatrixRows</a>(io_in.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a>, keep,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                              &amp;io_out.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io_out.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a>.<a class="code" href="classkaldi_1_1GeneralMatrix.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() == num_kept &amp;&amp;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                   indexes_out.size() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(num_kept));</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html">kaldi::nnet3::NnetIo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00033">nnet-example.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_a84345a57ee4e5dade232e7af464ea151"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">kaldi::nnet3::NnetIo::features</a></div><div class="ttdeci">GeneralMatrix features</div><div class="ttdoc">The features or labels. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00046">nnet-example.h:46</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_aa3daaa77b972f8dace077e94b418aab1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">kaldi::nnet3::NnetIo::indexes</a></div><div class="ttdeci">std::vector&lt; Index &gt; indexes</div><div class="ttdoc">&quot;indexes&quot; is a vector the same length as features.NumRows(), explaining the meaning of each row of th...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00042">nnet-example.h:42</a></div></div>
<div class="ttc" id="group__matrix__group_html_gad382f719d6c9fb0f63e78f686c8a04b8"><div class="ttname"><a href="group__matrix__group.html#gad382f719d6c9fb0f63e78f686c8a04b8">kaldi::FilterGeneralMatrixRows</a></div><div class="ttdeci">void FilterGeneralMatrixRows(const GeneralMatrix &amp;in, const std::vector&lt; bool &gt; &amp;keep_rows, GeneralMatrix *out)</div><div class="ttdoc">Outputs a GeneralMatrix containing only the rows r of &quot;in&quot; such that keep_rows[r] == true...</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l01100">sparse-matrix.cc:1100</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1GeneralMatrix_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1GeneralMatrix.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::GeneralMatrix::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l00781">sparse-matrix.cc:781</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">kaldi::nnet3::NnetIo::name</a></div><div class="ttdeci">std::string name</div><div class="ttdoc">the name of the input in the neural net; in simple setups it will just be &quot;input&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00036">nnet-example.h:36</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79122735e3f124a6865ff339f40ec191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79122735e3f124a6865ff339f40ec191">&#9670;&nbsp;</a></span>FindNStride() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::FindNStride </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>full_check</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02942">2942</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, and <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l03794">ComputationExpander::ExpandIndexes()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l03548">ComputationExpander::InitStrideInfo()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l03822">IoSpecificationIsDecomposable()</a>.</p>
<div class="fragment"><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                                          {</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;  <span class="comment">// First find candidate stride.  Later we&#39;ll check for consistency.</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;  int32 size = indexes.size();</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(size &gt; 0);</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;  int32 N = indexes[size-1].n + 1,</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        n_stride = -1;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;  <span class="keywordflow">if</span> (N &lt;= 1) {</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    <span class="comment">// we wouldn&#39;t be able to determine the stride if N &lt;= 1.</span></div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  }</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;  Index index(indexes[0]);</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <span class="keywordflow">if</span> (index.n != 0 || size % N != 0) {</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="comment">// for the n stride to be positive, we must start with an index with n == 0.</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    <span class="comment">// if indexes.size() is not divisible by N, we have no hope of finding the</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <span class="comment">// regular structure.</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  }</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;  index.n = 1;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="comment">// First check the two most common strides, which are 1</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;  <span class="comment">// and size / N.</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  <span class="keywordflow">if</span> (indexes[1] == index) {</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    n_stride = 1;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (indexes[size / N] == index) {</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    n_stride = size / N;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;    int32 stride;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;    <span class="comment">// try the other possible strides one by one (for subsampling</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <span class="comment">// layers of convnets, we might see strides of 2, for instance).</span></div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    <span class="keywordflow">for</span> (stride = 2; stride &lt; size / N; stride++) {</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      <span class="keywordflow">if</span> (size % stride == 0 &amp;&amp; indexes[stride] == index) {</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        n_stride = stride;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      }</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;    }</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    <span class="keywordflow">if</span> (n_stride == -1) {</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <span class="comment">// if we fell off the loop then we found no candidates, which is strange</span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;      <span class="comment">// and means we did not find the expected structure; we&#39;ll return 0 as we</span></div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      <span class="comment">// failed.</span></div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    }</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;  }</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  <span class="comment">// Now is the checking phase.</span></div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;  <span class="comment">// to understand block_size, see the comment above this functcion.</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;  int32 block_size = n_stride * N;</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;  std::vector&lt;int32&gt; indexes_to_check;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;  <span class="keywordflow">if</span> (full_check) {</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    indexes_to_check.resize(size);</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      indexes_to_check[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    int32 num_to_check = std::min&lt;int32&gt;(5, size);</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    indexes_to_check.resize(num_to_check);</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num_to_check; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      indexes_to_check[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, size - 1);</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;indexes_to_check);</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  }</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;int32&gt;::iterator iter = indexes_to_check.begin();</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;       iter != indexes_to_check.end(); ++iter) {</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = *iter;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    Index index = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = index.n;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordflow">if</span> (n &lt; N - 1) {</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;      index.n = n + 1;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      <span class="keywordflow">if</span> (i + n_stride &gt;= size || indexes[i + n_stride] != index)</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    }</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    <span class="keywordflow">if</span> (n == 0) {</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      <span class="keywordflow">if</span> (i / block_size != (i + n_stride * (N-1)) / block_size) {</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        <span class="comment">// this is a check that the input divides into blocks of size n_stride *</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        <span class="comment">// N and the N different versions of the same Index are always within a</span></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <span class="comment">// block (i.e. that the n stride never crosses over the block; having</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <span class="comment">// the same Index repeated within different blocks actually would not</span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;        <span class="comment">// matter).</span></div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      }</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// n &gt; 0</span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;      index.n = n - 1;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="keywordflow">if</span> (i - n_stride &lt; 0 || indexes[i - n_stride] != index)</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;    }</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;  }</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;  <span class="keywordflow">return</span> n_stride;</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af4426490c64581d8189bf8c671e5a893"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4426490c64581d8189bf8c671e5a893">&#9670;&nbsp;</a></span>FindNStride() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::FindNStride </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>cindexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>full_check</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03033">3033</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, and <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>.</p>
<div class="fragment"><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                                          {</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  int32 size = cindexes.size();</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(size &gt; 0);</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;  int32 N = cindexes[size-1].second.n + 1,</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      n_stride = 0;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;  <span class="keywordflow">if</span> (N &lt;= 1)</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> cindex(cindexes[0]);</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;  <span class="keywordflow">if</span> (cindex.second.n != 0 || size % N != 0)</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;  cindex.second.n = 1;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;  <span class="keywordflow">if</span> (cindexes[1] == cindex) {</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    n_stride = 1;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cindexes[size / N] == cindex) {</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    n_stride = size / N;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    int32 stride;</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    <span class="keywordflow">for</span> (stride = 2; stride &lt; size / N; stride++) {</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;      <span class="keywordflow">if</span> (size % stride == 0 &amp;&amp; cindexes[stride] == cindex) {</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        n_stride = stride;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;      }</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="keywordflow">if</span> (stride == size / N)</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  }</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;  int32 block_size = n_stride * N;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;  std::vector&lt;int32&gt; indexes_to_check;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;  <span class="keywordflow">if</span> (full_check) {</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    indexes_to_check.resize(size);</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      indexes_to_check[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    int32 num_to_check = std::min&lt;int32&gt;(5, size);</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    indexes_to_check.resize(num_to_check);</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num_to_check; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      indexes_to_check[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, size - 1);</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;indexes_to_check);</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  }</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;int32&gt;::iterator iter = indexes_to_check.begin();</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;       iter != indexes_to_check.end(); ++iter) {</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = *iter;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> cindex = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = cindex.second.n;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    <span class="keywordflow">if</span> (n &lt; N - 1) {</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      cindex.second.n = n + 1;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      <span class="keywordflow">if</span> (i + n_stride &gt;= size || cindexes[i + n_stride] != cindex)</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    }</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;    <span class="keywordflow">if</span> (n == 0) {</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;      <span class="keywordflow">if</span> (i / block_size != (i + n_stride * (N-1)) / block_size)</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      cindex.second.n = n - 1;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="keywordflow">if</span> (i - n_stride &lt; 0 || cindexes[i - n_stride] != cindex)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    }</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;  }</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;  <span class="keywordflow">return</span> n_stride;</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8344e7587df9247d6cc492874901d4d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">kaldi::nnet3::Cindex</a></div><div class="ttdeci">std::pair&lt; int32, Index &gt; Cindex</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00115">nnet-common.h:115</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abd9243d8740392f619af25f0653afa9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd9243d8740392f619af25f0653afa9e">&#9670;&nbsp;</a></span>FindNumLeadingAndTrailingIdenticals()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::FindNumLeadingAndTrailingIdenticals </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leading_identicals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_trailing_identicals</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02477">2477</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02507">SnipRangesRowOp()</a>.</p>
<div class="fragment"><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                                    {</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!vec.empty());</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  <span class="keyword">const</span> std::pair&lt;int32, int32&gt; *begin = &amp;(vec[0]), *ptr = begin,</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      *end = ptr + vec.size();</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;  <span class="keywordflow">while</span> (ptr != end &amp;&amp; ptr-&gt;first == ptr-&gt;second)</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    ptr++;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;  <span class="comment">// note regarding error message: we assume all pairs of identical numbers are</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  <span class="comment">// -1, due to the way this is called, but it only affects how we describe the</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;  <span class="comment">// error.</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ptr != end &amp;&amp; <span class="stringliteral">&quot;Vector consists entirely of -1&#39;s.&quot;</span>);</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  *num_leading_identicals = ptr - begin;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;  <span class="keyword">const</span> std::pair&lt;int32, int32&gt; *ptr2 = end - 1;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <span class="comment">// the following while loop should terminate before falling off the vector,</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;  <span class="comment">// because we&#39;ve established above (in the assertion) that the vector contains</span></div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  <span class="comment">// at least one nonnegative number.</span></div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  <span class="keywordflow">while</span> (ptr2-&gt;first == ptr2-&gt;second)</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    ptr2--;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ptr2 &gt;= begin);  <span class="comment">// would be code error.</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  *num_trailing_identicals = end - 1 - ptr2;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aba9b56c9f5c5545ab2ab957cec8c56cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba9b56c9f5c5545ab2ab957cec8c56cc">&#9670;&nbsp;</a></span>FindNumLeadingAndTrailingNegatives() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::FindNumLeadingAndTrailingNegatives </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leading_negatives</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_trailing_negatives</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02339">2339</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02434">SnipMultiRowOp()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l02364">SnipSingleRowOp()</a>.</p>
<div class="fragment"><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                                                                              {</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!vec.empty());</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <span class="keyword">const</span> int32 *begin = &amp;(vec[0]), *ptr = begin, *end = ptr + vec.size();</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  <span class="keywordflow">while</span> (ptr != end &amp;&amp; *ptr &lt; 0)</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    ptr++;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  <span class="comment">// note regarding error message: we assume all negative numbers are -1, due to</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;  <span class="comment">// the way this is called, but it only affects how we describe the error.</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ptr != end &amp;&amp; <span class="stringliteral">&quot;Vector consists entirely of -1&#39;s.&quot;</span>);</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  *num_leading_negatives = ptr - begin;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  <span class="keyword">const</span> int32 *ptr2 = end - 1;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="comment">// the following while loop should terminate before falling off the vector,</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="comment">// because we&#39;ve established above (in the assertion) that the vector contains</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="comment">// at least one nonnegative number.</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  <span class="keywordflow">while</span> (*ptr2 &lt; 0)</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    ptr2--;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ptr2 &gt;= begin);  <span class="comment">// or would be code error.</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  *num_trailing_negatives = end - 1 - ptr2;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abbf4a43da0663edcee53e2942e53ae2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbf4a43da0663edcee53e2942e53ae2e">&#9670;&nbsp;</a></span>FindNumLeadingAndTrailingNegatives() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::FindNumLeadingAndTrailingNegatives </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leading_negatives</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_trailing_negatives</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02406">2406</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                                   {</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!vec.empty());</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <span class="keyword">const</span> std::pair&lt;int32, int32&gt; *begin = &amp;(vec[0]), *ptr = begin,</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      *end = ptr + vec.size();</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  <span class="keywordflow">while</span> (ptr != end &amp;&amp; ptr-&gt;first &lt; 0)</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;    ptr++;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;  <span class="comment">// note regarding error message: we assume all negative numbers are -1, due to</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;  <span class="comment">// the way this is called, but it only affects how we describe the error.</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ptr != end &amp;&amp; <span class="stringliteral">&quot;Vector consists entirely of -1&#39;s.&quot;</span>);</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  *num_leading_negatives = ptr - begin;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <span class="keyword">const</span> std::pair&lt;int32, int32&gt; *ptr2 = end - 1;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  <span class="comment">// the following while loop should terminate before falling off the vector,</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;  <span class="comment">// because we&#39;ve established above (in the assertion) that the vector contains</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;  <span class="comment">// at least one nonnegative number.</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;  <span class="keywordflow">while</span> (ptr2-&gt;first &lt; 0)</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    ptr2--;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ptr2 &gt;= begin);  <span class="comment">// would be code error.</span></div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;  *num_trailing_negatives = end - 1 - ptr2;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aea1816d4314c548a5099cfa5a328ef63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea1816d4314c548a5099cfa5a328ef63">&#9670;&nbsp;</a></span>FindOrphanComponents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FindOrphanComponents </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>components</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function finds a list of components that are never used, and outputs the integer comopnent indexes (you can use these to index nnet.GetComponentNames() to get their names). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00582">582</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8h_source.html#l00087">NetworkNode::component_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00132">Nnet::IsComponentNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00126">Nnet::NumNodes()</a>, and <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-nnet_8cc_source.html#l00694">Nnet::Check()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00844">Nnet::RemoveOrphanComponents()</a>.</p>
<div class="fragment"><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                                                          {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  int32 num_components = nnet.NumComponents(), num_nodes = nnet.NumNodes();</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  std::vector&lt;bool&gt; is_used(num_components, <span class="keyword">false</span>);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_nodes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">if</span> (nnet.IsComponentNode(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>)) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      int32 c = nnet.GetNode(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>).u.component_index;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c &gt;= 0 &amp;&amp; c &lt; num_components);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      is_used[c] = <span class="keyword">true</span>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  components-&gt;clear();</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_components; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span> (!is_used[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      components-&gt;push_back(i);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa9a664caafab064813da57f956a55701"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9a664caafab064813da57f956a55701">&#9670;&nbsp;</a></span>FindOrphanNodes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FindOrphanNodes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>nodes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function finds a list of nodes that are never used to compute any output, and outputs the integer node indexes (you can use these to index nnet.GetNodeNames() to get their names). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00598">598</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph_8cc_source.html#l00063">ComputeGraphTranspose()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="nnet-graph_8cc_source.html#l00030">NnetToDirectedGraph()</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00126">Nnet::NumNodes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-nnet_8cc_source.html#l00694">Nnet::Check()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00932">Nnet::RemoveOrphanNodes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                                                {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; depend_on_graph, dependency_graph;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a679a6d66a5e4a3993124bc35597dd06b">NnetToDirectedGraph</a>(nnet, &amp;depend_on_graph);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="comment">// depend_on_graph[i] is a list of all the nodes that depend on i.</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ac4457943f315ab2e900b1f81606404f8">ComputeGraphTranspose</a>(depend_on_graph, &amp;dependency_graph);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="comment">// dependency_graph[i] is a list of all the nodes that i depends on,</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">// to be computed.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// Find all nodes required to produce the outputs.</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  int32 num_nodes = nnet.NumNodes();</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  assert(num_nodes == static_cast&lt;int32&gt;(dependency_graph.size()));</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  std::vector&lt;bool&gt; node_is_required(num_nodes, <span class="keyword">false</span>);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  std::vector&lt;int32&gt; queue;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_nodes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">if</span> (nnet.IsOutputNode(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      queue.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">while</span> (!queue.empty()) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = queue.back();</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    queue.pop_back();</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">if</span> (!node_is_required[i]) {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      node_is_required[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; dependency_graph[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        queue.push_back(dependency_graph[i][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  nodes-&gt;clear();</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0; i &lt; num_nodes; i++) {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">if</span> (!node_is_required[i])</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      nodes-&gt;push_back(i);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  }</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a679a6d66a5e4a3993124bc35597dd06b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a679a6d66a5e4a3993124bc35597dd06b">kaldi::nnet3::NnetToDirectedGraph</a></div><div class="ttdeci">void NnetToDirectedGraph(const Nnet &amp;nnet, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</div><div class="ttdoc">This function takes an nnet and turns it to a directed graph on nodes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00030">nnet-graph.cc:30</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac4457943f315ab2e900b1f81606404f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac4457943f315ab2e900b1f81606404f8">kaldi::nnet3::ComputeGraphTranspose</a></div><div class="ttdeci">void ComputeGraphTranspose(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph_transpose)</div><div class="ttdoc">Outputs a graph in which the order of arcs is reversed. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00063">nnet-graph.cc:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae72c79fbb6ec81b69aaee02701fa23e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae72c79fbb6ec81b69aaee02701fa23e5">&#9670;&nbsp;</a></span>FindSccs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FindSccs </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sccs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given a directed graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming from the current node), partition it into strongly connected components (i.e. </p>
<p>within each SCC, all nodes are reachable from all other nodes). Each element of 'sccs' is a list of node indexes that are in that scc. </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00156">156</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph_8cc_source.html#l00138">FindSccsTarjan()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00265">ComputeNnetComputationEpochs()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00300">GraphHasCycles()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00160">UnitTestFindSccs()</a>.</p>
<div class="fragment"><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                                                  {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// Internally we call Tarjan&#39;s SCC algorithm, as it only requires one DFS. We</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">// can change this to other methods later on if necessary.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sccs != NULL);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aee48ed6add62e6cef7918e3f6a94ffc7">FindSccsTarjan</a>(graph, sccs);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aee48ed6add62e6cef7918e3f6a94ffc7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aee48ed6add62e6cef7918e3f6a94ffc7">kaldi::nnet3::FindSccsTarjan</a></div><div class="ttdeci">void FindSccsTarjan(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00138">nnet-graph.cc:138</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aee48ed6add62e6cef7918e3f6a94ffc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee48ed6add62e6cef7918e3f6a94ffc7">&#9670;&nbsp;</a></span>FindSccsTarjan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::FindSccsTarjan </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sccs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00138">138</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph_8cc_source.html#l00079">TarjanNode::index</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="nnet-graph_8cc_source.html#l00085">TarjanSccRecursive()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00156">FindSccs()</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                                        {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sccs != NULL);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">// Initialization.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  std::vector&lt;TarjanNode&gt; tarjan_nodes(graph.size());</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  std::vector&lt;int32&gt; tarjan_stack;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  int32 global_index = 0;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// Calls the recursive function.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; graph.size(); ++<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> (tarjan_nodes[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>].index == -1) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a145f09473f55df6f338ac4d69cff8bf1">TarjanSccRecursive</a>(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, graph,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                         &amp;global_index, &amp;tarjan_nodes, &amp;tarjan_stack, sccs);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a145f09473f55df6f338ac4d69cff8bf1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a145f09473f55df6f338ac4d69cff8bf1">kaldi::nnet3::TarjanSccRecursive</a></div><div class="ttdeci">void TarjanSccRecursive(int32 node, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, int32 *global_index, std::vector&lt; TarjanNode &gt; *tarjan_nodes, std::vector&lt; int32 &gt; *tarjan_stack, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00085">nnet-graph.cc:85</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abff8a093b516f579b1bce94a954f6e7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abff8a093b516f579b1bce94a954f6e7c">&#9670;&nbsp;</a></span>FindSubmatIndexInSubmatLists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::FindSubmatIndexInSubmatLists </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>submat_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sorted_submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;::iterator &gt; *&#160;</td>
          <td class="paramname"><em>output_iterator_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>max_remaining_submat_list_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00167">167</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00243">SplitLocationsUsingSubmatHistogram()</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                           {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  output_iterator_list-&gt;reserve(sorted_submat_lists-&gt;size());</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  *max_remaining_submat_list_size = 0;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sorted_submat_lists-&gt;size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    std::vector&lt; std::pair&lt;int32, int32&gt; &gt; &amp; submat_list =</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        (*sorted_submat_lists)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    output_iterator_list-&gt;push_back(</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        std::find_if(submat_list.begin(), submat_list.end(),</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                     FirstElementIsEqualComparator(submat_index)));</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    int32 remaining_submat_list_size = submat_list.size();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span>  (output_iterator_list-&gt;back() != submat_list.end())  {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="comment">// since the submat_index is present in this submat_list</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="comment">// if submat_index was deleted from the list</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="comment">// the remaining submat_list&#39;s size is reduced by 1</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      remaining_submat_list_size--;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    *max_remaining_submat_list_size = remaining_submat_list_size</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                      &gt; *max_remaining_submat_list_size ? remaining_submat_list_size :</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                      *max_remaining_submat_list_size;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8953a6af8e449d7cc12efeb115c5f8d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8953a6af8e449d7cc12efeb115c5f8d2">&#9670;&nbsp;</a></span>FixGotoLabel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FixGotoLabel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function ensures that the arg1 of a final command of type kGotoLabel is the same as the command with type kNoOperationLabel. </p>
<p>This is necessary if you do any other type of optimization after '<a class="el" href="namespacekaldi_1_1nnet3.html#abb347167ff71d1cd8a2ab35b6eb2f636" title="This function tries to optimize computation &#39;computation&#39; for an &#39;looped&#39; computation. ">OptimizeLoopedComputation()</a>'. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04552">4552</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationLabel</a>, and <a class="el" href="nnet-computation_8h_source.html#l00294">kProvideOutput</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l04640">InsertCommands()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04473">ComputationLoopedOptimizer::Optimize()</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00355">RemoveUnnecessaryAllocation()</a>.</p>
<div class="fragment"><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;                                                {</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;  int32 num_commands = computation-&gt;commands.size();</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;  <span class="keywordflow">if</span> (num_commands == 0)</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;  <span class="keywordflow">for</span> (int32 c = num_commands - 1; c &gt;= 0; c--) {</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;    <span class="keywordflow">if</span> (computation-&gt;commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>) {</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;      int32 dest_command = computation-&gt;commands[c].arg1;</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      <span class="keywordflow">if</span> (static_cast&lt;size_t&gt;(dest_command) &lt;  computation-&gt;commands.size() &amp;&amp;</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;          computation-&gt;commands[dest_command].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>)</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;        <span class="keywordflow">return</span>;  <span class="comment">// nothing to fix.</span></div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> + 1 &lt; num_commands; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++) {</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;        <span class="keywordflow">if</span> (computation-&gt;commands[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>) {</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;          computation-&gt;commands[c].arg1 = <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;        }</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;      }</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Label not found.&quot;</span>;</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (computation-&gt;commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>) {</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;      <span class="comment">// sometimes kProvideOutput commands are temporarily ordered after</span></div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;      <span class="comment">// the kGotoLabel command, and we need to work in that case.</span></div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;      <span class="comment">// it loks like there is no &#39;goto&#39; command in this computation-</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;      <span class="comment">// if there were, it would be right at the end, possibly followed by</span></div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;      <span class="comment">// kProvideOutput commands.</span></div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;    }</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;  }</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kaldi::nnet3::kNoOperationLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa665cb6bf2afd82ee21658d7d5d9c410"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa665cb6bf2afd82ee21658d7d5d9c410">&#9670;&nbsp;</a></span>FreezeNaturalGradient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FreezeNaturalGradient </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>freeze</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Controls if natural gradient will be updated. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00423">423</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-component-itf_8h_source.html#l00502">UpdatableComponent::FreezeNaturalGradient()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8h_source.html#l00952">LinearComponent::LinearComponent()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00831">NaturalGradientAffineComponent::NaturalGradientAffineComponent()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02254">LstmNonlinearityComponent::Properties()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00062">NnetChainTrainer::Train()</a>, <a class="el" href="nnet-training_8cc_source.html#l00059">NnetTrainer::Train()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01774">NaturalGradientPerElementScaleComponent::Type()</a>, and <a class="el" href="nnet-simple-component_8h_source.html#l02506">CompositeComponent::Type()</a>.</p>
<div class="fragment"><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                                                    {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="comment">// For now all updatable components inherit from class UpdatableComponent.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="comment">// If that changes in future, we will change this code.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      UpdatableComponent *uc = <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">if</span> (uc == NULL)</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Updatable component does not inherit from class &quot;</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="stringliteral">&quot;UpdatableComponent; change this code.&quot;</span>;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      uc-&gt;FreezeNaturalGradient(freeze);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9a6ec6b257d100e7dab22ce3feac226f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a6ec6b257d100e7dab22ce3feac226f">&#9670;&nbsp;</a></span>GenerateConfigSequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GenerateConfigSequence </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a sequence of at least one config files, output as strings, where the first in the sequence is the initial nnet, and the remaining ones may do things like add layers. </p>

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01252">1252</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8h_source.html#l00034">NnetGenerationOptions::allow_context</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00035">NnetGenerationOptions::allow_nonlinearity</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00036">NnetGenerationOptions::allow_recursion</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00043">NnetGenerationOptions::allow_statistics_pooling</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00041">NnetGenerationOptions::allow_use_of_x_dim</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00913">GenerateConfigSequenceCnn()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00994">GenerateConfigSequenceCnnNew()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01213">GenerateConfigSequenceCompositeBlock()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01187">GenerateConfigSequenceDistribute()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00414">GenerateConfigSequenceLstm()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00580">GenerateConfigSequenceLstmWithTruncation()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01130">GenerateConfigSequenceRestrictedAttention()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00263">GenerateConfigSequenceRnn()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00322">GenerateConfigSequenceRnnClockwork()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00111">GenerateConfigSequenceSimple()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00054">GenerateConfigSequenceSimpleContext()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00033">GenerateConfigSequenceSimplest()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l00219">GenerateConfigSequenceStatistics()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8h_source.html#l00048">NnetGenerationOptions::NnetGenerationOptions()</a>, <a class="el" href="nnet-analyze-test_8cc_source.html#l00039">UnitTestNnetAnalyze()</a>, <a class="el" href="nnet-compile-test_8cc_source.html#l00029">UnitTestNnetCompile()</a>, <a class="el" href="nnet-compile-test_8cc_source.html#l00120">UnitTestNnetCompileLooped()</a>, <a class="el" href="nnet-compile-test_8cc_source.html#l00063">UnitTestNnetCompileMulti()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>, <a class="el" href="nnet-utils-test_8cc_source.html#l00029">UnitTestNnetContext()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00246">UnitTestNnetInputDerivatives()</a>, <a class="el" href="nnet3_2nnet-nnet-test_8cc_source.html#l00027">UnitTestNnetIo()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>, and <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">UnitTestNnetOptimizeWithOptions()</a>.</p>
<div class="fragment"><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                                   {</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;start:</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  int32 network_type = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 14);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordflow">switch</span>(network_type) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a3855432311c60a3aba3f3ef77871a9eb">GenerateConfigSequenceSimplest</a>(opts, configs);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_context)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a020e04f5594e00affc4c2bf231687e65">GenerateConfigSequenceSimpleContext</a>(opts, configs);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_context || !opts.allow_nonlinearity)</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a51af5c2c6da3b32c75666de9852dc74c">GenerateConfigSequenceSimple</a>(opts, configs);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_recursion || !opts.allow_context ||</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;          !opts.allow_nonlinearity)</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a380783b4b5f4a192930cb5e5b00d0143">GenerateConfigSequenceRnn</a>(opts, configs);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keywordflow">case</span> 4:</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_recursion || !opts.allow_context ||</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;          !opts.allow_nonlinearity)</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a410289847ba049a50141e38f95d4a3c5">GenerateConfigSequenceRnnClockwork</a>(opts, configs);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordflow">case</span> 5:</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_recursion || !opts.allow_context ||</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;          !opts.allow_nonlinearity)</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#aa50641f28c6aecba5e74d7604b4ef650">GenerateConfigSequenceLstm</a>(opts, configs);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">case</span> 6:</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_recursion || !opts.allow_context ||</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;          !opts.allow_nonlinearity)</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#aa50641f28c6aecba5e74d7604b4ef650">GenerateConfigSequenceLstm</a>(opts, configs);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordflow">case</span> 7:</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_nonlinearity)</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a44d5ec3eab77bbbf0f6a9140db62e0bd">GenerateConfigSequenceCnn</a>(opts, configs);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">case</span> 8:</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_use_of_x_dim)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a3855b8fdbe81b37928ccc530d22b91a3">GenerateConfigSequenceDistribute</a>(opts, configs);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keywordflow">case</span> 9:</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a3af6a7b7d8ad5235dfbccfd6ea387b1b">GenerateConfigSequenceCompositeBlock</a>(opts, configs);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">case</span> 10:</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_statistics_pooling)</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ab23082de0da09ca5e9e4384bc51eb940">GenerateConfigSequenceStatistics</a>(opts, configs);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">case</span> 11:</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_recursion || !opts.allow_context ||</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;          !opts.allow_nonlinearity)</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a70f72e5f56f05e3a1005e54b4aa92673">GenerateConfigSequenceLstmWithTruncation</a>(opts, configs);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="comment">// We&#39;re allocating more case statements to the most recently</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="comment">// added type of model, to give more thorough testing where</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      <span class="comment">// it&#39;s needed most.</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">case</span> 12:</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_nonlinearity || !opts.allow_context)</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ac2ae4db1fcbacfa2823a40e9cbe979f8">GenerateConfigSequenceCnnNew</a>(opts, configs);</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="keywordflow">case</span> 13: <span class="keywordflow">case</span> 14:</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <span class="keywordflow">if</span> (!opts.allow_nonlinearity || !opts.allow_context)</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#aa14a929fe7917b3ba3adf610aa27a643">GenerateConfigSequenceRestrictedAttention</a>(opts, configs);</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Error generating config sequence.&quot;</span>;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!configs-&gt;empty());</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_aa50641f28c6aecba5e74d7604b4ef650"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa50641f28c6aecba5e74d7604b4ef650">kaldi::nnet3::GenerateConfigSequenceLstm</a></div><div class="ttdeci">void GenerateConfigSequenceLstm(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00414">nnet-test-utils.cc:414</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a410289847ba049a50141e38f95d4a3c5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a410289847ba049a50141e38f95d4a3c5">kaldi::nnet3::GenerateConfigSequenceRnnClockwork</a></div><div class="ttdeci">void GenerateConfigSequenceRnnClockwork(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00322">nnet-test-utils.cc:322</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a70f72e5f56f05e3a1005e54b4aa92673"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a70f72e5f56f05e3a1005e54b4aa92673">kaldi::nnet3::GenerateConfigSequenceLstmWithTruncation</a></div><div class="ttdeci">void GenerateConfigSequenceLstmWithTruncation(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00580">nnet-test-utils.cc:580</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a020e04f5594e00affc4c2bf231687e65"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a020e04f5594e00affc4c2bf231687e65">kaldi::nnet3::GenerateConfigSequenceSimpleContext</a></div><div class="ttdeci">void GenerateConfigSequenceSimpleContext(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00054">nnet-test-utils.cc:54</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3855b8fdbe81b37928ccc530d22b91a3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3855b8fdbe81b37928ccc530d22b91a3">kaldi::nnet3::GenerateConfigSequenceDistribute</a></div><div class="ttdeci">void GenerateConfigSequenceDistribute(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01187">nnet-test-utils.cc:1187</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a380783b4b5f4a192930cb5e5b00d0143"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a380783b4b5f4a192930cb5e5b00d0143">kaldi::nnet3::GenerateConfigSequenceRnn</a></div><div class="ttdeci">void GenerateConfigSequenceRnn(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00263">nnet-test-utils.cc:263</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a44d5ec3eab77bbbf0f6a9140db62e0bd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a44d5ec3eab77bbbf0f6a9140db62e0bd">kaldi::nnet3::GenerateConfigSequenceCnn</a></div><div class="ttdeci">void GenerateConfigSequenceCnn(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00913">nnet-test-utils.cc:913</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac2ae4db1fcbacfa2823a40e9cbe979f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac2ae4db1fcbacfa2823a40e9cbe979f8">kaldi::nnet3::GenerateConfigSequenceCnnNew</a></div><div class="ttdeci">void GenerateConfigSequenceCnnNew(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00994">nnet-test-utils.cc:994</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab23082de0da09ca5e9e4384bc51eb940"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab23082de0da09ca5e9e4384bc51eb940">kaldi::nnet3::GenerateConfigSequenceStatistics</a></div><div class="ttdeci">void GenerateConfigSequenceStatistics(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00219">nnet-test-utils.cc:219</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3855432311c60a3aba3f3ef77871a9eb"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3855432311c60a3aba3f3ef77871a9eb">kaldi::nnet3::GenerateConfigSequenceSimplest</a></div><div class="ttdeci">void GenerateConfigSequenceSimplest(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00033">nnet-test-utils.cc:33</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa14a929fe7917b3ba3adf610aa27a643"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa14a929fe7917b3ba3adf610aa27a643">kaldi::nnet3::GenerateConfigSequenceRestrictedAttention</a></div><div class="ttdeci">void GenerateConfigSequenceRestrictedAttention(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01130">nnet-test-utils.cc:1130</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a51af5c2c6da3b32c75666de9852dc74c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a51af5c2c6da3b32c75666de9852dc74c">kaldi::nnet3::GenerateConfigSequenceSimple</a></div><div class="ttdeci">void GenerateConfigSequenceSimple(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l00111">nnet-test-utils.cc:111</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3af6a7b7d8ad5235dfbccfd6ea387b1b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3af6a7b7d8ad5235dfbccfd6ea387b1b">kaldi::nnet3::GenerateConfigSequenceCompositeBlock</a></div><div class="ttdeci">void GenerateConfigSequenceCompositeBlock(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generate a config string with a composite component composed only of block affine, repeated affine, and natural gradient repeated affine components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01213">nnet-test-utils.cc:1213</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a44d5ec3eab77bbbf0f6a9140db62e0bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44d5ec3eab77bbbf0f6a9140db62e0bd">&#9670;&nbsp;</a></span>GenerateConfigSequenceCnn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceCnn </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00913">913</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                   {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  int32 input_x_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        input_y_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        input_z_dim = 3 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        filt_x_dim = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % input_x_dim,</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        filt_y_dim = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % input_y_dim,</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        num_filters = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        filt_x_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % filt_x_dim),</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        filt_y_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % filt_y_dim);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  int32 remainder = (input_x_dim - filt_x_dim) % filt_x_step;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="comment">// adjusting input_x_dim to ensure divisibility</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  input_x_dim = input_x_dim - remainder;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  remainder = (input_y_dim - filt_y_dim) % filt_y_step;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="comment">// adjusting input_x_dim to ensure divisibility</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  input_y_dim = input_y_dim - remainder;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  int32 input_vectorization = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  std::string vectorization;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordflow">if</span> (input_vectorization == 0) {</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    vectorization = <span class="stringliteral">&quot;yzx&quot;</span>;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  } <span class="keywordflow">else</span>  {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    vectorization = <span class="stringliteral">&quot;zyx&quot;</span>;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=conv type=ConvolutionComponent &quot;</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-x-dim=&quot;</span> &lt;&lt; input_x_dim</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-y-dim=&quot;</span> &lt;&lt; input_y_dim</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-z-dim=&quot;</span> &lt;&lt; input_z_dim</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; filt-x-dim=&quot;</span> &lt;&lt; filt_x_dim</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; filt-y-dim=&quot;</span> &lt;&lt; filt_y_dim</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; filt-x-step=&quot;</span> &lt;&lt; filt_x_step</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; filt-y-step=&quot;</span> &lt;&lt; filt_y_step</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; num-filters=&quot;</span> &lt;&lt; num_filters</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-vectorization-order=&quot;</span> &lt;&lt; vectorization</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;     &lt;&lt; std::endl;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  int32 conv_output_x_dim = (1 + (input_x_dim - filt_x_dim) / filt_x_step);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  int32 conv_output_y_dim = (1 + (input_y_dim - filt_y_dim) / filt_y_step);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  int32 conv_output_z_dim = num_filters;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  int32 pool_x_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % conv_output_x_dim;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  int32 pool_y_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % conv_output_y_dim;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  int32 pool_z_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % conv_output_z_dim;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  int32 pool_x_step = 1;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  int32 pool_y_step = 1;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  int32 pool_z_step = 1;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    pool_x_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % pool_x_size);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  } <span class="keywordflow">while</span>((conv_output_x_dim - pool_x_size) % pool_x_step);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    pool_y_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % pool_y_size);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  } <span class="keywordflow">while</span>((conv_output_y_dim - pool_y_size) % pool_y_step);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    pool_z_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % pool_z_size);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  } <span class="keywordflow">while</span>((conv_output_z_dim - pool_z_size) % pool_z_step);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=maxpooling type=MaxpoolingComponent &quot;</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-x-dim=&quot;</span> &lt;&lt; conv_output_x_dim</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-y-dim=&quot;</span> &lt;&lt; conv_output_y_dim</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-z-dim=&quot;</span> &lt;&lt; conv_output_z_dim</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; pool-x-size=&quot;</span> &lt;&lt; pool_x_size</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; pool-y-size=&quot;</span> &lt;&lt; pool_y_size</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; pool-z-size=&quot;</span> &lt;&lt; pool_z_size</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; pool-x-step=&quot;</span> &lt;&lt; pool_x_step</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; pool-y-step=&quot;</span> &lt;&lt; pool_y_step</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; pool-z-step=&quot;</span> &lt;&lt; pool_z_step</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;     &lt;&lt; std::endl;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; (input_x_dim * input_y_dim * input_z_dim) &lt;&lt; std::endl;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=conv_node component=conv input=input\n&quot;</span>;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=maxpooling_node component=maxpooling input=conv_node\n&quot;</span>;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=conv_node\n&quot;</span>;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac2ae4db1fcbacfa2823a40e9cbe979f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2ae4db1fcbacfa2823a40e9cbe979f8">&#9670;&nbsp;</a></span>GenerateConfigSequenceCnnNew()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceCnnNew </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00994">994</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                                   {</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  std::ostringstream ss;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  int32 cur_height = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(5, 15),</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      cur_num_filt = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      num_layers = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="comment">// note: generating zero layers is a bit odd but it exercises some code that</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">// we otherwise wouldn&#39;t exercise.</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  std::string cur_layer_descriptor = <span class="stringliteral">&quot;input&quot;</span>;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  { <span class="comment">// input layer.</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; (cur_height * cur_num_filt)</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;       &lt;&lt; std::endl;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  }</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordflow">for</span> (int32 l = 0; l &lt; num_layers; l++) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    int32 next_num_filt = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordtype">bool</span> height_padding = (cur_height &lt; 5 || <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    int32 height_subsampling_factor = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 2);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">if</span> (cur_height &lt; 4) {</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="comment">// output height of 1 causes a problem with unused height-offsets,</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">// so don&#39;t subsample in that case.</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      height_subsampling_factor = 1;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    int32 next_height = cur_height;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">if</span> (!height_padding) {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      next_height -= 2;  <span class="comment">// the kernel will have height 3.</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    next_height = (next_height + height_subsampling_factor - 1) /</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        height_subsampling_factor;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">if</span> (next_height == cur_height &amp;&amp; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="comment">// ensure that with sufficient frequency, we have the</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="comment">// same height and num-filt out; this enables ResNet-style</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="comment">// addition.</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      next_num_filt = cur_num_filt;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    std::string time_offsets, required_time_offsets;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      time_offsets = <span class="stringliteral">&quot;0&quot;</span>;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      required_time_offsets = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      time_offsets = <span class="stringliteral">&quot;-1,0,1&quot;</span>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      required_time_offsets = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;-1&quot;</span>);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      time_offsets = <span class="stringliteral">&quot;-2,0,2&quot;</span>;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      required_time_offsets = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    }</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;component type=TimeHeightConvolutionComponent name=layer&quot;</span> &lt;&lt; l &lt;&lt; <span class="stringliteral">&quot;-conv &quot;</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;num-filters-in=&quot;</span> &lt;&lt; cur_num_filt</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; num-filters-out=&quot;</span> &lt;&lt; next_num_filt</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; height-in=&quot;</span> &lt;&lt; cur_height</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; height-out=&quot;</span> &lt;&lt; next_height</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; height-offsets=&quot;</span> &lt;&lt; (height_padding ? <span class="stringliteral">&quot;-1,0,1&quot;</span> : <span class="stringliteral">&quot;0,1,2&quot;</span>)</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; time-offsets=&quot;</span> &lt;&lt; time_offsets;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="comment">// this limits the &#39;temp memory&#39; usage to 100</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="comment">// bytes, which will test another code path where</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <span class="comment">// it breaks up the temporary matrix into pieces</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; max-memory-mb=1.0e-04&quot;</span>;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    }</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">if</span> (height_subsampling_factor != 1 || <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; height-subsample-out=&quot;</span> &lt;&lt; height_subsampling_factor;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">if</span> (required_time_offsets == <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      required_time_offsets = time_offsets;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <span class="comment">// it should default to this, but we&#39;re exercising more of the config</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <span class="comment">// parsing code this way.</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (required_time_offsets != <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; required-time-offsets=&quot;</span> &lt;&lt; required_time_offsets;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; param-stddev=0.1 bias-stddev=1&quot;</span>;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; use-natural-gradient=false&quot;</span>;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; rank-in=4&quot;</span>;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; rank-out=4&quot;</span>;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; alpha-in=2.0&quot;</span>;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot; alpha-out=2.0&quot;</span>;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    ss &lt;&lt; std::endl;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;component-node name=layer&quot;</span> &lt;&lt; l &lt;&lt; <span class="stringliteral">&quot;-conv component=layer&quot;</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;       &lt;&lt; l &lt;&lt; <span class="stringliteral">&quot;-conv input=&quot;</span> &lt;&lt; cur_layer_descriptor &lt;&lt; std::endl;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordtype">bool</span> use_relu = <span class="keyword">false</span>;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="keywordflow">if</span> (use_relu) {</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot;component type=RectifiedLinearComponent name=layer&quot;</span> &lt;&lt; l</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;         &lt;&lt; <span class="stringliteral">&quot;-relu dim=&quot;</span> &lt;&lt; (next_height * next_num_filt) &lt;&lt; std::endl;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot;component-node name=layer&quot;</span> &lt;&lt; l &lt;&lt; <span class="stringliteral">&quot;-relu component=layer&quot;</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;         &lt;&lt; l &lt;&lt; <span class="stringliteral">&quot;-relu input=layer&quot;</span> &lt;&lt; l &lt;&lt; <span class="stringliteral">&quot;-conv&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    }</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    std::ostringstream desc_ss;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">if</span> (next_height == cur_height &amp;&amp; next_num_filt == cur_num_filt</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        &amp;&amp; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      desc_ss &lt;&lt; <span class="stringliteral">&quot;Sum(&quot;</span> &lt;&lt; cur_layer_descriptor &lt;&lt; <span class="stringliteral">&quot;, layer&quot;</span> &lt;&lt; l</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;              &lt;&lt; (use_relu ? <span class="stringliteral">&quot;-relu)&quot;</span> : <span class="stringliteral">&quot;-conv)&quot;</span>);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      desc_ss &lt;&lt; <span class="stringliteral">&quot;layer&quot;</span> &lt;&lt; l &lt;&lt; (use_relu ? <span class="stringliteral">&quot;-relu&quot;</span> : <span class="stringliteral">&quot;-conv&quot;</span>);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0) {</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      std::ostringstream round_desc_ss;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      int32 modulus = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(2, 3);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      round_desc_ss &lt;&lt; <span class="stringliteral">&quot;Round(&quot;</span> &lt;&lt; desc_ss.str() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; modulus &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      cur_layer_descriptor = round_desc_ss.str();</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      cur_layer_descriptor = desc_ss.str();</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    cur_height = next_height;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    cur_num_filt = next_num_filt;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  }</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=&quot;</span> &lt;&lt; cur_layer_descriptor &lt;&lt; std::endl;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  configs-&gt;push_back(ss.str());</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3af6a7b7d8ad5235dfbccfd6ea387b1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3af6a7b7d8ad5235dfbccfd6ea387b1b">&#9670;&nbsp;</a></span>GenerateConfigSequenceCompositeBlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GenerateConfigSequenceCompositeBlock </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generate a config string with a composite component composed only of block affine, repeated affine, and natural gradient repeated affine components. </p>

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01213">1213</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00048">NnetGenerationOptions::NnetGenerationOptions()</a>, and <a class="el" href="nnet-utils-test_8cc_source.html#l00082">UnitTestConvertRepeatedToBlockAffineComposite()</a>.</p>
<div class="fragment"><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                                                                         {</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  int32 num_components = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1,5);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  int32 input_dim = 10 * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1,10);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="keywordflow">if</span> (opts.output_dim &gt; 0) {</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a>  &lt;&lt; <span class="stringliteral">&quot;This function doesn&#39;t take a requested output_dim due to &quot;</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      <span class="stringliteral">&quot;implementation complications.&quot;</span>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  }</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  int32 max_rows_process = 512 + 512 * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1,3);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=composite1 type=CompositeComponent max-rows-process=&quot;</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;     &lt;&lt; max_rows_process &lt;&lt; <span class="stringliteral">&quot; num-components=&quot;</span> &lt;&lt; num_components;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  int32 types_length = 3;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  std::string types[] = {<span class="stringliteral">&quot;BlockAffineComponent&quot;</span>,</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                         <span class="stringliteral">&quot;RepeatedAffineComponent&quot;</span>,</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                         <span class="stringliteral">&quot;NaturalGradientRepeatedAffineComponent&quot;</span>};</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  int32 last_output_dim = input_dim;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="comment">// components within a composite component are indexed from 1.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordflow">for</span>(int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= num_components; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot; component&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;=&quot;</span>;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    int32 rand_index = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, types_length - 1);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    std::string rand_type = types[rand_index];</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&#39;type=&quot;</span> &lt;&lt; rand_type &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; last_output_dim;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    int32 current_output_dim = 10 * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1,10);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="comment">// must be a divisor or current_output_dim and last_output_dim</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    int32 num_repeats = 10;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; current_output_dim;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    std::string repeats_string = (rand_type == <span class="stringliteral">&quot;BlockAffineComponent&quot;</span>) ? <span class="stringliteral">&quot;num-blocks&quot;</span>: <span class="stringliteral">&quot;num-repeats&quot;</span>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; repeats_string &lt;&lt; <span class="stringliteral">&quot;=&quot;</span> &lt;&lt; num_repeats &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    last_output_dim = current_output_dim;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  }</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  os &lt;&lt; std::endl &lt;&lt; std::endl;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=composite1 component=composite1 input=input\n&quot;</span>;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=composite1\n&quot;</span>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3855b8fdbe81b37928ccc530d22b91a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3855b8fdbe81b37928ccc530d22b91a3">&#9670;&nbsp;</a></span>GenerateConfigSequenceDistribute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceDistribute </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01187">1187</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                                   {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  int32 output_dim = (opts.output_dim &gt; 0 ? opts.output_dim : 100);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  int32 x_expand = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 5), after_expand_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(10, 20),</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      input_dim = x_expand * after_expand_dim;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=distribute type=DistributeComponent input-dim=&quot;</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;     &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; after_expand_dim &lt;&lt; std::endl;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=distribute component=distribute input=input\n&quot;</span>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=affine type=AffineComponent input-dim=&quot;</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;     &lt;&lt; after_expand_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine component=affine input=distribute\n&quot;</span>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=Sum(&quot;</span>;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; x_expand; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0) os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;ReplaceIndex(affine, x, &quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  }</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa50641f28c6aecba5e74d7604b4ef650"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa50641f28c6aecba5e74d7604b4ef650">&#9670;&nbsp;</a></span>GenerateConfigSequenceLstm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceLstm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00414">414</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                   {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  std::vector&lt;int32&gt; splice_context;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 4; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      splice_context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (splice_context.empty())</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    splice_context.push_back(0);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      spliced_dim = input_dim * splice_context.size(),</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200),</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      cell_dim = 40 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50,</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      projection_dim = std::ceil(cell_dim / (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10 + 1));</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="comment">// trainable cell value for start/end of file.</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=c0 type=ConstantComponent&quot;</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="comment">// Parameter Definitions W*(* replaced by - to have valid names)</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="comment">// Input gate control : Wi* matrices</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wi-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wic type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="comment">// Forget gate control : Wf* matrices</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wf-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wfc type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// Output gate control : Wo* matrices</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wo-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim  &lt;&lt; std::endl;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Woc type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// Cell input matrices : Wc* matrices</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wc-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim  &lt;&lt; std::endl;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">// projection matrices : Wrm and Wpm</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=W-m type=NaturalGradientAffineComponent &quot;</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; cell_dim</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; 2 * projection_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="comment">// Output : Wyr and Wyp</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wy- type=NaturalGradientAffineComponent &quot;</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * projection_dim</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// Defining the diagonal matrices</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// Defining the final affine transform</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=final_affine type=NaturalGradientAffineComponent &quot;</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=logsoftmax type=LogSoftmaxComponent dim=&quot;</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;     &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// Defining the non-linearities</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">//  declare a no-op component so that we can use a sum descriptor&#39;s output</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">//  multiple times, and to make the config more readable given the equations</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=i type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=f type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=o type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=g type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=h type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=c1 type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=c2 type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=m type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">// Defining the computations</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  std::ostringstream temp_string_stream;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    int32 offset = splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    temp_string_stream &lt;&lt; <span class="stringliteral">&quot;Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; splice_context.size())</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      temp_string_stream &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  std::string spliced_input = temp_string_stream.str();</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  std::string c_tminus1 = <span class="stringliteral">&quot;Sum(Failover(Offset(c1_t, -1), c0), IfDefined(Offset( c2_t, -1)))&quot;</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// c0.  note: the input is never used as the component requires</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// no input indexes; we just write itself as input to keep the</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">// structures happy.</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=c0 component=c0 input=c0\n&quot;</span>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// i_t</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i1 component=Wi-xr input=Append(&quot;</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, -1)))\n&quot;</span>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i2 component=Wic &quot;</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input=&quot;</span> &lt;&lt; c_tminus1 &lt;&lt; std::endl;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i_t component=i input=Sum(i1, i2)\n&quot;</span>;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="comment">// f_t</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f1 component=Wf-xr input=Append(&quot;</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, -1)))\n&quot;</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f2 component=Wfc &quot;</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input=&quot;</span> &lt;&lt; c_tminus1 &lt;&lt; std::endl;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f_t component=f input=Sum(f1, f2)\n&quot;</span>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">// o_t</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=o1 component=Wo-xr input=Append(&quot;</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, -1)))\n&quot;</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=o2 component=Woc input=Sum(c1_t, c2_t)\n&quot;</span>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=o_t component=o input=Sum(o1, o2)\n&quot;</span>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">// h_t</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=h_t component=h input=Sum(c1_t, c2_t)\n&quot;</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">// g_t</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=g1 component=Wc-xr input=Append(&quot;</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, -1)))\n&quot;</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=g_t component=g input=g1\n&quot;</span>;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">// parts of c_t</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=c1_t component=c1 &quot;</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input=Append(f_t, &quot;</span> &lt;&lt; c_tminus1 &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=c2_t component=c2 input=Append(i_t, g_t)\n&quot;</span>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">// m_t</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=m_t component=m input=Append(o_t, h_t)\n&quot;</span>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">// r_t and p_t</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=rp_t component=W-m input=m_t\n&quot;</span>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// Splitting outputs of Wy- node</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=r_t input-node=rp_t dim-offset=0 &quot;</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; projection_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="comment">// y_t</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=y_t component=Wy- input=rp_t\n&quot;</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="comment">// Final affine transform</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine component=final_affine input=y_t\n&quot;</span>;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=posteriors component=logsoftmax input=final_affine\n&quot;</span>;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=posteriors\n&quot;</span>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a151e0713f1dd005df56e3c3c5bad845e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a151e0713f1dd005df56e3c3c5bad845e">&#9670;&nbsp;</a></span>GenerateConfigSequenceLstmType2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceLstmType2 </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00767">767</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>
<div class="fragment"><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                   {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Not Implemented&quot;</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  std::vector&lt;int32&gt; splice_context;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 4; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0)</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      splice_context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> (splice_context.empty())</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    splice_context.push_back(0);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      spliced_dim = input_dim * splice_context.size(),</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200),</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      cell_dim = 40 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50,</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      projection_dim = std::ceil(cell_dim / (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10 + 2));</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  int32 offset = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-3, 3);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">if</span> (offset == 0)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    offset = -1;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="comment">// Parameter Definitions W*(* replaced by - to have valid names)</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=W-x type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;     &lt;&lt; spliced_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; 4 * cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=W-r type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;     &lt;&lt; projection_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; 4 * cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=W-m type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;     &lt;&lt; cell_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; 2 * projection_dim  &lt;&lt; std::endl;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wyr type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;     &lt;&lt; projection_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wyp type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;     &lt;&lt; projection_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="comment">// Defining the diagonal matrices</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wic type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wfc type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Woc type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="comment">// Defining the final affine transform</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=final_affine type=NaturalGradientAffineComponent &quot;</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=logsoftmax type=LogSoftmaxComponent dim=&quot;</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;     &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="comment">// Defining the non-linearities</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="comment">//  declare a no-op component so that we can use a sum descriptor&#39;s output</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="comment">//  multiple times, and to make the config more readable given the equations</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=c_t type=NoOpComponent dim=&quot;</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=i_t type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=f_t type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=o_t type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=g type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=h type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=f_t-c_tminus1 type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=i_t-g type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=m_t type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">// Defining the computations</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=W-x component=W-x input=Append(&quot;</span>;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    int32 offset = splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; splice_context.size())</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  }</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=W-r component=W-r input=IfDefined(Offset(r_t&quot;</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;     &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;))\n&quot;</span>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=W-m component=W-m input=m_t \n&quot;</span>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=Wic component=Wic input=IfDefined(Offset(c_t&quot;</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;     &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;))\n&quot;</span>;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=Wfc component=Wfc input=IfDefined(Offset(c_t&quot;</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;     &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;))\n&quot;</span>;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=Woc component=Woc input=c_t\n&quot;</span>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="comment">// Splitting the outputs of W*m node</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=r_t input-node=W-m dim-offset=0 &quot;</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; projection_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=p_t input-node=W-m dim-offset=&quot;</span> &lt;&lt; projection_dim</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; projection_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">// Splitting outputs of W*x node</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_ix-x_t input-node=W-x dim-offset=0 &quot;</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_fx-x_t input-node=W-x &quot;</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim-offset=&quot;</span> &lt;&lt; cell_dim &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span>&lt;&lt;cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_cx-x_t input-node=W-x &quot;</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim-offset=&quot;</span> &lt;&lt; 2 * cell_dim &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span>&lt;&lt;cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_ox-x_t input-node=W-x &quot;</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim-offset=&quot;</span> &lt;&lt; 3 * cell_dim &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span>&lt;&lt;cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// Splitting outputs of W*r node</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_ir-r_tminus1 input-node=W-r dim-offset=0 &quot;</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_fr-r_tminus1 input-node=W-r &quot;</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim-offset=&quot;</span> &lt;&lt; cell_dim &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span>&lt;&lt;cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_cr-r_tminus1 input-node=W-r &quot;</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim-offset=&quot;</span> &lt;&lt; 2 * cell_dim &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span>&lt;&lt;cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=W_or-r_tminus1 input-node=W-r &quot;</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim-offset=&quot;</span> &lt;&lt; 3 * cell_dim &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span>&lt;&lt;cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">// Non-linear operations</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=c_t component=c_t input=Sum(f_t-c_tminus1, i_t-g)\n&quot;</span>;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=h component=h input=c_t\n&quot;</span>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i_t component=i_t input=Sum(W_ix-x_t, Sum(W_ir-r_tminus1, Wic))\n&quot;</span>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f_t component=f_t input=Sum(W_fx-x_t, Sum(W_fr-r_tminus1, Wfc))\n&quot;</span>;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=o_t component=o_t input=Sum(W_ox-x_t, Sum(W_or-r_tminus1, Woc))\n&quot;</span>;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f_t-c_tminus1 component=f_t-c_tminus1 input=Append(f_t, Offset(c_t&quot;</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;     &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;))\n&quot;</span>;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i_t-g component=i_t-g input=Append(i_t, g)\n&quot;</span>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=m_t component=m_t input=Append(o_t, h)\n&quot;</span>;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=g component=g input=Sum(W_cx-x_t, W_cr-r_tminus1)\n&quot;</span>;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// Final affine transform</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=Wyr component=Wyr input=r_t\n&quot;</span>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=Wyp component=Wyp input=p_t\n&quot;</span>;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine component=final_affine input=Sum(Wyr, Wyp)\n&quot;</span>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=posteriors component=logsoftmax input=final_affine\n&quot;</span>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=posteriors\n&quot;</span>;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a70f72e5f56f05e3a1005e54b4aa92673"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70f72e5f56f05e3a1005e54b4aa92673">&#9670;&nbsp;</a></span>GenerateConfigSequenceLstmWithTruncation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceLstmWithTruncation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00580">580</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                   {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  std::vector&lt;int32&gt; splice_context;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 4; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      splice_context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordflow">if</span> (splice_context.empty())</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    splice_context.push_back(0);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      spliced_dim = input_dim * splice_context.size(),</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200),</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      cell_dim = 40 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50,</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      projection_dim = std::ceil(cell_dim / (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10 + 1));</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  int32 clipping_threshold = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(6, 50),</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      zeroing_threshold = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1,  5),</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      zeroing_interval = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 5) * 10;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale = 0.8 + 0.1*<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0,3);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">// Parameter Definitions W*(* replaced by - to have valid names)</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// Input gate control : Wi* matrices</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wi-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wic type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="comment">// Forget gate control : Wf* matrices</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wf-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wfc type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="comment">// Output gate control : Wo* matrices</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wo-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim  &lt;&lt; std::endl;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Woc type=PerElementScaleComponent &quot;</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">// Cell input matrices : Wc* matrices</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wc-xr type=NaturalGradientAffineComponent&quot;</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; spliced_dim + projection_dim</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim  &lt;&lt; std::endl;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="comment">// projection matrices : Wrm and Wpm</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=W-m type=NaturalGradientAffineComponent &quot;</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; cell_dim</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; 2 * projection_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">// Output : Wyr and Wyp</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=Wy- type=NaturalGradientAffineComponent &quot;</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * projection_dim</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="comment">// Defining the diagonal matrices</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="comment">// Defining the final affine transform</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=final_affine type=NaturalGradientAffineComponent &quot;</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=logsoftmax type=LogSoftmaxComponent dim=&quot;</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;     &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="comment">// Defining the non-linearities</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">//  declare a no-op component so that we can use a sum descriptor&#39;s output</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">//  multiple times, and to make the config more readable given the equations</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=i type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=f type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=o type=SigmoidComponent dim=&quot;</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=g type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=h type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;     &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=c1 type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=c2 type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=m type=ElementwiseProductComponent &quot;</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input-dim=&quot;</span> &lt;&lt; 2 * cell_dim</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; cell_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=c type=BackpropTruncationComponent dim=&quot;</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;     &lt;&lt; cell_dim</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; scale=&quot;</span> &lt;&lt; scale</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; clipping-threshold=&quot;</span> &lt;&lt; clipping_threshold</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; zeroing-threshold=&quot;</span> &lt;&lt; zeroing_threshold</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; zeroing-interval=&quot;</span> &lt;&lt; zeroing_interval</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; recurrence-interval=1&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=r type=BackpropTruncationComponent dim=&quot;</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;     &lt;&lt; projection_dim</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; scale=&quot;</span> &lt;&lt; scale</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; clipping-threshold=&quot;</span> &lt;&lt; clipping_threshold</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; zeroing-threshold=&quot;</span> &lt;&lt; zeroing_threshold</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; zeroing-interval=&quot;</span> &lt;&lt; zeroing_interval</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; recurrence-interval=1&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="comment">// Defining the computations</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  std::ostringstream temp_string_stream;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    int32 offset = splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    temp_string_stream &lt;&lt; <span class="stringliteral">&quot;Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; splice_context.size())</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      temp_string_stream &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  std::string spliced_input = temp_string_stream.str();</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  int32 offset = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-3, 3);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordflow">if</span> (offset == 0)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    offset = -1;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  std::string c_tminus1;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    std::ostringstream os_temp;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    os_temp &lt;&lt; <span class="stringliteral">&quot;IfDefined(Offset(c_t, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;))&quot;</span>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    c_tminus1 = os_temp.str();</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=c_t component=c input=Sum(c1_t, c2_t)\n&quot;</span>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="comment">// i_t</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i1 component=Wi-xr input=Append(&quot;</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)))\n&quot;</span>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i2 component=Wic &quot;</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input=&quot;</span> &lt;&lt; c_tminus1 &lt;&lt; std::endl;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=i_t component=i input=Sum(i1, i2)\n&quot;</span>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="comment">// f_t</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f1 component=Wf-xr input=Append(&quot;</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)))\n&quot;</span>;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f2 component=Wfc &quot;</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input=&quot;</span> &lt;&lt; c_tminus1 &lt;&lt; std::endl;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=f_t component=f input=Sum(f1, f2)\n&quot;</span>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">// o_t</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=o1 component=Wo-xr input=Append(&quot;</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)))\n&quot;</span>;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=o2 component=Woc input=Sum(c1_t, c2_t)\n&quot;</span>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=o_t component=o input=Sum(o1, o2)\n&quot;</span>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="comment">// h_t</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=h_t component=h input=Sum(c1_t, c2_t)\n&quot;</span>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="comment">// g_t</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=g1 component=Wc-xr input=Append(&quot;</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;     &lt;&lt; spliced_input &lt;&lt; <span class="stringliteral">&quot;, IfDefined(Offset(r_t, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)))\n&quot;</span>;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=g_t component=g input=g1\n&quot;</span>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="comment">// parts of c_t</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=c1_t component=c1 &quot;</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; input=Append(f_t, &quot;</span> &lt;&lt; c_tminus1 &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=c2_t component=c2 input=Append(i_t, g_t)\n&quot;</span>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="comment">// m_t</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=m_t component=m input=Append(o_t, h_t)\n&quot;</span>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="comment">// r_t and p_t</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=rp_t component=W-m input=m_t\n&quot;</span>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="comment">// Splitting outputs of Wy- node</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;dim-range-node name=r_t_pretrunc input-node=rp_t dim-offset=0 &quot;</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; projection_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=r_t component=r input=r_t_pretrunc\n&quot;</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="comment">// y_t</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=y_t component=Wy- input=rp_t\n&quot;</span>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="comment">// Final affine transform</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine component=final_affine input=y_t\n&quot;</span>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=posteriors component=logsoftmax input=final_affine\n&quot;</span>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=posteriors\n&quot;</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa14a929fe7917b3ba3adf610aa27a643"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa14a929fe7917b3ba3adf610aa27a643">&#9670;&nbsp;</a></span>GenerateConfigSequenceRestrictedAttention()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceRestrictedAttention </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01130">1130</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                                   {</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  std::ostringstream ss;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(100, 150),</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      num_heads = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 2),</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      key_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(20, 40),</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      value_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(20, 40),</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      time_stride = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      num_left_inputs = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 4),</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      num_right_inputs = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 2),</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      num_left_inputs_required = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, num_left_inputs),</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      num_right_inputs_required = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, num_right_inputs);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="keywordtype">bool</span> output_context = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  int32 context_dim = (num_left_inputs + 1 + num_right_inputs),</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      query_dim = key_dim + context_dim;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  int32 attention_input_dim = num_heads * (key_dim + value_dim + query_dim);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  std::string cur_layer_descriptor = <span class="stringliteral">&quot;input&quot;</span>;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  { <span class="comment">// input layer.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;       &lt;&lt; std::endl;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  }</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  { <span class="comment">// affine component</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;component name=affine type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;       &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; attention_input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;component-node name=affine component=affine input=input&quot;</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;       &lt;&lt; std::endl;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  }</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  { <span class="comment">// attention component</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;component-node name=attention component=attention input=affine&quot;</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;       &lt;&lt; std::endl;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;component name=attention type=RestrictedAttentionComponent&quot;</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; num-heads=&quot;</span> &lt;&lt; num_heads &lt;&lt; <span class="stringliteral">&quot; key-dim=&quot;</span> &lt;&lt; key_dim</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; value-dim=&quot;</span> &lt;&lt; value_dim &lt;&lt; <span class="stringliteral">&quot; time-stride=&quot;</span> &lt;&lt; time_stride</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; num-left-inputs=&quot;</span> &lt;&lt; num_left_inputs &lt;&lt; <span class="stringliteral">&quot; num-right-inputs=&quot;</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;       &lt;&lt; num_right_inputs &lt;&lt; <span class="stringliteral">&quot; num-left-inputs-required=&quot;</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;       &lt;&lt; num_left_inputs_required &lt;&lt; <span class="stringliteral">&quot; num-right-inputs-required=&quot;</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;       &lt;&lt; num_right_inputs_required</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; output-context=&quot;</span> &lt;&lt; (output_context ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>)</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;       &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? <span class="stringliteral">&quot; key-scale=1.0&quot;</span> : <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;       &lt;&lt; std::endl;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  }</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  { <span class="comment">// output</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=attention&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  }</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  configs-&gt;push_back(ss.str());</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a380783b4b5f4a192930cb5e5b00d0143"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a380783b4b5f4a192930cb5e5b00d0143">&#9670;&nbsp;</a></span>GenerateConfigSequenceRnn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceRnn </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00263">263</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                   {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  std::vector&lt;int32&gt; splice_context;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 4; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      splice_context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span> (splice_context.empty())</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    splice_context.push_back(0);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      spliced_dim = input_dim * splice_context.size(),</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200),</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      hidden_dim = 40 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=affine1 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;     &lt;&lt; spliced_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component name=nonlin1 type=RectifiedLinearComponent dim=&quot;</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;       &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component name=nonlin1 type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;       &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=recurrent_affine1 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=affine2 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=logsoftmax type=LogSoftmaxComponent dim=&quot;</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;     &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine1_node component=affine1 input=Append(&quot;</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    int32 offset = splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; splice_context.size())</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=recurrent_affine1 component=recurrent_affine1 &quot;</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="stringliteral">&quot;input=Offset(nonlin1, -1)\n&quot;</span>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=nonlin1 component=nonlin1 &quot;</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="stringliteral">&quot;input=Sum(affine1_node, IfDefined(recurrent_affine1))\n&quot;</span>;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine2 component=affine2 input=nonlin1\n&quot;</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=output_nonlin component=logsoftmax input=affine2\n&quot;</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=output_nonlin\n&quot;</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a410289847ba049a50141e38f95d4a3c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a410289847ba049a50141e38f95d4a3c5">&#9670;&nbsp;</a></span>GenerateConfigSequenceRnnClockwork()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceRnnClockwork </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00322">322</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                   {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  std::vector&lt;int32&gt; splice_context;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 4; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      splice_context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">if</span> (splice_context.empty())</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    splice_context.push_back(0);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      spliced_dim = input_dim * splice_context.size(),</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200),</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      hidden_dim = 40 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=affine1 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;     &lt;&lt; spliced_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=nonlin1 type=RectifiedLinearComponent dim=&quot;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=recurrent_affine1 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// the suffix _0, _1, _2 equals the index of the output-frame modulo 3; there</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// are 3 versions of the final affine layer.  There was a paper by Vincent</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="comment">// Vanhoucke about something like this.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=final_affine_0 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=final_affine_1 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=final_affine_2 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=logsoftmax type=LogSoftmaxComponent dim=&quot;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;     &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine1_node component=affine1 input=Append(&quot;</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    int32 offset = splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; splice_context.size())</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=recurrent_affine1 component=recurrent_affine1 &quot;</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="stringliteral">&quot;input=Offset(nonlin1, -1)\n&quot;</span>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=nonlin1 component=nonlin1 &quot;</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="stringliteral">&quot;input=Sum(affine1_node, IfDefined(recurrent_affine1))\n&quot;</span>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine_0 component=final_affine_0 input=nonlin1\n&quot;</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine_1 component=final_affine_1 input=Offset(nonlin1, -1)\n&quot;</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine_2 component=final_affine_2 input=Offset(nonlin1, 1)\n&quot;</span>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=output_nonlin component=logsoftmax input=Switch(final_affine_0, final_affine_1, final_affine_2)\n&quot;</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=output_nonlin\n&quot;</span>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a51af5c2c6da3b32c75666de9852dc74c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51af5c2c6da3b32c75666de9852dc74c">&#9670;&nbsp;</a></span>GenerateConfigSequenceSimple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceSimple </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00111">111</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8h_source.html#l00040">NnetGenerationOptions::allow_final_nonlinearity</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00042">NnetGenerationOptions::allow_ivector</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                   {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  std::vector&lt;int32&gt; splice_context;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 4; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      splice_context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span> (splice_context.empty())</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    splice_context.push_back(0);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200),</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      hidden_dim = 40 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  int32 ivector_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 || !opts.allow_ivector)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    ivector_dim = 0;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  int32 spliced_dim = input_dim * splice_context.size() + ivector_dim;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordtype">bool</span> use_final_nonlinearity = (opts.allow_final_nonlinearity &amp;&amp;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                 <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordtype">bool</span> use_batch_norm = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=affine1 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;     &lt;&lt; spliced_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=relu1 type=RectifiedLinearComponent dim=&quot;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">if</span> (use_batch_norm) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    int32 block_dim = (hidden_dim % 2 == 0 ? hidden_dim / 2 : hidden_dim);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component name=batch-norm type=BatchNormComponent dim=&quot;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;       &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; block-dim=&quot;</span> &lt;&lt; block_dim</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; target-rms=2.0&quot;</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot; epsilon=3.0&quot;</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    os &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=final_affine type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;     &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">if</span> (use_final_nonlinearity) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;component name=logsoftmax type=SoftmaxComponent dim=&quot;</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;         &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;component name=logsoftmax type=LogSoftmaxComponent dim=&quot;</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;         &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">if</span> (ivector_dim != 0)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;input-node name=ivector dim=&quot;</span> &lt;&lt; ivector_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine1_node component=affine1 input=Append(&quot;</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">if</span> (ivector_dim != 0)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;ReplaceIndex(ivector, t, 0), &quot;</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    int32 offset = splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="comment">// testing the Scale() expression.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;Scale(-1, Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;))&quot;</span>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; splice_context.size())</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=nonlin1 component=relu1 input=affine1_node\n&quot;</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=nonlin1 component=relu1 input=Scale(-1.0, affine1_node)\n&quot;</span>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=nonlin1 component=relu1 input=Sum(Const(1.0, &quot;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;       &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot;), Scale(-1.0, affine1_node))\n&quot;</span>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">if</span> (use_batch_norm) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=batch-norm component=batch-norm input=nonlin1\n&quot;</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine component=final_affine input=batch-norm\n&quot;</span>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine component=final_affine input=nonlin1\n&quot;</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (use_final_nonlinearity) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=output_nonlin component=logsoftmax input=final_affine\n&quot;</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=output_nonlin\n&quot;</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=final_affine\n&quot;</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2) == 0) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    std::ostringstream os2;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    os2 &lt;&lt; <span class="stringliteral">&quot;component name=affine2 type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    os2 &lt;&lt; <span class="stringliteral">&quot;component name=relu2 type=RectifiedLinearComponent dim=&quot;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        &lt;&lt; hidden_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// regenerate the final_affine component when we add the new config.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    os2 &lt;&lt; <span class="stringliteral">&quot;component name=final_affine type=NaturalGradientAffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        &lt;&lt; hidden_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    os2 &lt;&lt; <span class="stringliteral">&quot;component-node name=affine2 component=affine2 input=nonlin1\n&quot;</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    os2 &lt;&lt; <span class="stringliteral">&quot;component-node name=relu2 component=relu2 input=affine2\n&quot;</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    os2 &lt;&lt; <span class="stringliteral">&quot;component-node name=final_affine component=final_affine input=relu2\n&quot;</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    configs-&gt;push_back(os2.str());</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a020e04f5594e00affc4c2bf231687e65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a020e04f5594e00affc4c2bf231687e65">&#9670;&nbsp;</a></span>GenerateConfigSequenceSimpleContext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceSimpleContext </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00054">54</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                   {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  std::vector&lt;int32&gt; splice_context;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 4; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0)</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      splice_context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">if</span> (splice_context.empty())</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    splice_context.push_back(0);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      spliced_dim = input_dim * splice_context.size(),</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0,1) == 0) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// do it the traditional way with an AffineComponent and an Append() expression.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component name=affine1 type=AffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;       &lt;&lt; spliced_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine1_node component=affine1 input=Append(&quot;</span>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      int32 offset = splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;Offset(input, &quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; splice_context.size())</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=affine1_node\n&quot;</span>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component name=tdnn1 type=TdnnComponent input-dim=&quot;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;       &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; time-offsets=&quot;</span>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; splice_context.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;0) os &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      os &lt;&lt; splice_context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot; use-bias=&quot;</span> &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0,1) == 0 ? <span class="stringliteral">&quot;true&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>)</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; use-natural-gradient=&quot;</span>  &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0,1) == 0 ? <span class="stringliteral">&quot;true&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;       &lt;&lt; std::endl;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;component-node name=tdnn1_node component=tdnn1 input=input\n&quot;</span>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=tdnn1_node\n&quot;</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3855432311c60a3aba3f3ef77871a9eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3855432311c60a3aba3f3ef77871a9eb">&#9670;&nbsp;</a></span>GenerateConfigSequenceSimplest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceSimplest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00033">33</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                   {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      output_dim = (opts.output_dim &gt; 0 ?</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                    opts.output_dim :</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                    100 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 200);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=affine1 type=AffineComponent input-dim=&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;     &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine1_node component=affine1 input=input\n&quot;</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=affine1_node\n&quot;</span>;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab23082de0da09ca5e9e4384bc51eb940"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab23082de0da09ca5e9e4384bc51eb940">&#9670;&nbsp;</a></span>GenerateConfigSequenceStatistics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenerateConfigSequenceStatistics </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>configs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l00219">219</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>.</p>
<div class="fragment"><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                                   {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(10, 30),</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      input_period = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      stats_period = input_period * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      left_context = stats_period * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10),</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      right_context = stats_period * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10),</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      log_count_features = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> variance_floor = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10) * 1.0e-10;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">bool</span> output_stddevs = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  int32 raw_stats_dim = 1 + input_dim + (output_stddevs ? input_dim : 0),</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      pooled_stats_dim = log_count_features + input_dim +</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        (output_stddevs ? input_dim : 0);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;input-node name=input dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; std::endl;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=statistics-extraction type=StatisticsExtractionComponent &quot;</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; input-period=&quot;</span> &lt;&lt; input_period</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; output-period=&quot;</span> &lt;&lt; stats_period &lt;&lt; <span class="stringliteral">&quot; include-variance=&quot;</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;     &lt;&lt; std::boolalpha &lt;&lt; output_stddevs &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=statistics-pooling type=StatisticsPoolingComponent &quot;</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; raw_stats_dim &lt;&lt; <span class="stringliteral">&quot; input-period=&quot;</span> &lt;&lt; stats_period</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; left-context=&quot;</span> &lt;&lt; left_context &lt;&lt; <span class="stringliteral">&quot; right-context=&quot;</span> &lt;&lt; right_context</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; num-log-count-features=&quot;</span> &lt;&lt; log_count_features &lt;&lt; <span class="stringliteral">&quot; output-stddevs=&quot;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;     &lt;&lt; std::boolalpha &lt;&lt; output_stddevs &lt;&lt; <span class="stringliteral">&quot; variance-floor=&quot;</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;     &lt;&lt; variance_floor &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component name=affine type=AffineComponent &quot;</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; pooled_stats_dim</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=statistics-extraction component=statistics-extraction &quot;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input=input\n&quot;</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=statistics-pooling component=statistics-pooling &quot;</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;     &lt;&lt; <span class="stringliteral">&quot;input=statistics-extraction\n&quot;</span>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;component-node name=affine component=affine input=input\n&quot;</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;output-node name=output input=Sum(affine, Round(statistics-pooling, &quot;</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;     &lt;&lt; stats_period &lt;&lt; <span class="stringliteral">&quot;))\n&quot;</span>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  configs-&gt;push_back(os.str());</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afb5a70eadfcda218c3833859bf7ceb27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb5a70eadfcda218c3833859bf7ceb27">&#9670;&nbsp;</a></span>GenerateRandomComponentConfig()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::GenerateRandomComponentConfig </td>
          <td>(</td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>component_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01400">1400</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, and <a class="el" href="kaldi-math_8h_source.html#l00151">kaldi::RandUniform()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01767">GenerateRandomSimpleComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                                                             {</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 35);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.001 * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">switch</span>(n) {</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="keywordflow">case</span> 0: {</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      *component_type = <span class="stringliteral">&quot;PnormComponent&quot;</span>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      int32 output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50), group_size = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15),</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;          input_dim = output_dim * group_size;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">case</span> 1: {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> target_rms = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 200) / 100.0);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      std::string add_log_stddev = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0 ? <span class="stringliteral">&quot;True&quot;</span> : <span class="stringliteral">&quot;False&quot;</span>);</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      *component_type = <span class="stringliteral">&quot;NormalizeComponent&quot;</span>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      int32 block_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(2, 50), num_blocks = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;          dim = block_dim * num_blocks;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="comment">// avoid dim=1 because the derivatives would be zero, which</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="comment">// makes them hard to test.</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; dim &lt;&lt; <span class="stringliteral">&quot; block-dim=&quot;</span> &lt;&lt; block_dim</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; target-rms=&quot;</span> &lt;&lt; target_rms</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; add-log-stddev=&quot;</span> &lt;&lt; add_log_stddev;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">case</span> 2: {</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      *component_type = <span class="stringliteral">&quot;SigmoidComponent&quot;</span>;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    }</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">case</span> 3: {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      *component_type = <span class="stringliteral">&quot;TanhComponent&quot;</span>;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    }</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="keywordflow">case</span> 4: {</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      *component_type = <span class="stringliteral">&quot;RectifiedLinearComponent&quot;</span>;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordflow">case</span> 5: {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      *component_type = <span class="stringliteral">&quot;SoftmaxComponent&quot;</span>;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordflow">case</span> 6: {</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      *component_type = <span class="stringliteral">&quot;LogSoftmaxComponent&quot;</span>;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    }</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">case</span> 7: {</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      *component_type = <span class="stringliteral">&quot;NoOpComponent&quot;</span>;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    }</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">case</span> 8: {</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      *component_type = <span class="stringliteral">&quot;FixedAffineComponent&quot;</span>;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50), output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    }</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">case</span> 9: {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      *component_type = <span class="stringliteral">&quot;AffineComponent&quot;</span>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50), output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    }</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">case</span> 10: {</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      *component_type = <span class="stringliteral">&quot;NaturalGradientAffineComponent&quot;</span>;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50), output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordflow">case</span> 11: {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      *component_type = <span class="stringliteral">&quot;SumGroupComponent&quot;</span>;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      std::vector&lt;int32&gt; sizes;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      int32 num_groups = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;sizes=&quot;</span>;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_groups; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        os &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 5);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; num_groups)</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;          os &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      }</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">case</span> 12: {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      *component_type = <span class="stringliteral">&quot;FixedScaleComponent&quot;</span>;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100);</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    }</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">case</span> 13: {</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      *component_type = <span class="stringliteral">&quot;FixedBiasComponent&quot;</span>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100);</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    }</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordflow">case</span> 14: {</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      *component_type = <span class="stringliteral">&quot;NaturalGradientPerElementScaleComponent&quot;</span>;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100)</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    }</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordflow">case</span> 15: {</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      *component_type = <span class="stringliteral">&quot;PerElementScaleComponent&quot;</span>;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100)</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    }</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordflow">case</span> 16: {</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      *component_type = <span class="stringliteral">&quot;ElementwiseProductComponent&quot;</span>;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      int32 output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100), multiple = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(2, 4),</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;          input_dim = output_dim * multiple;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordflow">case</span> 17: {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      int32 input_vectorization = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      std::string vectorization;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">if</span> (input_vectorization == 0) {</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        vectorization = <span class="stringliteral">&quot;yzx&quot;</span>;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      } <span class="keywordflow">else</span>  {</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        vectorization = <span class="stringliteral">&quot;zyx&quot;</span>;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      *component_type = <span class="stringliteral">&quot;ConvolutionComponent&quot;</span>;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;      int32 input_x_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            input_y_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            input_z_dim = 3 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            filt_x_dim = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % input_x_dim,</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            filt_y_dim = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % input_y_dim,</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            num_filters = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            filt_x_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % filt_x_dim),</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            filt_y_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % filt_y_dim);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      int32 remainder = (input_x_dim - filt_x_dim) % filt_x_step;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      <span class="comment">// adjusting input_x_dim to ensure divisibility</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      input_x_dim = input_x_dim - remainder;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      remainder = (input_y_dim - filt_y_dim) % filt_y_step;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      <span class="comment">// adjusting input_x_dim to ensure divisibility</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      input_y_dim = input_y_dim - remainder;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-x-dim=&quot;</span> &lt;&lt; input_x_dim</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; input-y-dim=&quot;</span> &lt;&lt; input_y_dim</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; input-z-dim=&quot;</span> &lt;&lt; input_z_dim</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; filt-x-dim=&quot;</span> &lt;&lt; filt_x_dim</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; filt-y-dim=&quot;</span> &lt;&lt; filt_y_dim</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; filt-x-step=&quot;</span> &lt;&lt; filt_x_step</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; filt-y-step=&quot;</span> &lt;&lt; filt_y_step</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; num-filters=&quot;</span> &lt;&lt; num_filters</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; input-vectorization-order=&quot;</span> &lt;&lt; vectorization</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <span class="comment">// TODO : add test for file based initialization. But confirm how to write</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;      <span class="comment">// a file which is not going to be overwritten by other components</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    }</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">case</span> 18: {</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      *component_type = <span class="stringliteral">&quot;PermuteComponent&quot;</span>;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;      int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 100;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;      std::vector&lt;int32&gt; column_map(input_dim);</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; input_dim; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        column_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      std::random_shuffle(column_map.begin(), column_map.end());</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      std::ostringstream buffer;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; input_dim-1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        buffer &lt;&lt; column_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;      buffer &lt;&lt; column_map.back();</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;column-map=&quot;</span> &lt;&lt; buffer.str();</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    }</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">case</span> 19: {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      *component_type = <span class="stringliteral">&quot;PerElementOffsetComponent&quot;</span>;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      std::string param_config = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1)?</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                                 <span class="stringliteral">&quot; param-mean=0.0 param-stddev=0.0&quot;</span>:</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                                 <span class="stringliteral">&quot; param-mean=1.0 param-stddev=1.0&quot;</span>;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      int32 block_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(10, 20), dim = block_dim * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 2);</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; dim &lt;&lt; <span class="stringliteral">&quot; block-dim=&quot;</span> &lt;&lt; block_dim</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; use-natural-gradient=&quot;</span> &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>)</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate &lt;&lt; param_config;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    }</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordflow">case</span> 20: <span class="keywordflow">case</span> 21: {</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      *component_type = <span class="stringliteral">&quot;CompositeComponent&quot;</span>;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      int32 cur_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(20, 30), num_components = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;          max_rows_process = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 30);</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;num-components=&quot;</span> &lt;&lt; num_components</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; max-rows-process=&quot;</span> &lt;&lt; max_rows_process;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      std::vector&lt;std::string&gt; sub_configs;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= num_components; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3) == 1) {</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot; component&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;=&#39;type=RectifiedLinearComponent dim=&quot;</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;             &lt;&lt; cur_dim &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 2) == 1) {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot; component&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;=&#39;type=TanhComponent dim=&quot;</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;             &lt;&lt; cur_dim &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;          int32 next_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(20, 30);</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot; component&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;=&#39;type=AffineComponent input-dim=&quot;</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;             &lt;&lt; cur_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; next_dim &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;          cur_dim = next_dim;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        }</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      }</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    }</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">case</span> 22: {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      *component_type = <span class="stringliteral">&quot;SumGroupComponent&quot;</span>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      int32 num_groups = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50),</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        input_dim = num_groups * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15);</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; num_groups;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">case</span> 23: {</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      *component_type = <span class="stringliteral">&quot;RepeatedAffineComponent&quot;</span>;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      int32 num_repeats = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50),</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;          input_dim = num_repeats * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15),</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;          output_dim = num_repeats * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; num-repeats=&quot;</span> &lt;&lt; num_repeats;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    }</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <span class="keywordflow">case</span> 24: {</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      *component_type = <span class="stringliteral">&quot;BlockAffineComponent&quot;</span>;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      int32 num_blocks = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50),</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;          input_dim = num_blocks * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15),</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;          output_dim = num_blocks * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; num-blocks=&quot;</span> &lt;&lt; num_blocks;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    }</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <span class="keywordflow">case</span> 25: {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      *component_type = <span class="stringliteral">&quot;NaturalGradientRepeatedAffineComponent&quot;</span>;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      int32 num_repeats = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50),</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;          input_dim = num_repeats * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15),</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;          output_dim = num_repeats * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 15);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; num-repeats=&quot;</span> &lt;&lt; num_repeats;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    }</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">case</span> 26: {</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      *component_type = <span class="stringliteral">&quot;MaxpoolingComponent&quot;</span>;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      int32 input_x_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            input_y_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            input_z_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      int32 pool_x_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % input_x_dim,</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;            pool_y_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % input_y_dim,</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            pool_z_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % input_z_dim;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      int32 pool_x_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % pool_x_size),</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            pool_y_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % pool_y_size),</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            pool_z_step = (1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % pool_z_size);</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      <span class="comment">// adjusting input dim to ensure divisibility</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      int32 remainder = (input_x_dim - pool_x_size) % pool_x_step;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      input_x_dim = input_x_dim - remainder;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      remainder = (input_y_dim - pool_y_size) % pool_y_step;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      input_y_dim = input_y_dim - remainder;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      remainder = (input_z_dim - pool_z_size) % pool_z_step;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      input_z_dim = input_z_dim - remainder;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot; input-x-dim=&quot;</span> &lt;&lt; input_x_dim</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; input-y-dim=&quot;</span> &lt;&lt; input_y_dim</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; input-z-dim=&quot;</span> &lt;&lt; input_z_dim</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; pool-x-size=&quot;</span> &lt;&lt; pool_x_size</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; pool-y-size=&quot;</span> &lt;&lt; pool_y_size</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; pool-z-size=&quot;</span> &lt;&lt; pool_z_size</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; pool-x-step=&quot;</span> &lt;&lt; pool_x_step</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; pool-y-step=&quot;</span> &lt;&lt; pool_y_step</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; pool-z-step=&quot;</span> &lt;&lt; pool_z_step;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    }</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">case</span> 27: {</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      *component_type = <span class="stringliteral">&quot;ConstantFunctionComponent&quot;</span>;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50), output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <span class="keywordtype">bool</span> is_updatable = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0),</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          use_natural_gradient =  (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; is-updatable=&quot;</span> &lt;&lt; std::boolalpha &lt;&lt; is_updatable</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; use-natural-gradient=&quot;</span> &lt;&lt; std::boolalpha &lt;&lt; use_natural_gradient;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    }</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="keywordflow">case</span> 28: {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      *component_type = <span class="stringliteral">&quot;ClipGradientComponent&quot;</span>;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot; clipping-threshold=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50)</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; norm-based-clipping=&quot;</span> &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? <span class="stringliteral">&quot;false&quot;</span> : <span class="stringliteral">&quot;true&quot;</span>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 1)</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot; self-repair-scale=&quot;</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;           &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? 0 : <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50));</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 1)</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot; self-repair-clipped-proportion-threshold=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>();</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 1)</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot; self-repair-target=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>();</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    }</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keywordflow">case</span> 29: {</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      *component_type = <span class="stringliteral">&quot;DropoutComponent&quot;</span>;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <span class="keywordtype">bool</span> test_mode = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 200)</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; dropout-proportion=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>() &lt;&lt; <span class="stringliteral">&quot; test-mode=&quot;</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;         &lt;&lt; (test_mode ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    }</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordflow">case</span> 30: {</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      *component_type = <span class="stringliteral">&quot;LstmNonlinearityComponent&quot;</span>;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      <span class="comment">// set self-repair scale to zero so the derivative tests will pass.</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;cell-dim=&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 200)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; self-repair-scale=0.0&quot;</span>;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    }</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="comment">// I think we&#39;ll get in the habit of allocating a larger number of case</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="comment">// labels to the most recently added component, so it gets tested more</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="keywordflow">case</span> 31: {</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      *component_type = <span class="stringliteral">&quot;BatchNormComponent&quot;</span>;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      int32 block_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 20), dim = block_dim * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 2);</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <span class="keywordtype">bool</span> test_mode = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot; dim=&quot;</span> &lt;&lt; dim</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; block-dim=&quot;</span> &lt;&lt; block_dim &lt;&lt; <span class="stringliteral">&quot; target-rms=&quot;</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;         &lt;&lt; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 4) &lt;&lt; <span class="stringliteral">&quot; test-mode=&quot;</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;         &lt;&lt; (test_mode ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>)</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; epsilon=&quot;</span> &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? <span class="stringliteral">&quot;0.1&quot;</span> : <span class="stringliteral">&quot;1.0&quot;</span>);</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    }</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">case</span> 32: {</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      *component_type = <span class="stringliteral">&quot;SumBlockComponent&quot;</span>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale = 0.5 * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3);</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10),</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;          input_dim = output_dim * <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3);</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; scale=&quot;</span> &lt;&lt; scale;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    }</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keywordflow">case</span> 33: {</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      *component_type = <span class="stringliteral">&quot;ScaleAndOffsetComponent&quot;</span>;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      int32 block_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(10, 20),</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;          num_blocks = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;          dim = block_dim * num_blocks;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; dim &lt;&lt; <span class="stringliteral">&quot; block-dim=&quot;</span> &lt;&lt; block_dim</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; use-natural-gradient=&quot;</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;         &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0,1) == 0 ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    }</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="keywordflow">case</span> 34: {</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      *component_type = <span class="stringliteral">&quot;LinearComponent&quot;</span>;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;      int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50), output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    }</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">case</span> 35: {</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      <span class="comment">// This is not technically a SimpleComponent, but it behaves as one</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="comment">// if time-offsets=0.</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      *component_type = <span class="stringliteral">&quot;TdnnComponent&quot;</span>;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      int32 input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50), output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 50);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;input-dim=&quot;</span> &lt;&lt; input_dim &lt;&lt; <span class="stringliteral">&quot; output-dim=&quot;</span> &lt;&lt; output_dim</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; learning-rate=&quot;</span> &lt;&lt; learning_rate &lt;&lt; <span class="stringliteral">&quot; time-offsets=0&quot;</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; use-natural-gradient=&quot;</span> &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0,1) == 0 ? <span class="stringliteral">&quot;true&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>)</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; use-bias=&quot;</span> &lt;&lt; (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0,1) == 0 ? <span class="stringliteral">&quot;true&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    }</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Error generating random component&quot;</span>;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  *config = os.str();</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a0c4bcfc10bea5ed0d3e3cf6d74922121"><div class="ttname"><a href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">kaldi::RandUniform</a></div><div class="ttdeci">float RandUniform(struct RandomState *state=NULL)</div><div class="ttdoc">Returns a random number strictly between 0 and 1. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00151">kaldi-math.h:151</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3dccdf514f810b334ee5baa954eb88f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dccdf514f810b334ee5baa954eb88f8">&#9670;&nbsp;</a></span>GenerateRandomSimpleComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> * GenerateRandomSimpleComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates random simple component for testing. </p>

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01767">1767</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8cc_source.html#l01400">GenerateRandomComponentConfig()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00198">ConfigLine::HasUnusedValues()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a1f7dc9cc61293d3c7decb5bd8ea3f4d5">Component::InitFromConfig()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00095">Component::NewComponentOfType()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00031">ConfigLine::ParseLine()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00206">ConfigLine::UnusedValues()</a>, and <a class="el" href="nnet-parse_8h_source.html#l00073">ConfigLine::WholeLine()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8h_source.html#l00048">NnetGenerationOptions::NnetGenerationOptions()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                                           {</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  std::string component_type, config;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#afb5a70eadfcda218c3833859bf7ceb27">GenerateRandomComponentConfig</a>(&amp;component_type, &amp;config);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  ConfigLine config_line;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keywordflow">if</span> (!config_line.ParseLine(config))</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad config line &quot;</span> &lt;&lt; config;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  Component *c = Component::NewComponentOfType(component_type);</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="keywordflow">if</span> (c == NULL)</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Invalid component type &quot;</span> &lt;&lt; component_type;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  c-&gt;InitFromConfig(&amp;config_line);</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  <span class="keywordflow">if</span> (config_line.HasUnusedValues()) {</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Config line &quot;</span> &lt;&lt; config_line.WholeLine()</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; has unused values: &quot;</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;              &lt;&lt; config_line.UnusedValues();</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  }</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="keywordflow">return</span> c;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_afb5a70eadfcda218c3833859bf7ceb27"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#afb5a70eadfcda218c3833859bf7ceb27">kaldi::nnet3::GenerateRandomComponentConfig</a></div><div class="ttdeci">static void GenerateRandomComponentConfig(std::string *component_type, std::string *config)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01400">nnet-test-utils.cc:1400</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8263b0802f12a823d6c072b53c4ee236"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8263b0802f12a823d6c072b53c4ee236">&#9670;&nbsp;</a></span>GenerateSimpleNnetTrainingExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GenerateSimpleNnetTrainingExample </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_supervised_frames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>left_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>right_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>output_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>ivector_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>example</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Low-level function that generates an nnet training example. </p>
<p>By "simple" we mean there is one output named "output", an input named "input", and possibly also an input named "ivector" (this will be assumed absent if ivector_dim &lt;= 0). This function generates exactly "left_context" or "right_context" frames of context on the left and right respectively. </p>

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01816">1816</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="sparse-matrix_8cc_source.html#l00802">GeneralMatrix::Compress()</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00046">NnetIo::features</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="kaldi-math_8h_source.html#l00151">kaldi::RandUniform()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8h_source.html#l00048">NnetGenerationOptions::NnetGenerationOptions()</a>, <a class="el" href="nnet-example-test_8cc_source.html#l00035">UnitTestNnetExample()</a>, and <a class="el" href="nnet-example-test_8cc_source.html#l00067">UnitTestNnetMergeExamples()</a>.</p>
<div class="fragment"><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                          {</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_supervised_frames &gt; 0 &amp;&amp; left_context &gt;= 0 &amp;&amp;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;               right_context &gt;= 0 &amp;&amp; output_dim &gt; 0 &amp;&amp; input_dim &gt; 0</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;               &amp;&amp; example != NULL);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  example-&gt;io.clear();</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  int32 feature_t_begin = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 2);</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  int32 num_feat_frames = left_context + right_context + num_supervised_frames;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  Matrix&lt;BaseFloat&gt; input_mat(num_feat_frames, input_dim);</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  input_mat.SetRandn();</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  NnetIo input_feat(<span class="stringliteral">&quot;input&quot;</span>, feature_t_begin, input_mat);</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    input_feat.features.Compress();</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  example-&gt;io.push_back(input_feat);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  <span class="keywordflow">if</span> (ivector_dim &gt; 0) {</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="comment">// Create a feature for the iVectors.  iVectors always have t=0 in the</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="comment">// current framework.</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    Matrix&lt;BaseFloat&gt; ivector_mat(1, ivector_dim);</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    ivector_mat.SetRandn();</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    NnetIo ivector_feat(<span class="stringliteral">&quot;ivector&quot;</span>, 0, ivector_mat);</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      ivector_feat.features.Compress();</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    example-&gt;io.push_back(ivector_feat);</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  }</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  {  <span class="comment">// set up the output supervision.</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <a class="code" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> labels(num_supervised_frames);</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="keywordflow">for</span> (int32 t = 0; t &lt; num_supervised_frames; t++) {</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      int32 num_labels = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3);</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> remaining_prob_mass = 1.0;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_labels; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> this_prob = (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 == num_labels ? 1.0 : <a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>()) *</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;            remaining_prob_mass;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        remaining_prob_mass -= this_prob;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        labels[t].push_back(std::pair&lt;int32, BaseFloat&gt;(<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, output_dim-1),</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                                                        this_prob));</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      }</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    int32 supervision_t_begin = feature_t_begin + left_context;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    NnetIo output_sup(<span class="stringliteral">&quot;output&quot;</span>, output_dim, supervision_t_begin,</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                      labels);</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    example-&gt;io.push_back(output_sup);</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  }</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a0c4bcfc10bea5ed0d3e3cf6d74922121"><div class="ttname"><a href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">kaldi::RandUniform</a></div><div class="ttdeci">float RandUniform(struct RandomState *state=NULL)</div><div class="ttdoc">Returns a random number strictly between 0 and 1. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00151">kaldi-math.h:151</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__posterior__group_html_ga5c99e6141a5a3b3c5d424e99ffbd1ac6"><div class="ttname"><a href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">kaldi::Posterior</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, BaseFloat &gt; &gt; &gt; Posterior</div><div class="ttdoc">Posterior is a typedef for storing acoustic-state (actually, transition-id) posteriors over an uttera...</div><div class="ttdef"><b>Definition:</b> <a href="posterior_8h_source.html#l00043">posterior.h:43</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2465e8e47256304999d4cd892e7162b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2465e8e47256304999d4cd892e7162b9">&#9670;&nbsp;</a></span>GenRandDescriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::GenRandDescriptor </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_nodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> *&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor-test_8cc_source.html#l00076">76</a> of file <a class="el" href="nnet-descriptor-test_8cc_source.html">nnet-descriptor-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-descriptor-test_8cc_source.html#l00057">GenRandSumDescriptor()</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00089">UnitTestDescriptorIo()</a>, and <a class="el" href="nnet-descriptor-test_8cc_source.html#l00135">UnitTestGeneralDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                         {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  int32 num_parts = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  std::vector&lt;SumDescriptor*&gt; parts;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">for</span> (int32 part = 0; part &lt; num_parts; part++)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    parts.push_back(<a class="code" href="namespacekaldi_1_1nnet3.html#ae9b08e079998e1eea6db1c2b5a403a28">GenRandSumDescriptor</a>(num_nodes));</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  *desc = <a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a>(parts);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html">kaldi::nnet3::Descriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00525">nnet-descriptor.h:525</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae9b08e079998e1eea6db1c2b5a403a28"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae9b08e079998e1eea6db1c2b5a403a28">kaldi::nnet3::GenRandSumDescriptor</a></div><div class="ttdeci">SumDescriptor * GenRandSumDescriptor(int32 num_nodes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor-test_8cc_source.html#l00057">nnet-descriptor-test.cc:57</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afdefaf0453649dae0c96bf6cd516bd69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdefaf0453649dae0c96bf6cd516bd69">&#9670;&nbsp;</a></span>GenRandForwardingDescriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1ForwardingDescriptor.html">ForwardingDescriptor</a>* kaldi::nnet3::GenRandForwardingDescriptor </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_nodes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor-test_8cc_source.html#l00025">25</a> of file <a class="el" href="nnet-descriptor-test_8cc_source.html">nnet-descriptor-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-descriptor_8h_source.html#l00275">ReplaceIndexForwardingDescriptor::kT</a>, <a class="el" href="nnet-descriptor_8h_source.html#l00275">ReplaceIndexForwardingDescriptor::kX</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00057">GenRandSumDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;                                                                   {</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 != 0) {</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1SimpleForwardingDescriptor.html">SimpleForwardingDescriptor</a>(<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % num_nodes);</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    int32 r = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">if</span> (r == 0) {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> offset;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      offset.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      offset.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">x</a> = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;          <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1OffsetForwardingDescriptor.html">OffsetForwardingDescriptor</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">GenRandForwardingDescriptor</a>(num_nodes),</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                                         offset);</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == 1) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      std::vector&lt;ForwardingDescriptor*&gt; vec;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        vec.push_back(<a class="code" href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">GenRandForwardingDescriptor</a>(num_nodes));</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1SwitchingForwardingDescriptor.html">SwitchingForwardingDescriptor</a>(vec);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == 2) {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1RoundingForwardingDescriptor.html">RoundingForwardingDescriptor</a>(</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">GenRandForwardingDescriptor</a>(num_nodes), 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1ReplaceIndexForwardingDescriptor.html">ReplaceIndexForwardingDescriptor</a>(</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">GenRandForwardingDescriptor</a>(num_nodes),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;          (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0 ? ReplaceIndexForwardingDescriptor::kT :</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;           ReplaceIndexForwardingDescriptor::kX),</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;          -2 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1SimpleForwardingDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1SimpleForwardingDescriptor.html">kaldi::nnet3::SimpleForwardingDescriptor</a></div><div class="ttdoc">SimpleForwardingDescriptor is the base-case of ForwardingDescriptor, consisting of a source node in t...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00144">nnet-descriptor.h:144</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_afdefaf0453649dae0c96bf6cd516bd69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">kaldi::nnet3::GenRandForwardingDescriptor</a></div><div class="ttdeci">ForwardingDescriptor * GenRandForwardingDescriptor(int32 num_nodes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor-test_8cc_source.html#l00025">nnet-descriptor-test.cc:25</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1RoundingForwardingDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1RoundingForwardingDescriptor.html">kaldi::nnet3::RoundingForwardingDescriptor</a></div><div class="ttdoc">For use in clockwork RNNs and the like, this forwarding-descriptor rounds the time-index t down to th...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00242">nnet-descriptor.h:242</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html">kaldi::nnet3::Index</a></div><div class="ttdoc">struct Index is intended to represent the various indexes by which we number the rows of the matrices...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00044">nnet-common.h:44</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_aade28f62e276833462f1b79c4e41ec7e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">kaldi::nnet3::Index::x</a></div><div class="ttdeci">int32 x</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00047">nnet-common.h:47</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1SwitchingForwardingDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1SwitchingForwardingDescriptor.html">kaldi::nnet3::SwitchingForwardingDescriptor</a></div><div class="ttdoc">Chooses from different inputs based on the the time index modulo (the number of ForwardingDescriptors...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00210">nnet-descriptor.h:210</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1OffsetForwardingDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OffsetForwardingDescriptor.html">kaldi::nnet3::OffsetForwardingDescriptor</a></div><div class="ttdoc">Offsets in &amp;#39;t&amp;#39; and &amp;#39;x&amp;#39; values of other ForwardingDescriptors. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00175">nnet-descriptor.h:175</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ReplaceIndexForwardingDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ReplaceIndexForwardingDescriptor.html">kaldi::nnet3::ReplaceIndexForwardingDescriptor</a></div><div class="ttdoc">This ForwardingDescriptor modifies the indexes (n, t, x) by replacing one of them (normally t) with a...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00273">nnet-descriptor.h:273</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_a5aa18a99c28265c00e81554208124038"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">kaldi::nnet3::Index::t</a></div><div class="ttdeci">int32 t</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00046">nnet-common.h:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae9b08e079998e1eea6db1c2b5a403a28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9b08e079998e1eea6db1c2b5a403a28">&#9670;&nbsp;</a></span>GenRandSumDescriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1SumDescriptor.html">SumDescriptor</a>* kaldi::nnet3::GenRandSumDescriptor </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_nodes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor-test_8cc_source.html#l00057">57</a> of file <a class="el" href="nnet-descriptor-test_8cc_source.html">nnet-descriptor-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-descriptor-test_8cc_source.html#l00025">GenRandForwardingDescriptor()</a>, <a class="el" href="nnet-descriptor_8h_source.html#l00491">BinarySumDescriptor::kFailoverOperation</a>, <a class="el" href="nnet-descriptor_8h_source.html#l00490">BinarySumDescriptor::kSumOperation</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00076">GenRandDescriptor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                     {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 != 0) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">bool</span> not_required = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5 == 0);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span> (not_required)</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1OptionalSumDescriptor.html">OptionalSumDescriptor</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#ae9b08e079998e1eea6db1c2b5a403a28">GenRandSumDescriptor</a>(num_nodes));</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1SimpleSumDescriptor.html">SimpleSumDescriptor</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">GenRandForwardingDescriptor</a>(num_nodes));</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet3_1_1BinarySumDescriptor.html">BinarySumDescriptor</a>(</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0 ? BinarySumDescriptor::kSumOperation:</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;         BinarySumDescriptor::kFailoverOperation),</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#ae9b08e079998e1eea6db1c2b5a403a28">GenRandSumDescriptor</a>(num_nodes),</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#ae9b08e079998e1eea6db1c2b5a403a28">GenRandSumDescriptor</a>(num_nodes));</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1OptionalSumDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OptionalSumDescriptor.html">kaldi::nnet3::OptionalSumDescriptor</a></div><div class="ttdoc">This is the case of class SumDescriptor, in which we contain just one term, and that term is optional...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00383">nnet-descriptor.h:383</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1BinarySumDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1BinarySumDescriptor.html">kaldi::nnet3::BinarySumDescriptor</a></div><div class="ttdoc">BinarySumDescriptor can represent either A + B, or (A if defined, else B). </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00487">nnet-descriptor.h:487</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_afdefaf0453649dae0c96bf6cd516bd69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#afdefaf0453649dae0c96bf6cd516bd69">kaldi::nnet3::GenRandForwardingDescriptor</a></div><div class="ttdeci">ForwardingDescriptor * GenRandForwardingDescriptor(int32 num_nodes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor-test_8cc_source.html#l00025">nnet-descriptor-test.cc:25</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1SimpleSumDescriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1SimpleSumDescriptor.html">kaldi::nnet3::SimpleSumDescriptor</a></div><div class="ttdoc">This is the normal base-case of SumDescriptor which just wraps a ForwardingDescriptor. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00416">nnet-descriptor.h:416</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae9b08e079998e1eea6db1c2b5a403a28"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae9b08e079998e1eea6db1c2b5a403a28">kaldi::nnet3::GenRandSumDescriptor</a></div><div class="ttdeci">SumDescriptor * GenRandSumDescriptor(int32 num_nodes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor-test_8cc_source.html#l00057">nnet-descriptor-test.cc:57</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc0bb79239b07e7a8b8c26abbf05657b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc0bb79239b07e7a8b8c26abbf05657b">&#9670;&nbsp;</a></span>GetChainComputationRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetChainComputationRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>need_model_derivative</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>store_component_stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>use_xent_regularization</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>use_xent_derivative</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>computation_request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes a <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html" title="NnetChainExample is like NnetExample, but specialized for lattice-free (chain) training. ">NnetChainExample</a> and produces a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>. </p>
<p>Assumes you don't want the derivatives w.r.t. the inputs; if you do, you can create the <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> manually. Assumes that if need_model_derivative is true, you will be supplying derivatives w.r.t. all outputs.</p>
<p>If use_xent_regularization == true, then it assumes that for each output name (e.g. "output" in the eg, there is another output with the same dimension and with the suffix "-xent" on its name, e.g. named "output-xent". The derivative w.r.t. the xent objective will only be supplied to the nnet computation if 'use_xent_derivative' is true (we propagate back the xent derivative to the model only in training, not in model-combination in nnet3-chain-combine). </p>

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8cc_source.html#l00290">290</a> of file <a class="el" href="nnet-chain-example_8cc_source.html">nnet-chain-example.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00466">Nnet::GetNodeIndex()</a>, <a class="el" href="nnet-computation_8h_source.html#l00075">IoSpecification::has_deriv</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00060">NnetChainSupervision::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00074">IoSpecification::indexes</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00115">NnetChainExample::inputs</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00120">Nnet::IsInputNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00046">NnetChainSupervision::name</a>, <a class="el" href="nnet-computation_8h_source.html#l00073">IoSpecification::name</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00119">NnetChainExample::outputs</a>, and <a class="el" href="nnet-computation_8h_source.html#l00126">ComputationRequest::store_component_stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00088">NnetChainComputeProb::Compute()</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00156">NnetChainExampleStructureCompare::operator()()</a>, and <a class="el" href="nnet-chain-training_8cc_source.html#l00062">NnetChainTrainer::Train()</a>.</p>
<div class="fragment"><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                                             {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  request-&gt;inputs.clear();</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  request-&gt;inputs.reserve(eg.inputs.size());</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  request-&gt;outputs.clear();</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  request-&gt;outputs.reserve(eg.outputs.size() * 2);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  request-&gt;need_model_derivative = need_model_derivative;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  request-&gt;store_component_stats = store_component_stats;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg.inputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keyword">const</span> NnetIo &amp;io = eg.inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keyword">const</span> std::string &amp;name = io.name;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    int32 node_index = nnet.GetNodeIndex(name);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (node_index == -1 ||</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        !nnet.IsInputNode(node_index))</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Nnet example has input named &#39;&quot;</span> &lt;&lt; name</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;&#39;, but no such input node is in the network.&quot;</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    request-&gt;inputs.resize(request-&gt;inputs.size() + 1);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    IoSpecification &amp;io_spec = request-&gt;inputs.back();</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    io_spec.name = name;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    io_spec.indexes = io.indexes;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    io_spec.has_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg.outputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// there will normally be exactly one output , named &quot;output&quot;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keyword">const</span> NnetChainSupervision &amp;sup = eg.outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keyword">const</span> std::string &amp;name = sup.name;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    int32 node_index = nnet.GetNodeIndex(name);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">if</span> (node_index == -1 &amp;&amp;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        !nnet.IsOutputNode(node_index))</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Nnet example has output named &#39;&quot;</span> &lt;&lt; name</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;&#39;, but no such output node is in the network.&quot;</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    request-&gt;outputs.resize(request-&gt;outputs.size() + 1);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    IoSpecification &amp;io_spec = request-&gt;outputs.back();</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    io_spec.name = name;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    io_spec.indexes = sup.indexes;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    io_spec.has_deriv = need_model_derivative;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">if</span> (use_xent_regularization) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordtype">size_t</span> cur_size = request-&gt;outputs.size();</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      request-&gt;outputs.resize(cur_size + 1);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      IoSpecification &amp;io_spec = request-&gt;outputs[cur_size - 1],</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          &amp;io_spec_xent = request-&gt;outputs[cur_size];</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="comment">// the IoSpecification for the -xent output is the same</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="comment">// as for the regular output, except for its name which has</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="comment">// the -xent suffix (and the has_deriv member may differ).</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      io_spec_xent = io_spec;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      io_spec_xent.name = name + <span class="stringliteral">&quot;-xent&quot;</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      io_spec_xent.has_deriv = use_xent_derivative;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// check to see if something went wrong.</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">if</span> (request-&gt;inputs.empty())</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No inputs in computation request.&quot;</span>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">if</span> (request-&gt;outputs.empty())</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No outputs in computation request.&quot;</span>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abe23a2ca349827db2a73933ee42d208d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe23a2ca349827db2a73933ee42d208d">&#9670;&nbsp;</a></span>GetChainNnetExampleSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::GetChainNnetExampleSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &amp;&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the 'size' of a chain example as defined for purposes of merging egs, which is defined as the largest number of Indexes in any of the inputs or outputs of the example. </p>

</div>
</div>
<a id="a50c94226ad499267fedd4630bd2b5516"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50c94226ad499267fedd4630bd2b5516">&#9670;&nbsp;</a></span>GetChunkSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 GetChunkSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_subsampling_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>advised_chunk_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00081">81</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00658">Nnet::Modulus()</a>.</p>

<p class="reference">Referenced by <a class="el" href="decodable-simple-looped_8cc_source.html#l00056">DecodableNnetSimpleLoopedInfo::Init()</a>, and <a class="el" href="nnet-compile-test_8cc_source.html#l00120">UnitTestNnetCompileLooped()</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                             {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  int32 modulus = nnet.Modulus();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(modulus &gt; 0 &amp;&amp; frame_subsampling_factor &gt; 0 &amp;&amp;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;               advised_chunk_size &gt; 0);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  int32 chunk_size = advised_chunk_size;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span> (chunk_size % modulus == 0 &amp;&amp;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        chunk_size % frame_subsampling_factor == 0)</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keywordflow">return</span> chunk_size;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    chunk_size++;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0a04e946fa68432f4e723944ce8ab281"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a04e946fa68432f4e723944ce8ab281">&#9670;&nbsp;</a></span>GetCommandsOfType()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetCommandsOfType </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352">CommandType</a>&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>command_indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This utility function works out from a computation, the command-indexes of the commands of the given type. </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l01429">1429</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l04070">ComputationLoopedOptimizer::FindTimeShift()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l04473">ComputationLoopedOptimizer::Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                                                          {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  int32 num_commands = computation.commands.size();</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  command_indexes-&gt;clear();</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_commands; c++)</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordflow">if</span> (computation.commands[c].command_type == t)</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      command_indexes-&gt;push_back(c);</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a66f879097cf9cba7482bad03a4030f72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66f879097cf9cba7482bad03a4030f72">&#9670;&nbsp;</a></span>GetComputationRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetComputationRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>need_model_derivative</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>store_component_stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>computation_request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes a <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> (which should already have been frame-selected, if desired, and merged into a minibatch) and produces a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>. </p>
<p>It assumes you don't want the derivatives w.r.t. the inputs; if you do, you can create/modify the <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> manually. Assumes that if need_model_derivative is true, you will be supplying derivatives w.r.t. all outputs. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00202">202</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00466">Nnet::GetNodeIndex()</a>, <a class="el" href="nnet-computation_8h_source.html#l00075">IoSpecification::has_deriv</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00074">IoSpecification::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00120">Nnet::IsInputNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>, <a class="el" href="nnet-computation_8h_source.html#l00073">IoSpecification::name</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, and <a class="el" href="nnet-computation_8h_source.html#l00126">ComputationRequest::store_component_stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-acc-lda-stats_8cc_source.html#l00038">NnetLdaStatsAccumulator::AccStats()</a>, <a class="el" href="nnet3-compute-from-egs_8cc_source.html#l00041">NnetComputerFromEg::Compute()</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00079">NnetComputeProb::Compute()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00059">NnetTrainer::Train()</a>.</p>
<div class="fragment"><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                                        {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  request-&gt;inputs.clear();</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  request-&gt;inputs.reserve(eg.io.size());</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  request-&gt;outputs.clear();</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  request-&gt;outputs.reserve(eg.io.size());</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  request-&gt;need_model_derivative = need_model_derivative;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  request-&gt;store_component_stats = store_component_stats;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg.io.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keyword">const</span> NnetIo &amp;io = eg.io[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">const</span> std::string &amp;name = io.name;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    int32 node_index = nnet.GetNodeIndex(name);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">if</span> (node_index == -1 &amp;&amp;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        !nnet.IsInputNode(node_index) &amp;&amp; !nnet.IsOutputNode(node_index))</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Nnet example has input or output named &#39;&quot;</span> &lt;&lt; name</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;&#39;, but no such input or output node is in the network.&quot;</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    std::vector&lt;IoSpecification&gt; &amp;dest =</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        nnet.IsInputNode(node_index) ? request-&gt;inputs : request-&gt;outputs;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    dest.resize(dest.size() + 1);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    IoSpecification &amp;io_spec = dest.back();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    io_spec.name = name;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    io_spec.indexes = io.indexes;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    io_spec.has_deriv = nnet.IsOutputNode(node_index) &amp;&amp; need_model_derivative;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">// check to see if something went wrong.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span> (request-&gt;inputs.empty())</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No inputs in computation request.&quot;</span>;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">if</span> (request-&gt;outputs.empty())</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No outputs in computation request.&quot;</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a270955c18c82f5de1e707ec094998283"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a270955c18c82f5de1e707ec094998283">&#9670;&nbsp;</a></span>GetCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::GetCount </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>expected_count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-copy-egs_8cc_source.html#l00066">66</a> of file <a class="el" href="nnet3-copy-egs_8cc_source.html">nnet3-copy-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00071">kaldi::WithProb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-copy-egs_8cc_source.html#l00290">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                      {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(expected_count &gt;= 0.0);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  int32 ans = floor(expected_count);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  expected_count -= ans;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a418c782c2df97dc179125ae5ad950338">WithProb</a>(expected_count))</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    ans++;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a418c782c2df97dc179125ae5ad950338"><div class="ttname"><a href="namespacekaldi.html#a418c782c2df97dc179125ae5ad950338">kaldi::WithProb</a></div><div class="ttdeci">bool WithProb(BaseFloat prob, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00071">kaldi-math.cc:71</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ba3000fa54c53ed52e22225edbc7c94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ba3000fa54c53ed52e22225edbc7c94">&#9670;&nbsp;</a></span>GetDiscriminativeComputationRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetDiscriminativeComputationRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>need_model_derivative</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>store_component_stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>use_xent_regularization</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>use_xent_derivative</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>computation_request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes a <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html" title="NnetDiscriminativeExample is like NnetExample, but specialized for sequence training. ">NnetDiscriminativeExample</a> and produces a <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>. </p>
<p>Assumes you don't want the derivatives w.r.t. the inputs; if you do, you can create the <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> manually. Assumes that if need_model_derivative is true, you will be supplying derivatives w.r.t. all outputs. </p>

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8cc_source.html#l00284">284</a> of file <a class="el" href="nnet-discriminative-example_8cc_source.html">nnet-discriminative-example.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00466">Nnet::GetNodeIndex()</a>, <a class="el" href="nnet-computation_8h_source.html#l00075">IoSpecification::has_deriv</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00054">NnetDiscriminativeSupervision::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00074">IoSpecification::indexes</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00108">NnetDiscriminativeExample::inputs</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00120">Nnet::IsInputNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00045">NnetDiscriminativeSupervision::name</a>, <a class="el" href="nnet-computation_8h_source.html#l00073">IoSpecification::name</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00112">NnetDiscriminativeExample::outputs</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, and <a class="el" href="nnet-computation_8h_source.html#l00126">ComputationRequest::store_component_stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-diagnostics_8cc_source.html#l00069">NnetDiscriminativeComputeObjf::Compute()</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00151">NnetDiscriminativeExampleStructureCompare::operator()()</a>, and <a class="el" href="nnet-discriminative-training_8cc_source.html#l00063">NnetDiscriminativeTrainer::Train()</a>.</p>
<div class="fragment"><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                                                      {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  request-&gt;inputs.clear();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  request-&gt;inputs.reserve(eg.inputs.size());</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  request-&gt;outputs.clear();</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  request-&gt;outputs.reserve(eg.outputs.size());</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  request-&gt;need_model_derivative = need_model_derivative;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  request-&gt;store_component_stats = store_component_stats;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg.inputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keyword">const</span> NnetIo &amp;io = eg.inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keyword">const</span> std::string &amp;name = io.name;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    int32 node_index = nnet.GetNodeIndex(name);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (node_index == -1 &amp;&amp;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        !nnet.IsInputNode(node_index))</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Nnet example has input named &#39;&quot;</span> &lt;&lt; name</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;&#39;, but no such input node is in the network.&quot;</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    request-&gt;inputs.resize(request-&gt;inputs.size() + 1);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    IoSpecification &amp;io_spec = request-&gt;inputs.back();</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    io_spec.name = name;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    io_spec.indexes = io.indexes;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    io_spec.has_deriv = <span class="keyword">false</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  }</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg.outputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// there will normally be exactly one output , named &quot;output&quot;</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keyword">const</span> NnetDiscriminativeSupervision &amp;sup = eg.outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keyword">const</span> std::string &amp;name = sup.name;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    int32 node_index = nnet.GetNodeIndex(name);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (node_index == -1 &amp;&amp;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        !nnet.IsOutputNode(node_index))</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Nnet example has output named &#39;&quot;</span> &lt;&lt; name</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;&#39;, but no such output node is in the network.&quot;</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    request-&gt;outputs.resize(request-&gt;outputs.size() + 1);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    IoSpecification &amp;io_spec = request-&gt;outputs.back();</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    io_spec.name = name;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    io_spec.indexes = sup.indexes;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    io_spec.has_deriv = need_model_derivative;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span> (use_xent_regularization) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordtype">size_t</span> cur_size = request-&gt;outputs.size();</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      request-&gt;outputs.resize(cur_size + 1);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      IoSpecification &amp;io_spec = request-&gt;outputs[cur_size - 1],</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          &amp;io_spec_xent = request-&gt;outputs[cur_size];</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="comment">// the IoSpecification for the -xent output is the same</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="comment">// as for the regular output, except for its name which has</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="comment">// the -xent suffix (and the has_deriv member may differ).</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      io_spec_xent = io_spec;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      io_spec_xent.name = name + <span class="stringliteral">&quot;-xent&quot;</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      io_spec_xent.has_deriv = use_xent_derivative;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">// check to see if something went wrong.</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (request-&gt;inputs.empty())</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No inputs in computation request.&quot;</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">if</span> (request-&gt;outputs.empty())</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No outputs in computation request.&quot;</span>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aacd1505cb6a2a191d0e2cccdb57e90fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacd1505cb6a2a191d0e2cccdb57e90fa">&#9670;&nbsp;</a></span>GetDiscriminativeNnetExampleSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::GetDiscriminativeNnetExampleSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &amp;&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the 'size' of a discriminative example as defined for purposes of merging egs, which is defined as the largest number of Indexes in any of the inputs or outputs of the example. </p>

</div>
</div>
<a id="a2e3228381d1a400e113f12dffce84ec0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e3228381d1a400e113f12dffce84ec0">&#9670;&nbsp;</a></span>GetIndexesMultiStrings()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::GetIndexesMultiStrings </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>indexes_multi_strings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation_8cc_source.html#l00462">462</a> of file <a class="el" href="nnet-computation_8cc_source.html">nnet-computation.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00327">NnetComputation::SubMatrixInfo::col_offset</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00425">NnetComputation::indexes_multi</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00324">NnetComputation::SubMatrixInfo::matrix_index</a>, <a class="el" href="nnet-computation_8h_source.html#l00306">NnetComputation::MatrixInfo::num_cols</a>, <a class="el" href="nnet-computation_8h_source.html#l00328">NnetComputation::SubMatrixInfo::num_cols</a>, <a class="el" href="nnet-computation_8h_source.html#l00305">NnetComputation::MatrixInfo::num_rows</a>, <a class="el" href="nnet-computation_8h_source.html#l00326">NnetComputation::SubMatrixInfo::num_rows</a>, <a class="el" href="nnet-computation_8h_source.html#l00325">NnetComputation::SubMatrixInfo::row_offset</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8cc_source.html#l00944">NnetComputation::GetCommandStrings()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>.</p>
<div class="fragment"><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                                                 {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  int32 indexes_multi_size = computation.indexes_multi.size();</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  indexes_multi_strings-&gt;resize(indexes_multi_size);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; indexes_multi_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;vec =</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        computation.indexes_multi[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    int32 size = vec.size();</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; size; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      int32 submat_index = vec[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].first, row_index = vec[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].second;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keywordflow">if</span> (submat_index == -1) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;NULL&quot;</span>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keyword">const</span> NnetComputation::SubMatrixInfo &amp;submat =</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            computation.submatrices[submat_index];</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keyword">const</span> NnetComputation::MatrixInfo &amp;mat =</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            computation.matrices[submat.matrix_index];</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        int32 row = row_index + submat.row_offset;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        int32 col_start = submat.col_offset,</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            col_end = col_start + submat.num_cols;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">if</span> (!(row_index &lt; submat.num_rows &amp;&amp;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;              row &lt; mat.num_rows)) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Invalid indexes in indexes-multi[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;: submatrix &quot;</span> &lt;&lt; submat_index &lt;&lt; <span class="stringliteral">&quot; = m&quot;</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                     &lt;&lt; submat.matrix_index &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; submat.row_offset</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                     &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; (submat.row_offset + submat.num_rows - 1)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                     &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; submat.col_offset &lt;&lt; <span class="charliteral">&#39;:&#39;</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                     &lt;&lt; (submat.col_offset + submat.num_cols - 1) &lt;&lt; <span class="stringliteral">&quot;) has &quot;</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                     &lt;&lt; submat.num_rows &lt;&lt; <span class="stringliteral">&quot; rows, but you access row &quot;</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                     &lt;&lt; row_index;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordflow">if</span> (col_start == 0 &amp;&amp; col_end == mat.num_cols)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          os &lt;&lt; <span class="charliteral">&#39;m&#39;</span> &lt;&lt; submat.matrix_index &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; row &lt;&lt; <span class="stringliteral">&quot;,:)&quot;</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          os &lt;&lt; <span class="charliteral">&#39;m&#39;</span> &lt;&lt; submat.matrix_index &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; row &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; col_start</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;             &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; (col_end - 1) &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> + 1 &lt; size) os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    (*indexes_multi_strings)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = os.str();</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a69c7aa23d0e3d87413ce4de4be66f7a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69c7aa23d0e3d87413ce4de4be66f7a6">&#9670;&nbsp;</a></span>GetIndexesStrings()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::GetIndexesStrings </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>indexes_strings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation_8cc_source.html#l00448">448</a> of file <a class="el" href="nnet-computation_8cc_source.html">nnet-computation.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00419">NnetComputation::indexes</a>, and <a class="el" href="nnet-common_8cc_source.html#l00525">PrintIntegerVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8cc_source.html#l00944">NnetComputation::GetCommandStrings()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>.</p>
<div class="fragment"><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                                                                     {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  int32 size = computation.indexes.size();</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  indexes_strings-&gt;resize(size);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a91ad7b2e440d9b50c196a361f559a427">PrintIntegerVector</a>(os, computation.indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    (*indexes_strings)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = os.str();</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a91ad7b2e440d9b50c196a361f559a427"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a91ad7b2e440d9b50c196a361f559a427">kaldi::nnet3::PrintIntegerVector</a></div><div class="ttdeci">void PrintIntegerVector(std::ostream &amp;os, const std::vector&lt; int32 &gt; &amp;ints)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00525">nnet-common.cc:525</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2f2093173e902d1445fcd80def82ea4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f2093173e902d1445fcd80def82ea4b">&#9670;&nbsp;</a></span>GetIoNames()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::GetIoNames </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>names_vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00034">34</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="stl-utils_8h_source.html#l00086">kaldi::CopySetToVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-utils_8cc_source.html#l00162">MergeExamples()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                                             {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  std::set&lt;std::string&gt; names;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  std::vector&lt;NnetExample&gt;::const_iterator iter = src.begin(), end = src.end();</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    std::vector&lt;NnetIo&gt;::const_iterator iter2 = iter-&gt;io.begin(),</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                         end2 = iter-&gt;io.end();</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">for</span> (; iter2 != end2; ++iter2)</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      names.insert(iter2-&gt;name);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="namespacekaldi.html#afaa2d6854352e931e19778f6f8608f2a">CopySetToVector</a>(names, names_vec);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_afaa2d6854352e931e19778f6f8608f2a"><div class="ttname"><a href="namespacekaldi.html#afaa2d6854352e931e19778f6f8608f2a">kaldi::CopySetToVector</a></div><div class="ttdeci">void CopySetToVector(const std::set&lt; T &gt; &amp;s, std::vector&lt; T &gt; *v)</div><div class="ttdoc">Copies the elements of a set to a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00086">stl-utils.h:86</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9cffcda7d561b7a342c1e268364e7583"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cffcda7d561b7a342c1e268364e7583">&#9670;&nbsp;</a></span>GetIoSizes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::GetIoSizes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>sizes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00050">50</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8h_source.html#l00046">NnetIo::features</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00791">GeneralMatrix::NumCols()</a>, and <a class="el" href="sparse-matrix_8cc_source.html#l00781">GeneralMatrix::NumRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-utils_8cc_source.html#l00162">MergeExamples()</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                                {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  std::vector&lt;int32&gt; dims(names.size(), -1);  <span class="comment">// just for consistency checking.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  sizes-&gt;clear();</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  sizes-&gt;resize(names.size(), 0);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  std::vector&lt;std::string&gt;::const_iterator names_begin = names.begin(),</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                             names_end = names.end();</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  std::vector&lt;NnetExample&gt;::const_iterator iter = src.begin(), end = src.end();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    std::vector&lt;NnetIo&gt;::const_iterator iter2 = iter-&gt;io.begin(),</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                         end2 = iter-&gt;io.end();</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">for</span> (; iter2 != end2; ++iter2) {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="keyword">const</span> NnetIo &amp;io = *iter2;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      std::vector&lt;std::string&gt;::const_iterator names_iter =</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;          std::lower_bound(names_begin, names_end, io.name);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(*names_iter == io.name);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = names_iter - names_begin;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      int32 this_dim = io.features.NumCols();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordflow">if</span> (dims[i] == -1) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        dims[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = this_dim;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dims[i] != this_dim) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Merging examples with inconsistent feature dims: &quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                  &lt;&lt; dims[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; this_dim &lt;&lt; <span class="stringliteral">&quot; for &#39;&quot;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                  &lt;&lt; io.name &lt;&lt; <span class="stringliteral">&quot;&#39;.&quot;</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(io.features.NumRows() == io.indexes.size());</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      int32 this_size = io.indexes.size();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      (*sizes)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] += this_size;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab753d835b665dd1b444b16f045c3e1a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab753d835b665dd1b444b16f045c3e1a3">&#9670;&nbsp;</a></span>GetMaxMemoryUse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64 GetMaxMemoryUse </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l01439">1439</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kAcceptInput</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="cu-compressed-matrix_8h_source.html#l00141">kaldi::kCompressedMatrixInt8</a>, <a class="el" href="cu-compressed-matrix_8h_source.html#l00142">kaldi::kCompressedMatrixUint8</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kCompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kDecompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00328">NnetComputation::SubMatrixInfo::num_cols</a>, <a class="el" href="nnet-computation_8h_source.html#l00326">NnetComputation::SubMatrixInfo::num_rows</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l04899">OptimizeMemoryCompression()</a>.</p>
<div class="fragment"><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                                                          {</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  int64 cur_memory_use = 0,</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      max_memory_use = 0;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  int32 num_commands = computation.commands.size(),</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      num_submatrices = computation.submatrices.size();</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="comment">// the vector &#39;num_compressed_bytes&#39; is used to remember the number of bytes</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="comment">// in the compressed matrices for each submatrix (this will only be used for</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// those that correspond to a &#39;whole matrix).  It&#39;s needed because the</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="comment">// decompression command doesn&#39;t tell us what compression type was used for</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="comment">// that matrix.</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  std::vector&lt;int32&gt; num_compressed_bytes(num_submatrices, -100000000);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keywordflow">for</span> (int32 command_index = 0; command_index &lt; num_commands; ++command_index) {</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keyword">const</span> NnetComputation::Command &amp;c = computation.commands[command_index];</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    int64 this_num_bytes = -100000000,</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        this_compressed_num_bytes = -10000000;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">if</span> (c.arg1 &gt;= 0 &amp;&amp; c.arg1 &lt; num_submatrices) {</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <span class="comment">// if arg1 could plausibly be a sub-matrix index...</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      <span class="keyword">const</span> NnetComputation::SubMatrixInfo &amp;submat_info =</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;          computation.submatrices[c.arg1];</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      this_num_bytes = <span class="keyword">static_cast&lt;</span>int64<span class="keyword">&gt;</span>(<span class="keyword">sizeof</span>(<a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>)) *</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;          submat_info.num_rows * submat_info.num_cols;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      <span class="keywordflow">if</span> (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>) {</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        this_compressed_num_bytes =</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            ((c.arg2 == <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(<a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa779c2db4bbceea9ef868682cb3942958">kCompressedMatrixInt8</a>) ||</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;              c.arg2 == static_cast&lt;int32&gt;(<a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d">kCompressedMatrixUint8</a>)) ?</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;             1 : 2) * <span class="keyword">static_cast&lt;</span>int64<span class="keyword">&gt;</span>(submat_info.num_rows) *</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            submat_info.num_cols;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        num_compressed_bytes[c.arg1] = this_compressed_num_bytes;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>) {</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        this_compressed_num_bytes = num_compressed_bytes[c.arg1];</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      }</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    }</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>:</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>:</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        cur_memory_use += this_num_bytes;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>:</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        cur_memory_use -= this_num_bytes;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>:</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        cur_memory_use += this_compressed_num_bytes - this_num_bytes;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>:</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        cur_memory_use += this_num_bytes - this_compressed_num_bytes;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cur_memory_use &gt;= 0);</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keywordflow">if</span> (cur_memory_use &gt; max_memory_use)</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      max_memory_use = cur_memory_use;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  }</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <span class="keywordflow">return</span> max_memory_use;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kaldi::nnet3::kCompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d"><div class="ttname"><a href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d">kaldi::kCompressedMatrixUint8</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-compressed-matrix_8h_source.html#l00142">cu-compressed-matrix.h:142</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6a81f9c498a2d703ea343d906a827b6fa779c2db4bbceea9ef868682cb3942958"><div class="ttname"><a href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa779c2db4bbceea9ef868682cb3942958">kaldi::kCompressedMatrixInt8</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-compressed-matrix_8h_source.html#l00141">cu-compressed-matrix.h:141</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kaldi::nnet3::kDecompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a048d60a5963f83c612918824a02e56f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a048d60a5963f83c612918824a02e56f9">&#9670;&nbsp;</a></span>GetNnetChainExampleSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::GetNnetChainExampleSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &amp;&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8cc_source.html#l00437">437</a> of file <a class="el" href="nnet-chain-example_8cc_source.html">nnet-chain-example.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00115">NnetChainExample::inputs</a>, and <a class="el" href="nnet-chain-example_8h_source.html#l00119">NnetChainExample::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-example_8cc_source.html#l00459">ChainExampleMerger::AcceptExample()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00505">ChainExampleMerger::Finish()</a>, and <a class="el" href="nnet-chain-example_8cc_source.html#l00490">ChainExampleMerger::WriteMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                                         {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; a.inputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    int32 s = a.inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span> (s &gt; ans)</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      ans = s;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; a.outputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    int32 s = a.outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> (s &gt; ans)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      ans = s;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a530c70214ef7a623bbb77ab3f2bff173"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a530c70214ef7a623bbb77ab3f2bff173">&#9670;&nbsp;</a></span>GetNnetDiscriminativeExampleSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::GetNnetDiscriminativeExampleSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &amp;&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8cc_source.html#l00430">430</a> of file <a class="el" href="nnet-discriminative-example_8cc_source.html">nnet-discriminative-example.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00108">NnetDiscriminativeExample::inputs</a>, and <a class="el" href="nnet-discriminative-example_8h_source.html#l00112">NnetDiscriminativeExample::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-example_8cc_source.html#l00452">DiscriminativeExampleMerger::AcceptExample()</a>, <a class="el" href="nnet-discriminative-example_8cc_source.html#l00498">DiscriminativeExampleMerger::Finish()</a>, and <a class="el" href="nnet-discriminative-example_8cc_source.html#l00483">DiscriminativeExampleMerger::WriteMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                                                           {</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; a.inputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    int32 s = a.inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> (s &gt; ans)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      ans = s;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; a.outputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    int32 s = a.outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">if</span> (s &gt; ans)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      ans = s;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc8032deb3521ad4396a277b8c098b54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc8032deb3521ad4396a277b8c098b54">&#9670;&nbsp;</a></span>GetNnetExampleSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 GetNnetExampleSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the 'size' of a nnet-example as defined for purposes of merging egs, which is defined as the largest number of Indexes in any of the inputs or outputs of the example. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l01178">1178</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-utils_8cc_source.html#l01194">ExampleMerger::AcceptExample()</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l01239">ExampleMerger::Finish()</a>, and <a class="el" href="nnet-example-utils_8cc_source.html#l01225">ExampleMerger::WriteMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                                               {</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; a.io.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    int32 s = a.io[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">if</span> (s &gt; ans)</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      ans = s;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a433fdafbe9ea5093a2742b5451ba674f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a433fdafbe9ea5093a2742b5451ba674f">&#9670;&nbsp;</a></span>GetNumNvalues()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 GetNumNvalues </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>io_vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>exhaustive</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This utility function can be used to obtain the number of distinct 'n' values in a training example. </p>
<p>This is the number of examples (e.g. sequences) that have been combined into a single example. (Actually it returns the (largest - smallest + 1) of 'n' values, and assumes they are consecutive).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">vec</td><td>The vector of <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> objects from the training example (<a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> or <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html" title="NnetChainExample is like NnetExample, but specialized for lattice-free (chain) training. ">NnetChainExample</a>) for which we need the number of 'n' values </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exhaustive</td><td>If true, it will check exhaustively what largest and smallest 'n' values are. If 'false' it does it in a fast way which will return the same answer as if exhaustive == true for all the types of eg we currently create (basically: correct if the last row of the input or supervision matrices has the last-numbered 'n' value), and will occasionally (randomly) do a test to check that this is the same as if we called it with 'exhaustive=true'. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l02105">2105</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00170">NnetChainTrainer::TrainInternal()</a>, <a class="el" href="nnet-training_8cc_source.html#l00093">NnetTrainer::TrainInternal()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00223">NnetChainTrainer::TrainInternalBackstitch()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00133">NnetTrainer::TrainInternalBackstitch()</a>.</p>
<div class="fragment"><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                                    {</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  int32 num_n_values = -1;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; io_vec.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keyword">const</span> NnetIo &amp;io = io_vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    int32 this_num_n_values;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;index_vec = io.indexes;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!index_vec.empty() &amp;&amp;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                 <span class="stringliteral">&quot;Empty input or output in ComputationRequest?&quot;</span>);</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    <span class="keywordflow">if</span> (exhaustive) {</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      int32 lowest_n_value = std::numeric_limits&lt;int32&gt;::max(),</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;          highest_n_value = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      std::vector&lt;Index&gt;::const_iterator</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;          iter = index_vec.begin(), end = index_vec.end();</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = iter-&gt;n;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        <span class="keywordflow">if</span> (n &lt; lowest_n_value) { lowest_n_value = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>; }</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        <span class="keywordflow">if</span> (n &gt; highest_n_value) { highest_n_value = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>; }</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      }</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      this_num_n_values = highest_n_value + 1 - lowest_n_value;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      <span class="comment">// we assume that the &#39;n&#39; values range from zero to N-1,</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="comment">// where N is the number of distinct &#39;n&#39; values.</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      this_num_n_values = index_vec.back().n + 1;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    }</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> (num_n_values == -1) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      num_n_values = this_num_n_values;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      <span class="keywordflow">if</span> (num_n_values != this_num_n_values) {</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Different inputs/outputs of ComputationRequest have &quot;</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;            <span class="stringliteral">&quot;different numbers of n values: &quot;</span> &lt;&lt; num_n_values</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; this_num_n_values;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      }</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    }</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  }</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  <span class="keywordflow">if</span> (!exhaustive &amp;&amp; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 100) == 0) {</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    int32 num_n_values_check = <a class="code" href="namespacekaldi_1_1nnet3.html#a433fdafbe9ea5093a2742b5451ba674f">GetNumNvalues</a>(io_vec, <span class="keyword">true</span>);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keywordflow">if</span> (num_n_values != num_n_values_check) {</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Exhaustive and quick checks returned different &quot;</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;          <span class="stringliteral">&quot;answers: &quot;</span> &lt;&lt; num_n_values &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                &lt;&lt; num_n_values_check;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    }</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;  }</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  <span class="keywordflow">return</span> num_n_values;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a433fdafbe9ea5093a2742b5451ba674f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a433fdafbe9ea5093a2742b5451ba674f">kaldi::nnet3::GetNumNvalues</a></div><div class="ttdeci">int32 GetNumNvalues(const std::vector&lt; NnetIo &gt; &amp;io_vec, bool exhaustive)</div><div class="ttdoc">This utility function can be used to obtain the number of distinct &amp;#39;n&amp;#39; values in a training example...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l02105">nnet-utils.cc:2105</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a88f25f27da8a794033590e7e322d7673"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88f25f27da8a794033590e7e322d7673">&#9670;&nbsp;</a></span>GetNxList()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetNxList </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>pairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function outputs a unique, lexicographically sorted list of the pairs of (n, x) values that are encountered in the provided list of Indexes. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00603">603</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01519">kaldi::nnet3::time_height_convolution::GetComputationIo()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00596">RestrictedAttentionComponent::GetIndexes()</a>, and <a class="el" href="convolution_8cc_source.html#l01543">kaldi::nnet3::time_height_convolution::GetIndexesForComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                                         {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">// set of (n,x) pairs</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  std::unordered_set&lt;std::pair&lt;int32, int32&gt;, PairHasher&lt;int32&gt; &gt; n_x_set;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;Index&gt;::const_iterator iter = indexes.begin();</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;       iter != indexes.end(); ++iter)</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    n_x_set.insert(std::pair&lt;int32, int32&gt;(iter-&gt;n, iter-&gt;x));</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  pairs-&gt;clear();</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  pairs-&gt;reserve(n_x_set.size());</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">for</span> (std::unordered_set&lt;std::pair&lt;int32, int32&gt;, PairHasher&lt;int32&gt; &gt;::iterator</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;           iter = n_x_set.begin(); iter != n_x_set.end(); ++iter)</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    pairs-&gt;push_back(*iter);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  std::sort(pairs-&gt;begin(), pairs-&gt;end());</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aa92ca6ce1ae303070bc390ec4cf19e46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa92ca6ce1ae303070bc390ec4cf19e46">&#9670;&nbsp;</a></span>GetPrecomputedIndexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a>* kaldi::nnet3::GetPrecomputedIndexes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_rows</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00180">180</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00058">kReordersIndexes</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00302">Component::PrecomputeIndexes()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00272">Component::ReorderIndexes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00309">TestSimpleComponentDataDerivative()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00390">TestSimpleComponentModelDerivative()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00210">TestSimpleComponentPropagateProperties()</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                                                   {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  std::vector&lt;Index&gt; input_indexes(num_rows);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  int32 num_t_values;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">if</span> (num_rows % 3 == 0) { num_t_values = 3; }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num_rows % 2 == 0) { num_t_values = 2; }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">else</span> { num_t_values = 1; }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_rows; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    input_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].n = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> % num_t_values;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    input_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].x = 0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    input_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].t = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> / num_t_values;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  std::vector&lt;Index&gt; output_indexes(input_indexes);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">if</span> (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67">kReordersIndexes</a>) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a92fc16eadbf5faafb1aeb4b90614d691">ReorderIndexes</a>(&amp;input_indexes, &amp;output_indexes);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> misc_info;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">bool</span> need_backprop = <span class="keyword">true</span>;  <span class="comment">// just in case.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a> *ans = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ad3829084b3e064ff320153ff4b6cfd44">PrecomputeIndexes</a>(misc_info,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                                         input_indexes,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                         output_indexes,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                                                         need_backprop);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// ans will be NULL in most cases.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ad3829084b3e064ff320153ff4b6cfd44"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ad3829084b3e064ff320153ff4b6cfd44">kaldi::nnet3::Component::PrecomputeIndexes</a></div><div class="ttdeci">virtual ComponentPrecomputedIndexes * PrecomputeIndexes(const MiscComputationInfo &amp;misc_info, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, bool need_backprop) const</div><div class="ttdoc">This function must return NULL for simple Components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00302">nnet-component-itf.h:302</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1MiscComputationInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">kaldi::nnet3::MiscComputationInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00055">nnet-computation.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a92fc16eadbf5faafb1aeb4b90614d691"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a92fc16eadbf5faafb1aeb4b90614d691">kaldi::nnet3::Component::ReorderIndexes</a></div><div class="ttdeci">virtual void ReorderIndexes(std::vector&lt; Index &gt; *input_indexes, std::vector&lt; Index &gt; *output_indexes) const</div><div class="ttdoc">This function only does something interesting for non-simple Components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00272">nnet-component-itf.h:272</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a6c12dbc12f9d02024f66b4b0d160ee67">kaldi::nnet3::kReordersIndexes</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00058">nnet-component-itf.h:58</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">kaldi::nnet3::ComponentPrecomputedIndexes</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00097">nnet-component-itf.h:97</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a86704308a1467b6000867cc9ed198482"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86704308a1467b6000867cc9ed198482">&#9670;&nbsp;</a></span>GetSubMatrixOfSubMatrix()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1SubMatrixInfo.html">NnetComputation::SubMatrixInfo</a> kaldi::nnet3::GetSubMatrixOfSubMatrix </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>submat_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>submat_b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This static function returns a SubMatrixInfo corresponding to replacing the matrix-index in a's "matrix_index" with, essentially, sub-matrix b. </p>
<p>Of course the matrix_index will be b's "matrix_index", but we may have to modify the row and column offsets. The idea is that sub-matrix submat_b should have the same dimensions as the matrix underlying submat_a. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00789">789</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00327">NnetComputation::SubMatrixInfo::col_offset</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00324">NnetComputation::SubMatrixInfo::matrix_index</a>, <a class="el" href="nnet-computation_8h_source.html#l00306">NnetComputation::MatrixInfo::num_cols</a>, <a class="el" href="nnet-computation_8h_source.html#l00328">NnetComputation::SubMatrixInfo::num_cols</a>, <a class="el" href="nnet-computation_8h_source.html#l00305">NnetComputation::MatrixInfo::num_rows</a>, <a class="el" href="nnet-computation_8h_source.html#l00326">NnetComputation::SubMatrixInfo::num_rows</a>, <a class="el" href="nnet-computation_8h_source.html#l00325">NnetComputation::SubMatrixInfo::row_offset</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00819">VariableMergingOptimizer::DoMerge()</a>.</p>
<div class="fragment"><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                                                                        {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(submat_a) &lt; computation.submatrices.size());</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(submat_b) &lt; computation.submatrices.size());</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keyword">const</span> NnetComputation::SubMatrixInfo &amp;a = computation.submatrices[submat_a],</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                                       &amp;b = computation.submatrices[submat_b];</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keyword">const</span> NnetComputation::MatrixInfo &amp;a_mat =</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      computation.matrices[a.matrix_index];</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(a_mat.num_rows == b.num_rows &amp;&amp; a_mat.num_cols == b.num_cols);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  NnetComputation::SubMatrixInfo ans;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  ans.matrix_index = b.matrix_index;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  ans.row_offset = a.row_offset + b.row_offset;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  ans.num_rows = a.num_rows;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  ans.col_offset = a.col_offset + b.col_offset;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  ans.num_cols = a.num_cols;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a391f07e5812ae93c5950791cb56cbbb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a391f07e5812ae93c5950791cb56cbbb3">&#9670;&nbsp;</a></span>GetTList()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetTList </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>t_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function outputs a sorted, unique list of the 't' values that are encountered in the provided list of Indexes If 't' values equal to kNoTime are encountered, they are ignored and are not output. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00621">621</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-common_8cc_source.html#l00573">kNoTime</a>.</p>

<p class="reference">Referenced by <a class="el" href="convolution_8cc_source.html#l01519">kaldi::nnet3::time_height_convolution::GetComputationIo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                          {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// set of t values</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  std::unordered_set&lt;int32&gt; t_set;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;Index&gt;::const_iterator iter = indexes.begin();</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;       iter != indexes.end(); ++iter)</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">if</span> (iter-&gt;t != <a class="code" href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kNoTime</a>)</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      t_set.insert(iter-&gt;t);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  t_values-&gt;clear();</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  t_values-&gt;reserve(t_set.size());</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keywordflow">for</span> (std::unordered_set&lt;int32&gt;::iterator iter = t_set.begin();</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;       iter != t_set.end(); ++iter)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    t_values-&gt;push_back(*iter);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  std::sort(t_values-&gt;begin(), t_values-&gt;end());</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ac952f0840a7950dff80c1a89e69656d7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac952f0840a7950dff80c1a89e69656d7">kaldi::nnet3::kNoTime</a></div><div class="ttdeci">const int kNoTime</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00573">nnet-common.cc:573</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f107ff3c34b1e2522a1754d9581de0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f107ff3c34b1e2522a1754d9581de0d">&#9670;&nbsp;</a></span>GraphHasCycles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> GraphHasCycles </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns 'true' if the graph represented in 'graph' contains cycles (including cycles where a single node has an arc to itself). </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00300">300</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph_8cc_source.html#l00156">FindSccs()</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l01347">NnetIsRecurrent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                                               {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; sccs;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ae72c79fbb6ec81b69aaee02701fa23e5">FindSccs</a>(graph, &amp;sccs);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sccs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span> (sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size() &gt; 1)</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">// the next code checks for links from a state to itself.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  int32 num_nodes = graph.size();</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_nodes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;int32&gt;::const_iterator iter = graph[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].begin(),</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;             end = graph[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].end(); iter != end; ++iter)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">if</span> (*iter == <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ae72c79fbb6ec81b69aaee02701fa23e5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae72c79fbb6ec81b69aaee02701fa23e5">kaldi::nnet3::FindSccs</a></div><div class="ttdeci">void FindSccs(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdoc">Given a directed graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00156">nnet-graph.cc:156</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="affc407d1e7d567d46e9214000cb500d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affc407d1e7d567d46e9214000cb500d6">&#9670;&nbsp;</a></span>HasBatchnorm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> HasBatchnorm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if nnet has at least one component of type <a class="el" href="classkaldi_1_1nnet3_1_1BatchNormComponent.html">BatchNormComponent</a>. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00518">518</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-combine_8cc_source.html#l00076">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                                    {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet.NumComponents(); c++) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keyword">const</span> Component *comp = nnet.GetComponent(c);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span> (dynamic_cast&lt;const BatchNormComponent*&gt;(comp) != NULL)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ae892457066e9b2ac1632188de1aa06f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae892457066e9b2ac1632188de1aa06f1">&#9670;&nbsp;</a></span>HasContiguousProperty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> HasContiguousProperty </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>reverse_indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns true if for each integer i != -1, all the indexes j at which indexes[j] == i are consecutive with no gaps (more formally: if j1 &lt; j2 &lt; j3 and indexes[j1] != -1 and indexes[j1] == indexes[j3], then indexes[j1] == indexes[j2]). </p>
<p>For example, the vector [ 1 2 1 ] lacks the contiguous property because 1 appears in two places with a different number in the middle. If the vector has the contiguous property, this function also outputs to "reverse_indexes" the begin and end of these ranges, so that indexes[j] == i for all j such that (*reverse_indexes)[i].first &lt;= j &amp;&amp; j &lt; (*reverse_indexes)[i].second. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00556">556</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00939">Compiler::CompileBackwardFromIndexes()</a>, <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00222">UnitTestEnsureContiguousProperty()</a>, and <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00185">UnitTestHasContiguousProperty()</a>.</p>
<div class="fragment"><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                                        {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  reverse_indexes-&gt;clear();</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  int32 num_indexes = indexes.size();</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">if</span> (num_indexes == 0)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  int32 num_input_indexes =</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      *std::max_element(indexes.begin(), indexes.end()) + 1;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_input_indexes &gt;= 0);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">if</span> (num_input_indexes == 0) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">// we don&#39;t really expect this input, filled with -1&#39;s.</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;HasContiguousProperty called on vector of -1&#39;s.&quot;</span>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  reverse_indexes-&gt;resize(num_input_indexes,</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                          std::pair&lt;int32,int32&gt;(-1, -1));</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="comment">// set each pair&#39;s &quot;first&quot; to the min index of all elements</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">// of &quot;indexes&quot; with that value, and the &quot;second&quot; to the</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="comment">// max plus one.</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_indexes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (j == -1) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(j &gt;= 0);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    std::pair&lt;int32, int32&gt; &amp;pair = (*reverse_indexes)[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (pair.first == -1) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      pair.first = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      pair.second = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      pair.first = std::min(pair.first, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      pair.second = std::max(pair.second, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="comment">// check that the contiguous property holds.</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_input_indexes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    std::pair&lt;int32, int32&gt; pair = (*reverse_indexes)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span> (pair.first != -1) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">for</span> (int32 j = pair.first; j &lt; pair.second; j++)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">if</span> (indexes[j] != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a24b5d0f8d0614e04abf2c8ec7a496d34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24b5d0f8d0614e04abf2c8ec7a496d34">&#9670;&nbsp;</a></span>HasXentOutputs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::HasXentOutputs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00235">235</a> of file <a class="el" href="nnet-chain-diagnostics_8cc_source.html">nnet-chain-diagnostics.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00466">Nnet::GetNodeIndex()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00063">Nnet::GetNodeNames()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00248">RecomputeStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                             {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::string&gt; node_names = nnet.GetNodeNames();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator it = node_names.begin();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        it != node_names.end(); ++it) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    int32 node_index = nnet.GetNodeIndex(*it);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (nnet.IsOutputNode(node_index) &amp;&amp; </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        it-&gt;find(<span class="stringliteral">&quot;-xent&quot;</span>) != std::string::npos) {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a6950699c83d835e55f003f89bb92bc80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6950699c83d835e55f003f89bb92bc80">&#9670;&nbsp;</a></span>IdentifyIndexesArgs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IdentifyIndexesArgs </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *&#160;</td>
          <td class="paramname"><em>commands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 * &gt; *&#160;</td>
          <td class="paramname"><em>indexes_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Identifies in the vector of commands, arguments that correspond to indexes into the computation's 'indexes' array, and outputs a list of pointers to those arguments to 'indexes_args'. </p>
<p>Useful in renumbering code. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00133">133</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kAddRows</a>, and <a class="el" href="nnet-computation_8h_source.html#l00291">kCopyRows</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00581">ComputationRenumberer::RenumberIndexes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                                          {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  indexes_args-&gt;clear();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  std::vector&lt;NnetComputation::Command&gt;::iterator iter = commands-&gt;begin(),</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      end = commands-&gt;end();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    NnetComputation::Command &amp;command = *iter;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a> ||</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      indexes_args-&gt;push_back(&amp;(command.arg3));</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af96b480d0b6d2b5890e1490f8c2e6ac0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af96b480d0b6d2b5890e1490f8c2e6ac0">&#9670;&nbsp;</a></span>IdentifyIndexesMultiArgs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IdentifyIndexesMultiArgs </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *&#160;</td>
          <td class="paramname"><em>commands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 * &gt; *&#160;</td>
          <td class="paramname"><em>indexes_multi_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Identifies in the vector of commands, arguments that correspond to indexes into the computation's indexes_multi array, and outputs a list of pointers to those arguments to 'indexes_multi_args'. </p>
<p>Useful in renumbering code. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00105">105</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddToRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyRowsMulti</a>, and <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyToRowsMulti</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00538">ComputationRenumberer::RemoveIndexesMultiDuplicates()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00502">ComputationRenumberer::RemoveUnusedIndexesMulti()</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                                                     {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  indexes_multi_args-&gt;clear();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  std::vector&lt;NnetComputation::Command&gt;::iterator iter = commands-&gt;begin(),</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      end = commands-&gt;end();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    NnetComputation::Command &amp;command = *iter;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">if</span> (command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a> ||</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a> ||</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a> ||</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      indexes_multi_args-&gt;push_back(&amp;(command.arg2));</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a17acd598bf1ced7e83e0c8a8569d224f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17acd598bf1ced7e83e0c8a8569d224f">&#9670;&nbsp;</a></span>IdentifyIndexesRangesArgs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IdentifyIndexesRangesArgs </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *&#160;</td>
          <td class="paramname"><em>commands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 * &gt; *&#160;</td>
          <td class="paramname"><em>indexes_ranges_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Identifies in the vector of commands, arguments that correspond to indexes into the computation's 'indexes_ranges' array, and outputs a list of pointers to those arguments to 'indexes_ranges_args'. </p>
<p>Useful in renumbering code. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00121">121</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, and <a class="el" href="nnet-computation_8h_source.html#l00293">kAddRowRanges</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00635">ComputationRenumberer::RenumberIndexesRanges()</a>.</p>
<div class="fragment"><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                                                       {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  indexes_ranges_args-&gt;clear();</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  std::vector&lt;NnetComputation::Command&gt;::iterator iter = commands-&gt;begin(),</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      end = commands-&gt;end();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    NnetComputation::Command &amp;command = *iter;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span> (command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      indexes_ranges_args-&gt;push_back(&amp;(command.arg3));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8592f4c16a6a1b36c06dccda5511316"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8592f4c16a6a1b36c06dccda5511316">&#9670;&nbsp;</a></span>IdentifyMatrixArgsInComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::IdentifyMatrixArgsInComputation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 *&gt; *&#160;</td>
          <td class="paramname"><em>matrix_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00096">96</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                                                                     {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  int32 num_submatrices = computation-&gt;submatrices.size();</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  matrix_args-&gt;reserve(computation-&gt;submatrices.size());</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">for</span> (int32 s = 1; s &lt; num_submatrices; s++)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    matrix_args-&gt;push_back(&amp;(computation-&gt;submatrices[s].matrix_index));</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a2ec833031232462f45b425a8a5503489"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ec833031232462f45b425a8a5503489">&#9670;&nbsp;</a></span>IdentifySubmatrixArgs() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IdentifySubmatrixArgs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 * &gt; *&#160;</td>
          <td class="paramname"><em>submatrix_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function outputs to "submatrix_args" the addresses of a subset of arguments arg1 through arg6 in "command", that correspond to the indexes of submatrices. </p>
<p>This is useful in renumbering code. Note: some of the pointers may point to a zero value, for optional submatrix args. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00028">28</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00344">NnetComputation::Command::arg4</a>, <a class="el" href="nnet-computation_8h_source.html#l00345">NnetComputation::Command::arg5</a>, <a class="el" href="nnet-computation_8h_source.html#l00346">NnetComputation::Command::arg6</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kAcceptInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kAddRowRanges</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kAddRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddToRowsMulti</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kBackprop</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kBackpropNoModelUpdate</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kCopyRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyToRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixAdd</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixCopy</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationMarker</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationPermanent</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kPropagate</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kProvideOutput</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSetConst</a>, and <a class="el" href="nnet-computation_8h_source.html#l00289">kSwapMatrix</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00080">IdentifySubmatrixArgs()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00340">IdentifySubmatrixArgsInComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                                              {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  submatrix_args-&gt;clear();</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">switch</span> (c-&gt;command_type) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>:</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>:</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>:</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg1);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>:</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg1);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg2);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a>:</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg3);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg4);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>:</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>:</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg3);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg4);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg5);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg6);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>:</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>:</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>:</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>:</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg1);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg2);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>:</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>:</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>:</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>:</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg1);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>:</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      submatrix_args-&gt;push_back(&amp;c-&gt;arg1);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>:</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>:</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>:</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>:</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>:</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unknown command type.&quot;</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kaldi::nnet3::kBackpropNoModelUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kaldi::nnet3::kNoOperationLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aac8664deabb618f4c3dc3d99d8462ea1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac8664deabb618f4c3dc3d99d8462ea1">&#9670;&nbsp;</a></span>IdentifySubmatrixArgs() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IdentifySubmatrixArgs </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; *&#160;</td>
          <td class="paramname"><em>commands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 * &gt; *&#160;</td>
          <td class="paramname"><em>submatrix_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function outputs to "submatrix_args" the addresses of the args (arguments arg1 through arg6) in the vector "commands", that correspond to the indexes of submatrices. </p>
<p>This is useful in renumbering code. Note: some of the pointers may point to a zero value, for optional submatrix args. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00080">80</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l00028">IdentifySubmatrixArgs()</a>.</p>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                                              {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  submatrix_args-&gt;clear();</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  std::vector&lt;NnetComputation::Command&gt;::iterator iter = commands-&gt;begin(),</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      end = commands-&gt;end();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  std::vector&lt;int32*&gt; this_submatrix_args;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#aac8664deabb618f4c3dc3d99d8462ea1">IdentifySubmatrixArgs</a>(&amp;(*iter), &amp;this_submatrix_args);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    submatrix_args-&gt;insert(submatrix_args-&gt;end(),</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                           this_submatrix_args.begin(),</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                           this_submatrix_args.end());</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_aac8664deabb618f4c3dc3d99d8462ea1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aac8664deabb618f4c3dc3d99d8462ea1">kaldi::nnet3::IdentifySubmatrixArgs</a></div><div class="ttdeci">void IdentifySubmatrixArgs(std::vector&lt; NnetComputation::Command &gt; *commands, std::vector&lt; int32 *&gt; *submatrix_args)</div><div class="ttdoc">This function outputs to &quot;submatrix_args&quot; the addresses of the args (arguments arg1 through arg6) in ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00080">nnet-optimize-utils.cc:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af87da4e8a0e1880438bf77e8a34b4143"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af87da4e8a0e1880438bf77e8a34b4143">&#9670;&nbsp;</a></span>IdentifySubmatrixArgsInComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IdentifySubmatrixArgsInComputation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 * &gt; *&#160;</td>
          <td class="paramname"><em>submatrix_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function outputs to "submatrix_args" the addresses of integers in 'computation' that correspond to submatrices. </p>
<p>These may be present in 'commands', and in 'indexes_multi'. This is useful in renumbering code. Note: some of the pointers may point to a zero value, for optional submatrix args in commands, but for efficiency we don't provide pointers for the -1's in 'indexes_multi'. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00340">340</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00028">IdentifySubmatrixArgs()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00425">NnetComputation::indexes_multi</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00361">ComputationRenumberer::ComputeSubmatrixIsUsed()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00428">ComputationRenumberer::RenumberSubmatrices()</a>.</p>
<div class="fragment"><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                                                                           {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aac8664deabb618f4c3dc3d99d8462ea1">IdentifySubmatrixArgs</a>(&amp;(computation-&gt;commands), submatrix_args);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordtype">size_t</span> extra_size = 0;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; computation-&gt;indexes_multi.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    extra_size += computation-&gt;indexes_multi[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  submatrix_args-&gt;reserve(submatrix_args-&gt;size() + extra_size);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; computation-&gt;indexes_multi.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;indexes_multi =</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        computation-&gt;indexes_multi[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::iterator</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        iter = indexes_multi.begin(), end = indexes_multi.end();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">if</span> (iter-&gt;first != -1)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        submatrix_args-&gt;push_back(&amp;(iter-&gt;first));</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_aac8664deabb618f4c3dc3d99d8462ea1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aac8664deabb618f4c3dc3d99d8462ea1">kaldi::nnet3::IdentifySubmatrixArgs</a></div><div class="ttdeci">void IdentifySubmatrixArgs(std::vector&lt; NnetComputation::Command &gt; *commands, std::vector&lt; int32 *&gt; *submatrix_args)</div><div class="ttdoc">This function outputs to &quot;submatrix_args&quot; the addresses of the args (arguments arg1 through arg6) in ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00080">nnet-optimize-utils.cc:80</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a68068a73dabd55faade8d658a56f277b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68068a73dabd55faade8d658a56f277b">&#9670;&nbsp;</a></span>IndexesHaveSpecialStructure()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::IndexesHaveSpecialStructure </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>first_nonnegative_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>first_nonnegative_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_nonnegative_indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02252">2252</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02288">ReplaceRowWithMatrixOps()</a>.</p>
<div class="fragment"><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                                                                        {</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!indexes.empty());</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="keyword">const</span> int32 *indexes_ptr = &amp;(indexes[0]);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  <span class="keywordtype">size_t</span> pos = 0, size = indexes.size();</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  <span class="comment">// Find the first nonnegative element of &#39;indexes&#39;.</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;  <span class="keywordflow">for</span> (; pos &lt; size; ++pos)</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">if</span> (indexes_ptr[pos] &gt;= 0)</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  <span class="keywordflow">if</span> (pos == size)</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// all -1&#39;s... should not happen, but not our problem.</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  *first_nonnegative_pos = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(pos);</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = indexes_ptr[pos];</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  *first_nonnegative_value = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="comment">// Find the first element after &#39;*first_nonnegative_index&#39; that isn&#39;t</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <span class="comment">// consecutive.</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="keywordflow">for</span> (; pos &lt; size; ++pos,++<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>)</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    <span class="keywordflow">if</span> (indexes_ptr[pos] != n)</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  *num_nonnegative_indexes = n - *first_nonnegative_value;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  <span class="comment">// Check that the remaining values are all &lt;0 (assumed equal to -1, but</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  <span class="comment">// checking &lt;0 may be faster as just one instruction).</span></div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  <span class="keywordflow">for</span> (; pos &lt; size; ++pos)</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="keywordflow">if</span> (indexes_ptr[pos] &gt;= 0)</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// does not have the special structure.</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79ed08ad0dcf1b82a23e4e3c96967502"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79ed08ad0dcf1b82a23e4e3c96967502">&#9670;&nbsp;</a></span>IndexesMultiToSubmatrixIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::IndexesMultiToSubmatrixIndexes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes_multi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>submatrix_indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>given a vector of pairs from computation.indexes_multi_indexes containing paris (submatrix-index, row-index), this function outputs to "submatrix_indexes" all (unique) submatrix indexes that appear; and it outputs to "contains_null_marker" true if the pair (-1, -1) appears anywhere in indexes_multi, and false otherwise. </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l00264">264</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-analyze_8cc_source.html#l00284">ComputeCommandAttributes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                         {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  submatrix_indexes-&gt;clear();</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::const_iterator</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      iter = indexes_multi.begin(), end = indexes_multi.end();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  int32 cur_submatrix_index = -1; <span class="comment">// an optimization.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    int32 submatrix_index = iter-&gt;first;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (submatrix_index != -1 &amp;&amp; submatrix_index != cur_submatrix_index) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      cur_submatrix_index = submatrix_index;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      submatrix_indexes-&gt;push_back(submatrix_index);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(submatrix_indexes);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0cc731e05d6603b7d4d0191f9f1c9d32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cc731e05d6603b7d4d0191f9f1c9d32">&#9670;&nbsp;</a></span>InsertCommands()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InsertCommands </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &gt; &gt; *&#160;</td>
          <td class="paramname"><em>commands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inserts commands into the computation at the requested places. </p>
<p>'commands' is a list of pairs (command-index, command) that is expected to be sorted on command-index. For each entry (c, command) in 'commands', 'command' is inserted into 'computation' just *before* the command that (at entry) is in computation-&gt;commands[c]. If there are multiple pairs with the same index c, they will remain in the same order in which they were present in 'commands'; however, 'commands' does not have to be sorted on 'c'. As a special case, if c == computation-&gt;commands.size(), the corresponding commands are inserted at the beginning of the computation. This function will appropriately renumber the argument of the kGotoLabel command of any 'looped' computation. Command indexes c in commands[*].first must be in the range [0, computation-&gt;commands.size()]. This function may modify 'commands' by sorting it. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04640">4640</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04552">FixGotoLabel()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l04769">MemoryCompressionOptimizer::ModifyComputation()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l02883">RowOpsSplitter::SplitCommands()</a>.</p>
<div class="fragment"><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;                                  {</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;  int32 num_new_commands = new_commands-&gt;size(),</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;      num_old_commands = computation-&gt;commands.size();</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;  <span class="keywordflow">if</span> (num_new_commands == 0)</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;  CommandPairComparator comparison_operator;</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;  <span class="comment">// use std::stable_sort so that for entries in &#39;new_commands&#39; that</span></div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;  <span class="comment">// have the same .first value, they stay in the same order they were</span></div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;  <span class="comment">// in before sorting.</span></div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;  std::stable_sort(new_commands-&gt;begin(), new_commands-&gt;end(),</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;                   comparison_operator);</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0) {   <span class="comment">// check &#39;new_commands&#39;</span></div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; num_new_commands; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((*new_commands)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first &lt;= (*new_commands)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].first &amp;&amp;</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;                   (*new_commands)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first &gt;= 0 &amp;&amp;</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;                   (*new_commands)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].first &lt;= num_old_commands);</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;    }</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;  }</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;  std::vector&lt;NnetComputation::Command&gt; merged_commands;</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;  merged_commands.reserve(num_old_commands + num_new_commands);</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;  std::vector&lt;std::pair&lt;int32, NnetComputation::Command&gt; &gt;::const_iterator</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;      new_commands_iter = new_commands-&gt;begin(),</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;      new_commands_end = new_commands-&gt;end();</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;  <span class="keywordflow">for</span> (int32 old_command_index = 0; old_command_index &lt;= num_old_commands;</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;       old_command_index++) {</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;    <span class="keywordflow">while</span> (new_commands_iter != new_commands_end &amp;&amp;</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;           new_commands_iter-&gt;first &lt;= old_command_index) {</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;      merged_commands.push_back(new_commands_iter-&gt;second);</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;      ++new_commands_iter;</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;    }</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;    <span class="keywordflow">if</span> (old_command_index &lt; num_old_commands)</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;      merged_commands.push_back(computation-&gt;commands[old_command_index]);</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;  }</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(merged_commands.size() == num_old_commands +</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;               num_new_commands);</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;  <span class="comment">// copy to &#39;computation-&gt;commands&#39; via shallow swap.</span></div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;  computation-&gt;commands.swap(merged_commands);</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">FixGotoLabel</a>(computation);</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a8953a6af8e449d7cc12efeb115c5f8d2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">kaldi::nnet3::FixGotoLabel</a></div><div class="ttdeci">void FixGotoLabel(NnetComputation *computation)</div><div class="ttdoc">This function ensures that the arg1 of a final command of type kGotoLabel is the same as the command ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04552">nnet-optimize-utils.cc:4552</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4d88467d1a24ad6a2b21d4b8923615ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d88467d1a24ad6a2b21d4b8923615ca">&#9670;&nbsp;</a></span>IoSpecificationIsDecomposable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::IoSpecificationIsDecomposable </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a> &amp;&#160;</td>
          <td class="paramname"><em>io_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a> *&#160;</td>
          <td class="paramname"><em>mini_io_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_n_values_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03822">3822</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l03106">ConvertNumNValues()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02942">FindNStride()</a>, <a class="el" href="nnet-computation_8h_source.html#l00075">IoSpecification::has_deriv</a>, <a class="el" href="nnet-computation_8h_source.html#l00074">IoSpecification::indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-computation_8h_source.html#l00073">IoSpecification::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l03852">RequestIsDecomposable()</a>.</p>
<div class="fragment"><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;                                                                   {</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;  mini_io_spec-&gt;name = io_spec.name;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;  mini_io_spec-&gt;has_deriv = io_spec.has_deriv;</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;  <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;indexes = io_spec.indexes;</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!indexes.empty() &amp;&amp; <span class="stringliteral">&quot;Empty Indexes in computation request&quot;</span>);</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;  <span class="keywordtype">bool</span> full_check = <span class="keyword">true</span>;  <span class="comment">// We might eventually change this to false, for</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;                           <span class="comment">// efficiency.</span></div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;  int32 num_n_values = indexes.back().n + 1;</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;  <span class="keywordflow">if</span> (num_n_values &lt;= 2) {</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;    <span class="comment">// Computations with 2 or fewer &#39;n&#39; values are not decomposable, as there</span></div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;    <span class="comment">// would be no speed benefit in shortcut compilation (which relies on</span></div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;    <span class="comment">// compiling an otherwise similar computation with n == 2).</span></div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;  }</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;  *num_n_values_out = num_n_values;</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;  int32 n_stride = <a class="code" href="namespacekaldi_1_1nnet3.html#af4426490c64581d8189bf8c671e5a893">FindNStride</a>(indexes, full_check);</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;  <span class="keywordflow">if</span> (n_stride == 0)</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a4a1bed82d2cb5fbdc695bf32053117ad">ConvertNumNValues</a>(n_stride, num_n_values, 2,</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                    indexes, &amp;(mini_io_spec-&gt;indexes));</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_af4426490c64581d8189bf8c671e5a893"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af4426490c64581d8189bf8c671e5a893">kaldi::nnet3::FindNStride</a></div><div class="ttdeci">static int32 FindNStride(const std::vector&lt; Cindex &gt; &amp;cindexes, bool full_check)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03033">nnet-optimize-utils.cc:3033</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4a1bed82d2cb5fbdc695bf32053117ad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4a1bed82d2cb5fbdc695bf32053117ad">kaldi::nnet3::ConvertNumNValues</a></div><div class="ttdeci">static void ConvertNumNValues(int32 n_stride, int32 old_N, int32 new_N, const std::vector&lt; Index &gt; &amp;indexes_in, std::vector&lt; Index &gt; *indexes_out)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03106">nnet-optimize-utils.cc:3106</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae3ebe9f7e8bfc061d7582b3964698e4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3ebe9f7e8bfc061d7582b3964698e4e">&#9670;&nbsp;</a></span>IsNoop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::IsNoop </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;&#160;</td>
          <td class="paramname"><em>command</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00699">699</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, and <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00703">RemoveNoOps()</a>.</p>
<div class="fragment"><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                                                          {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordflow">return</span> command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a672e127a288d02b4a8e292b86aadfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a672e127a288d02b4a8e292b86aadfc04">&#9670;&nbsp;</a></span>IsSimpleNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> IsSimpleNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns true if the nnet has the following properties: It has an output called "output" (other outputs are allowed but may be ignored). </p>
<p>It has an input called "input", and possibly an extra input called "ivector", but no other inputs. There are probably some other properties that we really ought to be checking, and we may add more later on. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00052">52</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00466">Nnet::GetNodeIndex()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00120">Nnet::IsInputNode()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, and <a class="el" href="nnet-utils_8cc_source.html#l00043">NumInputNodes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00146">ComputeSimpleNnetContext()</a>, <a class="el" href="nnet-am-decodable-simple_8cc_source.html#l00027">DecodableNnetSimple::DecodableNnetSimple()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00821">Nnet::Info()</a>, <a class="el" href="decodable-simple-looped_8cc_source.html#l00056">DecodableNnetSimpleLoopedInfo::Init()</a>, <a class="el" href="lattice-lmrescore-kaldi-rnnlm-pruned_8cc_source.html#l00032">main()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00483">NnetInfo()</a>, and <a class="el" href="am-nnet-simple_8cc_source.html#l00096">AmNnetSimple::SetContext()</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                    {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// check that we have an output node and called &quot;output&quot;.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordflow">if</span> (nnet.GetNodeIndex(<span class="stringliteral">&quot;output&quot;</span>) == -1 ||</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      !nnet.IsOutputNode(nnet.GetNodeIndex(<span class="stringliteral">&quot;output&quot;</span>)))</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">// check that there is an input node named &quot;input&quot;.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">if</span> (nnet.GetNodeIndex(<span class="stringliteral">&quot;input&quot;</span>) == -1 ||</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      !nnet.IsInputNode(nnet.GetNodeIndex(<span class="stringliteral">&quot;input&quot;</span>)))</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// if there was just one input, then it was named</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">// &quot;input&quot; and everything checks out.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a2ce1aea23a558c0461ff1ab72f41ebb6">NumInputNodes</a>(nnet) == 1)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">// Otherwise, there should be input node with name &quot;input&quot; and one</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// should be called &quot;ivector&quot;.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">return</span> nnet.GetNodeIndex(<span class="stringliteral">&quot;ivector&quot;</span>) != -1 &amp;&amp;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      nnet.IsInputNode(nnet.GetNodeIndex(<span class="stringliteral">&quot;ivector&quot;</span>));</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a2ce1aea23a558c0461ff1ab72f41ebb6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2ce1aea23a558c0461ff1ab72f41ebb6">kaldi::nnet3::NumInputNodes</a></div><div class="ttdeci">int32 NumInputNodes(const Nnet &amp;nnet)</div><div class="ttdoc">returns the number of input nodes of this nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00043">nnet-utils.cc:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a30e2d3a7507084b838f420b5e10b37f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30e2d3a7507084b838f420b5e10b37f9">&#9670;&nbsp;</a></span>IsValidName()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> IsValidName </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if 'name' would be a valid name for a component or node in a <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a>. </p>
<p>This is a nonempty string beginning with A-Za-z_, and containing only '-', '_', '.', A-Z, a-z, or 0-9. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00425">425</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-nnet_8cc_source.html#l00161">Nnet::AddComponent()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00377">DescriptorTokenize()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00031">ConfigLine::ParseLine()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00486">Nnet::RemoveRedundantConfigLines()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00053">Nnet::SetNodeName()</a>.</p>
<div class="fragment"><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                        {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">if</span> (name.size() == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; name.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0 &amp;&amp; !isalpha(name[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]) &amp;&amp; name[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != <span class="charliteral">&#39;_&#39;</span>)</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">if</span> (!isalnum(name[i]) &amp;&amp; name[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != <span class="charliteral">&#39;_&#39;</span> &amp;&amp; name[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != <span class="charliteral">&#39;-&#39;</span> &amp;&amp; name[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != <span class="charliteral">&#39;.&#39;</span>)</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a04165cf9403194c5a77e922f8f14d5f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04165cf9403194c5a77e922f8f14d5f9">&#9670;&nbsp;</a></span>KlDivergence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> kaldi::nnet3::KlDivergence </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-am-adjust-priors_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet3-am-adjust-priors_8cc_source.html">nnet3-am-adjust-priors.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="kaldi-math_8h_source.html#l00100">kaldi::Log()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-am-adjust-priors_8cc_source.html#l00048">PrintPriorDiagnostics()</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                                   {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> sum_p = p.<a class="code" href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>(), sum_q = q.<a class="code" href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">if</span> (fabs(sum_p - 1.0) &gt; 0.01 || fabs(sum_q - 1.0) &gt; 0.01) {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;KlDivergence: vectors are not close to being normalized &quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;               &lt;&lt; sum_p &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; sum_q;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(p.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() == q.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>());</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordtype">double</span> ans = 0.0;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; p.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> p_prob = p(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) / sum_p, q_prob = q(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) / sum_q;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    ans += p_prob * <a class="code" href="namespacekaldi.html#af75c4606b108091c348102660de63180">Log</a>(p_prob / q_prob);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_af75c4606b108091c348102660de63180"><div class="ttname"><a href="namespacekaldi.html#af75c4606b108091c348102660de63180">kaldi::Log</a></div><div class="ttdeci">double Log(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00100">kaldi-math.h:100</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_ae7089fd656218302336300dc42ae55c1"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">kaldi::VectorBase::Sum</a></div><div class="ttdeci">Real Sum() const</div><div class="ttdoc">Returns sum of the elements. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00693">kaldi-vector.cc:693</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adbc06e3c26b68f19c01aad13eeb95205"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbc06e3c26b68f19c01aad13eeb95205">&#9670;&nbsp;</a></span>LimitDerivativeTimes() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::LimitDerivativeTimes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This optimization, which has no effect unless you set &ndash;min-deriv-time or &ndash;max-deriv-time, modifies the backprop operations for efficiency based on the assumption that derivatives for any Cindex with t &lt; min_deriv_time or t &gt; max_deriv_time are zero. </p>
<p>(this is based on the fact that derivatives in recurrent setups will either decay to zero over time, or will explode and anyway become meaningless). This is only applied if you are not comoputing any input-derivatives). The assumption, for simple Components, is that backprop operations are no-ops as long as the input was zeroed, because the back-propagated derivatives would be zero and the model would not be updated.</p>
<p>The most important effect of this operation is to modify some operations of type kBackprop and kBackpropNoModelUpdate for simple Components, to either make them operate on row ranges of their original input (which in general will be newly created submatrices), or to remove them altogether if they do not operate on any 't' values within the correct range.</p>
<p>We assert as a requirement of this optimization that all allocation commands must zero their matrices (this effectively means that you cannot apply this optimization after <a class="el" href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd" title="This optimization function removes, where possible, commands of type type kSetConst. ">RemoveUnnecessaryZeroing()</a>). This means that we don't have to worry about leaving things undefined after removing backprop operations. We also assert that backprop commands that set instead of adding to their input, must not be outputting to things that were previously set to nonzero values. (this shouldn't ever be a problem, but we do check.</p>
<p>Note: after this optimization it will likely be beneficial to call RemoveUnnecessaryOperations to remove operations not of type kBackprop that have now become unnecessary&ndash; e.g. operations that do the backprop through Descriptors. </p>

</div>
</div>
<a id="a6ed9b871bd28649b80165dc1af5d1a98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ed9b871bd28649b80165dc1af5d1a98">&#9670;&nbsp;</a></span>LimitDerivativeTimes() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LimitDerivativeTimes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>min_deriv_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>max_deriv_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02215">2215</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l01939">DerivativeTimeLimiter::LimitDerivTimes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                                                        {</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  DerivativeTimeLimiter limiter(nnet, min_deriv_time, max_deriv_time,</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                                computation);</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  limiter.LimitDerivTimes();</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a9efe2804eba8c2da73af3aa4eff4a2fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9efe2804eba8c2da73af3aa4eff4a2fc">&#9670;&nbsp;</a></span>MakeSccGraph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MakeSccGraph </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>sccs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>scc_graph</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given a list of sccs of a graph (e.g. </p>
<p>as computed by FindSccs), compute a directed graph on the sccs. Of course this directed graph will be acyclic. </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00164">164</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00265">ComputeNnetComputationEpochs()</a>, and <a class="el" href="nnet-graph-test_8cc_source.html#l00172">UnitTestMakeSccGraph()</a>.</p>
<div class="fragment"><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                                           {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(scc_graph != NULL);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  scc_graph-&gt;clear();</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  scc_graph-&gt;resize(sccs.size());</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">// Hash map from node to SCC index.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  std::vector&lt;int32&gt; node_to_scc_index(graph.size());</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sccs.size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); ++<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] &gt;= 0 &amp;&amp; sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] &lt; graph.size());</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      node_to_scc_index[sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">// Builds graph.</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sccs.size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); ++<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      int32 node = sccs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node &gt;= 0 &amp;&amp; node &lt; graph.size());</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordflow">for</span> (int32 k = 0; k &lt; graph[node].size(); ++k) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">if</span> (node_to_scc_index[graph[node][k]] != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) { <span class="comment">// Exclucding self.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          (*scc_graph)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].push_back(node_to_scc_index[graph[node][k]]);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// If necessary, we can use a hash maps to avoid this sorting.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;((*scc_graph)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac879380727c26962a7aaa4a6de9dc4d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac879380727c26962a7aaa4a6de9dc4d4">&#9670;&nbsp;</a></span>MatrixIsUnused()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> MatrixIsUnused </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;&#160;</td>
          <td class="paramname"><em>analyzer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns true if matrix 1 &lt;= m &lt; computation-&gt;matrices.size() is unused, defined as: it is not an input or an output, and is not accessed other than via commands of type kAllocMatrix, kDeallocMatrix, and kSetConst. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04582">4582</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8h_source.html#l00264">MatrixAccesses::accesses</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-analyze_8h_source.html#l00267">MatrixAccesses::is_input</a>, <a class="el" href="nnet-analyze_8h_source.html#l00270">MatrixAccesses::is_output</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSetConst</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00298">Analyzer::matrix_accesses</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02179">DerivativeTimeLimiter::PruneMatrices()</a>.</p>
<div class="fragment"><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;                             {</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;  <span class="keyword">const</span> MatrixAccesses &amp;accesses = analyzer.matrix_accesses[m];</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;  <span class="keywordflow">if</span> (accesses.is_input || accesses.is_output)</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; accesses.accesses.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;    int32 command_index = accesses.accesses[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].command_index;</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;    <span class="keyword">const</span> NnetComputation::Command &amp;command =</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;        computation.commands[command_index];</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;    <span class="keywordflow">if</span> (command.command_type != <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a> &amp;&amp;</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;        command.command_type != <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>) {</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;    }</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;  }</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a82b64d14f92892efd68998d19e012c1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82b64d14f92892efd68998d19e012c1c">&#9670;&nbsp;</a></span>MaxMemoryUsage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::MaxMemoryUsage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the total memory, in bytes, used by the computation (just the temporary memory, not counting the memory used by the nnet itself). </p>
<p>This is defined as the maximum amount of memory used at any one instant. </p>

</div>
</div>
<a id="ac580549257041c725612ff223c99e43c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac580549257041c725612ff223c99e43c">&#9670;&nbsp;</a></span>MaxOutputTimeInRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 MaxOutputTimeInRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00484">484</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00284">CompileLoopedInternal()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00741">CachingOptimizingCompiler::CompileNoShortcut()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00084">NnetOptimizeOptions::Register()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>, and <a class="el" href="nnet-derivative-test_8cc_source.html#l00246">UnitTestNnetInputDerivatives()</a>.</p>
<div class="fragment"><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                                                                {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  int32 ans = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.outputs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;indexes (request.outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    std::vector&lt;Index&gt;::const_iterator iter = indexes.begin(),</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        end = indexes.end();</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keywordflow">if</span> (iter-&gt;t &gt; ans)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        ans = iter-&gt;t;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (ans == std::numeric_limits&lt;int32&gt;::min()) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Failed to find any output indexes in computation request.&quot;</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abe0183368d988b0e08258b864232c472"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe0183368d988b0e08258b864232c472">&#9670;&nbsp;</a></span>MergeChainExamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MergeChainExamples </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function merges a list of <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html" title="NnetChainExample is like NnetExample, but specialized for lattice-free (chain) training. ">NnetChainExample</a> objects into a single one&ndash; intended to be used when forming minibatches for neural net training. </p>
<p>If 'compress' it compresses the output features (recommended to save disk space).</p>
<p>Note: the input is left as it was at the start, but it is temporarily changed inside the function; this is a trick to allow us to use the <a class="el" href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee" title="Merge a set of input examples into a single example (typically the size of &quot;src&quot; will be the minibatc...">MergeExamples()</a> routine while avoiding having to rewrite code. </p>

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8cc_source.html#l00256">256</a> of file <a class="el" href="nnet-chain-example_8cc_source.html">nnet-chain-example.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00115">NnetChainExample::inputs</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00162">MergeExamples()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00195">MergeSupervision()</a>, and <a class="el" href="nnet-chain-example_8h_source.html#l00119">NnetChainExample::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-example_8h_source.html#l00156">NnetChainExampleStructureCompare::operator()()</a>, and <a class="el" href="nnet-chain-example_8cc_source.html#l00490">ChainExampleMerger::WriteMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                                  {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  int32 num_examples = input-&gt;size();</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_examples &gt; 0);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// we temporarily make the input-features in &#39;input&#39; look like regular NnetExamples,</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">// so that we can recycle the MergeExamples() function.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  std::vector&lt;NnetExample&gt; eg_inputs(num_examples);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_examples; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    eg_inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].io.swap((*input)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].inputs);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  NnetExample eg_output;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee">MergeExamples</a>(eg_inputs, compress, &amp;eg_output);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// swap the inputs back so that they are not really changed.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0; i &lt; num_examples; i++)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    eg_inputs[i].io.swap((*input)[i].inputs);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// write to &#39;output-&gt;inputs&#39;</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  eg_output.io.swap(output-&gt;inputs);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="comment">// Now deal with the chain-supervision &#39;outputs&#39;.  There will</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="comment">// normally be just one of these, with name &quot;output&quot;, but we</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">// handle the more general case.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  int32 num_output_names = (*input)[0].outputs.size();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  output-&gt;outputs.resize(num_output_names);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0; i &lt; num_output_names; i++) {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    std::vector&lt;const NnetChainSupervision*&gt; to_merge(num_examples);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num_examples; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((*input)[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].outputs.size() == num_output_names);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      to_merge[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = &amp;((*input)[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a56c6f4427fb48f1e38b8b3b250b687ec">MergeSupervision</a>(to_merge,</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                     &amp;(output-&gt;outputs[i]));</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a56c6f4427fb48f1e38b8b3b250b687ec"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a56c6f4427fb48f1e38b8b3b250b687ec">kaldi::nnet3::MergeSupervision</a></div><div class="ttdeci">static void MergeSupervision(const std::vector&lt; const NnetChainSupervision *&gt; &amp;inputs, NnetChainSupervision *output)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-chain-example_8cc_source.html#l00195">nnet-chain-example.cc:195</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4ceebc46ef1be292f6b2ff71cc1128ee"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee">kaldi::nnet3::MergeExamples</a></div><div class="ttdeci">void MergeExamples(const std::vector&lt; NnetExample &gt; &amp;src, bool compress, NnetExample *merged_eg)</div><div class="ttdoc">Merge a set of input examples into a single example (typically the size of &quot;src&quot; will be the minibatc...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00162">nnet-example-utils.cc:162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afcc977fd1ccb4dd285c01c9a13ebdef0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcc977fd1ccb4dd285c01c9a13ebdef0">&#9670;&nbsp;</a></span>MergeDiscriminativeExamples() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::MergeDiscriminativeExamples </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Appends the given vector of examples (which must be non-empty) into a single output example. </p>
<p>Intended to be used when forming minibatches for neural net training. If 'compress' it compresses the output features (recommended to save disk space).</p>
<p>Note: the input is left as it was at the start, but it is temporarily changed inside the function; this is a trick to allow us to use the <a class="el" href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee" title="Merge a set of input examples into a single example (typically the size of &quot;src&quot; will be the minibatc...">MergeExamples()</a> routine while avoiding having to rewrite code. </p>

</div>
</div>
<a id="afbbb286d5e95ff4078c057af5a5b6139"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbbb286d5e95ff4078c057af5a5b6139">&#9670;&nbsp;</a></span>MergeDiscriminativeExamples() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::MergeDiscriminativeExamples </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> &gt; *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8cc_source.html#l00247">247</a> of file <a class="el" href="nnet-discriminative-example_8cc_source.html">nnet-discriminative-example.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00108">NnetDiscriminativeExample::inputs</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00162">MergeExamples()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00195">MergeSupervision()</a>, and <a class="el" href="nnet-discriminative-example_8h_source.html#l00112">NnetDiscriminativeExample::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-example_8h_source.html#l00151">NnetDiscriminativeExampleStructureCompare::operator()()</a>, and <a class="el" href="nnet-discriminative-example_8cc_source.html#l00483">DiscriminativeExampleMerger::WriteMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                       {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  int32 num_examples = input-&gt;size();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_examples &gt; 0);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">// we temporarily make the input-features in &#39;input&#39; look like regular</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">// NnetExamples, so that we can recycle the</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// MergeExamples() function.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  std::vector&lt;NnetExample&gt; eg_inputs(num_examples);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_examples; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    eg_inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].io.swap((*input)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].inputs);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  NnetExample eg_output;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee">MergeExamples</a>(eg_inputs, compress, &amp;eg_output);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// swap the inputs back so that they are not really changed.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0; i &lt; num_examples; i++)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    eg_inputs[i].io.swap((*input)[i].inputs);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// write to &#39;output-&gt;inputs&#39;</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  eg_output.io.swap(output-&gt;inputs);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// Now deal with the discriminative-supervision &#39;outputs&#39;.  There will</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// normally be just one of these, with name &quot;output&quot;, but we</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// handle the more general case.</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  int32 num_output_names = (*input)[0].outputs.size();</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  output-&gt;outputs.resize(num_output_names);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0; i &lt; num_output_names; i++) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    std::vector&lt;const NnetDiscriminativeSupervision*&gt; to_merge(num_examples);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num_examples; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((*input)[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].outputs.size() == num_output_names);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      to_merge[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = &amp;((*input)[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a8d3932735b1229a9b7e8bdce64f3cf1a">MergeSupervision</a>(to_merge,</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                     &amp;(output-&gt;outputs[i]));</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8d3932735b1229a9b7e8bdce64f3cf1a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8d3932735b1229a9b7e8bdce64f3cf1a">kaldi::nnet3::MergeSupervision</a></div><div class="ttdeci">void MergeSupervision(const std::vector&lt; const NnetDiscriminativeSupervision *&gt; &amp;inputs, NnetDiscriminativeSupervision *output)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-discriminative-example_8cc_source.html#l00185">nnet-discriminative-example.cc:185</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4ceebc46ef1be292f6b2ff71cc1128ee"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee">kaldi::nnet3::MergeExamples</a></div><div class="ttdeci">void MergeExamples(const std::vector&lt; NnetExample &gt; &amp;src, bool compress, NnetExample *merged_eg)</div><div class="ttdoc">Merge a set of input examples into a single example (typically the size of &quot;src&quot; will be the minibatc...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00162">nnet-example-utils.cc:162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4ceebc46ef1be292f6b2ff71cc1128ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ceebc46ef1be292f6b2ff71cc1128ee">&#9670;&nbsp;</a></span>MergeExamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MergeExamples </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Merge a set of input examples into a single example (typically the size of "src" will be the minibatch size). </p>
<p>Will crash if "src" is the empty vector. If "compress" is true, it will compress any non-sparse features in the output. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00162">162</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-example-utils_8cc_source.html#l00034">GetIoNames()</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00050">GetIoSizes()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-example-utils_8cc_source.html#l00088">MergeIo()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-example_8cc_source.html#l00256">MergeChainExamples()</a>, <a class="el" href="nnet-discriminative-example_8cc_source.html#l00247">MergeDiscriminativeExamples()</a>, <a class="el" href="nnet-example-test_8cc_source.html#l00067">UnitTestNnetMergeExamples()</a>, and <a class="el" href="nnet-example-utils_8cc_source.html#l01225">ExampleMerger::WriteMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                                           {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!src.empty());</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  std::vector&lt;std::string&gt; io_names;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2f2093173e902d1445fcd80def82ea4b">GetIoNames</a>(src, &amp;io_names);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">// the sizes are the total number of Indexes we have across all examples.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  std::vector&lt;int32&gt; io_sizes;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a9cffcda7d561b7a342c1e268364e7583">GetIoSizes</a>(src, io_names, &amp;io_sizes);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#af1308684fa0a80a9163906b4cdbf0c04">MergeIo</a>(src, io_names, io_sizes, compress, merged_eg);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a2f2093173e902d1445fcd80def82ea4b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2f2093173e902d1445fcd80def82ea4b">kaldi::nnet3::GetIoNames</a></div><div class="ttdeci">static void GetIoNames(const std::vector&lt; NnetExample &gt; &amp;src, std::vector&lt; std::string &gt; *names_vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00034">nnet-example-utils.cc:34</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9cffcda7d561b7a342c1e268364e7583"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9cffcda7d561b7a342c1e268364e7583">kaldi::nnet3::GetIoSizes</a></div><div class="ttdeci">static void GetIoSizes(const std::vector&lt; NnetExample &gt; &amp;src, const std::vector&lt; std::string &gt; &amp;names, std::vector&lt; int32 &gt; *sizes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00050">nnet-example-utils.cc:50</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af1308684fa0a80a9163906b4cdbf0c04"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af1308684fa0a80a9163906b4cdbf0c04">kaldi::nnet3::MergeIo</a></div><div class="ttdeci">static void MergeIo(const std::vector&lt; NnetExample &gt; &amp;src, const std::vector&lt; std::string &gt; &amp;names, const std::vector&lt; int32 &gt; &amp;sizes, bool compress, NnetExample *merged_eg)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00088">nnet-example-utils.cc:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af1308684fa0a80a9163906b4cdbf0c04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1308684fa0a80a9163906b4cdbf0c04">&#9670;&nbsp;</a></span>MergeIo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::MergeIo </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>sizes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>merged_eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00088">88</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="sparse-matrix_8cc_source.html#l00928">kaldi::AppendGeneralMatrixRows()</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00046">NnetIo::features</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-utils_8cc_source.html#l00162">MergeExamples()</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                                            {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// The total number of Indexes we have across all examples.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  int32 num_feats = names.size();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  std::vector&lt;int32&gt; cur_size(num_feats, 0);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// The features in the different NnetIo in the Indexes across all examples</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  std::vector&lt;std::vector&lt;GeneralMatrix const*&gt; &gt; output_lists(num_feats);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// Initialize the merged_eg</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  merged_eg-&gt;io.clear();</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  merged_eg-&gt;io.resize(num_feats);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">for</span> (int32 f = 0; f &lt; num_feats; f++) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    NnetIo &amp;io = merged_eg-&gt;io[f];</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    int32 size = sizes[f];</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(size &gt; 0);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    io.name = names[f];</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    io.indexes.resize(size);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  std::vector&lt;std::string&gt;::const_iterator names_begin = names.begin(),</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                             names_end = names.end();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  std::vector&lt;NnetExample&gt;::const_iterator eg_iter = src.begin(),</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    eg_end = src.end();</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; eg_iter != eg_end; ++eg_iter, ++<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>) {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    std::vector&lt;NnetIo&gt;::const_iterator io_iter = eg_iter-&gt;io.begin(),</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      io_end = eg_iter-&gt;io.end();</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">for</span> (; io_iter != io_end; ++io_iter) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keyword">const</span> NnetIo &amp;io = *io_iter;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      std::vector&lt;std::string&gt;::const_iterator names_iter =</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          std::lower_bound(names_begin, names_end, io.name);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(*names_iter == io.name);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      int32 f = names_iter - names_begin;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      int32 this_size = io.indexes.size();</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      int32 &amp;this_offset = cur_size[f];</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(this_size + this_offset &lt;= sizes[f]);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="comment">// Add f&#39;th Io&#39;s features</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      output_lists[f].push_back(&amp;(io.features));</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="comment">// Work on the Indexes for the f^th Io in merged_eg</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      NnetIo &amp;output_io = merged_eg-&gt;io[f];</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      std::copy(io.indexes.begin(), io.indexes.end(),</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                output_io.indexes.begin() + this_offset);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      std::vector&lt;Index&gt;::iterator output_iter = output_io.indexes.begin();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="comment">// Set the n index to be different for each of the original examples.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = this_offset; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; this_offset + this_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// we could easily support merging already-merged egs, but I don&#39;t see a</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// need for it right now.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_iter[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> == 0 &amp;&amp;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                     <span class="stringliteral">&quot;Merging already-merged egs?  Not currentlysupported.&quot;</span>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        output_iter[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].n = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      this_offset += this_size;  <span class="comment">// note: this_offset is a reference.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cur_size == sizes);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">for</span> (int32 f = 0; f &lt; num_feats; f++) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="group__matrix__group.html#gac4e482ffba86badf4f9bf2c7fa6e5214">AppendGeneralMatrixRows</a>(output_lists[f],</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                            &amp;(merged_eg-&gt;io[f].features));</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (compress) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="comment">// the following won&#39;t do anything if the features were sparse.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      merged_eg-&gt;io[f].features.Compress();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__matrix__group_html_gac4e482ffba86badf4f9bf2c7fa6e5214"><div class="ttname"><a href="group__matrix__group.html#gac4e482ffba86badf4f9bf2c7fa6e5214">kaldi::AppendGeneralMatrixRows</a></div><div class="ttdeci">void AppendGeneralMatrixRows(const std::vector&lt; const GeneralMatrix *&gt; &amp;src, GeneralMatrix *mat)</div><div class="ttdoc">Appends all the matrix rows of a list of GeneralMatrixes, to get a single GeneralMatrix. </div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l00928">sparse-matrix.cc:928</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8d3932735b1229a9b7e8bdce64f3cf1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d3932735b1229a9b7e8bdce64f3cf1a">&#9670;&nbsp;</a></span>MergeSupervision() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MergeSupervision </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision.html">NnetDiscriminativeSupervision</a> *&gt; &amp;&#160;</td>
          <td class="paramname"><em>inputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision.html">NnetDiscriminativeSupervision</a> *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8cc_source.html#l00185">185</a> of file <a class="el" href="nnet-discriminative-example_8cc_source.html">nnet-discriminative-example.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-discriminative-example_8cc_source.html#l00057">NnetDiscriminativeSupervision::CheckDim()</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00071">NnetDiscriminativeSupervision::deriv_weights</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00054">NnetDiscriminativeSupervision::indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="discriminative-supervision_8cc_source.html#l00402">kaldi::discriminative::MergeSupervision()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00045">NnetDiscriminativeSupervision::name</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00058">NnetDiscriminativeSupervision::supervision</a>, and <a class="el" href="discriminative-supervision_8cc_source.html#l00034">DiscriminativeSupervision::Swap()</a>.</p>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                           {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  int32 num_inputs = inputs.size(),</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      num_indexes = 0;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_inputs; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;name == inputs[0]-&gt;name);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    num_indexes += inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;indexes.size();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  output-&gt;name = inputs[0]-&gt;name;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  std::vector&lt;const discriminative::DiscriminativeSupervision*&gt; input_supervision;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  input_supervision.reserve(inputs.size());</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_inputs; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    input_supervision.push_back(&amp;(inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;supervision));</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  discriminative::DiscriminativeSupervision output_supervision;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a8d3932735b1229a9b7e8bdce64f3cf1a">discriminative::MergeSupervision</a>(input_supervision,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                         &amp;output_supervision);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  output-&gt;supervision.Swap(&amp;(output_supervision));</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  output-&gt;indexes.clear();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  output-&gt;indexes.reserve(num_indexes);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">for</span> (int32 n = 0; n &lt; num_inputs; n++) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;src_indexes = inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;indexes;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    int32 cur_size = output-&gt;indexes.size();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    output-&gt;indexes.insert(output-&gt;indexes.end(),</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                           src_indexes.begin(), src_indexes.end());</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    std::vector&lt;Index&gt;::iterator iter = output-&gt;indexes.begin() + cur_size,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        end = output-&gt;indexes.end();</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// change the &#39;n&#39; index to correspond to the index into &#39;input&#39;.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// Each example gets a different &#39;n&#39; value, starting from 0.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter-&gt;n == 0 &amp;&amp; <span class="stringliteral">&quot;Merging already-merged discriminative egs&quot;</span>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      iter-&gt;n = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;indexes.size() == num_indexes);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// OK, at this point the &#39;indexes&#39; will be in the wrong order,</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">// because they should be first sorted by &#39;t&#39; and next by &#39;n&#39;.</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// &#39;sort&#39; will fix this, due to the operator &lt; on type Index.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// TODO: Is this required?</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  std::sort(output-&gt;indexes.begin(), output-&gt;indexes.end());</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">// merge the deriv_weights.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">if</span> (inputs[0]-&gt;deriv_weights.Dim() != 0) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    int32 frames_per_sequence = inputs[0]-&gt;deriv_weights.Dim();</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    output-&gt;deriv_weights.Resize(output-&gt;indexes.size(), <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;deriv_weights.Dim() ==</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                 frames_per_sequence * num_inputs);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">for</span> (int32 n = 0; n &lt; num_inputs; n++) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keyword">const</span> Vector&lt;BaseFloat&gt; &amp;src_deriv_weights = inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;deriv_weights;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src_deriv_weights.Dim() == frames_per_sequence);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="comment">// the ordering of the deriv_weights corresponds to the ordering of the</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="comment">// Indexes, where the time dimension has the greater stride.</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">for</span> (int32 t = 0; t &lt; frames_per_sequence; t++) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        output-&gt;deriv_weights(t * num_inputs + n) = src_deriv_weights(t);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  output-&gt;CheckDim();</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8d3932735b1229a9b7e8bdce64f3cf1a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8d3932735b1229a9b7e8bdce64f3cf1a">kaldi::nnet3::MergeSupervision</a></div><div class="ttdeci">void MergeSupervision(const std::vector&lt; const NnetDiscriminativeSupervision *&gt; &amp;inputs, NnetDiscriminativeSupervision *output)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-discriminative-example_8cc_source.html#l00185">nnet-discriminative-example.cc:185</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a56c6f4427fb48f1e38b8b3b250b687ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56c6f4427fb48f1e38b8b3b250b687ec">&#9670;&nbsp;</a></span>MergeSupervision() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::MergeSupervision </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainSupervision.html">NnetChainSupervision</a> *&gt; &amp;&#160;</td>
          <td class="paramname"><em>inputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainSupervision.html">NnetChainSupervision</a> *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8cc_source.html#l00195">195</a> of file <a class="el" href="nnet-chain-example_8cc_source.html">nnet-chain-example.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-chain-example_8cc_source.html#l00065">NnetChainSupervision::CheckDim()</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00077">NnetChainSupervision::deriv_weights</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00060">NnetChainSupervision::indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-chain-example_8h_source.html#l00046">NnetChainSupervision::name</a>, and <a class="el" href="nnet-chain-example_8h_source.html#l00064">NnetChainSupervision::supervision</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-example_8cc_source.html#l00256">MergeChainExamples()</a>, <a class="el" href="nnet-discriminative-example_8cc_source.html#l00247">MergeDiscriminativeExamples()</a>, and <a class="el" href="nnet-discriminative-example_8h_source.html#l00151">NnetDiscriminativeExampleStructureCompare::operator()()</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                  {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  int32 num_inputs = inputs.size(),</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      num_indexes = 0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_inputs; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;name == inputs[0]-&gt;name);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    num_indexes += inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;indexes.size();</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  output-&gt;name = inputs[0]-&gt;name;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  std::vector&lt;const chain::Supervision*&gt; input_supervision;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  input_supervision.reserve(inputs.size());</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_inputs; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    input_supervision.push_back(&amp;(inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;supervision));</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  chain::Supervision output_supervision;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a56c6f4427fb48f1e38b8b3b250b687ec">MergeSupervision</a>(input_supervision,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                   &amp;output_supervision);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  output-&gt;supervision.Swap(&amp;output_supervision);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  output-&gt;indexes.clear();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  output-&gt;indexes.reserve(num_indexes);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">for</span> (int32 n = 0; n &lt; num_inputs; n++) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;src_indexes = inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;indexes;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    int32 cur_size = output-&gt;indexes.size();</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    output-&gt;indexes.insert(output-&gt;indexes.end(),</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                           src_indexes.begin(), src_indexes.end());</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    std::vector&lt;Index&gt;::iterator iter = output-&gt;indexes.begin() + cur_size,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        end = output-&gt;indexes.end();</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// change the &#39;n&#39; index to correspond to the index into &#39;input&#39;.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// Each example gets a different &#39;n&#39; value, starting from 0.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter-&gt;n == 0 &amp;&amp; <span class="stringliteral">&quot;Merging already-merged chain egs&quot;</span>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      iter-&gt;n = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;indexes.size() == num_indexes);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">// OK, at this point the &#39;indexes&#39; will be in the wrong order,</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// because they should be first sorted by &#39;t&#39; and next by &#39;n&#39;.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">// &#39;sort&#39; will fix this, due to the operator &lt; on type Index.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  std::sort(output-&gt;indexes.begin(), output-&gt;indexes.end());</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">// merge the deriv_weights.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (inputs[0]-&gt;deriv_weights.Dim() != 0) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    int32 frames_per_sequence = inputs[0]-&gt;deriv_weights.Dim();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    output-&gt;deriv_weights.Resize(output-&gt;indexes.size(), <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;deriv_weights.Dim() ==</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                 frames_per_sequence * num_inputs);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">for</span> (int32 n = 0; n &lt; num_inputs; n++) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keyword">const</span> Vector&lt;BaseFloat&gt; &amp;src_deriv_weights = inputs[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]-&gt;deriv_weights;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src_deriv_weights.Dim() == frames_per_sequence);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="comment">// the ordering of the deriv_weights corresponds to the ordering of the</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="comment">// Indexes, where the time dimension has the greater stride.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">for</span> (int32 t = 0; t &lt; frames_per_sequence; t++) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        output-&gt;deriv_weights(t * num_inputs + n) = src_deriv_weights(t);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  output-&gt;CheckDim();</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a56c6f4427fb48f1e38b8b3b250b687ec"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a56c6f4427fb48f1e38b8b3b250b687ec">kaldi::nnet3::MergeSupervision</a></div><div class="ttdeci">static void MergeSupervision(const std::vector&lt; const NnetChainSupervision *&gt; &amp;inputs, NnetChainSupervision *output)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-chain-example_8cc_source.html#l00195">nnet-chain-example.cc:195</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a06e0193dd98dcb1fcebf89a9dd483df6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06e0193dd98dcb1fcebf89a9dd483df6">&#9670;&nbsp;</a></span>Mod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">I kaldi::nnet3::Mod </td>
          <td>(</td>
          <td class="paramtype">I&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">I&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mod(m, n), defined for integers m and n where n &gt; 0, returns the modulus m % n, defined as the integer 0 &lt;= i &lt; n such that i and m are congruent modulo n; for instance, Mod(13, 10) = 3. </p>
<p>This is like the % operation in C/C++, except that it always returns a positive value even for negative m; in 99% of cases where it makes a difference, this is what you want. In the C/C++ standard, the sign of a % b for negative a is not specified (except by relation with the division '/' operator), but in practice it would be &lt;= 0 for almost all implementations. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00106">106</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00164">CreateLoopedComputationRequest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                   {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  I ans = m % <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">if</span> (ans &lt; 0) ans += <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a944dbd968a2a1a9e8998083101702b79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a944dbd968a2a1a9e8998083101702b79">&#9670;&nbsp;</a></span>ModifyNnetIvectorPeriod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ModifyNnetIvectorPeriod </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>ivector_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function modifies the descriptors in the neural network to change the periodicity with which it expects to read an iVector at its input. </p>
<p>We normally train neural networks that expect to see an iVector at frame zero only; this is because we train on fixed-size chunks and the iVector doesn't change that much within each chunk. However, expecting just one iVector isn't that convenient for looped recognition because it changes with time, so we modify the iVector input period in the network by replacing expressions like ReplaceIndex(ivector, t, 0) with Round(ivector, 10) [assuming ivector_period == 10]. The descriptor doesn't have to be named "ivector", it would work for ReplaceIndex(foo, t, 0). This won't work in every conceivable network, but it does do what you want in the cases of interest.</p>
<p>It does this in a rather simple way, by getting the config lines that correspond to descriptors, and doing a search-and-replace. It's maybe not ideal, but it was the easiest way to do it. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-looped_8cc_source.html#l00028">28</a> of file <a class="el" href="nnet-compile-looped_8cc_source.html">nnet-compile-looped.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-parse_8h_source.html#l00071">ConfigLine::FirstToken()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00180">Nnet::GetConfigLines()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-parse_8cc_source.html#l00031">ConfigLine::ParseLine()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="decodable-simple-looped_8cc_source.html#l00056">DecodableNnetSimpleLoopedInfo::Init()</a>, and <a class="el" href="nnet-compile-test_8cc_source.html#l00120">UnitTestNnetCompileLooped()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                         {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ivector_period &gt; 0);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  std::vector&lt;std::string&gt; config_lines;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  nnet-&gt;GetConfigLines(<span class="keyword">false</span>, &amp;config_lines);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  std::ostringstream config_to_read;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; config_lines.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    std::string s = config_lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    ConfigLine config_line;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordtype">bool</span> b = config_line.ParseLine(config_lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(b &amp;&amp; <span class="stringliteral">&quot;Could not parse config line.&quot;</span>);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">if</span> (config_line.FirstToken() == <span class="stringliteral">&quot;component-node&quot;</span>) {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <span class="comment">// What we&#39;re trying to do here is: find a line like:</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="comment">//  component-node name=foo component=foo input=Append(bar, ReplaceIndex(ivector, t, 0))</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="comment">// we want to replace it with something like:</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <span class="comment">// component-node name=foo component=foo input=Append(bar, ReplaceIndex(ivector, t, 0))</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="comment">// .. and we want this to also work if instead of &#39;ivector&#39; it has something like</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="comment">// Scale(0.5, ivector).  We assume that ReplaceIndex() expressions only occur in this</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="comment">// type of context.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      std::string whole_line = config_lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      std::string to_search_for = <span class="stringliteral">&quot;ReplaceIndex(&quot;</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      std::string::size_type to_search_for_size = to_search_for.size();</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      std::string::size_type pos = whole_line.find(to_search_for);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordflow">if</span> (pos != std::string::npos) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        std::string::size_type comma_pos = whole_line.find(<span class="stringliteral">&quot;, t, 0)&quot;</span>, pos);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordflow">if</span> (comma_pos != std::string::npos) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;          <span class="comment">// if the line contained ReplaceIndex(ivector, t, 0),</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;          <span class="comment">// descriptor_name would now be &#39;ivector&#39;.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;          std::string descriptor_name =</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;              whole_line.substr(pos + to_search_for_size,</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                comma_pos - (pos + to_search_for_size));</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;          <span class="comment">// Note: 7, below, is the size of: &quot;, t, 0)&quot;.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;          std::string::size_type end_pos = comma_pos + 7;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;          std::string::size_type expr_size = end_pos - pos;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;          <span class="comment">// e.g. expr_size would be strlen(&quot;ReplaceIndex(ivector, t, 0)&quot;).</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;          std::ostringstream to_replace_with;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;          to_replace_with &lt;&lt; <span class="stringliteral">&quot;Round(&quot;</span> &lt;&lt; descriptor_name &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; ivector_period &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;          whole_line.replace(pos, expr_size, to_replace_with.str());</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;          config_to_read &lt;&lt; whole_line &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Could not process the ReplaceIndex expression in: &quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                    &lt;&lt; whole_line;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">if</span> (!config_to_read.str().empty()) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    std::istringstream is(config_to_read.str());</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    nnet-&gt;ReadConfig(is);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a20e1e086f75487fe19752fd2b34ca627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20e1e086f75487fe19752fd2b34ca627">&#9670;&nbsp;</a></span>MoveSizingCommands()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoveSizingCommands </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This optimization moves commands that allocate and zero matrices to as late as possible, and moves commands that deallocate matrices to as early as possible. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00152">152</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8h_source.html#l00264">MatrixAccesses::accesses</a>, <a class="el" href="nnet-analyze_8h_source.html#l00253">MatrixAccesses::allocate_command</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00284">ComputeCommandAttributes()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00467">ComputeMatrixAccesses()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00421">ComputeVariableAccesses()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00257">MatrixAccesses::deallocate_command</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00133">ComputationVariables::Init()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, and <a class="el" href="nnet-computation_8h_source.html#l00289">kSetConst</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                                                        {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  ComputationVariables variables;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  variables.Init(*computation);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  std::vector&lt;CommandAttributes&gt; attributes;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aa02a576b6e9aa0977f3eb52471742b85">ComputeCommandAttributes</a>(nnet, *computation, variables, &amp;attributes);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  std::vector&lt;std::vector&lt;Access&gt; &gt; variable_accesses;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a474b6a19fd42f428dd178f9af05150a8">ComputeVariableAccesses</a>(variables, attributes, &amp;variable_accesses);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  std::vector&lt;MatrixAccesses&gt; matrix_accesses;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2f107eabc73f1b70436ed117375778c1">ComputeMatrixAccesses</a>(nnet, *computation, variables, attributes,</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                        &amp;matrix_accesses);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// The way we will renumber the commands is, we will first set this vector up</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">// with pairs (command-index * 3, pointer-to-command), and we will then modify</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// the command-indexes in this vector to the numbers that we want, and sort</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="comment">// it.  The reason for the * 3 is so that we can number commands &quot;just-after&quot;</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">// existing indexes (by adding 1) and &quot;just-before&quot; (by subtracting 1).</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  int32 num_commands = computation-&gt;commands.size(),</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      num_matrices = matrix_accesses.size();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">// Matrix allocation commands tend to be followed by a command that zeroes the</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">// matrix.  We want to treat the two commands as a single unit for purposes of</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">// reordering.  is_command_pair[c] will be true if command c is the first</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">// element of such a pair.</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  std::vector&lt;bool&gt; is_command_pair(num_commands, <span class="keyword">false</span>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c + 1 &lt; num_commands; c++) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (computation-&gt;commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a> &amp;&amp;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        computation-&gt;commands[c+1].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a> &amp;&amp;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        computation-&gt;commands[c].arg1 == computation-&gt;commands[c+1].arg1 &amp;&amp;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        computation-&gt;commands[c+1].alpha == 0.0) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      is_command_pair[c] = <span class="keyword">true</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">// &#39;command_reordering&#39; contains (new-number, old-number) of commands.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">// the new-number is multiplied by 3 for reasons explained above.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  std::vector&lt;std::pair&lt;int32,int32&gt; &gt;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      command_reordering(num_commands);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// Note: for now we include the second-elements-of-pairs (i.e.  the zeroing</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// commands that follow allocation commands) here; we&#39;ll ignore them later.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_commands; c++) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    command_reordering[c].first = c * 3;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    command_reordering[c].second = c;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">const</span> MatrixAccesses &amp;ma = matrix_accesses[m];</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// The following if-block relates to reordering of allocation (and,</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// implicitly, zeroing) commands.</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (ma.allocate_command != -1 &amp;&amp;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        computation-&gt;commands[ma.allocate_command].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="comment">// first_access_command will be index of first access, except for the</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="comment">// zeroing command that immediately follows the initialization command.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      int32 first_access_command = -1;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="comment">// this block sets &#39;first_access_command&#39;.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">if</span> (!ma.accesses.empty()) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        first_access_command = ma.accesses[0].command_index;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">if</span> (first_access_command == ma.allocate_command + 1 &amp;&amp;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            is_command_pair[ma.allocate_command]) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          <span class="keywordflow">if</span> (ma.accesses.size() &gt; 1)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            first_access_command = ma.accesses[1].command_index;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            first_access_command = -1;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span> (first_access_command != -1) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(first_access_command &gt; ma.allocate_command);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">// move the initialization command to just before the first access.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        command_reordering[ma.allocate_command].first =</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            first_access_command * 3 - 1;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// The following if-block relates to reordering of deallocation</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// commands.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span> (ma.deallocate_command != -1 &amp;&amp; !ma.accesses.empty() &amp;&amp;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        computation-&gt;commands[ma.deallocate_command].command_type ==</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      int32 last_access_command = ma.accesses.back().command_index;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="comment">// move the deallocation command to just after the last access.</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      command_reordering[ma.deallocate_command].first =</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;          last_access_command * 3 + 1;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  std::sort(command_reordering.begin(), command_reordering.end());</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  std::vector&lt;NnetComputation::Command&gt; reordered_commands;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  reordered_commands.reserve(num_commands);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_commands; c++) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    int32 old_index = command_reordering[c].second;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    NnetComputation::Command &amp;old_command = computation-&gt;commands[old_index];</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// the following assert is because this optimization is not allowed</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// after looped optimization.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(old_command.command_type != <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (old_index &gt; 0 &amp;&amp; is_command_pair[old_index - 1]) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="comment">// If the old command-index was a zeroing command that follows</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="comment">// an allocation command, ignore it; it will be reordered to</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="comment">// right after wherever the allocation command went, and we&#39;ll</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="comment">// deal with it when we deal with the first element of the pair.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      reordered_commands.push_back(computation-&gt;commands[old_index]);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">if</span> (is_command_pair[old_index]) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">// if this command is the first member of an (allocation, zeroing)</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="comment">// pair then we need to deal with the zeroing command as well.</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        reordered_commands.push_back(computation-&gt;commands[old_index + 1]);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  computation-&gt;commands = reordered_commands;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa02a576b6e9aa0977f3eb52471742b85"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa02a576b6e9aa0977f3eb52471742b85">kaldi::nnet3::ComputeCommandAttributes</a></div><div class="ttdeci">void ComputeCommandAttributes(const Nnet &amp;nnet, const NnetComputation &amp;computation, const ComputationVariables &amp;vars, std::vector&lt; CommandAttributes &gt; *attributes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00284">nnet-analyze.cc:284</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a474b6a19fd42f428dd178f9af05150a8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a474b6a19fd42f428dd178f9af05150a8">kaldi::nnet3::ComputeVariableAccesses</a></div><div class="ttdeci">void ComputeVariableAccesses(const ComputationVariables &amp;variables, const std::vector&lt; CommandAttributes &gt; &amp;command_attributes, std::vector&lt; std::vector&lt; Access &gt; &gt; *variable_accesses)</div><div class="ttdoc">After the command-level attributes have been computed, this function organizes them per variable (see...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00421">nnet-analyze.cc:421</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2f107eabc73f1b70436ed117375778c1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2f107eabc73f1b70436ed117375778c1">kaldi::nnet3::ComputeMatrixAccesses</a></div><div class="ttdeci">void ComputeMatrixAccesses(const Nnet &amp;nnet, const NnetComputation &amp;computation, const ComputationVariables &amp;variables, const std::vector&lt; CommandAttributes &gt; &amp;command_attributes, std::vector&lt; MatrixAccesses &gt; *matrix_accesses)</div><div class="ttdoc">This function organizes information in the CommandAttributes in a way that is convenient to access pe...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00467">nnet-analyze.cc:467</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7670f1519ac3d653ed7af20ffaf388f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7670f1519ac3d653ed7af20ffaf388f8">&#9670;&nbsp;</a></span>NameMatchesPattern()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> NameMatchesPattern </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pattern</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00608">608</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l00653">SvdApplier::DecomposeComponents()</a>, <a class="el" href="nnet-utils_8cc_source.html#l01148">ReadEditConfig()</a>, <a class="el" href="nnet-utils_8cc_source.html#l01086">ReduceRankOfComponents()</a>, and <a class="el" href="nnet-parse-test_8cc_source.html#l00263">UnitTestNameMatchesPattern()</a>.</p>
<div class="fragment"><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                                               {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">if</span> (*pattern == <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(name, pattern + 1) ||</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        (*name != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(name + 1, pattern));</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*name == *pattern) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">return</span> (*name == <span class="charliteral">&#39;\0&#39;</span> || <a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(name + 1, pattern + 1));</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a7670f1519ac3d653ed7af20ffaf388f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">kaldi::nnet3::NameMatchesPattern</a></div><div class="ttdeci">bool NameMatchesPattern(const char *name, const char *pattern)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00608">nnet-parse.cc:608</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a81eeaabd042c236a1e0276c353a7d450"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81eeaabd042c236a1e0276c353a7d450">&#9670;&nbsp;</a></span>NnetInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string NnetInfo </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns various info about the neural net. </p>
<p>If the nnet satisfied IsSimpleNnet(nnet), the info includes "left-context=5\nright-context=3\n...". The info includes the output of nnet.Info(). This is modeled after the info that <a class="el" href="classkaldi_1_1nnet3_1_1AmNnetSimple.html">AmNnetSimple</a> returns in its Info() function (we need this in the CTC code). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00483">483</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00146">ComputeSimpleNnetContext()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00821">Nnet::Info()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00669">Nnet::InputDim()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00052">IsSimpleNnet()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00677">Nnet::OutputDim()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils-test_8cc_source.html#l00029">UnitTestNnetContext()</a>.</p>
<div class="fragment"><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                     {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  std::ostringstream ostr;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04">IsSimpleNnet</a>(nnet)) {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    int32 left_context, right_context;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">// this call will crash if the nnet is not &#39;simple&#39;.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">ComputeSimpleNnetContext</a>(nnet, &amp;left_context, &amp;right_context);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    ostr &lt;&lt; <span class="stringliteral">&quot;left-context: &quot;</span> &lt;&lt; left_context &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    ostr &lt;&lt; <span class="stringliteral">&quot;right-context: &quot;</span> &lt;&lt; right_context &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  ostr &lt;&lt; <span class="stringliteral">&quot;input-dim: &quot;</span> &lt;&lt; nnet.InputDim(<span class="stringliteral">&quot;input&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  ostr &lt;&lt; <span class="stringliteral">&quot;ivector-dim: &quot;</span> &lt;&lt; nnet.InputDim(<span class="stringliteral">&quot;ivector&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  ostr &lt;&lt; <span class="stringliteral">&quot;output-dim: &quot;</span> &lt;&lt; nnet.OutputDim(<span class="stringliteral">&quot;output&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  ostr &lt;&lt; <span class="stringliteral">&quot;# Nnet info follows.\n&quot;</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  ostr &lt;&lt; nnet.Info();</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">return</span> ostr.str();</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a88aa85d232ba1ad6e430f6f6dcda29c1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">kaldi::nnet3::ComputeSimpleNnetContext</a></div><div class="ttdeci">void ComputeSimpleNnetContext(const Nnet &amp;nnet, int32 *left_context, int32 *right_context)</div><div class="ttdoc">ComputeSimpleNnetContext computes the left-context and right-context of a nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00146">nnet-utils.cc:146</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a672e127a288d02b4a8e292b86aadfc04"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a672e127a288d02b4a8e292b86aadfc04">kaldi::nnet3::IsSimpleNnet</a></div><div class="ttdeci">bool IsSimpleNnet(const Nnet &amp;nnet)</div><div class="ttdoc">This function returns true if the nnet has the following properties: It has an output called &quot;output&quot;...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00052">nnet-utils.cc:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4cda4da2254dd2dfe1800e4dfeebec38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cda4da2254dd2dfe1800e4dfeebec38">&#9670;&nbsp;</a></span>NnetIsRecurrent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> NnetIsRecurrent </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if 'nnet' has some kind of recurrency. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l01347">1347</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph_8cc_source.html#l00300">GraphHasCycles()</a>, and <a class="el" href="nnet-graph_8cc_source.html#l00030">NnetToDirectedGraph()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00080">TestNnetDecodable()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00246">UnitTestNnetInputDerivatives()</a>, and <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>.</p>
<div class="fragment"><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                                       {</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; graph;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a679a6d66a5e4a3993124bc35597dd06b">NnetToDirectedGraph</a>(nnet, &amp;graph);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a6f107ff3c34b1e2522a1754d9581de0d">GraphHasCycles</a>(graph);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a679a6d66a5e4a3993124bc35597dd06b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a679a6d66a5e4a3993124bc35597dd06b">kaldi::nnet3::NnetToDirectedGraph</a></div><div class="ttdeci">void NnetToDirectedGraph(const Nnet &amp;nnet, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</div><div class="ttdoc">This function takes an nnet and turns it to a directed graph on nodes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00030">nnet-graph.cc:30</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6f107ff3c34b1e2522a1754d9581de0d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6f107ff3c34b1e2522a1754d9581de0d">kaldi::nnet3::GraphHasCycles</a></div><div class="ttdeci">bool GraphHasCycles(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph)</div><div class="ttdoc">This function returns &amp;#39;true&amp;#39; if the graph represented in &amp;#39;graph&amp;#39; contains cycles (including cycles wh...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00300">nnet-graph.cc:300</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac25c4eeb172565878e12ca4355ad9147"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac25c4eeb172565878e12ca4355ad9147">&#9670;&nbsp;</a></span>NnetParametersAreIdentical()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> NnetParametersAreIdentical </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Used for testing that the updatable parameters in two networks are the same. </p>
<p>May crash if structure differs. Prints warning and returns false if parameters differ. E.g. set threshold to 1.0e-05 (it's a relative threshold, applied per component). </p>

<p class="definition">Definition at line <a class="el" href="nnet-test-utils_8cc_source.html#l01786">1786</a> of file <a class="el" href="nnet-test-utils_8cc_source.html">nnet-test-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00689">Nnet::GetComponentName()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-test-utils_8h_source.html#l00048">NnetGenerationOptions::NnetGenerationOptions()</a>, and <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">UnitTestNnetOptimizeWithOptions()</a>.</p>
<div class="fragment"><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                                                               {</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nnet1.NumComponents() == nnet2.NumComponents());</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  int32 num_components = nnet1.NumComponents();</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_components; c++) {</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keyword">const</span> Component *c1 = nnet1.GetComponent(c),</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                    *c2 = nnet2.GetComponent(c);</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c1-&gt;Type() == c2-&gt;Type());</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordflow">if</span> (c1-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      <span class="keyword">const</span> UpdatableComponent *u1 = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(c1),</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                               *u2 = dynamic_cast&lt;const UpdatableComponent*&gt;(c2);</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(u1 != NULL &amp;&amp; u2 != NULL);</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> prod11 = u1-&gt;DotProduct(*u1), prod12 = u1-&gt;DotProduct(*u2),</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                prod21 = u2-&gt;DotProduct(*u1), prod22 = u2-&gt;DotProduct(*u2);</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_prod = std::max(std::max(prod11, prod12),</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                                    std::max(prod21, prod22)),</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;                min_prod = std::min(std::min(prod11, prod12),</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                                    std::min(prod21, prod22));</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      <span class="keywordflow">if</span> (max_prod - min_prod &gt; threshold * max_prod) {</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Component &#39;&quot;</span> &lt;&lt; nnet1.GetComponentName(c)</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;&#39; differs in nnet1 versus nnet2: prod(11,12,21,22) = &quot;</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                   &lt;&lt; prod11 &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; prod12 &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; prod21 &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; prod22;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      }</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    }</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a679a6d66a5e4a3993124bc35597dd06b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a679a6d66a5e4a3993124bc35597dd06b">&#9670;&nbsp;</a></span>NnetToDirectedGraph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NnetToDirectedGraph </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>graph</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes an nnet and turns it to a directed graph on nodes. </p>
<p>This is the reverse of the dependency graph. The nodes will be numbered from 0 to graph-&gt;size() - 1, where graph-&gt;size() == nnet.NumNodes(). For each node-index n, the vector in (*graph)[n] will contain a list of all the nodes that have a direct dependency on node n (in order to compute them). For instance, if n is the output node, (*graph)[n] will be the empty list because no other node will depend on it. </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00030">30</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8h_source.html#l00084">NetworkNode::descriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00146">Nnet::GetNode()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00577">Descriptor::GetNodeDependencies()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kDescriptor</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kDimRange</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00055">kInput</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00090">NetworkNode::node_index</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00082">NetworkNode::node_type</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00126">Nnet::NumNodes()</a>, <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>, and <a class="el" href="structkaldi_1_1nnet3_1_1NetworkNode.html#a1350345f237cf9f9ce2f2e2b39800dd7">NetworkNode::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00265">ComputeNnetComputationEpochs()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00598">FindOrphanNodes()</a>, and <a class="el" href="nnet-utils_8cc_source.html#l01347">NnetIsRecurrent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                                              {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  graph-&gt;clear();</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  int32 num_nodes = nnet.NumNodes();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  graph-&gt;resize(num_nodes);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_nodes; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keyword">const</span> NetworkNode &amp;node = nnet.GetNode(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// handle dependencies of this node.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    std::vector&lt;int32&gt; node_dependencies;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">switch</span> (node.node_type) {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kInput</a>:</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="keywordflow">break</span>;  <span class="comment">// no node dependencies.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kDescriptor</a>:</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        node.descriptor.GetNodeDependencies(&amp;node_dependencies);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kComponent</a>:</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        node_dependencies.push_back(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> - 1);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kDimRange</a>:</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        node_dependencies.push_back(node.u.node_index);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Invalid node type&quot;</span>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;node_dependencies);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; node_dependencies.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      int32 dep_n = node_dependencies[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dep_n &gt;= 0 &amp;&amp; dep_n &lt; num_nodes);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      (*graph)[dep_n].push_back(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a02fee4c0e0e6f1b7ab7a678d61627461">kaldi::nnet3::kComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16aa3512d23926af0e0dad8c3293443d04c">kaldi::nnet3::kInput</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16af6fcd3c520d4fbd679b82fdf40a3ed8b">kaldi::nnet3::kDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acac9cbaeea226ed297804c012dc12b16a6febfa61862690007ae5a50703dd03db">kaldi::nnet3::kDimRange</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00055">nnet-nnet.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a59f9bf54d192e760e406499f997327be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59f9bf54d192e760e406499f997327be">&#9670;&nbsp;</a></span>NormalizeTextDescriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string kaldi::nnet3::NormalizeTextDescriptor </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>node_names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>desc_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor-test_8cc_source.html#l00180">180</a> of file <a class="el" href="nnet-descriptor-test_8cc_source.html">nnet-descriptor-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-descriptor_8cc_source.html#l01006">GeneralDescriptor::ConvertToDescriptor()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00377">DescriptorTokenize()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00585">GeneralDescriptor::Parse()</a>, and <a class="el" href="nnet-descriptor_8cc_source.html#l00510">Descriptor::WriteConfig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00200">UnitTestGeneralDescriptorSpecial()</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                                               {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  std::vector&lt;std::string&gt; tokens;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(desc_str, &amp;tokens);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  tokens.push_back(<span class="stringliteral">&quot;end of input&quot;</span>);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">const</span> std::string *next_token = &amp;(tokens[0]);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html">GeneralDescriptor</a> *gen_desc = GeneralDescriptor::Parse(node_names,</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                                         &amp;next_token);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">if</span> (*next_token != <span class="stringliteral">&quot;end of input&quot;</span>)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Parsing Descriptor, expected end of input but got &quot;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt;  *next_token &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> *desc = gen_desc-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html#a71138fe8137308e15564d18bdc625e4c">ConvertToDescriptor</a>();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  std::ostringstream ostr;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  desc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">WriteConfig</a>(ostr, node_names);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keyword">delete</span> gen_desc;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keyword">delete</span> desc;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Result of normalizing &quot;</span> &lt;&lt; desc_str &lt;&lt; <span class="stringliteral">&quot; is: &quot;</span> &lt;&lt; ostr.str();</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">return</span> ostr.str();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html">kaldi::nnet3::Descriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00525">nnet-descriptor.h:525</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1GeneralDescriptor_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html">kaldi::nnet3::GeneralDescriptor</a></div><div class="ttdoc">This class is only used when parsing Descriptors. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00609">nnet-descriptor.h:609</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac6b64008b19bbb6e8769769cbf96fa68"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">kaldi::nnet3::DescriptorTokenize</a></div><div class="ttdeci">bool DescriptorTokenize(const std::string &amp;input, std::vector&lt; std::string &gt; *tokens)</div><div class="ttdoc">This function tokenizes input when parsing Descriptor configuration values. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00377">nnet-parse.cc:377</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1GeneralDescriptor_html_a71138fe8137308e15564d18bdc625e4c"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html#a71138fe8137308e15564d18bdc625e4c">kaldi::nnet3::GeneralDescriptor::ConvertToDescriptor</a></div><div class="ttdeci">Descriptor * ConvertToDescriptor()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l01006">nnet-descriptor.cc:1006</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html_afd8f0ed4a3e5aaa8e43742b054b71bf2"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">kaldi::nnet3::Descriptor::WriteConfig</a></div><div class="ttdeci">void WriteConfig(std::ostream &amp;os, const std::vector&lt; std::string &gt; &amp;node_names) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00510">nnet-descriptor.cc:510</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ce1aea23a558c0461ff1ab72f41ebb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ce1aea23a558c0461ff1ab72f41ebb6">&#9670;&nbsp;</a></span>NumInputNodes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 NumInputNodes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>returns the number of input nodes of this nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00043">43</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00120">Nnet::IsInputNode()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00126">Nnet::NumNodes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l00052">IsSimpleNnet()</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                      {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; nnet.NumNodes(); <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">if</span> (nnet.IsInputNode(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>))</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      ans++;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2aaea01bc54e382c47d9a0a205489a97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2aaea01bc54e382c47d9a0a205489a97">&#9670;&nbsp;</a></span>NumOutputIndexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::NumOutputIndexes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-merge-egs_8cc_source.html#l00032">32</a> of file <a class="el" href="nnet3-merge-egs_8cc_source.html">nnet3-merge-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                              {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> (eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name.find(<span class="stringliteral">&quot;output&quot;</span>) != std::string::npos)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      <span class="keywordflow">return</span> eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size();</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">return</span> 1;  <span class="comment">// Suppress compiler warning.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab0c3bad5386ea02d61e9596ba76b77eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0c3bad5386ea02d61e9596ba76b77eb">&#9670;&nbsp;</a></span>NumOutputNodes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 NumOutputNodes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>returns the number of output nodes of this nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00035">35</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00126">Nnet::NumNodes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                       {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; nnet.NumNodes(); <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span> (nnet.IsOutputNode(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>))</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      ans++;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a96164bd20d5a66c3c0ca62e30250d46a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96164bd20d5a66c3c0ca62e30250d46a">&#9670;&nbsp;</a></span>NumParameters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 NumParameters </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the total of the number of parameters in the updatable components of the nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00350">350</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00530">UpdatableComponent::NumParameters()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-nnet_8cc_source.html#l00821">Nnet::Info()</a>, <a class="el" href="nnet-general-component_8h_source.html#l00666">ConstantComponent::IsComputable()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00952">LinearComponent::LinearComponent()</a>, <a class="el" href="nnet3-show-progress_8cc_source.html#l00027">main()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00418">AffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00515">BlockAffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00581">RepeatedAffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01523">PerElementScaleComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01625">PerElementOffsetComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01695">ConstantFunctionComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02050">ConvolutionComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02254">LstmNonlinearityComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02506">CompositeComponent::Type()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05748">LstmNonlinearityComponent::UnVectorize()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00392">UnVectorizeNnet()</a>, <a class="el" href="nnet3-combine_8cc_source.html#l00066">UpdateNnetMovingAverage()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05742">LstmNonlinearityComponent::Vectorize()</a>, and <a class="el" href="nnet-utils_8cc_source.html#l00369">VectorizeNnet()</a>.</p>
<div class="fragment"><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                     {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; src.NumComponents(); c++) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keyword">const</span> Component *comp = src.GetComponent(c);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="comment">// For now all updatable components inherit from class UpdatableComponent.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="comment">// If that changes in future, we will change this code.</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keyword">const</span> UpdatableComponent *uc =</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">if</span> (uc == NULL)</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Updatable component does not inherit from class &quot;</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="stringliteral">&quot;UpdatableComponent; change this code.&quot;</span>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      ans += uc-&gt;NumParameters();</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a25df665b8f7a712a34469e53fc875851"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25df665b8f7a712a34469e53fc875851">&#9670;&nbsp;</a></span>NumUpdatableComponents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 NumUpdatableComponents </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the number of updatable components in the nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00413">413</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet_8cc_source.html#l00028">kaldi::nnet2::CombineNnets()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00201">FastNnetCombiner::CombineNnets()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00102">kaldi::nnet2::CombineNnetsA()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00356">FastNnetCombiner::ComputeCurrentNnet()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00031">kaldi::nnet2::GetUpdateDirection()</a>, <a class="el" href="nnet3-show-progress_8cc_source.html#l00027">main()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00027">NnetChainTrainer::NnetChainTrainer()</a>, <a class="el" href="nnet-training_8cc_source.html#l00027">NnetTrainer::NnetTrainer()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00231">PrintVectorPerUpdatableComponent()</a>, and <a class="el" href="nnet-utils_8cc_source.html#l02013">UpdateNnetWithMaxChange()</a>.</p>
<div class="fragment"><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                               {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; dest.NumComponents(); c++) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keyword">const</span> Component *comp = dest.GetComponent(c);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      ans++;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a170051dd847dd17ea4826fe55635fb72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a170051dd847dd17ea4826fe55635fb72">&#9670;&nbsp;</a></span>operator<<() <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream &amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1ComputationGraphBuilder.html#a4da89c69c9a5840ecaa70959af36c492">ComputationGraphBuilder::ComputableInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is to be used in logging only. </p>

<p class="definition">Definition at line <a class="el" href="nnet-computation-graph_8cc_source.html#l00312">312</a> of file <a class="el" href="nnet-computation-graph_8cc_source.html">nnet-computation-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation-graph_8h_source.html#l00164">ComputationGraphBuilder::kComputable</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00165">ComputationGraphBuilder::kNotComputable</a>, <a class="el" href="nnet-computation-graph_8h_source.html#l00163">ComputationGraphBuilder::kUnknown</a>, and <a class="el" href="nnet-computation-graph_8h_source.html#l00166">ComputationGraphBuilder::kWillNotCompute</a>.</p>
<div class="fragment"><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                                                              {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">switch</span> (info) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">case</span> ComputationGraphBuilder::kUnknown: os &lt;&lt; <span class="stringliteral">&quot;kUnknown&quot;</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">case</span> ComputationGraphBuilder::kComputable: os &lt;&lt; <span class="stringliteral">&quot;kComputable&quot;</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">case</span> ComputationGraphBuilder::kNotComputable: os &lt;&lt; <span class="stringliteral">&quot;kNotComputable&quot;</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">case</span> ComputationGraphBuilder::kWillNotCompute: os &lt;&lt; <span class="stringliteral">&quot;kWillNotCompute&quot;</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">default</span>: os &lt;&lt; <span class="stringliteral">&quot;[invalid enum value]&quot;</span>; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">return</span> os;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a5001f1f230fce8994722a8d211ab0b81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5001f1f230fce8994722a8d211ab0b81">&#9670;&nbsp;</a></span>operator<<() <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream &amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>ostream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &amp;&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00424">424</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8h_source.html#l00514">NnetComputation::NnetComputation()</a>, and <a class="el" href="nnet-common_8h_source.html#l00091">IndexLessNxt::operator()()</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                                                  {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">return</span> ostream &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; index.n &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; index.t &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; index.x &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="af4f4752f24d0cdba07dd92e93430b965"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4f4752f24d0cdba07dd92e93430b965">&#9670;&nbsp;</a></span>operator<<() <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream &amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>ostream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &amp;&#160;</td>
          <td class="paramname"><em>cindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00428">428</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                                                    {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordflow">return</span> ostream &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; cindex.first &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; cindex.second &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a63bbb226b5063936684810e9cc6f830a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63bbb226b5063936684810e9cc6f830a">&#9670;&nbsp;</a></span>operator<<() <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; kaldi::nnet3::operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a602819d33d3a59c128aa4e865e610e14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a602819d33d3a59c128aa4e865e610e14">&#9670;&nbsp;</a></span>Optimize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Optimize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>max_output_time_in_request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the top-level function for optimizing a computation. </p>
<p>Note: it should really be called OptimizeAndPostprocess(), because there is at least one thing it does (reordering I/O commands) that is necessary for a computation to be run.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>The options that control, among other things, which optimizations to apply. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nnet</td><td>The neural net for which the computation is being built </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_output_time_in_request</td><td>This value is only needed when the max-deriv-time-relative config value is set in 'config'. It should be set to the largest 't' value encountered in any of the indexes in the 'output' IoSpecifications in the ComputationRequests used to compile the computation. However if there are multiple ComputationRequests (i.e. it was an online computation) you can just set it to any value you want, because backpropagation is not supported so the max-deriv-time-relative configuration value would not have any effect. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">computation</td><td>The computation to be optimized; this function modifies it in-place. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00501">501</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize_8h_source.html#l00051">NnetOptimizeOptions::allocate_from_other</a>, <a class="el" href="nnet-optimize_8h_source.html#l00041">NnetOptimizeOptions::backprop_in_place</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01145">CheckComputation()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00039">NnetOptimizeOptions::consolidate_model_update</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00869">ConsolidateIoOperations()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l01551">ConsolidateModelUpdate()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00045">NnetOptimizeOptions::convert_addition</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00430">ConvertAdditionToAssignment()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00044">NnetOptimizeOptions::extend_matrices</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l01270">ExtendMatrices()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04552">FixGotoLabel()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01439">GetMaxMemoryUse()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00049">NnetOptimizeOptions::initialize_undefined</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02215">LimitDerivativeTimes()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00053">NnetOptimizeOptions::max_deriv_time</a>, <a class="el" href="nnet-optimize_8h_source.html#l00054">NnetOptimizeOptions::max_deriv_time_relative</a>, <a class="el" href="nnet-optimize_8h_source.html#l00056">NnetOptimizeOptions::memory_compression_level</a>, <a class="el" href="nnet-optimize_8h_source.html#l00052">NnetOptimizeOptions::min_deriv_time</a>, <a class="el" href="nnet-optimize_8h_source.html#l00050">NnetOptimizeOptions::move_sizing_commands</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00152">MoveSizingCommands()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00038">NnetOptimizeOptions::optimize</a>, <a class="el" href="nnet-optimize_8h_source.html#l00060">NnetOptimizeOptions::optimize_looped_computation</a>, <a class="el" href="nnet-optimize_8h_source.html#l00042">NnetOptimizeOptions::optimize_row_ops</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04544">OptimizeLoopedComputation()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04899">OptimizeMemoryCompression()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00040">NnetOptimizeOptions::propagate_in_place</a>, <a class="el" href="nnet-optimize_8h_source.html#l00046">NnetOptimizeOptions::remove_assignments</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00355">RemoveUnnecessaryAllocation()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00262">RemoveUnnecessaryZeroing()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">RenumberComputation()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02288">ReplaceRowWithMatrixOps()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00055">NnetOptimizeOptions::snip_row_ops</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02537">SnipRowOps()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00043">NnetOptimizeOptions::split_row_ops</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02894">SplitRowOps()</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00417">VariableMergingOptimization()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-looped_8cc_source.html#l00284">CompileLoopedInternal()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00741">CachingOptimizingCompiler::CompileNoShortcut()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l03892">ComputationLoopedOptimizer::ComputationLoopedOptimizer()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04703">MemoryCompressionOptimizer::MemoryCompressionOptimizer()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00084">NnetOptimizeOptions::Register()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>, and <a class="el" href="nnet-derivative-test_8cc_source.html#l00246">UnitTestNnetInputDerivatives()</a>.</p>
<div class="fragment"><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                                            {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">true</span>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Before optimization, max memory use (bytes) = &quot;</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;              &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#ab753d835b665dd1b444b16f045c3e1a3">GetMaxMemoryUse</a>(*computation);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  }</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  { <span class="comment">// Call LimitDerivativeTimes(); it&#39;s important that this</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// should come before other optimizations (search for &quot;insist&quot; in</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="comment">// nnet-optimize-utils.cc for the reasons).</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">// this will do nothing unless --min-deriv-time or --max-deriv-time</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// or --max-deriv-time-relative was set.</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    int32 max_deriv_time = config.max_deriv_time;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span> (config.max_deriv_time_relative != std::numeric_limits&lt;int32&gt;::max())</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      max_deriv_time = config.max_deriv_time_relative +</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          max_output_time_in_request;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (config.min_deriv_time != std::numeric_limits&lt;int32&gt;::min() ||</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        max_deriv_time != std::numeric_limits&lt;int32&gt;::max())</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a6ed9b871bd28649b80165dc1af5d1a98">LimitDerivativeTimes</a>(nnet, config.min_deriv_time,</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                           max_deriv_time, computation);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">true</span>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordflow">if</span> (config.optimize &amp;&amp; config.consolidate_model_update) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#af512f7de6c401fbdf7013d62295df9c2">ConsolidateModelUpdate</a>(nnet, computation);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">true</span>);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">if</span> (config.optimize &amp;&amp; config.convert_addition) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac759ea60772df625784bcc714f7a41da">ConvertAdditionToAssignment</a>(nnet, computation);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">true</span>);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordflow">if</span> (config.optimize &amp;&amp;  (config.snip_row_ops || config.optimize_row_ops ||</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                           config.split_row_ops)) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordtype">bool</span> must_renumber = <span class="keyword">false</span>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">if</span> (config.snip_row_ops &amp;&amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a590c38bb0c9acc4ad1f626237f1a4169">SnipRowOps</a>(computation))</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      must_renumber = <span class="keyword">true</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">if</span> (config.split_row_ops &amp;&amp; <a class="code" href="namespacekaldi_1_1nnet3.html#acd48d2ca65dc0a73952effbec24ccfb1">SplitRowOps</a>(computation))</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      must_renumber = <span class="keyword">true</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">if</span> (config.optimize_row_ops &amp;&amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a281a103d9beaef2e5d64370754800cd1">ReplaceRowWithMatrixOps</a>(computation))</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      must_renumber = <span class="keyword">true</span>;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (must_renumber) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">RenumberComputation</a>(computation);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordflow">if</span> (config.optimize &amp;&amp; config.extend_matrices &amp;&amp;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      !config.optimize_looped_computation) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a1adea5ddcf5f2d26ee01d796ec13510c">ExtendMatrices</a>(computation);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  }</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">if</span> (config.optimize &amp;&amp;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      (config.remove_assignments || config.backprop_in_place ||</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;       config.propagate_in_place)) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a7918fc2d6dfa22dbc84913c63be8771b">VariableMergingOptimization</a>(config, nnet, computation);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">if</span> (config.optimize &amp;&amp; config.initialize_undefined) {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd">RemoveUnnecessaryZeroing</a>(nnet, computation);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">if</span> ((config.optimize &amp;&amp; config.move_sizing_commands) ||</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      config.optimize_looped_computation) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a20e1e086f75487fe19752fd2b34ca627">MoveSizingCommands</a>(nnet, computation);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">// the looped computation optimization has to go before</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">// &#39;RemoveUnnecessaryAllocation()&#39;.  We don&#39;t gate this by &#39;config.optimize&#39;</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="comment">// because it&#39;s necessary for looped computation to run.</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordflow">if</span> (config.optimize_looped_computation) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#abb347167ff71d1cd8a2ab35b6eb2f636">OptimizeLoopedComputation</a>(nnet, computation);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">if</span> (config.optimize &amp;&amp; config.allocate_from_other &amp;&amp;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      !config.optimize_looped_computation) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">// Don&#39;t do this if it&#39;s an looped computation because we&#39;re not sure if it</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// would be correct in that case, as written.  In any case the performance</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// benefit is tiny.</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a92c251003c3f612c5cfbcbd72cbd030b">RemoveUnnecessaryAllocation</a>(nnet, computation);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="comment">// The following is not configurable because it is necessary for</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">// the computation to run correctly (we do it after compilation too,</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">// but the operations may have been put out of order by</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">// other optimizations.)</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aa6233bfcefa3af15d41a8e565911a249">ConsolidateIoOperations</a>(nnet, computation);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordflow">if</span> (config.optimize_looped_computation)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">FixGotoLabel</a>(computation);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="keywordflow">if</span> (config.memory_compression_level &gt; 0 &amp;&amp;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      !config.optimize_looped_computation) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade">OptimizeMemoryCompression</a>(nnet, config.memory_compression_level,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                              computation);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3)</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 3) {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">CheckComputation</a>(nnet, *computation, <span class="keyword">false</span>);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;After optimization, max memory use (bytes) = &quot;</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;              &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#ab753d835b665dd1b444b16f045c3e1a3">GetMaxMemoryUse</a>(*computation);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_acd48d2ca65dc0a73952effbec24ccfb1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acd48d2ca65dc0a73952effbec24ccfb1">kaldi::nnet3::SplitRowOps</a></div><div class="ttdeci">bool SplitRowOps(NnetComputation *computation)</div><div class="ttdoc">This function detects cases where commands of type kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti use indexes that correspond to at most two submatrices, in two distinct ranges without gaps filled by -1&amp;#39;s, and could be converted to at most two commands of type kMatrixAdd, kMatrixCopy, kAddRows or kCopyRows. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02894">nnet-optimize-utils.cc:2894</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_abb347167ff71d1cd8a2ab35b6eb2f636"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abb347167ff71d1cd8a2ab35b6eb2f636">kaldi::nnet3::OptimizeLoopedComputation</a></div><div class="ttdeci">void OptimizeLoopedComputation(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This function tries to optimize computation &amp;#39;computation&amp;#39; for an &amp;#39;looped&amp;#39; computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04544">nnet-optimize-utils.cc:4544</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa6233bfcefa3af15d41a8e565911a249"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa6233bfcefa3af15d41a8e565911a249">kaldi::nnet3::ConsolidateIoOperations</a></div><div class="ttdeci">void ConsolidateIoOperations(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization puts the input operations (kAcceptInput) and output operations (kProvideOutput) at ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00869">nnet-optimize.cc:869</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6828e427bd8883455705e0c9b99b5f2f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">kaldi::nnet3::RenumberComputation</a></div><div class="ttdeci">void RenumberComputation(NnetComputation *computation)</div><div class="ttdoc">This function detects submatrices and matrices that are never used (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00693">nnet-optimize-utils.cc:693</a></div></div>
<div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7918fc2d6dfa22dbc84913c63be8771b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7918fc2d6dfa22dbc84913c63be8771b">kaldi::nnet3::VariableMergingOptimization</a></div><div class="ttdeci">void VariableMergingOptimization(const NnetOptimizeOptions &amp;config, const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This wraps class VariableMergingOptimizer in a simplified interface. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00417">nnet-optimize.cc:417</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac759ea60772df625784bcc714f7a41da"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac759ea60772df625784bcc714f7a41da">kaldi::nnet3::ConvertAdditionToAssignment</a></div><div class="ttdeci">void ConvertAdditionToAssignment(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This converts addition operations (things with Add in their names) to copy operations (things with Co...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00430">nnet-optimize.cc:430</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1adea5ddcf5f2d26ee01d796ec13510c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1adea5ddcf5f2d26ee01d796ec13510c">kaldi::nnet3::ExtendMatrices</a></div><div class="ttdeci">void ExtendMatrices(NnetComputation *computation)</div><div class="ttdoc">This is not really an optimization in itself but it can make things easier for class VariableMergingO...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l01270">nnet-optimize-utils.cc:1270</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6ed9b871bd28649b80165dc1af5d1a98"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6ed9b871bd28649b80165dc1af5d1a98">kaldi::nnet3::LimitDerivativeTimes</a></div><div class="ttdeci">void LimitDerivativeTimes(const Nnet &amp;nnet, int32 min_deriv_time, int32 max_deriv_time, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02215">nnet-optimize-utils.cc:2215</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a10b449e04f7115cc85d295440638fade"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a10b449e04f7115cc85d295440638fade">kaldi::nnet3::OptimizeMemoryCompression</a></div><div class="ttdeci">void OptimizeMemoryCompression(const Nnet &amp;nnet, int32 memory_compression_level, NnetComputation *computation)</div><div class="ttdoc">Performs optimization to reduce memory usage where possible, making use of the kCompressMatrix and kD...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04899">nnet-optimize-utils.cc:4899</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a20e1e086f75487fe19752fd2b34ca627"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a20e1e086f75487fe19752fd2b34ca627">kaldi::nnet3::MoveSizingCommands</a></div><div class="ttdeci">void MoveSizingCommands(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization moves commands that allocate and zero matrices to as late as possible, and moves commands that deallocate matrices to as early as possible. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00152">nnet-optimize.cc:152</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab753d835b665dd1b444b16f045c3e1a3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab753d835b665dd1b444b16f045c3e1a3">kaldi::nnet3::GetMaxMemoryUse</a></div><div class="ttdeci">int64 GetMaxMemoryUse(const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01439">nnet-analyze.cc:1439</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a92c251003c3f612c5cfbcbd72cbd030b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a92c251003c3f612c5cfbcbd72cbd030b">kaldi::nnet3::RemoveUnnecessaryAllocation</a></div><div class="ttdeci">void RemoveUnnecessaryAllocation(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization detects cases where we deallocate a matrix, and then later allocate another matrix ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00355">nnet-optimize.cc:355</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aae053839b5ed781f2f7408489a1528dd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd">kaldi::nnet3::RemoveUnnecessaryZeroing</a></div><div class="ttdeci">void RemoveUnnecessaryZeroing(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization function removes, where possible, commands of type type kSetConst. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00262">nnet-optimize.cc:262</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a281a103d9beaef2e5d64370754800cd1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a281a103d9beaef2e5d64370754800cd1">kaldi::nnet3::ReplaceRowWithMatrixOps</a></div><div class="ttdeci">bool ReplaceRowWithMatrixOps(NnetComputation *computation)</div><div class="ttdoc">This function detects cases where commands of type kCopyRows, kAddRows or kAddToRows can be converted...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02288">nnet-optimize-utils.cc:2288</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8953a6af8e449d7cc12efeb115c5f8d2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">kaldi::nnet3::FixGotoLabel</a></div><div class="ttdeci">void FixGotoLabel(NnetComputation *computation)</div><div class="ttdoc">This function ensures that the arg1 of a final command of type kGotoLabel is the same as the command ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04552">nnet-optimize-utils.cc:4552</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af512f7de6c401fbdf7013d62295df9c2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af512f7de6c401fbdf7013d62295df9c2">kaldi::nnet3::ConsolidateModelUpdate</a></div><div class="ttdeci">void ConsolidateModelUpdate(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization consolidates the model-update part of backprop commands, for components in (e...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l01551">nnet-optimize-utils.cc:1551</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acfaf4324ca78917f262c1c733846370e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acfaf4324ca78917f262c1c733846370e">kaldi::nnet3::CheckComputation</a></div><div class="ttdeci">void CheckComputation(const Nnet &amp;nnet, const NnetComputation &amp;computation, bool check_rewrite)</div><div class="ttdoc">This is a convenience interface for class ComputationChecker. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01145">nnet-analyze.cc:1145</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a590c38bb0c9acc4ad1f626237f1a4169"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a590c38bb0c9acc4ad1f626237f1a4169">kaldi::nnet3::SnipRowOps</a></div><div class="ttdeci">bool SnipRowOps(NnetComputation *computation)</div><div class="ttdoc">This function detects cases where commands of type kCopyRows, kAddRows, kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti or kAddRowRanges use indexes that start or end with -1&amp;#39;s or equivalents, and replace them with similar commands that act on a sub-matrix of the matrices they are currently acting on. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02537">nnet-optimize-utils.cc:2537</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb347167ff71d1cd8a2ab35b6eb2f636"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb347167ff71d1cd8a2ab35b6eb2f636">&#9670;&nbsp;</a></span>OptimizeLoopedComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OptimizeLoopedComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function tries to optimize computation 'computation' for an 'looped' computation. </p>
<p>It expects as input a computation with no backprop but with multiple 'segments' separated by command kNoOperationLabel, where each segment corresponds to a new chunk of input and output. It tries to locate a pair of segment boundaries, with command indexes c1 and c2, where the active matrices have the same debug-info other than a time offset and can be identified with each other, and the no-op command at c2 can be replaced with 'got c1', creating a computation that 'goes on forever'. If it can't do this, it does nothing. You can figure out that this is the case by checking whether kGotoLabel is the last command in the computation. [If this optimization fails, the whole computation may have to be regenerated with more segments.] </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04544">4544</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l04473">ComputationLoopedOptimizer::Optimize()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;                                                             {</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;  ComputationLoopedOptimizer optimizer(nnet, computation);</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;  optimizer.Optimize();</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a10b449e04f7115cc85d295440638fade"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10b449e04f7115cc85d295440638fade">&#9670;&nbsp;</a></span>OptimizeMemoryCompression()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OptimizeMemoryCompression </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>memory_compression_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs optimization to reduce memory usage where possible, making use of the kCompressMatrix and kDecompressMatrix commands. </p>
<p>Should only be done after most other optimizations, because some optimizations (such as variable-merging) would not work correctly after doing this optimization. This does nothing for looped computations. It's OK, though, to expand a shortcut computation (i.e. call ExpandComputation) after doing this.</p>
<p>memory_compression_level determines how aggressive the compression is. Allowed values: 0 = no compression at all 1 = compression that doesn't affect results (e.g. compress ReLU outputs to 1 byte, as just the sign is needed). 2 = compression that may affect the results slightly (e.g. 16-bit compression of the output of <a class="el" href="classkaldi_1_1nnet3_1_1NormalizeComponent.html">NormalizeComponent</a> and the like), but this is not implemented yet, so equivalent to 1. 3 = compression that may affect the results more than just slightly. Not implemented yet, so equivalent to 1. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04899">4899</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01439">GetMaxMemoryUse()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationMarker</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l04803">MemoryCompressionOptimizer::Optimize()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;                                                             {</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;  <span class="keywordflow">if</span> (memory_compression_level == 0 || computation-&gt;commands.empty())</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;  <span class="comment">// don&#39;t apply this optimization to looped computations.</span></div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;  <span class="keywordflow">if</span> (computation-&gt;commands.back().command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>)</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;</div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;  <span class="comment">// &#39;middle_command&#39; will be the index of the command of type</span></div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;  <span class="comment">// &#39;kNoOperationMarker&#39; that separates the forward and backward</span></div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;  <span class="comment">// passes.  If it doesn&#39;t exist, it means this computation doesn&#39;t</span></div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;  <span class="comment">// include</span></div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;  int32 middle_command = -1;</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; computation-&gt;commands.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;    <span class="keywordflow">if</span> (computation-&gt;commands[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>) {</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;      <span class="keywordflow">if</span> (middle_command &lt; 0) {</div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;        middle_command = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Found more than one command of type kNoOperationMarker &quot;</span></div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;            <span class="stringliteral">&quot;in non-looped computation.&quot;</span>;</div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;        <span class="comment">// there are more than one command of this type... this wasn&#39;t expected.</span></div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;        <span class="comment">// return (i.e. do nothing).</span></div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;      }</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    }</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;  }</div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;  <span class="keywordflow">if</span> (middle_command == -1) {</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// This computation doesn&#39;t have a backprop pass.</span></div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;  }</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;  <span class="keywordflow">if</span> (memory_compression_level &gt;= 1) {</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;    int64 bytes_used_initial, bytes_used_final;</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;    <span class="keywordtype">bool</span> verbose_ge_2 = <a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 2;</div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;    <span class="keywordflow">if</span> (verbose_ge_2)</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;      bytes_used_initial = <a class="code" href="namespacekaldi_1_1nnet3.html#ab753d835b665dd1b444b16f045c3e1a3">GetMaxMemoryUse</a>(*computation);</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;</div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;    MemoryCompressionOptimizer opt(nnet, memory_compression_level,</div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;                                   middle_command, computation);</div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;    opt.Optimize();</div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;</div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;    <span class="keywordflow">if</span> (verbose_ge_2) {</div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;      bytes_used_final = <a class="code" href="namespacekaldi_1_1nnet3.html#ab753d835b665dd1b444b16f045c3e1a3">GetMaxMemoryUse</a>(*computation);</div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;      <span class="keywordflow">if</span> (bytes_used_final != bytes_used_initial) {</div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;        <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Memory compression reduced  memory use from &quot;</span></div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;                      &lt;&lt; bytes_used_initial &lt;&lt; <span class="stringliteral">&quot; to &quot;</span></div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;                      &lt;&lt; bytes_used_final &lt;&lt; <span class="stringliteral">&quot; bytes.&quot;</span>;</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;      }</div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;    }</div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;  }</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;}</div><div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab753d835b665dd1b444b16f045c3e1a3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab753d835b665dd1b444b16f045c3e1a3">kaldi::nnet3::GetMaxMemoryUse</a></div><div class="ttdeci">int64 GetMaxMemoryUse(const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01439">nnet-analyze.cc:1439</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3f86f51631eb5ef716068c6320f1a19c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f86f51631eb5ef716068c6320f1a19c">&#9670;&nbsp;</a></span>ParseConfigLines()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ParseConfigLines </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>lines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> &gt; *&#160;</td>
          <td class="paramname"><em>config_lines</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function converts config-lines from a simple sequence of strings as output by <a class="el" href="namespacekaldi_1_1nnet3.html#a331cfb436079c33852b5514e6691f6be" title="This function reads in a config file and *appends* its contents to a vector of lines; it is responsib...">ReadConfigLines()</a>, into a sequence of first-tokens and name-value pairs. </p>
<p>The general format is: "command-type bar=baz xx=yyy" etc., although there are subtleties as to what exactly is allowed, see documentation for class <a class="el" href="classkaldi_1_1nnet3_1_1ConfigLine.html" title="This class is responsible for parsing input like hi-there xx=yyy a=b c empty= f-oo=Append(bar, sss) ba_z=123 bing=&#39;a b c&#39; baz=&quot;a b c d=&#39;a b&#39; e&quot; and giving you access to the fields, in this case. ">ConfigLine</a> for details. This function will die if there was a parsing failure. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00597">597</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, and <a class="el" href="nnet-utils_8cc_source.html#l01148">ReadEditConfig()</a>.</p>
<div class="fragment"><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                                           {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  config_lines-&gt;resize(lines.size());</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; lines.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordtype">bool</span> ret = (*config_lines)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].ParseLine(lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (!ret) {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Error parsing config line: &quot;</span> &lt;&lt; lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0e18825b4c5b0834e638296b2f5bb35a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e18825b4c5b0834e638296b2f5bb35a">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[1/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function used in Init routines. </p>
<p>Suppose name=="foo", if "string" has a field like foo=12, this function will set "param" to 12 and remove that element from "string". It returns true if the parameter was read. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00241">241</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="text-utils_8h_source.html#l00118">kaldi::ConvertStringToInteger()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                   {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len), param))</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a39eb3f7ce5fab6dbbcb396b3f8e196f4"><div class="ttname"><a href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">kaldi::ConvertStringToInteger</a></div><div class="ttdeci">bool ConvertStringToInteger(const std::string &amp;str, Int *out)</div><div class="ttdoc">Converts a string into an integer via strtoll and returns false if there was any kind of problem (i...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00118">text-utils.h:118</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a06c170854db9a3b5bb3915dfb52380c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06c170854db9a3b5bb3915dfb52380c2">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[2/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a> *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of ParseFromString is for parameters of type bool, which can appear as any string beginning with f, F, t or T. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00267">267</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                                  {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      std::string b = split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">if</span> (b.empty())</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">if</span> (b[0] == <span class="charliteral">&#39;f&#39;</span> || b[0] == <span class="charliteral">&#39;F&#39;</span>) *param = <span class="keyword">false</span>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b[0] == <span class="charliteral">&#39;t&#39;</span> || b[0] == <span class="charliteral">&#39;T&#39;</span>) *param = <span class="keyword">true</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7eac951c4af19775f3ba550efa12f385"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7eac951c4af19775f3ba550efa12f385">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[3/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of ParseFromString is for parameters of type BaseFloat. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00298">298</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="text-utils_8cc_source.html#l00238">kaldi::ConvertStringToReal()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                       {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">ConvertStringToReal</a>(split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len), param))</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa624cc5f189fcc01469558a0865c1f3c"><div class="ttname"><a href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">kaldi::ConvertStringToReal</a></div><div class="ttdeci">bool ConvertStringToReal(const std::string &amp;str, T *out)</div><div class="ttdoc">ConvertStringToReal converts a string into either float or double and returns false if there was any ...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00238">text-utils.cc:238</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afd5f31afe3e5137b700d0af4fbb13211"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd5f31afe3e5137b700d0af4fbb13211">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[4/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of ParseFromString is for parsing strings. </p>
<p>(these should not contain space). </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00324">324</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                       {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      *param = split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f7f50f1457000af31efe2ecd53f983a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f7f50f1457000af31efe2ecd53f983a">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[5/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of ParseFromString handles colon-separated or comma-separated lists of integers. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00350">350</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="text-utils_8h_source.html#l00068">kaldi::SplitStringToIntegers()</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                              {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#ae95740f87fc2fb79419753e21396c647">SplitStringToIntegers</a>(split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len), <span class="stringliteral">&quot;:,&quot;</span>,</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                 <span class="keyword">false</span>, param))</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ae95740f87fc2fb79419753e21396c647"><div class="ttname"><a href="namespacekaldi.html#ae95740f87fc2fb79419753e21396c647">kaldi::SplitStringToIntegers</a></div><div class="ttdeci">bool SplitStringToIntegers(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; I &gt; *out)</div><div class="ttdoc">Split a string (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00068">text-utils.h:68</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3fbd67899f39d18e85c03f06e0c69bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3fbd67899f39d18e85c03f06e0c69bf">&#9670;&nbsp;</a></span>ParsingContext()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static std::string kaldi::nnet3::ParsingContext </td>
          <td>(</td>
          <td class="paramtype">const std::string *&#160;</td>
          <td class="paramname"><em>token_ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor_8cc_source.html#l00029">29</a> of file <a class="el" href="nnet-descriptor_8cc_source.html">nnet-descriptor.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor_8cc_source.html#l00045">ExpectToken()</a>, and <a class="el" href="nnet-descriptor_8cc_source.html#l00056">ReadIntegerToken()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                                            {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">if</span> (*token_ptr == <span class="stringliteral">&quot;end of input&quot;</span>)</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  std::string next_few_tokens = <span class="stringliteral">&quot;, next part of line is: &quot;</span>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="comment">// in the next line, *token_ptr should never equal &quot;&quot; but it&#39;s to mitigate the</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="comment">// effect of bugs where we read past the end of the array.</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">while</span> (*token_ptr != <span class="stringliteral">&quot;end of input&quot;</span> &amp;&amp; *token_ptr != <span class="stringliteral">&quot;&quot;</span> &amp;&amp;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;         next_few_tokens.size() &lt; 40) {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    next_few_tokens = (next_few_tokens + <span class="stringliteral">&quot; &quot;</span>) + *token_ptr;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    token_ptr++;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  }</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">if</span> (*token_ptr != <span class="stringliteral">&quot;end of input&quot;</span>)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    next_few_tokens = next_few_tokens + <span class="stringliteral">&quot; ...&quot;</span>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">return</span> next_few_tokens;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a807b8aabb93f3ae097cc93629d5b8410"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a807b8aabb93f3ae097cc93629d5b8410">&#9670;&nbsp;</a></span>PerturbImage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::PerturbImage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html">ImageAugmentationConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>image</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function randomly modifies (perturbs) the image by applying different geometric transformations according to the options in 'config'. </p>
<p>References: "Digital Image Processing book by Gonzalez and Woods" and "Keras: github.com/fchollet/keras/blob/master/keras/preprocessing/image.py" </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Configuration class that says how to perturb the image. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">image</td><td>The image matrix to be modified. image-&gt;NumRows() is the width (number of x values) in the image; image-&gt;NumCols() is the height times number of channels/colors (channel varies the fastest). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00205">205</a> of file <a class="el" href="nnet3-egs-augment-image_8cc_source.html">nnet3-egs-augment-image.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-matrix_8cc_source.html#l00170">MatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01740">MatrixBase&lt; Real &gt;::AddMatMatMat()</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00110">ApplyAffineTransform()</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00073">ImageAugmentationConfig::Check()</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00084">ImageAugmentationConfig::GetFillMode()</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00035">ImageAugmentationConfig::horizontal_flip_prob</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00036">ImageAugmentationConfig::horizontal_shift</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01889">MatrixBase&lt; Real &gt;::IsUnit()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="kaldi-math_8h_source.html#l00044">M_PI</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00034">ImageAugmentationConfig::num_channels</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-math_8h_source.html#l00151">kaldi::RandUniform()</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00038">ImageAugmentationConfig::rotation_degree</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00039">ImageAugmentationConfig::rotation_prob</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01347">MatrixBase&lt; Real &gt;::SetUnit()</a>, <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00037">ImageAugmentationConfig::vertical_shift</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00071">kaldi::WithProb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00302">PerturbImageInNnetExample()</a>.</p>
<div class="fragment"><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                                {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a4c47fd4f163011eb1939870d25aa656a">Check</a>();</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980">FillMode</a> fill_mode = config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#ac0b21c2fb4d5e1aab60f0e06dde8d69f">GetFillMode</a>();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  int32 image_width = image-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(),</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      num_channels = config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a83ca9a40870c7dfbe4e799768246206e">num_channels</a>,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      image_height = image-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>() / num_channels;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">if</span> (image-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>() % num_channels != 0) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Number of columns in image must divide the number &quot;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="stringliteral">&quot;of channels&quot;</span>;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">// We do an affine transform which</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">// handles flipping, translation, rotation, magnification, and shear.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> transform_mat(3, 3, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  transform_mat.SetUnit();</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> shift_mat(3, 3, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  shift_mat.SetUnit();</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// translation (shift) mat:</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// [ 1   0  x_shift</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">//   0   1  y_shift</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">//   0   0  1       ]</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> horizontal_shift = (2.0 * <a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>() - 1.0) *</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a007febaebc9c6c16168f16f942295846">horizontal_shift</a> * image_width;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> vertical_shift = (2.0 * <a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>() - 1.0) *</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a9e59cf0d43e877ec51808580b79f8f5d">vertical_shift</a> * image_height;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  shift_mat(0, 2) = round(horizontal_shift);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  shift_mat(1, 2) = round(vertical_shift);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">// since we will center the image before applying the transform,</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">// horizontal flipping is simply achieved by setting [0, 0] to -1:</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a418c782c2df97dc179125ae5ad950338">WithProb</a>(config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a3b8bd277c3bbd81a7115175cfc43b4b7">horizontal_flip_prob</a>))</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    shift_mat(0, 0) = -1.0;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> rotation_mat(3, 3, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  rotation_mat.SetUnit();</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">// rotation mat:</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">// [ cos(theta)  -sin(theta)  0</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">//   sin(theta)  cos(theta)   0</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">//   0           0            1 ]</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>() &lt;= config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a9e320d1a46febdc7eed2177406f4562f">rotation_prob</a>) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> theta = (2 * config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a15c62191964d05517fc195d2b7586c93">rotation_degree</a> * <a class="code" href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">RandUniform</a>() -</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                       config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a15c62191964d05517fc195d2b7586c93">rotation_degree</a>) / 180.0 * <a class="code" href="kaldi-math_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    rotation_mat(0, 0) = cos(theta);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    rotation_mat(0, 1) = -sin(theta);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    rotation_mat(1, 0) = sin(theta);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    rotation_mat(1, 1) = cos(theta);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> shear_mat(3, 3, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  shear_mat.SetUnit();</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// shear mat:</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">// [ 1    -sin(shear)   0</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">//   0     cos(shear)   0</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">//   0     0            1 ]</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> zoom_mat(3, 3, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  zoom_mat.SetUnit();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">// zoom mat:</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// [ x_zoom   0   0</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">//   0   y_zoom   0</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">//   0     0      1 ]</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// transform_mat = rotation_mat * shift_mat * shear_mat * zoom_mat:</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  transform_mat.AddMatMat(1.0, shift_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                          shear_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  transform_mat.AddMatMatMat(1.0, rotation_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                             transform_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                             zoom_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">if</span> (transform_mat.IsUnit())  <span class="comment">// nothing to do</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">// we should now change the origin of transform to the center of</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">// the image (necessary for flipping, zoom, shear, and rotation)</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// we do this by using two translations: one before the main transform</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">// and one after.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> set_origin_mat(3, 3, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  set_origin_mat.SetUnit();</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  set_origin_mat(0, 2) = image_width / 2.0 - 0.5;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  set_origin_mat(1, 2) = image_height / 2.0 - 0.5;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> reset_origin_mat(3, 3, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  reset_origin_mat.SetUnit();</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  reset_origin_mat(0, 2) = -image_width / 2.0 + 0.5;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  reset_origin_mat(1, 2) = -image_height / 2.0 + 0.5;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// transform_mat = set_origin_mat * transform_mat * reset_origin_mat</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  transform_mat.AddMatMatMat(1.0, set_origin_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                             transform_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                             reset_origin_mat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#acf6dcdd416f3076af7f4d00cc53f7e57">ApplyAffineTransform</a>(transform_mat, config.<a class="code" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a83ca9a40870c7dfbe4e799768246206e">num_channels</a>, image, fill_mode);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_a9e320d1a46febdc7eed2177406f4562f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a9e320d1a46febdc7eed2177406f4562f">kaldi::nnet3::ImageAugmentationConfig::rotation_prob</a></div><div class="ttdeci">BaseFloat rotation_prob</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00039">nnet3-egs-augment-image.cc:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_ac0b21c2fb4d5e1aab60f0e06dde8d69f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#ac0b21c2fb4d5e1aab60f0e06dde8d69f">kaldi::nnet3::ImageAugmentationConfig::GetFillMode</a></div><div class="ttdeci">FillMode GetFillMode() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00084">nnet3-egs-augment-image.cc:84</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_a83ca9a40870c7dfbe4e799768246206e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a83ca9a40870c7dfbe4e799768246206e">kaldi::nnet3::ImageAugmentationConfig::num_channels</a></div><div class="ttdeci">int32 num_channels</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00034">nnet3-egs-augment-image.cc:34</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0c4bcfc10bea5ed0d3e3cf6d74922121"><div class="ttname"><a href="namespacekaldi.html#a0c4bcfc10bea5ed0d3e3cf6d74922121">kaldi::RandUniform</a></div><div class="ttdeci">float RandUniform(struct RandomState *state=NULL)</div><div class="ttdoc">Returns a random number strictly between 0 and 1. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00151">kaldi-math.h:151</a></div></div>
<div class="ttc" id="kaldi-math_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="kaldi-math_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00044">kaldi-math.h:44</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_a4c47fd4f163011eb1939870d25aa656a"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a4c47fd4f163011eb1939870d25aa656a">kaldi::nnet3::ImageAugmentationConfig::Check</a></div><div class="ttdeci">void Check() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00073">nnet3-egs-augment-image.cc:73</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_a15c62191964d05517fc195d2b7586c93"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a15c62191964d05517fc195d2b7586c93">kaldi::nnet3::ImageAugmentationConfig::rotation_degree</a></div><div class="ttdeci">BaseFloat rotation_degree</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00038">nnet3-egs-augment-image.cc:38</a></div></div>
<div class="ttc" id="namespacekaldi_html_a418c782c2df97dc179125ae5ad950338"><div class="ttname"><a href="namespacekaldi.html#a418c782c2df97dc179125ae5ad950338">kaldi::WithProb</a></div><div class="ttdeci">bool WithProb(BaseFloat prob, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00071">kaldi-math.cc:71</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_a3b8bd277c3bbd81a7115175cfc43b4b7"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a3b8bd277c3bbd81a7115175cfc43b4b7">kaldi::nnet3::ImageAugmentationConfig::horizontal_flip_prob</a></div><div class="ttdeci">BaseFloat horizontal_flip_prob</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00035">nnet3-egs-augment-image.cc:35</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_a9e59cf0d43e877ec51808580b79f8f5d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a9e59cf0d43e877ec51808580b79f8f5d">kaldi::nnet3::ImageAugmentationConfig::vertical_shift</a></div><div class="ttdeci">BaseFloat vertical_shift</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00037">nnet3-egs-augment-image.cc:37</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_acf6dcdd416f3076af7f4d00cc53f7e57"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#acf6dcdd416f3076af7f4d00cc53f7e57">kaldi::nnet3::ApplyAffineTransform</a></div><div class="ttdeci">void ApplyAffineTransform(MatrixBase&lt; BaseFloat &gt; &amp;transform, int32 num_channels, MatrixBase&lt; BaseFloat &gt; *image, FillMode fill_mode)</div><div class="ttdoc">This function applies a geometric transformation &amp;#39;transform&amp;#39; to the image. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00110">nnet3-egs-augment-image.cc:110</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a75a9acd74effffae38daed55136b0980"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a75a9acd74effffae38daed55136b0980">kaldi::nnet3::FillMode</a></div><div class="ttdeci">FillMode</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00031">nnet3-egs-augment-image.cc:31</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ImageAugmentationConfig_html_a007febaebc9c6c16168f16f942295846"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html#a007febaebc9c6c16168f16f942295846">kaldi::nnet3::ImageAugmentationConfig::horizontal_shift</a></div><div class="ttdeci">BaseFloat horizontal_shift</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00036">nnet3-egs-augment-image.cc:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a059ad04cefd0a3c450efa6ca7c1c0211"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a059ad04cefd0a3c450efa6ca7c1c0211">&#9670;&nbsp;</a></span>PerturbImageInNnetExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::PerturbImageInNnetExample </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ImageAugmentationConfig.html">ImageAugmentationConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function does image perturbation as directed by 'config' The example 'eg' is expected to contain a <a class="el" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> member with the name 'input', representing an image. </p>

<p class="definition">Definition at line <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00302">302</a> of file <a class="el" href="nnet3-egs-augment-image_8cc_source.html">nnet3-egs-augment-image.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8h_source.html#l00046">NnetIo::features</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00816">GeneralMatrix::GetMatrix()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00036">NnetIo::name</a>, and <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00205">PerturbImage()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-egs-augment-image_8cc_source.html#l00331">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                     {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  int32 io_size = eg-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.size();</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordtype">bool</span> found_input = <span class="keyword">false</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; io_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> &amp;io = eg-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">name</a> == <span class="stringliteral">&quot;input&quot;</span>) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      found_input = <span class="keyword">true</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> image;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a>.<a class="code" href="classkaldi_1_1GeneralMatrix.html#aedb405685f9fc7389025e0ad49732216">GetMatrix</a>(&amp;image);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="comment">// note: &#39;GetMatrix&#39; may uncompress if it was compressed.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="comment">// We won&#39;t recompress, but this won&#39;t matter because this</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="comment">// program is intended to be used as part of a pipe, we</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="comment">// likely won&#39;t be dumping the perturbed data to disk.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a807b8aabb93f3ae097cc93629d5b8410">PerturbImage</a>(config, &amp;image);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="comment">// modify the &#39;io&#39; object.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      io.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">features</a> = image;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">if</span> (!found_input)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Nnet example to perturb had no NnetIo object named &#39;input&#39;&quot;</span>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html">kaldi::nnet3::NnetIo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00033">nnet-example.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1GeneralMatrix_html_aedb405685f9fc7389025e0ad49732216"><div class="ttname"><a href="classkaldi_1_1GeneralMatrix.html#aedb405685f9fc7389025e0ad49732216">kaldi::GeneralMatrix::GetMatrix</a></div><div class="ttdeci">void GetMatrix(Matrix&lt; BaseFloat &gt; *mat) const</div><div class="ttdoc">Outputs the contents as a matrix. </div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l00816">sparse-matrix.cc:816</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_a84345a57ee4e5dade232e7af464ea151"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#a84345a57ee4e5dade232e7af464ea151">kaldi::nnet3::NnetIo::features</a></div><div class="ttdeci">GeneralMatrix features</div><div class="ttdoc">The features or labels. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00046">nnet-example.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a807b8aabb93f3ae097cc93629d5b8410"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a807b8aabb93f3ae097cc93629d5b8410">kaldi::nnet3::PerturbImage</a></div><div class="ttdeci">void PerturbImage(const ImageAugmentationConfig &amp;config, MatrixBase&lt; BaseFloat &gt; *image)</div><div class="ttdoc">This function randomly modifies (perturbs) the image by applying different geometric transformations ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-egs-augment-image_8cc_source.html#l00205">nnet3-egs-augment-image.cc:205</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#a9b45b3e13bd9167aab02e17e08916231">kaldi::nnet3::NnetIo::name</a></div><div class="ttdeci">std::string name</div><div class="ttdoc">the name of the input in the neural net; in simple setups it will just be &quot;input&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00036">nnet-example.h:36</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ca498bb15fc664236fdd7316a1b8831"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ca498bb15fc664236fdd7316a1b8831">&#9670;&nbsp;</a></span>PerturbParams()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PerturbParams </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calls PerturbParams (with the given stddev) on all updatable components of the nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00199">199</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#af8524a3f9d683293269f46e3cc54b285">UpdatableComponent::PerturbParams()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8h_source.html#l00879">AffineComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01189">BlockAffineComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01744">Convolutional1dComponent::BackpropNeedsOutput()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01892">ScaleAndOffsetComponent::Copy()</a>, <a class="el" href="nnet-general-component_8h_source.html#l00666">ConstantComponent::IsComputable()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00952">LinearComponent::LinearComponent()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00418">AffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00515">BlockAffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00581">RepeatedAffineComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01523">PerElementScaleComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01625">PerElementOffsetComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l01695">ConstantFunctionComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02050">ConvolutionComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02254">LstmNonlinearityComponent::Properties()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02506">CompositeComponent::Type()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>, and <a class="el" href="_2nnet-component_8h_source.html#l00299">UpdatableComponent::~UpdatableComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                               {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      UpdatableComponent *u_comp = <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(u_comp != NULL);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      u_comp-&gt;PerturbParams(stddev);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5b506b12f6ee61fbe53115f474df376"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5b506b12f6ee61fbe53115f474df376">&#9670;&nbsp;</a></span>PrintCindex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintCindex </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &amp;&#160;</td>
          <td class="paramname"><em>cindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>node_names</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00432">432</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation-graph_8cc_source.html#l00175">ComputationGraph::Print()</a>.</p>
<div class="fragment"><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                                         {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(cindex.first) &lt; node_names.size());</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  os &lt;&lt; node_names[cindex.first] &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; cindex.second.n &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;     &lt;&lt; cindex.second.t;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">if</span> (cindex.second.x != 0)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; cindex.second.x;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a610537b433bd5824688a70413c9905c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a610537b433bd5824688a70413c9905c6">&#9670;&nbsp;</a></span>PrintCindexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintCindexes </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>ostream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>cindexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>node_names</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>this will only be used for pretty-printing. </p>
<p>It prints a vector of Cindexes in a compact, human-readable way with compression of ranges. If the values of the node indexes are the same for the entire vector, it will just be node-name followed by the output of PrintIndexes, e.g. some_node[ (1,1,0) ]. Otherwise it will divide the vector into ranges that each have all the same node name, and will print out each range in the way we just mentioned. 'node_names' will usually come from a call like nnet.GetNodeNames(). </p>

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00498">498</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-common_8cc_source.html#l00442">PrintIndexes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8cc_source.html#l00684">PrintComputationPreamble()</a>.</p>
<div class="fragment"><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                                           {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  int32 num_cindexes = cindexes.size();</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">if</span> (num_cindexes == 0) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    ostream &lt;&lt; <span class="stringliteral">&quot;[ ]&quot;</span>;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  int32 cur_offset = 0;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  std::vector&lt;Index&gt; indexes;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  indexes.reserve(cindexes.size());</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keywordflow">while</span> (cur_offset &lt; num_cindexes) {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    int32 cur_node_index = cindexes[cur_offset].first;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">while</span> (cur_offset &lt; num_cindexes &amp;&amp;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;           cindexes[cur_offset].first == cur_node_index) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      indexes.push_back(cindexes[cur_offset].second);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      cur_offset++;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(cur_node_index) &lt; node_names.size());</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">const</span> std::string &amp;node_name = node_names[cur_node_index];</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    ostream &lt;&lt; node_name;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#af952225c01896b2850ffdb09ea2f0ba6">PrintIndexes</a>(ostream, indexes);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    indexes.clear();</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_af952225c01896b2850ffdb09ea2f0ba6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af952225c01896b2850ffdb09ea2f0ba6">kaldi::nnet3::PrintIndexes</a></div><div class="ttdeci">void PrintIndexes(std::ostream &amp;os, const std::vector&lt; Index &gt; &amp;indexes)</div><div class="ttdoc">this will only be used for pretty-printing. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00442">nnet-common.cc:442</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="add0941dcac8fe7e6bfe5d65979c9d388"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add0941dcac8fe7e6bfe5d65979c9d388">&#9670;&nbsp;</a></span>PrintCommand() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string kaldi::nnet3::PrintCommand </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_commands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>command</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-analyze-test_8cc_source.html#l00028">28</a> of file <a class="el" href="nnet-analyze-test_8cc_source.html">nnet-analyze-test.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8cc_source.html#l00944">NnetComputation::GetCommandStrings()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, and <a class="el" href="nnet-analyze-test_8cc_source.html#l00039">UnitTestNnetAnalyze()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                        {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">if</span> (command &lt; 0 || command &gt;= num_commands)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    os &lt;&lt; command;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    os &lt;&lt; <span class="charliteral">&#39;c&#39;</span> &lt;&lt; command;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">return</span> os.str();</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aa9a2ce289b10aff70bac5d2ace3f7fa7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9a2ce289b10aff70bac5d2ace3f7fa7">&#9670;&nbsp;</a></span>PrintCommand() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::PrintCommand </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>command_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>submatrix_strings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes_strings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes_multi_strings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation_8cc_source.html#l00513">513</a> of file <a class="el" href="nnet-computation_8cc_source.html">nnet-computation.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00340">NnetComputation::Command::alpha</a>, <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00344">NnetComputation::Command::arg4</a>, <a class="el" href="nnet-computation_8h_source.html#l00345">NnetComputation::Command::arg5</a>, <a class="el" href="nnet-computation_8h_source.html#l00346">NnetComputation::Command::arg6</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00689">Nnet::GetComponentName()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00684">Nnet::GetNodeName()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00430">NnetComputation::indexes_ranges</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kAcceptInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kAddRowRanges</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kAddRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddToRowsMulti</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kBackprop</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kBackpropNoModelUpdate</a>, <a class="el" href="cu-compressed-matrix_8h_source.html#l00143">kaldi::kCompressedMatrixInt16</a>, <a class="el" href="cu-compressed-matrix_8h_source.html#l00141">kaldi::kCompressedMatrixInt8</a>, <a class="el" href="cu-compressed-matrix_8h_source.html#l00142">kaldi::kCompressedMatrixUint8</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kCompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kCopyRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyToRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kDecompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixAdd</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixCopy</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationMarker</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationPermanent</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kPropagate</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kProvideOutput</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSetConst</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSwapMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00442">NnetComputation::need_model_derivative</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                                                                            {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="comment">// If the string is longer than &#39;max_string_length&#39; characters, it will</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="comment">// be summarized with &#39;...&#39; in the middle.</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordtype">size_t</span> max_string_length = 200;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(command_index &lt; computation.commands.size());</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;c&quot;</span> &lt;&lt; command_index &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keyword">const</span> NnetComputation::Command &amp;c = computation.commands[command_index];</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>:</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; = undefined(&quot;</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;         &lt;&lt; computation.submatrices[c.arg1].num_rows</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;         &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; computation.submatrices[c.arg1].num_cols &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>:</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; = []\n&quot;</span>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>:</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot;.swap(&quot;</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;         &lt;&lt; submatrix_strings[c.arg2] &lt;&lt; <span class="stringliteral">&quot;) [dim = &quot;</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         &lt;&lt; computation.submatrices[c.arg1].num_rows &lt;&lt; <span class="stringliteral">&quot; x &quot;</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         &lt;&lt; computation.submatrices[c.arg1].num_cols &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>:</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot;.set(&quot;</span> &lt;&lt; c.alpha &lt;&lt; <span class="stringliteral">&quot;) [dim = &quot;</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;         &lt;&lt; computation.submatrices[c.arg1].num_rows &lt;&lt; <span class="stringliteral">&quot; x &quot;</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         &lt;&lt; computation.submatrices[c.arg1].num_cols &lt;&lt; <span class="stringliteral">&quot;];\n&quot;</span>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a>:</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      os &lt;&lt; nnet.GetComponentName(c.arg1) &lt;&lt; <span class="stringliteral">&quot;.Propagate(&quot;</span>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">if</span> (c.arg2 == 0) os &lt;&lt; <span class="stringliteral">&quot;NULL, &quot;</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">else</span> os &lt;&lt; <span class="stringliteral">&quot;precomputed_indexes[&quot;</span> &lt;&lt; c.arg2 &lt;&lt; <span class="stringliteral">&quot;], &quot;</span>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      os &lt;&lt; submatrix_strings[c.arg3] &lt;&lt; <span class="stringliteral">&quot;, &amp;&quot;</span> &lt;&lt; submatrix_strings[c.arg4]</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;         &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>:</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>: {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      int32 component_index = c.arg1;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      os &lt;&lt; nnet.GetComponentName(component_index) &lt;&lt; <span class="stringliteral">&quot;.Backprop(&quot;</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">if</span> (c.arg2 == 0) os &lt;&lt; <span class="stringliteral">&quot;NULL, &quot;</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordflow">else</span> os &lt;&lt; <span class="stringliteral">&quot;precomputed_indexes[&quot;</span> &lt;&lt; c.arg2 &lt;&lt; <span class="stringliteral">&quot;], &quot;</span>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      os &lt;&lt; submatrix_strings[c.arg3] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         &lt;&lt; submatrix_strings[c.arg4] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;         &lt;&lt; submatrix_strings[c.arg5] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;         &lt;&lt; (computation.need_model_derivative &amp;&amp;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;             c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a> ?</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;             <span class="stringliteral">&quot;[component-pointer], &quot;</span> : <span class="stringliteral">&quot;NULL, &quot;</span>)</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;         &lt;&lt; (c.arg6 == 0 ? std::string(<span class="stringliteral">&quot;NULL&quot;</span>) :</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;             std::string(<span class="stringliteral">&quot;&amp;&quot;</span>) + submatrix_strings[c.arg6]) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>:</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordflow">if</span> (c.alpha == 1.0) {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; = &quot;</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;           &lt;&lt; submatrix_strings[c.arg2] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; = &quot;</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;           &lt;&lt; c.alpha &lt;&lt; <span class="stringliteral">&quot; * &quot;</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;           &lt;&lt; submatrix_strings[c.arg2] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      }</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>:</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keywordflow">if</span> (c.alpha == 1.0) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; += &quot;</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;           &lt;&lt; submatrix_strings[c.arg2] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; += &quot;</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;           &lt;&lt; c.alpha &lt;&lt; <span class="stringliteral">&quot; * &quot;</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;           &lt;&lt; submatrix_strings[c.arg2] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>:</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>:</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot;.&quot;</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;         &lt;&lt; (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a> ? <span class="stringliteral">&quot;AddRows&quot;</span> :</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;             <span class="stringliteral">&quot;CopyRows&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; c.alpha &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;         &lt;&lt; submatrix_strings[c.arg2] &lt;&lt; indexes_strings[c.arg3] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>:</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>:</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>:</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>: {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352">CommandType</a> ct = c.command_type;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot;.&quot;</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;         &lt;&lt; (ct == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a> ? <span class="stringliteral">&quot;AddRowsMulti&quot;</span> :</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;             (ct == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>? <span class="stringliteral">&quot;AddToRowsMulti&quot;</span> :</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;              (ct == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a> ? <span class="stringliteral">&quot;CopyRowsMulti&quot;</span> :</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;               <span class="stringliteral">&quot;CopyToRowsMulti&quot;</span>))) &lt;&lt; <span class="stringliteral">&quot;(&quot;</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;         &lt;&lt; c.alpha &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;         &lt;&lt; indexes_multi_strings[c.arg2] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>: {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot;.AddRowRanges(&quot;</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;         &lt;&lt; c.alpha &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;         &lt;&lt; submatrix_strings[c.arg2] &lt;&lt; <span class="stringliteral">&quot;, [&quot;</span>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;pairs =</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;           computation.indexes_ranges[c.arg3];</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pairs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">if</span> (pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first == -1) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;null&quot;</span>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;          os &lt;&lt; pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; (pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second - 1);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; pairs.size()) os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;])\n&quot;</span>;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>: {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> range = c.alpha;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      std::string truncate = (c.arg3 != 0 ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      std::string compressed_matrix_type;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">if</span> (c.arg2 == <a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa779c2db4bbceea9ef868682cb3942958">kCompressedMatrixInt8</a>) { compressed_matrix_type = <span class="stringliteral">&quot;int8&quot;</span>; }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c.arg2 == <a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d">kCompressedMatrixUint8</a>) { compressed_matrix_type = <span class="stringliteral">&quot;uint8&quot;</span>; }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c.arg2 == <a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa8cf976d526a5eac828cf765737a64bfa">kCompressedMatrixInt16</a>) { compressed_matrix_type = <span class="stringliteral">&quot;int16&quot;</span>; }</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c.arg2 == <a class="code" href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa8cf976d526a5eac828cf765737a64bfa">kCompressedMatrixInt16</a>);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        compressed_matrix_type = <span class="stringliteral">&quot;uint16&quot;</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;CompressMatrix(&quot;</span> &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;         &lt;&lt; range &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; compressed_matrix_type &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;         &lt;&lt; truncate &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>:</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;DecompressMatrix(&quot;</span> &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>:</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      os &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; = user input [for node: &#39;&quot;</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;         &lt;&lt; nnet.GetNodeName(c.arg2) &lt;&lt; <span class="stringliteral">&quot;&#39;]\n&quot;</span>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>:</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;output &quot;</span> &lt;&lt; submatrix_strings[c.arg1] &lt;&lt; <span class="stringliteral">&quot; to user&quot;</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; [for node: &#39;&quot;</span> &lt;&lt; nnet.GetNodeName(c.arg2) &lt;&lt; <span class="stringliteral">&quot;&#39;]\n&quot;</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>:</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;[no-op]\n&quot;</span>;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>:</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;[no-op-permanent]\n&quot;</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>:</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;# computation segment separator [e.g., begin backward commands]\n&quot;</span>;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>:</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;[label for goto statement]\n&quot;</span>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>:</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;goto c&quot;</span> &lt;&lt; c.arg1 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Un-handled command type.&quot;</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  std::string str = os.str();</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">if</span> (str.size() &lt;= max_string_length) {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    os_out &lt;&lt; str;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordtype">size_t</span> len = str.size();</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    os_out &lt;&lt; str.substr(0, max_string_length / 2) &lt;&lt; <span class="stringliteral">&quot; ... &quot;</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;           &lt;&lt; str.substr(len - max_string_length / 2);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352">kaldi::nnet3::CommandType</a></div><div class="ttdeci">CommandType</div><div class="ttdoc">CommandType is an enum that describes the category of the command used in the NnetComputation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00288">nnet-computation.h:288</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kaldi::nnet3::kCompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6a81f9c498a2d703ea343d906a827b6fa8cf976d526a5eac828cf765737a64bfa"><div class="ttname"><a href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa8cf976d526a5eac828cf765737a64bfa">kaldi::kCompressedMatrixInt16</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-compressed-matrix_8h_source.html#l00143">cu-compressed-matrix.h:143</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kaldi::nnet3::kBackpropNoModelUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d"><div class="ttname"><a href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa23164e2fb75b9b890518973aa841de3d">kaldi::kCompressedMatrixUint8</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-compressed-matrix_8h_source.html#l00142">cu-compressed-matrix.h:142</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kaldi::nnet3::kNoOperationLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6a81f9c498a2d703ea343d906a827b6fa779c2db4bbceea9ef868682cb3942958"><div class="ttname"><a href="namespacekaldi.html#a6a81f9c498a2d703ea343d906a827b6fa779c2db4bbceea9ef868682cb3942958">kaldi::kCompressedMatrixInt8</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-compressed-matrix_8h_source.html#l00141">cu-compressed-matrix.h:141</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kaldi::nnet3::kDecompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4f9689026c0962fecfe5cc56194840d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4f9689026c0962fecfe5cc56194840d">&#9670;&nbsp;</a></span>PrintCommandAttributes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintCommandAttributes </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1CommandAttributes.html">CommandAttributes</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>attributes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is to be used in debugging; it produces human-readable output. </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l01368">1368</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8h_source.html#l00059">CommandAttributes::matrices_read</a>, <a class="el" href="nnet-analyze_8h_source.html#l00061">CommandAttributes::matrices_written</a>, <a class="el" href="nnet-analyze_8h_source.html#l00049">CommandAttributes::variables_read</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00051">CommandAttributes::variables_written</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-analyze_8h_source.html#l00066">CommandAttributes::CommandAttributes()</a>.</p>
<div class="fragment"><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                                                                            {</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  int32 num_commands = attributes.size();</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_commands; c++) {</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="keyword">const</span> CommandAttributes &amp;this_attr = attributes[c];</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;c&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keywordflow">if</span> (!this_attr.variables_read.empty()) {</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;r(&quot;</span>;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      std::vector&lt;int32&gt;::const_iterator iter = this_attr.variables_read.begin(),</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;          end = this_attr.variables_read.end();</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;v&quot;</span> &lt;&lt; *iter;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <span class="keywordflow">if</span> (iter+1 != end) os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    }</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="keywordflow">if</span> (!this_attr.variables_written.empty()) {</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;w(&quot;</span>;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      std::vector&lt;int32&gt;::const_iterator</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;          iter = this_attr.variables_written.begin(),</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;          end = this_attr.variables_written.end();</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;v&quot;</span> &lt;&lt; *iter;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="keywordflow">if</span> (iter+1 != end) os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      }</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    }</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordflow">if</span> (!this_attr.matrices_read.empty()) {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;r(&quot;</span>;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      std::vector&lt;int32&gt;::const_iterator iter = this_attr.matrices_read.begin(),</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;          end = this_attr.matrices_read.end();</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;m&quot;</span> &lt;&lt; *iter;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <span class="keywordflow">if</span> (iter+1 != end) os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      }</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    }</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="keywordflow">if</span> (!this_attr.matrices_written.empty()) {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;w(&quot;</span>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      std::vector&lt;int32&gt;::const_iterator</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;          iter = this_attr.matrices_written.begin(),</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          end = this_attr.matrices_written.end();</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="keywordflow">for</span> (; iter != end; ++iter) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;m&quot;</span> &lt;&lt; *iter;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <span class="keywordflow">if</span> (iter+1 != end) os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      }</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    }</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a84e0b21f2d4f6d5eaf3edb65595b417c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84e0b21f2d4f6d5eaf3edb65595b417c">&#9670;&nbsp;</a></span>PrintComputationPreamble()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::PrintComputationPreamble </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>submatrix_strings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes_strings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes_multi_strings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation_8cc_source.html#l00684">684</a> of file <a class="el" href="nnet-computation_8cc_source.html">nnet-computation.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00317">NnetComputation::MatrixDebugInfo::cindexes</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00063">Nnet::GetNodeNames()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00316">NnetComputation::MatrixDebugInfo::is_deriv</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, and <a class="el" href="nnet-common_8cc_source.html#l00498">PrintCindexes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8cc_source.html#l00944">NnetComputation::GetCommandStrings()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>.</p>
<div class="fragment"><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                                                       {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="comment">// First print info about the matrices.</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;matrix &quot;</span>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; c.matrices.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;m&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; c.matrices[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].num_rows</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; c.matrices[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].num_cols &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; c.matrices.size())</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordflow">if</span> (!c.matrix_debug_info.empty()) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;# The following show how matrices correspond to network-nodes and\n&quot;</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;# cindex-ids.  Format is: matrix = &lt;node-id&gt;.[value|deriv][ &lt;list-of-cindex-ids&gt; ]\n&quot;</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;# where a cindex-id is written as (n,t[,x]) but ranges of t values are compressed\n&quot;</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;# so we write (n, tfirst:tlast).\n&quot;</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c.matrix_debug_info.size() == c.matrices.size());</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; c.matrices.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keyword">const</span> NnetComputation::MatrixDebugInfo &amp;debug_info =</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;          c.matrix_debug_info[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;m&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; == &quot;</span> &lt;&lt; (debug_info.is_deriv ? <span class="stringliteral">&quot;deriv: &quot;</span> : <span class="stringliteral">&quot;value: &quot;</span>);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a610537b433bd5824688a70413c9905c6">PrintCindexes</a>(os, debug_info.cindexes, nnet.GetNodeNames());</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    }</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a610537b433bd5824688a70413c9905c6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a610537b433bd5824688a70413c9905c6">kaldi::nnet3::PrintCindexes</a></div><div class="ttdeci">void PrintCindexes(std::ostream &amp;ostream, const std::vector&lt; Cindex &gt; &amp;cindexes, const std::vector&lt; std::string &gt; &amp;node_names)</div><div class="ttdoc">this will only be used for pretty-printing. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00498">nnet-common.cc:498</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a55b3c5fd7a70b59070dfec3be993ff80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55b3c5fd7a70b59070dfec3be993ff80">&#9670;&nbsp;</a></span>PrintFloatSuccinctly()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::PrintFloatSuccinctly </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>f</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00467">467</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse_8cc_source.html#l00484">SummarizeVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                                              {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordflow">if</span> (fabs(f) &lt; 10000.0 &amp;&amp; fabs(f) &gt;= 10.0) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    os  &lt;&lt; std::fixed &lt;&lt; std::setprecision(0) &lt;&lt; f;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(f) &gt;= 0.995) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    os  &lt;&lt; std::fixed &lt;&lt; std::setprecision(1) &lt;&lt; f;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(f) &gt;= 0.01) {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    os  &lt;&lt; std::fixed &lt;&lt; std::setprecision(2) &lt;&lt; f;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    os &lt;&lt; std::setprecision(1) &lt;&lt; f;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  os.unsetf(std::ios_base::floatfield);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  os &lt;&lt; std::setprecision(6);  <span class="comment">// Restore the default.</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a794312260c52d2eb93f30302ee0a7173"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a794312260c52d2eb93f30302ee0a7173">&#9670;&nbsp;</a></span>PrintGraphToString()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string PrintGraphToString </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints a graph to a string in a pretty way for human readability, e.g. </p>
<p>as 0 -&gt; 1,2; 1 -&gt; 2; 2 -&gt; 3,4,5; etc. </p>

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00248">248</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00265">ComputeNnetComputationEpochs()</a>.</p>
<div class="fragment"><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                                                        {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  int32 num_nodes = graph.size();</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_nodes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    os &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; -&gt; (&quot;</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;vec = graph[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    int32 size = vec.size();</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; size; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      os &lt;&lt; vec[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> + 1 &lt; size) os &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> (i + 1 &lt; num_nodes) os &lt;&lt; <span class="stringliteral">&quot;; &quot;</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">return</span> os.str();</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af952225c01896b2850ffdb09ea2f0ba6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af952225c01896b2850ffdb09ea2f0ba6">&#9670;&nbsp;</a></span>PrintIndexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintIndexes </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>ostream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>this will only be used for pretty-printing. </p>
<p>It prints a vector of Indexes in a compact, human-readable way with compression of ranges (it also doesn't print the x index if it's 1.0. Example output: "[ (1,1:20), (2, 1:20) ]" which would correspond to the indexes [ (1,1,0), (1,2,0) ... (1,20,0) (2,1,0) ... (2,20,0) ]. </p>

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00442">442</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8cc_source.html#l00993">IoSpecification::Print()</a>, and <a class="el" href="nnet-common_8cc_source.html#l00498">PrintCindexes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                                   {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">if</span> (indexes.empty()) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;[ ]&quot;</span>;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="comment">// If the string is longer than &#39;max_string_length&#39; characters, it will</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="comment">// be summarized with &#39;...&#39; in the middle.</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">size_t</span> max_string_length = 200;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  std::ostringstream os_temp;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// range_starts will be the starts of ranges (with consecutive t values and</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">// the same n value and zero x values) that we compactly print.  we&#39;ll append</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// &quot;end&quot; to range_starts for convenience.n</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  std::vector&lt;int32&gt; range_starts;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  int32 cur_start = 0, end = indexes.size();</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = cur_start; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; end; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keyword">const</span> Index &amp;index = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; cur_start &amp;&amp;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        (index.t != indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].t + 1 ||</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;         index.n != indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].n ||</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;         index.x != indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].x)) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      range_starts.push_back(cur_start);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      cur_start = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  range_starts.push_back(cur_start);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  range_starts.push_back(end);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  os_temp &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  int32 num_ranges = range_starts.size() - 1;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_ranges; r++) {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    int32 range_start = range_starts[r], range_end = range_starts[r+1];</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(range_end &gt; range_start);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    os_temp &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; indexes[range_start].n &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (range_end == range_start + 1)</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      os_temp &lt;&lt; indexes[range_start].t;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      os_temp &lt;&lt; indexes[range_start].t &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; indexes[range_end - 1].t;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (indexes[range_start].x != 0)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      os_temp &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; indexes[range_start].x;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    os_temp &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (r + 1 &lt; num_ranges)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      os_temp &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  os_temp &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  std::string str = os_temp.str();</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">if</span> (str.size() &lt;= max_string_length) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    os &lt;&lt; str;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordtype">size_t</span> len = str.size();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    os &lt;&lt; str.substr(0, max_string_length / 2) &lt;&lt; <span class="stringliteral">&quot; ... &quot;</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;       &lt;&lt; str.substr(len - max_string_length / 2);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a91ad7b2e440d9b50c196a361f559a427"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91ad7b2e440d9b50c196a361f559a427">&#9670;&nbsp;</a></span>PrintIntegerVector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintIntegerVector </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>ints</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00525">525</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation-graph_8cc_source.html#l01101">kaldi::nnet3::computation_graph::ComputeEpochInfo()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00448">GetIndexesStrings()</a>.</p>
<div class="fragment"><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                                      {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">if</span> (ints.empty()) {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;[ ]&quot;</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  }</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">// range_starts will be the starts of ranges (with consecutive or identical</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="comment">// values) that we compactly print.  we&#39;ll append &quot;end&quot; to range_starts for</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="comment">// convenience.</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  std::vector&lt;int32&gt; range_starts;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  int32 cur_start = 0, end = ints.size();</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = cur_start; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; end; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; cur_start) {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      int32 range_start_val = ints[cur_start],</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;          range_start_plus_one_val = ints[cur_start+1],</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;          cur_val = ints[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="comment">// if we have reached the end of a range...</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keywordflow">if</span> (!((range_start_plus_one_val == range_start_val &amp;&amp;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;             cur_val == range_start_val) ||</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            (range_start_plus_one_val == range_start_val + 1 &amp;&amp;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;             cur_val == range_start_val + <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> - cur_start))) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        range_starts.push_back(cur_start);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        cur_start = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  range_starts.push_back(cur_start);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  range_starts.push_back(end);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  int32 num_ranges = range_starts.size() - 1;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_ranges; r++) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    int32 range_start = range_starts[r], range_end = range_starts[r+1];</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(range_end &gt; range_start);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">if</span> (range_end == range_start + 1)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      os &lt;&lt; ints[range_start];</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (range_end == range_start + 2)  <span class="comment">// don&#39;t print ranges of 2.</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      os &lt;&lt; ints[range_start] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; ints[range_start+1];</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ints[range_start] == ints[range_start+1])</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      os &lt;&lt; ints[range_start] &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; (range_end - range_start);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      os &lt;&lt; ints[range_start] &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; ints[range_end - 1];</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (r + 1 &lt; num_ranges)</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa09a3995a6335eb986c2fb6432ff785c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa09a3995a6335eb986c2fb6432ff785c">&#9670;&nbsp;</a></span>PrintMatrixAccesses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintMatrixAccesses </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>matrix_accesses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is to be used in debugging; it produces human-readable output. </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l01350">1350</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8h_source.html#l00264">MatrixAccesses::accesses</a>, <a class="el" href="nnet-analyze_8h_source.html#l00253">MatrixAccesses::allocate_command</a>, <a class="el" href="nnet-analyze_8h_source.html#l00257">MatrixAccesses::deallocate_command</a>, <a class="el" href="nnet-analyze_8h_source.html#l00076">kReadAccess</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00077">kWriteAccess</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-analyze_8h_source.html#l00271">MatrixAccesses::MatrixAccesses()</a>.</p>
<div class="fragment"><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                                                                           {</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  int32 num_matrices = matrix_accesses.size();</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keyword">const</span> MatrixAccesses &amp;a = matrix_accesses[m];</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;m&quot;</span> &lt;&lt; m &lt;&lt; <span class="stringliteral">&quot;: init-command=&quot;</span> &lt;&lt; a.allocate_command</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;, destroy-command=&quot;</span> &lt;&lt; a.deallocate_command</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;, accesses=&quot;</span>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    std::vector&lt;Access&gt;::const_iterator iter = a.accesses.begin(),</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        end = a.accesses.end();</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter)</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      os &lt;&lt; <span class="charliteral">&#39;c&#39;</span> &lt;&lt; iter-&gt;command_index &lt;&lt; <span class="stringliteral">&quot;(&quot;</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;         &lt;&lt; (iter-&gt;access_type == <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kReadAccess</a> ? <span class="stringliteral">&quot;r&quot;</span> :</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;             (iter-&gt;access_type == <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a> ? <span class="stringliteral">&quot;w&quot;</span> : <span class="stringliteral">&quot;rw&quot;</span>)) &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  }</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478acaca1f8be65b8d29c8710e04ac7629f3">kaldi::nnet3::kReadAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00076">nnet-analyze.h:76</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kaldi::nnet3::kWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00077">nnet-analyze.h:77</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a34aff1eb4a29f66dee3a093eed6db9fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34aff1eb4a29f66dee3a093eed6db9fa">&#9670;&nbsp;</a></span>PrintParameterStats() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintParameterStats </td>
          <td>(</td>
          <td class="paramtype">std::ostringstream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>include_mean</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print to 'os' some information about the mean and standard deviation of some parameters, used in Info() functions in <a class="el" href="nnet-simple-component_8cc.html">nnet-simple-component.cc</a>. </p>
<p>For example: PrintParameterStats(os, "bias", bias_params_, true); would print to 'os' something like the string ", bias-{mean,stddev}=-0.013,0.196". If 'include_mean = false', it will print something like ", bias-rms=0.2416", and this represents and uncentered standard deviation. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00530">530</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8h_source.html#l00068">CuVectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="cu-vector_8cc_source.html#l00291">CuVectorBase&lt; Real &gt;::Sum()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00037">kaldi::VecVec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-convolutional-component_8cc_source.html#l00065">TimeHeightConvolutionComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01151">AffineComponent::Info()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00063">TdnnComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01682">BlockAffineComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01364">RepeatedAffineComponent::Info()</a>, <a class="el" href="nnet-general-component_8cc_source.html#l01202">ConstantComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03188">LinearComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03328">FixedAffineComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03662">FixedScaleComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l03736">FixedBiasComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01962">PerElementScaleComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02130">PerElementOffsetComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02578">ConstantFunctionComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02308">ScaleAndOffsetComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l04059">ConvolutionComponent::Info()</a>, and <a class="el" href="nnet-simple-component_8cc_source.html#l05645">LstmNonlinearityComponent::Info()</a>.</p>
<div class="fragment"><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                                            {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  os &lt;&lt; std::setprecision(4);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;-&#39;</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">if</span> (include_mean) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> mean = params.Sum() / params.Dim(),</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        stddev = std::sqrt(<a class="code" href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">VecVec</a>(params, params) / params.Dim() - mean * mean);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;{mean,stddev}=&quot;</span> &lt;&lt; mean &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; stddev;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rms = std::sqrt(<a class="code" href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">VecVec</a>(params, params) / params.Dim());</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;rms=&quot;</span> &lt;&lt; rms;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  }</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  os &lt;&lt; std::setprecision(6);  <span class="comment">// restore the default precision.</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__matrix__funcs__scalar_html_ga4750cd6f7a02a013435779588056b153"><div class="ttname"><a href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">kaldi::VecVec</a></div><div class="ttdeci">Real VecVec(const VectorBase&lt; Real &gt; &amp;a, const VectorBase&lt; Real &gt; &amp;b)</div><div class="ttdoc">Returns dot product between v1 and v2. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00037">kaldi-vector.cc:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a805df9186e7287ba645a159d9566a315"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a805df9186e7287ba645a159d9566a315">&#9670;&nbsp;</a></span>PrintParameterStats() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintParameterStats </td>
          <td>(</td>
          <td class="paramtype">std::ostringstream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrix.html">CuMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>include_mean</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>include_row_norms</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>include_column_norms</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>include_singular_values</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print to 'os' some information about the mean and standard deviation of some parameters, used in Info() functions in <a class="el" href="nnet-simple-component_8cc.html">nnet-simple-component.cc</a>. </p>
<p>For example: PrintParameterStats(os, "linear-params", linear_params_; would print to 'os' something like the string ", linear-params-rms=0.239". If you set 'include_mean' to true, it will print something like ", linear-params-{mean-stddev}=0.103,0.183". If you set 'include_row_norms' to true, it will print something like ", linear-params-row-norms=[percentiles(0,1........, stddev=0.0508]" If you set 'include_column_norms' to true, it will print something like ", linear-params-col-norms=[percentiles(0,1........, stddev=0.0508]" If you set 'include_singular_values' to true, it will print something like ", linear-params-singular-values=[percentiles(0,1........, stddev=0.0508]" </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00547">547</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8cc_source.html#l00567">CuVectorBase&lt; Real &gt;::AddDiagMat2()</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-matrix_8cc_source.html#l02979">CuMatrixBase&lt; Real &gt;::Sum()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00484">SummarizeVector()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01824">MatrixBase&lt; Real &gt;::Svd()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l01296">Vector&lt; Real &gt;::Swap()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>.</p>
<div class="fragment"><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                                       {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  os &lt;&lt; std::setprecision(4);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;-&#39;</span>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  int32 dim = params.NumRows() * params.NumCols();</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">if</span> (include_mean) {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> mean = params.Sum() / dim,</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        stddev = std::sqrt(<a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(params, params, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>) / dim -</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                           mean * mean);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;{mean,stddev}=&quot;</span> &lt;&lt; mean &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; stddev;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rms = std::sqrt(<a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(params, params, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>) / dim);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;rms=&quot;</span> &lt;&lt; rms;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  }</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  os &lt;&lt; std::setprecision(6);  <span class="comment">// restore the default precision.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">if</span> (include_row_norms) {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    CuVector&lt;BaseFloat&gt; row_norms(params.NumRows());</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    row_norms.AddDiagMat2(1.0, params, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    row_norms.ApplyPow(0.5);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    Vector&lt;BaseFloat&gt; row_norms_cpu;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    row_norms.Swap(&amp;row_norms_cpu);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;-row-norms=&quot;</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;       &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">SummarizeVector</a>(row_norms_cpu);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordflow">if</span> (include_column_norms) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    CuVector&lt;BaseFloat&gt; col_norms(params.NumCols());</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    col_norms.AddDiagMat2(1.0, params, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    col_norms.ApplyPow(0.5);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    Vector&lt;BaseFloat&gt; col_norms_cpu;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    col_norms.Swap(&amp;col_norms_cpu);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;-col-norms=&quot;</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;       &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">SummarizeVector</a>(col_norms_cpu);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">if</span> (include_singular_values) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    Matrix&lt;BaseFloat&gt; params_cpu(params);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    Vector&lt;BaseFloat&gt; s(std::min(params.NumRows(), params.NumCols()));</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    params_cpu.Svd(&amp;s);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    std::string singular_values_str = <a class="code" href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">SummarizeVector</a>(s);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;-singular-values=&quot;</span> &lt;&lt; singular_values_str;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    std::ostringstream name_os;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6f8b12eaddd9c81766f37c1bdea637ca"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">kaldi::nnet3::SummarizeVector</a></div><div class="ttdeci">std::string SummarizeVector(const CuVectorBase&lt; BaseFloat &gt; &amp;cu_vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00525">nnet-parse.cc:525</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1a1184cd1146007ebf5403444309b69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1a1184cd1146007ebf5403444309b69">&#9670;&nbsp;</a></span>PrintPriorDiagnostics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::PrintPriorDiagnostics </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>old_priors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>new_priors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-am-adjust-priors_8cc_source.html#l00048">48</a> of file <a class="el" href="nnet3-am-adjust-priors_8cc_source.html">nnet3-am-adjust-priors.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l01043">VectorBase&lt; Real &gt;::AddVec()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00812">VectorBase&lt; Real &gt;::ApplyAbs()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet3-am-adjust-priors_8cc_source.html#l00031">KlDivergence()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00579">VectorBase&lt; Real &gt;::Max()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-am-adjust-priors_8cc_source.html#l00070">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                                                {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (old_priors.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() == 0) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Model did not previously have priors attached.&quot;</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> diff_prior(new_priors);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    diff_prior.AddVec(-1.0, old_priors);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    diff_prior.ApplyAbs();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    int32 max_index;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    diff_prior.Max(&amp;max_index);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Adjusting priors: largest absolute difference was for &quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;pdf &quot;</span> &lt;&lt; max_index &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; old_priors(max_index)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; new_priors(max_index);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Adjusting priors: K-L divergence from old to new is &quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;              &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a04165cf9403194c5a77e922f8f14d5f9">KlDivergence</a>(old_priors, new_priors);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div><div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a04165cf9403194c5a77e922f8f14d5f9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a04165cf9403194c5a77e922f8f14d5f9">kaldi::nnet3::KlDivergence</a></div><div class="ttdeci">BaseFloat KlDivergence(const Vector&lt; BaseFloat &gt; &amp;p, const Vector&lt; BaseFloat &gt; &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-am-adjust-priors_8cc_source.html#l00031">nnet3-am-adjust-priors.cc:31</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6cbf9817f25ef1302ede1ed03897394a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cbf9817f25ef1302ede1ed03897394a">&#9670;&nbsp;</a></span>PrintVectorPerUpdatableComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string PrintVectorPerUpdatableComponent </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is for printing, to a string, a vector with one element per updatable component of the nnet (e.g. </p>
<p>the output of ComponentDotProducts), in a human readable way, as [ component-name1:number1 component-name2:number2 ... ]. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00231">231</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00689">Nnet::GetComponentName()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00413">NumUpdatableComponents()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-show-progress_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                                                               {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;[ &quot;</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">NumUpdatableComponents</a>(nnet) == vec.Dim());</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  int32 updatable_c = 0;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet.NumComponents(); c++) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keyword">const</span> Component *comp = nnet.GetComponent(c);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keyword">const</span> std::string &amp;component_name = nnet.GetComponentName(c);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      os &lt;&lt; component_name &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; vec(updatable_c) &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      updatable_c++;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(updatable_c == vec.Dim());</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  os &lt;&lt; <span class="charliteral">&#39;]&#39;</span>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">return</span> os.str();</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a25df665b8f7a712a34469e53fc875851"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">kaldi::nnet3::NumUpdatableComponents</a></div><div class="ttdeci">int32 NumUpdatableComponents(const Nnet &amp;dest)</div><div class="ttdoc">Returns the number of updatable components in the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00413">nnet-utils.cc:413</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab2fee0700fd475dc0d6b4a9d618e9a72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2fee0700fd475dc0d6b4a9d618e9a72">&#9670;&nbsp;</a></span>PrintVectorVectorPair()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::PrintVectorVectorPair </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt;&#160;</td>
          <td class="paramname"><em>vec_vec_pair</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00050">50</a> of file <a class="el" href="nnet-compile-utils-test_8cc_source.html">nnet-compile-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, and <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00275">UnitTestSplitLocations()</a>, and <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00070">UnitTestSplitLocationsBackward()</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                                                 {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  std::ostringstream ostream;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; vec_vec_pair.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; vec_vec_pair[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)  {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      ostream &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; vec_vec_pair[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].first &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;              &lt;&lt; vec_vec_pair[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].second &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    ostream &lt;&lt; std::endl;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; ostream.str();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8a66448c7056b839a87410d5a9dfd35a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a66448c7056b839a87410d5a9dfd35a">&#9670;&nbsp;</a></span>ProcessFile() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::ProcessFile </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>ivector_feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>ivector_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;&#160;</td>
          <td class="paramname"><em>pdf_post</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>utt_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_pdfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>length_tolerance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a> *&#160;</td>
          <td class="paramname"><em>utt_splitter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *&#160;</td>
          <td class="paramname"><em>example_writer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-get-egs_8cc_source.html#l00033">33</a> of file <a class="el" href="nnet3-get-egs_8cc_source.html">nnet3-get-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00130">NnetExample::Compress()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00175">UtteranceSplitter::Config()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l01232">kaldi::ExtractRowRangeWithPadding()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00154">ChunkTimeInfo::first_frame</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00088">ExampleGenerationConfig::frame_subsampling_factor</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00822">UtteranceSplitter::GetChunksForUtterance()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00156">ChunkTimeInfo::left_context</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00553">UtteranceSplitter::LengthsMatch()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00155">ChunkTimeInfo::num_frames</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00781">GeneralMatrix::NumRows()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00165">ChunkTimeInfo::output_weights</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00157">ChunkTimeInfo::right_context</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, and <a class="el" href="kaldi-table-inl_8h_source.html#l01511">TableWriter&lt; Holder &gt;::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                                                           {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  int32 num_input_frames = feats.<a class="code" href="classkaldi_1_1GeneralMatrix.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> (!utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#ab05d4d57c7470362cd4216e27e309019">LengthsMatch</a>(utt_id, num_input_frames,</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                  static_cast&lt;int32&gt;(pdf_post.size()),</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                  length_tolerance))</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// LengthsMatch() will have printed a warning.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  std::vector&lt;ChunkTimeInfo&gt; chunks;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a1877ae7cc62d57076a6f9cc21ddfd129">GetChunksForUtterance</a>(num_input_frames, &amp;chunks);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (chunks.empty()) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Not producing egs for utterance &quot;</span> &lt;&lt; utt_id</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; because it is too short: &quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;               &lt;&lt; num_input_frames &lt;&lt; <span class="stringliteral">&quot; frames.&quot;</span>;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">// &#39;frame_subsampling_factor&#39; is not used in any recipes at the time of</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">// writing, this is being supported to unify the code with the &#39;chain&#39; recipes</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// and in case we need it for some reason in future.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  int32 frame_subsampling_factor =</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a15fc044c53f1e59804e6a38e3356dfd6">Config</a>().<a class="code" href="structkaldi_1_1nnet3_1_1ExampleGenerationConfig.html#aad93df0dcdc32cf7ef176162619a9b47">frame_subsampling_factor</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> c = 0; c &lt; chunks.size(); c++) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html">ChunkTimeInfo</a> &amp;chunk = chunks[c];</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    int32 tot_input_frames = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a> + chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a> +</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a2fd7efd4d877cf7a105aeb392a07c2f4">right_context</a>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    int32 start_frame = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a> - chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> input_frames;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="group__matrix__group.html#gaf3271765f4847367b99b9d9b94ce6b70">ExtractRowRangeWithPadding</a>(feats, start_frame, tot_input_frames,</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                               &amp;input_frames);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// &#39;input_frames&#39; now stores the relevant rows (maybe with padding) from the</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// original Matrix or (more likely) CompressedMatrix.  If a CompressedMatrix,</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// it does this without un-compressing and re-compressing, so there is no loss</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// of accuracy.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// call the regular input &quot;input&quot;.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;input&quot;</span>, -chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a>, input_frames));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span> (ivector_feats != NULL) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="comment">// if applicable, add the iVector feature.</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="comment">// choose iVector from a random frame in the chunk</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      int32 ivector_frame = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(start_frame,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                    start_frame + num_input_frames - 1),</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          ivector_frame_subsampled = ivector_frame / ivector_period;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">if</span> (ivector_frame_subsampled &lt; 0)</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        ivector_frame_subsampled = 0;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="keywordflow">if</span> (ivector_frame_subsampled &gt;= ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>())</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        ivector_frame_subsampled = ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - 1;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> ivector(1, ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>());</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      ivector.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(0).CopyFromVec(ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(ivector_frame_subsampled));</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;ivector&quot;</span>, 0, ivector));</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// Note: chunk.first_frame and chunk.num_frames will both be</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// multiples of frame_subsampling_factor.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    int32 start_frame_subsampled = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a> / frame_subsampling_factor,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        num_frames_subsampled = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a> / frame_subsampling_factor;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> labels(num_frames_subsampled);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// TODO: it may be that using these weights is not actually helpful (with</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// chain training, it was not), and that setting them all to 1 is better.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// We could add a boolean option to this program to control that; but I</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// don&#39;t want to add such an option if experiments show that it is not</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// helpful.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_frames_subsampled; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      int32 t = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + start_frame_subsampled;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">if</span> (t &lt; pdf_post.size())</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        labels[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = pdf_post[t];</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="keywordflow">for</span> (std::vector&lt;std::pair&lt;int32, BaseFloat&gt; &gt;::iterator</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;               iter = labels[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].begin(); iter != labels[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].end(); ++iter)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        iter-&gt;second *= chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#aef59454039de35ec68bd81f361f3bd78">output_weights</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;output&quot;</span>, num_pdfs, 0, labels, frame_subsampling_factor));</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (compress)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">Compress</a>();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    os &lt;&lt; utt_id &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    std::string key = os.str(); <span class="comment">// key is &lt;utt_id&gt;-&lt;frame_id&gt;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    example_writer-&gt;<a class="code" href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">Write</a>(key, eg);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html">kaldi::nnet3::NnetExample</a></div><div class="ttdoc">NnetExample is the input data and corresponding label (or labels) for one or more frames of input...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00111">nnet-example.h:111</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html">kaldi::nnet3::NnetIo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00033">nnet-example.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1GeneralMatrix_html"><div class="ttname"><a href="classkaldi_1_1GeneralMatrix.html">kaldi::GeneralMatrix</a></div><div class="ttdoc">This class is a wrapper that enables you to store a matrix in one of three forms: either as a Matrix&lt;...</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00282">sparse-matrix.h:282</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_ab05d4d57c7470362cd4216e27e309019"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#ab05d4d57c7470362cd4216e27e309019">kaldi::nnet3::UtteranceSplitter::LengthsMatch</a></div><div class="ttdeci">bool LengthsMatch(const std::string &amp;utt, int32 utterance_length, int32 supervision_length, int32 length_tolerance=0) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00553">nnet-example-utils.cc:553</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ExampleGenerationConfig_html_aad93df0dcdc32cf7ef176162619a9b47"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ExampleGenerationConfig.html#aad93df0dcdc32cf7ef176162619a9b47">kaldi::nnet3::ExampleGenerationConfig::frame_subsampling_factor</a></div><div class="ttdeci">int32 frame_subsampling_factor</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00088">nnet-example-utils.h:88</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a32d4a33731fac2ac8d3bc0dd478ecdf4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">kaldi::nnet3::ChunkTimeInfo::num_frames</a></div><div class="ttdeci">int32 num_frames</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00155">nnet-example-utils.h:155</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a9e87cd6f9e107e7ba9235a3acd722fe1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">kaldi::nnet3::ChunkTimeInfo::left_context</a></div><div class="ttdeci">int32 left_context</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00156">nnet-example-utils.h:156</a></div></div>
<div class="ttc" id="group__table__impl__types_html_ga383075d0a2cc01259054d4fde207f637"><div class="ttname"><a href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">kaldi::TableWriter::Write</a></div><div class="ttdeci">void Write(const std::string &amp;key, const T &amp;value) const</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-table-inl_8h_source.html#l01511">kaldi-table-inl.h:1511</a></div></div>
<div class="ttc" id="group__posterior__group_html_ga5c99e6141a5a3b3c5d424e99ffbd1ac6"><div class="ttname"><a href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">kaldi::Posterior</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, BaseFloat &gt; &gt; &gt; Posterior</div><div class="ttdoc">Posterior is a typedef for storing acoustic-state (actually, transition-id) posteriors over an uttera...</div><div class="ttdef"><b>Definition:</b> <a href="posterior_8h_source.html#l00043">posterior.h:43</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="group__matrix__group_html_gaf3271765f4847367b99b9d9b94ce6b70"><div class="ttname"><a href="group__matrix__group.html#gaf3271765f4847367b99b9d9b94ce6b70">kaldi::ExtractRowRangeWithPadding</a></div><div class="ttdeci">void ExtractRowRangeWithPadding(const GeneralMatrix &amp;in, int32 row_offset, int32 num_rows, GeneralMatrix *out)</div><div class="ttdoc">This function extracts a row-range of a GeneralMatrix and writes as a GeneralMatrix containing the sa...</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l01232">sparse-matrix.cc:1232</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_a0ba9edee3fd93ac653cee4e428b6e93e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">kaldi::nnet3::NnetExample::Compress</a></div><div class="ttdeci">void Compress()</div><div class="ttdoc">Compresses any (input) features that are not sparse. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8cc_source.html#l00130">nnet-example.cc:130</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_a15fc044c53f1e59804e6a38e3356dfd6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a15fc044c53f1e59804e6a38e3356dfd6">kaldi::nnet3::UtteranceSplitter::Config</a></div><div class="ttdeci">const ExampleGenerationConfig &amp; Config() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00175">nnet-example-utils.h:175</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="classkaldi_1_1GeneralMatrix_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1GeneralMatrix.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::GeneralMatrix::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l00781">sparse-matrix.cc:781</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a68fe50a4054b84d35b4641ce0d642d9b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">kaldi::nnet3::ChunkTimeInfo::first_frame</a></div><div class="ttdeci">int32 first_frame</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00154">nnet-example-utils.h:154</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_a1877ae7cc62d57076a6f9cc21ddfd129"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a1877ae7cc62d57076a6f9cc21ddfd129">kaldi::nnet3::UtteranceSplitter::GetChunksForUtterance</a></div><div class="ttdeci">void GetChunksForUtterance(int32 utterance_length, std::vector&lt; ChunkTimeInfo &gt; *chunk_info)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00822">nnet-example-utils.cc:822</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html">kaldi::nnet3::ChunkTimeInfo</a></div><div class="ttdoc">struct ChunkTimeInfo is used by class UtteranceSplitter to output information about how we split an u...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00153">nnet-example-utils.h:153</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a2fd7efd4d877cf7a105aeb392a07c2f4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a2fd7efd4d877cf7a105aeb392a07c2f4">kaldi::nnet3::ChunkTimeInfo::right_context</a></div><div class="ttdeci">int32 right_context</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00157">nnet-example-utils.h:157</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_aef59454039de35ec68bd81f361f3bd78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#aef59454039de35ec68bd81f361f3bd78">kaldi::nnet3::ChunkTimeInfo::output_weights</a></div><div class="ttdeci">std::vector&lt; BaseFloat &gt; output_weights</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00165">nnet-example-utils.h:165</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8c182569762d114b5d2a2619a7f885e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c182569762d114b5d2a2619a7f885e9">&#9670;&nbsp;</a></span>ProcessFile() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::ProcessFile </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>ivector_feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>ivector_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>targets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>utt_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_targets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>length_tolerance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a> *&#160;</td>
          <td class="paramname"><em>utt_splitter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *&#160;</td>
          <td class="paramname"><em>example_writer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-get-egs-dense-targets_8cc_source.html#l00034">34</a> of file <a class="el" href="nnet3-get-egs-dense-targets_8cc_source.html">nnet3-get-egs-dense-targets.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00130">NnetExample::Compress()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00175">UtteranceSplitter::Config()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l01232">kaldi::ExtractRowRangeWithPadding()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00154">ChunkTimeInfo::first_frame</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00088">ExampleGenerationConfig::frame_subsampling_factor</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00822">UtteranceSplitter::GetChunksForUtterance()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00156">ChunkTimeInfo::left_context</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00553">UtteranceSplitter::LengthsMatch()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00155">ChunkTimeInfo::num_frames</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="sparse-matrix_8cc_source.html#l00781">GeneralMatrix::NumRows()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00157">ChunkTimeInfo::right_context</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, and <a class="el" href="kaldi-table-inl_8h_source.html#l01511">TableWriter&lt; Holder &gt;::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                                           {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  int32 num_input_frames = feats.<a class="code" href="classkaldi_1_1GeneralMatrix.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>();</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">if</span> (!utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#ab05d4d57c7470362cd4216e27e309019">LengthsMatch</a>(utt_id, num_input_frames,</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                  targets.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(),</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                  length_tolerance)) {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (targets.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() == 0)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_targets &lt; 0 || targets.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>() == num_targets);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  std::vector&lt;ChunkTimeInfo&gt; chunks;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a1877ae7cc62d57076a6f9cc21ddfd129">GetChunksForUtterance</a>(num_input_frames, &amp;chunks);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">if</span> (chunks.empty()) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Not producing egs for utterance &quot;</span> &lt;&lt; utt_id</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; because it is too short: &quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;               &lt;&lt; num_input_frames &lt;&lt; <span class="stringliteral">&quot; frames.&quot;</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">// &#39;frame_subsampling_factor&#39; is not used in any recipes at the time of</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// writing, this is being supported to unify the code with the &#39;chain&#39; recipes</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// and in case we need it for some reason in future.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  int32 frame_subsampling_factor =</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a15fc044c53f1e59804e6a38e3356dfd6">Config</a>().<a class="code" href="structkaldi_1_1nnet3_1_1ExampleGenerationConfig.html#aad93df0dcdc32cf7ef176162619a9b47">frame_subsampling_factor</a>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> c = 0; c &lt; chunks.size(); c++) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html">ChunkTimeInfo</a> &amp;chunk = chunks[c];</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    int32 tot_input_frames = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a> + chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a> +</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a2fd7efd4d877cf7a105aeb392a07c2f4">right_context</a>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    int32 start_frame = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a> - chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="classkaldi_1_1GeneralMatrix.html">GeneralMatrix</a> input_frames;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="group__matrix__group.html#gaf3271765f4847367b99b9d9b94ce6b70">ExtractRowRangeWithPadding</a>(feats, start_frame, tot_input_frames,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                               &amp;input_frames);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// &#39;input_frames&#39; now stores the relevant rows (maybe with padding) from the</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// original Matrix or (more likely) CompressedMatrix.  If a CompressedMatrix,</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// it does this without un-compressing and re-compressing, so there is no loss</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// of accuracy.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// call the regular input &quot;input&quot;.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;input&quot;</span>, -chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a>, input_frames));</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (ivector_feats != NULL) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="comment">// if applicable, add the iVector feature.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="comment">// choose iVector from a random frame in the chunk</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      int32 ivector_frame = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(start_frame,</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                                    start_frame + num_input_frames - 1),</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          ivector_frame_subsampled = ivector_frame / ivector_period;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordflow">if</span> (ivector_frame_subsampled &lt; 0)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        ivector_frame_subsampled = 0;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keywordflow">if</span> (ivector_frame_subsampled &gt;= ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>())</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        ivector_frame_subsampled = ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - 1;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> ivector(1, ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>());</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      ivector.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(0).CopyFromVec(ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(ivector_frame_subsampled));</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;ivector&quot;</span>, 0, ivector));</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// Note: chunk.first_frame and chunk.num_frames will both be</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// multiples of frame_subsampling_factor.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    int32 start_frame_subsampled = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a> / frame_subsampling_factor,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        num_frames_subsampled = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a> / frame_subsampling_factor;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(start_frame_subsampled + num_frames_subsampled - 1 &lt;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                 targets.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>());</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// add the labels.</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> targets_part(num_frames_subsampled, targets.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>());</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_frames_subsampled; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">// Copy the i^th row of the target matrix from the (t+i)^th row of the</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="comment">// input targets matrix</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      int32 t = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + start_frame_subsampled;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="keywordflow">if</span> (t &gt;= targets.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>())</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        t = targets.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - 1;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> this_target_dest(targets_part, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> this_target_src(targets, t);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      this_target_dest.CopyFromVec(this_target_src);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// push this created targets matrix into the eg</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;output&quot;</span>, 0, targets_part, frame_subsampling_factor));</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">if</span> (compress)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">Compress</a>();</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    os &lt;&lt; utt_id &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    std::string key = os.str(); <span class="comment">// key is &lt;utt_id&gt;-&lt;frame_id&gt;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    example_writer-&gt;<a class="code" href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">Write</a>(key, eg);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html">kaldi::nnet3::NnetExample</a></div><div class="ttdoc">NnetExample is the input data and corresponding label (or labels) for one or more frames of input...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00111">nnet-example.h:111</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html">kaldi::nnet3::NnetIo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00033">nnet-example.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1GeneralMatrix_html"><div class="ttname"><a href="classkaldi_1_1GeneralMatrix.html">kaldi::GeneralMatrix</a></div><div class="ttdoc">This class is a wrapper that enables you to store a matrix in one of three forms: either as a Matrix&lt;...</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8h_source.html#l00282">sparse-matrix.h:282</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_ab05d4d57c7470362cd4216e27e309019"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#ab05d4d57c7470362cd4216e27e309019">kaldi::nnet3::UtteranceSplitter::LengthsMatch</a></div><div class="ttdeci">bool LengthsMatch(const std::string &amp;utt, int32 utterance_length, int32 supervision_length, int32 length_tolerance=0) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00553">nnet-example-utils.cc:553</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ExampleGenerationConfig_html_aad93df0dcdc32cf7ef176162619a9b47"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ExampleGenerationConfig.html#aad93df0dcdc32cf7ef176162619a9b47">kaldi::nnet3::ExampleGenerationConfig::frame_subsampling_factor</a></div><div class="ttdeci">int32 frame_subsampling_factor</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00088">nnet-example-utils.h:88</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a32d4a33731fac2ac8d3bc0dd478ecdf4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">kaldi::nnet3::ChunkTimeInfo::num_frames</a></div><div class="ttdeci">int32 num_frames</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00155">nnet-example-utils.h:155</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a9e87cd6f9e107e7ba9235a3acd722fe1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">kaldi::nnet3::ChunkTimeInfo::left_context</a></div><div class="ttdeci">int32 left_context</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00156">nnet-example-utils.h:156</a></div></div>
<div class="ttc" id="group__table__impl__types_html_ga383075d0a2cc01259054d4fde207f637"><div class="ttname"><a href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">kaldi::TableWriter::Write</a></div><div class="ttdeci">void Write(const std::string &amp;key, const T &amp;value) const</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-table-inl_8h_source.html#l01511">kaldi-table-inl.h:1511</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="group__matrix__group_html_gaf3271765f4847367b99b9d9b94ce6b70"><div class="ttname"><a href="group__matrix__group.html#gaf3271765f4847367b99b9d9b94ce6b70">kaldi::ExtractRowRangeWithPadding</a></div><div class="ttdeci">void ExtractRowRangeWithPadding(const GeneralMatrix &amp;in, int32 row_offset, int32 num_rows, GeneralMatrix *out)</div><div class="ttdoc">This function extracts a row-range of a GeneralMatrix and writes as a GeneralMatrix containing the sa...</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l01232">sparse-matrix.cc:1232</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_a0ba9edee3fd93ac653cee4e428b6e93e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">kaldi::nnet3::NnetExample::Compress</a></div><div class="ttdeci">void Compress()</div><div class="ttdoc">Compresses any (input) features that are not sparse. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8cc_source.html#l00130">nnet-example.cc:130</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_a15fc044c53f1e59804e6a38e3356dfd6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a15fc044c53f1e59804e6a38e3356dfd6">kaldi::nnet3::UtteranceSplitter::Config</a></div><div class="ttdeci">const ExampleGenerationConfig &amp; Config() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00175">nnet-example-utils.h:175</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="classkaldi_1_1GeneralMatrix_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1GeneralMatrix.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::GeneralMatrix::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdef"><b>Definition:</b> <a href="sparse-matrix_8cc_source.html#l00781">sparse-matrix.cc:781</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a68fe50a4054b84d35b4641ce0d642d9b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">kaldi::nnet3::ChunkTimeInfo::first_frame</a></div><div class="ttdeci">int32 first_frame</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00154">nnet-example-utils.h:154</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_a1877ae7cc62d57076a6f9cc21ddfd129"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a1877ae7cc62d57076a6f9cc21ddfd129">kaldi::nnet3::UtteranceSplitter::GetChunksForUtterance</a></div><div class="ttdeci">void GetChunksForUtterance(int32 utterance_length, std::vector&lt; ChunkTimeInfo &gt; *chunk_info)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00822">nnet-example-utils.cc:822</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html">kaldi::nnet3::ChunkTimeInfo</a></div><div class="ttdoc">struct ChunkTimeInfo is used by class UtteranceSplitter to output information about how we split an u...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00153">nnet-example-utils.h:153</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a2fd7efd4d877cf7a105aeb392a07c2f4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a2fd7efd4d877cf7a105aeb392a07c2f4">kaldi::nnet3::ChunkTimeInfo::right_context</a></div><div class="ttdeci">int32 right_context</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00157">nnet-example-utils.h:157</a></div></div>
<div class="ttc" id="classkaldi_1_1SubVector_html"><div class="ttname"><a href="classkaldi_1_1SubVector.html">kaldi::SubVector</a></div><div class="ttdoc">Represents a non-allocating general vector which can be defined as a sub-vector of higher-level vecto...</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00485">kaldi-vector.h:485</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc93395c770a7f80de373381c8b8b569"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc93395c770a7f80de373381c8b8b569">&#9670;&nbsp;</a></span>ProcessFile() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::ProcessFile </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1discriminative_1_1SplitDiscriminativeSupervisionOptions.html">discriminative::SplitDiscriminativeSupervisionOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>ivector_feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>ivector_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html">discriminative::DiscriminativeSupervision</a> &amp;&#160;</td>
          <td class="paramname"><em>supervision</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>utt_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html">UtteranceSplitter</a> *&#160;</td>
          <td class="paramname"><em>utt_splitter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet3.html#acdfc2ad7f1c7dbba13a2d991e6a4d004">NnetDiscriminativeExampleWriter</a> *&#160;</td>
          <td class="paramname"><em>example_writer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-discriminative-get-egs_8cc_source.html#l00039">39</a> of file <a class="el" href="nnet3-discriminative-get-egs_8cc_source.html">nnet3-discriminative-get-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-discriminative-example_8cc_source.html#l00175">NnetDiscriminativeExample::Compress()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00175">UtteranceSplitter::Config()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00154">ChunkTimeInfo::first_frame</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00088">ExampleGenerationConfig::frame_subsampling_factor</a>, <a class="el" href="discriminative-supervision_8h_source.html#l00091">DiscriminativeSupervision::frames_per_sequence</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00822">UtteranceSplitter::GetChunksForUtterance()</a>, <a class="el" href="discriminative-supervision_8cc_source.html#l00206">DiscriminativeSupervisionSplitter::GetFrameRange()</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00108">NnetDiscriminativeExample::inputs</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00156">ChunkTimeInfo::left_context</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00553">UtteranceSplitter::LengthsMatch()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00155">ChunkTimeInfo::num_frames</a>, <a class="el" href="discriminative-supervision_8h_source.html#l00085">DiscriminativeSupervision::num_sequences</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00165">ChunkTimeInfo::output_weights</a>, <a class="el" href="nnet-discriminative-example_8h_source.html#l00112">NnetDiscriminativeExample::outputs</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-example-utils_8h_source.html#l00157">ChunkTimeInfo::right_context</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, and <a class="el" href="kaldi-table-inl_8h_source.html#l01511">TableWriter&lt; Holder &gt;::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-discriminative-get-egs_8cc_source.html#l00155">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                                                         {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(supervision.<a class="code" href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html#aa356c9de13e95f27cd10ad86b89af12d">num_sequences</a> == 1);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  int32 num_input_frames = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(),</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      num_output_frames = supervision.<a class="code" href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html#a32671791a3046a76fd0afcac8e0f1eba">frames_per_sequence</a>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (!utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#ab05d4d57c7470362cd4216e27e309019">LengthsMatch</a>(utt_id, num_input_frames, num_output_frames))</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// LengthsMatch() will have printed a warning.</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  std::vector&lt;ChunkTimeInfo&gt; chunks;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a1877ae7cc62d57076a6f9cc21ddfd129">GetChunksForUtterance</a>(num_input_frames, &amp;chunks);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> (chunks.empty()) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Not producing egs for utterance &quot;</span> &lt;&lt; utt_id</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; because it is too short: &quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;               &lt;&lt; num_input_frames &lt;&lt; <span class="stringliteral">&quot; frames.&quot;</span>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  int32 frame_subsampling_factor = utt_splitter-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a15fc044c53f1e59804e6a38e3356dfd6">Config</a>().<a class="code" href="structkaldi_1_1nnet3_1_1ExampleGenerationConfig.html#aad93df0dcdc32cf7ef176162619a9b47">frame_subsampling_factor</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="classkaldi_1_1discriminative_1_1DiscriminativeSupervisionSplitter.html">discriminative::DiscriminativeSupervisionSplitter</a> splitter(config, tmodel,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                                             supervision);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> c = 0; c &lt; chunks.size(); c++) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html">ChunkTimeInfo</a> &amp;chunk = chunks[c];</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> nnet_discriminative_eg;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    nnet_discriminative_eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a3afbf386e574780804293c8e52947b12">outputs</a>.resize(1);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    int32 start_frame_subsampled = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a> / frame_subsampling_factor,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        num_frames_subsampled = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a> / frame_subsampling_factor;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html">discriminative::DiscriminativeSupervision</a> supervision_part;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    splitter.GetFrameRange(start_frame_subsampled,</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                           num_frames_subsampled,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                           (c == 0 ? <span class="keyword">false</span> : <span class="keyword">true</span>),</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                           &amp;supervision_part);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> output_weights(</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        &amp;(chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#aef59454039de35ec68bd81f361f3bd78">output_weights</a>[0]),</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        static_cast&lt;int32&gt;(chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#aef59454039de35ec68bd81f361f3bd78">output_weights</a>.size()));</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    int32 first_frame = 0;  <span class="comment">// we shift the time-indexes of all these parts so</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                            <span class="comment">// that the supervised part starts from frame 0.</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision.html">NnetDiscriminativeSupervision</a> nnet_supervision(<span class="stringliteral">&quot;output&quot;</span>, supervision_part,</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                                                   output_weights,</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                                   first_frame,</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                                                   frame_subsampling_factor);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    nnet_discriminative_eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a3afbf386e574780804293c8e52947b12">outputs</a>[0].Swap(&amp;nnet_supervision);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    nnet_discriminative_eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a24d114fd4f1d4e7c27a89ceae44b4c36">inputs</a>.resize(ivector_feats != NULL ? 2 : 1);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    int32 tot_input_frames = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a> + chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a> +</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a2fd7efd4d877cf7a105aeb392a07c2f4">right_context</a>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> input_frames(tot_input_frames, feats.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>(),</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                   <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    int32 start_frame = chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a> - chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">for</span> (int32 t = start_frame; t &lt; start_frame + tot_input_frames; t++) {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      int32 t2 = t;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">if</span> (t2 &lt; 0) t2 = 0;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordflow">if</span> (t2 &gt;= num_input_frames) t2 = num_input_frames - 1;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = t - start_frame;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> src(feats, t2),</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;          dest(input_frames, j);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      dest.CopyFromVec(src);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> input_io(<span class="stringliteral">&quot;input&quot;</span>, -chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a>, input_frames);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    nnet_discriminative_eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a24d114fd4f1d4e7c27a89ceae44b4c36">inputs</a>[0].Swap(&amp;input_io);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">if</span> (ivector_feats != NULL) {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="comment">// if applicable, add the iVector feature.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="comment">// choose iVector from a random frame in the chunk</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      int32 ivector_frame = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(start_frame,</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                                    start_frame + num_input_frames - 1),</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;          ivector_frame_subsampled = ivector_frame / ivector_period;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordflow">if</span> (ivector_frame_subsampled &lt; 0)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        ivector_frame_subsampled = 0;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">if</span> (ivector_frame_subsampled &gt;= ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>())</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        ivector_frame_subsampled = ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - 1;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> ivector(1, ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>());</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      ivector.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(0).CopyFromVec(ivector_feats-&gt;<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(ivector_frame_subsampled));</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> ivector_io(<span class="stringliteral">&quot;ivector&quot;</span>, 0, ivector);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      nnet_discriminative_eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a24d114fd4f1d4e7c27a89ceae44b4c36">inputs</a>[1].Swap(&amp;ivector_io);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (compress)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      nnet_discriminative_eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">Compress</a>();</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    os &lt;&lt; utt_id &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; chunk.<a class="code" href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">first_frame</a>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    std::string key = os.str(); <span class="comment">// key is &lt;utt_id&gt;-&lt;frame_id&gt;</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    example_writer-&gt;<a class="code" href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">Write</a>(key, nnet_discriminative_eg);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html">kaldi::nnet3::NnetIo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00033">nnet-example.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_ab05d4d57c7470362cd4216e27e309019"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#ab05d4d57c7470362cd4216e27e309019">kaldi::nnet3::UtteranceSplitter::LengthsMatch</a></div><div class="ttdeci">bool LengthsMatch(const std::string &amp;utt, int32 utterance_length, int32 supervision_length, int32 length_tolerance=0) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00553">nnet-example-utils.cc:553</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ExampleGenerationConfig_html_aad93df0dcdc32cf7ef176162619a9b47"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ExampleGenerationConfig.html#aad93df0dcdc32cf7ef176162619a9b47">kaldi::nnet3::ExampleGenerationConfig::frame_subsampling_factor</a></div><div class="ttdeci">int32 frame_subsampling_factor</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00088">nnet-example-utils.h:88</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a32d4a33731fac2ac8d3bc0dd478ecdf4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">kaldi::nnet3::ChunkTimeInfo::num_frames</a></div><div class="ttdeci">int32 num_frames</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00155">nnet-example-utils.h:155</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="classkaldi_1_1discriminative_1_1DiscriminativeSupervisionSplitter_html"><div class="ttname"><a href="classkaldi_1_1discriminative_1_1DiscriminativeSupervisionSplitter.html">kaldi::discriminative::DiscriminativeSupervisionSplitter</a></div><div class="ttdef"><b>Definition:</b> <a href="discriminative-supervision_8h_source.html#l00140">discriminative-supervision.h:140</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a9e87cd6f9e107e7ba9235a3acd722fe1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a9e87cd6f9e107e7ba9235a3acd722fe1">kaldi::nnet3::ChunkTimeInfo::left_context</a></div><div class="ttdeci">int32 left_context</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00156">nnet-example-utils.h:156</a></div></div>
<div class="ttc" id="group__table__impl__types_html_ga383075d0a2cc01259054d4fde207f637"><div class="ttname"><a href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">kaldi::TableWriter::Write</a></div><div class="ttdeci">void Write(const std::string &amp;key, const T &amp;value) const</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-table-inl_8h_source.html#l01511">kaldi-table-inl.h:1511</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample_html_a0ba9edee3fd93ac653cee4e428b6e93e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">kaldi::nnet3::NnetDiscriminativeExample::Compress</a></div><div class="ttdeci">void Compress()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-discriminative-example_8cc_source.html#l00175">nnet-discriminative-example.cc:175</a></div></div>
<div class="ttc" id="structkaldi_1_1discriminative_1_1DiscriminativeSupervision_html_aa356c9de13e95f27cd10ad86b89af12d"><div class="ttname"><a href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html#aa356c9de13e95f27cd10ad86b89af12d">kaldi::discriminative::DiscriminativeSupervision::num_sequences</a></div><div class="ttdeci">int32 num_sequences</div><div class="ttdef"><b>Definition:</b> <a href="discriminative-supervision_8h_source.html#l00085">discriminative-supervision.h:85</a></div></div>
<div class="ttc" id="structkaldi_1_1discriminative_1_1DiscriminativeSupervision_html_a32671791a3046a76fd0afcac8e0f1eba"><div class="ttname"><a href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html#a32671791a3046a76fd0afcac8e0f1eba">kaldi::discriminative::DiscriminativeSupervision::frames_per_sequence</a></div><div class="ttdeci">int32 frames_per_sequence</div><div class="ttdef"><b>Definition:</b> <a href="discriminative-supervision_8h_source.html#l00091">discriminative-supervision.h:91</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="structkaldi_1_1discriminative_1_1DiscriminativeSupervision_html"><div class="ttname"><a href="structkaldi_1_1discriminative_1_1DiscriminativeSupervision.html">kaldi::discriminative::DiscriminativeSupervision</a></div><div class="ttdef"><b>Definition:</b> <a href="discriminative-supervision_8h_source.html#l00075">discriminative-supervision.h:75</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_a15fc044c53f1e59804e6a38e3356dfd6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a15fc044c53f1e59804e6a38e3356dfd6">kaldi::nnet3::UtteranceSplitter::Config</a></div><div class="ttdeci">const ExampleGenerationConfig &amp; Config() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00175">nnet-example-utils.h:175</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample_html_a24d114fd4f1d4e7c27a89ceae44b4c36"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a24d114fd4f1d4e7c27a89ceae44b4c36">kaldi::nnet3::NnetDiscriminativeExample::inputs</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; inputs</div><div class="ttdoc">&amp;#39;inputs&amp;#39; contains the input to the network– normally just it has just one element called &quot;input&quot;...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-discriminative-example_8h_source.html#l00108">nnet-discriminative-example.h:108</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a68fe50a4054b84d35b4641ce0d642d9b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a68fe50a4054b84d35b4641ce0d642d9b">kaldi::nnet3::ChunkTimeInfo::first_frame</a></div><div class="ttdeci">int32 first_frame</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00154">nnet-example-utils.h:154</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample_html_a3afbf386e574780804293c8e52947b12"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html#a3afbf386e574780804293c8e52947b12">kaldi::nnet3::NnetDiscriminativeExample::outputs</a></div><div class="ttdeci">std::vector&lt; NnetDiscriminativeSupervision &gt; outputs</div><div class="ttdoc">&amp;#39;outputs&amp;#39; contains the sequence output supervision. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-discriminative-example_8h_source.html#l00112">nnet-discriminative-example.h:112</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UtteranceSplitter_html_a1877ae7cc62d57076a6f9cc21ddfd129"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UtteranceSplitter.html#a1877ae7cc62d57076a6f9cc21ddfd129">kaldi::nnet3::UtteranceSplitter::GetChunksForUtterance</a></div><div class="ttdeci">void GetChunksForUtterance(int32 utterance_length, std::vector&lt; ChunkTimeInfo &gt; *chunk_info)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00822">nnet-example-utils.cc:822</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html">kaldi::nnet3::ChunkTimeInfo</a></div><div class="ttdoc">struct ChunkTimeInfo is used by class UtteranceSplitter to output information about how we split an u...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00153">nnet-example-utils.h:153</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_a2fd7efd4d877cf7a105aeb392a07c2f4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#a2fd7efd4d877cf7a105aeb392a07c2f4">kaldi::nnet3::ChunkTimeInfo::right_context</a></div><div class="ttdeci">int32 right_context</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00157">nnet-example-utils.h:157</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeSupervision.html">kaldi::nnet3::NnetDiscriminativeSupervision</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-discriminative-example_8h_source.html#l00042">nnet-discriminative-example.h:42</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkTimeInfo_html_aef59454039de35ec68bd81f361f3bd78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkTimeInfo.html#aef59454039de35ec68bd81f361f3bd78">kaldi::nnet3::ChunkTimeInfo::output_weights</a></div><div class="ttdeci">std::vector&lt; BaseFloat &gt; output_weights</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8h_source.html#l00165">nnet-example-utils.h:165</a></div></div>
<div class="ttc" id="classkaldi_1_1SubVector_html"><div class="ttname"><a href="classkaldi_1_1SubVector.html">kaldi::SubVector</a></div><div class="ttdoc">Represents a non-allocating general vector which can be defined as a sub-vector of higher-level vecto...</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00485">kaldi-vector.h:485</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">kaldi::nnet3::NnetDiscriminativeExample</a></div><div class="ttdoc">NnetDiscriminativeExample is like NnetExample, but specialized for sequence training. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-discriminative-example_8h_source.html#l00103">nnet-discriminative-example.h:103</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a21d7e0dc98beba206f0d12d28242d2e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21d7e0dc98beba206f0d12d28242d2e7">&#9670;&nbsp;</a></span>ProcessRangeFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ProcessRangeFile </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>range_rxfilename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unordered_map&lt; std::string, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a> *&gt; &gt; *&#160;</td>
          <td class="paramname"><em>utt_to_chunks</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00041">41</a> of file <a class="el" href="nnet3-xvector-get-egs_8cc_source.html">nnet3-xvector-get-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="text-utils_8h_source.html#l00118">kaldi::ConvertStringToInteger()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00036">ChunkInfo::label</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00032">ChunkInfo::name</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00035">ChunkInfo::num_frames</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00033">ChunkInfo::output_archive_id</a>, <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00034">ChunkInfo::start_frame</a>, and <a class="el" href="kaldi-io_8cc_source.html#l00826">Input::Stream()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00133">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                                                                      {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <a class="code" href="classkaldi_1_1Input.html">Input</a> range_input(range_rxfilename);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> (!range_rxfilename.empty()) {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    std::string line;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">while</span> (std::getline(range_input.Stream(), line)) {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a> *chunk_info = <span class="keyword">new</span> <a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a>();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      std::vector&lt;std::string&gt; fields;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(line, <span class="stringliteral">&quot; \t\n\r&quot;</span>, <span class="keyword">true</span>, &amp;fields);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="keywordflow">if</span> (fields.size() != 6)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expected 6 fields in line of range file, got &quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                  &lt;&lt; fields.size() &lt;&lt; <span class="stringliteral">&quot; instead.&quot;</span>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      std::string utt = fields[0],</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                  start_frame_str = fields[3],</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                  num_frames_str = fields[4],</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                  label_str = fields[5];</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(fields[1], &amp;(chunk_info-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#aefb7220e8b18a6fd1e0430df564a6291">output_archive_id</a>))</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        || !<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(start_frame_str, &amp;(chunk_info-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a969781fb95c6184c8be93f4e842be91d">start_frame</a>))</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        || !<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(num_frames_str, &amp;(chunk_info-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a>))</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        || !<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(label_str, &amp;(chunk_info-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a17949517954748c8140efd8137e25c0d">label</a>)))</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expected integer for output archive in range file.&quot;</span>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      chunk_info-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a9b45b3e13bd9167aab02e17e08916231">name</a> = utt + <span class="stringliteral">&quot;-&quot;</span> + start_frame_str + <span class="stringliteral">&quot;-&quot;</span> + num_frames_str</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        + <span class="stringliteral">&quot;-&quot;</span> + label_str;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      unordered_map&lt;std::string, std::vector&lt;ChunkInfo*&gt; &gt;::iterator</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        got = utt_to_chunks-&gt;find(utt);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">if</span> (got == utt_to_chunks-&gt;end()) {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        std::vector&lt;ChunkInfo* &gt; chunk_infos;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        chunk_infos.push_back(chunk_info);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        utt_to_chunks-&gt;insert(std::pair&lt;std::string,</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;          std::vector&lt;ChunkInfo* &gt; &gt; (utt, chunk_infos));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        got-&gt;second.push_back(chunk_info);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a39eb3f7ce5fab6dbbcb396b3f8e196f4"><div class="ttname"><a href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">kaldi::ConvertStringToInteger</a></div><div class="ttdeci">bool ConvertStringToInteger(const std::string &amp;str, Int *out)</div><div class="ttdoc">Converts a string into an integer via strtoll and returns false if there was any kind of problem (i...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00118">text-utils.h:118</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a969781fb95c6184c8be93f4e842be91d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a969781fb95c6184c8be93f4e842be91d">kaldi::nnet3::ChunkInfo::start_frame</a></div><div class="ttdeci">int32 start_frame</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00034">nnet3-xvector-get-egs.cc:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a17949517954748c8140efd8137e25c0d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a17949517954748c8140efd8137e25c0d">kaldi::nnet3::ChunkInfo::label</a></div><div class="ttdeci">int32 label</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00036">nnet3-xvector-get-egs.cc:36</a></div></div>
<div class="ttc" id="classkaldi_1_1Input_html"><div class="ttname"><a href="classkaldi_1_1Input.html">kaldi::Input</a></div><div class="ttdef"><b>Definition:</b> <a href="kaldi-io_8h_source.html#l00190">kaldi-io.h:190</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html">kaldi::nnet3::ChunkInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00031">nnet3-xvector-get-egs.cc:31</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a32d4a33731fac2ac8d3bc0dd478ecdf4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">kaldi::nnet3::ChunkInfo::num_frames</a></div><div class="ttdeci">int32 num_frames</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00035">nnet3-xvector-get-egs.cc:35</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_aefb7220e8b18a6fd1e0430df564a6291"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#aefb7220e8b18a6fd1e0430df564a6291">kaldi::nnet3::ChunkInfo::output_archive_id</a></div><div class="ttdeci">int32 output_archive_id</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00033">nnet3-xvector-get-egs.cc:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a9b45b3e13bd9167aab02e17e08916231">kaldi::nnet3::ChunkInfo::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00032">nnet3-xvector-get-egs.cc:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a181c197e76d410f285809f04dc2bc23e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a181c197e76d410f285809f04dc2bc23e">&#9670;&nbsp;</a></span>ReadCindexVector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReadCindexVector </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00309">309</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-descriptor_8cc_source.html#l00045">ExpectToken()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00055">kaldi::ReadBasicType()</a>, and <a class="el" href="nnet-common_8cc_source.html#l00224">ReadCindexVectorElementBinary()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8cc_source.html#l00181">NnetComputation::MatrixDebugInfo::Read()</a>, and <a class="el" href="nnet-common-test_8cc_source.html#l00062">UnitTestCindexIo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                              {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">ExpectToken</a>(is, binary, <span class="stringliteral">&quot;&lt;I1V&gt;&quot;</span>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  int32 size;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;size);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">if</span> (size &lt; 0) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Error reading Index vector: size = &quot;</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;              &lt;&lt; size;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  vec-&gt;resize(size);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (!binary) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      is &gt;&gt; std::ws;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">if</span> (is.peek() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="charliteral">&#39;]&#39;</span>) || <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> != 0)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;          is.get();</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        is &gt;&gt; std::ws;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">if</span> (is.peek() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="charliteral">&#39;[&#39;</span>)) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;          is.get();</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;ReadCintegerVector: expected to see [, saw &quot;</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    &lt;&lt; is.peek() &lt;&lt; <span class="stringliteral">&quot;, at file position &quot;</span> &lt;&lt; is.tellg();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;((*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first));</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        is &gt;&gt; std::ws;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span> (is.peek() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="charliteral">&#39;:&#39;</span>)) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          is.get();</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;ReadCintegerVector: expected to see :, saw &quot;</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    &lt;&lt; is.peek() &lt;&lt; <span class="stringliteral">&quot;, at file position &quot;</span> &lt;&lt; is.tellg();</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first = (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].first;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.Read(is, binary);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == size - 1) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        is &gt;&gt; std::ws;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">if</span> (is.peek() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="charliteral">&#39;]&#39;</span>)) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          is.get();</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;ReadCintegerVector: expected to see ], saw &quot;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    &lt;&lt; is.peek() &lt;&lt; <span class="stringliteral">&quot;, at file position &quot;</span> &lt;&lt; is.tellg();</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#af6250805a562082c954662a7311f4cd1">ReadCindexVectorElementBinary</a>(is, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, vec);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div><div class="ttc" id="group__io__funcs__basic_html_ga1bd1af0ef712b76f2332febcec8d095a"><div class="ttname"><a href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">kaldi::ReadBasicType</a></div><div class="ttdeci">void ReadBasicType(std::istream &amp;is, bool binary, T *t)</div><div class="ttdoc">ReadBasicType is the name of the read function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00055">io-funcs-inl.h:55</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga4c7a80f758e878578e78b667f62463a5"><div class="ttname"><a href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">kaldi::ExpectToken</a></div><div class="ttdeci">void ExpectToken(std::istream &amp;is, bool binary, const char *token)</div><div class="ttdoc">ExpectToken tries to read in the given token, and throws an exception on failure. ...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00194">io-funcs.cc:194</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af6250805a562082c954662a7311f4cd1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af6250805a562082c954662a7311f4cd1">kaldi::nnet3::ReadCindexVectorElementBinary</a></div><div class="ttdeci">static void ReadCindexVectorElementBinary(std::istream &amp;is, int32 i, std::vector&lt; Cindex &gt; *vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00224">nnet-common.cc:224</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af6250805a562082c954662a7311f4cd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6250805a562082c954662a7311f4cd1">&#9670;&nbsp;</a></span>ReadCindexVectorElementBinary()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ReadCindexVectorElementBinary </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; *&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00224">224</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00055">kaldi::ReadBasicType()</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common_8cc_source.html#l00309">ReadCindexVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                            {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">bool</span> binary = <span class="keyword">true</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  Index &amp;index = (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">if</span> (!is.good())</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;End of file while reading vector of Cindex.&quot;</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">if</span> (is.peek() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="charliteral">&#39;|&#39;</span>)) {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    is.get();</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;((*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first));</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> != 0);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first = (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].first;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">signed</span> <span class="keywordtype">char</span> c = is.get();</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (std::abs(<span class="keywordtype">int</span>(c)) &lt; 125) {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      index.n = 0;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      index.t = c;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      index.x = 0;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 125 || c == 126) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      index.n = c - 125;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      index.t = 0;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      index.x = 0;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">if</span> (c != 127)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected character &quot;</span> &lt;&lt; c</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; encountered while reading Cindex vector.&quot;</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.n));</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.t));</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.x));</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    Index &amp;last_index = (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">if</span> (std::abs(<span class="keywordtype">int</span>(c)) &lt; 124) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      index.n = last_index.n;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      index.t = last_index.t + c;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      index.x = last_index.x;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 125 || c == 126) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      index.n = last_index.n + c - 125;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      index.t = last_index.t;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      index.x = last_index.x;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">if</span> (c != 127)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected character &quot;</span> &lt;&lt; c</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; encountered while reading Cindex vector.&quot;</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.n));</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.t));</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.x));</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="ttc" id="group__io__funcs__basic_html_ga1bd1af0ef712b76f2332febcec8d095a"><div class="ttname"><a href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">kaldi::ReadBasicType</a></div><div class="ttdeci">void ReadBasicType(std::istream &amp;is, bool binary, T *t)</div><div class="ttdoc">ReadBasicType is the name of the read function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00055">io-funcs-inl.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a331cfb436079c33852b5514e6691f6be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a331cfb436079c33852b5514e6691f6be">&#9670;&nbsp;</a></span>ReadConfigLines()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReadConfigLines </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>lines</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function reads in a config file and *appends* its contents to a vector of lines; it is responsible for removing comments (anything after '#') and stripping out any lines that contain only whitespace after comment removal. </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00436">436</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, <a class="el" href="nnet-utils_8cc_source.html#l01148">ReadEditConfig()</a>, and <a class="el" href="nnet-parse-test_8cc_source.html#l00177">UnitTestReadConfig()</a>.</p>
<div class="fragment"><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                                 {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lines != NULL);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  std::string line;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">while</span> (std::getline(is, line)) {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span> (line.size() == 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordtype">size_t</span> start = line.find_first_not_of(<span class="stringliteral">&quot; \t&quot;</span>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">size_t</span> end = line.find_first_of(<span class="charliteral">&#39;#&#39;</span>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">if</span> (start == std::string::npos || start == end) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    end = line.find_last_not_of(<span class="stringliteral">&quot; \t&quot;</span>, end - 1);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(end &gt;= start);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    lines-&gt;push_back(line.substr(start, end - start + 1));</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad587de6247cba206672dafb6ef70dc12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad587de6247cba206672dafb6ef70dc12">&#9670;&nbsp;</a></span>ReadEditConfig()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReadEditConfig </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>config_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="namespacekaldi_1_1nnet3.html#ad587de6247cba206672dafb6ef70dc12" title="ReadEditConfig() reads a file with a similar-looking format to the config file read by Nnet::ReadConf...">ReadEditConfig()</a> reads a file with a similar-looking format to the config file read by <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">Nnet::ReadConfig()</a>, but this consists of a sequence of operations to perform on an existing network, mostly modifying components. </p>
<p>It's one "directive" (i.e. command) per line, but if supplying the options via the &ndash;edits option to programs like nnet3-am-copy, you can use a semicolon in place of the newline to separate commands.</p>
<p>The following describes the allowed commands. Note: all patterns are like UNIX globbing patterns where the only metacharacter is '*', representing zero or more characters.</p>
<pre class="fragment">  convert-to-fixed-affine [name=&lt;name-pattern&gt;]
    Converts the given affine components to FixedAffineComponent which is not updatable.

  remove-orphan-nodes [remove-orphan-inputs=(true|false)]
    Removes orphan nodes (that are never used to compute anything).  Note:
    remove-orphan-inputs defaults to false.

  remove-orphan-components
    Removes orphan components (those that are never used by any node).

  remove-orphans [remove-orphan-inputs=(true|false)]
    The same as calling remove-orphan-nodes and then remove-orphan-components.

  set-learning-rate [name=&lt;name-pattern&gt;] learning-rate=&lt;learning-rate&gt;
     Sets the learning rate for any updatable components matching the name pattern.
     Note: this sets the 'underlying' learning rate, i.e. it will get
     multiplied by any 'learning-rate-factor' set in the components.

  set-learning-rate-factor [name=&lt;name-pattern&gt;] learning-rate-factor=&lt;learning-rate-factor&gt;
     Sets the learning rate factor for any updatable components matching the name pattern.

  rename-node old-name=&lt;old-name&gt; new-name=&lt;new-name&gt;
     Renames a node; this is a surface renaming that does not affect the structure
     (for structural changes, use the regular config file format, not the
     edits-config).  This is mostly useful for outputs, e.g. when doing
     multilingual experiments.

  remove-output-nodes name=&lt;name-pattern&gt;
     Removes a subset of output nodes, those matching the pattern.  You cannot
     remove internal nodes directly; instead you should use the command
     'remove-orphans'.

  set-dropout-proportion [name=&lt;name-pattern&gt;] proportion=&lt;dropout-proportion&gt;
     Sets the dropout rates for any components of type DropoutComponent,
     DropoutMaskComponent or GeneralDropoutComponent whose
     names match the given &lt;name-pattern&gt; (e.g. lstm*).  &lt;name-pattern&gt; defaults to "*".

  apply-svd name=&lt;name-pattern&gt; bottleneck-dim=&lt;dim&gt;
     Locates all components with names matching &lt;name-pattern&gt;, which are
     type AffineComponent or child classes thereof.  If &lt;dim&gt; is
     less than the minimum of the (input or output) dimension of the component,
     it does SVD on the components' parameters, retaining only the alrgest
     &lt;dim&gt; singular values, replacing these components with sequences of two
     components, of types LinearComponent and NaturalGradientAffineComponent.
     See also 'reduce-rank'.

  reduce-rank name=&lt;name-pattern&gt; rank=&lt;dim&gt;
     Locates all components with names matching &lt;name-pattern&gt;, which are
     type AffineComponent or child classes thereof.  Does SVD on the
     components' parameters, retaining only the largest &lt;dim&gt; singular values,
     and writes the reconstructed matrix back to the component.  See also
     'apply-svd', which structurally breaks the component into two pieces.</pre> 
<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l01148">1148</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00641">SvdApplier::ApplySvd()</a>, <a class="el" href="nnet-parse_8h_source.html#l00071">ConfigLine::FirstToken()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00689">Nnet::GetComponentName()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00466">Nnet::GetNodeIndex()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00684">Nnet::GetNodeName()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00115">ConfigLine::GetValue()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00198">ConfigLine::HasUnusedValues()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00112">Nnet::IsOutputNode()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-parse_8cc_source.html#l00608">NameMatchesPattern()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00126">Nnet::NumNodes()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00597">ParseConfigLines()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00436">ReadConfigLines()</a>, <a class="el" href="nnet-utils_8cc_source.html#l01086">ReduceRankOfComponents()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00844">Nnet::RemoveOrphanComponents()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00932">Nnet::RemoveOrphanNodes()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00881">Nnet::RemoveSomeNodes()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00155">Nnet::SetComponent()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00140">DropoutComponent::SetDropoutProportion()</a>, <a class="el" href="nnet-general-component_8h_source.html#l00772">DropoutMaskComponent::SetDropoutProportion()</a>, <a class="el" href="nnet-general-component_8h_source.html#l00888">GeneralDropoutComponent::SetDropoutProportion()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00492">UpdatableComponent::SetLearningRateFactor()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00053">Nnet::SetNodeName()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00478">UpdatableComponent::SetUnderlyingLearningRate()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00206">ConfigLine::UnusedValues()</a>, and <a class="el" href="nnet-parse_8h_source.html#l00073">ConfigLine::WholeLine()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, and <a class="el" href="nnet3-am-copy_8cc_source.html#l00028">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                                            {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  std::vector&lt;std::string&gt; lines;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a331cfb436079c33852b5514e6691f6be">ReadConfigLines</a>(edit_config_is, &amp;lines);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="comment">// we process this as a sequence of lines.</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  std::vector&lt;ConfigLine&gt; config_lines;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a3f86f51631eb5ef716068c6320f1a19c">ParseConfigLines</a>(lines, &amp;config_lines);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; config_lines.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    ConfigLine &amp;config_line = config_lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keyword">const</span> std::string &amp;directive = config_lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].FirstToken();</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;convert-to-fixed-affine&quot;</span>) {</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      std::string name_pattern = <span class="stringliteral">&quot;*&quot;</span>;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="comment">// name_pattern defaults to &#39;*&#39; if none is given.  Note: this pattern</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="comment">// matches names of components, not nodes.</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      config_line.GetValue(<span class="stringliteral">&quot;name&quot;</span>, &amp;name_pattern);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      int32 num_components_changed = 0;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        Component *component = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        AffineComponent *affine = NULL;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(nnet-&gt;GetComponentName(c).c_str(),</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                               name_pattern.c_str()) &amp;&amp;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            (affine = dynamic_cast&lt;AffineComponent*&gt;(component))) {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;          nnet-&gt;SetComponent(c, <span class="keyword">new</span> FixedAffineComponent(*affine));</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;          num_components_changed++;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Converted &quot;</span> &lt;&lt; num_components_changed</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; components to FixedAffineComponent.&quot;</span>;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;remove-orphan-nodes&quot;</span>) {</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordtype">bool</span> remove_orphan_inputs = <span class="keyword">false</span>;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      config_line.GetValue(<span class="stringliteral">&quot;remove-orphan-inputs&quot;</span>, &amp;remove_orphan_inputs);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      nnet-&gt;RemoveOrphanNodes(remove_orphan_inputs);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;remove-orphan-components&quot;</span>) {</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      nnet-&gt;RemoveOrphanComponents();</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;remove-orphans&quot;</span>) {</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordtype">bool</span> remove_orphan_inputs = <span class="keyword">false</span>;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      config_line.GetValue(<span class="stringliteral">&quot;remove-orphan-inputs&quot;</span>, &amp;remove_orphan_inputs);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      nnet-&gt;RemoveOrphanNodes(remove_orphan_inputs);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      nnet-&gt;RemoveOrphanComponents();</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;set-learning-rate&quot;</span>) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      std::string name_pattern = <span class="stringliteral">&quot;*&quot;</span>;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="comment">// name_pattern defaults to &#39;*&#39; if none is given.  This pattern</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="comment">// matches names of components, not nodes.</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      config_line.GetValue(<span class="stringliteral">&quot;name&quot;</span>, &amp;name_pattern);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = -1;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="keywordflow">if</span> (!config_line.GetValue(<span class="stringliteral">&quot;learning-rate&quot;</span>, &amp;learning_rate)) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;In edits-config, expected learning-rate to be set in line: &quot;</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                  &lt;&lt; config_line.WholeLine();</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      <span class="comment">// Note: the learning rate you provide will be multiplied by any</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <span class="comment">// &#39;learning-rate-factor&#39; that is defined in the component,</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="comment">// so if you call SetUnderlyingLearningRate(), the actual learning</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="comment">// rate (learning_rate_) is set to the value you provide times</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="comment">// learning_rate_factor_.</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      UpdatableComponent *component = NULL;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      int32 num_learning_rates_set = 0;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(nnet-&gt;GetComponentName(c).c_str(),</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                               name_pattern.c_str()) &amp;&amp;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            (component =</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;             dynamic_cast&lt;UpdatableComponent*&gt;(nnet-&gt;GetComponent(c)))) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;          component-&gt;SetUnderlyingLearningRate(learning_rate);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;          num_learning_rates_set++;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        }</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      }</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Set learning rates for &quot;</span> &lt;&lt; num_learning_rates_set &lt;&lt; <span class="stringliteral">&quot; components.&quot;</span>;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;set-learning-rate-factor&quot;</span>) {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      std::string name_pattern = <span class="stringliteral">&quot;*&quot;</span>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="comment">// name_pattern defaults to &#39;*&#39; if none is given.</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      config_line.GetValue(<span class="stringliteral">&quot;name&quot;</span>, &amp;name_pattern);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate_factor = -1;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="keywordflow">if</span> (!config_line.GetValue(<span class="stringliteral">&quot;learning-rate-factor&quot;</span>, &amp;learning_rate_factor)) {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;In edits-config, expected learning-rate-factor to be set in line: &quot;</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                  &lt;&lt; config_line.WholeLine();</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="comment">// Note: the learning_rate_factor_  defined in the component</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <span class="comment">// sets to the value you provided, so if you call SetUnderlyingLearningRate(),</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="comment">// the actual learning rate (learning_rate_) is set to the value you provided</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">// times learning_rate.</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      UpdatableComponent *component = NULL;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      int32 num_learning_rate_factors_set = 0;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(nnet-&gt;GetComponentName(c).c_str(),</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            name_pattern.c_str()) &amp;&amp;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            (component =</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;            dynamic_cast&lt;UpdatableComponent*&gt;(nnet-&gt;GetComponent(c)))) {</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;          component-&gt;SetLearningRateFactor(learning_rate_factor);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          num_learning_rate_factors_set++;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        }</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Set learning rate factors for &quot;</span> &lt;&lt; num_learning_rate_factors_set</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; components.&quot;</span>;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;rename-node&quot;</span>) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <span class="comment">// this is a shallow renaming of a node, and it requires that the name used is</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      <span class="comment">// not the name of another node.</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      std::string old_name, new_name;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <span class="keywordflow">if</span> (!config_line.GetValue(<span class="stringliteral">&quot;old-name&quot;</span>, &amp;old_name) ||</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          !config_line.GetValue(<span class="stringliteral">&quot;new-name&quot;</span>, &amp;new_name) ||</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;          config_line.HasUnusedValues()) {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;In edits-config, could not make sense of this rename-node &quot;</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;directive (expect old-name=xxx new-name=xxx) &quot;</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                  &lt;&lt; config_line.WholeLine();</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="keywordflow">if</span> (nnet-&gt;GetNodeIndex(old_name) &lt; 0)</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Could not rename node from &quot;</span> &lt;&lt; old_name &lt;&lt; <span class="stringliteral">&quot; to &quot;</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                  &lt;&lt; new_name &lt;&lt; <span class="stringliteral">&quot; because there is no node called &quot;</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                  &lt;&lt; old_name;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="comment">// further checks will happen inside SetNodeName().</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      nnet-&gt;SetNodeName(nnet-&gt;GetNodeIndex(old_name), new_name);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;remove-output-nodes&quot;</span>) {</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <span class="comment">// note: after remove-output-nodes you probably want to do &#39;remove-orphans&#39;.</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      std::string name_pattern;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="keywordflow">if</span> (!config_line.GetValue(<span class="stringliteral">&quot;name&quot;</span>, &amp;name_pattern) ||</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;          config_line.HasUnusedValues())</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;In edits-config, could not make sense of &quot;</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;remove-output-nodes directive: &quot;</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                  &lt;&lt; config_line.WholeLine();</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      std::vector&lt;int32&gt; nodes_to_remove;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      int32 outputs_remaining = 0;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; nnet-&gt;NumNodes(); <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="keywordflow">if</span> (nnet-&gt;IsOutputNode(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>)) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(nnet-&gt;GetNodeName(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>).c_str(),</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                                 name_pattern.c_str()))</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            nodes_to_remove.push_back(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            outputs_remaining++;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Removing &quot;</span> &lt;&lt; nodes_to_remove.size() &lt;&lt; <span class="stringliteral">&quot; output nodes.&quot;</span>;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordflow">if</span> (outputs_remaining == 0)</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;All outputs were removed.&quot;</span>;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      nnet-&gt;RemoveSomeNodes(nodes_to_remove);</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;set-dropout-proportion&quot;</span>) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      std::string name_pattern = <span class="stringliteral">&quot;*&quot;</span>;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="comment">// name_pattern defaults to &#39;*&#39; if none is given.  This pattern</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <span class="comment">// matches names of components, not nodes.</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      config_line.GetValue(<span class="stringliteral">&quot;name&quot;</span>, &amp;name_pattern);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> proportion = -1;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <span class="keywordflow">if</span> (!config_line.GetValue(<span class="stringliteral">&quot;proportion&quot;</span>, &amp;proportion)) {</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;In edits-config, expected proportion to be set in line: &quot;</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                  &lt;&lt; config_line.WholeLine();</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      }</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      int32 num_dropout_proportions_set = 0;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(nnet-&gt;GetComponentName(c).c_str(),</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                               name_pattern.c_str())) {</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;          DropoutComponent *dropout_component =</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;             <span class="keyword">dynamic_cast&lt;</span>DropoutComponent*<span class="keyword">&gt;</span>(nnet-&gt;GetComponent(c));</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;          DropoutMaskComponent *mask_component =</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;             <span class="keyword">dynamic_cast&lt;</span>DropoutMaskComponent*<span class="keyword">&gt;</span>(nnet-&gt;GetComponent(c));</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;          GeneralDropoutComponent *general_dropout_component =</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;             <span class="keyword">dynamic_cast&lt;</span>GeneralDropoutComponent*<span class="keyword">&gt;</span>(nnet-&gt;GetComponent(c));</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          <span class="keywordflow">if</span> (dropout_component != NULL) {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            dropout_component-&gt;SetDropoutProportion(proportion);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            num_dropout_proportions_set++;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mask_component != NULL){</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            mask_component-&gt;SetDropoutProportion(proportion);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            num_dropout_proportions_set++;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (general_dropout_component != NULL){</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            general_dropout_component-&gt;SetDropoutProportion(proportion);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            num_dropout_proportions_set++;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;          }</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      }</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Set dropout proportions for &quot;</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                &lt;&lt; num_dropout_proportions_set &lt;&lt; <span class="stringliteral">&quot; components.&quot;</span>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;apply-svd&quot;</span>) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      std::string name_pattern;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      int32 bottleneck_dim = -1;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <span class="keywordflow">if</span> (!config_line.GetValue(<span class="stringliteral">&quot;name&quot;</span>, &amp;name_pattern) ||</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          !config_line.GetValue(<span class="stringliteral">&quot;bottleneck-dim&quot;</span>, &amp;bottleneck_dim))</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Edit directive apply-svd requires &#39;name&#39; and &quot;</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <span class="stringliteral">&quot;&#39;bottleneck-dim&#39; to be specified.&quot;</span>;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordflow">if</span> (bottleneck_dim &lt;= 0)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bottleneck-dim must be positive in apply-svd command.&quot;</span>;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      SvdApplier applier(name_pattern, bottleneck_dim, nnet);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      applier.ApplySvd();</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (directive == <span class="stringliteral">&quot;reduce-rank&quot;</span>) {</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      std::string name_pattern;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      int32 rank = -1;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <span class="keywordflow">if</span> (!config_line.GetValue(<span class="stringliteral">&quot;name&quot;</span>, &amp;name_pattern) ||</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;          !config_line.GetValue(<span class="stringliteral">&quot;rank&quot;</span>, &amp;rank))</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Edit directive reduce-rank requires &#39;name&#39; and &quot;</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            <span class="stringliteral">&quot;&#39;rank&#39; to be specified.&quot;</span>;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">if</span> (rank &lt;= 0)</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Rank must be positive in reduce-rank command.&quot;</span>;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ac484c16402247b8c538022ee736bb4a2">ReduceRankOfComponents</a>(name_pattern, rank, nnet);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Directive &#39;&quot;</span> &lt;&lt; directive &lt;&lt; <span class="stringliteral">&quot;&#39; is not currently &quot;</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;          <span class="stringliteral">&quot;supported (reading edit-config).&quot;</span>;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    }</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordflow">if</span> (config_line.HasUnusedValues()) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Could not interpret &#39;&quot;</span> &lt;&lt; config_line.UnusedValues()</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;&#39; in edit config line &quot;</span> &lt;&lt; config_line.WholeLine();</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    }</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ac484c16402247b8c538022ee736bb4a2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac484c16402247b8c538022ee736bb4a2">kaldi::nnet3::ReduceRankOfComponents</a></div><div class="ttdeci">void ReduceRankOfComponents(const std::string component_name_pattern, int32 rank, Nnet *nnet)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l01086">nnet-utils.cc:1086</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7670f1519ac3d653ed7af20ffaf388f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">kaldi::nnet3::NameMatchesPattern</a></div><div class="ttdeci">bool NameMatchesPattern(const char *name, const char *pattern)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00608">nnet-parse.cc:608</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3f86f51631eb5ef716068c6320f1a19c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3f86f51631eb5ef716068c6320f1a19c">kaldi::nnet3::ParseConfigLines</a></div><div class="ttdeci">void ParseConfigLines(const std::vector&lt; std::string &gt; &amp;lines, std::vector&lt; ConfigLine &gt; *config_lines)</div><div class="ttdoc">This function converts config-lines from a simple sequence of strings as output by ReadConfigLines()...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00597">nnet-parse.cc:597</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a331cfb436079c33852b5514e6691f6be"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a331cfb436079c33852b5514e6691f6be">kaldi::nnet3::ReadConfigLines</a></div><div class="ttdeci">void ReadConfigLines(std::istream &amp;is, std::vector&lt; std::string &gt; *lines)</div><div class="ttdoc">This function reads in a config file and *appends* its contents to a vector of lines; it is responsib...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00436">nnet-parse.cc:436</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af2069492e6a46f0c6b003a52cf87e2f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2069492e6a46f0c6b003a52cf87e2f7">&#9670;&nbsp;</a></span>ReadIndexVector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReadIndexVector </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00143">143</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-descriptor_8cc_source.html#l00045">ExpectToken()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00055">kaldi::ReadBasicType()</a>, and <a class="el" href="nnet-common_8cc_source.html#l00087">ReadIndexVectorElementBinary()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common_8h_source.html#l00091">IndexLessNxt::operator()()</a>, <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00038">NnetIo::Read()</a>, <a class="el" href="nnet-discriminative-example_8cc_source.html#l00045">NnetDiscriminativeSupervision::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l01006">IoSpecification::Read()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00045">NnetChainSupervision::Read()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00732">NnetComputation::Read()</a>, and <a class="el" href="nnet-common-test_8cc_source.html#l00028">UnitTestIndexIo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                            {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">ExpectToken</a>(is, binary, <span class="stringliteral">&quot;&lt;I1V&gt;&quot;</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  int32 size;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;size);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span> (size &lt; 0) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Error reading Index vector: size = &quot;</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;              &lt;&lt; size;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  vec-&gt;resize(size);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span> (!binary) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].Read(is, binary);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ada744dcd7dc25034e74e7a1f076fa05b">ReadIndexVectorElementBinary</a>(is, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, vec);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="ttc" id="group__io__funcs__basic_html_ga1bd1af0ef712b76f2332febcec8d095a"><div class="ttname"><a href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">kaldi::ReadBasicType</a></div><div class="ttdeci">void ReadBasicType(std::istream &amp;is, bool binary, T *t)</div><div class="ttdoc">ReadBasicType is the name of the read function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00055">io-funcs-inl.h:55</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ada744dcd7dc25034e74e7a1f076fa05b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ada744dcd7dc25034e74e7a1f076fa05b">kaldi::nnet3::ReadIndexVectorElementBinary</a></div><div class="ttdeci">static void ReadIndexVectorElementBinary(std::istream &amp;is, int32 i, std::vector&lt; Index &gt; *vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00087">nnet-common.cc:87</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga4c7a80f758e878578e78b667f62463a5"><div class="ttname"><a href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">kaldi::ExpectToken</a></div><div class="ttdeci">void ExpectToken(std::istream &amp;is, bool binary, const char *token)</div><div class="ttdoc">ExpectToken tries to read in the given token, and throws an exception on failure. ...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00194">io-funcs.cc:194</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada744dcd7dc25034e74e7a1f076fa05b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada744dcd7dc25034e74e7a1f076fa05b">&#9670;&nbsp;</a></span>ReadIndexVectorElementBinary()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ReadIndexVectorElementBinary </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00087">87</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00055">kaldi::ReadBasicType()</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common_8cc_source.html#l00143">ReadIndexVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                           {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordtype">bool</span> binary = <span class="keyword">true</span>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  Index &amp;index = (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> (!is.good())</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;End of file while reading vector of Index.&quot;</span>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">signed</span> <span class="keywordtype">char</span> c = is.get();</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span> (std::abs(<span class="keywordtype">int</span>(c)) &lt; 125) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      index.n = 0;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      index.t = c;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      index.x = 0;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">if</span> (c != 127)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected character &quot;</span> &lt;&lt; c</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; encountered while reading Index vector.&quot;</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.n));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.t));</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.x));</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    Index &amp;last_index = (*vec)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1];</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (std::abs(<span class="keywordtype">int</span>(c)) &lt; 125) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      index.n = last_index.n;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      index.t = last_index.t + c;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      index.x = last_index.x;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">if</span> (c != 127)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected character &quot;</span> &lt;&lt; c</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; encountered while reading Index vector.&quot;</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.n));</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.t));</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">ReadBasicType</a>(is, binary, &amp;(index.x));</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div><div class="ttc" id="group__io__funcs__basic_html_ga1bd1af0ef712b76f2332febcec8d095a"><div class="ttname"><a href="group__io__funcs__basic.html#ga1bd1af0ef712b76f2332febcec8d095a">kaldi::ReadBasicType</a></div><div class="ttdeci">void ReadBasicType(std::istream &amp;is, bool binary, T *t)</div><div class="ttdoc">ReadBasicType is the name of the read function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00055">io-funcs-inl.h:55</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a556f73d99d4fcebed0e0bde2c2d34094"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a556f73d99d4fcebed0e0bde2c2d34094">&#9670;&nbsp;</a></span>ReadIntegerToken()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::ReadIntegerToken </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>what_we_are_parsing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string **&#160;</td>
          <td class="paramname"><em>next_token</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor_8cc_source.html#l00056">56</a> of file <a class="el" href="nnet-descriptor_8cc_source.html">nnet-descriptor.cc</a>.</p>

<p class="reference">References <a class="el" href="text-utils_8h_source.html#l00118">kaldi::ConvertStringToInteger()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="nnet-descriptor_8cc_source.html#l00029">ParsingContext()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor_8cc_source.html#l00710">GeneralDescriptor::ParseOffset()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00736">GeneralDescriptor::ParseReplaceIndex()</a>, and <a class="el" href="nnet-descriptor_8cc_source.html#l00726">GeneralDescriptor::ParseRound()</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                                            {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  int32 ans;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(**next_token, &amp;ans))</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expected integer while parsing &quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;              &lt;&lt; what_we_are_parsing &lt;&lt; <span class="stringliteral">&quot;, got &#39;&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;              &lt;&lt; **next_token &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#aa3fbd67899f39d18e85c03f06e0c69bf">ParsingContext</a>(*next_token);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  (*next_token)++;  <span class="comment">// advance token pointer.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a39eb3f7ce5fab6dbbcb396b3f8e196f4"><div class="ttname"><a href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">kaldi::ConvertStringToInteger</a></div><div class="ttdeci">bool ConvertStringToInteger(const std::string &amp;str, Int *out)</div><div class="ttdoc">Converts a string into an integer via strtoll and returns false if there was any kind of problem (i...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00118">text-utils.h:118</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa3fbd67899f39d18e85c03f06e0c69bf"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa3fbd67899f39d18e85c03f06e0c69bf">kaldi::nnet3::ParsingContext</a></div><div class="ttdeci">static std::string ParsingContext(const std::string *token_ptr)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00029">nnet-descriptor.cc:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab0cef9b2b234213283405e33de875310"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0cef9b2b234213283405e33de875310">&#9670;&nbsp;</a></span>ReadVectorAsChar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReadVectorAsChar </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00258">258</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="kaldi-vector_8cc_source.html#l01108">Vector&lt; Real &gt;::Read()</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00232">kaldi::ReadIntegerVector()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00190">Vector&lt; Real &gt;::Resize()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-example_8cc_source.html#l00045">NnetDiscriminativeSupervision::Read()</a>, and <a class="el" href="nnet-chain-example_8cc_source.html#l00045">NnetChainSupervision::Read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                              {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">if</span> (binary) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale = 1.0 / 255.0;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    std::vector&lt;unsigned char&gt; char_vec;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="group__io__funcs__basic.html#ga0e0391048fe585c1e97b4d65d59d32bc">ReadIntegerVector</a>(is, binary, &amp;char_vec);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    int32 dim = char_vec.size();</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    vec-&gt;Resize(dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *data = vec-&gt;Data();</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      data[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = scale * char_vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    vec-&gt;Read(is, binary);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga0e0391048fe585c1e97b4d65d59d32bc"><div class="ttname"><a href="group__io__funcs__basic.html#ga0e0391048fe585c1e97b4d65d59d32bc">kaldi::ReadIntegerVector</a></div><div class="ttdeci">void ReadIntegerVector(std::istream &amp;is, bool binary, std::vector&lt; T &gt; *v)</div><div class="ttdoc">Function for reading STL vector of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00232">io-funcs-inl.h:232</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac37caf62dbe225383341d770509b2d55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac37caf62dbe225383341d770509b2d55">&#9670;&nbsp;</a></span>RearrangeIndexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::RearrangeIndexes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-simple-component_8cc_source.html#l04279">4279</a> of file <a class="el" href="nnet-simple-component_8cc_source.html">nnet-simple-component.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8cc_source.html#l04299">ConvolutionComponent::InderivPatchesToInderiv()</a>, and <a class="el" href="nnet-simple-component_8cc_source.html#l04739">MaxpoolingComponent::InderivPatchesToInderiv()</a>.</p>
<div class="fragment"><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;                                                                                   {</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;  int32 D = in.size();</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;  int32 L = 0;</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; D; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;    <span class="keywordflow">if</span> (in[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size() &gt; L)</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;      L = in[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;  out-&gt;resize(L);</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; L; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;    (*out)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].resize(D, -1);</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; D; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; in[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;      (*out)[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = in[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;    }</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;  }</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5b0e1736653b8fa4462642888883ad8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b0e1736653b8fa4462642888883ad8e">&#9670;&nbsp;</a></span>RecomputeStats() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RecomputeStats </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>egs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const chain::ChainTrainingOptions &amp;&#160;</td>
          <td class="paramname"><em>chain_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacefst.html#a88a968cc6f6d68c2b3dd6aa90385f65c">fst::StdVectorFst</a> &amp;&#160;</td>
          <td class="paramname"><em>den_fst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function zeros the stored component-level stats in the nnet using <a class="el" href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea" title="Zeroes the component stats in all nonlinear components in the nnet. ">ZeroComponentStats()</a>, then recomputes them with the supplied egs. </p>
<p>It affects batch-norm, for instance. See also the version of RecomputeStats declared in nnet-utils.h. </p>

<p class="definition">Definition at line <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00248">248</a> of file <a class="el" href="nnet-chain-diagnostics_8cc_source.html">nnet-chain-diagnostics.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00088">NnetChainComputeProb::Compute()</a>, <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00235">HasXentOutputs()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00179">NnetChainComputeProb::PrintTotalStats()</a>, <a class="el" href="nnet-diagnostics_8h_source.html#l00063">NnetComputeProbOptions::store_component_stats</a>, and <a class="el" href="nnet-utils_8cc_source.html#l00269">ZeroComponentStats()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-combine_8cc_source.html#l00076">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Recomputing stats on nnet (affects batch-norm)&quot;</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  chain::ChainTrainingOptions chain_config(chain_config_in);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a24b5d0f8d0614e04abf2c8ec7a496d34">HasXentOutputs</a>(*nnet) &amp;&amp;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      chain_config.xent_regularize == 0) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// this forces it to compute the output for xent outputs, </span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// usually &#39;output-xent&#39;, which</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// means that we&#39;ll be computing batch-norm stats for any</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// components in that branch that have batch-norm.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    chain_config.xent_regularize = 0.1;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea">ZeroComponentStats</a>(nnet);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  NnetComputeProbOptions nnet_config;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  nnet_config.store_component_stats = <span class="keyword">true</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  NnetChainComputeProb prob_computer(nnet_config, chain_config, den_fst, nnet);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; egs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    prob_computer.Compute(egs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  prob_computer.PrintTotalStats();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Done recomputing stats.&quot;</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a24b5d0f8d0614e04abf2c8ec7a496d34"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a24b5d0f8d0614e04abf2c8ec7a496d34">kaldi::nnet3::HasXentOutputs</a></div><div class="ttdeci">static bool HasXentOutputs(const Nnet &amp;nnet)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-chain-diagnostics_8cc_source.html#l00235">nnet-chain-diagnostics.cc:235</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aca9d819d3ed85b506db090905d4c1cea"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea">kaldi::nnet3::ZeroComponentStats</a></div><div class="ttdeci">void ZeroComponentStats(Nnet *nnet)</div><div class="ttdoc">Zeroes the component stats in all nonlinear components in the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00269">nnet-utils.cc:269</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a91966187f28cae11565e07bd759b044d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91966187f28cae11565e07bd759b044d">&#9670;&nbsp;</a></span>RecomputeStats() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RecomputeStats </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>egs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function zeros the stored component-level stats in the nnet using <a class="el" href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea" title="Zeroes the component stats in all nonlinear components in the nnet. ">ZeroComponentStats()</a>, then recomputes them with the supplied egs. </p>
<p>It affects batch-norm, for instance. See also the version of RecomputeStats declared in <a class="el" href="nnet-chain-diagnostics_8h.html">nnet-chain-diagnostics.h</a>. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00541">541</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-diagnostics_8cc_source.html#l00079">NnetComputeProb::Compute()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00149">NnetComputeProb::PrintTotalStats()</a>, <a class="el" href="nnet-diagnostics_8h_source.html#l00063">NnetComputeProbOptions::store_component_stats</a>, and <a class="el" href="nnet-utils_8cc_source.html#l00269">ZeroComponentStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                                                   {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Recomputing stats on nnet (affects batch-norm)&quot;</span>;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea">ZeroComponentStats</a>(nnet);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  NnetComputeProbOptions opts;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  opts.store_component_stats = <span class="keyword">true</span>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  NnetComputeProb prob_computer(opts, nnet);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; egs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    prob_computer.Compute(egs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  prob_computer.PrintTotalStats();</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Done recomputing stats.&quot;</span>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_aca9d819d3ed85b506db090905d4c1cea"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aca9d819d3ed85b506db090905d4c1cea">kaldi::nnet3::ZeroComponentStats</a></div><div class="ttdeci">void ZeroComponentStats(Nnet *nnet)</div><div class="ttdoc">Zeroes the component stats in all nonlinear components in the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00269">nnet-utils.cc:269</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac484c16402247b8c538022ee736bb4a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac484c16402247b8c538022ee736bb4a2">&#9670;&nbsp;</a></span>ReduceRankOfComponents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ReduceRankOfComponents </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>component_name_pattern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l01086">1086</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-matrix_8cc_source.html#l00170">MatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00455">AffineComponent::BiasParams()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00865">SvdApplier::ModifiedComponentInfo::component_name</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00689">Nnet::GetComponentName()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00408">AffineComponent::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00040">kaldi::kCopyData</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00457">AffineComponent::LinearParams()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00608">NameMatchesPattern()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00409">AffineComponent::OutputDim()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l01134">AffineComponent::SetParams()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02534">kaldi::SortSvd()</a>, <a class="el" href="cu-vector_8cc_source.html#l00987">CuVector&lt; Real &gt;::Swap()</a>, and <a class="el" href="cu-matrix_8cc_source.html#l00122">CuMatrix&lt; Real &gt;::Swap()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils_8cc_source.html#l01148">ReadEditConfig()</a>.</p>
<div class="fragment"><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                                        {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  int32 num_components_changed = 0;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    Component *component = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    std::string component_name = nnet-&gt;GetComponentName(c);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(component_name.c_str(),</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                           component_name_pattern.c_str())) {</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      AffineComponent *affine =  <span class="keyword">dynamic_cast&lt;</span>AffineComponent*<span class="keyword">&gt;</span>(component);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      <span class="keywordflow">if</span> (affine == NULL) {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Not reducing rank of component &quot;</span> &lt;&lt; component_name</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; as it is not an AffineComponent.&quot;</span>;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      }</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      int32 input_dim = affine-&gt;InputDim(),</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          output_dim = affine-&gt;OutputDim();</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="keywordflow">if</span> (input_dim &lt;= rank || output_dim &lt;= rank) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Not reducing rank of component &quot;</span> &lt;&lt; component_name</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; with SVD to rank &quot;</span> &lt;&lt; rank</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; because its dimension is &quot;</span> &lt;&lt; input_dim</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; output_dim;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      }</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      Matrix&lt;BaseFloat&gt; linear_params(affine-&gt;LinearParams());</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      Vector&lt;BaseFloat&gt; bias_params(affine-&gt;BiasParams());</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="comment">// note: &#39;linear_params&#39; is of dimension output_dim by input_dim.</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      int32 middle_dim = std::min&lt;int32&gt;(input_dim, output_dim);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      Vector&lt;BaseFloat&gt; s(middle_dim);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      Matrix&lt;BaseFloat&gt; U(output_dim, middle_dim),</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;          Vt(middle_dim, input_dim);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      linear_params.Svd(&amp;s, &amp;U, &amp;Vt);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <span class="comment">// make sure the singular values are sorted from greatest to least value.</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <a class="code" href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">SortSvd</a>(&amp;s, &amp;U, &amp;Vt);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> s_sum_orig = s.Sum();</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      s.Resize(rank, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0">kCopyData</a>);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      U.Resize(output_dim, rank, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0">kCopyData</a>);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      Vt.Resize(rank, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0">kCopyData</a>);</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> s_sum_reduced = s.Sum();</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;For component &quot;</span> &lt;&lt; component_name</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; singular value sum changed by reduce-rank command &quot;</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                &lt;&lt; (s_sum_orig - s_sum_reduced)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (from &quot;</span> &lt;&lt; s_sum_orig &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; s_sum_reduced &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      U.MulColsVec(s);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      Matrix&lt;BaseFloat&gt; linear_params_reduced_rank(output_dim, input_dim);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      linear_params_reduced_rank.AddMatMat(1.0, U, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Vt, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      CuMatrix&lt;BaseFloat&gt; linear_params_reduced_rank_cuda;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      linear_params_reduced_rank_cuda.Swap(&amp;linear_params_reduced_rank);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      CuVector&lt;BaseFloat&gt; bias_params_cuda;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      bias_params_cuda.Swap(&amp;bias_params);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      affine-&gt;SetParams(bias_params_cuda, linear_params_reduced_rank_cuda);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      num_components_changed++;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    }</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  }</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Reduced rank of parameters of &quot;</span> &lt;&lt; num_components_changed</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; components.&quot;</span>;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a7670f1519ac3d653ed7af20ffaf388f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">kaldi::nnet3::NameMatchesPattern</a></div><div class="ttdeci">bool NameMatchesPattern(const char *name, const char *pattern)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00608">nnet-parse.cc:608</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0">kaldi::kCopyData</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00040">matrix-common.h:40</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_ga4318e745ace6367bd00b2911089e9e79"><div class="ttname"><a href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">kaldi::SortSvd</a></div><div class="ttdeci">void SortSvd(VectorBase&lt; Real &gt; *s, MatrixBase&lt; Real &gt; *U, MatrixBase&lt; Real &gt; *Vt, bool sort_on_absolute_value)</div><div class="ttdoc">Function to ensure that SVD is sorted. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02534">kaldi-matrix.cc:2534</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af53fca33c55f05968eab8ec1009509e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af53fca33c55f05968eab8ec1009509e6">&#9670;&nbsp;</a></span>RemoveCommandsForUnusedMatrix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RemoveCommandsForUnusedMatrix </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> &amp;&#160;</td>
          <td class="paramname"><em>analyzer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function removes from 'computation' the commands accessing matrix 'm', which is assumed to be unused according to the <a class="el" href="namespacekaldi_1_1nnet3.html#ac879380727c26962a7aaa4a6de9dc4d4" title="This function returns true if matrix 1 &lt;= m &lt; computation-&gt;matrices.size() is unused, defined as: it is not an input or an output, and is not accessed other than via commands of type kAllocMatrix, kDeallocMatrix, and kSetConst. ">MatrixIsUnused()</a> command above. </p>
<p>Specifically, it changes the types of the relevant commands in 'computation' to kNoOperation. (The commands changed in this way will be of type kAllocMatrix, kDeallocMatrix and kSetConst). The index for the matrix may later be removed entirely by <a class="el" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f" title="This function detects submatrices and matrices that are never used (e.g. ">RenumberComputation()</a>. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l04600">4600</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8h_source.html#l00264">MatrixAccesses::accesses</a>, <a class="el" href="nnet-analyze_8h_source.html#l00253">MatrixAccesses::allocate_command</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-analyze_8h_source.html#l00257">MatrixAccesses::deallocate_command</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSetConst</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00298">Analyzer::matrix_accesses</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02179">DerivativeTimeLimiter::PruneMatrices()</a>.</p>
<div class="fragment"><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;                                                                 {</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;  <span class="keyword">const</span> MatrixAccesses &amp;accesses = analyzer.matrix_accesses[m];</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;  <span class="keywordflow">if</span> (accesses.allocate_command &gt;= 0) {</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;    NnetComputation::Command &amp;command = computation-&gt;commands[</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;        accesses.allocate_command];</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a> ||</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;                 command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>);</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    command.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;  }</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;  <span class="keywordflow">if</span> (accesses.deallocate_command &gt;= 0) {</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;    NnetComputation::Command &amp;command = computation-&gt;commands[</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;        accesses.deallocate_command];</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a> ||</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;                 command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>);</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    command.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;  }</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; accesses.accesses.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    int32 command_index = accesses.accesses[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].command_index;</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    NnetComputation::Command &amp;command = computation-&gt;commands[command_index];</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a> ||</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;                 command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>);</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    command.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;  }</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1146f4efa141a56210f9dbf1090b20f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1146f4efa141a56210f9dbf1090b20f0">&#9670;&nbsp;</a></span>RemoveNoOps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RemoveNoOps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes commands of type kNoOperation in the computation. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00703">703</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00699">IsNoop()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l01939">DerivativeTimeLimiter::LimitDerivTimes()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00723">VariableMergingOptimizer::MergeVariables()</a>, and <a class="el" href="nnet-optimize_8cc_source.html#l00355">RemoveUnnecessaryAllocation()</a>.</p>
<div class="fragment"><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                                               {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  computation-&gt;commands.erase(</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      std::remove_if(computation-&gt;commands.begin(),</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                     computation-&gt;commands.end(),</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                     <a class="code" href="namespacekaldi_1_1nnet3.html#ae3ebe9f7e8bfc061d7582b3964698e4e">IsNoop</a>), computation-&gt;commands.end());</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ae3ebe9f7e8bfc061d7582b3964698e4e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae3ebe9f7e8bfc061d7582b3964698e4e">kaldi::nnet3::IsNoop</a></div><div class="ttdeci">static bool IsNoop(const NnetComputation::Command &amp;command)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00699">nnet-optimize-utils.cc:699</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a92c251003c3f612c5cfbcbd72cbd030b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92c251003c3f612c5cfbcbd72cbd030b">&#9670;&nbsp;</a></span>RemoveUnnecessaryAllocation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RemoveUnnecessaryAllocation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This optimization detects cases where we deallocate a matrix, and then later allocate another matrix of the same size; and replaces them with commands of type kAllocFromOther or kAllocFromOtherZeroed. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00355">355</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00328">ComputeCommandPairs()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04552">FixGotoLabel()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kDeallocMatrix</a>, <a class="el" href="matrix-common_8h_source.html#l00045">kaldi::kDefaultStride</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSwapMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00703">RemoveNoOps()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                                               {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// For each size of matrix and stride-type, represented as a pair&lt;int32,int32&gt;</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">// (the num-rows, and the num-cols * (stride-type == kDefaultStride ? 1 : -1), we</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">// accumulate a list of indexes of deallocation commands that</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">// are for that size, and a list of indexes of allocation commands</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">// for that size.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">// For each distinct matrix size, we then call ComputeCommandPairs on those</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="comment">// two lists, to get pairs of (deallocation, allocation) command-indexes that</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="comment">// we can optimize out to a single command.</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="comment">// The map is from a (num-rows,num-columns) to two lists, of</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">// (deallocation-commands, allocation-commands).  The order may seem</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">// backwards, but that&#39;s the order of the pairs we are looking for.</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keyword">typedef</span> unordered_map&lt;std::pair&lt;int32,int32&gt;,</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      std::pair&lt;std::vector&lt;int32&gt;,std::vector&lt;int32&gt; &gt;,</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      PairHasher&lt;int32&gt; &gt; MapType;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  MapType pair_map;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  int32 num_commands = computation-&gt;commands.size();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">for</span> (int32 command_index = 0; command_index &lt; num_commands; command_index++) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    NnetComputation::Command &amp;command = computation-&gt;commands[command_index];</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a> ||</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      int32 s = command.arg1, m = computation-&gt;submatrices[s].matrix_index,</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          num_rows = computation-&gt;matrices[m].num_rows,</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          num_cols = computation-&gt;matrices[m].num_cols,</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          num_cols_mod = num_cols * (</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;              computation-&gt;matrices[m].stride_type == <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a> ? 1 : -1);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      std::pair&lt;int32,int32&gt; p(num_rows, num_cols_mod);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      std::pair&lt;std::vector&lt;int32&gt;,std::vector&lt;int32&gt; &gt; &amp;lists = pair_map[p];</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">if</span> (command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        lists.first.push_back(command_index);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        lists.second.push_back(command_index);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  MapType::const_iterator iter = pair_map.begin(), end = pair_map.end();</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  std::vector&lt;std::pair&lt;int32,int32&gt; &gt; command_pairs;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a4874b04bb051028a1b6cb08cff2d1994">ComputeCommandPairs</a>(iter-&gt;second, &amp;command_pairs);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; command_pairs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    int32 dealloc_index = command_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        alloc_index = command_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    NnetComputation::Command</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        &amp;dealloc_command = computation-&gt;commands[dealloc_index],</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        &amp;alloc_command = computation-&gt;commands[alloc_index];</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dealloc_command.command_type ==</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                 <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(alloc_command.command_type ==</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                 <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">// remove the deallocation command.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    dealloc_command.command_type =  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    alloc_command.arg2 = dealloc_command.arg1;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    alloc_command.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">RemoveNoOps</a>(computation);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">FixGotoLabel</a>(computation);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4874b04bb051028a1b6cb08cff2d1994"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4874b04bb051028a1b6cb08cff2d1994">kaldi::nnet3::ComputeCommandPairs</a></div><div class="ttdeci">static void ComputeCommandPairs(const std::pair&lt; std::vector&lt; int32 &gt;, std::vector&lt; int32 &gt; &gt; &amp;lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *pairs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00328">nnet-optimize.cc:328</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kaldi::kDefaultStride</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00045">matrix-common.h:45</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8953a6af8e449d7cc12efeb115c5f8d2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8953a6af8e449d7cc12efeb115c5f8d2">kaldi::nnet3::FixGotoLabel</a></div><div class="ttdeci">void FixGotoLabel(NnetComputation *computation)</div><div class="ttdoc">This function ensures that the arg1 of a final command of type kGotoLabel is the same as the command ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l04552">nnet-optimize-utils.cc:4552</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1146f4efa141a56210f9dbf1090b20f0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">kaldi::nnet3::RemoveNoOps</a></div><div class="ttdeci">void RemoveNoOps(NnetComputation *computation)</div><div class="ttdoc">Removes commands of type kNoOperation in the computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00703">nnet-optimize-utils.cc:703</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aae053839b5ed781f2f7408489a1528dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae053839b5ed781f2f7408489a1528dd">&#9670;&nbsp;</a></span>RemoveUnnecessaryZeroing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RemoveUnnecessaryZeroing </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This optimization function removes, where possible, commands of type type kSetConst. </p>
<p>(It can remove them where subsequent commands are going to set the matrix without reading its previous value). </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00262">262</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8h_source.html#l00264">MatrixAccesses::accesses</a>, <a class="el" href="nnet-computation_8h_source.html#l00340">NnetComputation::Command::alpha</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00156">ComputationVariables::AppendVariablesForMatrix()</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01421">Analyzer::Init()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00270">MatrixAccesses::is_output</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kSetConst</a>, <a class="el" href="nnet-analyze_8h_source.html#l00077">kWriteAccess</a>, <a class="el" href="nnet-analyze_8h_source.html#l00298">Analyzer::matrix_accesses</a>, <a class="el" href="nnet-analyze_8h_source.html#l00297">Analyzer::variable_accesses</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00295">Analyzer::variables</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                                            {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  Analyzer a;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  a.Init(nnet, *computation);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// OK, now we&#39;ll work out which matrices have all their pieces (i.e. all the</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// variables belonging to that matrix) written to as the first instruction</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// apart from the initial zeroing.  These matrices can have the initial</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// zeroing replaced by a sizing operation that leaves the data undefined.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  int32 num_matrices = a.matrix_accesses.size();</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">for</span> (int32 matrix_index = 0; matrix_index &lt; num_matrices; matrix_index++) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keyword">const</span> MatrixAccesses &amp;accesses = a.matrix_accesses[matrix_index];</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (accesses.accesses.empty())</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    int32 zeroing_command_index = accesses.accesses[0].command_index;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    NnetComputation::Command *command =</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        &amp;(computation-&gt;commands[zeroing_command_index]);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> (!(command-&gt;command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a> &amp;&amp;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          command-&gt;alpha == 0.0)) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// First command is not a zeroing command</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// OK, the first command that accesses this matrix is a zeroing command;</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// we&#39;re going to figure out whether it was necessary.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    std::vector&lt;int32&gt; variables_for_matrix;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    a.variables.AppendVariablesForMatrix(matrix_index, &amp;variables_for_matrix);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordtype">bool</span> all_variables_ok = <span class="keyword">true</span>;  <span class="comment">// if this stays true, it means we don&#39;t need</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                   <span class="comment">// the initial zeroing.</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; variables_for_matrix.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      int32 variable_index = variables_for_matrix[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keyword">const</span> std::vector&lt;Access&gt; &amp;v_accesses =</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          a.variable_accesses[variable_index];</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordflow">if</span> (v_accesses.size() &gt; 1 &amp;&amp;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          v_accesses[1].access_type != <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        all_variables_ok = <span class="keyword">false</span>;  <span class="comment">// first access after zeroing was not a write</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">if</span> (v_accesses.size() == 1 &amp;&amp;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          accesses.is_output) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="comment">// the only command that touches this variable is the allocation, and it</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="comment">// is an output variable.  (this is unusual, but can happen e.g. if it&#39;s</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="comment">// a derivative, but due to min_deriv_time and max_deriv_time it ends up</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// always being zero.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        all_variables_ok = <span class="keyword">false</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (all_variables_ok) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">// Here is where the change actually happens.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="comment">// Remove the zeroing command.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      command-&gt;command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kaldi::nnet3::kWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00077">nnet-analyze.h:77</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab732a05694363a8a666b7e860a1206ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab732a05694363a8a666b7e860a1206ae">&#9670;&nbsp;</a></span>RenameOutputs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::RenameOutputs </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>new_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-copy-egs_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet3-copy-egs_8cc_source.html">nnet3-copy-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, and <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-copy-egs_8cc_source.html#l00290">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                                               {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">bool</span> found_output = <span class="keyword">false</span>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;NnetIo&gt;::iterator it = eg-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.begin();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;       it != eg-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.end(); ++it) {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">if</span> (it-&gt;name == <span class="stringliteral">&quot;output&quot;</span>) {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      it-&gt;name = new_name;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      found_output = <span class="keyword">true</span>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  }</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">if</span> (!found_output)</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No io-node with name &#39;output&#39;&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;exists in eg.&quot;</span>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6828e427bd8883455705e0c9b99b5f2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6828e427bd8883455705e0c9b99b5f2f">&#9670;&nbsp;</a></span>RenumberComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RenumberComputation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function detects submatrices and matrices that are never used (e.g. </p>
<p>due to changes made in other optimization code), and members of indexes, indexes_multi and indexes_ranges that are unused or are duplicates, and memo indexes that are unused; and it removes them from the computation by way of suitable renumbering. It does not remove no-ops from computation-&gt;commands_; to do that, call RemoveNoOps(computation). </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">693</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l00489">ComputationRenumberer::Renumber()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l01195">MatrixExtender::FixComputation()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l01939">DerivativeTimeLimiter::LimitDerivTimes()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00723">VariableMergingOptimizer::MergeVariables()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l04473">ComputationLoopedOptimizer::Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                                                       {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  ComputationRenumberer renumberer(computation);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  renumberer.Renumber();</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a281a103d9beaef2e5d64370754800cd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a281a103d9beaef2e5d64370754800cd1">&#9670;&nbsp;</a></span>ReplaceRowWithMatrixOps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ReplaceRowWithMatrixOps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function detects cases where commands of type kCopyRows, kAddRows or kAddToRows can be converted to commands of type kMatrixCopy or kMatrixAdd, and converts them (this may involve adding submatrices). </p>
<p>This function returns true if it made any changes to the computation; if it returns true, then after doing this you should at some point do <a class="el" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f" title="This function detects submatrices and matrices that are never used (e.g. ">RenumberComputation()</a>, which will remove any now-unused members of computation-&gt;indexes. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02288">2288</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-computation_8h_source.html#l00419">NnetComputation::indexes</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02252">IndexesHaveSpecialStructure()</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kAddRows</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kCopyRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixAdd</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kMatrixCopy</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00102">NnetComputation::NewSubMatrix()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                                                           {</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  <span class="keywordtype">bool</span> ans = <span class="keyword">false</span>;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  int32 num_commands = computation-&gt;commands.size(),</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      num_indexes = computation-&gt;indexes.size();</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <span class="keywordflow">for</span> (int32 command_index = 0; command_index &lt; num_commands;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;       command_index++) {</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    <span class="comment">// non-const because we&#39;ll be changing it.</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    NnetComputation::Command &amp;c = computation-&gt;commands[command_index];</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    int32 first_nonnegative_pos,</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        first_nonnegative_value,</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        num_nonnegative_indexes;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>: {</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        int32 indexes_index = c.arg3;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes_index &lt; num_indexes);</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;indexes = computation-&gt;indexes[indexes_index];</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a68068a73dabd55faade8d658a56f277b">IndexesHaveSpecialStructure</a>(indexes,</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                                        &amp;first_nonnegative_pos,</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                                        &amp;first_nonnegative_value,</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                                        &amp;num_nonnegative_indexes)) {</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;          ans = <span class="keyword">true</span>;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;          c.arg1 = computation-&gt;NewSubMatrix(c.arg1, first_nonnegative_pos,</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                                             num_nonnegative_indexes,</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                                             0, -1);</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;          c.arg2 = computation-&gt;NewSubMatrix(c.arg2, first_nonnegative_value,</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                                             num_nonnegative_indexes,</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                                             0, -1);</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;          c.command_type = (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a> ? <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a> :</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                            <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>);</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        }</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      }</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    }</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  }</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a68068a73dabd55faade8d658a56f277b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a68068a73dabd55faade8d658a56f277b">kaldi::nnet3::IndexesHaveSpecialStructure</a></div><div class="ttdeci">static bool IndexesHaveSpecialStructure(const std::vector&lt; int32 &gt; &amp;indexes, int32 *first_nonnegative_pos, int32 *first_nonnegative_value, int32 *num_nonnegative_indexes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02252">nnet-optimize-utils.cc:2252</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a54a0b9eb6a79c232605aa83476d44bb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54a0b9eb6a79c232605aa83476d44bb0">&#9670;&nbsp;</a></span>RequestIsDecomposable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> RequestIsDecomposable </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>mini_request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_n_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function, used in 'shortcut' compilation where we first compile a smaller computation with the same structure but only 2 distinct 'n' values, works out whether a computation is 'decomposable'; if so, it returns true and outputs the 'mini_request' with the same structure, and the number of 'n' values. </p>
<p>A computation is decomposable if the following conditions hold:</p>
<ul>
<li>All of its inputs and outputs contain 'n' values for all 0 &lt;= n &lt; N, for some N &gt; 2. [we output this 'N' as 'num_n_values'].</li>
<li>All of its inputs and outputs have 'regular' structure: chiefly, that within vectors of Indexes, each (t, x) pair should be present for the same set of 'n' values (0, 1, ... N-1), and that we should be able to identify the stride of the 'n' index. For more precise details on this regular structure, look at the comment for the function <a class="el" href="namespacekaldi_1_1nnet3.html#a79122735e3f124a6865ff339f40ec191">FindNStride()</a>, in <a class="el" href="nnet-optimize-utils_8cc.html">nnet-optimize-utils.cc</a>. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03852">3852</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l03822">IoSpecificationIsDecomposable()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00130">ComputationRequest::misc_info</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, and <a class="el" href="nnet-computation_8h_source.html#l00126">ComputationRequest::store_component_stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00808">CachingOptimizingCompiler::CompileViaShortcut()</a>.</p>
<div class="fragment"><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;                                                {</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  <span class="keywordtype">size_t</span> num_inputs = request.inputs.size(),</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;      num_outputs = request.outputs.size();</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;  mini_request-&gt;inputs.resize(num_inputs);</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;  mini_request-&gt;outputs.resize(num_outputs);</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;  mini_request-&gt;need_model_derivative = request.need_model_derivative;</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;  mini_request-&gt;store_component_stats = request.store_component_stats;</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;  mini_request-&gt;misc_info = request.misc_info;</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_inputs != 0 &amp;&amp; num_outputs != 0);</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_inputs; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;    int32 this_num_n_values = 0;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a4d88467d1a24ad6a2b21d4b8923615ca">IoSpecificationIsDecomposable</a>(request.inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                                       &amp;(mini_request-&gt;inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]),</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                                       &amp;this_num_n_values))</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;      *num_n_values = this_num_n_values;</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;      <span class="keywordflow">if</span> (this_num_n_values != *num_n_values)</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// .. which would be odd.</span></div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;    }</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;  }</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_outputs; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;    int32 this_num_n_values = 0;</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a4d88467d1a24ad6a2b21d4b8923615ca">IoSpecificationIsDecomposable</a>(request.outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;                                       &amp;(mini_request-&gt;outputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]),</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;                                       &amp;this_num_n_values))</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;    <span class="keywordflow">if</span> (this_num_n_values != *num_n_values)</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// .. which would be odd.</span></div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;  }</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4d88467d1a24ad6a2b21d4b8923615ca"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4d88467d1a24ad6a2b21d4b8923615ca">kaldi::nnet3::IoSpecificationIsDecomposable</a></div><div class="ttdeci">static bool IoSpecificationIsDecomposable(const IoSpecification &amp;io_spec, IoSpecification *mini_io_spec, int32 *num_n_values_out)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03822">nnet-optimize-utils.cc:3822</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c2029913de309432ceda98856ca5819"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c2029913de309432ceda98856ca5819">&#9670;&nbsp;</a></span>ResetGenerators()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ResetGenerators </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function calls 'ResetGenerator()' on all components in 'nnet' that inherit from class <a class="el" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a>. </p>
<p>It's used when you need to ensure consistency in things like dropout masks, across subsequent neural net evaluations. You will likely want to call srand() before calling this. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00573">573</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00411">RandomComponent::ResetGenerator()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-nnet_8h_source.html#l00246">Nnet::Copy()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00062">NnetChainTrainer::Train()</a>, <a class="el" href="nnet-training_8cc_source.html#l00059">NnetTrainer::Train()</a>, and <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">UnitTestNnetOptimizeWithOptions()</a>.</p>
<div class="fragment"><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                                {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    RandomComponent *rc = <span class="keyword">dynamic_cast&lt;</span>RandomComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> (rc != NULL)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      rc-&gt;ResetGenerator();</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a7ed7d5044f00b6a0d18737b660c52ad0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ed7d5044f00b6a0d18737b660c52ad0">&#9670;&nbsp;</a></span>ResetSeed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::ResetSeed </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>rand_seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00027">27</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-component-itf_8h_source.html#l00411">RandomComponent::ResetGenerator()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00309">TestSimpleComponentDataDerivative()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00210">TestSimpleComponentPropagateProperties()</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                                           {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a> *rand_component =</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">const_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(&amp;c));</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">if</span> (rand_component != NULL) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    srand(rand_seed);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    rand_component-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1RandomComponent.html#abb608877dc715ca117536e8ea8b0a111">ResetGenerator</a>();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1RandomComponent_html_abb608877dc715ca117536e8ea8b0a111"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1RandomComponent.html#abb608877dc715ca117536e8ea8b0a111">kaldi::nnet3::RandomComponent::ResetGenerator</a></div><div class="ttdeci">void ResetGenerator()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00411">nnet-component-itf.h:411</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1RandomComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1RandomComponent.html">kaldi::nnet3::RandomComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00405">nnet-component-itf.h:405</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a764cf3de97d7029d256a28164142b89c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a764cf3de97d7029d256a28164142b89c">&#9670;&nbsp;</a></span>RoundUpNumFrames()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::RoundUpNumFrames </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_subsampling_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_frames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_frames_overlap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00275">275</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                                 {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (*num_frames % frame_subsampling_factor != 0) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    int32 new_num_frames = frame_subsampling_factor *</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        (*num_frames / frame_subsampling_factor + 1);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Rounding up --num-frames=&quot;</span> &lt;&lt; (*num_frames)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; to a multiple of --frame-subsampling-factor=&quot;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;              &lt;&lt; frame_subsampling_factor</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, now --num-frames=&quot;</span> &lt;&lt; new_num_frames;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    *num_frames = new_num_frames;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">if</span> (*num_frames_overlap % frame_subsampling_factor != 0) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    int32 new_num_frames_overlap = frame_subsampling_factor *</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        (*num_frames_overlap / frame_subsampling_factor + 1);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Rounding up --num-frames-overlap=&quot;</span> &lt;&lt; (*num_frames_overlap)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; to a multiple of --frame-subsampling-factor=&quot;</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;              &lt;&lt; frame_subsampling_factor</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, now --num-frames-overlap=&quot;</span> &lt;&lt; new_num_frames_overlap;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    *num_frames_overlap = new_num_frames_overlap;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (*num_frames_overlap &lt; 0 || *num_frames_overlap &gt;= *num_frames) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;--num-frames-overlap=&quot;</span> &lt;&lt; (*num_frames_overlap) &lt;&lt; <span class="stringliteral">&quot; &lt; &quot;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;--num-frames=&quot;</span> &lt;&lt; (*num_frames);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7257d6fb1ae554317c5937d386cf88d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7257d6fb1ae554317c5937d386cf88d1">&#9670;&nbsp;</a></span>RunNnetComputation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::RunNnetComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">CachingOptimizingCompiler</a> *&#160;</td>
          <td class="paramname"><em>compiler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>xvector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-xvector-compute_8cc_source.html#l00033">33</a> of file <a class="el" href="nnet3-xvector-compute_8cc_source.html">nnet3-xvector-compute.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00542">NnetComputer::AcceptInput()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00716">CachingOptimizingCompiler::Compile()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00582">NnetComputer::GetOutputDestructive()</a>, <a class="el" href="nnet-computation_8h_source.html#l00075">IoSpecification::has_deriv</a>, <a class="el" href="nnet-computation_8h_source.html#l00074">IoSpecification::indexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="nnet-computation_8h_source.html#l00073">IoSpecification::name</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00190">Vector&lt; Real &gt;::Resize()</a>, <a class="el" href="cu-matrix_8h_source.html#l00613">CuMatrixBase&lt; Real &gt;::Row()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00508">NnetComputer::Run()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00126">ComputationRequest::store_component_stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-xvector-compute_8cc_source.html#l00063">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a5c5011f4cb4b2fc21775a3308c9cecda">store_component_stats</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.push_back(</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a>(<span class="stringliteral">&quot;input&quot;</span>, 0, features.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>()));</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a> output_spec;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  output_spec.<a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html#a9b45b3e13bd9167aab02e17e08916231">name</a> = <span class="stringliteral">&quot;output&quot;</span>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  output_spec.<a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html#a4e836d0aae6b13f7b0c0f4959060f9dd">has_deriv</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  output_spec.<a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.resize(1);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>.resize(1);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].Swap(&amp;output_spec);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  std::shared_ptr&lt;const NnetComputation&gt; computation(std::move(compiler-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#aff351a0fdf96a308aac59a70993d58ff">Compile</a>(request)));</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *nnet_to_update = NULL;  <span class="comment">// we&#39;re not doing any update.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> computer(<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">NnetComputeOptions</a>(), *computation,</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                  nnet, nnet_to_update);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_feats_cu(features);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  computer.AcceptInput(<span class="stringliteral">&quot;input&quot;</span>, &amp;input_feats_cu);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  computer.Run();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> cu_output;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  computer.GetOutputDestructive(<span class="stringliteral">&quot;output&quot;</span>, &amp;cu_output);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  xvector-&gt;<a class="code" href="classkaldi_1_1Vector.html#ae98e624cca1982e866ff195131ed4427">Resize</a>(cu_output.<a class="code" href="classkaldi_1_1CuMatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>());</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  xvector-&gt;<a class="code" href="classkaldi_1_1VectorBase.html#a959973067b5f0a4b205c9d8385fa33df">CopyFromVec</a>(cu_output.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a2063a15b24ba24887ffaa92f44e1d4bf">Row</a>(0));</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a5c5011f4cb4b2fc21775a3308c9cecda"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a5c5011f4cb4b2fc21775a3308c9cecda">kaldi::nnet3::ComputationRequest::store_component_stats</a></div><div class="ttdeci">bool store_component_stats</div><div class="ttdoc">you should set need_component_stats to true if you need the average-activation and average-derivative...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00126">nnet-computation.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a2063a15b24ba24887ffaa92f44e1d4bf"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a2063a15b24ba24887ffaa92f44e1d4bf">kaldi::CuMatrixBase::Row</a></div><div class="ttdeci">const CuSubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00613">cu-matrix.h:613</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a58c542fffb7e7f754148c264c90b4a5e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">kaldi::nnet3::ComputationRequest::need_model_derivative</a></div><div class="ttdeci">bool need_model_derivative</div><div class="ttdoc">if need_model_derivative is true, then we&amp;#39;ll be doing either model training or model-derivative compu...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00121">nnet-computation.h:121</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00115">nnet-computation.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html_ae98e624cca1982e866ff195131ed4427"><div class="ttname"><a href="classkaldi_1_1Vector.html#ae98e624cca1982e866ff195131ed4427">kaldi::Vector::Resize</a></div><div class="ttdeci">void Resize(MatrixIndexT length, MatrixResizeType resize_type=kSetZero)</div><div class="ttdoc">Set vector to a specified size (can be zero). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00190">kaldi-vector.cc:190</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1IoSpecification_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1IoSpecification.html#a9b45b3e13bd9167aab02e17e08916231">kaldi::nnet3::IoSpecification::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00073">nnet-computation.h:73</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">kaldi::nnet3::NnetComputeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00039">nnet-compute.h:39</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_a959973067b5f0a4b205c9d8385fa33df"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#a959973067b5f0a4b205c9d8385fa33df">kaldi::VectorBase::CopyFromVec</a></div><div class="ttdeci">void CopyFromVec(const VectorBase&lt; Real &gt; &amp;v)</div><div class="ttdoc">Copy data from another vector (must match own size). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00228">kaldi-vector.cc:228</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1IoSpecification_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1IoSpecification.html">kaldi::nnet3::IoSpecification</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00072">nnet-computation.h:72</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1IoSpecification_html_a4e836d0aae6b13f7b0c0f4959060f9dd"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1IoSpecification.html#a4e836d0aae6b13f7b0c0f4959060f9dd">kaldi::nnet3::IoSpecification::has_deriv</a></div><div class="ttdeci">bool has_deriv</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00075">nnet-computation.h:75</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_aff351a0fdf96a308aac59a70993d58ff"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#aff351a0fdf96a308aac59a70993d58ff">kaldi::nnet3::CachingOptimizingCompiler::Compile</a></div><div class="ttdeci">std::shared_ptr&lt; const NnetComputation &gt; Compile(const ComputationRequest &amp;request)</div><div class="ttdoc">Does the compilation and returns a const pointer to the result, which is owned by this class...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00716">nnet-optimize.cc:716</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1IoSpecification_html_aa3daaa77b972f8dace077e94b418aab1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1IoSpecification.html#aa3daaa77b972f8dace077e94b418aab1">kaldi::nnet3::IoSpecification::indexes</a></div><div class="ttdeci">std::vector&lt; Index &gt; indexes</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00074">nnet-computation.h:74</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::CuMatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00215">cu-matrix.h:215</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputer_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputer.html">kaldi::nnet3::NnetComputer</a></div><div class="ttdoc">class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00059">nnet-compute.h:59</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00116">nnet-computation.h:116</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40f1b6df80b7997a8958d2672c40b05c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40f1b6df80b7997a8958d2672c40b05c">&#9670;&nbsp;</a></span>ScaleBatchnormStats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ScaleBatchnormStats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>batchnorm_stats_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function scales the batchorm stats of any batchnorm components (components of type <a class="el" href="classkaldi_1_1nnet3_1_1BatchNormComponent.html">BatchNormComponent</a>) in 'nnet' by the scale 'batchnorm_stats_scale'. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00527">527</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="nnet-normalize-component_8cc_source.html#l00642">BatchNormComponent::Scale()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00170">NnetChainTrainer::TrainInternal()</a>, <a class="el" href="nnet-training_8cc_source.html#l00093">NnetTrainer::TrainInternal()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00223">NnetChainTrainer::TrainInternalBackstitch()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00133">NnetTrainer::TrainInternalBackstitch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                     {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(batchnorm_stats_scale &gt;= 0.0 &amp;&amp; batchnorm_stats_scale &lt;= 1.0);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span> (batchnorm_stats_scale == 1.0)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    BatchNormComponent *bc = <span class="keyword">dynamic_cast&lt;</span>BatchNormComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (bc != NULL)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      bc-&gt;Scale(batchnorm_stats_scale);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a62b3a3e7be6ebc2a2af34bdb347ec76a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62b3a3e7be6ebc2a2af34bdb347ec76a">&#9670;&nbsp;</a></span>ScaleNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ScaleNnet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scales the nnet parameters and stats by this scale. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00303">303</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00360">Component::Scale()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-am-copy_8cc_source.html#l00028">main()</a>, <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00026">NnetChainComputeProb::NnetChainComputeProb()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00027">NnetChainTrainer::NnetChainTrainer()</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00026">NnetComputeProb::NnetComputeProb()</a>, <a class="el" href="nnet-discriminative-diagnostics_8cc_source.html#l00028">NnetDiscriminativeComputeObjf::NnetDiscriminativeComputeObjf()</a>, <a class="el" href="nnet-discriminative-training_8cc_source.html#l00027">NnetDiscriminativeTrainer::NnetDiscriminativeTrainer()</a>, <a class="el" href="nnet-training_8cc_source.html#l00027">NnetTrainer::NnetTrainer()</a>, <a class="el" href="nnet3-average_8cc_source.html#l00057">kaldi::ReadModels()</a>, <a class="el" href="nnet-discriminative-diagnostics_8cc_source.html#l00060">NnetDiscriminativeComputeObjf::Reset()</a>, <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00079">NnetChainComputeProb::Reset()</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00069">NnetComputeProb::Reset()</a>, <a class="el" href="nnet-discriminative-training_8cc_source.html#l00063">NnetDiscriminativeTrainer::Train()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00170">NnetChainTrainer::TrainInternal()</a>, <a class="el" href="nnet-training_8cc_source.html#l00093">NnetTrainer::TrainInternal()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00223">NnetChainTrainer::TrainInternalBackstitch()</a>, <a class="el" href="nnet-training_8cc_source.html#l00133">NnetTrainer::TrainInternalBackstitch()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>, <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">UnitTestNnetOptimizeWithOptions()</a>, and <a class="el" href="nnet3-combine_8cc_source.html#l00066">UpdateNnetMovingAverage()</a>.</p>
<div class="fragment"><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                            {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordflow">if</span> (scale == 1.0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      comp-&gt;Scale(scale);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a9e66a1549640fddc06015648df4167bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e66a1549640fddc06015648df4167bc">&#9670;&nbsp;</a></span>ScaleSupervisionWeight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::ScaleSupervisionWeight </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-copy-egs_8cc_source.html#l00047">47</a> of file <a class="el" href="nnet3-copy-egs_8cc_source.html">nnet3-copy-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, and <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-copy-egs_8cc_source.html#l00290">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                               {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (weight == 1.0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">bool</span> found_output = <span class="keyword">false</span>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;NnetIo&gt;::iterator it = eg-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.begin();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;       it != eg-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.end(); ++it) {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (it-&gt;name == <span class="stringliteral">&quot;output&quot;</span>) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      it-&gt;features.Scale(weight);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      found_output = <span class="keyword">true</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (!found_output)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;No supervision with name &#39;output&#39;&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;exists in eg.&quot;</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adfcccae5ab2f658419cedbd126f574f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfcccae5ab2f658419cedbd126f574f0">&#9670;&nbsp;</a></span>SecondElementComparator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::SecondElementComparator </td>
          <td>(</td>
          <td class="paramtype">const std::pair&lt; int32, int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>first_pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::pair&lt; int32, int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>second_pair</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00078">78</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00243">SplitLocationsUsingSubmatHistogram()</a>.</p>
<div class="fragment"><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                                                        {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">if</span> (first_pair.second == second_pair.second)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">return</span> first_pair.first &gt; second_pair.first;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">return</span> first_pair.second &gt; second_pair.second;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a3c1cb3ecc86f15353f90fab03073c77d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c1cb3ecc86f15353f90fab03073c77d">&#9670;&nbsp;</a></span>SelectFromExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::SelectFromExample </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>frame_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>left_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>right_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is responsible for possibly selecting one frame from multiple supervised frames, and reducing the left and right context as specified. </p>
<p>If frame == "" it does not reduce the supervised frames; if frame == "random" it selects one random frame; otherwise it expects frame to be an integer, and will select only the output with that frame index (or return false if there was no such output).</p>
<p>If left_context != -1 it removes any inputs with t &lt; (smallest output - left_context). If left_context != -1 it removes any inputs with t &lt; (smallest output - left_context).</p>
<p>It returns true if it was able to select a frame. We only anticipate it ever returning false in situations where frame is an integer, and the eg came from the end of a file and has a smaller than normal number of supervised frames. </p>

<p class="definition">Definition at line <a class="el" href="nnet3-copy-egs_8cc_source.html#l00222">222</a> of file <a class="el" href="nnet3-copy-egs_8cc_source.html">nnet3-copy-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3-copy-egs_8cc_source.html#l00082">ContainsSingleExample()</a>, <a class="el" href="text-utils_8h_source.html#l00118">kaldi::ConvertStringToInteger()</a>, <a class="el" href="nnet3-copy-egs_8cc_source.html#l00145">FilterExample()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, and <a class="el" href="nnet-example-utils_8cc_source.html#l00174">ShiftExampleTimes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-copy-egs_8cc_source.html#l00290">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                            {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> warned_left = <span class="keyword">false</span>, warned_right = <span class="keyword">false</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  int32 min_input_t, max_input_t,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      min_output_t, max_output_t;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a9d106dafc23aa3dc2359adc0bb2a94bd">ContainsSingleExample</a>(eg, &amp;min_input_t, &amp;max_input_t,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                             &amp;min_output_t, &amp;max_output_t))</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Too late to perform frame selection/context reduction on &quot;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;these examples (already merged?)&quot;</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">if</span> (frame_str != <span class="stringliteral">&quot;&quot;</span>) {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// select one frame.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span> (frame_str == <span class="stringliteral">&quot;random&quot;</span>) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      min_output_t = max_output_t = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(min_output_t,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                                          max_output_t);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      int32 frame;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(frame_str, &amp;frame))</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Invalid option --frame=&#39;&quot;</span> &lt;&lt; frame_str &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordflow">if</span> (frame &lt; min_output_t || frame &gt; max_output_t) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">// Frame is out of range.  Should happen only rarely.  Calling code</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="comment">// makes sure of this.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      min_output_t = max_output_t = frame;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span> (left_context != -1) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (!warned_left &amp;&amp; min_input_t &gt; min_output_t - left_context) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      warned_left = <span class="keyword">true</span>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;You requested --left-context=&quot;</span> &lt;&lt; left_context</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;, but example only has left-context of &quot;</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                 &lt;&lt;  (min_output_t - min_input_t)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; (will warn only once; this may be harmless if &quot;</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          <span class="stringliteral">&quot;using any --*left-context-initial options)&quot;</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    min_input_t = std::max(min_input_t, min_output_t - left_context);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">if</span> (right_context != -1) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">if</span> (!warned_right &amp;&amp; max_input_t &lt; max_output_t + right_context) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      warned_right = <span class="keyword">true</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;You requested --right-context=&quot;</span> &lt;&lt; right_context</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, but example only has right-context of &quot;</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                &lt;&lt;  (max_input_t - max_output_t)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; (will warn only once; this may be harmless if &quot;</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="stringliteral">&quot;using any --*right-context-final options.&quot;</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    max_input_t = std::min(max_input_t, max_output_t + right_context);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ae235076d32848d3ce99ecd4a763e0961">FilterExample</a>(eg,</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                min_input_t, max_input_t,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                min_output_t, max_output_t,</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                eg_out);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (frame_shift != 0) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    std::vector&lt;std::string&gt; exclude_names;  <span class="comment">// we can later make this</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    exclude_names.push_back(std::string(<span class="stringliteral">&quot;ivector&quot;</span>)); <span class="comment">// configurable.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a372bbe2bbd902e2f572a04d4c5e80f06">ShiftExampleTimes</a>(frame_shift, exclude_names, eg_out);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a39eb3f7ce5fab6dbbcb396b3f8e196f4"><div class="ttname"><a href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">kaldi::ConvertStringToInteger</a></div><div class="ttdeci">bool ConvertStringToInteger(const std::string &amp;str, Int *out)</div><div class="ttdoc">Converts a string into an integer via strtoll and returns false if there was any kind of problem (i...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00118">text-utils.h:118</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a372bbe2bbd902e2f572a04d4c5e80f06"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a372bbe2bbd902e2f572a04d4c5e80f06">kaldi::nnet3::ShiftExampleTimes</a></div><div class="ttdeci">void ShiftExampleTimes(int32 t_offset, const std::vector&lt; std::string &gt; &amp;exclude_names, NnetExample *eg)</div><div class="ttdoc">Shifts the time-index t of everything in the &quot;eg&quot; by adding &quot;t_offset&quot; to all &quot;t&quot; values...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00174">nnet-example-utils.cc:174</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9d106dafc23aa3dc2359adc0bb2a94bd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9d106dafc23aa3dc2359adc0bb2a94bd">kaldi::nnet3::ContainsSingleExample</a></div><div class="ttdeci">bool ContainsSingleExample(const NnetExample &amp;eg, int32 *min_input_t, int32 *max_input_t, int32 *min_output_t, int32 *max_output_t)</div><div class="ttdoc">Returns true if the &quot;eg&quot; contains just a single example, meaning that all the &quot;n&quot; values in the index...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-copy-egs_8cc_source.html#l00082">nnet3-copy-egs.cc:82</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae235076d32848d3ce99ecd4a763e0961"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae235076d32848d3ce99ecd4a763e0961">kaldi::nnet3::FilterExample</a></div><div class="ttdeci">void FilterExample(const NnetExample &amp;eg, int32 min_input_t, int32 max_input_t, int32 min_output_t, int32 max_output_t, NnetExample *eg_out)</div><div class="ttdoc">This function filters the indexes (and associated feature rows) in a NnetExample, removing any index/...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-copy-egs_8cc_source.html#l00145">nnet3-copy-egs.cc:145</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac8f15bc7a244b05a3f04e15d562043dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8f15bc7a244b05a3f04e15d562043dc">&#9670;&nbsp;</a></span>SetBatchnormTestMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetBatchnormTestMode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>test_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function affects only components of type <a class="el" href="classkaldi_1_1nnet3_1_1BatchNormComponent.html">BatchNormComponent</a>. </p>
<p>It sets "test mode" on such components (if you call it with test_mode = true, otherwise it would set normal mode, but this wouldn't be needed often). "test mode" means that instead of using statistics from the batch, it does a deterministic normalization based on statistics stored at training time. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00555">555</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="nnet-normalize-component_8cc_source.html#l00248">BatchNormComponent::SetTestMode()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-combine_8cc_source.html#l00035">ComputeObjf()</a>, <a class="el" href="nnet3-align-compiled_8cc_source.html#l00035">main()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00080">TestNnetDecodable()</a>, and <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>.</p>
<div class="fragment"><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                                       {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    BatchNormComponent *bc = <span class="keyword">dynamic_cast&lt;</span>BatchNormComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span> (bc != NULL)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      bc-&gt;SetTestMode(test_mode);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="abfc29da249703fa1e9c54cf85f6f0ef1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfc29da249703fa1e9c54cf85f6f0ef1">&#9670;&nbsp;</a></span>SetDerivTimesOptions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::SetDerivTimesOptions </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> *&#160;</td>
          <td class="paramname"><em>opt_config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-derivative-test_8cc_source.html#l00046">46</a> of file <a class="el" href="nnet-derivative-test_8cc_source.html">nnet-derivative-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-derivative-test_8cc_source.html#l00031">ComputeMinAndMaxTimes()</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-optimize_8h_source.html#l00053">NnetOptimizeOptions::max_deriv_time</a>, <a class="el" href="nnet-optimize_8h_source.html#l00052">NnetOptimizeOptions::min_deriv_time</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                           {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  int32 min_t, max_t;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[0].name == <span class="stringliteral">&quot;input&quot;</span>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">const</span> std::vector&lt;Index&gt; &amp;input_indexes = request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[0].indexes;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a12fab71b9fb0d11733b8d9e452da5eda">ComputeMinAndMaxTimes</a>(input_indexes, &amp;min_t, &amp;max_t);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  int32 orig_min_t = min_t, orig_max_t = max_t;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">int</span> t_length = max_t + 1 - min_t;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(t_length &gt; 0);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">if</span> (t_length == 1)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 2) == 0) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// remove as much as 4 frames from the left (but don&#39;t remove everything).</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    min_t += std::min(4, <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, t_length - 1));</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    opt_config-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">min_deriv_time</a> = min_t;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    t_length = max_t + 1 - min_t;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(t_length &gt; 0);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 2) == 0) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    max_t -= std::min(4, <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, t_length - 1));</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    opt_config-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">max_deriv_time</a> = max_t;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    t_length = max_t + 1 - min_t;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(t_length &gt; 0);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 4) == 0) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// ensure that all derivs will be pruned away;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// this tests more code.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    min_t = orig_min_t - 10;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    max_t = min_t + 1;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  int32 output_min_t, output_max_t;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].name == <span class="stringliteral">&quot;output&quot;</span>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a12fab71b9fb0d11733b8d9e452da5eda">ComputeMinAndMaxTimes</a>(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].indexes,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                        &amp;output_min_t, &amp;output_max_t);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;ComputationRequest has output (min,max) = (&quot;</span> &lt;&lt; output_min_t</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; output_max_t &lt;&lt; <span class="stringliteral">&quot;), input (min,max) = (&quot;</span> &lt;&lt; orig_min_t</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; orig_max_t &lt;&lt; <span class="stringliteral">&quot;), limiting deriv times to (&quot;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            &lt;&lt; opt_config-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">min_deriv_time</a> &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            &lt;&lt; opt_config-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">max_deriv_time</a> &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00115">nnet-computation.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a3d087b2a181462f940490eeba587d5ed"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">kaldi::nnet3::NnetOptimizeOptions::min_deriv_time</a></div><div class="ttdeci">int32 min_deriv_time</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00052">nnet-optimize.h:52</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a12fab71b9fb0d11733b8d9e452da5eda"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a12fab71b9fb0d11733b8d9e452da5eda">kaldi::nnet3::ComputeMinAndMaxTimes</a></div><div class="ttdeci">void ComputeMinAndMaxTimes(const std::vector&lt; Index &gt; &amp;indexes, int32 *min_t, int32 *max_t)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-derivative-test_8cc_source.html#l00031">nnet-derivative-test.cc:31</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00116">nnet-computation.h:116</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a3eb30cd32859e75b85a514ee9747f9ef"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">kaldi::nnet3::NnetOptimizeOptions::max_deriv_time</a></div><div class="ttdeci">int32 max_deriv_time</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00053">nnet-optimize.h:53</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7eb3426f75b0e6c1be855ff7477e2f98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7eb3426f75b0e6c1be855ff7477e2f98">&#9670;&nbsp;</a></span>SetDropoutProportion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetDropoutProportion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>dropout_proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function sets the dropout proportion in all dropout components to dropout_proportion value. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00500">500</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l00140">DropoutComponent::SetDropoutProportion()</a>, <a class="el" href="nnet-general-component_8h_source.html#l00772">DropoutMaskComponent::SetDropoutProportion()</a>, and <a class="el" href="nnet-general-component_8h_source.html#l00888">GeneralDropoutComponent::SetDropoutProportion()</a>.</p>
<div class="fragment"><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                      {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    DropoutComponent *dc = <span class="keyword">dynamic_cast&lt;</span>DropoutComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span> (dc != NULL)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      dc-&gt;SetDropoutProportion(dropout_proportion);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    DropoutMaskComponent *mc =</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>DropoutMaskComponent*<span class="keyword">&gt;</span>(nnet-&gt;GetComponent(c));</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (mc != NULL)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      mc-&gt;SetDropoutProportion(dropout_proportion);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    GeneralDropoutComponent *gdc =</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>GeneralDropoutComponent*<span class="keyword">&gt;</span>(nnet-&gt;GetComponent(c));</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> (gdc != NULL)</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      gdc-&gt;SetDropoutProportion(dropout_proportion);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="af9757843e049a91502f6fa39782b1ffc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9757843e049a91502f6fa39782b1ffc">&#9670;&nbsp;</a></span>SetDropoutTestMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetDropoutTestMode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>test_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function affects components of child-classes of <a class="el" href="classkaldi_1_1nnet3_1_1RandomComponent.html">RandomComponent</a>. </p>
<p>It sets "test mode" on such components (if you call it with test_mode = true, otherwise it would set normal mode, but this wouldn't be needed often). "test mode" means that having a mask containing (1-dropout_prob) in all elements. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00564">564</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00415">RandomComponent::SetTestMode()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-combine_8cc_source.html#l00035">ComputeObjf()</a>, <a class="el" href="nnet3-align-compiled_8cc_source.html#l00035">main()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00080">TestNnetDecodable()</a>, and <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>.</p>
<div class="fragment"><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                                     {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    RandomComponent *rc = <span class="keyword">dynamic_cast&lt;</span>RandomComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (rc != NULL)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      rc-&gt;SetTestMode(test_mode);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a3936ad79463d7cfd23ba1efd54f56084"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3936ad79463d7cfd23ba1efd54f56084">&#9670;&nbsp;</a></span>SetLearningRate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetLearningRate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>learning_rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the underlying learning rate for all the components in the nnet to this value. </p>
<p>this will get multiplied by the individual learning-rate-factors to produce the actual learning rates. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00276">276</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00478">UpdatableComponent::SetUnderlyingLearningRate()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-am-copy_8cc_source.html#l00028">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                 {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="comment">// For now all updatable components inherit from class UpdatableComponent.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="comment">// If that changes in future, we will change this code.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      UpdatableComponent *uc = <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordflow">if</span> (uc == NULL)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Updatable component does not inherit from class &quot;</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="stringliteral">&quot;UpdatableComponent; change this code.&quot;</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      uc-&gt;SetUnderlyingLearningRate(learning_rate);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5c7a956c7fc10e9e5d67f351498c243"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5c7a956c7fc10e9e5d67f351498c243">&#9670;&nbsp;</a></span>SetNnetAsGradient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetNnetAsGradient </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets nnet as gradient by Setting is_gradient_ to true and learning_rate_ to 1 for each <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html" title="Class UpdatableComponent is a Component which has trainable parameters; it extends the interface of C...">UpdatableComponent</a> in nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00292">292</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00487">UpdatableComponent::SetAsGradient()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00026">NnetChainComputeProb::NnetChainComputeProb()</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00026">NnetComputeProb::NnetComputeProb()</a>, <a class="el" href="nnet-discriminative-diagnostics_8cc_source.html#l00028">NnetDiscriminativeComputeObjf::NnetDiscriminativeComputeObjf()</a>, <a class="el" href="nnet-discriminative-diagnostics_8cc_source.html#l00060">NnetDiscriminativeComputeObjf::Reset()</a>, <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00079">NnetChainComputeProb::Reset()</a>, <a class="el" href="nnet-diagnostics_8cc_source.html#l00069">NnetComputeProb::Reset()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">UnitTestNnetModelDerivatives()</a>, and <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">UnitTestNnetOptimizeWithOptions()</a>.</p>
<div class="fragment"><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                   {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      UpdatableComponent *u_comp = <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(u_comp != NULL);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      u_comp-&gt;SetAsGradient();</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad96e7aef845800f1dc88fa2ad1aade28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad96e7aef845800f1dc88fa2ad1aade28">&#9670;&nbsp;</a></span>SetPriors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::SetPriors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>transition_accs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>prior_floor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1AmNnetSimple.html">AmNnetSimple</a> *&#160;</td>
          <td class="paramname"><em>am_nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-am-train-transitions_8cc_source.html#l00028">28</a> of file <a class="el" href="nnet3-am-train-transitions_8cc_source.html">nnet3-am-train-transitions.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="am-nnet-simple_8cc_source.html#l00028">AmNnetSimple::NumPdfs()</a>, <a class="el" href="transition-model_8h_source.html#l00185">TransitionModel::NumPdfs()</a>, <a class="el" href="am-nnet-simple_8cc_source.html#l00070">AmNnetSimple::SetPriors()</a>, and <a class="el" href="transition-model_8h_source.html#l00324">TransitionModel::TransitionIdToPdf()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-am-train-transitions_8cc_source.html#l00053">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                      {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tmodel.<a class="code" href="classkaldi_1_1TransitionModel.html#ae13f7c74eb93b128c78b90e2131a8e70">NumPdfs</a>() == am_nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1AmNnetSimple.html#ae13f7c74eb93b128c78b90e2131a8e70">NumPdfs</a>());</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> pdf_counts(tmodel.<a class="code" href="classkaldi_1_1TransitionModel.html#ae13f7c74eb93b128c78b90e2131a8e70">NumPdfs</a>());</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(transition_accs(0) == 0.0); <span class="comment">// There is</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">// no zero transition-id.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">for</span> (int32 tid = 1; tid &lt; transition_accs.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(); tid++) {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    int32 pdf = tmodel.<a class="code" href="group__hmm__group.html#ga53ec248f5bb23021e89d571c7063b108">TransitionIdToPdf</a>(tid);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    pdf_counts(pdf) += transition_accs(tid);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  }</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> sum = pdf_counts.Sum();</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sum != 0.0);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(prior_floor &gt; 0.0 &amp;&amp; prior_floor &lt; 1.0);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  pdf_counts.Scale(1.0 / sum);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  pdf_counts.ApplyFloor(prior_floor);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  pdf_counts.Scale(1.0 / pdf_counts.Sum()); <span class="comment">// normalize again.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  am_nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1AmNnetSimple.html#a9ab18efc13ed11baec71f29801c3addb">SetPriors</a>(pdf_counts);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}               </div><div class="ttc" id="group__hmm__group_html_ga53ec248f5bb23021e89d571c7063b108"><div class="ttname"><a href="group__hmm__group.html#ga53ec248f5bb23021e89d571c7063b108">kaldi::TransitionModel::TransitionIdToPdf</a></div><div class="ttdeci">int32 TransitionIdToPdf(int32 trans_id) const</div><div class="ttdef"><b>Definition:</b> <a href="transition-model_8h_source.html#l00324">transition-model.h:324</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1AmNnetSimple_html_a9ab18efc13ed11baec71f29801c3addb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1AmNnetSimple.html#a9ab18efc13ed11baec71f29801c3addb">kaldi::nnet3::AmNnetSimple::SetPriors</a></div><div class="ttdeci">void SetPriors(const VectorBase&lt; BaseFloat &gt; &amp;priors)</div><div class="ttdef"><b>Definition:</b> <a href="am-nnet-simple_8cc_source.html#l00070">am-nnet-simple.cc:70</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1AmNnetSimple_html_ae13f7c74eb93b128c78b90e2131a8e70"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1AmNnetSimple.html#ae13f7c74eb93b128c78b90e2131a8e70">kaldi::nnet3::AmNnetSimple::NumPdfs</a></div><div class="ttdeci">int32 NumPdfs() const</div><div class="ttdef"><b>Definition:</b> <a href="am-nnet-simple_8cc_source.html#l00028">am-nnet-simple.cc:28</a></div></div>
<div class="ttc" id="classkaldi_1_1TransitionModel_html_ae13f7c74eb93b128c78b90e2131a8e70"><div class="ttname"><a href="classkaldi_1_1TransitionModel.html#ae13f7c74eb93b128c78b90e2131a8e70">kaldi::TransitionModel::NumPdfs</a></div><div class="ttdeci">int32 NumPdfs() const</div><div class="ttdef"><b>Definition:</b> <a href="transition-model_8h_source.html#l00185">transition-model.h:185</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae01be70ef8559aef9dd5a01a4028198c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae01be70ef8559aef9dd5a01a4028198c">&#9670;&nbsp;</a></span>ShiftChainExampleTimes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ShiftChainExampleTimes </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>exclude_names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetChainExample.html">NnetChainExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shifts the time-index t of everything in the input of "eg" by adding "t_offset" to all "t" values&ndash; but excluding those with names listed in "exclude_names", e.g. </p>
<p>"ivector". This might be useful if you are doing subsampling of frames at the output, because shifted examples won't be quite equivalent to their non-shifted counterparts. "exclude_names" is a vector of names of nnet inputs that we avoid shifting the "t" values of&ndash; normally it will contain just the single string "ivector" because we always leave t=0 for any ivector.</p>
<p>Note: input features will be shifted by 'frame_shift', and indexes in the supervision in (eg-&gt;output) will be shifted by 'frame_shift' rounded to the closest multiple of the frame subsampling factor (e.g. 3). The frame subsampling factor is worked out from the time spacing between the indexes in the output. </p>

<p class="definition">Definition at line <a class="el" href="nnet-chain-example_8cc_source.html#l00353">353</a> of file <a class="el" href="nnet-chain-example_8cc_source.html">nnet-chain-example.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-chain-example_8h_source.html#l00115">NnetChainExample::inputs</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-chain-example_8h_source.html#l00119">NnetChainExample::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-example_8h_source.html#l00156">NnetChainExampleStructureCompare::operator()()</a>.</p>
<div class="fragment"><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                                  {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  std::vector&lt;NnetIo&gt;::iterator input_iter = eg-&gt;inputs.begin(),</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      input_end = eg-&gt;inputs.end();</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">for</span> (; input_iter != input_end; ++input_iter) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">bool</span> must_exclude = <span class="keyword">false</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    std::vector&lt;string&gt;::const_iterator exclude_iter = exclude_names.begin(),</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        exclude_end = exclude_names.end();</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">for</span> (; exclude_iter != exclude_end; ++exclude_iter)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">if</span> (input_iter-&gt;name == *exclude_iter)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        must_exclude = <span class="keyword">true</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (!must_exclude) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      std::vector&lt;Index&gt;::iterator indexes_iter = input_iter-&gt;indexes.begin(),</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          indexes_end = input_iter-&gt;indexes.end();</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">for</span> (; indexes_iter != indexes_end; ++indexes_iter)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        indexes_iter-&gt;t += frame_shift;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="comment">// note: we&#39;ll normally choose a small enough shift that the output-data</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="comment">// shift will be zero after dividing by frame_subsampling_factor</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">// (e.g. frame_subsampling_factor == 3 and shift = 0 or 1.</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  std::vector&lt;NnetChainSupervision&gt;::iterator</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      sup_iter = eg-&gt;outputs.begin(),</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      sup_end = eg-&gt;outputs.end();</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">for</span> (; sup_iter != sup_end; ++sup_iter) {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    std::vector&lt;Index&gt; &amp;indexes = sup_iter-&gt;indexes;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes.size() &gt;= 2 &amp;&amp; indexes[0].n == indexes[1].n &amp;&amp;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                 indexes[0].x == indexes[1].x);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    int32 frame_subsampling_factor = indexes[1].t - indexes[0].t;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(frame_subsampling_factor &gt; 0);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// We need to shift by a multiple of frame_subsampling_factor.</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">// Round to the closest multiple.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    int32 supervision_frame_shift =</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        frame_subsampling_factor *</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        std::floor(0.5 + (frame_shift * 1.0 / frame_subsampling_factor));</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (supervision_frame_shift == 0)</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    std::vector&lt;Index&gt;::iterator indexes_iter = indexes.begin(),</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        indexes_end = indexes.end();</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">for</span> (; indexes_iter != indexes_end; ++indexes_iter)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      indexes_iter-&gt;t += supervision_frame_shift;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6a841fd1955e1fe57fd1ee29459a1f6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a841fd1955e1fe57fd1ee29459a1f6f">&#9670;&nbsp;</a></span>ShiftDiscriminativeExampleTimes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ShiftDiscriminativeExampleTimes </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>frame_shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>exclude_names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetDiscriminativeExample.html">NnetDiscriminativeExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shifts the time-index t of everything in the input of "eg" by adding "t_offset" to all "t" values&ndash; but excluding those with names listed in "exclude_names", e.g. </p>
<p>"ivector". This might be useful if you are doing subsampling of frames at the output, because shifted examples won't be quite equivalent to their non-shifted counterparts. "exclude_names" is a vector of names of nnet inputs that we avoid shifting the "t" values of&ndash; normally it will contain just the single string "ivector" because we always leave t=0 for any ivector.</p>
<p>Note: input features will be shifted by 'frame_shift', and indexes in the supervision in (eg-&gt;output) will be shifted by 'frame_shift' rounded to the closest multiple of the frame subsampling factor (e.g. 3). The frame subsampling factor is worked out from the time spacing between the indexes in the output. </p>

<p class="definition">Definition at line <a class="el" href="nnet-discriminative-example_8cc_source.html#l00347">347</a> of file <a class="el" href="nnet-discriminative-example_8cc_source.html">nnet-discriminative-example.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-discriminative-example_8h_source.html#l00108">NnetDiscriminativeExample::inputs</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-discriminative-example_8h_source.html#l00112">NnetDiscriminativeExample::outputs</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-discriminative-copy-egs_8cc_source.html#l00039">main()</a>, and <a class="el" href="nnet-discriminative-example_8h_source.html#l00151">NnetDiscriminativeExampleStructureCompare::operator()()</a>.</p>
<div class="fragment"><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                                           {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  std::vector&lt;NnetIo&gt;::iterator input_iter = eg-&gt;inputs.begin(),</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      input_end = eg-&gt;inputs.end();</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">for</span> (; input_iter != input_end; ++input_iter) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordtype">bool</span> must_exclude = <span class="keyword">false</span>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    std::vector&lt;string&gt;::const_iterator exclude_iter = exclude_names.begin(),</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        exclude_end = exclude_names.end();</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">for</span> (; exclude_iter != exclude_end; ++exclude_iter)</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">if</span> (input_iter-&gt;name == *exclude_iter)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        must_exclude = <span class="keyword">true</span>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (!must_exclude) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      std::vector&lt;Index&gt;::iterator indexes_iter = input_iter-&gt;indexes.begin(),</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          indexes_end = input_iter-&gt;indexes.end();</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordflow">for</span> (; indexes_iter != indexes_end; ++indexes_iter)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        indexes_iter-&gt;t += frame_shift;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="comment">// note: we&#39;ll normally choose a small enough shift that the output-data</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">// shift will be zero after dividing by frame_subsampling_factor</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">// (e.g. frame_subsampling_factor == 3 and shift = 0 or 1.</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  std::vector&lt;NnetDiscriminativeSupervision&gt;::iterator</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      sup_iter = eg-&gt;outputs.begin(),</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      sup_end = eg-&gt;outputs.end();</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">for</span> (; sup_iter != sup_end; ++sup_iter) {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    std::vector&lt;Index&gt; &amp;indexes = sup_iter-&gt;indexes;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes.size() &gt;= 2 &amp;&amp; indexes[0].n == indexes[1].n &amp;&amp;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                 indexes[0].x == indexes[1].x);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    int32 frame_subsampling_factor = indexes[1].t - indexes[0].t;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(frame_subsampling_factor &gt; 0);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// We need to shift by a multiple of frame_subsampling_factor.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// Round to the closest multiple.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    int32 supervision_frame_shift =</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        frame_subsampling_factor *</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        std::floor(0.5 + (frame_shift * 1.0 / frame_subsampling_factor));</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (supervision_frame_shift == 0)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    std::vector&lt;Index&gt;::iterator indexes_iter = indexes.begin(),</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        indexes_end = indexes.end();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">for</span> (; indexes_iter != indexes_end; ++indexes_iter)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      indexes_iter-&gt;t += supervision_frame_shift;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a372bbe2bbd902e2f572a04d4c5e80f06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a372bbe2bbd902e2f572a04d4c5e80f06">&#9670;&nbsp;</a></span>ShiftExampleTimes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ShiftExampleTimes </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>t_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>exclude_names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shifts the time-index t of everything in the "eg" by adding "t_offset" to all "t" values. </p>
<p>This might be useful in things like clockwork RNNs that are not invariant to time-shifts, to ensure that we see different shifts of each example during training. "exclude_names" is a vector (not necessarily sorted) of names of nnet inputs that we avoid shifting the "t" values of&ndash; normally it will contain just the single string "ivector" because we always leave t=0 for any ivector. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00174">174</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-copy-egs_8cc_source.html#l00222">SelectFromExample()</a>.</p>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                        {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span> (t_offset == 0)</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  std::vector&lt;NnetIo&gt;::iterator iter = eg-&gt;io.begin(),</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      end = eg-&gt;io.end();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">for</span> (; iter != end; iter++) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordtype">bool</span> name_is_excluded = <span class="keyword">false</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    std::vector&lt;std::string&gt;::const_iterator</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        exclude_iter = exclude_names.begin(),</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        exclude_end = exclude_names.end();</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">for</span> (; exclude_iter != exclude_end; ++exclude_iter) {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">if</span> (iter-&gt;name == *exclude_iter) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        name_is_excluded = <span class="keyword">true</span>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (!name_is_excluded) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="comment">// name is not something like &quot;ivector&quot; that we exclude from shifting.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      std::vector&lt;Index&gt;::iterator index_iter = iter-&gt;indexes.begin(),</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          index_end = iter-&gt;indexes.end();</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">for</span> (; index_iter != index_end; ++index_iter)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        index_iter-&gt;t += t_offset;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="af8b9a053089365f8c8d0f3e5436d66a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8b9a053089365f8c8d0f3e5436d66a4">&#9670;&nbsp;</a></span>SnipMultiRowOp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::SnipMultiRowOp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>command_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02434">2434</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02339">FindNumLeadingAndTrailingNegatives()</a>, <a class="el" href="nnet-computation_8h_source.html#l00425">NnetComputation::indexes_multi</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00102">NnetComputation::NewSubMatrix()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02537">SnipRowOps()</a>.</p>
<div class="fragment"><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                                                {</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;  NnetComputation::Command &amp;c = computation-&gt;commands[command_index];</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(c.arg2) &lt; computation-&gt;indexes_multi.size());</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;indexes_multi =</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      computation-&gt;indexes_multi[c.arg2];</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  int32 num_leading_negatives, num_trailing_negatives;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#abbf4a43da0663edcee53e2942e53ae2e">FindNumLeadingAndTrailingNegatives</a>(indexes_multi,</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                                    &amp;num_leading_negatives,</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                                    &amp;num_trailing_negatives);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  <span class="keywordflow">if</span> (num_leading_negatives == 0 &amp;&amp; num_trailing_negatives == 0)</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  int32 new_num_rows = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(indexes_multi.size()) -</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      num_leading_negatives - num_trailing_negatives;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(new_num_rows &gt; 0);</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; new_indexes_multi(</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;      indexes_multi.begin() + num_leading_negatives,</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      indexes_multi.begin() + num_leading_negatives + new_num_rows);</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;  c.arg2 = computation-&gt;indexes_multi.size();</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;  computation-&gt;indexes_multi.push_back(std::vector&lt;std::pair&lt;int32, int32&gt; &gt;());</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  computation-&gt;indexes_multi.back().swap(new_indexes_multi);</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  c.arg1 = computation-&gt;NewSubMatrix(c.arg1,</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                                     num_leading_negatives, new_num_rows,</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                                     0, -1);</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// made a change.</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_abbf4a43da0663edcee53e2942e53ae2e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abbf4a43da0663edcee53e2942e53ae2e">kaldi::nnet3::FindNumLeadingAndTrailingNegatives</a></div><div class="ttdeci">static void FindNumLeadingAndTrailingNegatives(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;vec, int32 *num_leading_negatives, int32 *num_trailing_negatives)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02406">nnet-optimize-utils.cc:2406</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c29cb7ac7e40e18309451b6f8a193bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c29cb7ac7e40e18309451b6f8a193bd">&#9670;&nbsp;</a></span>SnipRangesRowOp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::SnipRangesRowOp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>command_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02507">2507</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02477">FindNumLeadingAndTrailingIdenticals()</a>, <a class="el" href="nnet-computation_8h_source.html#l00430">NnetComputation::indexes_ranges</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00102">NnetComputation::NewSubMatrix()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02537">SnipRowOps()</a>.</p>
<div class="fragment"><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                                                 {</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;  NnetComputation::Command &amp;c = computation-&gt;commands[command_index];</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(c.arg3) &lt; computation-&gt;indexes_ranges.size());</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;indexes_ranges =</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      computation-&gt;indexes_ranges[c.arg3];</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  int32 num_leading_identicals, num_trailing_identicals;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#abd9243d8740392f619af25f0653afa9e">FindNumLeadingAndTrailingIdenticals</a>(indexes_ranges,</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                                    &amp;num_leading_identicals,</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                                    &amp;num_trailing_identicals);</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  <span class="keywordflow">if</span> (num_leading_identicals == 0 &amp;&amp; num_trailing_identicals == 0)</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  int32 new_num_rows = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(indexes_ranges.size()) -</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      num_leading_identicals - num_trailing_identicals;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(new_num_rows &gt; 0);</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; new_indexes_ranges(</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;      indexes_ranges.begin() + num_leading_identicals,</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      indexes_ranges.begin() + num_leading_identicals + new_num_rows);</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  c.arg3 = computation-&gt;indexes_ranges.size();</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;  computation-&gt;indexes_ranges.push_back(std::vector&lt;std::pair&lt;int32, int32&gt; &gt;());</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  computation-&gt;indexes_ranges.back().swap(new_indexes_ranges);</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;  c.arg1 = computation-&gt;NewSubMatrix(c.arg1,</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                                     num_leading_identicals, new_num_rows,</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                                     0, -1);</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// made a change.</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_abd9243d8740392f619af25f0653afa9e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abd9243d8740392f619af25f0653afa9e">kaldi::nnet3::FindNumLeadingAndTrailingIdenticals</a></div><div class="ttdeci">static void FindNumLeadingAndTrailingIdenticals(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;vec, int32 *num_leading_identicals, int32 *num_trailing_identicals)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02477">nnet-optimize-utils.cc:2477</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a590c38bb0c9acc4ad1f626237f1a4169"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a590c38bb0c9acc4ad1f626237f1a4169">&#9670;&nbsp;</a></span>SnipRowOps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> SnipRowOps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function detects cases where commands of type kCopyRows, kAddRows, kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti or kAddRowRanges use indexes that start or end with -1's or equivalents, and replace them with similar commands that act on a sub-matrix of the matrices they are currently acting on. </p>
<p>This will help efficiency by avoiding launching unnecessary copies of the kernel (that don't really have to do anything).</p>
<p>This function returns true if it made any changes to the computation; if it returns true, then after doing this you should at some point do <a class="el" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f" title="This function detects submatrices and matrices that are never used (e.g. ">RenumberComputation()</a>, which will remove any now-unused members of computation-&gt;indexes. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02537">2537</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kAddRowRanges</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kAddRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kAddToRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kCopyToRowsMulti</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02434">SnipMultiRowOp()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02507">SnipRangesRowOp()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l02364">SnipSingleRowOp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                                              {</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  <span class="keywordtype">bool</span> ans = <span class="keyword">false</span>;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  int32 num_commands = computation-&gt;commands.size();</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="keywordflow">for</span> (int32 command_index = 0; command_index &lt; num_commands;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;       command_index++) {</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="comment">// non-const because we&#39;ll be changing it.</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;    NnetComputation::Command &amp;c = computation-&gt;commands[command_index];</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    <span class="comment">// note: we can&#39;t do the snipping for commands of type case kCopyRows and case</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    <span class="comment">// kCopyRowsMulti, because the -1&#39;s aren&#39;t a pure no-op; they have the</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    <span class="comment">// meaning of setting the destination value to zero, so we can&#39;t prune</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="comment">// them away.</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>: {</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a59e6e35ab79257514b799d2ebe48ed20">SnipSingleRowOp</a>(computation, command_index))</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;          ans = <span class="keyword">true</span>;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      }</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>:</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>: {</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#af8b9a053089365f8c8d0f3e5436d66a4">SnipMultiRowOp</a>(computation, command_index))</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;          ans = <span class="keyword">true</span>;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;      }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>: {</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a3c29cb7ac7e40e18309451b6f8a193bd">SnipRangesRowOp</a>(computation, command_index))</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;          ans = <span class="keyword">true</span>;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      }</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    }</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  }</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3c29cb7ac7e40e18309451b6f8a193bd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3c29cb7ac7e40e18309451b6f8a193bd">kaldi::nnet3::SnipRangesRowOp</a></div><div class="ttdeci">static bool SnipRangesRowOp(NnetComputation *computation, int32 command_index)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02507">nnet-optimize-utils.cc:2507</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a59e6e35ab79257514b799d2ebe48ed20"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a59e6e35ab79257514b799d2ebe48ed20">kaldi::nnet3::SnipSingleRowOp</a></div><div class="ttdeci">static bool SnipSingleRowOp(NnetComputation *computation, int32 command_index)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02364">nnet-optimize-utils.cc:2364</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af8b9a053089365f8c8d0f3e5436d66a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af8b9a053089365f8c8d0f3e5436d66a4">kaldi::nnet3::SnipMultiRowOp</a></div><div class="ttdeci">static bool SnipMultiRowOp(NnetComputation *computation, int32 command_index)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02434">nnet-optimize-utils.cc:2434</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a59e6e35ab79257514b799d2ebe48ed20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59e6e35ab79257514b799d2ebe48ed20">&#9670;&nbsp;</a></span>SnipSingleRowOp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::SnipSingleRowOp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>command_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02364">2364</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02339">FindNumLeadingAndTrailingNegatives()</a>, <a class="el" href="nnet-computation_8h_source.html#l00419">NnetComputation::indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00102">NnetComputation::NewSubMatrix()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l02537">SnipRowOps()</a>.</p>
<div class="fragment"><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                                                 {</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  NnetComputation::Command &amp;c = computation-&gt;commands[command_index];</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(c.arg3) &lt; computation-&gt;indexes.size());</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;indexes = computation-&gt;indexes[c.arg3];</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  int32 num_leading_negatives, num_trailing_negatives;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#abbf4a43da0663edcee53e2942e53ae2e">FindNumLeadingAndTrailingNegatives</a>(indexes,</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                                    &amp;num_leading_negatives,</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                                    &amp;num_trailing_negatives);</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  <span class="keywordflow">if</span> (num_leading_negatives == 0 &amp;&amp; num_trailing_negatives == 0)</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  int32 new_num_rows = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(indexes.size()) -</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      num_leading_negatives - num_trailing_negatives;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(new_num_rows &gt; 0);</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  std::vector&lt;int32&gt; new_indexes(indexes.begin() + num_leading_negatives,</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                                 indexes.begin() + num_leading_negatives +</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                                 new_num_rows);</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  c.arg3 = computation-&gt;indexes.size();</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  computation-&gt;indexes.push_back(std::vector&lt;int32&gt;());</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  computation-&gt;indexes.back().swap(new_indexes);</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  c.arg1 = computation-&gt;NewSubMatrix(c.arg1,</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                                     num_leading_negatives, new_num_rows,</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                                     0, -1);</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// made a change.</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_abbf4a43da0663edcee53e2942e53ae2e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abbf4a43da0663edcee53e2942e53ae2e">kaldi::nnet3::FindNumLeadingAndTrailingNegatives</a></div><div class="ttdeci">static void FindNumLeadingAndTrailingNegatives(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;vec, int32 *num_leading_negatives, int32 *num_trailing_negatives)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02406">nnet-optimize-utils.cc:2406</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aed1893395273c5cb53ea3606c2bad94a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed1893395273c5cb53ea3606c2bad94a">&#9670;&nbsp;</a></span>SortSubmatLists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::SortSubmatLists </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt;&#160;</td>
          <td class="paramname"><em>submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sorted_submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>max_submat_list_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00087">87</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00337">SplitLocations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;{</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  *max_submat_list_size = 0;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  sorted_submat_lists-&gt;reserve(submat_lists.size());</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(submat_lists.size() &gt; 0);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; submat_lists.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">if</span> (submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size() &gt; *max_submat_list_size)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      *max_submat_list_size = submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    sorted_submat_lists-&gt;push_back(submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    std::sort((*sorted_submat_lists)[i].begin(),</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;              (*sorted_submat_lists)[i].end(),</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;              FirstElementComparator());</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad12ff98370e4200e533b92aa369444bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad12ff98370e4200e533b92aa369444bf">&#9670;&nbsp;</a></span>SplitComputationIntoSegments()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::SplitComputationIntoSegments </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>segments</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Split the computation up into segments bounded by kNoOperationMarker. </p>
<p>For each segment, a pair of command-indexes (start, end) is output to the vector 'segments', so the commands in the segment (not including kNoOperationMarker) are numbered from start ... end - 1. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00852">852</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, and <a class="el" href="nnet-computation_8h_source.html#l00295">kNoOperationMarker</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00869">ConsolidateIoOperations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                                                 {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  int32 num_commands = computation.commands.size();</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  segments-&gt;clear();</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  int32 cur_start = 0;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_commands; c++) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">if</span> (computation.commands[c].command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      segments-&gt;push_back(std::pair&lt;int32, int32&gt;(cur_start, c));</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      cur_start = c + 1;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  segments-&gt;push_back(std::pair&lt;int32, int32&gt;(cur_start, num_commands));</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7c81548b4f8146cd3447b10d556978a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c81548b4f8146cd3447b10d556978a8">&#9670;&nbsp;</a></span>SplitLocations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SplitLocations </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>split_lists</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The input to this function is a vector of lists of pairs, and this function splits it up into a list of vectors of pairs. </p>
<p>In order to make the lists all the same length it may have to insert "dummy" pairs with value (-1, -1). In addition, this function implement certain heuristics to break up the list into pairs in a particular desirable way, which we will describe below.</p>
<p>Let the input be `submat_lists`, and let `num_rows = submat_lists.size()`. The value -1 is not expected to appear as either the .first or .second element of pairs in `submat_lists`.</p>
<p>Heuristics aside, what this function guarantees is as follows. Each pair p that is in an element of list `submat_lists[i]` (say `p = submat_lists[i][k]`), will be present as `(*split_lists)[j][i] == p`. Because we don't ban submat_lists[i] from containing duplicates, the technical definition is a little more complicated: that the count of any given pair p != (-1, -1) in `submat_lists[i][*]` is equal to the count of that same pair in `(*split_lists)[*][i]`.</p>
<p>Each pair present in split_lists is either (-1, -1), or will correspond to an element of submat_lists; thus the total number of pairs, excluding (-1, -1), in split_lists will be the same as the total number of pairs in submat_lists.</p>
<p>Note on expected input: submat_lists.dim() may be large e.g. 1024 (it usually represents a minibatch size), but the maximum size of the lists will usually be fairly small e.g. no more than 4 or so, as it represents the number of terms in a hand-coded summation expression.</p>
<p>The use of this function is in interpreting a command to set each row of a matrix to a sum of terms. Each pair represents an input term, interpreted as (index-of-matrix, row-index), which represents a vector that will form part of the sum.</p>
<p>It would be possible to simply pad at the end with (-1, -1), but this function also makes an attempt to pad more carefully so that for the most part, each output vector of pairs has inputs from only one matrix, i.e. the pair.first values are all the same. This will allow us to use a potentially more efficient command in the compiled code. It doesn't have to be 100% optimal. Note: in the most common case, all the lists will have the same length and padding will not be necessary at all.</p>
<p>See documentation here: <a class="el" href="dnn3_code_compilation.html#dnn3_compile_compiler_split_locations">Forward computation for Descriptors (SplitLocations)</a> </p>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00337">337</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils_8cc_source.html#l00113">ComputeSubmatIndexHistogram()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00087">SortSubmatLists()</a>, and <a class="el" href="nnet-compile-utils_8cc_source.html#l00243">SplitLocationsUsingSubmatHistogram()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00799">Compiler::CompileForwardFromSubmatLocationsList()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00498">SplitLocationsBackward()</a>, and <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00275">UnitTestSplitLocations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                                                {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// a histogram of the submat_indexes in the submat_lists</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">// each occurence in a given submat_list is considered unique so we maintain</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">// a vector to count each occurrence separately.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// The i&#39;th element in the vector corresponds to the count of</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// the (i+1)&#39;th occurrence of a submat_index in a submat_list</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  unordered_map&lt;int32, std::vector&lt;int32&gt; &gt; submat_histogram;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  int32 max_submat_list_size = 0;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// initializing a vector of list of pairs to store the sorted submat_lists</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  std::vector&lt;std::vector&lt; std::pair&lt;int32, int32&gt; &gt; &gt;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      sorted_submat_lists;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aed1893395273c5cb53ea3606c2bad94a">SortSubmatLists</a>(submat_lists, &amp;sorted_submat_lists, &amp;max_submat_list_size);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a602adf8e3c912ce0b74cbc5700255867">ComputeSubmatIndexHistogram</a>(sorted_submat_lists, &amp;submat_histogram);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// the vector has same information as the submat_histogram, but it is</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// suitable for sorting according to frequency. The first elements of pairs</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// can be repeated, these correspond to different occurrences in the same list</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; submat_histogram_vector;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">// copy the key, occurence_counts from submat_histogram to a vector</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  unordered_map&lt;int32, std::vector&lt;int32&gt; &gt;::iterator hist_iter;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">for</span> (hist_iter = submat_histogram.begin();</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;       hist_iter != submat_histogram.end();</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;       ++hist_iter) {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; (hist_iter-&gt;second).size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      submat_histogram_vector.push_back(</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          std::make_pair(hist_iter-&gt;first, (hist_iter-&gt;second)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ab45cba0a2a0446179a2741e19949afcd">SplitLocationsUsingSubmatHistogram</a>(max_submat_list_size, &amp;sorted_submat_lists,</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                     &amp;submat_histogram_vector, split_lists);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a602adf8e3c912ce0b74cbc5700255867"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a602adf8e3c912ce0b74cbc5700255867">kaldi::nnet3::ComputeSubmatIndexHistogram</a></div><div class="ttdeci">void ComputeSubmatIndexHistogram(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; sorted_submat_lists, unordered_map&lt; int32, std::vector&lt; int32 &gt; &gt; *submat_histogram)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00113">nnet-compile-utils.cc:113</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab45cba0a2a0446179a2741e19949afcd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab45cba0a2a0446179a2741e19949afcd">kaldi::nnet3::SplitLocationsUsingSubmatHistogram</a></div><div class="ttdeci">static void SplitLocationsUsingSubmatHistogram(int32 max_submat_list_size, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *submat_histogram_vector, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00243">nnet-compile-utils.cc:243</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aed1893395273c5cb53ea3606c2bad94a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aed1893395273c5cb53ea3606c2bad94a">kaldi::nnet3::SortSubmatLists</a></div><div class="ttdeci">void SortSubmatLists(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, int32 *max_submat_list_size)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00087">nnet-compile-utils.cc:87</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a230b979419515f453ee5c8f2bc87a4dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a230b979419515f453ee5c8f2bc87a4dd">&#9670;&nbsp;</a></span>SplitLocationsBackward()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SplitLocationsBackward </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>split_lists</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function has the same interface as <a class="el" href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8" title="The input to this function is a vector of lists of pairs, and this function splits it up into a list ...">SplitLocations()</a>; however, it ensures certain additional properties of the output "split_lists", which are necessary because of the way it is used in backprop code. </p>
<p>For each sub-list sublist = (*split_lists)[i], the properties it ensures are: Either:</p><ul>
<li>all pairs in the list "sublist" are unique (except that the special pair (-1, -1) may be repeated), Or:</li>
<li>the .first values in the list "sublist" are all the same, and the .second have a special property [see the function HasContiguousProperty in <a class="el" href="nnet-compile_8cc.html">nnet-compile.cc</a>]- basically that if we list the .second elements, each unique number that appears there appears only in one contiguous range, e.g. the list [ 6 6 6 1 5 5 5 ] has this property, but [ 1 2 1 ] does not. (however, -1's are not subject to this limitation, so [ -1 4 -1 ] satisfies the property). This function ensures this property by first calling SplitLocations, and then doing further splitting as necessary to ensure the property. However, if as a result it needs to split any given initially-split list into more than 2 sub-lists, it will print a warning (once per process). If we have to split into too many lists it will generate inefficient computations, and we will need to extend the backprop code to support more general types of operation. If all elements of submat_lists are empty, the output split_lists will be the empty vector. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00498">498</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils_8cc_source.html#l00377">ConvertToIndexes()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00401">EnsureContiguousProperty()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00337">SplitLocations()</a>, and <a class="el" href="nnet-compile-utils_8cc_source.html#l00467">SplitPairList()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile_8cc_source.html#l00818">Compiler::CompileBackwardFromSubmatLocationsList()</a>, and <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00070">UnitTestSplitLocationsBackward()</a>.</p>
<div class="fragment"><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                                                {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; split_lists_intermediate;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">// Split the submat_lists</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8">SplitLocations</a>(submat_lists, &amp;split_lists_intermediate);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_lists_intermediate.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    int32 first_value;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    std::vector&lt;int32&gt; second_values;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">ConvertToIndexes</a>(split_lists_intermediate[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                         &amp;first_value, &amp;second_values)) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="comment">// the .first values in split_lists_intermediate[i] are all the same (or</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="comment">// equal to -1).</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">if</span> (first_value == -1) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="comment">// all the .first values were equal to -1.  this is like a NULL marker.</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      std::vector&lt;std::vector&lt;int32&gt; &gt; second_values_split;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a84ff5e289907fa63155ee9bec0f9c631">EnsureContiguousProperty</a>(second_values, &amp;second_values_split);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordflow">if</span> (second_values_split.size() == 1) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">// this branch is an optimization for speed.</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        split_lists-&gt;push_back(split_lists_intermediate[i]);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; second_values_split.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;          split_lists-&gt;resize(split_lists-&gt;size() + 1);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;input_list = second_values_split[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;          std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;output_list =</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;              split_lists-&gt;back();</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;          output_list.resize(input_list.size());</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          int32 size = input_list.size();</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;          <span class="keywordflow">for</span> (int32 k = 0; k &lt; size; k++) {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            int32 row = input_list[k];</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">if</span> (row == -1) output_list[k].first = -1;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">else</span> output_list[k].first = first_value;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            output_list[k].second = row;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;          }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="comment">// the .first values are not the same</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="comment">// splitting the list of pairs to ensure unique pairs, unless it is</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="comment">// (-1,-1)</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt; new_split_lists;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a1df4b00a6ceed8cc071e249ed8c931d0">SplitPairList</a>(split_lists_intermediate[i],</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    &amp;new_split_lists);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; new_split_lists.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)  {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        split_lists-&gt;push_back(new_split_lists[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae99488174e8dde27f8f30d91d61c0cd2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">kaldi::nnet3::ConvertToIndexes</a></div><div class="ttdeci">bool ConvertToIndexes(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;location_vector, int32 *first_value, std::vector&lt; int32 &gt; *second_values)</div><div class="ttdoc">If it is the case for some i &gt;= 0 that all the .first elements of &quot;location_vector&quot; are either i or -...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00377">nnet-compile-utils.cc:377</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7c81548b4f8146cd3447b10d556978a8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8">kaldi::nnet3::SplitLocations</a></div><div class="ttdeci">void SplitLocations(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</div><div class="ttdoc">The input to this function is a vector of lists of pairs, and this function splits it up into a list ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00337">nnet-compile-utils.cc:337</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1df4b00a6ceed8cc071e249ed8c931d0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1df4b00a6ceed8cc071e249ed8c931d0">kaldi::nnet3::SplitPairList</a></div><div class="ttdeci">void SplitPairList(std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</div><div class="ttdoc">This function splits a vector of pairs into a list of vectors of pairs. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00467">nnet-compile-utils.cc:467</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a84ff5e289907fa63155ee9bec0f9c631"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a84ff5e289907fa63155ee9bec0f9c631">kaldi::nnet3::EnsureContiguousProperty</a></div><div class="ttdeci">void EnsureContiguousProperty(const std::vector&lt; int32 &gt; &amp;indexes, std::vector&lt; std::vector&lt; int32 &gt; &gt; *indexes_out)</div><div class="ttdoc">This function takes a vector of indexes and splits it up into as separate vectors of the same size...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00401">nnet-compile-utils.cc:401</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab45cba0a2a0446179a2741e19949afcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab45cba0a2a0446179a2741e19949afcd">&#9670;&nbsp;</a></span>SplitLocationsUsingSubmatHistogram()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::SplitLocationsUsingSubmatHistogram </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>max_submat_list_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sorted_submat_lists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>submat_histogram_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>split_lists</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00243">243</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils_8cc_source.html#l00203">ExtractGivenPairsFromSubmatLists()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00224">ExtractLastPairFromSubmatLists()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00167">FindSubmatIndexInSubmatLists()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet-compile-utils_8cc_source.html#l00078">SecondElementComparator()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00337">SplitLocations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                                                 {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// sort the submat_histogram_vector based on second element of pair</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">// in descending order then first element of pair in descending order</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  std::sort(submat_histogram_vector-&gt;begin(),</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            submat_histogram_vector-&gt;end(), <a class="code" href="namespacekaldi_1_1nnet3.html#adfcccae5ab2f658419cedbd126f574f0">SecondElementComparator</a>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  int32 prev_max_remaining_submat_list_size = max_submat_list_size;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::iterator iter;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">for</span> (iter = submat_histogram_vector-&gt;begin();</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;       iter != submat_histogram_vector-&gt;end();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;       ++iter)  {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    std::pair&lt;int32, int32&gt; submat_index_and_count = *iter;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::iterator&gt;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        output_iterator_list;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    int32 max_remaining_submat_list_size = 0;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#abff8a093b516f579b1bce94a954f6e7c">FindSubmatIndexInSubmatLists</a>(submat_index_and_count.first,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                                 sorted_submat_lists,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                 &amp;output_iterator_list,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                 &amp;max_remaining_submat_list_size);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (max_remaining_submat_list_size</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        &lt; prev_max_remaining_submat_list_size)  {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="comment">// since we will have a smaller max_remaining_submat_list_size by</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">// splitting this submat_index into a seperate list,</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="comment">// we will split it;</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      std::vector&lt;std::pair&lt;int32, int32&gt; &gt; list_of_pairs;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ac3395b82092a47a75b581f5f4a55a503">ExtractGivenPairsFromSubmatLists</a>(output_iterator_list,</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                       sorted_submat_lists,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                       &amp;list_of_pairs);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      split_lists-&gt;push_back(list_of_pairs);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      prev_max_remaining_submat_list_size = max_remaining_submat_list_size;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// rearrange the remaining pairs into lists where</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// pairs with multiple first elements are allowed</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// Note : we don&#39;t yet know if there is any advantage of having multiple</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">// calls to the same submat in kAddRowsMulti. If this is actually helpful</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// then use the sorted_histogram_vector to first copy submat_indexes which</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// did not make it to kAddRows calls</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; prev_max_remaining_submat_list_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; list_of_pairs;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a078fe7414bf11ee4f33567cb85b2b202">ExtractLastPairFromSubmatLists</a>(sorted_submat_lists,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                   &amp;list_of_pairs);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    split_lists-&gt;push_back(list_of_pairs);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_abff8a093b516f579b1bce94a954f6e7c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abff8a093b516f579b1bce94a954f6e7c">kaldi::nnet3::FindSubmatIndexInSubmatLists</a></div><div class="ttdeci">void FindSubmatIndexInSubmatLists(int32 submat_index, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;::iterator &gt; *output_iterator_list, int32 *max_remaining_submat_list_size)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00167">nnet-compile-utils.cc:167</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_adfcccae5ab2f658419cedbd126f574f0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#adfcccae5ab2f658419cedbd126f574f0">kaldi::nnet3::SecondElementComparator</a></div><div class="ttdeci">bool SecondElementComparator(const std::pair&lt; int32, int32 &gt; &amp;first_pair, const std::pair&lt; int32, int32 &gt; &amp;second_pair)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00078">nnet-compile-utils.cc:78</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a078fe7414bf11ee4f33567cb85b2b202"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a078fe7414bf11ee4f33567cb85b2b202">kaldi::nnet3::ExtractLastPairFromSubmatLists</a></div><div class="ttdeci">static void ExtractLastPairFromSubmatLists(std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *list_of_pairs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00224">nnet-compile-utils.cc:224</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac3395b82092a47a75b581f5f4a55a503"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac3395b82092a47a75b581f5f4a55a503">kaldi::nnet3::ExtractGivenPairsFromSubmatLists</a></div><div class="ttdeci">void ExtractGivenPairsFromSubmatLists(std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt;::iterator &gt; &amp;input_iterator_list, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *sorted_submat_lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *list_of_pairs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00203">nnet-compile-utils.cc:203</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1df4b00a6ceed8cc071e249ed8c931d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1df4b00a6ceed8cc071e249ed8c931d0">&#9670;&nbsp;</a></span>SplitPairList()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::SplitPairList </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *&#160;</td>
          <td class="paramname"><em>split_lists</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function splits a vector of pairs into a list of vectors of pairs. </p>
<p>[note: by 'vector' we mean something that has a meaningful index that we care about; by 'list' we mean a collection of elements to be iterated over, without (in this case) meaningful indexes or even order.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">list</td><td>A vector of pairs; these pairs should be either (-1,-1) or (a,b) for a &gt;= 0, b &gt;= 0. At least one element of 'list' must be different from (-1,-1). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">split_lists</td><td>A list, in arbitrary order, of vectors of pairs. It has the following relationship with 'list':<ul>
<li>Size: for each j, split_lists[j].size() == list.size().</li>
<li>Contents must match input: For each i:<ul>
<li>If list[i] == (-1, -1), then split_lists[j][i] == (-1, -1) for all j.</li>
<li>If list[i] != (-1, -1), then split_lists[j][i] == (-1, -1) for *all but one* j, and for the remaining j, split_lists[j][i] == list[i].</li>
</ul>
</li>
<li>Uniqueness: for no j should split_lists[j] contain any duplicate elements (except the pair (-1,-1), which is allowed to exist in duplicate form). To satisfy the above conditions, this function will create as many lists in split_lists (i.e. as many j values) as the number of times that the most frequent pair in 'list' repeats other than the pair (-1,-1), e.g. if the pair (10,11) appears 4 times in 'list' and that is the most, split_lists-&gt;size() == 4. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils_8cc_source.html#l00467">467</a> of file <a class="el" href="nnet-compile-utils_8cc_source.html">nnet-compile-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils_8cc_source.html#l00498">SplitLocationsBackward()</a>.</p>
<div class="fragment"><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                                                               {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  split_lists-&gt;clear();</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keyword">typedef</span> unordered_map&lt;std::pair&lt;int32, int32&gt;,</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        int32, PairHasher&lt;int32&gt; &gt; MapType;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="comment">// this maps a pair not equal to -1,-1, to the number of times we&#39;ve already seen it.</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  MapType pair_to_count;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  int32 cur_num_lists = 0;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; list.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (list[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first == -1)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    MapType::iterator iter = pair_to_count.find(list[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    int32 this_count;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (iter == pair_to_count.end())</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      pair_to_count[list[i]] = this_count = 1;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      this_count = (++iter-&gt;second);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">if</span> (this_count &gt; cur_num_lists) {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(this_count == cur_num_lists + 1);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      split_lists-&gt;resize(this_count);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      split_lists-&gt;back().resize(list.size(),</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                 std::pair&lt;int32, int32&gt;(-1, -1));</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      cur_num_lists++;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    (*split_lists)[this_count-1][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = list[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (split_lists-&gt;size() == 0)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Input list has just dummy pairs&quot;</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acd48d2ca65dc0a73952effbec24ccfb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd48d2ca65dc0a73952effbec24ccfb1">&#9670;&nbsp;</a></span>SplitRowOps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> SplitRowOps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function detects cases where commands of type kAddRowsMulti, kAddToRowsMulti, kCopyRowsMulti, kCopyToRowsMulti use indexes that correspond to at most two submatrices, in two distinct ranges without gaps filled by -1's, and could be converted to at most two commands of type kMatrixAdd, kMatrixCopy, kAddRows or kCopyRows. </p>
<p>(Note: it's important that this optimization takes place after SnipRowOps, because it doesn't remove the -1's from the edges of the indexes, it relies on that operation doing so). The "without-gaps" stipulation is just for convenience of implementation, to have fewer cases to worry about.</p>
<p>This function returns true if it made any changes to the computation; if it returns true, then after calling this you should at some point do <a class="el" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f" title="This function detects submatrices and matrices that are never used (e.g. ">RenumberComputation()</a>, which will remove any now-unused members of computation-&gt;indexes. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l02894">2894</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l02584">RowOpsSplitter::Split()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;                                               {</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  RowOpsSplitter splitter(computation);</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;  <span class="keywordflow">return</span> splitter.Split();</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ab2468421b230db50c66c8d40975205c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2468421b230db50c66c8d40975205c3">&#9670;&nbsp;</a></span>SummarizeVector() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string SummarizeVector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a string that summarizes a vector fairly succintly, for printing stats in info lines. </p>
<p>For example: "[percentiles(0,1,2,5 10,20,50,80,90 95,98,99,100)=(0.001,0.003,0.003,0.004 \
   0.005,0.01,0.07,0.11,0.14 0.18,0.24,0.29,0.39), mean=0.0745, stddev=0.0611]" </p>

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00484">484</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-parse_8cc_source.html#l00467">PrintFloatSuccinctly()</a>, <a class="el" href="text-utils_8h_source.html#l00068">kaldi::SplitStringToIntegers()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00037">kaldi::VecVec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-normalize-component_8cc_source.html#l00268">BatchNormComponent::Info()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00400">NonlinearComponent::Info()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05645">LstmNonlinearityComponent::Info()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00547">PrintParameterStats()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00520">SummarizeVector()</a>, and <a class="el" href="nnet-parse-test_8cc_source.html#l00242">UnitTestSummarizeVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                                                        {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">if</span> (vec.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() &lt; 10) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;[ &quot;</span>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; vec.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a55b3c5fd7a70b59070dfec3be993ff80">PrintFloatSuccinctly</a>(os, vec(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      os &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// print out mean and standard deviation, and some selected values.</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> mean = vec.<a class="code" href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>() / vec.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(),</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        stddev = sqrt(<a class="code" href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">VecVec</a>(vec, vec) / vec.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() - mean * mean);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    std::string percentiles_str = <span class="stringliteral">&quot;0,1,2,5 10,20,50,80,90 95,98,99,100&quot;</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    std::vector&lt;int32&gt; percentiles;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordtype">bool</span> ans = <a class="code" href="namespacekaldi.html#ae95740f87fc2fb79419753e21396c647">SplitStringToIntegers</a>(percentiles_str, <span class="stringliteral">&quot;, &quot;</span>, <span class="keyword">false</span>,</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                     &amp;percentiles);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;[percentiles(&quot;</span> &lt;&lt; percentiles_str &lt;&lt; <span class="stringliteral">&quot;)=(&quot;</span>;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    Vector&lt;BaseFloat&gt; vec_sorted(vec);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    std::sort(vec_sorted.Data(), vec_sorted.Data() + vec_sorted.Dim());</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = vec.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() - 1;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; percentiles.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      int32 percentile = percentiles[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> value = vec_sorted((n * percentile) / 100);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a55b3c5fd7a70b59070dfec3be993ff80">PrintFloatSuccinctly</a>(os, value);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 &lt; percentiles.size())</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        os &lt;&lt; (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 3 || <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 8 ? <span class="charliteral">&#39; &#39;</span> : <span class="charliteral">&#39;,&#39;</span>);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    os &lt;&lt; std::setprecision(3);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;), mean=&quot;</span> &lt;&lt; mean &lt;&lt; <span class="stringliteral">&quot;, stddev=&quot;</span> &lt;&lt; stddev &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">return</span> os.str();</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ae95740f87fc2fb79419753e21396c647"><div class="ttname"><a href="namespacekaldi.html#ae95740f87fc2fb79419753e21396c647">kaldi::SplitStringToIntegers</a></div><div class="ttdeci">bool SplitStringToIntegers(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; I &gt; *out)</div><div class="ttdoc">Split a string (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00068">text-utils.h:68</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_ae7089fd656218302336300dc42ae55c1"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">kaldi::VectorBase::Sum</a></div><div class="ttdeci">Real Sum() const</div><div class="ttdoc">Returns sum of the elements. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00693">kaldi-vector.cc:693</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a55b3c5fd7a70b59070dfec3be993ff80"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a55b3c5fd7a70b59070dfec3be993ff80">kaldi::nnet3::PrintFloatSuccinctly</a></div><div class="ttdeci">static void PrintFloatSuccinctly(std::ostream &amp;os, BaseFloat f)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00467">nnet-parse.cc:467</a></div></div>
<div class="ttc" id="group__matrix__funcs__scalar_html_ga4750cd6f7a02a013435779588056b153"><div class="ttname"><a href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">kaldi::VecVec</a></div><div class="ttdeci">Real VecVec(const VectorBase&lt; Real &gt; &amp;a, const VectorBase&lt; Real &gt; &amp;b)</div><div class="ttdoc">Returns dot product between v1 and v2. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00037">kaldi-vector.cc:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a999cb66904d782669117981b27dffa21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a999cb66904d782669117981b27dffa21">&#9670;&nbsp;</a></span>SummarizeVector() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string SummarizeVector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00520">520</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-parse_8cc_source.html#l00484">SummarizeVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                                                         {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  Vector&lt;BaseFloat&gt; vec_copy(vec);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">SummarizeVector</a>(vec_copy);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a6f8b12eaddd9c81766f37c1bdea637ca"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">kaldi::nnet3::SummarizeVector</a></div><div class="ttdeci">std::string SummarizeVector(const CuVectorBase&lt; BaseFloat &gt; &amp;cu_vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00525">nnet-parse.cc:525</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f8b12eaddd9c81766f37c1bdea637ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f8b12eaddd9c81766f37c1bdea637ca">&#9670;&nbsp;</a></span>SummarizeVector() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string SummarizeVector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>cu_vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse_8cc_source.html#l00525">525</a> of file <a class="el" href="nnet-parse_8cc_source.html">nnet-parse.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-parse_8cc_source.html#l00484">SummarizeVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                                                                 {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  Vector&lt;BaseFloat&gt; vec(cu_vec);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">SummarizeVector</a>(vec);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a6f8b12eaddd9c81766f37c1bdea637ca"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6f8b12eaddd9c81766f37c1bdea637ca">kaldi::nnet3::SummarizeVector</a></div><div class="ttdeci">std::string SummarizeVector(const CuVectorBase&lt; BaseFloat &gt; &amp;cu_vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00525">nnet-parse.cc:525</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a49f9f182fa8dc05d6672c4b7fcad737f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49f9f182fa8dc05d6672c4b7fcad737f">&#9670;&nbsp;</a></span>SumVectorSizes() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::SumVectorSizes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation-graph_8cc_source.html#l01257">1257</a> of file <a class="el" href="nnet-computation-graph_8cc_source.html">nnet-computation-graph.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation-graph_8cc_source.html#l01425">ComputeComputationPhases()</a>, and <a class="el" href="nnet-computation-graph_8cc_source.html#l01266">SumVectorSizes()</a>.</p>
<div class="fragment"><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                                                                     {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt;::const_iterator iter = vec.begin(),</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      end = vec.end();</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter)</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    ans += iter-&gt;size();</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a8b3c3728dced52837e749f0d4d4f3b40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b3c3728dced52837e749f0d4d4f3b40">&#9670;&nbsp;</a></span>SumVectorSizes() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet3::SumVectorSizes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-computation-graph_8cc_source.html#l01266">1266</a> of file <a class="el" href="nnet-computation-graph_8cc_source.html">nnet-computation-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet-computation-graph_8cc_source.html#l01257">SumVectorSizes()</a>.</p>
<div class="fragment"><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                                                                                 {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; vec.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    ans += <a class="code" href="namespacekaldi_1_1nnet3.html#a8b3c3728dced52837e749f0d4d4f3b40">SumVectorSizes</a>(vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a8b3c3728dced52837e749f0d4d4f3b40"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8b3c3728dced52837e749f0d4d4f3b40">kaldi::nnet3::SumVectorSizes</a></div><div class="ttdeci">static int32 SumVectorSizes(const std::vector&lt; std::vector&lt; std::vector&lt; int32 &gt; &gt; &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation-graph_8cc_source.html#l01266">nnet-computation-graph.cc:1266</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a145f09473f55df6f338ac4d69cff8bf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a145f09473f55df6f338ac4d69cff8bf1">&#9670;&nbsp;</a></span>TarjanSccRecursive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TarjanSccRecursive </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>global_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1TarjanNode.html">TarjanNode</a> &gt; *&#160;</td>
          <td class="paramname"><em>tarjan_nodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>tarjan_stack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; int32 &gt; &gt; *&#160;</td>
          <td class="paramname"><em>sccs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph_8cc_source.html#l00085">85</a> of file <a class="el" href="nnet-graph_8cc_source.html">nnet-graph.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-graph_8cc_source.html#l00079">TarjanNode::index</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-graph_8cc_source.html#l00080">TarjanNode::lowlink</a>, and <a class="el" href="nnet-graph_8cc_source.html#l00081">TarjanNode::on_stack</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph_8cc_source.html#l00138">FindSccsTarjan()</a>.</p>
<div class="fragment"><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                                            {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sccs != NULL);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tarjan_nodes != NULL);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tarjan_stack != NULL);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(global_index != NULL);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(node &gt;= 0 &amp;&amp; node &lt; graph.size());</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// Initializes the current Tarjan node.</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  (*tarjan_nodes)[node].index = *global_index;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  (*tarjan_nodes)[node].lowlink = *global_index;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  *global_index += 1;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  (*tarjan_nodes)[node].on_stack = <span class="keyword">true</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  tarjan_stack-&gt;push_back(node);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// DFS from the current node.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; graph[node].size(); ++<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    int32 next = graph[node][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> ((*tarjan_nodes)[next].index == -1) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="comment">// First time we see this node.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a145f09473f55df6f338ac4d69cff8bf1">TarjanSccRecursive</a>(next, graph,</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                         global_index, tarjan_nodes, tarjan_stack, sccs);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      (*tarjan_nodes)[node].lowlink = std::min((*tarjan_nodes)[node].lowlink,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                               (*tarjan_nodes)[next].lowlink);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*tarjan_nodes)[next].on_stack) {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="comment">// Next node is on the stack -- back edge. We can&#39;t use the lowlink of</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="comment">// next node, because that may point to the index of the root, while the</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="comment">// current node can&#39;t be the root.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      (*tarjan_nodes)[node].lowlink = std::min((*tarjan_nodes)[node].lowlink,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                               (*tarjan_nodes)[next].index);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// Output SCC.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">if</span> ((*tarjan_nodes)[node].index == (*tarjan_nodes)[node].lowlink) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    std::vector&lt;int32&gt; scc;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    int32 pop_node;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      pop_node = tarjan_stack-&gt;back();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      tarjan_stack-&gt;pop_back();</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      (*tarjan_nodes)[pop_node].on_stack = <span class="keyword">false</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      scc.push_back(pop_node);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    } <span class="keywordflow">while</span> (pop_node != node);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(pop_node == node);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    sccs-&gt;push_back(scc);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a145f09473f55df6f338ac4d69cff8bf1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a145f09473f55df6f338ac4d69cff8bf1">kaldi::nnet3::TarjanSccRecursive</a></div><div class="ttdeci">void TarjanSccRecursive(int32 node, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, int32 *global_index, std::vector&lt; TarjanNode &gt; *tarjan_nodes, std::vector&lt; int32 &gt; *tarjan_stack, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00085">nnet-graph.cc:85</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a554b097cfc8c22c7fe43dec7ceca8839"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a554b097cfc8c22c7fe43dec7ceca8839">&#9670;&nbsp;</a></span>TestNnetComponentAddScale()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TestNnetComponentAddScale </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00076">76</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-component-itf_8h_source.html#l00370">Component::Add()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00039">CheckStringsApproxEqual()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00190">Component::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00360">Component::Scale()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                                             {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c2 = c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c3 = c2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>();</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  c3-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aab16938236bd0978bad5de6d56fcf47f">Add</a>(0.5, *c2);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  c2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">Scale</a>(1.5);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">CheckStringsApproxEqual</a>(c2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>(), c3-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>()));</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keyword">delete</span> c2;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keyword">delete</span> c3;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_aa46d9c7de00be8203e16a6e55af0afef"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">kaldi::nnet3::Component::Copy</a></div><div class="ttdeci">virtual Component * Copy() const =0</div><div class="ttdoc">Copies component (deep copy). </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a750ca3e44a00898afea53b54697226ba"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">kaldi::nnet3::Component::Scale</a></div><div class="ttdeci">virtual void Scale(BaseFloat scale)</div><div class="ttdoc">This virtual function when called on – an UpdatableComponent scales the parameters by &quot;scale&quot; when c...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00360">nnet-component-itf.h:360</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3dcc4499fe158f988c4b26b757b213e9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">kaldi::nnet3::CheckStringsApproxEqual</a></div><div class="ttdeci">bool CheckStringsApproxEqual(const std::string &amp;a, const std::string &amp;b, int32 tolerance=3)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00039">nnet-component-test.cc:39</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::Component::Info</a></div><div class="ttdeci">virtual std::string Info() const</div><div class="ttdoc">Returns some text-form information about this component, for diagnostics. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8cc_source.html#l00190">nnet-component-itf.cc:190</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_aab16938236bd0978bad5de6d56fcf47f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#aab16938236bd0978bad5de6d56fcf47f">kaldi::nnet3::Component::Add</a></div><div class="ttdeci">virtual void Add(BaseFloat alpha, const Component &amp;other)</div><div class="ttdoc">This virtual function when called by – an UpdatableComponent adds the parameters of another updatabl...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00370">nnet-component-itf.h:370</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af7d4b74958e0a63a4e52bef63e71f394"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7d4b74958e0a63a4e52bef63e71f394">&#9670;&nbsp;</a></span>TestNnetComponentCopy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TestNnetComponentCopy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00067">67</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00190">Component::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="text-utils_8cc_source.html#l00335">kaldi::StringsApproxEqual()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                                         {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c2 = c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39775d63fc4873bac0e3b3009b275547">StringsApproxEqual</a>(c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>(), c2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>())) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expected info strings to be equal: &#39;&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;              &lt;&lt; c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>() &lt;&lt; <span class="stringliteral">&quot;&#39; vs. &#39;&quot;</span> &lt;&lt; c2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keyword">delete</span> c2;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_aa46d9c7de00be8203e16a6e55af0afef"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">kaldi::nnet3::Component::Copy</a></div><div class="ttdeci">virtual Component * Copy() const =0</div><div class="ttdoc">Copies component (deep copy). </div></div>
<div class="ttc" id="namespacekaldi_html_a39775d63fc4873bac0e3b3009b275547"><div class="ttname"><a href="namespacekaldi.html#a39775d63fc4873bac0e3b3009b275547">kaldi::StringsApproxEqual</a></div><div class="ttdeci">bool StringsApproxEqual(const std::string &amp;a, const std::string &amp;b, int32 decimal_places_tolerance)</div><div class="ttdoc">This function returns true when two text strings are approximately equal, and false when they are not...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00335">text-utils.cc:335</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::Component::Info</a></div><div class="ttdeci">virtual std::string Info() const</div><div class="ttdoc">Returns some text-form information about this component, for diagnostics. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8cc_source.html#l00190">nnet-component-itf.cc:190</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aee5e219c905cd82d682bc00a0de72d74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee5e219c905cd82d682bc00a0de72d74">&#9670;&nbsp;</a></span>TestNnetComponentIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TestNnetComponentIo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00052">52</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component-test_8cc_source.html#l00039">CheckStringsApproxEqual()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00081">Component::ReadNew()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a852bc7306aaa45b284f662f1ddb1a3d5">Component::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                       {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  std::ostringstream os1;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a852bc7306aaa45b284f662f1ddb1a3d5">Write</a>(os1, binary);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  std::istringstream is(os1.str());</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c2 = Component::ReadNew(is, binary);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  std::ostringstream os2;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  c2-&gt;Write(os2, binary);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> (!binary) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    std::string s1 = os1.str(), s2 = os2.str();</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">CheckStringsApproxEqual</a>(s1, s2));</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">delete</span> c2;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a852bc7306aaa45b284f662f1ddb1a3d5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a852bc7306aaa45b284f662f1ddb1a3d5">kaldi::nnet3::Component::Write</a></div><div class="ttdeci">virtual void Write(std::ostream &amp;os, bool binary) const =0</div><div class="ttdoc">Write component to stream. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3dcc4499fe158f988c4b26b757b213e9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">kaldi::nnet3::CheckStringsApproxEqual</a></div><div class="ttdeci">bool CheckStringsApproxEqual(const std::string &amp;a, const std::string &amp;b, int32 tolerance=3)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00039">nnet-component-test.cc:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0b28b95264b6db2e9ce5658f8f939a8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b28b95264b6db2e9ce5658f8f939a8b">&#9670;&nbsp;</a></span>TestNnetComponentUpdatable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TestNnetComponentUpdatable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00109">109</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component-test_8cc_source.html#l00039">CheckStringsApproxEqual()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00324">UpdatableComponent::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00530">UpdatableComponent::NumParameters()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00360">Component::Scale()</a>, <a class="el" href="text-utils_8cc_source.html#l00335">kaldi::StringsApproxEqual()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00037">kaldi::VecVec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                                              {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>))</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(c);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">if</span> (uc == NULL) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!(c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) &amp;&amp;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                 <span class="stringliteral">&quot;Component returns updatable flag but does not inherit &quot;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                 <span class="stringliteral">&quot;from UpdatableComponent&quot;</span>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">if</span>(!(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>)){</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// testing that if it declares itself as non-updatable,</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// Scale() and Add() have no effect.</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#abeffcf34bc1f700bf19a8a28fdf2ed95">NumParameters</a>() == 0);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*uc) == 0);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc2 = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>());</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">Scale</a>(7.0);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    uc2-&gt;Add(3.0, *uc);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">CheckStringsApproxEqual</a>(uc2-&gt;Info(), uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a245d65d566725422b859c99bff7623f8">Info</a>()));</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">Scale</a>(0.0);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">CheckStringsApproxEqual</a>(uc2-&gt;Info(), uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a245d65d566725422b859c99bff7623f8">Info</a>()));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">delete</span> uc2;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#abeffcf34bc1f700bf19a8a28fdf2ed95">NumParameters</a>() != 0);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc2 = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>()),</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        *uc3 = dynamic_cast&lt;UpdatableComponent*&gt;(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>());</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// testing some expected invariances of scale and add.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">Scale</a>(5.0);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    uc2-&gt;Add(3.0, *uc3);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    uc3-&gt;Scale(8.0);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// now they should both be scaled to 8 times the original component.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39775d63fc4873bac0e3b3009b275547">StringsApproxEqual</a>(uc2-&gt;Info(), uc3-&gt;Info())) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expected info strings to be equal: &#39;&quot;</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                &lt;&lt; uc2-&gt;Info() &lt;&lt; <span class="stringliteral">&quot;&#39; vs. &#39;&quot;</span> &lt;&lt; uc3-&gt;Info() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// testing that scaling by 0.5 works the same whether</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// done on the vectorized paramters or via Scale().</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> vec2(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#abeffcf34bc1f700bf19a8a28fdf2ed95">NumParameters</a>());</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    uc2-&gt;Vectorize(&amp;vec2);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    vec2.<a class="code" href="classkaldi_1_1VectorBase.html#a3de2c6ff761b6879aae381fcfdfa36e6">Scale</a>(0.5);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    uc2-&gt;UnVectorize(vec2);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    uc3-&gt;Scale(0.5);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">CheckStringsApproxEqual</a>(uc2-&gt;Info(), uc3-&gt;Info()));</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// testing that Scale(0.0) works the same whether done on the vectorized</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// paramters or via SetZero(), and that unvectorizing something that&#39;s been</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// zeroed gives us zero parameters.</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    uc2-&gt;Vectorize(&amp;vec2);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    vec2.SetZero();</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    uc2-&gt;UnVectorize(vec2);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    uc3-&gt;Scale(0.0);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    uc3-&gt;Vectorize(&amp;vec2);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(uc2-&gt;Info() == uc3-&gt;Info() &amp;&amp; <a class="code" href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">VecVec</a>(vec2, vec2) == 0.0);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keyword">delete</span> uc2;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">delete</span> uc3;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_aa46d9c7de00be8203e16a6e55af0afef"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">kaldi::nnet3::Component::Copy</a></div><div class="ttdeci">virtual Component * Copy() const =0</div><div class="ttdoc">Copies component (deep copy). </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_abeffcf34bc1f700bf19a8a28fdf2ed95"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#abeffcf34bc1f700bf19a8a28fdf2ed95">kaldi::nnet3::UpdatableComponent::NumParameters</a></div><div class="ttdeci">virtual int32 NumParameters() const</div><div class="ttdoc">The following new virtual function returns the total dimension of the parameters in this class...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00530">nnet-component-itf.h:530</a></div></div>
<div class="ttc" id="namespacekaldi_html_a39775d63fc4873bac0e3b3009b275547"><div class="ttname"><a href="namespacekaldi.html#a39775d63fc4873bac0e3b3009b275547">kaldi::StringsApproxEqual</a></div><div class="ttdeci">bool StringsApproxEqual(const std::string &amp;a, const std::string &amp;b, int32 decimal_places_tolerance)</div><div class="ttdoc">This function returns true when two text strings are approximately equal, and false when they are not...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00335">text-utils.cc:335</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a750ca3e44a00898afea53b54697226ba"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">kaldi::nnet3::Component::Scale</a></div><div class="ttdeci">virtual void Scale(BaseFloat scale)</div><div class="ttdoc">This virtual function when called on – an UpdatableComponent scales the parameters by &quot;scale&quot; when c...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00360">nnet-component-itf.h:360</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_ac0697192d76083f84fc989f67fbee5e9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">kaldi::nnet3::UpdatableComponent::DotProduct</a></div><div class="ttdeci">virtual BaseFloat DotProduct(const UpdatableComponent &amp;other) const =0</div><div class="ttdoc">Computes dot-product between parameters of two instances of a Component. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3dcc4499fe158f988c4b26b757b213e9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">kaldi::nnet3::CheckStringsApproxEqual</a></div><div class="ttdeci">bool CheckStringsApproxEqual(const std::string &amp;a, const std::string &amp;b, int32 tolerance=3)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00039">nnet-component-test.cc:39</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_a3de2c6ff761b6879aae381fcfdfa36e6"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#a3de2c6ff761b6879aae381fcfdfa36e6">kaldi::VectorBase::Scale</a></div><div class="ttdeci">void Scale(Real alpha)</div><div class="ttdoc">Multiplies all elements by this constant. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00962">kaldi-vector.cc:962</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">kaldi::nnet3::UpdatableComponent</a></div><div class="ttdoc">Class UpdatableComponent is a Component which has trainable parameters; it extends the interface of C...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00455">nnet-component-itf.h:455</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::UpdatableComponent::Info</a></div><div class="ttdeci">virtual std::string Info() const</div><div class="ttdoc">Returns some text-form information about this component, for diagnostics. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8cc_source.html#l00324">nnet-component-itf.cc:324</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__matrix__funcs__scalar_html_ga4750cd6f7a02a013435779588056b153"><div class="ttname"><a href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">kaldi::VecVec</a></div><div class="ttdeci">Real VecVec(const VectorBase&lt; Real &gt; &amp;a, const VectorBase&lt; Real &gt; &amp;b)</div><div class="ttdoc">Returns dot product between v1 and v2. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00037">kaldi-vector.cc:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a179079a64f06a09c80c757753016b094"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a179079a64f06a09c80c757753016b094">&#9670;&nbsp;</a></span>TestNnetComponentVectorizeUnVectorize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TestNnetComponentVectorizeUnVectorize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00086">86</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00039">CheckStringsApproxEqual()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00324">UpdatableComponent::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00530">UpdatableComponent::NumParameters()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00360">Component::Scale()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00537">UpdatableComponent::UnVectorize()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00535">UpdatableComponent::Vectorize()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                                                         {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>))</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(c);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(uc != NULL);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc2 = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>());</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">Scale</a>(0.0);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> params(uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#abeffcf34bc1f700bf19a8a28fdf2ed95">NumParameters</a>());</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a5b2b163b2a360e5614e308eaabb169f9">Vectorize</a>(&amp;params);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.Min()==0.0 &amp;&amp; params.Sum()==0.0);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a5b2b163b2a360e5614e308eaabb169f9">Vectorize</a>(&amp;params);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a0d6ac2b7329981543aa1299d94c9556d">UnVectorize</a>(params);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">CheckStringsApproxEqual</a>(uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a245d65d566725422b859c99bff7623f8">Info</a>(), uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a245d65d566725422b859c99bff7623f8">Info</a>()));</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> x = uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*uc2), y = uc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*uc),</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      z = uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*uc);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(x, y) &amp;&amp; <a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(y, z));</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> params2(uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#abeffcf34bc1f700bf19a8a28fdf2ed95">NumParameters</a>());</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  uc2-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a5b2b163b2a360e5614e308eaabb169f9">Vectorize</a>(&amp;params2);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; params.Dim(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) == params2(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keyword">delete</span> uc2;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_aa46d9c7de00be8203e16a6e55af0afef"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">kaldi::nnet3::Component::Copy</a></div><div class="ttdeci">virtual Component * Copy() const =0</div><div class="ttdoc">Copies component (deep copy). </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_abeffcf34bc1f700bf19a8a28fdf2ed95"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#abeffcf34bc1f700bf19a8a28fdf2ed95">kaldi::nnet3::UpdatableComponent::NumParameters</a></div><div class="ttdeci">virtual int32 NumParameters() const</div><div class="ttdoc">The following new virtual function returns the total dimension of the parameters in this class...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00530">nnet-component-itf.h:530</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_a5b2b163b2a360e5614e308eaabb169f9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a5b2b163b2a360e5614e308eaabb169f9">kaldi::nnet3::UpdatableComponent::Vectorize</a></div><div class="ttdeci">virtual void Vectorize(VectorBase&lt; BaseFloat &gt; *params) const</div><div class="ttdoc">Turns the parameters into vector form. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00535">nnet-component-itf.h:535</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a750ca3e44a00898afea53b54697226ba"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">kaldi::nnet3::Component::Scale</a></div><div class="ttdeci">virtual void Scale(BaseFloat scale)</div><div class="ttdoc">This virtual function when called on – an UpdatableComponent scales the parameters by &quot;scale&quot; when c...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00360">nnet-component-itf.h:360</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_ac0697192d76083f84fc989f67fbee5e9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">kaldi::nnet3::UpdatableComponent::DotProduct</a></div><div class="ttdeci">virtual BaseFloat DotProduct(const UpdatableComponent &amp;other) const =0</div><div class="ttdoc">Computes dot-product between parameters of two instances of a Component. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3dcc4499fe158f988c4b26b757b213e9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3dcc4499fe158f988c4b26b757b213e9">kaldi::nnet3::CheckStringsApproxEqual</a></div><div class="ttdeci">bool CheckStringsApproxEqual(const std::string &amp;a, const std::string &amp;b, int32 tolerance=3)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00039">nnet-component-test.cc:39</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">kaldi::nnet3::UpdatableComponent</a></div><div class="ttdoc">Class UpdatableComponent is a Component which has trainable parameters; it extends the interface of C...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00455">nnet-component-itf.h:455</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_a0d6ac2b7329981543aa1299d94c9556d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a0d6ac2b7329981543aa1299d94c9556d">kaldi::nnet3::UpdatableComponent::UnVectorize</a></div><div class="ttdeci">virtual void UnVectorize(const VectorBase&lt; BaseFloat &gt; &amp;params)</div><div class="ttdoc">Converts the parameters from vector form. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00537">nnet-component-itf.h:537</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::UpdatableComponent::Info</a></div><div class="ttdeci">virtual std::string Info() const</div><div class="ttdoc">Returns some text-form information about this component, for diagnostics. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8cc_source.html#l00324">nnet-component-itf.cc:324</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3aff0be4a71c5f484a787d889f5d6be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3aff0be4a71c5f484a787d889f5d6be">&#9670;&nbsp;</a></span>TestNnetDecodable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TestNnetDecodable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00080">80</a> of file <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html">nnet-compute-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00805">VectorBase&lt; Real &gt;::ApplyExp()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="nnet-am-decodable-simple_8h_source.html#l00049">NnetSimpleComputationOptions::frames_per_chunk</a>, <a class="el" href="nnet-am-decodable-simple_8cc_source.html#l00171">DecodableNnetSimple::GetOutputForFrame()</a>, <a class="el" href="decodable-simple-looped_8cc_source.html#l00119">DecodableNnetSimpleLooped::GetOutputForFrame()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00821">Nnet::Info()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00669">Nnet::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-utils_8cc_source.html#l01347">NnetIsRecurrent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00677">Nnet::OutputDim()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00555">SetBatchnormTestMode()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00564">SetDropoutTestMode()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00301">VectorBase&lt; Real &gt;::SetRandn()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                   {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  int32 num_frames = 5 + <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100),</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      input_dim = nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aed4b9f82edbecf5629a61afe586838bf">InputDim</a>(<span class="stringliteral">&quot;input&quot;</span>),</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      output_dim = nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a8a6a18ddf875235b4e75f0670bfba421">OutputDim</a>(<span class="stringliteral">&quot;output&quot;</span>),</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      ivector_dim = std::max&lt;int32&gt;(0, nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aed4b9f82edbecf5629a61afe586838bf">InputDim</a>(<span class="stringliteral">&quot;ivector&quot;</span>));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> input(num_frames, input_dim);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ac8f15bc7a244b05a3f04e15d562043dc">SetBatchnormTestMode</a>(<span class="keyword">true</span>, nnet);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#af9757843e049a91502f6fa39782b1ffc">SetDropoutTestMode</a>(<span class="keyword">true</span>, nnet);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  input.SetRandn();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> ivector(ivector_dim);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  ivector.SetRandn();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> priors(<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? output_dim : 0);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> (priors.Dim() != 0) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    priors.SetRandn();</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    priors.ApplyExp();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> output1(num_frames, output_dim),</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      output2(num_frames, output_dim);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetSimpleComputationOptions.html">NnetSimpleComputationOptions</a> opts;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    opts.<a class="code" href="structkaldi_1_1nnet3_1_1NnetSimpleComputationOptions.html#ab1d720abcb203912db2b8bdc8e7bf4d4">frames_per_chunk</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(5, 25);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">CachingOptimizingCompiler</a> compiler(*nnet);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1DecodableNnetSimple.html">DecodableNnetSimple</a> decodable(opts, *nnet, priors, input, &amp;compiler,</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                  (ivector_dim != 0 ? &amp;ivector : NULL));</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">for</span> (int32 t = 0; t &lt; num_frames; t++) {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> row(output1, t);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      decodable.GetOutputForFrame(t, &amp;row);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetSimpleLoopedComputationOptions.html">NnetSimpleLoopedComputationOptions</a> opts;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// caution: this may modify nnet, by changing how it consumes iVectors.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLoopedInfo.html">DecodableNnetSimpleLoopedInfo</a> info(opts, priors, nnet);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLooped.html">DecodableNnetSimpleLooped</a> decodable(info, input,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                        (ivector_dim != 0 ? &amp;ivector : NULL));</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">for</span> (int32 t = 0; t &lt; num_frames; t++) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> row(output2, t);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      decodable.GetOutputForFrame(t, &amp;row);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// the components that we exclude from this test, are excluded because they</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// all take &quot;optional&quot; right context, and this destroys the equivalence that</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// we are testing.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a4cda4da2254dd2dfe1800e4dfeebec38">NnetIsRecurrent</a>(*nnet) &amp;&amp;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">Info</a>().find(<span class="stringliteral">&quot;statistics-extraction&quot;</span>) == std::string::npos &amp;&amp;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">Info</a>().find(<span class="stringliteral">&quot;TimeHeightConvolutionComponent&quot;</span>) == std::string::npos &amp;&amp;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      nnet-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">Info</a>().find(<span class="stringliteral">&quot;RestrictedAttentionComponent&quot;</span>) == std::string::npos) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// this equivalence will not hold for recurrent nnets, or those that</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// have the statistics-extraction/statistics-pooling layers,</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// or in general for nnets with convolution components (because these</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// might have &#39;optional&#39; context if required-time-offsets != time-offsets.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">for</span> (int32 t = 0; t &lt; num_frames; t++) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> row1(output1, t),</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          row2(output2, t);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(row1.ApproxEqual(row2));</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aed4b9f82edbecf5629a61afe586838bf"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aed4b9f82edbecf5629a61afe586838bf">kaldi::nnet3::Nnet::InputDim</a></div><div class="ttdeci">int32 InputDim(const std::string &amp;input_name) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00669">nnet-nnet.cc:669</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">kaldi::nnet3::CachingOptimizingCompiler</a></div><div class="ttdoc">This class enables you to do the compilation and optimization in one call, and also ensures that if t...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00219">nnet-optimize.h:219</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8f15bc7a244b05a3f04e15d562043dc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8f15bc7a244b05a3f04e15d562043dc">kaldi::nnet3::SetBatchnormTestMode</a></div><div class="ttdeci">void SetBatchnormTestMode(bool test_mode, Nnet *nnet)</div><div class="ttdoc">This function affects only components of type BatchNormComponent. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00555">nnet-utils.cc:555</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a8a6a18ddf875235b4e75f0670bfba421"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a8a6a18ddf875235b4e75f0670bfba421">kaldi::nnet3::Nnet::OutputDim</a></div><div class="ttdeci">int32 OutputDim(const std::string &amp;output_name) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00677">nnet-nnet.cc:677</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::Nnet::Info</a></div><div class="ttdeci">std::string Info() const</div><div class="ttdoc">returns some human-readable information about the network, mostly for debugging purposes. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00821">nnet-nnet.cc:821</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af9757843e049a91502f6fa39782b1ffc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af9757843e049a91502f6fa39782b1ffc">kaldi::nnet3::SetDropoutTestMode</a></div><div class="ttdeci">void SetDropoutTestMode(bool test_mode, Nnet *nnet)</div><div class="ttdoc">This function affects components of child-classes of RandomComponent. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00564">nnet-utils.cc:564</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DecodableNnetSimple_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DecodableNnetSimple.html">kaldi::nnet3::DecodableNnetSimple</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-am-decodable-simple_8h_source.html#l00115">nnet-am-decodable-simple.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetSimpleComputationOptions_html_ab1d720abcb203912db2b8bdc8e7bf4d4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetSimpleComputationOptions.html#ab1d720abcb203912db2b8bdc8e7bf4d4">kaldi::nnet3::NnetSimpleComputationOptions::frames_per_chunk</a></div><div class="ttdeci">int32 frames_per_chunk</div><div class="ttdef"><b>Definition:</b> <a href="nnet-am-decodable-simple_8h_source.html#l00049">nnet-am-decodable-simple.h:49</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetSimpleLoopedComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetSimpleLoopedComputationOptions.html">kaldi::nnet3::NnetSimpleLoopedComputationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="decodable-simple-looped_8h_source.html#l00046">decodable-simple-looped.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLooped_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLooped.html">kaldi::nnet3::DecodableNnetSimpleLooped</a></div><div class="ttdef"><b>Definition:</b> <a href="decodable-simple-looped_8h_source.html#l00161">decodable-simple-looped.h:161</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4cda4da2254dd2dfe1800e4dfeebec38"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4cda4da2254dd2dfe1800e4dfeebec38">kaldi::nnet3::NnetIsRecurrent</a></div><div class="ttdeci">bool NnetIsRecurrent(const Nnet &amp;nnet)</div><div class="ttdoc">Returns true if &amp;#39;nnet&amp;#39; has some kind of recurrency. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l01347">nnet-utils.cc:1347</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLoopedInfo_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1DecodableNnetSimpleLoopedInfo.html">kaldi::nnet3::DecodableNnetSimpleLoopedInfo</a></div><div class="ttdoc">When you instantiate class DecodableNnetSimpleLooped, you should give it a const reference to this cl...</div><div class="ttdef"><b>Definition:</b> <a href="decodable-simple-looped_8h_source.html#l00102">decodable-simple-looped.h:102</a></div></div>
<div class="ttc" id="classkaldi_1_1SubVector_html"><div class="ttname"><a href="classkaldi_1_1SubVector.html">kaldi::SubVector</a></div><div class="ttdoc">Represents a non-allocating general vector which can be defined as a sub-vector of higher-level vecto...</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00485">kaldi-vector.h:485</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetSimpleComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetSimpleComputationOptions.html">kaldi::nnet3::NnetSimpleComputationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-am-decodable-simple_8h_source.html#l00043">nnet-am-decodable-simple.h:43</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac1a1dc9b5063b680db3bb5e8ce670a21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1a1dc9b5063b680db3bb5e8ce670a21">&#9670;&nbsp;</a></span>TestSimpleComponentDataDerivative()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::TestSimpleComponentDataDerivative </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>perturb_delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00309">309</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Component::Backprop()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00376">Component::DeleteMemo()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00180">GetPrecomputedIndexes()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">Component::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00065">kBackpropNeedsInput</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00067">kBackpropNeedsOutput</a>, <a class="el" href="matrix-common_8h_source.html#l00045">kaldi::kDefaultStride</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00075">kInputContiguous</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00077">kOutputContiguous</a>, <a class="el" href="matrix-common_8h_source.html#l00038">kaldi::kSetZero</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">Component::OutputDim()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Component::Propagate()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00027">ResetSeed()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                                                {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> input_stride_type = (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kInputContiguous</a>) ?</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> output_stride_type = (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kOutputContiguous</a>) ?</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  int32 input_dim = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">InputDim</a>(),</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      output_dim = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">OutputDim</a>(),</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      num_rows = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100),</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      rand_seed = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>();</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  int32 properties = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>();</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_data(num_rows, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, input_stride_type),</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      output_data(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type),</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      output_deriv(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  input_data.SetRandn();</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  output_deriv.SetRandn();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">ResetSeed</a>(rand_seed, c);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a> *indexes = <a class="code" href="namespacekaldi_1_1nnet3.html#aa92ca6ce1ae303070bc390ec4cf19e46">GetPrecomputedIndexes</a>(c, num_rows);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordtype">void</span> *memo = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, input_data, &amp;output_data);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_deriv(num_rows, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, input_stride_type),</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      empty_mat;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Backprop</a>(<span class="stringliteral">&quot;foobar&quot;</span>, indexes,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;             ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kBackpropNeedsInput</a>) ? input_data : empty_mat),</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;             ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kBackpropNeedsOutput</a>) ? output_data : empty_mat),</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;             output_deriv, memo, NULL, &amp;input_deriv);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">DeleteMemo</a>(memo);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  int32 test_dim = 3;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> original_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output_deriv, output_data, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> measured_objf_change(test_dim),</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      predicted_objf_change(test_dim);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; test_dim; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> perturbed_input_data(num_rows, input_dim,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                             <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, input_stride_type),</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        perturbed_output_data(num_rows, output_dim,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                              <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    perturbed_input_data.SetRandn();</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    perturbed_input_data.Scale(perturb_delta);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// at this point, perturbed_input_data contains the offset at the input data.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    predicted_objf_change(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(perturbed_input_data, input_deriv,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                           <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    perturbed_input_data.AddMat(1.0, input_data);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">ResetSeed</a>(rand_seed, c);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">DeleteMemo</a>(c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, perturbed_input_data, &amp;perturbed_output_data));</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    measured_objf_change(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output_deriv, perturbed_output_data,</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                          <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>) - original_objf;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Predicted objf-change = &quot;</span> &lt;&lt; predicted_objf_change;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Measured objf-change = &quot;</span> &lt;&lt; measured_objf_change;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> threshold = 0.1;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordtype">bool</span> ans = <a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(predicted_objf_change, measured_objf_change, threshold);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">if</span> (!ans)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Data-derivative test failed, component-type=&quot;</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;               &lt;&lt; c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() &lt;&lt; <span class="stringliteral">&quot;, input-dim=&quot;</span> &lt;&lt; input_dim</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;, output-dim=&quot;</span> &lt;&lt; output_dim;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() == <span class="stringliteral">&quot;NormalizeComponent&quot;</span> &amp;&amp; input_dim == 1) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// derivatives are mathematically zero, but the measured and predicted</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// objf have different roundoff and the relative differences are large.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// this is not unexpected.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Accepting deriv differences since it is NormalizeComponent &quot;</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;with dim=1.&quot;</span>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() == <span class="stringliteral">&quot;ClipGradientComponent&quot;</span>) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Accepting deriv differences since &quot;</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;it is ClipGradientComponent.&quot;</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keyword">delete</span> indexes;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kaldi::nnet3::kOutputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00077">nnet-component-itf.h:77</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a342467ad10ff8535abe96768bdf27958"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">kaldi::nnet3::Component::Propagate</a></div><div class="ttdeci">virtual void * Propagate(const ComponentPrecomputedIndexes *indexes, const CuMatrixBase&lt; BaseFloat &gt; &amp;in, CuMatrixBase&lt; BaseFloat &gt; *out) const =0</div><div class="ttdoc">Propagate function. </div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ac0f2f034a884363d4e0694c62ea8a764"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">kaldi::nnet3::Component::OutputDim</a></div><div class="ttdeci">virtual int32 OutputDim() const =0</div><div class="ttdoc">Returns output-dimension of this component. </div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a8eacf8174f9fa190732c320ee3cf1d62"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">kaldi::nnet3::Component::DeleteMemo</a></div><div class="ttdeci">virtual void DeleteMemo(void *memo) const</div><div class="ttdoc">This virtual function only needs to be overwritten by Components that return a non-NULL memo from the...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00376">nnet-component-itf.h:376</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ada8f5f2c358622ef522a7f2b9d2833ca"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">kaldi::nnet3::Component::Backprop</a></div><div class="ttdeci">virtual void Backprop(const std::string &amp;debug_info, const ComponentPrecomputedIndexes *indexes, const CuMatrixBase&lt; BaseFloat &gt; &amp;in_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_deriv, void *memo, Component *to_update, CuMatrixBase&lt; BaseFloat &gt; *in_deriv) const =0</div><div class="ttdoc">Backprop function; depending on which of the arguments &amp;#39;to_update&amp;#39; and &amp;#39;in_deriv&amp;#39; are non-NULL...</div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7ed7d5044f00b6a0d18737b660c52ad0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">kaldi::nnet3::ResetSeed</a></div><div class="ttdeci">static void ResetSeed(int32 rand_seed, const Component &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00027">nnet-component-test.cc:27</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kaldi::nnet3::kBackpropNeedsOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00067">nnet-component-itf.h:67</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kaldi::kDefaultStride</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00045">matrix-common.h:45</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">kaldi::MatrixStrideType</a></div><div class="ttdeci">MatrixStrideType</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00044">matrix-common.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kaldi::nnet3::kBackpropNeedsInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00065">nnet-component-itf.h:65</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa92ca6ce1ae303070bc390ec4cf19e46"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa92ca6ce1ae303070bc390ec4cf19e46">kaldi::nnet3::GetPrecomputedIndexes</a></div><div class="ttdeci">ComponentPrecomputedIndexes * GetPrecomputedIndexes(const Component &amp;c, int32 num_rows)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00180">nnet-component-test.cc:180</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kaldi::nnet3::kInputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00075">nnet-component-itf.h:75</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ab6b6147feb5e0688469b735a6546c222"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">kaldi::nnet3::Component::Type</a></div><div class="ttdeci">virtual std::string Type() const =0</div><div class="ttdoc">Returns a string such as &quot;SigmoidComponent&quot;, describing the type of the object. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">kaldi::nnet3::ComponentPrecomputedIndexes</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00097">nnet-component-itf.h:97</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kaldi::kSetZero</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00038">matrix-common.h:38</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a7f37d871d35c43a03324502cea308635"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">kaldi::nnet3::Component::InputDim</a></div><div class="ttdeci">virtual int32 InputDim() const =0</div><div class="ttdoc">Returns input-dimension of this component. </div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72a20443febb349c12d3f34ea6d5bdc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72a20443febb349c12d3f34ea6d5bdc5">&#9670;&nbsp;</a></span>TestSimpleComponentModelDerivative()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet3::TestSimpleComponentModelDerivative </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>perturb_delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>test_derivative</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00390">390</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Component::Backprop()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00376">Component::DeleteMemo()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00180">GetPrecomputedIndexes()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">Component::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00065">kBackpropNeedsInput</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00067">kBackpropNeedsOutput</a>, <a class="el" href="matrix-common_8h_source.html#l00045">kaldi::kDefaultStride</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00075">kInputContiguous</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00077">kOutputContiguous</a>, <a class="el" href="matrix-common_8h_source.html#l00038">kaldi::kSetZero</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">Component::OutputDim()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#af8524a3f9d683293269f46e3cc54b285">UpdatableComponent::PerturbParams()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Component::Propagate()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00360">Component::Scale()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00487">UpdatableComponent::SetAsGradient()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                                              {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  int32 input_dim = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">InputDim</a>(),</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      output_dim = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">OutputDim</a>(),</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      num_rows = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  int32 properties = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>();</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) == 0) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">// nothing to test.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> input_stride_type = (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kInputContiguous</a>) ?</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> output_stride_type = (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kOutputContiguous</a>) ?</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_data(num_rows, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, input_stride_type),</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      output_data(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type),</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      output_deriv(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  input_data.SetRandn();</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  output_deriv.SetRandn();</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a> *indexes = <a class="code" href="namespacekaldi_1_1nnet3.html#aa92ca6ce1ae303070bc390ec4cf19e46">GetPrecomputedIndexes</a>(c, num_rows);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordtype">void</span> *memo = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, input_data, &amp;output_data);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> original_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output_deriv, output_data, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c_copy = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>();</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(&amp;c);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc_copy = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(c_copy);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(uc != NULL &amp;&amp; uc_copy != NULL);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">if</span> (test_derivative) {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    uc_copy-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">Scale</a>(0.0);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    uc_copy-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a59a054b2e21fc81601d0eeebd6dc578a">SetAsGradient</a>();</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_deriv(num_rows, input_dim,</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                  <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, input_stride_type),</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      empty_mat;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Backprop</a>(<span class="stringliteral">&quot;foobar&quot;</span>, indexes,</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;             ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kBackpropNeedsInput</a>) ? input_data : empty_mat),</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;             ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kBackpropNeedsOutput</a>) ? output_data : empty_mat),</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;             output_deriv, memo, c_copy,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;             (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? &amp;input_deriv : NULL));</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">DeleteMemo</a>(memo);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">if</span> (!test_derivative) { <span class="comment">// Just testing that the model update is downhill.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> new_output_data(num_rows, output_dim,</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                        <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">DeleteMemo</a>(c_copy-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, input_data, &amp;new_output_data));</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> new_objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output_deriv, new_output_data, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">bool</span> ans = (new_objf &gt; original_objf);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">if</span> (!ans) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;After update, new objf is not better than the original objf: &quot;</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                 &lt;&lt; new_objf &lt;&lt; <span class="stringliteral">&quot; &lt;= &quot;</span> &lt;&lt; original_objf;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">delete</span> c_copy;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">delete</span> indexes;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">// check that the model derivative is accurate.</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    int32 test_dim = 3;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> measured_objf_change(test_dim),</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        predicted_objf_change(test_dim);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; test_dim; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> perturbed_output_data(num_rows, output_dim,</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                                <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c_perturbed = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>();</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a> *uc_perturbed =</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(c_perturbed);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(uc_perturbed != NULL);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      uc_perturbed-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#af8524a3f9d683293269f46e3cc54b285">PerturbParams</a>(perturb_delta);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      predicted_objf_change(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = uc_copy-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*uc_perturbed) -</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          uc_copy-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*uc);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      c_perturbed-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, input_data, &amp;perturbed_output_data);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      measured_objf_change(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output_deriv, perturbed_output_data,</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                            <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>) - original_objf;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keyword">delete</span> c_perturbed;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Predicted objf-change = &quot;</span> &lt;&lt; predicted_objf_change;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Measured objf-change = &quot;</span> &lt;&lt; measured_objf_change;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> threshold = 0.1;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordtype">bool</span> ans = <a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(predicted_objf_change, measured_objf_change,</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                           threshold);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> (!ans)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Model-derivative test failed, component-type=&quot;</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                 &lt;&lt; c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() &lt;&lt; <span class="stringliteral">&quot;, input-dim=&quot;</span> &lt;&lt; input_dim</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;, output-dim=&quot;</span> &lt;&lt; output_dim;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keyword">delete</span> c_copy;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keyword">delete</span> indexes;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kaldi::nnet3::kOutputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00077">nnet-component-itf.h:77</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a342467ad10ff8535abe96768bdf27958"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">kaldi::nnet3::Component::Propagate</a></div><div class="ttdeci">virtual void * Propagate(const ComponentPrecomputedIndexes *indexes, const CuMatrixBase&lt; BaseFloat &gt; &amp;in, CuMatrixBase&lt; BaseFloat &gt; *out) const =0</div><div class="ttdoc">Propagate function. </div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_aa46d9c7de00be8203e16a6e55af0afef"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">kaldi::nnet3::Component::Copy</a></div><div class="ttdeci">virtual Component * Copy() const =0</div><div class="ttdoc">Copies component (deep copy). </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ac0f2f034a884363d4e0694c62ea8a764"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">kaldi::nnet3::Component::OutputDim</a></div><div class="ttdeci">virtual int32 OutputDim() const =0</div><div class="ttdoc">Returns output-dimension of this component. </div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a8eacf8174f9fa190732c320ee3cf1d62"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">kaldi::nnet3::Component::DeleteMemo</a></div><div class="ttdeci">virtual void DeleteMemo(void *memo) const</div><div class="ttdoc">This virtual function only needs to be overwritten by Components that return a non-NULL memo from the...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00376">nnet-component-itf.h:376</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ada8f5f2c358622ef522a7f2b9d2833ca"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">kaldi::nnet3::Component::Backprop</a></div><div class="ttdeci">virtual void Backprop(const std::string &amp;debug_info, const ComponentPrecomputedIndexes *indexes, const CuMatrixBase&lt; BaseFloat &gt; &amp;in_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_deriv, void *memo, Component *to_update, CuMatrixBase&lt; BaseFloat &gt; *in_deriv) const =0</div><div class="ttdoc">Backprop function; depending on which of the arguments &amp;#39;to_update&amp;#39; and &amp;#39;in_deriv&amp;#39; are non-NULL...</div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a750ca3e44a00898afea53b54697226ba"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a750ca3e44a00898afea53b54697226ba">kaldi::nnet3::Component::Scale</a></div><div class="ttdeci">virtual void Scale(BaseFloat scale)</div><div class="ttdoc">This virtual function when called on – an UpdatableComponent scales the parameters by &quot;scale&quot; when c...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00360">nnet-component-itf.h:360</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kaldi::nnet3::kBackpropNeedsOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00067">nnet-component-itf.h:67</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_ac0697192d76083f84fc989f67fbee5e9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">kaldi::nnet3::UpdatableComponent::DotProduct</a></div><div class="ttdeci">virtual BaseFloat DotProduct(const UpdatableComponent &amp;other) const =0</div><div class="ttdoc">Computes dot-product between parameters of two instances of a Component. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kaldi::kDefaultStride</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00045">matrix-common.h:45</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">kaldi::MatrixStrideType</a></div><div class="ttdeci">MatrixStrideType</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00044">matrix-common.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kaldi::nnet3::kBackpropNeedsInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00065">nnet-component-itf.h:65</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_a59a054b2e21fc81601d0eeebd6dc578a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a59a054b2e21fc81601d0eeebd6dc578a">kaldi::nnet3::UpdatableComponent::SetAsGradient</a></div><div class="ttdeci">virtual void SetAsGradient()</div><div class="ttdoc">Sets is_gradient_ to true and sets learning_rate_ to 1, ignoring learning_rate_factor_. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00487">nnet-component-itf.h:487</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa92ca6ce1ae303070bc390ec4cf19e46"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa92ca6ce1ae303070bc390ec4cf19e46">kaldi::nnet3::GetPrecomputedIndexes</a></div><div class="ttdeci">ComponentPrecomputedIndexes * GetPrecomputedIndexes(const Component &amp;c, int32 num_rows)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00180">nnet-component-test.cc:180</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kaldi::nnet3::kInputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00075">nnet-component-itf.h:75</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html">kaldi::nnet3::UpdatableComponent</a></div><div class="ttdoc">Class UpdatableComponent is a Component which has trainable parameters; it extends the interface of C...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00455">nnet-component-itf.h:455</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ab6b6147feb5e0688469b735a6546c222"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">kaldi::nnet3::Component::Type</a></div><div class="ttdeci">virtual std::string Type() const =0</div><div class="ttdoc">Returns a string such as &quot;SigmoidComponent&quot;, describing the type of the object. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1UpdatableComponent_html_af8524a3f9d683293269f46e3cc54b285"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#af8524a3f9d683293269f46e3cc54b285">kaldi::nnet3::UpdatableComponent::PerturbParams</a></div><div class="ttdeci">virtual void PerturbParams(BaseFloat stddev)=0</div><div class="ttdoc">This function is to be used in testing. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">kaldi::nnet3::ComponentPrecomputedIndexes</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00097">nnet-component-itf.h:97</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kaldi::kSetZero</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00038">matrix-common.h:38</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a7f37d871d35c43a03324502cea308635"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">kaldi::nnet3::Component::InputDim</a></div><div class="ttdeci">virtual int32 InputDim() const =0</div><div class="ttdoc">Returns input-dimension of this component. </div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d2f85463a6a7b714692a2e84160f137"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d2f85463a6a7b714692a2e84160f137">&#9670;&nbsp;</a></span>TestSimpleComponentPropagateProperties()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::TestSimpleComponentPropagateProperties </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00210">210</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l00548">CuMatrixBase&lt; Real &gt;::Add()</a>, <a class="el" href="kaldi-math_8h_source.html#l00275">kaldi::AssertEqual()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Component::Backprop()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00376">Component::DeleteMemo()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00180">GetPrecomputedIndexes()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">Component::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00061">kBackpropAdds</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00069">kBackpropInPlace</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00065">kBackpropNeedsInput</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00067">kBackpropNeedsOutput</a>, <a class="el" href="matrix-common_8h_source.html#l00045">kaldi::kDefaultStride</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00075">kInputContiguous</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00077">kOutputContiguous</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00053">kPropagateAdds</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00049">kPropagateInPlace</a>, <a class="el" href="matrix-common_8h_source.html#l00038">kaldi::kSetZero</a>, <a class="el" href="matrix-common_8h_source.html#l00046">kaldi::kStrideEqualNumCols</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">Component::OutputDim()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Component::Propagate()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00027">ResetSeed()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">UnitTestNnetComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                                                {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  int32 properties = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c_copy = NULL;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  int32 rand_seed = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    c_copy = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>();  <span class="comment">// This will test backprop with an updatable component.</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> input_stride_type = (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kInputContiguous</a>) ?</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> output_stride_type = (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kOutputContiguous</a>) ?</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">MatrixStrideType</a> both_stride_type =</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      (c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Properties</a>()&amp;(<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kInputContiguous</a>|<a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kOutputContiguous</a>)) ?</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kStrideEqualNumCols</a> : <a class="code" href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kDefaultStride</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  int32 input_dim = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">InputDim</a>(),</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      output_dim = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">OutputDim</a>(),</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      num_rows = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 100);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_data(num_rows, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                 input_stride_type);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  input_data.SetRandn();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_data3(num_rows, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                   output_stride_type);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  output_data3.CopyFromMat(input_data);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      output_data1(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type),</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      output_data2(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  output_data2.Add(1.0);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">if</span> ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7">kPropagateAdds</a>) &amp;&amp; (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d">kPropagateInPlace</a>)) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;kPropagateAdds and kPropagateInPlace flags are incompatible.&quot;</span>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">ResetSeed</a>(rand_seed, c);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">ComponentPrecomputedIndexes</a> *indexes = <a class="code" href="namespacekaldi_1_1nnet3.html#aa92ca6ce1ae303070bc390ec4cf19e46">GetPrecomputedIndexes</a>(c, num_rows);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordtype">void</span> *memo = c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, input_data, &amp;output_data1);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">ResetSeed</a>(rand_seed, c);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">DeleteMemo</a>(c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, input_data, &amp;output_data2));</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">if</span> (properties &amp; kPropagateInPlace) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">ResetSeed</a>(rand_seed, c);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">DeleteMemo</a>(c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">Propagate</a>(indexes, output_data3, &amp;output_data3));</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">if</span> (!output_data1.ApproxEqual(output_data3)) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Test of kPropagateInPlace flag for component of type &quot;</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                &lt;&lt; c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() &lt;&lt; <span class="stringliteral">&quot; failed.&quot;</span>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">if</span> (properties &amp; kPropagateAdds)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    output_data2.Add(-1.0); <span class="comment">// remove the offset</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(output_data1, output_data2);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, output_stride_type);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  output_deriv.SetRandn();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_deriv1(num_rows, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, input_stride_type),</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      input_deriv2(num_rows, input_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, input_stride_type);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_deriv3(num_rows, output_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kSetZero</a>, both_stride_type);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  input_deriv3.CopyFromMat(output_deriv);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  input_deriv2.Add(1.0);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> empty_mat;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// test with input_deriv1 that&#39;s zero</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Backprop</a>(<span class="stringliteral">&quot;foobar&quot;</span>, indexes,</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;             ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kBackpropNeedsInput</a>) ? input_data : empty_mat),</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;             ((properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kBackpropNeedsOutput</a>) ? output_data1 : empty_mat),</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;             output_deriv,</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;             memo,</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;             c_copy,</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;             &amp;input_deriv1);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">// test with input_deriv2 that&#39;s all ones.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Backprop</a>(<span class="stringliteral">&quot;foobar&quot;</span>, indexes,</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;             ((properties &amp; kBackpropNeedsInput) ? input_data : empty_mat),</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;             ((properties &amp; kBackpropNeedsOutput) ? output_data1 : empty_mat),</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;             output_deriv,</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;             memo,</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;             c_copy,</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;             &amp;input_deriv2);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// test backprop in place, if supported.</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">if</span> (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df">kBackpropInPlace</a>) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">Backprop</a>(<span class="stringliteral">&quot;foobar&quot;</span>, indexes,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;               ((properties &amp; kBackpropNeedsInput) ? input_data : empty_mat),</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;               ((properties &amp; kBackpropNeedsOutput) ? output_data1 : empty_mat),</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;               input_deriv3,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;               memo,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;               c_copy,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;               &amp;input_deriv3);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  c.<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">DeleteMemo</a>(memo);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">if</span> (properties &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90">kBackpropAdds</a>)</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    input_deriv2.Add(-1.0);  <span class="comment">// subtract the offset.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(input_deriv1, input_deriv2);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">if</span> (properties &amp; kBackpropInPlace)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(input_deriv1, input_deriv3);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keyword">delete</span> c_copy;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">delete</span> indexes;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3ab8a5f348ba3b3b42e8943e20b1675dc9">kaldi::nnet3::kOutputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00077">nnet-component-itf.h:77</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a342467ad10ff8535abe96768bdf27958"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a342467ad10ff8535abe96768bdf27958">kaldi::nnet3::Component::Propagate</a></div><div class="ttdeci">virtual void * Propagate(const ComponentPrecomputedIndexes *indexes, const CuMatrixBase&lt; BaseFloat &gt; &amp;in, CuMatrixBase&lt; BaseFloat &gt; *out) const =0</div><div class="ttdoc">Propagate function. </div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51a2b73d1b429e7067fc592b019190e4976">kaldi::kStrideEqualNumCols</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00046">matrix-common.h:46</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_aa46d9c7de00be8203e16a6e55af0afef"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">kaldi::nnet3::Component::Copy</a></div><div class="ttdeci">virtual Component * Copy() const =0</div><div class="ttdoc">Copies component (deep copy). </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ac0f2f034a884363d4e0694c62ea8a764"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">kaldi::nnet3::Component::OutputDim</a></div><div class="ttdeci">virtual int32 OutputDim() const =0</div><div class="ttdoc">Returns output-dimension of this component. </div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a8eacf8174f9fa190732c320ee3cf1d62"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a8eacf8174f9fa190732c320ee3cf1d62">kaldi::nnet3::Component::DeleteMemo</a></div><div class="ttdeci">virtual void DeleteMemo(void *memo) const</div><div class="ttdoc">This virtual function only needs to be overwritten by Components that return a non-NULL memo from the...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00376">nnet-component-itf.h:376</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ada8f5f2c358622ef522a7f2b9d2833ca"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ada8f5f2c358622ef522a7f2b9d2833ca">kaldi::nnet3::Component::Backprop</a></div><div class="ttdeci">virtual void Backprop(const std::string &amp;debug_info, const ComponentPrecomputedIndexes *indexes, const CuMatrixBase&lt; BaseFloat &gt; &amp;in_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_deriv, void *memo, Component *to_update, CuMatrixBase&lt; BaseFloat &gt; *in_deriv) const =0</div><div class="ttdoc">Backprop function; depending on which of the arguments &amp;#39;to_update&amp;#39; and &amp;#39;in_deriv&amp;#39; are non-NULL...</div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7ed7d5044f00b6a0d18737b660c52ad0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7ed7d5044f00b6a0d18737b660c52ad0">kaldi::nnet3::ResetSeed</a></div><div class="ttdeci">static void ResetSeed(int32 rand_seed, const Component &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00027">nnet-component-test.cc:27</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2a37e781d9be4e2cb09699a840dde841">kaldi::nnet3::kBackpropNeedsOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00067">nnet-component-itf.h:67</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a3a4ff15fafe0c8c4885586fc2c36ca8a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">kaldi::nnet3::Component::Properties</a></div><div class="ttdeci">virtual int32 Properties() const =0</div><div class="ttdoc">Return bitmask of the component&amp;#39;s properties. </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d">kaldi::nnet3::kPropagateInPlace</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00049">nnet-component-itf.h:49</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51aae343c6085287b6272231336d4b75986">kaldi::kDefaultStride</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00045">matrix-common.h:45</a></div></div>
<div class="ttc" id="namespacekaldi_html_a21841167f1ffde9582edc512acdbaa51"><div class="ttname"><a href="namespacekaldi.html#a21841167f1ffde9582edc512acdbaa51">kaldi::MatrixStrideType</a></div><div class="ttdeci">MatrixStrideType</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00044">matrix-common.h:44</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3adac6588b2ef2e8b52936718cf97263e7">kaldi::nnet3::kBackpropNeedsInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00065">nnet-component-itf.h:65</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a5180ca55eb0162c68740d51295d056c7">kaldi::nnet3::kPropagateAdds</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00053">nnet-component-itf.h:53</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df">kaldi::nnet3::kBackpropInPlace</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00069">nnet-component-itf.h:69</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa92ca6ce1ae303070bc390ec4cf19e46"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa92ca6ce1ae303070bc390ec4cf19e46">kaldi::nnet3::GetPrecomputedIndexes</a></div><div class="ttdeci">ComponentPrecomputedIndexes * GetPrecomputedIndexes(const Component &amp;c, int32 num_rows)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00180">nnet-component-test.cc:180</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2df016ee6a8dfbdac91f5e53f3662a94">kaldi::nnet3::kInputContiguous</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00075">nnet-component-itf.h:75</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ab6b6147feb5e0688469b735a6546c222"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">kaldi::nnet3::Component::Type</a></div><div class="ttdeci">virtual std::string Type() const =0</div><div class="ttdoc">Returns a string such as &quot;SigmoidComponent&quot;, describing the type of the object. </div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3acda3bbc91bd09631b18fdc57376c2b90">kaldi::nnet3::kBackpropAdds</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00061">nnet-component-itf.h:61</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComponentPrecomputedIndexes.html">kaldi::nnet3::ComponentPrecomputedIndexes</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00097">nnet-component-itf.h:97</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80bae9d0df3a51f0394dd8e041960265c112">kaldi::kSetZero</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00038">matrix-common.h:38</a></div></div>
<div class="ttc" id="namespacekaldi_html_aeb6ba6085493e3f15358e49751342177"><div class="ttname"><a href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">kaldi::AssertEqual</a></div><div class="ttdeci">static void AssertEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">assert abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)) </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00275">kaldi-math.h:275</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a7f37d871d35c43a03324502cea308635"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a7f37d871d35c43a03324502cea308635">kaldi::nnet3::Component::InputDim</a></div><div class="ttdeci">virtual int32 InputDim() const =0</div><div class="ttdoc">Returns input-dimension of this component. </div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4b18d4f3a9eecf00c445ce091e41030"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4b18d4f3a9eecf00c445ce091e41030">&#9670;&nbsp;</a></span>UnitTestCindexIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestCindexIo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common-test_8cc_source.html#l00062">62</a> of file <a class="el" href="nnet-common-test_8cc_source.html">nnet-common-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-common_8cc_source.html#l00309">ReadCindexVector()</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, <a class="el" href="nnet-common_8cc_source.html#l00282">WriteCindexVector()</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common-test_8cc_source.html#l00166">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                        {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  std::vector&lt;Cindex&gt; cindexes(<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 15));</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; cindexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0 || <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 4) == 0) {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-256, 256);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].first;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &amp;index = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aad8b608072a1b6dcd9e91de38ee2925f">n</a> = 0;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">x</a> = 0;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-5, 5);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;          index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = 124;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;          index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = -124;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;          index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = 0;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = 0;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">x</a> = 0;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aad8b608072a1b6dcd9e91de38ee2925f">n</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-3, 3);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;          index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">t</a> = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">x</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1,1);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        index.<a class="code" href="structkaldi_1_1nnet3_1_1Index.html#aad8b608072a1b6dcd9e91de38ee2925f">n</a> = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1,1);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.n = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.n;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.x = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.x;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;          cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.t + <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-127, 127);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.t + 124;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.t + -124;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;          cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-2, 2);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.t;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.x = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.x;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.n = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.n + <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-2,2);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.t + <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-2, 2);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.x = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.x + <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-2, 2);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.n = cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second.n + <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-2,2);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-128, 128);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.x = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-128, 128);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.n = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-128, 128);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;          cindexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.t = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 10) == 0) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// trying to reproduce a failure</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> temp(0, <a class="code" href="structkaldi_1_1nnet3_1_1Index.html">Index</a>(0, 0, 0));</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    cindexes.clear();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    cindexes.resize(4, temp);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    cindexes[<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3)].second.t = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aab8af7cc27e3dad18e9262e62245c4b1">WriteCindexVector</a>(os, binary, cindexes);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  std::vector&lt;Cindex&gt; cindexes2;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    cindexes2 = cindexes;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  std::istringstream is(os.str());</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a181c197e76d410f285809f04dc2bc23e">ReadCindexVector</a>(is, binary, &amp;cindexes2);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  std::ostringstream os2;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aab8af7cc27e3dad18e9262e62245c4b1">WriteCindexVector</a>(os2, binary, cindexes2);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">if</span> (cindexes != cindexes2 || os.str() != os2.str()) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#aab8af7cc27e3dad18e9262e62245c4b1">WriteCindexVector</a>(std::cerr, <span class="keyword">false</span>, cindexes);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;  vs. \n&quot;</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#aab8af7cc27e3dad18e9262e62245c4b1">WriteCindexVector</a>(std::cerr, <span class="keyword">false</span>, cindexes2);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Indexes differ.&quot;</span>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a181c197e76d410f285809f04dc2bc23e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a181c197e76d410f285809f04dc2bc23e">kaldi::nnet3::ReadCindexVector</a></div><div class="ttdeci">void ReadCindexVector(std::istream &amp;is, bool binary, std::vector&lt; Cindex &gt; *vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00309">nnet-common.cc:309</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html">kaldi::nnet3::Index</a></div><div class="ttdoc">struct Index is intended to represent the various indexes by which we number the rows of the matrices...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00044">nnet-common.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8344e7587df9247d6cc492874901d4d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">kaldi::nnet3::Cindex</a></div><div class="ttdeci">std::pair&lt; int32, Index &gt; Cindex</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00115">nnet-common.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_aade28f62e276833462f1b79c4e41ec7e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#aade28f62e276833462f1b79c4e41ec7e">kaldi::nnet3::Index::x</a></div><div class="ttdeci">int32 x</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00047">nnet-common.h:47</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_aad8b608072a1b6dcd9e91de38ee2925f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#aad8b608072a1b6dcd9e91de38ee2925f">kaldi::nnet3::Index::n</a></div><div class="ttdeci">int32 n</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00045">nnet-common.h:45</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aab8af7cc27e3dad18e9262e62245c4b1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aab8af7cc27e3dad18e9262e62245c4b1">kaldi::nnet3::WriteCindexVector</a></div><div class="ttdeci">void WriteCindexVector(std::ostream &amp;os, bool binary, const std::vector&lt; Cindex &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00282">nnet-common.cc:282</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Index_html_a5aa18a99c28265c00e81554208124038"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Index.html#a5aa18a99c28265c00e81554208124038">kaldi::nnet3::Index::t</a></div><div class="ttdeci">int32 t</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00046">nnet-common.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a76dbacc17a4a046b8d9addf0f4214b7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76dbacc17a4a046b8d9addf0f4214b7f">&#9670;&nbsp;</a></span>UnitTestComputationRequestIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestComputationRequestIo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *&#160;</td>
          <td class="paramname"><em>request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00056">56</a> of file <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html">nnet-compute-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="nnet-computation_8cc_source.html#l01034">ComputationRequest::Read()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l01063">ComputationRequest::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                                               {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  request-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os, binary);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">const</span> std::string &amp;original_output = os.str();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  std::istringstream request_is(original_output);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  request-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#ab1b9ede63de755642e79f7287a62b92c">Read</a>(request_is, binary);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  std::istringstream request_is2(original_output);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request2;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#ab1b9ede63de755642e79f7287a62b92c">Read</a>(request_is2, binary);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  std::ostringstream os2, os3;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  request-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os2, binary);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os3, binary);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(*request == request2);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span> (binary) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os2.str() == original_output);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os3.str() == original_output);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_ab1b9ede63de755642e79f7287a62b92c"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#ab1b9ede63de755642e79f7287a62b92c">kaldi::nnet3::ComputationRequest::Read</a></div><div class="ttdeci">void Read(std::istream &amp;istream, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l01034">nnet-computation.cc:1034</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a3f9bb17f4bc2798da3b469f9e45157d6"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a3f9bb17f4bc2798da3b469f9e45157d6">kaldi::nnet3::ComputationRequest::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;ostream, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l01063">nnet-computation.cc:1063</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a63c8dc97af58bac620a4754a6dcc49ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63c8dc97af58bac620a4754a6dcc49ec">&#9670;&nbsp;</a></span>UnitTestComputeGraphTranspose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestComputeGraphTranspose </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00148">148</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph-test_8cc_source.html#l00026">AssertGraphEqual()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00047">BuildTestGraph()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00072">BuildTestGraphTranspose()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00063">ComputeGraphTranspose()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00231">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                     {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; graph;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2cf1ba5597d79505ed5fd378338740bb">BuildTestGraph</a>(&amp;graph);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; graph_transpose;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ac4457943f315ab2e900b1f81606404f8">ComputeGraphTranspose</a>(graph, &amp;graph_transpose);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; ref_graph_transpose;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a0d0ace1de8245a113abc6674f184a19f">BuildTestGraphTranspose</a>(&amp;ref_graph_transpose);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a1b9cf952746776c000ad16fcc9a9f990">AssertGraphEqual</a>(graph_transpose, ref_graph_transpose));</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a2cf1ba5597d79505ed5fd378338740bb"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2cf1ba5597d79505ed5fd378338740bb">kaldi::nnet3::BuildTestGraph</a></div><div class="ttdeci">void BuildTestGraph(std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00047">nnet-graph-test.cc:47</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac4457943f315ab2e900b1f81606404f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac4457943f315ab2e900b1f81606404f8">kaldi::nnet3::ComputeGraphTranspose</a></div><div class="ttdeci">void ComputeGraphTranspose(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph_transpose)</div><div class="ttdoc">Outputs a graph in which the order of arcs is reversed. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00063">nnet-graph.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a0d0ace1de8245a113abc6674f184a19f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0d0ace1de8245a113abc6674f184a19f">kaldi::nnet3::BuildTestGraphTranspose</a></div><div class="ttdeci">void BuildTestGraphTranspose(std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00072">nnet-graph-test.cc:72</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1b9cf952746776c000ad16fcc9a9f990"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1b9cf952746776c000ad16fcc9a9f990">kaldi::nnet3::AssertGraphEqual</a></div><div class="ttdeci">bool AssertGraphEqual(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph1, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00026">nnet-graph-test.cc:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a09c05c0131617f375bfa70bc5a88ef6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09c05c0131617f375bfa70bc5a88ef6c">&#9670;&nbsp;</a></span>UnitTestComputeTopSortOrder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestComputeTopSortOrder </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00187">187</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph-test_8cc_source.html#l00038">AssertVectorEqual()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00114">BuildTestSccGraph()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00131">BuildTestTopSortOrder()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00223">ComputeTopSortOrder()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00231">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                   {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; scc_graph;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aa97309456d46852962866b097697c6b7">BuildTestSccGraph</a>(&amp;scc_graph);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  std::vector&lt;int32&gt; node_to_order;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ae4c2ac8a9e96d220776910b2a9ae2971">ComputeTopSortOrder</a>(scc_graph, &amp;node_to_order);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  std::vector&lt;int32&gt; ref_node_to_order;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a1a8af0bfaf3239fc5f740444edc92874">BuildTestTopSortOrder</a>(&amp;ref_node_to_order);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a60bde0a269254ed7c2471823ba362d75">AssertVectorEqual</a>(node_to_order, ref_node_to_order));</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a60bde0a269254ed7c2471823ba362d75"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a60bde0a269254ed7c2471823ba362d75">kaldi::nnet3::AssertVectorEqual</a></div><div class="ttdeci">bool AssertVectorEqual(const std::vector&lt; int32 &gt; &amp;vec1, const std::vector&lt; int32 &gt; &amp;vec2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00038">nnet-graph-test.cc:38</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae4c2ac8a9e96d220776910b2a9ae2971"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae4c2ac8a9e96d220776910b2a9ae2971">kaldi::nnet3::ComputeTopSortOrder</a></div><div class="ttdeci">void ComputeTopSortOrder(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; int32 &gt; *node_to_order)</div><div class="ttdoc">Given an acyclic graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00223">nnet-graph.cc:223</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa97309456d46852962866b097697c6b7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa97309456d46852962866b097697c6b7">kaldi::nnet3::BuildTestSccGraph</a></div><div class="ttdeci">void BuildTestSccGraph(std::vector&lt; std::vector&lt; int32 &gt; &gt; *scc_graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00114">nnet-graph-test.cc:114</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1a8af0bfaf3239fc5f740444edc92874"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1a8af0bfaf3239fc5f740444edc92874">kaldi::nnet3::BuildTestTopSortOrder</a></div><div class="ttdeci">void BuildTestTopSortOrder(std::vector&lt; int32 &gt; *node_to_order)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00131">nnet-graph-test.cc:131</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4f3c9ebf01438c2d85581ad0ef35b0e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f3c9ebf01438c2d85581ad0ef35b0e8">&#9670;&nbsp;</a></span>UnitTestComputeTopSortOrder2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestComputeTopSortOrder2 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00199">199</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph-test_8cc_source.html#l00038">AssertVectorEqual()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00223">ComputeTopSortOrder()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00231">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                    {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="comment">// The outer vector is indexed by node ID, and each nested vector contains</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">// the node IDs for its successors in the graph. For example, if there are</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="comment">// arcs from node 0 to nodes 1 and 2, then the vector at graph[0] will be (1, 2)</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; graph;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// Build a test graph:</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="comment">// 0 ---&gt; 1 ---&gt; 2 ---&gt; 4</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">//   `--&gt; 3 -----^</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  graph.resize(5);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  graph[0].push_back(1); graph[0].push_back(3);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  graph[1].push_back(2);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  graph[2].push_back(4);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  graph[3].push_back(2);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">// graph[4] is empty(has no successors)</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">// fill in the desired(topological) mapping node-&gt;order</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  std::vector&lt;int32&gt; ref_node_to_order;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  ref_node_to_order.push_back(0); <span class="comment">// node 0 comes first</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  ref_node_to_order.push_back(2); <span class="comment">// node 1 comes third</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  ref_node_to_order.push_back(3); <span class="comment">// node 2 comes fourth</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  ref_node_to_order.push_back(1); <span class="comment">// node 3 comes second</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  ref_node_to_order.push_back(4); <span class="comment">// node 4 comes last</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  std::vector&lt;int32&gt; computed_node_to_order;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ae4c2ac8a9e96d220776910b2a9ae2971">ComputeTopSortOrder</a>(graph, &amp;computed_node_to_order);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a60bde0a269254ed7c2471823ba362d75">AssertVectorEqual</a>(ref_node_to_order, computed_node_to_order));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a60bde0a269254ed7c2471823ba362d75"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a60bde0a269254ed7c2471823ba362d75">kaldi::nnet3::AssertVectorEqual</a></div><div class="ttdeci">bool AssertVectorEqual(const std::vector&lt; int32 &gt; &amp;vec1, const std::vector&lt; int32 &gt; &amp;vec2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00038">nnet-graph-test.cc:38</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae4c2ac8a9e96d220776910b2a9ae2971"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae4c2ac8a9e96d220776910b2a9ae2971">kaldi::nnet3::ComputeTopSortOrder</a></div><div class="ttdeci">void ComputeTopSortOrder(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; int32 &gt; *node_to_order)</div><div class="ttdoc">Given an acyclic graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00223">nnet-graph.cc:223</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a013e6098460707cee578712638ce37dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a013e6098460707cee578712638ce37dd">&#9670;&nbsp;</a></span>UnitTestConfigLineParse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestConfigLineParse </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse-test_8cc_source.html#l00026">26</a> of file <a class="el" href="nnet-parse-test_8cc_source.html">nnet-parse-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-parse_8h_source.html#l00071">ConfigLine::FirstToken()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00115">ConfigLine::GetValue()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00198">ConfigLine::HasUnusedValues()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-parse_8cc_source.html#l00031">ConfigLine::ParseLine()</a>, and <a class="el" href="nnet-parse_8cc_source.html#l00206">ConfigLine::UnusedValues()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse-test_8cc_source.html#l00280">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                               {</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  std::string str;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    str = <span class="stringliteral">&quot;a-b xx=yyy foo=bar  baz=123 ba=1:2&quot;</span>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">bool</span> status = cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(status &amp;&amp; cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#aab0a095b34fdda18436e36bd20101a1d">FirstToken</a>() == <span class="stringliteral">&quot;a-b&quot;</span>);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    std::string str_value;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;xx&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;yyy&quot;</span>);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;bar&quot;</span>);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;xy&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;baz&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;123&quot;</span>);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    std::vector&lt;int32&gt; int_values;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;xx&quot;</span>, &amp;int_values));</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;baz&quot;</span>, &amp;int_values));</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(int_values.size() == 1 &amp;&amp; int_values[0] == 123);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;ba&quot;</span>, &amp;int_values));</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(int_values.size() == 2 &amp;&amp; int_values[0] == 1 &amp;&amp; int_values[1] == 2);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    str = <span class="stringliteral">&quot;a-b baz=x y z pp = qq ab =cd ac= bd&quot;</span>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    str = <span class="stringliteral">&quot;a-b baz=x y z pp = qq ab=cd ac=bd&quot;</span>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    str = <span class="stringliteral">&quot;foo-bar&quot;</span>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    str = <span class="stringliteral">&quot;foo-bar a=b c d f=g&quot;</span>;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    std::string value;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str) &amp;&amp; cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#aab0a095b34fdda18436e36bd20101a1d">FirstToken</a>() == <span class="stringliteral">&quot;foo-bar&quot;</span> &amp;&amp;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                 cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;a&quot;</span>, &amp;value)  &amp;&amp; value == <span class="stringliteral">&quot;b c d&quot;</span> &amp;&amp;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                 cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;f&quot;</span>, &amp;value) &amp;&amp; value == <span class="stringliteral">&quot;g&quot;</span> &amp;&amp;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                 !cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    str = <span class="stringliteral">&quot;zzz a=b baz&quot;</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str) &amp;&amp; cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#aab0a095b34fdda18436e36bd20101a1d">FirstToken</a>() == <span class="stringliteral">&quot;zzz&quot;</span> &amp;&amp;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                 cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a478ba6eabe1ec0ffe5206bcc804a7d3b">UnusedValues</a>() == <span class="stringliteral">&quot;a=b baz&quot;</span>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    str = <span class="stringliteral">&quot;xxx a=b baz &quot;</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str) &amp;&amp; cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a478ba6eabe1ec0ffe5206bcc804a7d3b">UnusedValues</a>() == <span class="stringliteral">&quot;a=b baz&quot;</span>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    str = <span class="stringliteral">&quot;xxx a=b =c&quot;</span>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    str = <span class="stringliteral">&quot;xxx baz=&#39;x y z&#39; pp=qq ab=cd ac=bd&quot;</span>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str) &amp;&amp; cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#aab0a095b34fdda18436e36bd20101a1d">FirstToken</a>() == <span class="stringliteral">&quot;xxx&quot;</span>);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    std::string str_value;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;baz&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;x y z&quot;</span>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;pp&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;qq&quot;</span>);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a478ba6eabe1ec0ffe5206bcc804a7d3b">UnusedValues</a>() == <span class="stringliteral">&quot;ab=cd ac=bd&quot;</span>);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;ab&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;cd&quot;</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a478ba6eabe1ec0ffe5206bcc804a7d3b">UnusedValues</a>() == <span class="stringliteral">&quot;ac=bd&quot;</span>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;ac&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;bd&quot;</span>);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    str = <span class="stringliteral">&quot;x baz= pp = qq flag=t &quot;</span>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  }</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    str = <span class="stringliteral">&quot; x baz= pp=qq flag=t  &quot;</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str) &amp;&amp; cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#aab0a095b34fdda18436e36bd20101a1d">FirstToken</a>() == <span class="stringliteral">&quot;x&quot;</span>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    std::string str_value;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;baz&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;pp&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;qq&quot;</span>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;flag&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(str_value == <span class="stringliteral">&quot;t&quot;</span>);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">HasUnusedValues</a>());</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">bool</span> bool_value = <span class="keyword">false</span>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;flag&quot;</span>, &amp;bool_value));</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(bool_value);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    str = <span class="stringliteral">&quot;xx _baz=a -pp=qq&quot;</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    str = <span class="stringliteral">&quot;xx 0baz=a pp=qq&quot;</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    str = <span class="stringliteral">&quot;xx -baz=a pp=qq&quot;</span>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    str = <span class="stringliteral">&quot;xx _baz&#39;=a pp=qq&quot;</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    str = <span class="stringliteral">&quot; baz=g&quot;</span>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str) &amp;&amp; cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#aab0a095b34fdda18436e36bd20101a1d">FirstToken</a>() == <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">bool</span> flag;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;baz&quot;</span>, &amp;flag));</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    str = <span class="stringliteral">&quot;xx _baz1=a pp=qq&quot;</span>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">ParseLine</a>(str));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    std::string str_value;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.<a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">GetValue</a>(<span class="stringliteral">&quot;_baz1&quot;</span>, &amp;str_value));</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ConfigLine_html_aab0a095b34fdda18436e36bd20101a1d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ConfigLine.html#aab0a095b34fdda18436e36bd20101a1d">kaldi::nnet3::ConfigLine::FirstToken</a></div><div class="ttdeci">const std::string &amp; FirstToken() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8h_source.html#l00071">nnet-parse.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ConfigLine_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ConfigLine.html">kaldi::nnet3::ConfigLine</a></div><div class="ttdoc">This class is responsible for parsing input like hi-there xx=yyy a=b c empty= f-oo=Append(bar, sss) ba_z=123 bing=&amp;#39;a b c&amp;#39; baz=&quot;a b c d=&amp;#39;a b&amp;#39; e&quot; and giving you access to the fields, in this case. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8h_source.html#l00048">nnet-parse.h:48</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ConfigLine_html_a89086da42b4e4067874be15685d424a3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ConfigLine.html#a89086da42b4e4067874be15685d424a3">kaldi::nnet3::ConfigLine::ParseLine</a></div><div class="ttdeci">bool ParseLine(const std::string &amp;line)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00031">nnet-parse.cc:31</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ConfigLine_html_a78311c18549d55bdebfda6737b3cd5bc"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ConfigLine.html#a78311c18549d55bdebfda6737b3cd5bc">kaldi::nnet3::ConfigLine::HasUnusedValues</a></div><div class="ttdeci">bool HasUnusedValues() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00198">nnet-parse.cc:198</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ConfigLine_html_af46be0e68aa534ee0a388bf163c1d9ac"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ConfigLine.html#af46be0e68aa534ee0a388bf163c1d9ac">kaldi::nnet3::ConfigLine::GetValue</a></div><div class="ttdeci">bool GetValue(const std::string &amp;key, std::string *value)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00115">nnet-parse.cc:115</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ConfigLine_html_a478ba6eabe1ec0ffe5206bcc804a7d3b"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ConfigLine.html#a478ba6eabe1ec0ffe5206bcc804a7d3b">kaldi::nnet3::ConfigLine::UnusedValues</a></div><div class="ttdeci">std::string UnusedValues() const</div><div class="ttdoc">returns e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00206">nnet-parse.cc:206</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f4676f01f9cf14b8e74e4698f5c4777"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f4676f01f9cf14b8e74e4698f5c4777">&#9670;&nbsp;</a></span>UnitTestConvertRepeatedToBlockAffine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestConvertRepeatedToBlockAffine </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-utils-test_8cc_source.html#l00050">50</a> of file <a class="el" href="nnet-utils-test_8cc_source.html">nnet-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00438">ConvertRepeatedToBlockAffine()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils-test_8cc_source.html#l00106">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                            {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">// a test without a composite component.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  std::string config =</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="stringliteral">&quot;component name=repeated-affine1 type=RepeatedAffineComponent &quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="stringliteral">&quot;input-dim=100 output-dim=200 num-repeats=20\n&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="stringliteral">&quot;component name=relu1 type=RectifiedLinearComponent dim=200\n&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="stringliteral">&quot;component name=block-affine1 type=BlockAffineComponent &quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="stringliteral">&quot;input-dim=200 output-dim=100 num-blocks=10\n&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="stringliteral">&quot;component name=relu2 type=RectifiedLinearComponent dim=100\n&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="stringliteral">&quot;component name=repeated-affine2 type=NaturalGradientRepeatedAffineComponent &quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="stringliteral">&quot;input-dim=100 output-dim=200 num-repeats=10\n&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="stringliteral">&quot;input-node name=input dim=100\n&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="stringliteral">&quot;component-node name=repeated-affine1 component=repeated-affine1 input=input\n&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="stringliteral">&quot;component-node name=relu1 component=relu1 input=repeated-affine1\n&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="stringliteral">&quot;component-node name=block-affine1 component=block-affine1 input=relu1\n&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="stringliteral">&quot;component-node name=relu2 component=relu2 component=relu2 input=block-affine1\n&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="stringliteral">&quot;component-node name=repeated-affine2 component=repeated-affine2 input=relu2\n&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="stringliteral">&quot;output-node name=output input=repeated-affine2\n&quot;</span>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  std::istringstream is(config);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a52b9ed9b365e986bbbc29a310aae2f8f">ConvertRepeatedToBlockAffine</a>(&amp;nnet);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a15b5336b4413124b1fd4531f57781182">NumComponents</a>(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c = nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() != <span class="stringliteral">&quot;RepeatedAffineComponent&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                 &amp;&amp; c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() != <span class="stringliteral">&quot;NaturalGradientRepeatedAffineComponent&quot;</span>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a52b9ed9b365e986bbbc29a310aae2f8f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a52b9ed9b365e986bbbc29a310aae2f8f">kaldi::nnet3::ConvertRepeatedToBlockAffine</a></div><div class="ttdeci">void ConvertRepeatedToBlockAffine(CompositeComponent *c_component)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00438">nnet-utils.cc:438</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ab6b6147feb5e0688469b735a6546c222"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">kaldi::nnet3::Component::Type</a></div><div class="ttdeci">virtual std::string Type() const =0</div><div class="ttdoc">Returns a string such as &quot;SigmoidComponent&quot;, describing the type of the object. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a15b5336b4413124b1fd4531f57781182"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a15b5336b4413124b1fd4531f57781182">kaldi::nnet3::Nnet::NumComponents</a></div><div class="ttdeci">int32 NumComponents() const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00124">nnet-nnet.h:124</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ef2d5ac32418499886aba3a9054eed4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ef2d5ac32418499886aba3a9054eed4">&#9670;&nbsp;</a></span>UnitTestConvertRepeatedToBlockAffineComposite()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestConvertRepeatedToBlockAffineComposite </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-utils-test_8cc_source.html#l00082">82</a> of file <a class="el" href="nnet-utils-test_8cc_source.html">nnet-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00438">ConvertRepeatedToBlockAffine()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01213">GenerateConfigSequenceCompositeBlock()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l05542">CompositeComponent::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-simple-component_8h_source.html#l02558">CompositeComponent::NumComponents()</a>, <a class="el" href="nnet-test-utils_8h_source.html#l00046">NnetGenerationOptions::output_dim</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, and <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils-test_8cc_source.html#l00106">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                                     {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// test that repeated affine components nested within a CompositeComponent</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// are converted.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  gen_config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html#ab158eb25445ca9f0bd470a95d72d8a0f">output_dim</a> = 0;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// this function generates a neural net with one component:</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// a composite component.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a3af6a7b7d8ad5235dfbccfd6ea387b1b">GenerateConfigSequenceCompositeBlock</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  std::istringstream is(configs[0]);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a15b5336b4413124b1fd4531f57781182">NumComponents</a>() == 1);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a52b9ed9b365e986bbbc29a310aae2f8f">ConvertRepeatedToBlockAffine</a>(&amp;nnet);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1CompositeComponent.html">CompositeComponent</a> *cc = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet3_1_1CompositeComponent.html">CompositeComponent</a>*<span class="keyword">&gt;</span>(nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(0));</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; cc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1CompositeComponent.html#a15b5336b4413124b1fd4531f57781182">NumComponents</a>(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c = cc-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1CompositeComponent.html#a3cb49b7dc262614200cb86400d36cb44">GetComponent</a>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Type</a>() == <span class="stringliteral">&quot;BlockAffineComponent&quot;</span>);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CompositeComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CompositeComponent.html">kaldi::nnet3::CompositeComponent</a></div><div class="ttdoc">CompositeComponent is a component representing a sequence of [simple] components. ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-simple-component_8h_source.html#l02489">nnet-simple-component.h:2489</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a52b9ed9b365e986bbbc29a310aae2f8f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a52b9ed9b365e986bbbc29a310aae2f8f">kaldi::nnet3::ConvertRepeatedToBlockAffine</a></div><div class="ttdeci">void ConvertRepeatedToBlockAffine(CompositeComponent *c_component)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00438">nnet-utils.cc:438</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CompositeComponent_html_a15b5336b4413124b1fd4531f57781182"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CompositeComponent.html#a15b5336b4413124b1fd4531f57781182">kaldi::nnet3::CompositeComponent::NumComponents</a></div><div class="ttdeci">int32 NumComponents() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-simple-component_8h_source.html#l02558">nnet-simple-component.h:2558</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CompositeComponent_html_a3cb49b7dc262614200cb86400d36cb44"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CompositeComponent.html#a3cb49b7dc262614200cb86400d36cb44">kaldi::nnet3::CompositeComponent::GetComponent</a></div><div class="ttdeci">const Component * GetComponent(int32 i) const</div><div class="ttdoc">Gets the ith component in this component. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-simple-component_8cc_source.html#l05542">nnet-simple-component.cc:5542</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ab6b6147feb5e0688469b735a6546c222"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">kaldi::nnet3::Component::Type</a></div><div class="ttdeci">virtual std::string Type() const =0</div><div class="ttdoc">Returns a string such as &quot;SigmoidComponent&quot;, describing the type of the object. </div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a15b5336b4413124b1fd4531f57781182"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a15b5336b4413124b1fd4531f57781182">kaldi::nnet3::Nnet::NumComponents</a></div><div class="ttdeci">int32 NumComponents() const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00124">nnet-nnet.h:124</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html_ab158eb25445ca9f0bd470a95d72d8a0f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html#ab158eb25445ca9f0bd470a95d72d8a0f">kaldi::nnet3::NnetGenerationOptions::output_dim</a></div><div class="ttdeci">int32 output_dim</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00046">nnet-test-utils.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3af6a7b7d8ad5235dfbccfd6ea387b1b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3af6a7b7d8ad5235dfbccfd6ea387b1b">kaldi::nnet3::GenerateConfigSequenceCompositeBlock</a></div><div class="ttdeci">void GenerateConfigSequenceCompositeBlock(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generate a config string with a composite component composed only of block affine, repeated affine, and natural gradient repeated affine components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01213">nnet-test-utils.cc:1213</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa84775bbab03ebc20020d57dbefb2586"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa84775bbab03ebc20020d57dbefb2586">&#9670;&nbsp;</a></span>UnitTestDescriptorIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestDescriptorIo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor-test_8cc_source.html#l00089">89</a> of file <a class="el" href="nnet-descriptor-test_8cc_source.html">nnet-descriptor-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-parse_8cc_source.html#l00377">DescriptorTokenize()</a>, <a class="el" href="nnet-descriptor-test_8cc_source.html#l00076">GenRandDescriptor()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00491">Descriptor::Parse()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="nnet-descriptor_8cc_source.html#l00510">Descriptor::WriteConfig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00229">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                            {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 100; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    int32 num_nodes = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    std::vector&lt;std::string&gt; node_names(num_nodes);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; node_names.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      std::ostringstream ostr;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      ostr &lt;&lt; <span class="stringliteral">&quot;a&quot;</span> &lt;&lt; (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      node_names[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = ostr.str();</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> desc;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    std::ostringstream ostr;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2465e8e47256304999d4cd892e7162b9">GenRandDescriptor</a>(num_nodes, &amp;desc);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    desc.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">WriteConfig</a>(ostr, node_names);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> desc2(desc), desc3, desc4;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    desc3 = desc;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    std::vector&lt;std::string&gt; tokens;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(ostr.str(), &amp;tokens);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    tokens.push_back(<span class="stringliteral">&quot;end of input&quot;</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    std::istringstream istr(ostr.str());</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keyword">const</span> std::string *next_token = &amp;(tokens[0]);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordtype">bool</span> ans = desc4.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#addb4cf06320aab37ab19510329bf40c5">Parse</a>(node_names, &amp;next_token);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    std::ostringstream ostr2;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    desc2.WriteConfig(ostr2, node_names);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    std::ostringstream ostr3;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    desc3.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">WriteConfig</a>(ostr3, node_names);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    std::ostringstream ostr4;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    desc4.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">WriteConfig</a>(ostr4, node_names);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ostr.str() == ostr2.str());</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ostr.str() == ostr3.str());</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;x = &quot;</span> &lt;&lt; ostr.str();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;y = &quot;</span> &lt;&lt; ostr4.str();</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (ostr.str() != ostr4.str()) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;x and y differ: checking that it&#39;s due to Offset normalization.&quot;</span>;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ostr.str().find(<span class="stringliteral">&quot;Offset(Offset&quot;</span>) != std::string::npos ||</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                   (ostr.str().find(<span class="stringliteral">&quot;Offset(&quot;</span>) != std::string::npos &amp;&amp;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    ostr.str().find(<span class="stringliteral">&quot;, 0)&quot;</span>) != std::string::npos));</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html">kaldi::nnet3::Descriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00525">nnet-descriptor.h:525</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html_addb4cf06320aab37ab19510329bf40c5"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html#addb4cf06320aab37ab19510329bf40c5">kaldi::nnet3::Descriptor::Parse</a></div><div class="ttdeci">bool Parse(const std::vector&lt; std::string &gt; &amp;node_names, const std::string **next_token)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00491">nnet-descriptor.cc:491</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac6b64008b19bbb6e8769769cbf96fa68"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">kaldi::nnet3::DescriptorTokenize</a></div><div class="ttdeci">bool DescriptorTokenize(const std::string &amp;input, std::vector&lt; std::string &gt; *tokens)</div><div class="ttdoc">This function tokenizes input when parsing Descriptor configuration values. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00377">nnet-parse.cc:377</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2465e8e47256304999d4cd892e7162b9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2465e8e47256304999d4cd892e7162b9">kaldi::nnet3::GenRandDescriptor</a></div><div class="ttdeci">void GenRandDescriptor(int32 num_nodes, Descriptor *desc)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor-test_8cc_source.html#l00076">nnet-descriptor-test.cc:76</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html_afd8f0ed4a3e5aaa8e43742b054b71bf2"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">kaldi::nnet3::Descriptor::WriteConfig</a></div><div class="ttdeci">void WriteConfig(std::ostream &amp;os, const std::vector&lt; std::string &gt; &amp;node_names) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00510">nnet-descriptor.cc:510</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac447841fa736f8af0f8c64e8cd415644"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac447841fa736f8af0f8c64e8cd415644">&#9670;&nbsp;</a></span>UnitTestDescriptorTokenize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestDescriptorTokenize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse-test_8cc_source.html#l00214">214</a> of file <a class="el" href="nnet-parse-test_8cc_source.html">nnet-parse-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-parse_8cc_source.html#l00377">DescriptorTokenize()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse-test_8cc_source.html#l00280">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                  {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  std::vector&lt;std::string&gt; lines;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  std::string str = <span class="stringliteral">&quot;(,test )&quot;</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(str, &amp;lines));</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lines[0] == <span class="stringliteral">&quot;(&quot;</span> &amp;&amp; lines[1] == <span class="stringliteral">&quot;,&quot;</span> &amp;&amp; lines[2] == <span class="stringliteral">&quot;test&quot;</span> &amp;&amp; lines[3] == <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  str = <span class="stringliteral">&quot;(,1test )&quot;</span>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!<a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(str, &amp;lines));</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  str = <span class="stringliteral">&quot;t (,-1 )&quot;</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(str, &amp;lines));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lines.size() == 5 &amp;&amp; lines[0] == <span class="stringliteral">&quot;t&quot;</span> &amp;&amp; lines[3] == <span class="stringliteral">&quot;-1&quot;</span>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  str = <span class="stringliteral">&quot;   sd , -112 )&quot;</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(str, &amp;lines));</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lines.size() == 4 &amp;&amp; lines[0] == <span class="stringliteral">&quot;sd&quot;</span> &amp;&amp; lines[2] == <span class="stringliteral">&quot;-112&quot;</span>);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  str = <span class="stringliteral">&quot;   sd , +112 )&quot;</span>;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(str, &amp;lines));</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lines.size() == 4 &amp;&amp; lines[0] == <span class="stringliteral">&quot;sd&quot;</span> &amp;&amp; lines[2] == <span class="stringliteral">&quot;+112&quot;</span>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  str = <span class="stringliteral">&quot;foo&quot;</span>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(str, &amp;lines));</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lines.size() == 1 &amp;&amp; lines[0] == <span class="stringliteral">&quot;foo&quot;</span>);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ac6b64008b19bbb6e8769769cbf96fa68"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">kaldi::nnet3::DescriptorTokenize</a></div><div class="ttdeci">bool DescriptorTokenize(const std::string &amp;input, std::vector&lt; std::string &gt; *tokens)</div><div class="ttdoc">This function tokenizes input when parsing Descriptor configuration values. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00377">nnet-parse.cc:377</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a26164e97ad97a37e3401b95d0d82098b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26164e97ad97a37e3401b95d0d82098b">&#9670;&nbsp;</a></span>UnitTestEnsureContiguousProperty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestEnsureContiguousProperty </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00222">222</a> of file <a class="el" href="nnet-compile-utils-test_8cc_source.html">nnet-compile-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils_8cc_source.html#l00401">EnsureContiguousProperty()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00556">HasContiguousProperty()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00363">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                        {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">for</span> (int32 k = 0; k &lt; 10; k++) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    int32 size = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 5);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    std::vector&lt;int32&gt; indexes(size);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1, 4);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; reverse_indexes;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordtype">bool</span> ans = <a class="code" href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">HasContiguousProperty</a>(indexes, &amp;reverse_indexes);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (ans) { <span class="comment">// has contiguous property -&gt; EnsureContiguousProperty should do</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;               <span class="comment">// nothing.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      std::vector&lt;std::vector&lt;int32&gt; &gt; indexes_split;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a84ff5e289907fa63155ee9bec0f9c631">EnsureContiguousProperty</a>(indexes, &amp;indexes_split);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">if</span> (indexes.size() == 0 ||</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          *std::max_element(indexes.begin(), indexes.end()) == -1) {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes_split.size() == 0);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes_split.size() == 1 &amp;&amp;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                     indexes_split[0] == indexes);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      std::vector&lt;std::vector&lt;int32&gt; &gt; indexes_split;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a84ff5e289907fa63155ee9bec0f9c631">EnsureContiguousProperty</a>(indexes, &amp;indexes_split);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes_split.size() &gt; 1);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; indexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        int32 this_val = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordtype">bool</span> found = (this_val == -1);  <span class="comment">// not looking for anything if</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                        <span class="comment">// this_val is -1.</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; indexes_split.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          <span class="keywordflow">if</span> (found) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes_split[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">if</span> (indexes_split[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] == this_val) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;              found = <span class="keyword">true</span>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;              <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes_split[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(found);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; indexes_split.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes_split[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].size() == indexes.size() &amp;&amp;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                       <a class="code" href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">HasContiguousProperty</a>(indexes_split[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>], &amp;reverse_indexes));</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae892457066e9b2ac1632188de1aa06f1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">kaldi::nnet3::HasContiguousProperty</a></div><div class="ttdeci">bool HasContiguousProperty(const std::vector&lt; int32 &gt; &amp;indexes, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *reverse_indexes)</div><div class="ttdoc">This function returns true if for each integer i != -1, all the indexes j at which indexes[j] == i ar...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00556">nnet-compile-utils.cc:556</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a84ff5e289907fa63155ee9bec0f9c631"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a84ff5e289907fa63155ee9bec0f9c631">kaldi::nnet3::EnsureContiguousProperty</a></div><div class="ttdeci">void EnsureContiguousProperty(const std::vector&lt; int32 &gt; &amp;indexes, std::vector&lt; std::vector&lt; int32 &gt; &gt; *indexes_out)</div><div class="ttdoc">This function takes a vector of indexes and splits it up into as separate vectors of the same size...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00401">nnet-compile-utils.cc:401</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af092740ce1ecc4592e3d5c70425baf7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af092740ce1ecc4592e3d5c70425baf7b">&#9670;&nbsp;</a></span>UnitTestFindSccs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestFindSccs </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00160">160</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph-test_8cc_source.html#l00026">AssertGraphEqual()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00047">BuildTestGraph()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00097">BuildTestSccs()</a>, <a class="el" href="nnet-graph_8cc_source.html#l00156">FindSccs()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00231">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; graph;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2cf1ba5597d79505ed5fd378338740bb">BuildTestGraph</a>(&amp;graph);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; sccs;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ae72c79fbb6ec81b69aaee02701fa23e5">FindSccs</a>(graph, &amp;sccs);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; ref_sccs;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a0081c3d0993ad39f10df0eb4857188f5">BuildTestSccs</a>(&amp;ref_sccs);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a1b9cf952746776c000ad16fcc9a9f990">AssertGraphEqual</a>(sccs, ref_sccs));</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a2cf1ba5597d79505ed5fd378338740bb"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2cf1ba5597d79505ed5fd378338740bb">kaldi::nnet3::BuildTestGraph</a></div><div class="ttdeci">void BuildTestGraph(std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00047">nnet-graph-test.cc:47</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae72c79fbb6ec81b69aaee02701fa23e5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae72c79fbb6ec81b69aaee02701fa23e5">kaldi::nnet3::FindSccs</a></div><div class="ttdeci">void FindSccs(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdoc">Given a directed graph (where each std::vector&lt;int32&gt; is a list of destination-nodes of arcs coming f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00156">nnet-graph.cc:156</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a0081c3d0993ad39f10df0eb4857188f5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0081c3d0993ad39f10df0eb4857188f5">kaldi::nnet3::BuildTestSccs</a></div><div class="ttdeci">void BuildTestSccs(std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00097">nnet-graph-test.cc:97</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1b9cf952746776c000ad16fcc9a9f990"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1b9cf952746776c000ad16fcc9a9f990">kaldi::nnet3::AssertGraphEqual</a></div><div class="ttdeci">bool AssertGraphEqual(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph1, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00026">nnet-graph-test.cc:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2e3fd435407cfc4dec9e51a07d3c4f26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e3fd435407cfc4dec9e51a07d3c4f26">&#9670;&nbsp;</a></span>UnitTestGeneralDescriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestGeneralDescriptor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor-test_8cc_source.html#l00135">135</a> of file <a class="el" href="nnet-descriptor-test_8cc_source.html">nnet-descriptor-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-descriptor_8cc_source.html#l01006">GeneralDescriptor::ConvertToDescriptor()</a>, <a class="el" href="nnet-parse_8cc_source.html#l00377">DescriptorTokenize()</a>, <a class="el" href="nnet-descriptor-test_8cc_source.html#l00076">GenRandDescriptor()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00585">GeneralDescriptor::Parse()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="nnet-descriptor_8cc_source.html#l00510">Descriptor::WriteConfig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00229">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                 {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 100; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    int32 num_nodes = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    std::vector&lt;std::string&gt; node_names(num_nodes);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; node_names.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      std::ostringstream ostr;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      ostr &lt;&lt; <span class="stringliteral">&quot;a&quot;</span> &lt;&lt; (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      node_names[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = ostr.str();</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> desc;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    std::ostringstream ostr;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2465e8e47256304999d4cd892e7162b9">GenRandDescriptor</a>(num_nodes, &amp;desc);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    desc.<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">WriteConfig</a>(ostr, node_names);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> desc2(desc), desc3;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    desc3 = desc;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    std::vector&lt;std::string&gt; tokens;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">DescriptorTokenize</a>(ostr.str(), &amp;tokens);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    tokens.push_back(<span class="stringliteral">&quot;end of input&quot;</span>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    std::istringstream istr(ostr.str());</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">const</span> std::string *next_token = &amp;(tokens[0]);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html">GeneralDescriptor</a> *gen_desc = GeneralDescriptor::Parse(node_names,</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                                           &amp;next_token);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (*next_token != <span class="stringliteral">&quot;end of input&quot;</span>)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Parsing Descriptor, expected end of input but got &quot;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt;  *next_token &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html">Descriptor</a> *desc4 = gen_desc-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html#a71138fe8137308e15564d18bdc625e4c">ConvertToDescriptor</a>();</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    std::ostringstream ostr2;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    desc4-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">WriteConfig</a>(ostr2, node_names);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Original descriptor was: &quot;</span> &lt;&lt; ostr.str();</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Parsed descriptor was: &quot;</span> &lt;&lt; ostr2.str();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (ostr2.str() != ostr.str())</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Strings differed.  Check manually.&quot;</span>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keyword">delete</span> gen_desc;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keyword">delete</span> desc4;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html">kaldi::nnet3::Descriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00525">nnet-descriptor.h:525</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1GeneralDescriptor_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html">kaldi::nnet3::GeneralDescriptor</a></div><div class="ttdoc">This class is only used when parsing Descriptors. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8h_source.html#l00609">nnet-descriptor.h:609</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac6b64008b19bbb6e8769769cbf96fa68"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac6b64008b19bbb6e8769769cbf96fa68">kaldi::nnet3::DescriptorTokenize</a></div><div class="ttdeci">bool DescriptorTokenize(const std::string &amp;input, std::vector&lt; std::string &gt; *tokens)</div><div class="ttdoc">This function tokenizes input when parsing Descriptor configuration values. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00377">nnet-parse.cc:377</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1GeneralDescriptor_html_a71138fe8137308e15564d18bdc625e4c"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1GeneralDescriptor.html#a71138fe8137308e15564d18bdc625e4c">kaldi::nnet3::GeneralDescriptor::ConvertToDescriptor</a></div><div class="ttdeci">Descriptor * ConvertToDescriptor()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l01006">nnet-descriptor.cc:1006</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2465e8e47256304999d4cd892e7162b9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2465e8e47256304999d4cd892e7162b9">kaldi::nnet3::GenRandDescriptor</a></div><div class="ttdeci">void GenRandDescriptor(int32 num_nodes, Descriptor *desc)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor-test_8cc_source.html#l00076">nnet-descriptor-test.cc:76</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Descriptor_html_afd8f0ed4a3e5aaa8e43742b054b71bf2"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Descriptor.html#afd8f0ed4a3e5aaa8e43742b054b71bf2">kaldi::nnet3::Descriptor::WriteConfig</a></div><div class="ttdeci">void WriteConfig(std::ostream &amp;os, const std::vector&lt; std::string &gt; &amp;node_names) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor_8cc_source.html#l00510">nnet-descriptor.cc:510</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac9ae443db1f79c1de816ace0cee8706f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9ae443db1f79c1de816ace0cee8706f">&#9670;&nbsp;</a></span>UnitTestGeneralDescriptorSpecial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestGeneralDescriptorSpecial </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-descriptor-test_8cc_source.html#l00200">200</a> of file <a class="el" href="nnet-descriptor-test_8cc_source.html">nnet-descriptor-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-descriptor-test_8cc_source.html#l00180">NormalizeTextDescriptor()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-descriptor-test_8cc_source.html#l00229">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                        {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  std::vector&lt;std::string&gt; names;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  names.push_back(<span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  names.push_back(<span class="stringliteral">&quot;b&quot;</span>);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  names.push_back(<span class="stringliteral">&quot;c&quot;</span>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  names.push_back(<span class="stringliteral">&quot;d&quot;</span>);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;a&quot;</span>) == <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Scale(-1.0, a)&quot;</span>) == <span class="stringliteral">&quot;Scale(-1, a)&quot;</span>);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Const(1.0, 512)&quot;</span>) == <span class="stringliteral">&quot;Const(1, 512)&quot;</span>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Sum(Const(1.0, 512), Scale(-1.0, a))&quot;</span>) ==</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;               <span class="stringliteral">&quot;Sum(Const(1, 512), Scale(-1, a))&quot;</span>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Offset(Offset(a, 3, 5), 2, 1)&quot;</span>)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;               == <span class="stringliteral">&quot;Offset(a, 5, 6)&quot;</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Offset(Sum(a, b), 2, 1)&quot;</span>) ==</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;               <span class="stringliteral">&quot;Sum(Offset(a, 2, 1), Offset(b, 2, 1))&quot;</span>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Sum(Append(a, b), Append(c, d))&quot;</span>) ==</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;               <span class="stringliteral">&quot;Append(Sum(a, c), Sum(b, d))&quot;</span>);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Append(Append(a, b), Append(c, d))&quot;</span>) ==</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;               <span class="stringliteral">&quot;Append(a, b, c, d)&quot;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Sum(a, b, c, d)&quot;</span>) ==</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;               <span class="stringliteral">&quot;Sum(a, Sum(b, Sum(c, d)))&quot;</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Sum(a)&quot;</span>) == <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">NormalizeTextDescriptor</a>(names, <span class="stringliteral">&quot;Offset(a, 0)&quot;</span>) == <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a59f9bf54d192e760e406499f997327be"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a59f9bf54d192e760e406499f997327be">kaldi::nnet3::NormalizeTextDescriptor</a></div><div class="ttdeci">std::string NormalizeTextDescriptor(const std::vector&lt; std::string &gt; &amp;node_names, const std::string &amp;desc_str)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-descriptor-test_8cc_source.html#l00180">nnet-descriptor-test.cc:180</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a07e09944d36b367d8e7b5978184826c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07e09944d36b367d8e7b5978184826c2">&#9670;&nbsp;</a></span>UnitTestHasContiguousProperty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestHasContiguousProperty </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00185">185</a> of file <a class="el" href="nnet-compile-utils-test_8cc_source.html">nnet-compile-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils_8cc_source.html#l00556">HasContiguousProperty()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00363">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                     {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">for</span> (int32 k = 0; k &lt; 10; k++) {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    int32 size = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 5);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    std::vector&lt;int32&gt; indexes(size);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1, 4);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    std::vector&lt;std::pair&lt;int32, int32&gt; &gt; reverse_indexes;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">bool</span> ans = <a class="code" href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">HasContiguousProperty</a>(indexes, &amp;reverse_indexes);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (!ans) { <span class="comment">// doesn&#39;t have contiguous propety.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;no.&quot;</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordtype">bool</span> found_example = <span class="keyword">false</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">if</span> (indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != -1) {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          <span class="keywordtype">bool</span> found_not_same = <span class="keyword">false</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; size; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">if</span> (indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] != indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]) found_not_same = <span class="keyword">true</span>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (found_not_same) found_example = <span class="keyword">true</span>;  <span class="comment">// found something like x y x.</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(found_example);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;yes.&quot;</span>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; reverse_indexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = reverse_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;             <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; reverse_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] == <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = -1;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  <span class="comment">// make sure all indexes covered.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae892457066e9b2ac1632188de1aa06f1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae892457066e9b2ac1632188de1aa06f1">kaldi::nnet3::HasContiguousProperty</a></div><div class="ttdeci">bool HasContiguousProperty(const std::vector&lt; int32 &gt; &amp;indexes, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *reverse_indexes)</div><div class="ttdoc">This function returns true if for each integer i != -1, all the indexes j at which indexes[j] == i ar...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00556">nnet-compile-utils.cc:556</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a839780fb74682622f06524a99a653f88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a839780fb74682622f06524a99a653f88">&#9670;&nbsp;</a></span>UnitTestIndexIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestIndexIo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common-test_8cc_source.html#l00028">28</a> of file <a class="el" href="nnet-common-test_8cc_source.html">nnet-common-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-common_8cc_source.html#l00143">ReadIndexVector()</a>, and <a class="el" href="nnet-common_8cc_source.html#l00126">WriteIndexVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common-test_8cc_source.html#l00166">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                       {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  std::vector&lt;Index&gt; indexes(<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 10));</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; indexes.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0 || <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].n = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1, 2);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].t = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-150, 150);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].x = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1, 1);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      <span class="comment">// this case gets optimized while writing. (if abs(diff-in-t) &lt; 125).</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].n = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].n;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].t = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].t + <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-127, 127);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].x = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].x;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  }</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a>(os, binary, indexes);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  std::vector&lt;Index&gt; indexes2;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    indexes2 = indexes;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  std::istringstream is(os.str());</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#af2069492e6a46f0c6b003a52cf87e2f7">ReadIndexVector</a>(is, binary, &amp;indexes2);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (indexes != indexes2) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a>(std::cerr, <span class="keyword">false</span>, indexes);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;  vs. \n&quot;</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">WriteIndexVector</a>(std::cerr, <span class="keyword">false</span>, indexes2);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Indexes differ.&quot;</span>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a6d9bd2f8bc49b5d2d7dec9b2d354ffc9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">kaldi::nnet3::WriteIndexVector</a></div><div class="ttdeci">void WriteIndexVector(std::ostream &amp;os, bool binary, const std::vector&lt; Index &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00126">nnet-common.cc:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af2069492e6a46f0c6b003a52cf87e2f7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af2069492e6a46f0c6b003a52cf87e2f7">kaldi::nnet3::ReadIndexVector</a></div><div class="ttdeci">void ReadIndexVector(std::istream &amp;is, bool binary, std::vector&lt; Index &gt; *vec)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00143">nnet-common.cc:143</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af8bfac0b4fadf2d70853d050f21bb2db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8bfac0b4fadf2d70853d050f21bb2db">&#9670;&nbsp;</a></span>UnitTestMakeSccGraph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestMakeSccGraph </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-graph-test_8cc_source.html#l00172">172</a> of file <a class="el" href="nnet-graph-test_8cc_source.html">nnet-graph-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-graph-test_8cc_source.html#l00026">AssertGraphEqual()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00047">BuildTestGraph()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00114">BuildTestSccGraph()</a>, <a class="el" href="nnet-graph-test_8cc_source.html#l00097">BuildTestSccs()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-graph_8cc_source.html#l00164">MakeSccGraph()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-graph-test_8cc_source.html#l00231">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                            {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; graph;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2cf1ba5597d79505ed5fd378338740bb">BuildTestGraph</a>(&amp;graph);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; sccs;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a0081c3d0993ad39f10df0eb4857188f5">BuildTestSccs</a>(&amp;sccs);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; scc_graph;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a9efe2804eba8c2da73af3aa4eff4a2fc">MakeSccGraph</a>(graph, sccs, &amp;scc_graph);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  std::vector&lt;std::vector&lt;int32&gt; &gt; ref_scc_graph;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aa97309456d46852962866b097697c6b7">BuildTestSccGraph</a>(&amp;ref_scc_graph);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a1b9cf952746776c000ad16fcc9a9f990">AssertGraphEqual</a>(scc_graph, ref_scc_graph));</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a2cf1ba5597d79505ed5fd378338740bb"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2cf1ba5597d79505ed5fd378338740bb">kaldi::nnet3::BuildTestGraph</a></div><div class="ttdeci">void BuildTestGraph(std::vector&lt; std::vector&lt; int32 &gt; &gt; *graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00047">nnet-graph-test.cc:47</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa97309456d46852962866b097697c6b7"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa97309456d46852962866b097697c6b7">kaldi::nnet3::BuildTestSccGraph</a></div><div class="ttdeci">void BuildTestSccGraph(std::vector&lt; std::vector&lt; int32 &gt; &gt; *scc_graph)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00114">nnet-graph-test.cc:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a0081c3d0993ad39f10df0eb4857188f5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0081c3d0993ad39f10df0eb4857188f5">kaldi::nnet3::BuildTestSccs</a></div><div class="ttdeci">void BuildTestSccs(std::vector&lt; std::vector&lt; int32 &gt; &gt; *sccs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00097">nnet-graph-test.cc:97</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9efe2804eba8c2da73af3aa4eff4a2fc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9efe2804eba8c2da73af3aa4eff4a2fc">kaldi::nnet3::MakeSccGraph</a></div><div class="ttdeci">void MakeSccGraph(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;sccs, std::vector&lt; std::vector&lt; int32 &gt; &gt; *scc_graph)</div><div class="ttdoc">Given a list of sccs of a graph (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph_8cc_source.html#l00164">nnet-graph.cc:164</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1b9cf952746776c000ad16fcc9a9f990"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1b9cf952746776c000ad16fcc9a9f990">kaldi::nnet3::AssertGraphEqual</a></div><div class="ttdeci">bool AssertGraphEqual(const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph1, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;graph2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-graph-test_8cc_source.html#l00026">nnet-graph-test.cc:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a820ea34d40d78ff98f9800e7e4de45d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a820ea34d40d78ff98f9800e7e4de45d4">&#9670;&nbsp;</a></span>UnitTestNameMatchesPattern()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNameMatchesPattern </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse-test_8cc_source.html#l00263">263</a> of file <a class="el" href="nnet-parse-test_8cc_source.html">nnet-parse-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-parse_8cc_source.html#l00608">NameMatchesPattern()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse-test_8cc_source.html#l00280">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                   {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;hello&quot;</span>, <span class="stringliteral">&quot;hello&quot;</span>));</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;hello&quot;</span>, <span class="stringliteral">&quot;hellox&quot;</span>));</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;hellox&quot;</span>, <span class="stringliteral">&quot;hello&quot;</span>));</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;hellox&quot;</span>, <span class="stringliteral">&quot;hello*&quot;</span>));</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;hello&quot;</span>, <span class="stringliteral">&quot;hello*&quot;</span>));</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>));</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>));</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;foo12bar&quot;</span>, <span class="stringliteral">&quot;foo*bar&quot;</span>));</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;foo12bar&quot;</span>, <span class="stringliteral">&quot;foo*&quot;</span>));</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">NameMatchesPattern</a>(<span class="stringliteral">&quot;foo12bar&quot;</span>, <span class="stringliteral">&quot;*bar&quot;</span>));</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a7670f1519ac3d653ed7af20ffaf388f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7670f1519ac3d653ed7af20ffaf388f8">kaldi::nnet3::NameMatchesPattern</a></div><div class="ttdeci">bool NameMatchesPattern(const char *name, const char *pattern)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00608">nnet-parse.cc:608</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4cc6a3d60ce5fb425830d97903d51aa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cc6a3d60ce5fb425830d97903d51aa2">&#9670;&nbsp;</a></span>UnitTestNnetAnalyze()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetAnalyze </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-analyze-test_8cc_source.html#l00039">39</a> of file <a class="el" href="nnet-analyze-test_8cc_source.html">nnet-analyze-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-analyze_8cc_source.html#l00579">ComputationChecker::Check()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00394">CheckComputationOptions::check_rewrite</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01323">ComputationAnalysis::DataInvalidatedCommand()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01182">ComputationAnalysis::FirstNontrivialAccess()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00424">NnetComputation::GetSubmatrixStrings()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01421">Analyzer::Init()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01264">ComputationAnalysis::LastAccess()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01291">ComputationAnalysis::LastWriteAccess()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, <a class="el" href="nnet-analyze-test_8cc_source.html#l00028">PrintCommand()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-analyze-test_8cc_source.html#l00099">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                           {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 20; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    std::vector&lt;Matrix&lt;BaseFloat&gt; &gt; inputs;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request, &amp;inputs);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler(request, nnet);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> opts;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    compiler.CreateComputation(opts, &amp;computation);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(os, nnet);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Generated computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">CheckComputationOptions</a> check_config;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// we can do the rewrite check since it&#39;s before optimization.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    check_config.<a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">check_rewrite</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a> checker(check_config, nnet, computation);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    checker.Check();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> analyzer;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    analyzer.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">Init</a>(nnet, computation);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html">ComputationAnalysis</a> analysis(computation, analyzer);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// The following output is to be eyeballed by a person.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    std::vector&lt;std::string&gt; submatrix_strings;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#abf2fedad8e73e55adba8dba14361967f">GetSubmatrixStrings</a>(nnet, &amp;submatrix_strings);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    int32 nc = computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size();</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 30; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      int32 s = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>.size() - 1);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      int32 c = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, nc - 1);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;First nontrivial access of submatrix &quot;</span> &lt;&lt; submatrix_strings[s]</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; is command &quot;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#add0941dcac8fe7e6bfe5d65979c9d388">PrintCommand</a>(nc, analysis.FirstNontrivialAccess(s));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Last access of submatrix &quot;</span> &lt;&lt; submatrix_strings[s]</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; is command &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#add0941dcac8fe7e6bfe5d65979c9d388">PrintCommand</a>(nc, analysis.LastAccess(s));</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Last write access of submatrix &quot;</span> &lt;&lt; submatrix_strings[s]</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; is command &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#add0941dcac8fe7e6bfe5d65979c9d388">PrintCommand</a>(nc, analysis.LastWriteAccess(s));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Data present in &quot;</span> &lt;&lt; submatrix_strings[s]</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; at command &quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot; is invalidated at command &quot;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#add0941dcac8fe7e6bfe5d65979c9d388">PrintCommand</a>(nc, analysis.DataInvalidatedCommand(c, s));</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a849faa82711b6faa8551205167721bfa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00717">nnet-computation.cc:717</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationChecker_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationChecker.html">kaldi::nnet3::ComputationChecker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00411">nnet-analyze.h:411</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00439">nnet-computation.h:439</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CompilerOptions.html">kaldi::nnet3::CompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00034">nnet-compile.h:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2370ad59bd8f6a9f348193b491d88d8a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">kaldi::nnet3::ComputeExampleComputationRequestSimple</a></div><div class="ttdeci">void ComputeExampleComputationRequestSimple(const Nnet &amp;nnet, ComputationRequest *request, std::vector&lt; Matrix&lt; BaseFloat &gt; &gt; *inputs)</div><div class="ttdoc">This function computes an example computation request, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01338">nnet-test-utils.cc:1338</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_aab8a145e53802c80302dc498e388a2ad"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">kaldi::nnet3::Analyzer::Init</a></div><div class="ttdeci">void Init(const Nnet &amp;nnet, const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01421">nnet-analyze.cc:1421</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00404">nnet-computation.h:404</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html_ab342a2855f4c0a04a1c4f565405e1b93"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">kaldi::nnet3::CheckComputationOptions::check_rewrite</a></div><div class="ttdeci">bool check_rewrite</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00394">nnet-analyze.h:394</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_add0941dcac8fe7e6bfe5d65979c9d388"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#add0941dcac8fe7e6bfe5d65979c9d388">kaldi::nnet3::PrintCommand</a></div><div class="ttdeci">std::string PrintCommand(int32 num_commands, int32 command)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze-test_8cc_source.html#l00028">nnet-analyze-test.cc:28</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html">kaldi::nnet3::Compiler</a></div><div class="ttdoc">This class creates an initial version of the NnetComputation, without any optimization or sharing of ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00044">nnet-compile.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">kaldi::nnet3::CheckComputationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00391">nnet-analyze.h:391</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html">kaldi::nnet3::Analyzer</a></div><div class="ttdoc">This struct exists to set up various pieces of analysis; it helps avoid the repetition of code where ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00294">nnet-analyze.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_abf2fedad8e73e55adba8dba14361967f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#abf2fedad8e73e55adba8dba14361967f">kaldi::nnet3::NnetComputation::GetSubmatrixStrings</a></div><div class="ttdeci">void GetSubmatrixStrings(const Nnet &amp;nnet, std::vector&lt; std::string &gt; *submat_strings) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00424">nnet-computation.cc:424</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationAnalysis_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html">kaldi::nnet3::ComputationAnalysis</a></div><div class="ttdoc">This class performs various kinds of specific analysis on top of what class Analyzer gives you immedi...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00308">nnet-analyze.h:308</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a68c5b8e70a4f632063af6c4a8c397189"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68c5b8e70a4f632063af6c4a8c397189">&#9670;&nbsp;</a></span>UnitTestNnetCompile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetCompile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-test_8cc_source.html#l00029">29</a> of file <a class="el" href="nnet-compile-test_8cc_source.html">nnet-compile-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8cc_source.html#l01092">ComputationRequest::Print()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-test_8cc_source.html#l00177">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                           {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 20; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    }</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    std::vector&lt;Matrix&lt;BaseFloat&gt; &gt; inputs;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request, &amp;inputs);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Computation request is:&quot;</span>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">Print</a>(std::cerr);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler(request, nnet);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> opts;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    compiler.CreateComputation(opts, &amp;computation);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(os, nnet);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Generated computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a849faa82711b6faa8551205167721bfa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00717">nnet-computation.cc:717</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CompilerOptions.html">kaldi::nnet3::CompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00034">nnet-compile.h:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2370ad59bd8f6a9f348193b491d88d8a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">kaldi::nnet3::ComputeExampleComputationRequestSimple</a></div><div class="ttdeci">void ComputeExampleComputationRequestSimple(const Nnet &amp;nnet, ComputationRequest *request, std::vector&lt; Matrix&lt; BaseFloat &gt; &gt; *inputs)</div><div class="ttdoc">This function computes an example computation request, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01338">nnet-test-utils.cc:1338</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html">kaldi::nnet3::Compiler</a></div><div class="ttdoc">This class creates an initial version of the NnetComputation, without any optimization or sharing of ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00044">nnet-compile.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a73cf13dfa8c354dde01e6f8f05a0f507"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">kaldi::nnet3::ComputationRequest::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os) const</div><div class="ttdoc">This function is for printing info about the computation request in a human-readable way...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l01092">nnet-computation.cc:1092</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae416c14b4ec347fb1467f8e7e15d113f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae416c14b4ec347fb1467f8e7e15d113f">&#9670;&nbsp;</a></span>UnitTestNnetCompileLooped()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetCompileLooped </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-test_8cc_source.html#l00120">120</a> of file <a class="el" href="nnet-compile-test_8cc_source.html">nnet-compile-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8h_source.html#l00042">NnetGenerationOptions::allow_ivector</a>, <a class="el" href="nnet-compile-looped_8cc_source.html#l00329">CompileLooped()</a>, <a class="el" href="nnet-compile-looped_8cc_source.html#l00361">CreateLoopedComputationRequestSimple()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="nnet-compile-looped_8cc_source.html#l00081">GetChunkSize()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00821">Nnet::Info()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-compile-looped_8cc_source.html#l00028">ModifyNnetIvectorPeriod()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8cc_source.html#l01092">ComputationRequest::Print()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-test_8cc_source.html#l00177">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                 {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 20; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    gen_config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html#acf56c34aa78a4671414208d2c4180cae">allow_ivector</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request1, request2, request3;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    int32 chunk_size_min = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(5, 15);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    int32 frame_subsampling_factor = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 3),</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        extra_left_context_begin = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 10),</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        extra_right_context = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 10),</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        num_sequences = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 2);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    int32 chunk_size = <a class="code" href="namespacekaldi_1_1nnet3.html#a50c94226ad499267fedd4630bd2b5516">GetChunkSize</a>(nnet, frame_subsampling_factor,</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                    chunk_size_min),</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        ivector_period = chunk_size;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a944dbd968a2a1a9e8998083101702b79">ModifyNnetIvectorPeriod</a>(ivector_period, &amp;nnet);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Nnet info after modifying ivector period is: &quot;</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;              &lt;&lt; nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">Info</a>();</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ae9f1d373569ff5f67ec7bbffb7c9cf5f">CreateLoopedComputationRequestSimple</a>(</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        nnet, chunk_size, frame_subsampling_factor,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        ivector_period, extra_left_context_begin, extra_right_context,</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        num_sequences, &amp;request1, &amp;request2, &amp;request3);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Computation request 1 is:&quot;</span>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    request1.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">Print</a>(std::cerr);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Computation request 2 is:&quot;</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">Print</a>(std::cerr);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Computation request 3 is:&quot;</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    request3.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">Print</a>(std::cerr);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> optimize_opts;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// todo: set optimize-looped=true.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a">CompileLooped</a>(nnet, optimize_opts,</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                  request1, request2, request3,</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                  &amp;computation);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Compiled looped computation is &quot;</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(std::cerr, nnet);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a944dbd968a2a1a9e8998083101702b79"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a944dbd968a2a1a9e8998083101702b79">kaldi::nnet3::ModifyNnetIvectorPeriod</a></div><div class="ttdeci">void ModifyNnetIvectorPeriod(int32 ivector_period, Nnet *nnet)</div><div class="ttdoc">This function modifies the descriptors in the neural network to change the periodicity with which it ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00028">nnet-compile-looped.cc:28</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a50c94226ad499267fedd4630bd2b5516"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a50c94226ad499267fedd4630bd2b5516">kaldi::nnet3::GetChunkSize</a></div><div class="ttdeci">int32 GetChunkSize(const Nnet &amp;nnet, int32 frame_subsampling_factor, int32 advised_chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00081">nnet-compile-looped.cc:81</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a849faa82711b6faa8551205167721bfa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00717">nnet-computation.cc:717</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html_acf56c34aa78a4671414208d2c4180cae"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html#acf56c34aa78a4671414208d2c4180cae">kaldi::nnet3::NnetGenerationOptions::allow_ivector</a></div><div class="ttdeci">bool allow_ivector</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00042">nnet-test-utils.h:42</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::Nnet::Info</a></div><div class="ttdeci">std::string Info() const</div><div class="ttdoc">returns some human-readable information about the network, mostly for debugging purposes. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00821">nnet-nnet.cc:821</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_addb1bb9cfaba76d930fa05d16d19bc4a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#addb1bb9cfaba76d930fa05d16d19bc4a">kaldi::nnet3::CompileLooped</a></div><div class="ttdeci">void CompileLooped(const Nnet &amp;nnet, const NnetOptimizeOptions &amp;optimize_opts, const ComputationRequest &amp;request1, const ComputationRequest &amp;request2, const ComputationRequest &amp;request3, NnetComputation *computation)</div><div class="ttdoc">CompileLooped() provides an internal interface for &amp;#39;looped&amp;#39; computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00329">nnet-compile-looped.cc:329</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">kaldi::nnet3::NnetOptimizeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae9f1d373569ff5f67ec7bbffb7c9cf5f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae9f1d373569ff5f67ec7bbffb7c9cf5f">kaldi::nnet3::CreateLoopedComputationRequestSimple</a></div><div class="ttdeci">void CreateLoopedComputationRequestSimple(const Nnet &amp;nnet, int32 chunk_size, int32 frame_subsampling_factor, int32 ivector_period, int32 extra_left_context_begin, int32 extra_right_context, int32 num_sequences, ComputationRequest *request1, ComputationRequest *request2, ComputationRequest *request3)</div><div class="ttdoc">This function is deprecated. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-looped_8cc_source.html#l00361">nnet-compile-looped.cc:361</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a73cf13dfa8c354dde01e6f8f05a0f507"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">kaldi::nnet3::ComputationRequest::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os) const</div><div class="ttdoc">This function is for printing info about the computation request in a human-readable way...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l01092">nnet-computation.cc:1092</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ab0d765a44c8a69eb704b5b1a12caa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ab0d765a44c8a69eb704b5b1a12caa8">&#9670;&nbsp;</a></span>UnitTestNnetCompileMulti()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetCompileMulti </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-test_8cc_source.html#l00063">63</a> of file <a class="el" href="nnet-compile-test_8cc_source.html">nnet-compile-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8h_source.html#l00041">NnetGenerationOptions::allow_use_of_x_dim</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="nnet-computation_8cc_source.html#l01092">ComputationRequest::Print()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00126">ComputationRequest::store_component_stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-test_8cc_source.html#l00177">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                                {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 20; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    gen_config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html#a27652e0f766946b3fadaf24bd00d1cc1">allow_use_of_x_dim</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request1, request2;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    std::vector&lt;Matrix&lt;BaseFloat&gt; &gt; inputs1, inputs2;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request1, &amp;inputs1);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request2, &amp;inputs2);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Computation request 1 is:&quot;</span>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    request1.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">Print</a>(std::cerr);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Computation request 2 is:&quot;</span>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">Print</a>(std::cerr);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    std::vector&lt;const ComputationRequest*&gt; requests;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a5c5011f4cb4b2fc21775a3308c9cecda">store_component_stats</a> = request1.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a5c5011f4cb4b2fc21775a3308c9cecda">store_component_stats</a>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    request1.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    requests.push_back(&amp;request1);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    requests.push_back(&amp;request2);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// set all the x indexes to 1 for request 2 (they would otherwise</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// be zero).  This ensures that there is no overlap</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// between the inputs and outputs on the two requests.</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].x = 1;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    for (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        request2.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].x = 1;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler(requests, nnet);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> opts;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    compiler.CreateComputation(opts, &amp;computation);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    computation.Print(os, nnet);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Generated computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a5c5011f4cb4b2fc21775a3308c9cecda"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a5c5011f4cb4b2fc21775a3308c9cecda">kaldi::nnet3::ComputationRequest::store_component_stats</a></div><div class="ttdeci">bool store_component_stats</div><div class="ttdoc">you should set need_component_stats to true if you need the average-activation and average-derivative...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00126">nnet-computation.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a58c542fffb7e7f754148c264c90b4a5e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">kaldi::nnet3::ComputationRequest::need_model_derivative</a></div><div class="ttdeci">bool need_model_derivative</div><div class="ttdoc">if need_model_derivative is true, then we&amp;#39;ll be doing either model training or model-derivative compu...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00121">nnet-computation.h:121</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00115">nnet-computation.h:115</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CompilerOptions.html">kaldi::nnet3::CompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00034">nnet-compile.h:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2370ad59bd8f6a9f348193b491d88d8a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">kaldi::nnet3::ComputeExampleComputationRequestSimple</a></div><div class="ttdeci">void ComputeExampleComputationRequestSimple(const Nnet &amp;nnet, ComputationRequest *request, std::vector&lt; Matrix&lt; BaseFloat &gt; &gt; *inputs)</div><div class="ttdoc">This function computes an example computation request, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01338">nnet-test-utils.cc:1338</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00116">nnet-computation.h:116</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html">kaldi::nnet3::Compiler</a></div><div class="ttdoc">This class creates an initial version of the NnetComputation, without any optimization or sharing of ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00044">nnet-compile.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html_a27652e0f766946b3fadaf24bd00d1cc1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html#a27652e0f766946b3fadaf24bd00d1cc1">kaldi::nnet3::NnetGenerationOptions::allow_use_of_x_dim</a></div><div class="ttdeci">bool allow_use_of_x_dim</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00041">nnet-test-utils.h:41</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a73cf13dfa8c354dde01e6f8f05a0f507"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a73cf13dfa8c354dde01e6f8f05a0f507">kaldi::nnet3::ComputationRequest::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os) const</div><div class="ttdoc">This function is for printing info about the computation request in a human-readable way...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l01092">nnet-computation.cc:1092</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a32b068b357bfea7bf051d6f644e1912d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32b068b357bfea7bf051d6f644e1912d">&#9670;&nbsp;</a></span>UnitTestNnetComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00490">490</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8cc_source.html#l01767">GenerateRandomSimpleComponent()</a>, <a class="el" href="nnet-component-itf_8cc_source.html#l00190">Component::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00076">TestNnetComponentAddScale()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00067">TestNnetComponentCopy()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00052">TestNnetComponentIo()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00109">TestNnetComponentUpdatable()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00086">TestNnetComponentVectorizeUnVectorize()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00309">TestSimpleComponentDataDerivative()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00390">TestSimpleComponentModelDerivative()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00210">TestSimpleComponentPropagateProperties()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00524">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                             {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 200; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)  {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Component.html">Component</a> *c = <a class="code" href="namespacekaldi_1_1nnet3.html#a3dccdf514f810b334ee5baa954eb88f8">GenerateRandomSimpleComponent</a>();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; c-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>();</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#aee5e219c905cd82d682bc00a0de72d74">TestNnetComponentIo</a>(c);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#af7d4b74958e0a63a4e52bef63e71f394">TestNnetComponentCopy</a>(c);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a554b097cfc8c22c7fe43dec7ceca8839">TestNnetComponentAddScale</a>(c);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a179079a64f06a09c80c757753016b094">TestNnetComponentVectorizeUnVectorize</a>(c);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a0b28b95264b6db2e9ce5658f8f939a8b">TestNnetComponentUpdatable</a>(c);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a3d2f85463a6a7b714692a2e84160f137">TestSimpleComponentPropagateProperties</a>(*c);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#ac1a1dc9b5063b680db3bb5e8ce670a21">TestSimpleComponentDataDerivative</a>(*c, 1.0e-04) &amp;&amp;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#ac1a1dc9b5063b680db3bb5e8ce670a21">TestSimpleComponentDataDerivative</a>(*c, 1.0e-03) &amp;&amp;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#ac1a1dc9b5063b680db3bb5e8ce670a21">TestSimpleComponentDataDerivative</a>(*c, 1.0e-05) &amp;&amp;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#ac1a1dc9b5063b680db3bb5e8ce670a21">TestSimpleComponentDataDerivative</a>(*c, 1.0e-06))</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Component data-derivative test failed&quot;</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a>(*c, 1.0e-04, <span class="keyword">false</span>) &amp;&amp;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a>(*c, 1.0e-03, <span class="keyword">false</span>) &amp;&amp;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a>(*c, 1.0e-06, <span class="keyword">false</span>))</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Component downhill-update test failed&quot;</span>;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a>(*c, 1.0e-04, <span class="keyword">true</span>) &amp;&amp;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a>(*c, 1.0e-03, <span class="keyword">true</span>) &amp;&amp;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a>(*c, 1.0e-05, <span class="keyword">true</span>) &amp;&amp;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        !<a class="code" href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">TestSimpleComponentModelDerivative</a>(*c, 1.0e-06, <span class="keyword">true</span>))</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Component model-derivative test failed&quot;</span>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">delete</span> c;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a3d2f85463a6a7b714692a2e84160f137"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3d2f85463a6a7b714692a2e84160f137">kaldi::nnet3::TestSimpleComponentPropagateProperties</a></div><div class="ttdeci">void TestSimpleComponentPropagateProperties(const Component &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html">kaldi::nnet3::Component</a></div><div class="ttdoc">Abstract base-class for neural-net components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00114">nnet-component-itf.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a554b097cfc8c22c7fe43dec7ceca8839"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a554b097cfc8c22c7fe43dec7ceca8839">kaldi::nnet3::TestNnetComponentAddScale</a></div><div class="ttdeci">void TestNnetComponentAddScale(Component *c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00076">nnet-component-test.cc:76</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a72a20443febb349c12d3f34ea6d5bdc5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a72a20443febb349c12d3f34ea6d5bdc5">kaldi::nnet3::TestSimpleComponentModelDerivative</a></div><div class="ttdeci">bool TestSimpleComponentModelDerivative(const Component &amp;c, BaseFloat perturb_delta, bool test_derivative)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00390">nnet-component-test.cc:390</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a179079a64f06a09c80c757753016b094"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a179079a64f06a09c80c757753016b094">kaldi::nnet3::TestNnetComponentVectorizeUnVectorize</a></div><div class="ttdeci">void TestNnetComponentVectorizeUnVectorize(Component *c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00086">nnet-component-test.cc:86</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac1a1dc9b5063b680db3bb5e8ce670a21"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac1a1dc9b5063b680db3bb5e8ce670a21">kaldi::nnet3::TestSimpleComponentDataDerivative</a></div><div class="ttdeci">bool TestSimpleComponentDataDerivative(const Component &amp;c, BaseFloat perturb_delta)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00309">nnet-component-test.cc:309</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af7d4b74958e0a63a4e52bef63e71f394"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af7d4b74958e0a63a4e52bef63e71f394">kaldi::nnet3::TestNnetComponentCopy</a></div><div class="ttdeci">void TestNnetComponentCopy(Component *c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00067">nnet-component-test.cc:67</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet3::Component::Info</a></div><div class="ttdeci">virtual std::string Info() const</div><div class="ttdoc">Returns some text-form information about this component, for diagnostics. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8cc_source.html#l00190">nnet-component-itf.cc:190</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a0b28b95264b6db2e9ce5658f8f939a8b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a0b28b95264b6db2e9ce5658f8f939a8b">kaldi::nnet3::TestNnetComponentUpdatable</a></div><div class="ttdeci">void TestNnetComponentUpdatable(Component *c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00109">nnet-component-test.cc:109</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aee5e219c905cd82d682bc00a0de72d74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aee5e219c905cd82d682bc00a0de72d74">kaldi::nnet3::TestNnetComponentIo</a></div><div class="ttdeci">void TestNnetComponentIo(Component *c)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00052">nnet-component-test.cc:52</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3dccdf514f810b334ee5baa954eb88f8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3dccdf514f810b334ee5baa954eb88f8">kaldi::nnet3::GenerateRandomSimpleComponent</a></div><div class="ttdeci">Component * GenerateRandomSimpleComponent()</div><div class="ttdoc">Generates random simple component for testing. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01767">nnet-test-utils.cc:1767</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a73c7d7120264caaefed196288122dca6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73c7d7120264caaefed196288122dca6">&#9670;&nbsp;</a></span>UnitTestNnetComputationIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetComputationIo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00034">34</a> of file <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html">nnet-compute-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00732">NnetComputation::Read()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00866">NnetComputation::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">UnitTestNnetCompute()</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                                                             {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os, binary);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keyword">const</span> std::string &amp;original_output = os.str();</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  std::istringstream computation_is(original_output);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab1b9ede63de755642e79f7287a62b92c">Read</a>(computation_is, binary);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  std::istringstream computation_is2(original_output);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation2;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  computation2.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab1b9ede63de755642e79f7287a62b92c">Read</a>(computation_is2, binary);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  std::ostringstream os2, os3;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os2, binary);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  computation2.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os3, binary);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">if</span> (binary) {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">if</span> (!(os2.str() == original_output)) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Outputs differ for computation&quot;</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ab1b9ede63de755642e79f7287a62b92c"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab1b9ede63de755642e79f7287a62b92c">kaldi::nnet3::NnetComputation::Read</a></div><div class="ttdeci">void Read(std::istream &amp;istream, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00732">nnet-computation.cc:732</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a3f9bb17f4bc2798da3b469f9e45157d6"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3f9bb17f4bc2798da3b469f9e45157d6">kaldi::nnet3::NnetComputation::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;ostream, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00866">nnet-computation.cc:866</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72aa26595d9be2bf06aa61db33ed362f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72aa26595d9be2bf06aa61db33ed362f">&#9670;&nbsp;</a></span>UnitTestNnetCompute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetCompute </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00147">147</a> of file <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html">nnet-compute-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00542">NnetComputer::AcceptInput()</a>, <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00579">ComputationChecker::Check()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00394">CheckComputationOptions::check_rewrite</a>, <a class="el" href="nnet-utils_8cc_source.html#l02007">CollapseModel()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00084">NnetComputation::ComputeCudaIndexes()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, <a class="el" href="nnet3_2nnet-compute_8h_source.html#l00040">NnetComputeOptions::debug</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00573">NnetComputer::GetOutput()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00484">MaxOutputTimeInRequest()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00508">NnetComputer::Run()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00555">SetBatchnormTestMode()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00564">SetDropoutTestMode()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="cu-matrix_8cc_source.html#l02979">CuMatrixBase&lt; Real &gt;::Sum()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00080">TestNnetDecodable()</a>, <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00056">UnitTestComputationRequestIo()</a>, and <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00034">UnitTestNnetComputationIo()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3_2nnet-compute-test_8cc_source.html#l00282">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                           {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 20; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordtype">bool</span> test_collapse_model = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    std::vector&lt;Matrix&lt;BaseFloat&gt; &gt; inputs;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request, &amp;inputs);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// Test CollapseModel().  Note: lines with &#39;collapse&#39; in some part of them</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// are not necessary for the rest of the test to run; they only test</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// CollapseModel().</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span> (test_collapse_model) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="comment">// this model collapsing code requires that test mode is set for batchnorm</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="comment">// and dropout components.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#ac8f15bc7a244b05a3f04e15d562043dc">SetBatchnormTestMode</a>(<span class="keyword">true</span>, &amp;nnet);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#af9757843e049a91502f6fa39782b1ffc">SetDropoutTestMode</a>(<span class="keyword">true</span>, &amp;nnet);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler(request, nnet);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> opts;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    compiler.CreateComputation(opts, &amp;computation);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet_collapsed(nnet);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CollapseModelConfig.html">CollapseModelConfig</a> collapse_config;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation_collapsed;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (test_collapse_model) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a34c5db7f905e0ab11b678443cb65f930">CollapseModel</a>(collapse_config, &amp;nnet_collapsed);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler_collapsed(request, nnet_collapsed);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      compiler_collapsed.CreateComputation(opts, &amp;computation_collapsed);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      computation_collapsed.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac2af1facc3bf90819e78ea5b2bb2554d">ComputeCudaIndexes</a>();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      std::ostringstream os;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(os, nnet);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Generated computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a73c7d7120264caaefed196288122dca6">UnitTestNnetComputationIo</a>(&amp;computation);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a76dbacc17a4a046b8d9addf0f4214b7f">UnitTestComputationRequestIo</a>(&amp;request);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">CheckComputationOptions</a> check_config;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// we can do the rewrite check since it&#39;s before optimization.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    check_config.<a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">check_rewrite</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a> checker(check_config, nnet, computation);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    checker.Check();</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> opt_config;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14">Optimize</a>(opt_config, nnet,</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;               <a class="code" href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">MaxOutputTimeInRequest</a>(request),</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;               &amp;computation);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        std::ostringstream os;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(os, nnet);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Optimized computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">NnetComputeOptions</a> compute_opts;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      compute_opts.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">debug</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac2af1facc3bf90819e78ea5b2bb2554d">ComputeCudaIndexes</a>();</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> computer(compute_opts,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                          computation,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                          nnet,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                          &amp;nnet);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// provide the input to the computation.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp(inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input sum is &quot;</span> &lt;&lt; temp.Sum();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      computer.AcceptInput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name, &amp;temp);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    computer.Run();</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;output(computer.GetOutput(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output sum is &quot;</span> &lt;&lt; output.Sum();</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (test_collapse_model) {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> computer_collapsed(compute_opts,</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                      computation_collapsed,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                      nnet_collapsed,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                      &amp;nnet_collapsed);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp(inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input sum is &quot;</span> &lt;&lt; temp.Sum();</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        computer_collapsed.AcceptInput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name, &amp;temp);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      computer_collapsed.Run();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;output_collapsed(</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          computer_collapsed.GetOutput(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output sum [collapsed] is &quot;</span> &lt;&lt; output_collapsed.Sum();</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(output, output_collapsed)) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Regular and collapsed computations&#39; outputs differ&quot;</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv(output.NumRows(), output.NumCols());</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    output_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// output_deriv sum won&#39;t be informative so don&#39;t print it.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].has_deriv) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      computer.AcceptInput(<span class="stringliteral">&quot;output&quot;</span>, &amp;output_deriv);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      computer.Run();</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">if</span> (request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].has_deriv) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;          <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;in_deriv =</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;              computer.GetOutput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;          <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input-deriv sum for input &#39;&quot;</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    &lt;&lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name &lt;&lt; <span class="stringliteral">&quot;&#39; is &quot;</span> &lt;&lt; in_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>();</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#aa3aff0be4a71c5f484a787d889f5d6be">TestNnetDecodable</a>(&amp;nnet);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a34c5db7f905e0ab11b678443cb65f930"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a34c5db7f905e0ab11b678443cb65f930">kaldi::nnet3::CollapseModel</a></div><div class="ttdeci">void CollapseModel(const CollapseModelConfig &amp;config, Nnet *nnet)</div><div class="ttdoc">This function modifies the neural net for efficiency, in a way that suitable to be done in test time...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l02007">nnet-utils.cc:2007</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa3aff0be4a71c5f484a787d889f5d6be"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa3aff0be4a71c5f484a787d889f5d6be">kaldi::nnet3::TestNnetDecodable</a></div><div class="ttdeci">void TestNnetDecodable(Nnet *nnet)</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute-test_8cc_source.html#l00080">nnet-compute-test.cc:80</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ac2af1facc3bf90819e78ea5b2bb2554d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac2af1facc3bf90819e78ea5b2bb2554d">kaldi::nnet3::NnetComputation::ComputeCudaIndexes</a></div><div class="ttdeci">void ComputeCudaIndexes()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00084">nnet-computation.cc:84</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_ae7089fd656218302336300dc42ae55c1"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#ae7089fd656218302336300dc42ae55c1">kaldi::CuMatrixBase::Sum</a></div><div class="ttdeci">Real Sum() const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l02979">cu-matrix.cc:2979</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a849faa82711b6faa8551205167721bfa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00717">nnet-computation.cc:717</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html_a398527b3e9e358c345c5047b16871957"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">kaldi::nnet3::NnetComputeOptions::debug</a></div><div class="ttdeci">bool debug</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00040">nnet-compute.h:40</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8f15bc7a244b05a3f04e15d562043dc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8f15bc7a244b05a3f04e15d562043dc">kaldi::nnet3::SetBatchnormTestMode</a></div><div class="ttdeci">void SetBatchnormTestMode(bool test_mode, Nnet *nnet)</div><div class="ttdoc">This function affects only components of type BatchNormComponent. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00555">nnet-utils.cc:555</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationChecker_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationChecker.html">kaldi::nnet3::ComputationChecker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00411">nnet-analyze.h:411</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00115">nnet-computation.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">kaldi::nnet3::NnetComputeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00039">nnet-compute.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_af9757843e049a91502f6fa39782b1ffc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#af9757843e049a91502f6fa39782b1ffc">kaldi::nnet3::SetDropoutTestMode</a></div><div class="ttdeci">void SetDropoutTestMode(bool test_mode, Nnet *nnet)</div><div class="ttdoc">This function affects components of child-classes of RandomComponent. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00564">nnet-utils.cc:564</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CompilerOptions.html">kaldi::nnet3::CompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00034">nnet-compile.h:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2370ad59bd8f6a9f348193b491d88d8a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">kaldi::nnet3::ComputeExampleComputationRequestSimple</a></div><div class="ttdeci">void ComputeExampleComputationRequestSimple(const Nnet &amp;nnet, ComputationRequest *request, std::vector&lt; Matrix&lt; BaseFloat &gt; &gt; *inputs)</div><div class="ttdoc">This function computes an example computation request, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01338">nnet-test-utils.cc:1338</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac580549257041c725612ff223c99e43c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">kaldi::nnet3::MaxOutputTimeInRequest</a></div><div class="ttdeci">int32 MaxOutputTimeInRequest(const ComputationRequest &amp;request)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00484">nnet-optimize.cc:484</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">kaldi::nnet3::NnetOptimizeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a602819d33d3a59c128aa4e865e610e14"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14">kaldi::nnet3::Optimize</a></div><div class="ttdeci">void Optimize(const NnetOptimizeOptions &amp;config, const Nnet &amp;nnet, int32 max_output_time_in_request, NnetComputation *computation)</div><div class="ttdoc">This is the top-level function for optimizing a computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00501">nnet-optimize.cc:501</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html_ab342a2855f4c0a04a1c4f565405e1b93"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">kaldi::nnet3::CheckComputationOptions::check_rewrite</a></div><div class="ttdeci">bool check_rewrite</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00394">nnet-analyze.h:394</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a76dbacc17a4a046b8d9addf0f4214b7f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a76dbacc17a4a046b8d9addf0f4214b7f">kaldi::nnet3::UnitTestComputationRequestIo</a></div><div class="ttdeci">void UnitTestComputationRequestIo(ComputationRequest *request)</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute-test_8cc_source.html#l00056">nnet-compute-test.cc:56</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html">kaldi::CuMatrixBase</a></div><div class="ttdoc">Matrix for CUDA computing. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00069">matrix-common.h:69</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputer_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputer.html">kaldi::nnet3::NnetComputer</a></div><div class="ttdoc">class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00059">nnet-compute.h:59</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00116">nnet-computation.h:116</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html">kaldi::nnet3::Compiler</a></div><div class="ttdoc">This class creates an initial version of the NnetComputation, without any optimization or sharing of ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00044">nnet-compile.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a73c7d7120264caaefed196288122dca6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a73c7d7120264caaefed196288122dca6">kaldi::nnet3::UnitTestNnetComputationIo</a></div><div class="ttdeci">void UnitTestNnetComputationIo(NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute-test_8cc_source.html#l00034">nnet-compute-test.cc:34</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">kaldi::nnet3::CheckComputationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00391">nnet-analyze.h:391</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CollapseModelConfig_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CollapseModelConfig.html">kaldi::nnet3::CollapseModelConfig</a></div><div class="ttdoc">Config class for the CollapseModel function. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-utils_8h_source.html#l00232">nnet-utils.h:232</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a666e24f4c79af6ec57eeaf005b00b5dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a666e24f4c79af6ec57eeaf005b00b5dd">&#9670;&nbsp;</a></span>UnitTestNnetContext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetContext </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-utils-test_8cc_source.html#l00029">29</a> of file <a class="el" href="nnet-utils-test_8cc_source.html">nnet-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00146">ComputeSimpleNnetContext()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-utils_8cc_source.html#l00483">NnetInfo()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-utils-test_8cc_source.html#l00106">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                           {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 20; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    </div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    std::istringstream is(configs[0]);</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// this test doesn&#39;t really test anything except that it runs;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// we manually inspect the output.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    int32 left_context, right_context;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">ComputeSimpleNnetContext</a>(nnet, &amp;left_context, &amp;right_context);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Left,right-context= &quot;</span> &lt;&lt; left_context &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;              &lt;&lt; right_context &lt;&lt; <span class="stringliteral">&quot; for config: &quot;</span> &lt;&lt; configs[0];</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Info for nnet is: &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#a81eeaabd042c236a1e0276c353a7d450">NnetInfo</a>(nnet);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a88aa85d232ba1ad6e430f6f6dcda29c1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a88aa85d232ba1ad6e430f6f6dcda29c1">kaldi::nnet3::ComputeSimpleNnetContext</a></div><div class="ttdeci">void ComputeSimpleNnetContext(const Nnet &amp;nnet, int32 *left_context, int32 *right_context)</div><div class="ttdoc">ComputeSimpleNnetContext computes the left-context and right-context of a nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00146">nnet-utils.cc:146</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a81eeaabd042c236a1e0276c353a7d450"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a81eeaabd042c236a1e0276c353a7d450">kaldi::nnet3::NnetInfo</a></div><div class="ttdeci">std::string NnetInfo(const Nnet &amp;nnet)</div><div class="ttdoc">This function returns various info about the neural net. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00483">nnet-utils.cc:483</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a60b81dcaa89e17f1f362e45f559d734c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60b81dcaa89e17f1f362e45f559d734c">&#9670;&nbsp;</a></span>UnitTestNnetExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetExample </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-test_8cc_source.html#l00035">35</a> of file <a class="el" href="nnet-example-test_8cc_source.html">nnet-example-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8cc_source.html#l01869">ExampleApproxEqual()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01816">GenerateSimpleNnetTrainingExample()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00116">NnetExample::Read()</a>, and <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00103">NnetExample::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-test_8cc_source.html#l00103">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                           {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 50; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    int32 num_supervised_frames = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10),</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                   left_context = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 5),</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                  right_context = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 5),</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                      input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10),</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                     output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(5, 10),</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                    ivector_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1, 2);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a8263b0802f12a823d6c072b53c4ee236">GenerateSimpleNnetTrainingExample</a>(num_supervised_frames, left_context,</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                      right_context, input_dim, output_dim,</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                      ivector_dim, &amp;eg);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a68f354fd5f096134162f01719096e6fc">Write</a>(os, binary);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg_copy;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      eg_copy = eg;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    std::istringstream is(os.str());</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    eg_copy.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a8e7d2790fc7e94fe9780ccc937de1270">Read</a>(is, binary);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    std::ostringstream os2;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    eg_copy.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a68f354fd5f096134162f01719096e6fc">Write</a>(os2, binary);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">if</span> (binary) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os.str() == os2.str());</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(eg_copy == eg);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a7a54fa7479670b5b34951fdacd2c9b1d">ExampleApproxEqual</a>(eg, eg_copy, 0.1));</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html">kaldi::nnet3::NnetExample</a></div><div class="ttdoc">NnetExample is the input data and corresponding label (or labels) for one or more frames of input...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00111">nnet-example.h:111</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8263b0802f12a823d6c072b53c4ee236"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8263b0802f12a823d6c072b53c4ee236">kaldi::nnet3::GenerateSimpleNnetTrainingExample</a></div><div class="ttdeci">void GenerateSimpleNnetTrainingExample(int32 num_supervised_frames, int32 left_context, int32 right_context, int32 output_dim, int32 input_dim, int32 ivector_dim, NnetExample *example)</div><div class="ttdoc">Low-level function that generates an nnet training example. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01816">nnet-test-utils.cc:1816</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_a68f354fd5f096134162f01719096e6fc"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#a68f354fd5f096134162f01719096e6fc">kaldi::nnet3::NnetExample::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;os, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8cc_source.html#l00103">nnet-example.cc:103</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7a54fa7479670b5b34951fdacd2c9b1d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7a54fa7479670b5b34951fdacd2c9b1d">kaldi::nnet3::ExampleApproxEqual</a></div><div class="ttdeci">bool ExampleApproxEqual(const NnetExample &amp;eg1, const NnetExample &amp;eg2, BaseFloat delta)</div><div class="ttdoc">Returns true if the examples are approximately equal (only intended to be used in testing)...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01869">nnet-test-utils.cc:1869</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_a8e7d2790fc7e94fe9780ccc937de1270"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#a8e7d2790fc7e94fe9780ccc937de1270">kaldi::nnet3::NnetExample::Read</a></div><div class="ttdeci">void Read(std::istream &amp;is, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8cc_source.html#l00116">nnet-example.cc:116</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8666ffad3ea0232ebaa3cff139a32629"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8666ffad3ea0232ebaa3cff139a32629">&#9670;&nbsp;</a></span>UnitTestNnetInputDerivatives()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetInputDerivatives </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-derivative-test_8cc_source.html#l00246">246</a> of file <a class="el" href="nnet-derivative-test_8cc_source.html">nnet-derivative-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00542">NnetComputer::AcceptInput()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00941">CuMatrixBase&lt; Real &gt;::AddMat()</a>, <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00579">ComputationChecker::Check()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00394">CheckComputationOptions::check_rewrite</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="nnet3_2nnet-compute_8h_source.html#l00040">NnetComputeOptions::debug</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00573">NnetComputer::GetOutput()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00484">MaxOutputTimeInRequest()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-utils_8cc_source.html#l01347">NnetIsRecurrent()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00677">Nnet::OutputDim()</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00049">CuMatrix&lt; Real &gt;::Resize()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00508">NnetComputer::Run()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-derivative-test_8cc_source.html#l00421">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                                    {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  int32 N = 20;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">//gen_config.allow_nonlinearity = false;</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">//gen_config.allow_recursion = false;</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">//gen_config.allow_final_nonlinearity = true;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordtype">bool</span> allow_optimization = <span class="keyword">true</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    std::vector&lt;Matrix&lt;BaseFloat&gt; &gt; inputs;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request, &amp;inputs);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// make sure that all inputs and outputs have derivatives requested/provided,</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// and that the model-update (need_model_derivative) is not requested.</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].has_deriv = <span class="keyword">true</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].has_deriv = <span class="keyword">true</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler(request, nnet);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> opts;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    compiler.CreateComputation(opts, &amp;computation);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      std::ostringstream os;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      computation.Print(os, nnet);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Generated computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">CheckComputationOptions</a> check_config;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">// we can do the rewrite check since it&#39;s before optimization.</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    check_config.<a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">check_rewrite</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a> checker(check_config, nnet, computation);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    checker.Check();</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) != 0 &amp;&amp; allow_optimization) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> opt_config;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="comment">// opt_config.initialize_undefined = false;  // temp</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14">Optimize</a>(opt_config, nnet,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;               <a class="code" href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">MaxOutputTimeInRequest</a>(request),</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;               &amp;computation);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      std::ostringstream os;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      computation.Print(os, nnet);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Optimized computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">NnetComputeOptions</a> compute_opts;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      compute_opts.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">debug</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    computation.ComputeCudaIndexes();</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    int32 num_directions = 3;  <span class="comment">// must be &gt;= 1.  Best if it&#39;s &gt;1, will reduce</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                               <span class="comment">// the probability of random failures.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// the order of these vectors is:</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// [ un-perturbed, perturbed-1, perturbed-2, perturbed-3, un-perturbed ].</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// we compute un-perturbed twice to double-check the model did not change.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    std::vector&lt;BaseFloat&gt; measured_objf(num_directions + 2, 0.0),</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        predicted_objf_change(num_directions + 2, 0.0);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> delta = 1.0e-03;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// output_deriv is the derivative of the objective function w.r.t. the</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// (single) output.  We make the objf a linear function of the output and</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// just set the output_deriv to be a random matrix, which defines the</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// objective function.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    output_deriv.<a class="code" href="classkaldi_1_1CuMatrix.html#af7e3e65772a6eb29e22069822a0fb441">Resize</a>(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].indexes.size(),</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                        nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a8a6a18ddf875235b4e75f0670bfba421">OutputDim</a>(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    output_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    std::vector&lt;CuMatrix&lt;BaseFloat&gt; &gt; delta_inputs(inputs.size());</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    std::vector&lt;CuMatrix&lt;BaseFloat&gt; &gt; input_derivs(inputs.size());</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// pass 0 is the forward pass with the un-perturbed features; so is</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// pass num_directions + 1.</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// Other passes are with various differently-perturbed versions of</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// the features.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">for</span> (int32 pass = 0; pass &lt;= num_directions + 1; pass++) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="comment">// the only reason we might need to provide the &amp;nnet parameter is if the</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// StoreStats() operation had been requested.  We made sure no model update</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="comment">// is being performed.</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> computer(compute_opts,</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                            computation,</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                            nnet,</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                            &amp;nnet);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="comment">// provide the input to the computations.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp(inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">if</span> (pass &gt; 0 &amp;&amp; pass &lt;= num_directions) {  <span class="comment">// Perturb the input randomly.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          delta_inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].Resize(inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].NumRows(), inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].NumCols());</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          delta_inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].SetRandn();</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;          delta_inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].Scale(delta);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;          <span class="comment">// if there are &gt;1 inputs, sometimes set the delta for input 0 to</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          <span class="comment">// zero.  might sometimes give more accurate test of error in iVector</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;          <span class="comment">// derivative computation.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0 &amp;&amp; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size() &gt; 1 &amp;&amp; <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            delta_inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].SetZero();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;          temp.AddMat(1.0, delta_inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          predicted_objf_change[pass] += <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(input_derivs[i],</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                                     delta_inputs[i], <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        computer.AcceptInput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name, &amp;temp);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running forward computation&quot;</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      computer.Run();</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;output(computer.GetOutput(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output sum for pass &quot;</span> &lt;&lt; pass &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; output.Sum();</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output, output_deriv, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      measured_objf[pass] = objf;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">if</span> (pass == 0) {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="comment">// We need to compute the input derivatives.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp(output_deriv);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        computer.AcceptInput(<span class="stringliteral">&quot;output&quot;</span>, &amp;temp);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running backward computation&quot;</span>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        computer.Run();</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          input_derivs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = computer.GetOutput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input-deriv norm for &#39;&quot;</span> &lt;&lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;&#39; is &quot;</span> &lt;&lt; input_derivs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].FrobeniusNorm();</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(measured_objf[0],</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                             measured_objf[num_directions + 1]));</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> predicted_objf_change_vec(num_directions),</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        measured_objf_change_vec(num_directions);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> &lt; num_directions; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> predicted_change = predicted_objf_change[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>+1],</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                 measured_change = measured_objf[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>+1] - measured_objf[0];</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      predicted_objf_change_vec(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) = predicted_change;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      measured_objf_change_vec(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) = measured_change;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Vector of predicted objf-change is: &quot;</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;              &lt;&lt; predicted_objf_change_vec;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Vector of measured objf-change is: &quot;</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;              &lt;&lt; measured_objf_change_vec;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;     <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> delta_thresh_warn = 0.05, delta_thresh_fail = 0.25;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(predicted_objf_change_vec,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                     measured_objf_change_vec, delta_thresh_fail)) {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a4cda4da2254dd2dfe1800e4dfeebec38">NnetIsRecurrent</a>(nnet)) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Predicted and measured objf-changes differ too much. &quot;</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;(would normally be beyond error threshold, but this &quot;</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;nnet is recurrent, so letting it pass.&quot;</span>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Predicted and measured objf-changes differ too much.&quot;</span>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(predicted_objf_change_vec,</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                            measured_objf_change_vec, delta_thresh_warn)) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Predicted and measured objf-changes differ quite a lot&quot;</span>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a58c542fffb7e7f754148c264c90b4a5e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">kaldi::nnet3::ComputationRequest::need_model_derivative</a></div><div class="ttdeci">bool need_model_derivative</div><div class="ttdoc">if need_model_derivative is true, then we&amp;#39;ll be doing either model training or model-derivative compu...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00121">nnet-computation.h:121</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html_a398527b3e9e358c345c5047b16871957"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">kaldi::nnet3::NnetComputeOptions::debug</a></div><div class="ttdeci">bool debug</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00040">nnet-compute.h:40</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationChecker_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationChecker.html">kaldi::nnet3::ComputationChecker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00411">nnet-analyze.h:411</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00115">nnet-computation.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a8a6a18ddf875235b4e75f0670bfba421"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a8a6a18ddf875235b4e75f0670bfba421">kaldi::nnet3::Nnet::OutputDim</a></div><div class="ttdeci">int32 OutputDim(const std::string &amp;output_name) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00677">nnet-nnet.cc:677</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">kaldi::nnet3::NnetComputeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00039">nnet-compute.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CompilerOptions.html">kaldi::nnet3::CompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00034">nnet-compile.h:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2370ad59bd8f6a9f348193b491d88d8a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">kaldi::nnet3::ComputeExampleComputationRequestSimple</a></div><div class="ttdeci">void ComputeExampleComputationRequestSimple(const Nnet &amp;nnet, ComputationRequest *request, std::vector&lt; Matrix&lt; BaseFloat &gt; &gt; *inputs)</div><div class="ttdoc">This function computes an example computation request, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01338">nnet-test-utils.cc:1338</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac580549257041c725612ff223c99e43c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac580549257041c725612ff223c99e43c">kaldi::nnet3::MaxOutputTimeInRequest</a></div><div class="ttdeci">int32 MaxOutputTimeInRequest(const ComputationRequest &amp;request)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00484">nnet-optimize.cc:484</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">kaldi::nnet3::NnetOptimizeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a602819d33d3a59c128aa4e865e610e14"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a602819d33d3a59c128aa4e865e610e14">kaldi::nnet3::Optimize</a></div><div class="ttdeci">void Optimize(const NnetOptimizeOptions &amp;config, const Nnet &amp;nnet, int32 max_output_time_in_request, NnetComputation *computation)</div><div class="ttdoc">This is the top-level function for optimizing a computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00501">nnet-optimize.cc:501</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html_ab342a2855f4c0a04a1c4f565405e1b93"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">kaldi::nnet3::CheckComputationOptions::check_rewrite</a></div><div class="ttdeci">bool check_rewrite</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00394">nnet-analyze.h:394</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html">kaldi::CuMatrixBase</a></div><div class="ttdoc">Matrix for CUDA computing. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00069">matrix-common.h:69</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputer_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputer.html">kaldi::nnet3::NnetComputer</a></div><div class="ttdoc">class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00059">nnet-compute.h:59</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00116">nnet-computation.h:116</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html">kaldi::nnet3::Compiler</a></div><div class="ttdoc">This class creates an initial version of the NnetComputation, without any optimization or sharing of ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00044">nnet-compile.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4cda4da2254dd2dfe1800e4dfeebec38"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4cda4da2254dd2dfe1800e4dfeebec38">kaldi::nnet3::NnetIsRecurrent</a></div><div class="ttdeci">bool NnetIsRecurrent(const Nnet &amp;nnet)</div><div class="ttdoc">Returns true if &amp;#39;nnet&amp;#39; has some kind of recurrency. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l01347">nnet-utils.cc:1347</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">kaldi::nnet3::CheckComputationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00391">nnet-analyze.h:391</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html_af7e3e65772a6eb29e22069822a0fb441"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html#af7e3e65772a6eb29e22069822a0fb441">kaldi::CuMatrix::Resize</a></div><div class="ttdeci">void Resize(MatrixIndexT rows, MatrixIndexT cols, MatrixResizeType resize_type=kSetZero, MatrixStrideType stride_type=kDefaultStride)</div><div class="ttdoc">Allocate the memory. </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l00049">cu-matrix.cc:49</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2b4b0e8d73b17875e8bc5cc492e79b71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b4b0e8d73b17875e8bc5cc492e79b71">&#9670;&nbsp;</a></span>UnitTestNnetIo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetIo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3_2nnet-nnet-test_8cc_source.html#l00027">27</a> of file <a class="el" href="nnet3_2nnet-nnet-test_8cc_source.html">nnet-nnet-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00586">Nnet::Read()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00630">Nnet::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3_2nnet-nnet-test_8cc_source.html#l00061">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                      {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 100; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    </div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    std::istringstream is(configs[0]);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os, binary);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">const</span> std::string &amp;original_output = os.str();</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    std::istringstream nnet_is(original_output);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#ab1b9ede63de755642e79f7287a62b92c">Read</a>(nnet_is, binary);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    std::istringstream nnet_is2(original_output);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet2;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    nnet2.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#ab1b9ede63de755642e79f7287a62b92c">Read</a>(nnet_is2, binary);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    std::ostringstream os2, os3;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os2, binary);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    nnet2.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a3f9bb17f4bc2798da3b469f9e45157d6">Write</a>(os3, binary);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">if</span> (binary) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os2.str() == original_output);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os3.str() == original_output);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  }</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a3f9bb17f4bc2798da3b469f9e45157d6"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a3f9bb17f4bc2798da3b469f9e45157d6">kaldi::nnet3::Nnet::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;ostream, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00630">nnet-nnet.cc:630</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_ab1b9ede63de755642e79f7287a62b92c"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#ab1b9ede63de755642e79f7287a62b92c">kaldi::nnet3::Nnet::Read</a></div><div class="ttdeci">void Read(std::istream &amp;istream, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00586">nnet-nnet.cc:586</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc5c658def484ea9be939487a4b60465"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc5c658def484ea9be939487a4b60465">&#9670;&nbsp;</a></span>UnitTestNnetMergeExamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetMergeExamples </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-test_8cc_source.html#l00067">67</a> of file <a class="el" href="nnet-example-test_8cc_source.html">nnet-example-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-test-utils_8cc_source.html#l01816">GenerateSimpleNnetTrainingExample()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-example-utils_8cc_source.html#l00162">MergeExamples()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, and <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00103">NnetExample::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-test_8cc_source.html#l00103">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                                 {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 50; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    int32 num_supervised_frames = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10),</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                   left_context = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 5),</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                  right_context = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 5),</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                      input_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 10),</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                     output_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(5, 10),</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                    ivector_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-1, 2);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    int32 num_egs = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 4);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    std::vector&lt;NnetExample&gt; egs_to_be_merged(num_egs);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_egs; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="comment">// sometimes omit the ivector.  just tests things a bit more</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="comment">// thoroughly.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a8263b0802f12a823d6c072b53c4ee236">GenerateSimpleNnetTrainingExample</a>(num_supervised_frames, left_context,</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                        right_context, input_dim, output_dim,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                                        <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0 ? 0 : ivector_dim,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                        &amp;eg);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;&#39;th example to be merged is: &quot;</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a68f354fd5f096134162f01719096e6fc">Write</a>(std::cerr, <span class="keyword">false</span>);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      egs_to_be_merged[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].Swap(&amp;eg);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg_merged;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordtype">bool</span> compress = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee">MergeExamples</a>(egs_to_be_merged, compress, &amp;eg_merged);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Merged example is: &quot;</span>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    eg_merged.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a68f354fd5f096134162f01719096e6fc">Write</a>(std::cerr, <span class="keyword">false</span>);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html">kaldi::nnet3::NnetExample</a></div><div class="ttdoc">NnetExample is the input data and corresponding label (or labels) for one or more frames of input...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00111">nnet-example.h:111</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8263b0802f12a823d6c072b53c4ee236"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8263b0802f12a823d6c072b53c4ee236">kaldi::nnet3::GenerateSimpleNnetTrainingExample</a></div><div class="ttdeci">void GenerateSimpleNnetTrainingExample(int32 num_supervised_frames, int32 left_context, int32 right_context, int32 output_dim, int32 input_dim, int32 ivector_dim, NnetExample *example)</div><div class="ttdoc">Low-level function that generates an nnet training example. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01816">nnet-test-utils.cc:1816</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_a68f354fd5f096134162f01719096e6fc"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#a68f354fd5f096134162f01719096e6fc">kaldi::nnet3::NnetExample::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;os, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8cc_source.html#l00103">nnet-example.cc:103</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4ceebc46ef1be292f6b2ff71cc1128ee"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4ceebc46ef1be292f6b2ff71cc1128ee">kaldi::nnet3::MergeExamples</a></div><div class="ttdeci">void MergeExamples(const std::vector&lt; NnetExample &gt; &amp;src, bool compress, NnetExample *merged_eg)</div><div class="ttdoc">Merge a set of input examples into a single example (typically the size of &quot;src&quot; will be the minibatc...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-utils_8cc_source.html#l00162">nnet-example-utils.cc:162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a557038a07d45e34088f4943c2a668b2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a557038a07d45e34088f4943c2a668b2b">&#9670;&nbsp;</a></span>UnitTestNnetModelDerivatives()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestNnetModelDerivatives </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-derivative-test_8cc_source.html#l00091">91</a> of file <a class="el" href="nnet-derivative-test_8cc_source.html">nnet-derivative-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00542">NnetComputer::AcceptInput()</a>, <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00716">CachingOptimizingCompiler::Compile()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="nnet3_2nnet-compute_8h_source.html#l00040">NnetComputeOptions::debug</a>, <a class="el" href="nnet-utils_8cc_source.html#l00250">DotProduct()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00573">NnetComputer::GetOutput()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-computation_8h_source.html#l00121">ComputationRequest::need_model_derivative</a>, <a class="el" href="nnet-utils_8cc_source.html#l01347">NnetIsRecurrent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00677">Nnet::OutputDim()</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="nnet-utils_8cc_source.html#l00199">PerturbParams()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00049">CuMatrix&lt; Real &gt;::Resize()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00508">NnetComputer::Run()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00303">ScaleNnet()</a>, <a class="el" href="nnet-derivative-test_8cc_source.html#l00046">SetDerivTimesOptions()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00292">SetNnetAsGradient()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-derivative-test_8cc_source.html#l00421">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                    {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  int32 N = 20;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">//gen_config.allow_nonlinearity = false;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">//gen_config.allow_recursion = false;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">//gen_config.allow_final_nonlinearity = true;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">bool</span> limit_deriv_times = (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 2) == 0);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    std::vector&lt;Matrix&lt;BaseFloat&gt; &gt; inputs;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request, &amp;inputs);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// make sure that a model-derivative is requested, and an output-derivative</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// is supplied.</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].has_deriv = <span class="keyword">true</span>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// whether input-derivatives are required or not does not matter,</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// so leave it as it is in that regard.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> optimize_opts;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">CachingOptimizingCompilerOptions</a> compiler_opts;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span> (limit_deriv_times) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#abfc29da249703fa1e9c54cf85f6f0ef1">SetDerivTimesOptions</a>(request, &amp;optimize_opts);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">CachingOptimizingCompiler</a> compiler(nnet, optimize_opts,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                       compiler_opts);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation = *(compiler.Compile(request));</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      std::ostringstream os;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(os, nnet);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Optimized computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet_deriv(nnet);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">ScaleNnet</a>(0.0, &amp;nnet_deriv);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ab5c7a956c7fc10e9e5d67f351498c243">SetNnetAsGradient</a>(&amp;nnet_deriv);     <span class="comment">// forces &quot;simple&quot; update and unit</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                        <span class="comment">// learning rate.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    int32 num_directions = 4;  <span class="comment">// must be &gt;= 1.  Best if it&#39;s &gt;1, will reduce</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                               <span class="comment">// the probability of random failures.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// the order of these vectors is:</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// [ un-perturbed, perturbed-1, perturbed-2, perturbed-3 ].</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    std::vector&lt;BaseFloat&gt; measured_objf(num_directions + 1, 0.0),</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        predicted_objf_change(num_directions + 1, 0.0);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> delta = 5.0e-04;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// output_deriv is the derivative of the objective function w.r.t. the</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// (single) output.  We make the objf a linear function of the output and</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// just set the output_deriv to be a random matrix, which defines the</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// objective function.</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    output_deriv.<a class="code" href="classkaldi_1_1CuMatrix.html#af7e3e65772a6eb29e22069822a0fb441">Resize</a>(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].indexes.size(),</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a8a6a18ddf875235b4e75f0670bfba421">OutputDim</a>(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    output_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">NnetComputeOptions</a> compute_opts;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      compute_opts.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">debug</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// pass 0 is the forward pass with the un-perturbed model.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// Other passes are with various differently-perturbed versions of</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// the model.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">for</span> (int32 pass = 0; pass &lt;= num_directions; pass++) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet_copy(nnet);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordflow">if</span> (pass &gt; 0)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a2ca498bb15fc664236fdd7316a1b8831">PerturbParams</a>(delta, &amp;nnet_copy);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> computer(compute_opts,</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                            computation,</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                            nnet_copy,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                            (pass == 0 ? &amp;nnet_deriv : &amp;nnet_copy));</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="comment">// provide the input to the computation.</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp(inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        computer.AcceptInput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name, &amp;temp);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running forward computation&quot;</span>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      computer.Run();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;output(computer.GetOutput(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output sum for pass &quot;</span> &lt;&lt; pass &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; output.Sum();</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(output, output_deriv, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      measured_objf[pass] = objf;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (pass == 0) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="comment">// we need to do the backward computation (to get the model derivative)</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp(output_deriv);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        computer.AcceptInput(<span class="stringliteral">&quot;output&quot;</span>, &amp;temp);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running backward computation&quot;</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        computer.Run();</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// work out the predicted objf-change as dot-product of deriv and</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// parameter-change.  The expression below can be interpreted as</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// DotProduct(nnet_copy - nnet, nnet_deriv).</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        predicted_objf_change[pass] = <a class="code" href="namespacekaldi_1_1nnet3.html#a4dc8f245e845514d33d24ecf1a054406">DotProduct</a>(nnet_copy, nnet_deriv) -</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                      <a class="code" href="namespacekaldi_1_1nnet3.html#a4dc8f245e845514d33d24ecf1a054406">DotProduct</a>(nnet, nnet_deriv);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> predicted_objf_change_vec(num_directions),</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        measured_objf_change_vec(num_directions);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> &lt; num_directions; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> predicted_change = predicted_objf_change[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>+1],</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                 measured_change = measured_objf[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>+1] - measured_objf[0];</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      predicted_objf_change_vec(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) = predicted_change;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      measured_objf_change_vec(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) = measured_change;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Vector of predicted objf-change is: &quot;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;              &lt;&lt; predicted_objf_change_vec;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Vector of measured objf-change is: &quot;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;              &lt;&lt; measured_objf_change_vec;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> delta_thresh_warn = 0.05, delta_thresh_fail = 0.25;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span> (limit_deriv_times) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Not checking that predicted/measured changes matched &quot;</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;because we limited times of derivatives.&quot;</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(predicted_objf_change_vec,</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                       measured_objf_change_vec, delta_thresh_fail)) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#a4cda4da2254dd2dfe1800e4dfeebec38">NnetIsRecurrent</a>(nnet)) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Predicted and measured objf-changes differ too much. &quot;</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;(would normally be beyond error threshold, but this &quot;</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;nnet is recurrent, so letting it pass.&quot;</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Predicted and measured objf-changes differ too much.&quot;</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(predicted_objf_change_vec,</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                       measured_objf_change_vec, delta_thresh_warn)) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Predicted and measured objf-changes differ quite a lot.&quot;</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a62b3a3e7be6ebc2a2af34bdb347ec76a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">kaldi::nnet3::ScaleNnet</a></div><div class="ttdeci">void ScaleNnet(BaseFloat scale, Nnet *nnet)</div><div class="ttdoc">Scales the nnet parameters and stats by this scale. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00303">nnet-utils.cc:303</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a58c542fffb7e7f754148c264c90b4a5e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">kaldi::nnet3::ComputationRequest::need_model_derivative</a></div><div class="ttdeci">bool need_model_derivative</div><div class="ttdoc">if need_model_derivative is true, then we&amp;#39;ll be doing either model training or model-derivative compu...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00121">nnet-computation.h:121</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">kaldi::nnet3::CachingOptimizingCompiler</a></div><div class="ttdoc">This class enables you to do the compilation and optimization in one call, and also ensures that if t...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00219">nnet-optimize.h:219</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a849faa82711b6faa8551205167721bfa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00717">nnet-computation.cc:717</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html_a398527b3e9e358c345c5047b16871957"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">kaldi::nnet3::NnetComputeOptions::debug</a></div><div class="ttdeci">bool debug</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00040">nnet-compute.h:40</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00115">nnet-computation.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_abfc29da249703fa1e9c54cf85f6f0ef1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#abfc29da249703fa1e9c54cf85f6f0ef1">kaldi::nnet3::SetDerivTimesOptions</a></div><div class="ttdeci">void SetDerivTimesOptions(const ComputationRequest &amp;request, NnetOptimizeOptions *opt_config)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-derivative-test_8cc_source.html#l00046">nnet-derivative-test.cc:46</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a8a6a18ddf875235b4e75f0670bfba421"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a8a6a18ddf875235b4e75f0670bfba421">kaldi::nnet3::Nnet::OutputDim</a></div><div class="ttdeci">int32 OutputDim(const std::string &amp;output_name) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00677">nnet-nnet.cc:677</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">kaldi::nnet3::NnetComputeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00039">nnet-compute.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab5c7a956c7fc10e9e5d67f351498c243"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab5c7a956c7fc10e9e5d67f351498c243">kaldi::nnet3::SetNnetAsGradient</a></div><div class="ttdeci">void SetNnetAsGradient(Nnet *nnet)</div><div class="ttdoc">Sets nnet as gradient by Setting is_gradient_ to true and learning_rate_ to 1 for each UpdatableCompo...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00292">nnet-utils.cc:292</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">kaldi::nnet3::CachingOptimizingCompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00192">nnet-optimize.h:192</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2370ad59bd8f6a9f348193b491d88d8a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">kaldi::nnet3::ComputeExampleComputationRequestSimple</a></div><div class="ttdeci">void ComputeExampleComputationRequestSimple(const Nnet &amp;nnet, ComputationRequest *request, std::vector&lt; Matrix&lt; BaseFloat &gt; &gt; *inputs)</div><div class="ttdoc">This function computes an example computation request, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01338">nnet-test-utils.cc:1338</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">kaldi::nnet3::NnetOptimizeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4dc8f245e845514d33d24ecf1a054406"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4dc8f245e845514d33d24ecf1a054406">kaldi::nnet3::DotProduct</a></div><div class="ttdeci">BaseFloat DotProduct(const Nnet &amp;nnet1, const Nnet &amp;nnet2)</div><div class="ttdoc">Returns dot product between two networks of the same structure (calls the DotProduct functions of the...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00250">nnet-utils.cc:250</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html">kaldi::CuMatrixBase</a></div><div class="ttdoc">Matrix for CUDA computing. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00069">matrix-common.h:69</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputer_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputer.html">kaldi::nnet3::NnetComputer</a></div><div class="ttdoc">class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00059">nnet-compute.h:59</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00116">nnet-computation.h:116</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2ca498bb15fc664236fdd7316a1b8831"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2ca498bb15fc664236fdd7316a1b8831">kaldi::nnet3::PerturbParams</a></div><div class="ttdeci">void PerturbParams(BaseFloat stddev, Nnet *nnet)</div><div class="ttdoc">Calls PerturbParams (with the given stddev) on all updatable components of the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00199">nnet-utils.cc:199</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4cda4da2254dd2dfe1800e4dfeebec38"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4cda4da2254dd2dfe1800e4dfeebec38">kaldi::nnet3::NnetIsRecurrent</a></div><div class="ttdeci">bool NnetIsRecurrent(const Nnet &amp;nnet)</div><div class="ttdoc">Returns true if &amp;#39;nnet&amp;#39; has some kind of recurrency. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l01347">nnet-utils.cc:1347</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html_af7e3e65772a6eb29e22069822a0fb441"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html#af7e3e65772a6eb29e22069822a0fb441">kaldi::CuMatrix::Resize</a></div><div class="ttdeci">void Resize(MatrixIndexT rows, MatrixIndexT cols, MatrixResizeType resize_type=kSetZero, MatrixStrideType stride_type=kDefaultStride)</div><div class="ttdoc">Allocate the memory. </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l00049">cu-matrix.cc:49</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d3983f63fe3e84e488bc3e27a67e540"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d3983f63fe3e84e488bc3e27a67e540">&#9670;&nbsp;</a></span>UnitTestNnetOptimize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::UnitTestNnetOptimize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-test_8cc_source.html#l00295">295</a> of file <a class="el" href="nnet-optimize-test_8cc_source.html">nnet-optimize-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, and <a class="el" href="nnet-optimize-test_8cc_source.html#l00194">UnitTestNnetOptimizeInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-test_8cc_source.html#l00308">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                   {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">for</span> (int32 srand_seed = 0; srand_seed &lt; 40; srand_seed++) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;About to run UnitTestNnetOptimizeInternal with srand_seed = &quot;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;              &lt;&lt; srand_seed;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a838307c42c116ba041c7df5f051f3fb9">UnitTestNnetOptimizeInternal</a>(srand_seed);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a838307c42c116ba041c7df5f051f3fb9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a838307c42c116ba041c7df5f051f3fb9">kaldi::nnet3::UnitTestNnetOptimizeInternal</a></div><div class="ttdeci">static void UnitTestNnetOptimizeInternal(int32 srand_seed)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-test_8cc_source.html#l00194">nnet-optimize-test.cc:194</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a838307c42c116ba041c7df5f051f3fb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a838307c42c116ba041c7df5f051f3fb9">&#9670;&nbsp;</a></span>UnitTestNnetOptimizeInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::UnitTestNnetOptimizeInternal </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>srand_seed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-test_8cc_source.html#l00194">194</a> of file <a class="el" href="nnet-optimize-test_8cc_source.html">nnet-optimize-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize_8h_source.html#l00051">NnetOptimizeOptions::allocate_from_other</a>, <a class="el" href="nnet-optimize_8h_source.html#l00041">NnetOptimizeOptions::backprop_in_place</a>, <a class="el" href="nnet-optimize_8h_source.html#l00045">NnetOptimizeOptions::convert_addition</a>, <a class="el" href="nnet-optimize_8h_source.html#l00049">NnetOptimizeOptions::initialize_undefined</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>, <a class="el" href="nnet-optimize_8h_source.html#l00053">NnetOptimizeOptions::max_deriv_time</a>, <a class="el" href="nnet-optimize_8h_source.html#l00054">NnetOptimizeOptions::max_deriv_time_relative</a>, <a class="el" href="nnet-optimize_8h_source.html#l00052">NnetOptimizeOptions::min_deriv_time</a>, <a class="el" href="nnet-optimize_8h_source.html#l00050">NnetOptimizeOptions::move_sizing_commands</a>, <a class="el" href="nnet-optimize_8h_source.html#l00042">NnetOptimizeOptions::optimize_row_ops</a>, <a class="el" href="nnet-optimize_8h_source.html#l00040">NnetOptimizeOptions::propagate_in_place</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00046">NnetOptimizeOptions::remove_assignments</a>, <a class="el" href="nnet-optimize_8h_source.html#l00055">NnetOptimizeOptions::snip_row_ops</a>, <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">UnitTestNnetOptimizeWithOptions()</a>, and <a class="el" href="nnet-optimize_8h_source.html#l00193">CachingOptimizingCompilerOptions::use_shortcut</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-test_8cc_source.html#l00295">UnitTestNnetOptimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                                           {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> optimize_all;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">CachingOptimizingCompilerOptions</a> compiler_all;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="comment">// randomly sometimes set min_deriv and max_deriv to small/large values,</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="comment">// which will cause some of the LimitDerivativeTimes() code to be called</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="comment">// (without really changing anything).</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0) optimize_all.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">min_deriv_time</a> = -200;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 3) == 0) optimize_all.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">max_deriv_time</a> = 1000;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// this is useful for debugging as it removes nans:</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// optimize_all.initialize_undefined = false;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordtype">bool</span> success = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize_all,</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                                 compiler_all);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">if</span> (success)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">// Test failed with full optimization. Slowly retry with various</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// optimizations switched off.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> optimize = optimize_all;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">CachingOptimizingCompilerOptions</a> compiler = compiler_all;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  compiler.<a class="code" href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html#a9f9487f5a6f9d6a474d97a154cd08b10">use_shortcut</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordtype">bool</span> succ_no_shortcut = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                                          compiler);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  compiler = compiler_all;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a8de177378a5c3ef537b9d5927012427d">propagate_in_place</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordtype">bool</span> succ_no_propagate_in_place = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                                                    compiler);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a751610db82b663a3b2b415a839b0cad4">backprop_in_place</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">bool</span> succ_no_backprop_in_place = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                                                   compiler);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a62f84b7d1cb40e1f98a6cd8732efcba0">optimize_row_ops</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordtype">bool</span> succ_no_row_ops = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                                         compiler);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a916c64dcfc34c507c77acdbb02457562">convert_addition</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">bool</span> succ_no_convert_addition = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                                                                  compiler);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a5a9cf0a0e6fa879ef136d18e4b3a7493">remove_assignments</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordtype">bool</span> succ_no_remove_assignments = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                                                    compiler);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#afc411b18b95a954ce30c56a8c802571c">initialize_undefined</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">bool</span> succ_no_initialize_undefined = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                                                      compiler);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#aeb266389b29b812033c443a46a906a15">allocate_from_other</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">bool</span> succ_no_allocate_from_other = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                                                     compiler);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#addc98e404df5dfefac47028896957554">move_sizing_commands</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">bool</span> succ_no_move_sizing_commands = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                                                      compiler);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a00a502ab79e8521e4ef2fdde4cf8add5">snip_row_ops</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">bool</span> succ_no_snip_row_ops = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                                              compiler);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">min_deriv_time</a> = std::numeric_limits&lt;int32&gt;::min();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">max_deriv_time</a> = std::numeric_limits&lt;int32&gt;::max();</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  optimize.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3f8e63332a3fd6f3e8c0d357ede046f5">max_deriv_time_relative</a> = std::numeric_limits&lt;int32&gt;::max();</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordtype">bool</span> succ_no_deriv_time = <a class="code" href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">UnitTestNnetOptimizeWithOptions</a>(srand_seed, optimize,</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                                            compiler);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  optimize = optimize_all;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#define KALDI_SUCCFAIL(b) ((b) ? &quot;SUCCESS&quot; : &quot;FAILURE&quot;)</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;Test failed with all optimizations enabled. Retried test with the &quot;</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;following optimizations turned off:&quot;</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  use_shortcut         ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_shortcut)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  propagate_in_place   ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_propagate_in_place)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  backprop_in_place    ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_backprop_in_place)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  optimize_row_ops     ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_row_ops)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  convert_addition     ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_convert_addition)</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  remove_assignments   ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_remove_assignments)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  initialize_undefined ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_initialize_undefined)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  allocate_from_other  ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_allocate_from_other)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  move_sizing_commands ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_move_sizing_commands)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  snip_row_ops         ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_snip_row_ops)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;\n  no_deriv_time        ... &quot;</span> &lt;&lt; <a class="code" href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a>(succ_no_deriv_time);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">#undef KALDI_SUCCFAIL</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_aeb266389b29b812033c443a46a906a15"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#aeb266389b29b812033c443a46a906a15">kaldi::nnet3::NnetOptimizeOptions::allocate_from_other</a></div><div class="ttdeci">bool allocate_from_other</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00051">nnet-optimize.h:51</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a62f84b7d1cb40e1f98a6cd8732efcba0"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a62f84b7d1cb40e1f98a6cd8732efcba0">kaldi::nnet3::NnetOptimizeOptions::optimize_row_ops</a></div><div class="ttdeci">bool optimize_row_ops</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00042">nnet-optimize.h:42</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a3f8e63332a3fd6f3e8c0d357ede046f5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3f8e63332a3fd6f3e8c0d357ede046f5">kaldi::nnet3::NnetOptimizeOptions::max_deriv_time_relative</a></div><div class="ttdeci">int32 max_deriv_time_relative</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00054">nnet-optimize.h:54</a></div></div>
<div class="ttc" id="nnet-optimize-test_8cc_html_a0a30890603ea368e7ab3c691dcf04169"><div class="ttname"><a href="nnet-optimize-test_8cc.html#a0a30890603ea368e7ab3c691dcf04169">KALDI_SUCCFAIL</a></div><div class="ttdeci">#define KALDI_SUCCFAIL(b)</div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_addc98e404df5dfefac47028896957554"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#addc98e404df5dfefac47028896957554">kaldi::nnet3::NnetOptimizeOptions::move_sizing_commands</a></div><div class="ttdeci">bool move_sizing_commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00050">nnet-optimize.h:50</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a5a9cf0a0e6fa879ef136d18e4b3a7493"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a5a9cf0a0e6fa879ef136d18e4b3a7493">kaldi::nnet3::NnetOptimizeOptions::remove_assignments</a></div><div class="ttdeci">bool remove_assignments</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00046">nnet-optimize.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a8871c28ddb5af8735abd397019ba409d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a8871c28ddb5af8735abd397019ba409d">kaldi::nnet3::UnitTestNnetOptimizeWithOptions</a></div><div class="ttdeci">static bool UnitTestNnetOptimizeWithOptions(int32 srand_seed, NnetOptimizeOptions opt_config, CachingOptimizingCompilerOptions compiler_config)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-test_8cc_source.html#l00033">nnet-optimize-test.cc:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a3d087b2a181462f940490eeba587d5ed"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">kaldi::nnet3::NnetOptimizeOptions::min_deriv_time</a></div><div class="ttdeci">int32 min_deriv_time</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00052">nnet-optimize.h:52</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">kaldi::nnet3::CachingOptimizingCompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00192">nnet-optimize.h:192</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a00a502ab79e8521e4ef2fdde4cf8add5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a00a502ab79e8521e4ef2fdde4cf8add5">kaldi::nnet3::NnetOptimizeOptions::snip_row_ops</a></div><div class="ttdeci">bool snip_row_ops</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00055">nnet-optimize.h:55</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a916c64dcfc34c507c77acdbb02457562"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a916c64dcfc34c507c77acdbb02457562">kaldi::nnet3::NnetOptimizeOptions::convert_addition</a></div><div class="ttdeci">bool convert_addition</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00045">nnet-optimize.h:45</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a8de177378a5c3ef537b9d5927012427d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a8de177378a5c3ef537b9d5927012427d">kaldi::nnet3::NnetOptimizeOptions::propagate_in_place</a></div><div class="ttdeci">bool propagate_in_place</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00040">nnet-optimize.h:40</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">kaldi::nnet3::NnetOptimizeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions_html_a9f9487f5a6f9d6a474d97a154cd08b10"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html#a9f9487f5a6f9d6a474d97a154cd08b10">kaldi::nnet3::CachingOptimizingCompilerOptions::use_shortcut</a></div><div class="ttdeci">bool use_shortcut</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00193">nnet-optimize.h:193</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a751610db82b663a3b2b415a839b0cad4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a751610db82b663a3b2b415a839b0cad4">kaldi::nnet3::NnetOptimizeOptions::backprop_in_place</a></div><div class="ttdeci">bool backprop_in_place</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00041">nnet-optimize.h:41</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a3eb30cd32859e75b85a514ee9747f9ef"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">kaldi::nnet3::NnetOptimizeOptions::max_deriv_time</a></div><div class="ttdeci">int32 max_deriv_time</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00053">nnet-optimize.h:53</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_afc411b18b95a954ce30c56a8c802571c"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#afc411b18b95a954ce30c56a8c802571c">kaldi::nnet3::NnetOptimizeOptions::initialize_undefined</a></div><div class="ttdeci">bool initialize_undefined</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00049">nnet-optimize.h:49</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8871c28ddb5af8735abd397019ba409d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8871c28ddb5af8735abd397019ba409d">&#9670;&nbsp;</a></span>UnitTestNnetOptimizeWithOptions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classbool.html">bool</a> kaldi::nnet3::UnitTestNnetOptimizeWithOptions </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>srand_seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a>&#160;</td>
          <td class="paramname"><em>opt_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1CachingOptimizingCompilerOptions.html">CachingOptimizingCompilerOptions</a>&#160;</td>
          <td class="paramname"><em>compiler_config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-test_8cc_source.html#l00033">33</a> of file <a class="el" href="nnet-optimize-test_8cc_source.html">nnet-optimize-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00542">NnetComputer::AcceptInput()</a>, <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00579">ComputationChecker::Check()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00394">CheckComputationOptions::check_rewrite</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00716">CachingOptimizingCompiler::Compile()</a>, <a class="el" href="nnet-computation_8cc_source.html#l00084">NnetComputation::ComputeCudaIndexes()</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01338">ComputeExampleComputationRequestSimple()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00050">Compiler::CreateComputation()</a>, <a class="el" href="nnet3_2nnet-compute_8h_source.html#l00040">NnetComputeOptions::debug</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01252">GenerateConfigSequence()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00573">NnetComputer::GetOutput()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-computation_8h_source.html#l00115">ComputationRequest::inputs</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-test-utils_8cc_source.html#l01786">NnetParametersAreIdentical()</a>, <a class="el" href="nnet-computation_8h_source.html#l00116">ComputationRequest::outputs</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00189">Nnet::ReadConfig()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00573">ResetGenerators()</a>, <a class="el" href="nnet3_2nnet-compute_8cc_source.html#l00508">NnetComputer::Run()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00303">ScaleNnet()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00292">SetNnetAsGradient()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="cu-matrix_8cc_source.html#l02979">CuMatrixBase&lt; Real &gt;::Sum()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-test_8cc_source.html#l00194">UnitTestNnetOptimizeInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                                                                              {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="comment">//opt_config.convert_addition = false;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">//opt_config.remove_assignments = false;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">//opt_config.move_sizing_commands = false;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">//opt_config.allocate_from_other = false;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  srand(srand_seed);  <span class="comment">// so that we can compare between differnt optimization types</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                      <span class="comment">// with the randomly generated network staying the same.</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keyword">struct </span><a class="code" href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">NnetGenerationOptions</a> gen_config;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  std::vector&lt;std::string&gt; configs;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">GenerateConfigSequence</a>(gen_config, &amp;configs);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; configs.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input config[&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;] is: &quot;</span> &lt;&lt; configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    std::istringstream is(configs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    nnet.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">ReadConfig</a>(is);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> request;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  std::vector&lt;Matrix&lt;BaseFloat&gt; &gt; inputs;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">ComputeExampleComputationRequestSimple</a>(nnet, &amp;request, &amp;inputs);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> computation;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler(request, nnet);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> opts;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  compiler.CreateComputation(opts, &amp;computation);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(os, nnet);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Generated computation with no optimization or shortcut is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">CheckComputationOptions</a> check_config;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// we can do the rewrite check since it&#39;s before optimization.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  check_config.<a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">check_rewrite</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a> checker(check_config, nnet, computation);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  checker.Check();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">CachingOptimizingCompiler</a> opt_compiler(nnet, opt_config, compiler_config);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation_opt = *opt_compiler.Compile(request);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    computation_opt.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(os, nnet);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Optimized computation is: &quot;</span> &lt;&lt; os.str();</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">NnetComputeOptions</a> compute_opts;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 1) == 0)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    compute_opts.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">debug</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  computation.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac2af1facc3bf90819e78ea5b2bb2554d">ComputeCudaIndexes</a>();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">// computation_opt has already had this function called.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet_to_update(nnet);  <span class="comment">// copy of the nnet that we update...  needed to</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// test the consolidation of backprop commands,</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// otherwise the optimized and non-optimized</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// comptuations differ.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">ScaleNnet</a>(0.0, &amp;nnet_to_update);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// with natural gradient, the consolidation would affect the final model</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">// params -&gt; test just the gradient.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ab5c7a956c7fc10e9e5d67f351498c243">SetNnetAsGradient</a>(&amp;nnet_to_update);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> computer(compute_opts,</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                        computation,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                        nnet,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        &amp;nnet_to_update);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet_opt(nnet);  <span class="comment">// copy of the nnet for the optimized computation.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// necessary in case backprop changes parameters.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> nnet_opt_to_update(nnet_opt);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">ScaleNnet</a>(0.0, &amp;nnet_opt_to_update);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ab5c7a956c7fc10e9e5d67f351498c243">SetNnetAsGradient</a>(&amp;nnet_opt_to_update);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// NnetComputer for the optimized version of the computation.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1NnetComputer.html">NnetComputer</a> computer_opt(compute_opts,</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                            computation_opt,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                            nnet_opt,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                            &amp;nnet_opt_to_update);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// provide the input to the computations.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp(inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input sum is &quot;</span> &lt;&lt; temp.Sum();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    computer.AcceptInput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name, &amp;temp);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> temp2(inputs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    computer_opt.AcceptInput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name, &amp;temp2);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running non-optimized forward computation&quot;</span>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  srand(srand_seed);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a3c2029913de309432ceda98856ca5819">ResetGenerators</a>(&amp;nnet);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  computer.Run();</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running optimized forward computation&quot;</span>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  srand(srand_seed);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a3c2029913de309432ceda98856ca5819">ResetGenerators</a>(&amp;nnet_opt);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  computer_opt.Run();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;output(computer.GetOutput(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output sum (not optimized) is &quot;</span> &lt;&lt; output.Sum();</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;output_opt(computer_opt.GetOutput(<span class="stringliteral">&quot;output&quot;</span>));</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Output sum (optimized) is &quot;</span> &lt;&lt; output_opt.Sum();</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(output, output_opt)) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Non-optimized and optimized versions of the computation give &quot;</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;different outputs: &quot;</span> &lt;&lt; output &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; output_opt;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv(output.NumRows(), output.NumCols());</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  output_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv_opt(output_deriv);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">if</span> (request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>[0].has_deriv) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    computer.AcceptInput(<span class="stringliteral">&quot;output&quot;</span>, &amp;output_deriv);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    computer_opt.AcceptInput(<span class="stringliteral">&quot;output&quot;</span>, &amp;output_deriv_opt);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running non-optimized backward computation&quot;</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    computer.Run();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Running optimized backward computation&quot;</span>;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    computer_opt.Run();</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> (request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].has_deriv) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;in_deriv =</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            computer.GetOutput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keyword">const</span> <a class="code" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase&lt;BaseFloat&gt;</a> &amp;in_deriv_opt =</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            computer_opt.GetOutput(request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input-deriv sum for input &#39;&quot;</span> &lt;&lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;&#39; (non-optimized) is &quot;</span> &lt;&lt; in_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input-deriv sum for input &#39;&quot;</span> &lt;&lt; request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].name</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;&#39; (optimized) is &quot;</span> &lt;&lt; in_deriv_opt.<a class="code" href="classkaldi_1_1CuMatrixBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>();</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(in_deriv, in_deriv_opt)) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Non-optimized and optimized versions of the &quot;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;computation give different input-derivs.&quot;</span>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi_1_1nnet3.html#ac25c4eeb172565878e12ca4355ad9147">NnetParametersAreIdentical</a>(nnet_to_update,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                  nnet_opt_to_update, 1.0e-05)) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Neural networks differ after training, between &quot;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;optimized and non-optimized computation.&quot;</span>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a62b3a3e7be6ebc2a2af34bdb347ec76a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">kaldi::nnet3::ScaleNnet</a></div><div class="ttdeci">void ScaleNnet(BaseFloat scale, Nnet *nnet)</div><div class="ttdoc">Scales the nnet parameters and stats by this scale. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00303">nnet-utils.cc:303</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_a2d86f93445cacbb3af16821e331b564f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#a2d86f93445cacbb3af16821e331b564f">kaldi::nnet3::Nnet::ReadConfig</a></div><div class="ttdeci">void ReadConfig(std::istream &amp;config_file)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00189">nnet-nnet.cc:189</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac25c4eeb172565878e12ca4355ad9147"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac25c4eeb172565878e12ca4355ad9147">kaldi::nnet3::NnetParametersAreIdentical</a></div><div class="ttdeci">bool NnetParametersAreIdentical(const Nnet &amp;nnet1, const Nnet &amp;nnet2, BaseFloat threshold=1.0e-05)</div><div class="ttdoc">Used for testing that the updatable parameters in two networks are the same. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01786">nnet-test-utils.cc:1786</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ac2af1facc3bf90819e78ea5b2bb2554d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac2af1facc3bf90819e78ea5b2bb2554d">kaldi::nnet3::NnetComputation::ComputeCudaIndexes</a></div><div class="ttdeci">void ComputeCudaIndexes()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00084">nnet-computation.cc:84</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html">kaldi::nnet3::CachingOptimizingCompiler</a></div><div class="ttdoc">This class enables you to do the compilation and optimization in one call, and also ensures that if t...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00219">nnet-optimize.h:219</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_ae7089fd656218302336300dc42ae55c1"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#ae7089fd656218302336300dc42ae55c1">kaldi::CuMatrixBase::Sum</a></div><div class="ttdeci">Real Sum() const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l02979">cu-matrix.cc:2979</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a849faa82711b6faa8551205167721bfa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00717">nnet-computation.cc:717</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html_a398527b3e9e358c345c5047b16871957"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html#a398527b3e9e358c345c5047b16871957">kaldi::nnet3::NnetComputeOptions::debug</a></div><div class="ttdeci">bool debug</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00040">nnet-compute.h:40</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetGenerationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetGenerationOptions.html">kaldi::nnet3::NnetGenerationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8h_source.html#l00033">nnet-test-utils.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationChecker_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationChecker.html">kaldi::nnet3::ComputationChecker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00411">nnet-analyze.h:411</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00115">nnet-computation.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputeOptions.html">kaldi::nnet3::NnetComputeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00039">nnet-compute.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab5c7a956c7fc10e9e5d67f351498c243"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab5c7a956c7fc10e9e5d67f351498c243">kaldi::nnet3::SetNnetAsGradient</a></div><div class="ttdeci">void SetNnetAsGradient(Nnet *nnet)</div><div class="ttdoc">Sets nnet as gradient by Setting is_gradient_ to true and learning_rate_ to 1 for each UpdatableCompo...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00292">nnet-utils.cc:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a3c2029913de309432ceda98856ca5819"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a3c2029913de309432ceda98856ca5819">kaldi::nnet3::ResetGenerators</a></div><div class="ttdeci">void ResetGenerators(Nnet *nnet)</div><div class="ttdoc">This function calls &amp;#39;ResetGenerator()&amp;#39; on all components in &amp;#39;nnet&amp;#39; that inherit from class RandomComp...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00573">nnet-utils.cc:573</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CompilerOptions.html">kaldi::nnet3::CompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00034">nnet-compile.h:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00114">nnet-computation.h:114</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2370ad59bd8f6a9f348193b491d88d8a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2370ad59bd8f6a9f348193b491d88d8a">kaldi::nnet3::ComputeExampleComputationRequestSimple</a></div><div class="ttdeci">void ComputeExampleComputationRequestSimple(const Nnet &amp;nnet, ComputationRequest *request, std::vector&lt; Matrix&lt; BaseFloat &gt; &gt; *inputs)</div><div class="ttdoc">This function computes an example computation request, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01338">nnet-test-utils.cc:1338</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html_ab342a2855f4c0a04a1c4f565405e1b93"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">kaldi::nnet3::CheckComputationOptions::check_rewrite</a></div><div class="ttdeci">bool check_rewrite</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00394">nnet-analyze.h:394</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html">kaldi::CuMatrixBase</a></div><div class="ttdoc">Matrix for CUDA computing. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00069">matrix-common.h:69</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1NnetComputer_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1NnetComputer.html">kaldi::nnet3::NnetComputer</a></div><div class="ttdoc">class NnetComputer is responsible for executing the computation described in the &quot;computation&quot; object...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-compute_8h_source.html#l00059">nnet-compute.h:59</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00116">nnet-computation.h:116</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html">kaldi::nnet3::Compiler</a></div><div class="ttdoc">This class creates an initial version of the NnetComputation, without any optimization or sharing of ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00044">nnet-compile.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a9a6ec6b257d100e7dab22ce3feac226f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a9a6ec6b257d100e7dab22ce3feac226f">kaldi::nnet3::GenerateConfigSequence</a></div><div class="ttdeci">void GenerateConfigSequence(const NnetGenerationOptions &amp;opts, std::vector&lt; std::string &gt; *configs)</div><div class="ttdoc">Generates a sequence of at least one config files, output as strings, where the first in the sequence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-test-utils_8cc_source.html#l01252">nnet-test-utils.cc:1252</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">kaldi::nnet3::CheckComputationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00391">nnet-analyze.h:391</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7012eb43a414f870091986ffeec55aea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7012eb43a414f870091986ffeec55aea">&#9670;&nbsp;</a></span>UnitTestPreconditionDirectionsOnline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestPreconditionDirectionsOnline </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="natural-gradient-online-test_8cc_source.html#l00262">262</a> of file <a class="el" href="natural-gradient-online-test_8cc_source.html">natural-gradient-online-test.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8cc_source.html#l00583">CuVectorBase&lt; Real &gt;::AddDiagMatMat()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00128">MatrixBase&lt; Real &gt;::AddVecVec()</a>, <a class="el" href="kaldi-math_8h_source.html#l00275">kaldi::AssertEqual()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="natural-gradient-online-test_8cc_source.html#l00067">OnlineNaturalGradientSimple::PreconditionDirections()</a>, <a class="el" href="natural-gradient-online_8cc_source.html#l00159">OnlineNaturalGradient::PreconditionDirections()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01338">MatrixBase&lt; Real &gt;::Set()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00301">VectorBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="natural-gradient-online-test_8cc_source.html#l00033">OnlineNaturalGradientSimple::SetRank()</a>, <a class="el" href="natural-gradient-online_8cc_source.html#l00602">OnlineNaturalGradient::SetRank()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="natural-gradient-online_8h_source.html#l00429">OnlineNaturalGradient::TurnOnDebug()</a>.</p>

<p class="reference">Referenced by <a class="el" href="natural-gradient-online-test_8cc_source.html#l00326">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                            {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> R = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 30,  <span class="comment">// rank of correction</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      N = (2 * R) + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 30,  <span class="comment">// batch size</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      D = R + 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20; <span class="comment">// problem dimension.  Must be &gt; R.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// Test sometimes with features that are all-zero or all-one; this will</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// help to make sure low-rank or zero input doesn&#39;t crash the code.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordtype">bool</span> zero = <span class="keyword">false</span>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordtype">bool</span> one = <span class="keyword">false</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0) zero = <span class="keyword">true</span>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">//else if (Rand() % 2 == 0) one = true;</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> row_prod1(N);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> gamma1, gamma2;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> big_eig_factor = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 20);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  big_eig_factor = big_eig_factor * big_eig_factor;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> big_eig_vector(D);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  big_eig_vector.SetRandn();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  big_eig_vector.Scale(big_eig_factor);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple.html">OnlineNaturalGradientSimple</a> preconditioner1;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html">OnlineNaturalGradient</a> preconditioner2;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  preconditioner1.<a class="code" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple.html#afb9bffca178027f3e5d52ec73a1ee0fe">SetRank</a>(R);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  preconditioner2.<a class="code" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html#afb9bffca178027f3e5d52ec73a1ee0fe">SetRank</a>(R);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  preconditioner2.<a class="code" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html#a35086953bbc759bd2ac9cb660d87d83f">TurnOnDebug</a>();</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  int32 num_iters = 100;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">for</span> (int32 iter = 0; iter &lt; num_iters; iter++) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> M_cpu(N, D);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (one) M_cpu.Set(1.0);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!zero) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      M_cpu.SetRandn();</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> rand_vec(N);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      rand_vec.SetRandn();</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      M_cpu.AddVecVec(1.0, rand_vec, big_eig_vector);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> M(M_cpu);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> Mcopy1(M), Mcopy2(M);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    preconditioner1.<a class="code" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple.html#a40de84aa34756dd2c783f5f8a131670a">PreconditionDirections</a>(&amp;Mcopy1, &amp;row_prod1, &amp;gamma1);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    preconditioner2.<a class="code" href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html#aa3bcd897525db0c5caa855f1fe5b69ff">PreconditionDirections</a>(&amp;Mcopy2, &amp;gamma2);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> trace1 = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(M, M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>),</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        trace2 = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(Mcopy1, Mcopy1, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(trace1, trace2 * gamma2 * gamma2, 1.0e-02);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(Mcopy1, Mcopy2);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(gamma1, gamma2, 1.0e-02);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// make sure positive definite</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> inner_prods(M.NumRows());</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    inner_prods.<a class="code" href="classkaldi_1_1CuVectorBase.html#a46c4e5094335a6e257a08cb9ae0e7ff0">AddDiagMatMat</a>(1.0, M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Mcopy1, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(inner_prods.Min() &gt;= 0.0);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple_html_afb9bffca178027f3e5d52ec73a1ee0fe"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple.html#afb9bffca178027f3e5d52ec73a1ee0fe">kaldi::nnet3::OnlineNaturalGradientSimple::SetRank</a></div><div class="ttdeci">void SetRank(int32 rank)</div><div class="ttdef"><b>Definition:</b> <a href="natural-gradient-online-test_8cc_source.html#l00033">natural-gradient-online-test.cc:33</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVector_html"><div class="ttname"><a href="classkaldi_1_1CuVector.html">kaldi::CuVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00074">matrix-common.h:74</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1OnlineNaturalGradient_html_afb9bffca178027f3e5d52ec73a1ee0fe"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html#afb9bffca178027f3e5d52ec73a1ee0fe">kaldi::nnet3::OnlineNaturalGradient::SetRank</a></div><div class="ttdeci">void SetRank(int32 rank)</div><div class="ttdef"><b>Definition:</b> <a href="natural-gradient-online_8cc_source.html#l00602">natural-gradient-online.cc:602</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1OnlineNaturalGradient_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html">kaldi::nnet3::OnlineNaturalGradient</a></div><div class="ttdoc">Keywords for search: natural gradient, naturalgradient, NG-SGD. </div><div class="ttdef"><b>Definition:</b> <a href="natural-gradient-online_8h_source.html#l00414">natural-gradient-online.h:414</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVectorBase_html_a46c4e5094335a6e257a08cb9ae0e7ff0"><div class="ttname"><a href="classkaldi_1_1CuVectorBase.html#a46c4e5094335a6e257a08cb9ae0e7ff0">kaldi::CuVectorBase::AddDiagMatMat</a></div><div class="ttdeci">void AddDiagMatMat(Real alpha, const CuMatrixBase&lt; Real &gt; &amp;M, MatrixTransposeType transM, const CuMatrixBase&lt; Real &gt; &amp;N, MatrixTransposeType transN, Real beta=1.0)</div><div class="ttdoc">Add the diagonal of a matrix product: *this = diag(M N), assuming the &quot;trans&quot; arguments are both kNoT...</div><div class="ttdef"><b>Definition:</b> <a href="cu-vector_8cc_source.html#l00583">cu-vector.cc:583</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1OnlineNaturalGradient_html_a35086953bbc759bd2ac9cb660d87d83f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html#a35086953bbc759bd2ac9cb660d87d83f">kaldi::nnet3::OnlineNaturalGradient::TurnOnDebug</a></div><div class="ttdeci">void TurnOnDebug()</div><div class="ttdef"><b>Definition:</b> <a href="natural-gradient-online_8h_source.html#l00429">natural-gradient-online.h:429</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple_html_a40de84aa34756dd2c783f5f8a131670a"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple.html#a40de84aa34756dd2c783f5f8a131670a">kaldi::nnet3::OnlineNaturalGradientSimple::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(CuMatrixBase&lt; BaseFloat &gt; *R, CuVectorBase&lt; BaseFloat &gt; *row_prod, BaseFloat *scale)</div><div class="ttdef"><b>Definition:</b> <a href="natural-gradient-online-test_8cc_source.html#l00067">natural-gradient-online-test.cc:67</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradientSimple.html">kaldi::nnet3::OnlineNaturalGradientSimple</a></div><div class="ttdef"><b>Definition:</b> <a href="natural-gradient-online-test_8cc_source.html#l00028">natural-gradient-online-test.cc:28</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1OnlineNaturalGradient_html_aa3bcd897525db0c5caa855f1fe5b69ff"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1OnlineNaturalGradient.html#aa3bcd897525db0c5caa855f1fe5b69ff">kaldi::nnet3::OnlineNaturalGradient::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(CuMatrixBase&lt; BaseFloat &gt; *R, BaseFloat *scale)</div><div class="ttdoc">This call implements the main functionality of this class. </div><div class="ttdef"><b>Definition:</b> <a href="natural-gradient-online_8cc_source.html#l00159">natural-gradient-online.cc:159</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_aeb6ba6085493e3f15358e49751342177"><div class="ttname"><a href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">kaldi::AssertEqual</a></div><div class="ttdeci">static void AssertEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">assert abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)) </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00275">kaldi-math.h:275</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad179bd30fedc76b302f19fb2cb1e6a60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad179bd30fedc76b302f19fb2cb1e6a60">&#9670;&nbsp;</a></span>UnitTestReadConfig()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestReadConfig </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse-test_8cc_source.html#l00177">177</a> of file <a class="el" href="nnet-parse-test_8cc_source.html">nnet-parse-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-parse_8cc_source.html#l00436">ReadConfigLines()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse-test_8cc_source.html#l00280">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                          {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  std::string str = <span class="stringliteral">&quot;a-b alpha=aa beta=\&quot;b b\&quot;# String test\n&quot;</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="stringliteral">&quot;a-b beta2=&#39;b c&#39; beta3=bd # \n&quot;</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="stringliteral">&quot;a-b gamma=1:2:3:4  # Int Vector test\n&quot;</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="stringliteral">&quot; a-b de1ta=f  # Bool + Integer in key Comment test delta=t  \n&quot;</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="stringliteral">&quot;a-b _epsilon=-1  # Int Vector test _epsilon=1 \n&quot;</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="stringliteral">&quot;a-b zet-_a=0.15   theta=1.1# Float, -, _ test\n&quot;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="stringliteral">&quot;a-b quoted=&#39;a b c&#39; # quoted string\n&quot;</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="stringliteral">&quot;a-b quoted2=\&quot;d e &#39;a b=c&#39; f\&quot; # string quoted with double quotes&quot;</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  std::istringstream is(str);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  std::vector&lt;std::string&gt; lines;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a331cfb436079c33852b5514e6691f6be">ReadConfigLines</a>(is, &amp;lines);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lines.size() == 8);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ConfigLine.html">ConfigLine</a> cfl;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; lines.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.ParseLine(lines[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]) &amp;&amp; cfl.FirstToken() == <span class="stringliteral">&quot;a-b&quot;</span>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (i == 1) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.GetValue(<span class="stringliteral">&quot;beta2&quot;</span>, &amp;str) &amp;&amp; str == <span class="stringliteral">&quot;b c&quot;</span>);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (i == 4) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.GetValue(<span class="stringliteral">&quot;_epsilon&quot;</span>, &amp;str) &amp;&amp; str == <span class="stringliteral">&quot;-1&quot;</span>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (i == 5) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> float_val = 0;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.GetValue(<span class="stringliteral">&quot;zet-_a&quot;</span>, &amp;float_val) &amp;&amp; <a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(float_val, 0.15));</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (i == 6) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.GetValue(<span class="stringliteral">&quot;quoted&quot;</span>, &amp;str) &amp;&amp; str == <span class="stringliteral">&quot;a b c&quot;</span>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (i == 7) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cfl.GetValue(<span class="stringliteral">&quot;quoted2&quot;</span>, &amp;str) &amp;&amp; str == <span class="stringliteral">&quot;d e &#39;a b=c&#39; f&quot;</span>);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ConfigLine_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ConfigLine.html">kaldi::nnet3::ConfigLine</a></div><div class="ttdoc">This class is responsible for parsing input like hi-there xx=yyy a=b c empty= f-oo=Append(bar, sss) ba_z=123 bing=&amp;#39;a b c&amp;#39; baz=&quot;a b c d=&amp;#39;a b&amp;#39; e&quot; and giving you access to the fields, in this case. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8h_source.html#l00048">nnet-parse.h:48</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a331cfb436079c33852b5514e6691f6be"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a331cfb436079c33852b5514e6691f6be">kaldi::nnet3::ReadConfigLines</a></div><div class="ttdeci">void ReadConfigLines(std::istream &amp;is, std::vector&lt; std::string &gt; *lines)</div><div class="ttdoc">This function reads in a config file and *appends* its contents to a vector of lines; it is responsib...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00436">nnet-parse.cc:436</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6242a8c5b093373663b9ec8210946b8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6242a8c5b093373663b9ec8210946b8a">&#9670;&nbsp;</a></span>UnitTestSplitLocations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestSplitLocations </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>verbose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00275">275</a> of file <a class="el" href="nnet-compile-utils-test_8cc_source.html">nnet-compile-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00028">ComparePair::ComparePair()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00377">ConvertToIndexes()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00050">PrintVectorVectorPair()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="nnet-compile-utils_8cc_source.html#l00337">SplitLocations()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00363">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                          {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  int32 minibatch_size = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 1024 + 100;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  int32 num_submat_indexes = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10 + 1;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  int32 max_submat_list_size = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10 + 1;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  int32 min_num_kaddrows = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2; <span class="comment">// minimum number of kAddRows compatible</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">// lists expected in the final split lists. This value will be used to</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// create input submat_lists so that this is guaranteed</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  max_submat_list_size = min_num_kaddrows + max_submat_list_size;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; all_pairs;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  all_pairs.reserve(minibatch_size * max_submat_list_size);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      submat_lists(minibatch_size),</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      split_lists;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  std::vector&lt;int32&gt; submat_indexes(num_submat_indexes);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_submat_indexes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    submat_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// generating submat_lists</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  int32 max_generated_submat_list_size = 0;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; minibatch_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    int32 num_locations = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % max_submat_list_size + 1;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    max_generated_submat_list_size =</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        max_generated_submat_list_size &lt; num_locations ?</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        num_locations : max_generated_submat_list_size;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].reserve(num_locations);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num_locations; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">// note from dan: I edited the following line to resolve a valgrind error</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="comment">// but cannot really understand at this point what this code is doing.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;= min_num_kaddrows &amp;&amp; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num_submat_indexes) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="comment">// since we need min_num_kaddrows in the split_lists we ensure that</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="comment">// we add a pair with the same first element in all the submat_lists</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].push_back(std::make_pair(submat_indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>],</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                                 <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % minibatch_size));</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].push_back(</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          std::make_pair(submat_indexes[<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % num_submat_indexes],</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                         <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % minibatch_size));</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    all_pairs.insert(all_pairs.end(), submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].begin(),</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                     submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].end());</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8">SplitLocations</a>(submat_lists, &amp;split_lists);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordflow">if</span> (verbose)  {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;submat_list&quot;</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ab2fee0700fd475dc0d6b4a9d618e9a72">PrintVectorVectorPair</a>(submat_lists);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;split_lists&quot;</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ab2fee0700fd475dc0d6b4a9d618e9a72">PrintVectorVectorPair</a>(split_lists);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;===========================&quot;</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; split_lists.size();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  int32 num_kaddrows_in_output = 0;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  int32 first_value;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  std::vector&lt;int32&gt; second_values;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">// ensure that elements in submat_lists are also present</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="comment">// in split_lists</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0 ; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_lists.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    second_values.clear();</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">ConvertToIndexes</a>(split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;first_value, &amp;second_values)) {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// Checking if ConvertToIndexes did a proper conversion of the indexes</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordflow">for</span> (int32 j = 0; j &lt; second_values.size(); j++)  {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">if</span> (split_lists[i][j].first != -1)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((split_lists[i][j].first == first_value) &amp;&amp;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                       (split_lists[i][j].second == second_values[j]));</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      num_kaddrows_in_output++;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">for</span> (int32 j = 0; j &lt; split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); j++) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">if</span> (split_lists[i][j].first == -1)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::iterator iter =</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          std::find_if(all_pairs.begin(), all_pairs.end(),</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    <a class="code" href="structkaldi_1_1nnet3_1_1ComparePair.html">ComparePair</a>(split_lists[i][j]));</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter != all_pairs.end());</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      all_pairs.erase(iter);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(all_pairs.size() == 0);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// ensure that there are at least as many kAddRows compatible split_lists as</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// specified</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_kaddrows_in_output &gt;= min_num_kaddrows);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComparePair_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComparePair.html">kaldi::nnet3::ComparePair</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils-test_8cc_source.html#l00026">nnet-compile-utils-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae99488174e8dde27f8f30d91d61c0cd2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">kaldi::nnet3::ConvertToIndexes</a></div><div class="ttdeci">bool ConvertToIndexes(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;location_vector, int32 *first_value, std::vector&lt; int32 &gt; *second_values)</div><div class="ttdoc">If it is the case for some i &gt;= 0 that all the .first elements of &quot;location_vector&quot; are either i or -...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00377">nnet-compile-utils.cc:377</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7c81548b4f8146cd3447b10d556978a8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7c81548b4f8146cd3447b10d556978a8">kaldi::nnet3::SplitLocations</a></div><div class="ttdeci">void SplitLocations(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</div><div class="ttdoc">The input to this function is a vector of lists of pairs, and this function splits it up into a list ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00337">nnet-compile-utils.cc:337</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab2fee0700fd475dc0d6b4a9d618e9a72"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab2fee0700fd475dc0d6b4a9d618e9a72">kaldi::nnet3::PrintVectorVectorPair</a></div><div class="ttdeci">void PrintVectorVectorPair(std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; vec_vec_pair)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils-test_8cc_source.html#l00050">nnet-compile-utils-test.cc:50</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8d72d1c711cbf1c6cb14e49fa474a51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8d72d1c711cbf1c6cb14e49fa474a51">&#9670;&nbsp;</a></span>UnitTestSplitLocationsBackward()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestSplitLocationsBackward </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>verbose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00070">70</a> of file <a class="el" href="nnet-compile-utils-test_8cc_source.html">nnet-compile-utils-test.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00028">ComparePair::ComparePair()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00377">ConvertToIndexes()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00050">PrintVectorVectorPair()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="nnet-compile-utils_8cc_source.html#l00498">SplitLocationsBackward()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compile-utils-test_8cc_source.html#l00363">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                                                  {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  int32 minibatch_size = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 1024 + 100;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  int32 num_submat_indexes = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10 + 1;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  int32 max_submat_list_size = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10 + 1;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  int32 min_num_kaddrows = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2; <span class="comment">// minimum number of kAddRows compatible</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">// lists expected in the final split lists. This value will be used to</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">// create input submat_lists so that this is guaranteed</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  max_submat_list_size = min_num_kaddrows + max_submat_list_size;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; all_pairs;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  all_pairs.reserve(minibatch_size * max_submat_list_size);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  std::vector&lt;std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &gt;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      submat_lists(minibatch_size),</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      split_lists;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  std::vector&lt;int32&gt; submat_indexes(num_submat_indexes);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_submat_indexes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    submat_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>();</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// generating submat_lists</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  int32 max_generated_submat_list_size = 0;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; minibatch_size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    int32 num_locations = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % max_submat_list_size + 1;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    max_generated_submat_list_size =</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        max_generated_submat_list_size &lt; num_locations ?</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        num_locations : max_generated_submat_list_size;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].reserve(num_locations);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num_locations; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;= min_num_kaddrows)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment">// since we need min_num_kaddrows in the split_lists we ensure that</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">// we add a pair with the same first element in all the submat_lists</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].push_back(std::make_pair(submat_indexes[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>],</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                           <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % minibatch_size));</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].push_back(</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          std::make_pair(submat_indexes[<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % num_submat_indexes],</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                         <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % minibatch_size));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    all_pairs.insert(all_pairs.end(), submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].begin(),</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                     submat_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].end());</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a230b979419515f453ee5c8f2bc87a4dd">SplitLocationsBackward</a>(submat_lists, &amp;split_lists);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">// Checking split_lists has all the necessary properties</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_lists.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    int32 first_value;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    std::vector&lt;int32&gt; second_values;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">ConvertToIndexes</a>(split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;first_value, &amp;second_values))  {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="comment">// checking for contiguity and uniqueness of .second elements</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      std::vector&lt;int32&gt; occurred_values;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      int32 prev_value = -10; <span class="comment">// using a negative value as all indices are &gt; 0</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">for</span> (int32 j = 0; j &lt; second_values.size(); j++)  {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> (second_values[j] == -1)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">if</span> (second_values[j] != prev_value) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          std::vector&lt;int32&gt;::iterator iter = std::find(occurred_values.begin(),</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                                        occurred_values.end(),</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                                                        second_values[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter == occurred_values.end());</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      std::vector&lt;std::pair&lt;int32, int32&gt; &gt; list_of_pairs;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="comment">// checking for uniques of elements in the list</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">for</span> (int32 j = 0; j &lt; split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); j++)  {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span> (split_lists[i][j].first == -1)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::const_iterator iter =</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            std::find_if(list_of_pairs.begin(), list_of_pairs.end(),</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                         <a class="code" href="structkaldi_1_1nnet3_1_1PairIsEqualComparator.html">PairIsEqualComparator</a>(split_lists[i][j]));</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter == list_of_pairs.end());</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        list_of_pairs.push_back(split_lists[i][j]);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (verbose)  {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;submat_list&quot;</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ab2fee0700fd475dc0d6b4a9d618e9a72">PrintVectorVectorPair</a>(submat_lists);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;split_lists&quot;</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ab2fee0700fd475dc0d6b4a9d618e9a72">PrintVectorVectorPair</a>(split_lists);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;===========================&quot;</span>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  int32 num_kaddrows_in_output = 0;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  int32 first_value;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  std::vector&lt;int32&gt; second_values;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">// ensure that elements in submat_lists are also present</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// in split_lists</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">for</span> (int32 i = 0 ; i &lt; split_lists.size(); i++) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    second_values.clear();</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">ConvertToIndexes</a>(split_lists[i], &amp;first_value, &amp;second_values)) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">// Checking if ConvertToIndexes did a proper conversion of the indexes</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(second_values.size() == split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size());</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">for</span> (int32 j = 0; j &lt; second_values.size(); j++)  {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">if</span> (split_lists[i][j].first != -1)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((split_lists[i][j].first == first_value) &amp;&amp;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                       (split_lists[i][j].second == second_values[j]));</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      num_kaddrows_in_output++;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">for</span> (int32 j = 0; j &lt; split_lists[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); j++) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">if</span> (split_lists[i][j].first == -1)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      std::vector&lt;std::pair&lt;int32, int32&gt; &gt;::iterator iter =</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;          std::find_if(all_pairs.begin(), all_pairs.end(),</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    <a class="code" href="structkaldi_1_1nnet3_1_1ComparePair.html">ComparePair</a>(split_lists[i][j]));</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(iter != all_pairs.end());</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      all_pairs.erase(iter);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(all_pairs.size() == 0);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// ensure that there are at least as many kAddRows compatible split_lists as</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">// specified</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_kaddrows_in_output &gt;= min_num_kaddrows);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComparePair_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComparePair.html">kaldi::nnet3::ComparePair</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils-test_8cc_source.html#l00026">nnet-compile-utils-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ae99488174e8dde27f8f30d91d61c0cd2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ae99488174e8dde27f8f30d91d61c0cd2">kaldi::nnet3::ConvertToIndexes</a></div><div class="ttdeci">bool ConvertToIndexes(const std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &amp;location_vector, int32 *first_value, std::vector&lt; int32 &gt; *second_values)</div><div class="ttdoc">If it is the case for some i &gt;= 0 that all the .first elements of &quot;location_vector&quot; are either i or -...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00377">nnet-compile-utils.cc:377</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1PairIsEqualComparator_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1PairIsEqualComparator.html">kaldi::nnet3::PairIsEqualComparator</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils-test_8cc_source.html#l00036">nnet-compile-utils-test.cc:36</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ab2fee0700fd475dc0d6b4a9d618e9a72"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab2fee0700fd475dc0d6b4a9d618e9a72">kaldi::nnet3::PrintVectorVectorPair</a></div><div class="ttdeci">void PrintVectorVectorPair(std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; vec_vec_pair)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils-test_8cc_source.html#l00050">nnet-compile-utils-test.cc:50</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a230b979419515f453ee5c8f2bc87a4dd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a230b979419515f453ee5c8f2bc87a4dd">kaldi::nnet3::SplitLocationsBackward</a></div><div class="ttdeci">void SplitLocationsBackward(const std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; &amp;submat_lists, std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; *split_lists)</div><div class="ttdoc">This function has the same interface as SplitLocations(); however, it ensures certain additional prop...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile-utils_8cc_source.html#l00498">nnet-compile-utils.cc:498</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1a7353c9f73e07a4f64149e67d737482"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a7353c9f73e07a4f64149e67d737482">&#9670;&nbsp;</a></span>UnitTestSummarizeVector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UnitTestSummarizeVector </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-parse-test_8cc_source.html#l00242">242</a> of file <a class="el" href="nnet-parse-test_8cc_source.html">nnet-parse-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="matrix-common_8h_source.html#l00040">kaldi::kCopyData</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00190">Vector&lt; Real &gt;::Resize()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00301">VectorBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="nnet-parse_8cc_source.html#l00484">SummarizeVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-parse-test_8cc_source.html#l00280">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                               {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// will be eyeballed by a human.</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> vec(9);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  vec.SetRandn();</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  vec(0) = 1024.2343;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  vec(1) = 0.01;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  vec(2) = 0.001234;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  vec(3) = 0.000198;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  vec(3) = 1.98e-09;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  vec(4) = 153.0;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  vec(5) = 0.154;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  vec(6) = 1.2;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  vec(7) = 9.2;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  vec(8) = 10.8;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;vec = &quot;</span> &lt;&lt; vec &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#ab2468421b230db50c66c8d40975205c3">SummarizeVector</a>(vec);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  vec.Resize(20, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0">kCopyData</a>);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;vec = &quot;</span> &lt;&lt; vec &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet3.html#ab2468421b230db50c66c8d40975205c3">SummarizeVector</a>(vec);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_ab2468421b230db50c66c8d40975205c3"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ab2468421b230db50c66c8d40975205c3">kaldi::nnet3::SummarizeVector</a></div><div class="ttdeci">std::string SummarizeVector(const VectorBase&lt; float &gt; &amp;vec)</div><div class="ttdoc">Returns a string that summarizes a vector fairly succintly, for printing stats in info lines...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-parse_8cc_source.html#l00484">nnet-parse.cc:484</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80ba6ccfb1220c1b49764f14603227edd6e0">kaldi::kCopyData</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00040">matrix-common.h:40</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aded8b769020aeb041c148c931c44a040"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aded8b769020aeb041c148c931c44a040">&#9670;&nbsp;</a></span>UnVectorizeNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UnVectorizeNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the parameters from params to *dest. </p>
<p>the dimension of params must be equal to NumParameters(*dest). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00392">392</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00350">NumParameters()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00530">UpdatableComponent::NumParameters()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00537">UpdatableComponent::UnVectorize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                 {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(parameters.Dim() == <a class="code" href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">NumParameters</a>(*dest));</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  int32 dim_offset = 0;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; dest-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    Component *comp = dest-&gt;GetComponent(c);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="comment">// For now all updatable components inherit from class UpdatableComponent.</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="comment">// If that changes in future, we will change this code.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      UpdatableComponent *uc = <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keywordflow">if</span> (uc == NULL)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Updatable component does not inherit from class &quot;</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="stringliteral">&quot;UpdatableComponent; change this code.&quot;</span>;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      int32 this_dim = uc-&gt;NumParameters();</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keyword">const</span> SubVector&lt;BaseFloat&gt; this_part(parameters, dim_offset, this_dim);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      uc-&gt;UnVectorize(this_part);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      dim_offset += this_dim;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a96164bd20d5a66c3c0ca62e30250d46a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">kaldi::nnet3::NumParameters</a></div><div class="ttdeci">int32 NumParameters(const Nnet &amp;src)</div><div class="ttdoc">Returns the total of the number of parameters in the updatable components of the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00350">nnet-utils.cc:350</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a11f61b746e0773ae070094b9baa1b815"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11f61b746e0773ae070094b9baa1b815">&#9670;&nbsp;</a></span>UpdateNnetMovingAverage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet3::UpdateNnetMovingAverage </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_models</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>moving_average_nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-combine_8cc_source.html#l00066">66</a> of file <a class="el" href="nnet3-combine_8cc_source.html">nnet3-combine.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00340">AddNnet()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-utils_8cc_source.html#l00350">NumParameters()</a>, and <a class="el" href="nnet-utils_8cc_source.html#l00303">ScaleNnet()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-combine_8cc_source.html#l00076">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                                                 {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">NumParameters</a>(nnet) == <a class="code" href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">NumParameters</a>(*moving_average_nnet));</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">ScaleNnet</a>((num_models - 1.0) / num_models, moving_average_nnet);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ac9680bf4ad4dd4fd305f913ff398c14e">AddNnet</a>(nnet, 1.0 / num_models, moving_average_nnet);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a62b3a3e7be6ebc2a2af34bdb347ec76a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">kaldi::nnet3::ScaleNnet</a></div><div class="ttdeci">void ScaleNnet(BaseFloat scale, Nnet *nnet)</div><div class="ttdoc">Scales the nnet parameters and stats by this scale. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00303">nnet-utils.cc:303</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a96164bd20d5a66c3c0ca62e30250d46a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">kaldi::nnet3::NumParameters</a></div><div class="ttdeci">int32 NumParameters(const Nnet &amp;src)</div><div class="ttdoc">Returns the total of the number of parameters in the updatable components of the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00350">nnet-utils.cc:350</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac9680bf4ad4dd4fd305f913ff398c14e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac9680bf4ad4dd4fd305f913ff398c14e">kaldi::nnet3::AddNnet</a></div><div class="ttdeci">void AddNnet(const Nnet &amp;src, BaseFloat alpha, Nnet *dest)</div><div class="ttdoc">Does *dest += alpha * src (affects nnet parameters and stored stats). </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00340">nnet-utils.cc:340</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1386d6c6a6d3e9bd00fed536d63cb847"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1386d6c6a6d3e9bd00fed536d63cb847">&#9670;&nbsp;</a></span>UpdateNnetWithMaxChange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> UpdateNnetWithMaxChange </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>delta_nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>max_param_change</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>max_change_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>num_max_change_per_component_applied</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_max_change_global_applied</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function does the operation '*nnet += scale * delta_nnet', while respecting any max-parameter-change (max-param-change) specified in the updatable components, and also the global max-param-change specified as 'max_param_change'. </p>
<p>With max-changes taken into account, the operation of this function is equivalent to the following, although it's done more efficiently:</p>
<div class="fragment"><div class="line">Nnet temp_nnet(delta_nnet);</div><div class="line"><a class="code" href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">ScaleNnet</a>(1.0 / max_change_scale, &amp;temp_nnet);</div><div class="line">[ Scale down parameters <span class="keywordflow">for each</span> component of temp_nnet as needed so</div><div class="line">their Euclidean norms <span class="keywordflow">do</span> not exceed their per-component max-changes ]</div><div class="line">[ Scale down temp_nnet as needed so its Euclidean norm does not exceed</div><div class="line">  the global max-change ]</div><div class="line"><a class="code" href="namespacekaldi_1_1nnet3.html#a62b3a3e7be6ebc2a2af34bdb347ec76a">ScaleNnet</a>(max_change_scale, &amp;temp_nnet);  <span class="comment">// undo the previous scaling.</span></div><div class="line"><a class="code" href="namespacekaldi_1_1nnet3.html#ac9680bf4ad4dd4fd305f913ff398c14e">AddNnet</a>(temp_nnet, scale, nnet);</div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">delta_nnet</td><td>The copy of '*nnet' neural network that contains the proposed change in parameters. Normally this will previously have been set to: (delta_nnet = parameter-derivative-on-current-minibatch * learning-rate per parameter), with any natural gradient applied as specified in the components; but this may be different if momentum or backstitch are used. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_param_change</td><td>The global max-param-change specified on the command line (e.g. 2.0), which specifies the largest change allowed to '*nnet' in Euclidean norm. If &lt;= 0, no global max-param-change will be enforced, but any max-change values specified in the components will still be enforced; see <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#a4922b82383b37582e1d658849e0e7482" title="Returns the per-component max-change value, which is interpreted as the maximum change (in l2 norm) i...">UpdatableComponent::MaxChange()</a>, and search for 'max-change' in the configs or nnet3-info output). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_change_scale</td><td>This value, which will normally be 1.0, is used to scale all per-component max-change values and the global 'max_param_change', before applying them (so we use 'max_change_scale * uc-&gt;MaxChange()' as the per-component max-change, and 'max_change_scale * max_param_change' as the global max-change). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">scale</td><td>This value, which will normally be 1.0, is a scaling factor used when adding to 'nnet', applied after any max-changes. It is provided for backstitch-related purposes. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">nnet</td><td>The nnet which we add to. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_max_change_per_component_applied</td><td>We add to the elements of this the count for each per-component max-change. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_max_change_global_applied</td><td>We to this the count for the global max-change. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l02013">2013</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-utils_8cc_source.html#l00313">AddNnetComponents()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00689">Nnet::GetComponentName()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00513">UpdatableComponent::MaxChange()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00413">NumUpdatableComponents()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-utils_8h_source.html#l00237">CollapseModelConfig::CollapseModelConfig()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00170">NnetChainTrainer::TrainInternal()</a>, <a class="el" href="nnet-training_8cc_source.html#l00093">NnetTrainer::TrainInternal()</a>, <a class="el" href="nnet-chain-training_8cc_source.html#l00223">NnetChainTrainer::TrainInternalBackstitch()</a>, and <a class="el" href="nnet-training_8cc_source.html#l00133">NnetTrainer::TrainInternalBackstitch()</a>.</p>
<div class="fragment"><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                                                                   {</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nnet != NULL);</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  <span class="comment">// computes scaling factors for per-component max-change</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="keyword">const</span> int32 num_updatable = <a class="code" href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">NumUpdatableComponents</a>(delta_nnet);</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  Vector&lt;BaseFloat&gt; scale_factors = Vector&lt;BaseFloat&gt;(num_updatable);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> param_delta_squared = 0.0;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  int32 num_max_change_per_component_applied_per_minibatch = 0;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> min_scale = 1.0;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  std::string component_name_with_min_scale;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_change_with_min_scale;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; delta_nnet.NumComponents(); c++) {</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keyword">const</span> Component *comp = delta_nnet.GetComponent(c);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      <span class="keyword">const</span> UpdatableComponent *uc =</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      <span class="keywordflow">if</span> (uc == NULL)</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Updatable component does not inherit from class &quot;</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;UpdatableComponent; change this code.&quot;</span>;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_param_change_per_comp = uc-&gt;MaxChange();</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(max_param_change_per_comp &gt;= 0.0);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> dot_prod = uc-&gt;DotProduct(*uc);</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      <span class="keywordflow">if</span> (max_param_change_per_comp != 0.0 &amp;&amp;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;          std::sqrt(dot_prod) * std::abs(scale) &gt;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;          max_param_change_per_comp * max_change_scale) {</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;        scale_factors(i) = max_param_change_per_comp * max_change_scale /</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;            (std::sqrt(dot_prod) * std::abs(scale));</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        (*num_max_change_per_component_applied)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]++;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        num_max_change_per_component_applied_per_minibatch++;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Parameters in &quot;</span> &lt;&lt; delta_nnet.GetComponentName(c)</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; change too big: &quot;</span> &lt;&lt; std::sqrt(dot_prod) &lt;&lt; <span class="stringliteral">&quot; * &quot;</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                      &lt;&lt; scale &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span> &lt;&lt; <span class="stringliteral">&quot;max-change * max-change-scale=&quot;</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                      &lt;&lt; max_param_change_per_comp &lt;&lt; <span class="stringliteral">&quot; * &quot;</span> &lt;&lt; max_change_scale</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;, scaling by &quot;</span> &lt;&lt; scale_factors(i);</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        scale_factors(i) = 1.0;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      }</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keywordflow">if</span> (i == 0 || scale_factors(i) &lt; min_scale) {</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        min_scale =  scale_factors(i);</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        component_name_with_min_scale = delta_nnet.GetComponentName(c);</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        max_change_with_min_scale = max_param_change_per_comp;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      }</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      param_delta_squared += std::pow(scale_factors(i),</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                                      static_cast&lt;BaseFloat&gt;(2.0)) * dot_prod;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      i++;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    }</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  }</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(i == scale_factors.Dim());</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> param_delta = std::sqrt(param_delta_squared);</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="comment">// computes the scale for global max-change</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  param_delta *= std::abs(scale);</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <span class="keywordflow">if</span> (max_param_change != 0.0) {</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordflow">if</span> (param_delta &gt; max_param_change * max_change_scale) {</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="keywordflow">if</span> (param_delta - param_delta != 0.0) {</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Infinite parameter change, will not apply.&quot;</span>;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        scale *= max_param_change * max_change_scale / param_delta;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        (*num_max_change_global_applied)++;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      }</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    }</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  }</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <span class="keywordflow">if</span> ((max_param_change != 0.0 &amp;&amp;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      param_delta &gt; max_param_change * max_change_scale &amp;&amp;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      param_delta - param_delta == 0.0) || min_scale &lt; 1.0) {</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    std::ostringstream ostr;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (min_scale &lt; 1.0)</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      ostr &lt;&lt; <span class="stringliteral">&quot;Per-component max-change active on &quot;</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;           &lt;&lt; num_max_change_per_component_applied_per_minibatch</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;           &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; num_updatable &lt;&lt; <span class="stringliteral">&quot; Updatable Components.&quot;</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;           &lt;&lt; <span class="stringliteral">&quot; (Smallest factor=&quot;</span> &lt;&lt; min_scale &lt;&lt; <span class="stringliteral">&quot; on &quot;</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;           &lt;&lt; component_name_with_min_scale</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;           &lt;&lt; <span class="stringliteral">&quot; with max-change=&quot;</span> &lt;&lt; max_change_with_min_scale &lt;&lt;<span class="stringliteral">&quot;). &quot;</span>;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="keywordflow">if</span> (param_delta &gt; max_param_change * max_change_scale)</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      ostr &lt;&lt; <span class="stringliteral">&quot;Global max-change factor was &quot;</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;           &lt;&lt; max_param_change * max_change_scale / param_delta</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;           &lt;&lt; <span class="stringliteral">&quot; with max-change=&quot;</span> &lt;&lt; max_param_change &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; ostr.str();</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  }</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;  <span class="comment">// applies both of the max-change scalings all at once, component by component</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;  <span class="comment">// and updates parameters</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  scale_factors.Scale(scale);</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#ad24a2545a15f4ffa0e76652742767aac">AddNnetComponents</a>(delta_nnet, scale_factors, scale, nnet);</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad24a2545a15f4ffa0e76652742767aac"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad24a2545a15f4ffa0e76652742767aac">kaldi::nnet3::AddNnetComponents</a></div><div class="ttdeci">void AddNnetComponents(const Nnet &amp;src, const Vector&lt; BaseFloat &gt; &amp;alphas, BaseFloat scale, Nnet *dest)</div><div class="ttdoc">Does *dest += alpha * src for updatable components (affects nnet parameters), and *dest += scale * sr...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00313">nnet-utils.cc:313</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a25df665b8f7a712a34469e53fc875851"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">kaldi::nnet3::NumUpdatableComponents</a></div><div class="ttdeci">int32 NumUpdatableComponents(const Nnet &amp;dest)</div><div class="ttdoc">Returns the number of updatable components in the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00413">nnet-utils.cc:413</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7918fc2d6dfa22dbc84913c63be8771b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7918fc2d6dfa22dbc84913c63be8771b">&#9670;&nbsp;</a></span>VariableMergingOptimization()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VariableMergingOptimization </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This wraps class <a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html" title="This class is responsible for merging matrices, although you probably want to access it via the the f...">VariableMergingOptimizer</a> in a simplified interface. </p>

<p class="definition">Definition at line <a class="el" href="nnet-optimize_8cc_source.html#l00417">417</a> of file <a class="el" href="nnet-optimize_8cc_source.html">nnet-optimize.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l00723">VariableMergingOptimizer::MergeVariables()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00501">Optimize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                                               {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordtype">bool</span> changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">while</span> (changed) {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    VariableMergingOptimizer opt(config, nnet, computation);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">if</span> (opt.MergeVariables())</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ad9b9bd865f19f604b00235336168c3ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9b9bd865f19f604b00235336168c3ee">&#9670;&nbsp;</a></span>VectorizeNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VectorizeNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the nnet parameters to *params, whose dimension must be equal to NumParameters(src). </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00369">369</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00042">kUpdatableComponent</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00350">NumParameters()</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00530">UpdatableComponent::NumParameters()</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00535">UpdatableComponent::Vectorize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                                      {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(parameters-&gt;Dim() == <a class="code" href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">NumParameters</a>(src));</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  int32 dim_offset = 0;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; src.NumComponents(); c++) {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keyword">const</span> Component *comp = src.GetComponent(c);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (comp-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kUpdatableComponent</a>) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="comment">// For now all updatable components inherit from class UpdatableComponent.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="comment">// If that changes in future, we will change this code.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keyword">const</span> UpdatableComponent *uc =</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(comp);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">if</span> (uc == NULL)</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Updatable component does not inherit from class &quot;</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="stringliteral">&quot;UpdatableComponent; change this code.&quot;</span>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      int32 this_dim = uc-&gt;NumParameters();</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      SubVector&lt;BaseFloat&gt; this_part(*parameters, dim_offset, this_dim);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      uc-&gt;Vectorize(&amp;this_part);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      dim_offset += this_dim;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a61132a04f6c327dffd7f053b93ae393b">kaldi::nnet3::kUpdatableComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00042">nnet-component-itf.h:42</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a96164bd20d5a66c3c0ca62e30250d46a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a96164bd20d5a66c3c0ca62e30250d46a">kaldi::nnet3::NumParameters</a></div><div class="ttdeci">int32 NumParameters(const Nnet &amp;src)</div><div class="ttdoc">Returns the total of the number of parameters in the updatable components of the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00350">nnet-utils.cc:350</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aab8af7cc27e3dad18e9262e62245c4b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab8af7cc27e3dad18e9262e62245c4b1">&#9670;&nbsp;</a></span>WriteCindexVector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WriteCindexVector </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00282">282</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00034">kaldi::WriteBasicType()</a>, <a class="el" href="nnet-common_8cc_source.html#l00162">WriteCindexVectorElementBinary()</a>, and <a class="el" href="io-funcs_8cc_source.html#l00134">kaldi::WriteToken()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common-test_8cc_source.html#l00062">UnitTestCindexIo()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00190">NnetComputation::MatrixDebugInfo::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                                     {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// This token will make it easier to write back-compatible code if we later</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// change the format.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga87f1638ef3c0a3ee117178b202c2d02a">WriteToken</a>(os, binary, <span class="stringliteral">&quot;&lt;I1V&gt;&quot;</span>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  int32 size = vec.size();</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, size);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">if</span> (!binary) {  <span class="comment">// In text mode we just use the native Write functionality.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      int32 node_index = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0 || node_index != vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].first) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          os.put(<span class="charliteral">&#39;]&#39;</span>);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        os.put(<span class="charliteral">&#39;[&#39;</span>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, node_index);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        os.put(<span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second.Write(os, binary);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == size - 1)</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        os.put(<span class="charliteral">&#39;]&#39;</span>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a1f0c2f315140acd374d630c0804f3a07">WriteCindexVectorElementBinary</a>(os, vec, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div><div class="ttc" id="group__io__funcs__basic_html_ga87f1638ef3c0a3ee117178b202c2d02a"><div class="ttname"><a href="group__io__funcs__basic.html#ga87f1638ef3c0a3ee117178b202c2d02a">kaldi::WriteToken</a></div><div class="ttdeci">void WriteToken(std::ostream &amp;os, bool binary, const char *token)</div><div class="ttdoc">The WriteToken functions are for writing nonempty sequences of non-space characters. </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00134">io-funcs.cc:134</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1f0c2f315140acd374d630c0804f3a07"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1f0c2f315140acd374d630c0804f3a07">kaldi::nnet3::WriteCindexVectorElementBinary</a></div><div class="ttdeci">static void WriteCindexVectorElementBinary(std::ostream &amp;os, const std::vector&lt; Cindex &gt; &amp;vec, int32 i)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00162">nnet-common.cc:162</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga108506a9aabafd9006926aa1b47617da"><div class="ttname"><a href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">kaldi::WriteBasicType</a></div><div class="ttdeci">void WriteBasicType(std::ostream &amp;os, bool binary, T t)</div><div class="ttdoc">WriteBasicType is the name of the write function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00034">io-funcs-inl.h:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f0c2f315140acd374d630c0804f3a07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f0c2f315140acd374d630c0804f3a07">&#9670;&nbsp;</a></span>WriteCindexVectorElementBinary()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::WriteCindexVectorElementBinary </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>i</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00162">162</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00034">kaldi::WriteBasicType()</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common_8cc_source.html#l00282">WriteCindexVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;             {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">bool</span> binary = <span class="keyword">true</span>;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  int32 node_index = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keyword">const</span> Index &amp;index = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0 || node_index != vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].first) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// divide using &#39;|&#39; into ranges that each have all the same node name, like:</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// [node_1: index_1 index_2] [node_2: index_3 index_4] Caution: &#39;|&#39; is</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// character 124 so we have to avoid that character in places where it might</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// be confused with this separator.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    os.put(<span class="charliteral">&#39;|&#39;</span>);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, node_index);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// we don&#39;t need to be concerned about reserving space for character 124</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// (&#39;|&#39;) here, since (wastefully) &#39;|&#39; is always printed for i == 0.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// we don&#39;t use std::abs(index.t) &lt; 125 here because it doesn&#39;t have the</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// right (or even well-defined) behavior for</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// index.t == std::numeric_limits&lt;int32&gt;::min().</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (index.n == 0 &amp;&amp; index.x == 0 &amp;&amp;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        index.t &gt; -125 &amp;&amp; index.t &lt; 125) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="comment">// handle this common case in one character.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      os.put(static_cast&lt;signed char&gt;(index.t));</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index.t == 0 &amp;&amp; index.x == 0 &amp;&amp;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;               (index.n == 0 || index.n == 1)) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="comment">// handle this common case in one character.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      os.put(static_cast&lt;signed char&gt;(index.n + 125));</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// handle the general case less efficiently.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      os.put(127);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.n);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.t);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.x);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keyword">const</span> Index &amp;last_index = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1].second;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// we don&#39;t do if std::abs(index.t - last_index.t) &lt; 124</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// below because it doesn&#39;t work right if the difference</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// equals std::numeric_limits&lt;int32&gt;::min().</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (index.n == last_index.n &amp;&amp; index.x == last_index.x &amp;&amp;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        index.t - last_index.t &lt; 124 &amp;&amp;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        index.t - last_index.t &gt; -124) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordtype">signed</span> <span class="keywordtype">char</span> c = index.t - last_index.t;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      os.put(c);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="comment">// note: we have to reserve character 124 (&#39;|&#39;) for when &#39;n&#39; or &#39;x&#39;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="comment">// changes.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index.t == last_index.t &amp;&amp; index.x == last_index.x &amp;&amp;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;              (index.n == last_index.n || index.n == last_index.n + 1)) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      os.put(125 + index.n - last_index.n);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// handle the general case less efficiently.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      os.put(127);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.n);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.t);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.x);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">if</span> (!os.good())</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Output stream error detected&quot;</span>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga108506a9aabafd9006926aa1b47617da"><div class="ttname"><a href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">kaldi::WriteBasicType</a></div><div class="ttdeci">void WriteBasicType(std::ostream &amp;os, bool binary, T t)</div><div class="ttdoc">WriteBasicType is the name of the write function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00034">io-funcs-inl.h:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8774992c5665f6f346ad306771b8e34e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8774992c5665f6f346ad306771b8e34e">&#9670;&nbsp;</a></span>WriteExamples()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::WriteExamples </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a> *&gt; &amp;&#160;</td>
          <td class="paramname"><em>chunks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>utt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>compress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_pdfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_egs_written</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="namespacekaldi_1_1nnet3.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *&gt; *&#160;</td>
          <td class="paramname"><em>example_writers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00082">82</a> of file <a class="el" href="nnet3-xvector-get-egs_8cc_source.html">nnet3-xvector-get-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00130">NnetExample::Compress()</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00042">NnetIo::indexes</a>, <a class="el" href="nnet3_2nnet-example_8h_source.html#l00116">NnetExample::io</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00036">ChunkInfo::label</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00032">ChunkInfo::name</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00035">ChunkInfo::num_frames</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00033">ChunkInfo::output_archive_id</a>, and <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00034">ChunkInfo::start_frame</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet3-xvector-get-egs_8cc_source.html#l00133">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                                     {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;ChunkInfo *&gt;::const_iterator it = chunks.begin();</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      it != chunks.end(); ++it) {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html">ChunkInfo</a> *chunk = *it;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    int32 num_rows = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(),</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          feat_dim = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>();</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (num_rows &lt; chunk-&gt;num_frames) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Unable to create examples for utterance &quot;</span> &lt;&lt; utt</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;. Requested chunk size of &quot;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                 &lt;&lt; chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; but utterance has only &quot;</span> &lt;&lt; num_rows &lt;&lt; <span class="stringliteral">&quot; frames.&quot;</span>;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="comment">// The requested chunk positions are approximate. It&#39;s possible</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="comment">// that they slightly exceed the number of frames in the utterance.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="comment">// If that occurs, we can shift the chunks location back slightly.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      int32 shift = std::min(0, num_rows - chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a969781fb95c6184c8be93f4e842be91d">start_frame</a></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                 - chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <a class="code" href="classkaldi_1_1SubMatrix.html">SubMatrix&lt;BaseFloat&gt;</a> chunk_mat(feats, chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a969781fb95c6184c8be93f4e842be91d">start_frame</a> + shift,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                                  chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">num_frames</a>, 0, feat_dim);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a> nnet_input = <a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;input&quot;</span>, 0, chunk_mat);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordflow">for</span> (std::vector&lt;Index&gt;::iterator indx_it = nnet_input.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.begin();</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          indx_it != nnet_input.<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.end(); ++indx_it)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        indx_it-&gt;n = 0;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <a class="code" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> label;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      std::vector&lt;std::pair&lt;int32, BaseFloat&gt; &gt; post;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      post.push_back(std::pair&lt;int32, BaseFloat&gt;(chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a17949517954748c8140efd8137e25c0d">label</a>, 1.0));</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      label.push_back(post);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(nnet_input);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">io</a>.push_back(<a class="code" href="structkaldi_1_1nnet3_1_1NnetIo.html">NnetIo</a>(<span class="stringliteral">&quot;output&quot;</span>, num_pdfs, 0, label));</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="keywordflow">if</span> (compress)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        eg.<a class="code" href="structkaldi_1_1nnet3_1_1NnetExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">Compress</a>();</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#aefb7220e8b18a6fd1e0430df564a6291">output_archive_id</a> &gt;= example_writers-&gt;size())</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Requested output index exceeds number of specified &quot;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;output files.&quot;</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      (*example_writers)[chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#aefb7220e8b18a6fd1e0430df564a6291">output_archive_id</a>]-&gt;Write(</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                         chunk-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a9b45b3e13bd9167aab02e17e08916231">name</a>, eg);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      (*num_egs_written) += 1;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html">kaldi::nnet3::NnetExample</a></div><div class="ttdoc">NnetExample is the input data and corresponding label (or labels) for one or more frames of input...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00111">nnet-example.h:111</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html">kaldi::nnet3::NnetIo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00033">nnet-example.h:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a969781fb95c6184c8be93f4e842be91d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a969781fb95c6184c8be93f4e842be91d">kaldi::nnet3::ChunkInfo::start_frame</a></div><div class="ttdeci">int32 start_frame</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00034">nnet3-xvector-get-egs.cc:34</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a17949517954748c8140efd8137e25c0d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a17949517954748c8140efd8137e25c0d">kaldi::nnet3::ChunkInfo::label</a></div><div class="ttdeci">int32 label</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00036">nnet3-xvector-get-egs.cc:36</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetIo_html_aa3daaa77b972f8dace077e94b418aab1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetIo.html#aa3daaa77b972f8dace077e94b418aab1">kaldi::nnet3::NnetIo::indexes</a></div><div class="ttdeci">std::vector&lt; Index &gt; indexes</div><div class="ttdoc">&quot;indexes&quot; is a vector the same length as features.NumRows(), explaining the meaning of each row of th...</div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00042">nnet-example.h:42</a></div></div>
<div class="ttc" id="group__posterior__group_html_ga5c99e6141a5a3b3c5d424e99ffbd1ac6"><div class="ttname"><a href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">kaldi::Posterior</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, BaseFloat &gt; &gt; &gt; Posterior</div><div class="ttdoc">Posterior is a typedef for storing acoustic-state (actually, transition-id) posteriors over an uttera...</div><div class="ttdef"><b>Definition:</b> <a href="posterior_8h_source.html#l00043">posterior.h:43</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html">kaldi::nnet3::ChunkInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00031">nnet3-xvector-get-egs.cc:31</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_a0ba9edee3fd93ac653cee4e428b6e93e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#a0ba9edee3fd93ac653cee4e428b6e93e">kaldi::nnet3::NnetExample::Compress</a></div><div class="ttdeci">void Compress()</div><div class="ttdoc">Compresses any (input) features that are not sparse. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8cc_source.html#l00130">nnet-example.cc:130</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a32d4a33731fac2ac8d3bc0dd478ecdf4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a32d4a33731fac2ac8d3bc0dd478ecdf4">kaldi::nnet3::ChunkInfo::num_frames</a></div><div class="ttdeci">int32 num_frames</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00035">nnet3-xvector-get-egs.cc:35</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_aefb7220e8b18a6fd1e0430df564a6291"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#aefb7220e8b18a6fd1e0430df564a6291">kaldi::nnet3::ChunkInfo::output_archive_id</a></div><div class="ttdeci">int32 output_archive_id</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00033">nnet3-xvector-get-egs.cc:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ChunkInfo_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ChunkInfo.html#a9b45b3e13bd9167aab02e17e08916231">kaldi::nnet3::ChunkInfo::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="nnet3-xvector-get-egs_8cc_source.html#l00032">nnet3-xvector-get-egs.cc:32</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetExample_html_acfc99ed8d51e6726a7c4e888afebc910"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetExample.html#acfc99ed8d51e6726a7c4e888afebc910">kaldi::nnet3::NnetExample::io</a></div><div class="ttdeci">std::vector&lt; NnetIo &gt; io</div><div class="ttdoc">&quot;io&quot; contains the input and output. </div><div class="ttdef"><b>Definition:</b> <a href="nnet3_2nnet-example_8h_source.html#l00116">nnet-example.h:116</a></div></div>
<div class="ttc" id="classkaldi_1_1SubMatrix_html"><div class="ttname"><a href="classkaldi_1_1SubMatrix.html">kaldi::SubMatrix</a></div><div class="ttdoc">Sub-matrix representation. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00942">kaldi-matrix.h:942</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6d9bd2f8bc49b5d2d7dec9b2d354ffc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d9bd2f8bc49b5d2d7dec9b2d354ffc9">&#9670;&nbsp;</a></span>WriteIndexVector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WriteIndexVector </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00126">126</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-common_8cc_source.html#l00027">Index::Write()</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00034">kaldi::WriteBasicType()</a>, <a class="el" href="nnet-common_8cc_source.html#l00045">WriteIndexVectorElementBinary()</a>, and <a class="el" href="io-funcs_8cc_source.html#l00134">kaldi::WriteToken()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common_8h_source.html#l00091">IndexLessNxt::operator()()</a>, <a class="el" href="nnet-common-test_8cc_source.html#l00028">UnitTestIndexIo()</a>, <a class="el" href="convolution-test_8cc_source.html#l00394">kaldi::nnet3::time_height_convolution::UnitTestTimeHeightConvolutionCompile()</a>, <a class="el" href="nnet3_2nnet-example_8cc_source.html#l00028">NnetIo::Write()</a>, <a class="el" href="nnet-discriminative-example_8cc_source.html#l00028">NnetDiscriminativeSupervision::Write()</a>, <a class="el" href="nnet-computation_8cc_source.html#l01019">IoSpecification::Write()</a>, <a class="el" href="nnet-chain-example_8cc_source.html#l00028">NnetChainSupervision::Write()</a>, and <a class="el" href="nnet-computation_8cc_source.html#l00866">NnetComputation::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                                   {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// This token will make it easier to write back-compatible code if we later</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// change the format.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga87f1638ef3c0a3ee117178b202c2d02a">WriteToken</a>(os, binary, <span class="stringliteral">&quot;&lt;I1V&gt;&quot;</span>);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  int32 size = vec.size();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, size);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">if</span> (!binary) {  <span class="comment">// In text mode we just use the native Write functionality.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].Write(os, binary);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet3.html#a2aebb785e5823e55aa1d45d473f13a8e">WriteIndexVectorElementBinary</a>(os, vec, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a2aebb785e5823e55aa1d45d473f13a8e"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2aebb785e5823e55aa1d45d473f13a8e">kaldi::nnet3::WriteIndexVectorElementBinary</a></div><div class="ttdeci">static void WriteIndexVectorElementBinary(std::ostream &amp;os, const std::vector&lt; Index &gt; &amp;vec, int32 i)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8cc_source.html#l00045">nnet-common.cc:45</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga87f1638ef3c0a3ee117178b202c2d02a"><div class="ttname"><a href="group__io__funcs__basic.html#ga87f1638ef3c0a3ee117178b202c2d02a">kaldi::WriteToken</a></div><div class="ttdeci">void WriteToken(std::ostream &amp;os, bool binary, const char *token)</div><div class="ttdoc">The WriteToken functions are for writing nonempty sequences of non-space characters. </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00134">io-funcs.cc:134</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga108506a9aabafd9006926aa1b47617da"><div class="ttname"><a href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">kaldi::WriteBasicType</a></div><div class="ttdeci">void WriteBasicType(std::ostream &amp;os, bool binary, T t)</div><div class="ttdoc">WriteBasicType is the name of the write function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00034">io-funcs-inl.h:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2aebb785e5823e55aa1d45d473f13a8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2aebb785e5823e55aa1d45d473f13a8e">&#9670;&nbsp;</a></span>WriteIndexVectorElementBinary()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet3::WriteIndexVectorElementBinary </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>i</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00045">45</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-common_8h_source.html#l00045">Index::n</a>, <a class="el" href="nnet-common_8h_source.html#l00046">Index::t</a>, <a class="el" href="io-funcs-inl_8h_source.html#l00034">kaldi::WriteBasicType()</a>, and <a class="el" href="nnet-common_8h_source.html#l00047">Index::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-common_8cc_source.html#l00126">WriteIndexVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;             {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordtype">bool</span> binary = <span class="keyword">true</span>;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">const</span> Index &amp;index = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// we don&#39;t use std::abs(index.t) &lt; 125 here because it doesn&#39;t have the</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// right (or even well-defined) behavior for</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// index.t == std::numeric_limits&lt;int32&gt;::min().</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">if</span> (index.n == 0 &amp;&amp; index.x == 0 &amp;&amp;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        index.t &gt; -125 &amp;&amp; index.t &lt; 125) {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="comment">// handle this common case in one character.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      os.put(static_cast&lt;signed char&gt;(index.t));</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// handle the general case less efficiently.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      os.put(127);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.n);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.t);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.x);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    Index last_index = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>-1];</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// we don&#39;t do if (std::abs(index.t - last_index.t) &lt; 125)</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// below because this doesn&#39;t work right if that difference</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// equals std::numeric_limits&lt;int32&gt;::min().</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">if</span> (index.n == last_index.n &amp;&amp; index.x == last_index.x &amp;&amp;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        index.t - last_index.t &lt; 125 &amp;&amp;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        index.t - last_index.t &gt; -125) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordtype">signed</span> <span class="keywordtype">char</span> c = index.t - last_index.t;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      os.put(c);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// handle the general case less efficiently.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      os.put(127);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.n);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.t);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <a class="code" href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">WriteBasicType</a>(os, binary, index.x);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">if</span> (!os.good())</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Output stream error detected&quot;</span>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga108506a9aabafd9006926aa1b47617da"><div class="ttname"><a href="group__io__funcs__basic.html#ga108506a9aabafd9006926aa1b47617da">kaldi::WriteBasicType</a></div><div class="ttdeci">void WriteBasicType(std::ostream &amp;os, bool binary, T t)</div><div class="ttdoc">WriteBasicType is the name of the write function for bool, integer types, and floating-point types...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00034">io-funcs-inl.h:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf96445e5bcabbb284bd6aa2340d553a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf96445e5bcabbb284bd6aa2340d553a">&#9670;&nbsp;</a></span>WriteVectorAsChar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WriteVectorAsChar </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-utils_8cc_source.html#l00237">237</a> of file <a class="el" href="nnet-example-utils_8cc_source.html">nnet-example-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-vector_8cc_source.html#l01230">VectorBase&lt; Real &gt;::Write()</a>, and <a class="el" href="io-funcs-inl_8h_source.html#l00198">kaldi::WriteIntegerVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-discriminative-example_8cc_source.html#l00028">NnetDiscriminativeSupervision::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                                         {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (binary) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    int32 dim = vec.Dim();</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    std::vector&lt;unsigned char&gt; char_vec(dim);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *data = vec.Data();</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> value = data[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value &gt;= 0.0 &amp;&amp; value &lt;= 1.0);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="comment">// below, the adding 0.5 is done so that we round to the closest integer</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="comment">// rather than rounding down (since static_cast will round down).</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      char_vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span><span class="keyword">&gt;</span>(255.0 * value + 0.5);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="group__io__funcs__basic.html#ga99e4557f845a9c1e3202ab136226a980">WriteIntegerVector</a>(os, binary, char_vec);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// the regular floating-point format will be more readable for text mode.</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    vec.Write(os, binary);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga99e4557f845a9c1e3202ab136226a980"><div class="ttname"><a href="group__io__funcs__basic.html#ga99e4557f845a9c1e3202ab136226a980">kaldi::WriteIntegerVector</a></div><div class="ttdeci">void WriteIntegerVector(std::ostream &amp;os, bool binary, const std::vector&lt; T &gt; &amp;v)</div><div class="ttdoc">Function for writing STL vectors of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00198">io-funcs-inl.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a264b986f95f2cb1e5bc7032967c69a27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a264b986f95f2cb1e5bc7032967c69a27">&#9670;&nbsp;</a></span>YzxVectorIndex()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::YzxVectorIndex </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_x_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_y_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_z_dim</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-simple-component_8cc_source.html#l04138">4138</a> of file <a class="el" href="nnet-simple-component_8cc_source.html">nnet-simple-component.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00181">KALDI_PARANOID_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8cc_source.html#l04299">ConvolutionComponent::InderivPatchesToInderiv()</a>, and <a class="el" href="nnet-simple-component_8cc_source.html#l04157">ConvolutionComponent::InputToInputPatches()</a>.</p>
<div class="fragment"><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;                                               {</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;  <a class="code" href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a>(x &lt; input_x_dim &amp;&amp; y &lt; input_y_dim &amp;&amp; z &lt; input_z_dim);</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;  <span class="keywordflow">return</span> (input_y_dim * input_z_dim) * x + (input_y_dim) * z + y;</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga2c852c1a15c7f195ec8021de2ab119a0"><div class="ttname"><a href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a></div><div class="ttdeci">#define KALDI_PARANOID_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00181">kaldi-error.h:181</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aca9d819d3ed85b506db090905d4c1cea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca9d819d3ed85b506db090905d4c1cea">&#9670;&nbsp;</a></span>ZeroComponentStats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ZeroComponentStats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Zeroes the component stats in all nonlinear components in the nnet. </p>

<p class="definition">Definition at line <a class="el" href="nnet-utils_8cc_source.html#l00269">269</a> of file <a class="el" href="nnet-utils_8cc_source.html">nnet-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00124">Nnet::NumComponents()</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00195">Component::ZeroStats()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-chain-training_8cc_source.html#l00027">NnetChainTrainer::NnetChainTrainer()</a>, <a class="el" href="nnet-discriminative-training_8cc_source.html#l00027">NnetDiscriminativeTrainer::NnetDiscriminativeTrainer()</a>, <a class="el" href="nnet-training_8cc_source.html#l00027">NnetTrainer::NnetTrainer()</a>, and <a class="el" href="nnet-chain-diagnostics_8cc_source.html#l00248">RecomputeStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                    {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    Component *comp = nnet-&gt;GetComponent(c);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    comp-&gt;ZeroStats();  <span class="comment">// for some components, this won&#39;t do anything.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a25b3b76367d2844fb0f48334f1bd5691"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25b3b76367d2844fb0f48334f1bd5691">&#9670;&nbsp;</a></span>ZyxVectorIndex()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 kaldi::nnet3::ZyxVectorIndex </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_x_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_y_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_z_dim</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-simple-component_8cc_source.html#l04146">4146</a> of file <a class="el" href="nnet-simple-component_8cc_source.html">nnet-simple-component.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00181">KALDI_PARANOID_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8cc_source.html#l04299">ConvolutionComponent::InderivPatchesToInderiv()</a>, and <a class="el" href="nnet-simple-component_8cc_source.html#l04157">ConvolutionComponent::InputToInputPatches()</a>.</p>
<div class="fragment"><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;                                               {</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;  <a class="code" href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a>(x &lt; input_x_dim &amp;&amp; y &lt; input_y_dim &amp;&amp; z &lt; input_z_dim);</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;  <span class="keywordflow">return</span> (input_y_dim * input_z_dim) * x + (input_z_dim) * y + z;</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga2c852c1a15c7f195ec8021de2ab119a0"><div class="ttname"><a href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a></div><div class="ttdeci">#define KALDI_PARANOID_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00181">kaldi-error.h:181</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a661a5133ac17b002930d5eea66d9632c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a661a5133ac17b002930d5eea66d9632c">&#9670;&nbsp;</a></span>computation_checker_warned_unused_input</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> computation_checker_warned_unused_input = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Checks that we never use variables before they are allocated or after they are deallocated, and some other checks that can be done from the <a class="el" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a>. </p>

<p class="definition">Definition at line <a class="el" href="nnet-analyze_8cc_source.html#l00680">680</a> of file <a class="el" href="nnet-analyze_8cc_source.html">nnet-analyze.cc</a>.</p>

</div>
</div>
<a id="ac952f0840a7950dff80c1a89e69656d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac952f0840a7950dff80c1a89e69656d7">&#9670;&nbsp;</a></span>kNoTime</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int kNoTime = std::numeric_limits&lt;int32&gt;::min()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-common_8cc_source.html#l00573">573</a> of file <a class="el" href="nnet-common_8cc_source.html">nnet-common.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation-graph_8cc_source.html#l01946">ComputationStepsComputer::Check()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04331">ComputationLoopedOptimizer::CheckIdentifiedMatrices()</a>, <a class="el" href="nnet-compile_8cc_source.html#l00457">Compiler::ComputeInputLocationsList()</a>, <a class="el" href="convolution-test_8cc_source.html#l00218">kaldi::nnet3::time_height_convolution::ConvolveForwardSimple()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00574">RestrictedAttentionComponent::CreateIndexesVector()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l01246">MatrixExtender::FixDebugInfo()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00506">RestrictedAttentionComponent::GetInputIndexes()</a>, <a class="el" href="nnet-convolutional-component_8cc_source.html#l00503">TimeHeightConvolutionComponent::GetInputIndexes()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00454">TdnnComponent::GetInputIndexes()</a>, <a class="el" href="nnet-compile-utils_8cc_source.html#l00621">GetTList()</a>, <a class="el" href="nnet-attention-component_8cc_source.html#l00526">RestrictedAttentionComponent::IsComputable()</a>, <a class="el" href="nnet-convolutional-component_8cc_source.html#l00518">TimeHeightConvolutionComponent::IsComputable()</a>, <a class="el" href="nnet-tdnn-component_8cc_source.html#l00469">TdnnComponent::IsComputable()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l04121">ComputationLoopedOptimizer::NormalizeCindexes()</a>, <a class="el" href="nnet-common_8h_source.html#l00068">Index::operator+=()</a>, <a class="el" href="convolution_8cc_source.html#l01505">kaldi::nnet3::time_height_convolution::SetSomeIndexesBlank()</a>, and <a class="el" href="convolution-test_8cc_source.html#l00198">kaldi::nnet3::time_height_convolution::ZeroBlankRows()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
