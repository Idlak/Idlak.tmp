<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: kaldi::cu Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacekaldi_1_1cu.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">kaldi::cu Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4892d89808a79d92c975653f60bac528"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a4892d89808a79d92c975653f60bac528"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a4892d89808a79d92c975653f60bac528">RegularizeL1</a> (<a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *weight, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *gradient, Real l1_penalty, Real learning_rate)</td></tr>
<tr class="memdesc:a4892d89808a79d92c975653f60bac528"><td class="mdescLeft">&#160;</td><td class="mdescRight">RegularizeL1 is a gradient step with l1 regularization added to the gradient.  <a href="#a4892d89808a79d92c975653f60bac528">More...</a><br /></td></tr>
<tr class="separator:a4892d89808a79d92c975653f60bac528"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadabf21b0ceab29b444130080721d686"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:aadabf21b0ceab29b444130080721d686"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#aadabf21b0ceab29b444130080721d686">Randomize</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;copy_from_idx, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *tgt)</td></tr>
<tr class="memdesc:aadabf21b0ceab29b444130080721d686"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies a permutation of src into tgt.  <a href="#aadabf21b0ceab29b444130080721d686">More...</a><br /></td></tr>
<tr class="separator:aadabf21b0ceab29b444130080721d686"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a695ade8cf4a02e68fd024f8bef9696"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a0a695ade8cf4a02e68fd024f8bef9696"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a0a695ade8cf4a02e68fd024f8bef9696">Splice</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;frame_offsets, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *tgt)</td></tr>
<tr class="memdesc:a0a695ade8cf4a02e68fd024f8bef9696"><td class="mdescLeft">&#160;</td><td class="mdescRight">Splice concatenates frames of src as specified in frame_offsets into tgt.  <a href="#a0a695ade8cf4a02e68fd024f8bef9696">More...</a><br /></td></tr>
<tr class="separator:a0a695ade8cf4a02e68fd024f8bef9696"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42584465c09901a98e3c5094d881215e"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a42584465c09901a98e3c5094d881215e"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e">Copy</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;copy_from_indices, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *tgt)</td></tr>
<tr class="memdesc:a42584465c09901a98e3c5094d881215e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies elements from src into tgt as given by copy_from_indices.  <a href="#a42584465c09901a98e3c5094d881215e">More...</a><br /></td></tr>
<tr class="separator:a42584465c09901a98e3c5094d881215e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa998160ba6b5d5d28ba82fa159924648"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:aa998160ba6b5d5d28ba82fa159924648"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#aa998160ba6b5d5d28ba82fa159924648">EnsureNonzero</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;src, Real epsilon, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *dest)</td></tr>
<tr class="memdesc:aa998160ba6b5d5d28ba82fa159924648"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function requires that src and dest have the same dimension and epsilon &gt; 0.  <a href="#aa998160ba6b5d5d28ba82fa159924648">More...</a><br /></td></tr>
<tr class="separator:aa998160ba6b5d5d28ba82fa159924648"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62f3c85ff5d880e86c536593989b06ed"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a62f3c85ff5d880e86c536593989b06ed">RegularizeL1</a> (<a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *weight, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *grad, <a class="el" href="classfloat.html">float</a> l1, <a class="el" href="classfloat.html">float</a> lr)</td></tr>
<tr class="separator:a62f3c85ff5d880e86c536593989b06ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c9eeda9ffdf0ea3f8ebf51ee1a48880"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a6c9eeda9ffdf0ea3f8ebf51ee1a48880">RegularizeL1</a> (<a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *weight, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *grad, double l1, double lr)</td></tr>
<tr class="separator:a6c9eeda9ffdf0ea3f8ebf51ee1a48880"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5294e49c288d7b13faaa7589bcc541a5"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a5294e49c288d7b13faaa7589bcc541a5">Splice</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;frame_offsets, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *tgt)</td></tr>
<tr class="separator:a5294e49c288d7b13faaa7589bcc541a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75e5756a55bcaf0a7f43b84c79a6d4f6"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a75e5756a55bcaf0a7f43b84c79a6d4f6">Splice</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;frame_offsets, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *tgt)</td></tr>
<tr class="separator:a75e5756a55bcaf0a7f43b84c79a6d4f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04b0bdfcd2d48d497bace3f22b988045"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a04b0bdfcd2d48d497bace3f22b988045">Copy</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;copy_from_indices, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *tgt)</td></tr>
<tr class="separator:a04b0bdfcd2d48d497bace3f22b988045"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24e2693b7b978439329d8850cce8716b"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a24e2693b7b978439329d8850cce8716b">Copy</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;copy_from_indices, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *tgt)</td></tr>
<tr class="separator:a24e2693b7b978439329d8850cce8716b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6f2832396582dba363263c618c97a85"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#ae6f2832396582dba363263c618c97a85">Randomize</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;copy_from_idx, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *tgt)</td></tr>
<tr class="separator:ae6f2832396582dba363263c618c97a85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4317ab1d0ad4ac8815bf38b68d984e08"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a4317ab1d0ad4ac8815bf38b68d984e08">Randomize</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;src, const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;copy_from_idx, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *tgt)</td></tr>
<tr class="separator:a4317ab1d0ad4ac8815bf38b68d984e08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a177cba8d311fbafbe0c1e8da8374eaec"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a177cba8d311fbafbe0c1e8da8374eaec"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a177cba8d311fbafbe0c1e8da8374eaec">NormalizePerRow</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;in, const Real target_rms, const <a class="el" href="classbool.html">bool</a> add_log_stddev, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *out)</td></tr>
<tr class="memdesc:a177cba8d311fbafbe0c1e8da8374eaec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Normalize nonlinearity modifies the vector of activations by scaling it so that the root-mean-square equals 1.0.  <a href="#a177cba8d311fbafbe0c1e8da8374eaec">More...</a><br /></td></tr>
<tr class="separator:a177cba8d311fbafbe0c1e8da8374eaec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a122827a22a3b13b78f8b0358f6c64c07"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a122827a22a3b13b78f8b0358f6c64c07">NormalizePerRow</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;in, const <a class="el" href="classfloat.html">float</a> target_rms, const <a class="el" href="classbool.html">bool</a> add_log_stddev, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *out)</td></tr>
<tr class="separator:a122827a22a3b13b78f8b0358f6c64c07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af338f27f59b00682d538195a3cfd896a"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#af338f27f59b00682d538195a3cfd896a">NormalizePerRow</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;in, const double target_rms, const <a class="el" href="classbool.html">bool</a> add_log_stddev, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *out)</td></tr>
<tr class="separator:af338f27f59b00682d538195a3cfd896a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8113283cedb535b7fe53ba2dedacef2e"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a8113283cedb535b7fe53ba2dedacef2e"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a8113283cedb535b7fe53ba2dedacef2e">DiffNormalizePerRow</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;in_value, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;out_deriv, const Real target_rms, const <a class="el" href="classbool.html">bool</a> add_log_stddev, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *in_deriv)</td></tr>
<tr class="separator:a8113283cedb535b7fe53ba2dedacef2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b4b706c3ec872912d5a474c4dd74482"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a3b4b706c3ec872912d5a474c4dd74482">DiffNormalizePerRow</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;in_value, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;out_deriv, const <a class="el" href="classfloat.html">float</a> target_rms, const <a class="el" href="classbool.html">bool</a> add_log_stddev, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *in_deriv)</td></tr>
<tr class="separator:a3b4b706c3ec872912d5a474c4dd74482"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a783b5c309d8e059f92d1da03d873a0f6"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a783b5c309d8e059f92d1da03d873a0f6">DiffNormalizePerRow</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;in_value, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;out_deriv, const double target_rms, const <a class="el" href="classbool.html">bool</a> add_log_stddev, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *in_deriv)</td></tr>
<tr class="separator:a783b5c309d8e059f92d1da03d873a0f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ed3f905e86f54ae19fc23b5bf543e16"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a8ed3f905e86f54ae19fc23b5bf543e16"><td class="memTemplItemLeft" align="right" valign="top">static Real&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">ScalarSigmoid</a> (Real a)</td></tr>
<tr class="separator:a8ed3f905e86f54ae19fc23b5bf543e16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34679f52e8b49430a41f0b4614cee304"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a34679f52e8b49430a41f0b4614cee304"><td class="memTemplItemLeft" align="right" valign="top">static Real&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a34679f52e8b49430a41f0b4614cee304">ScalarTanh</a> (Real a)</td></tr>
<tr class="separator:a34679f52e8b49430a41f0b4614cee304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8e7126fa88ceffe492625fcf535662a"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ae8e7126fa88ceffe492625fcf535662a"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#ae8e7126fa88ceffe492625fcf535662a">CpuComputeLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;input_mat, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;params_mat, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *output)</td></tr>
<tr class="separator:ae8e7126fa88ceffe492625fcf535662a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad83da5d9ea1bd6ddcdc4bccc99689fdb"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ad83da5d9ea1bd6ddcdc4bccc99689fdb"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#ad83da5d9ea1bd6ddcdc4bccc99689fdb">ComputeLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;params, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *output)</td></tr>
<tr class="memdesc:ad83da5d9ea1bd6ddcdc4bccc99689fdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">this is a special-purpose function used by class LstmNonlinearityComponent, to do its forward propagation.  <a href="#ad83da5d9ea1bd6ddcdc4bccc99689fdb">More...</a><br /></td></tr>
<tr class="separator:ad83da5d9ea1bd6ddcdc4bccc99689fdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a54cb875280023ba744317139209dc0"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a7a54cb875280023ba744317139209dc0">CpuComputeLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;input_mat, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;params_mat, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *output)</td></tr>
<tr class="separator:a7a54cb875280023ba744317139209dc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace30af7f820b84b2781518ee8e00822a"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#ace30af7f820b84b2781518ee8e00822a">CpuComputeLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;input_mat, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;params_mat, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *output)</td></tr>
<tr class="separator:ace30af7f820b84b2781518ee8e00822a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83cccc24dea4a31ccb4972e902b0f3ba"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a83cccc24dea4a31ccb4972e902b0f3ba">ComputeLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;params, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *output)</td></tr>
<tr class="separator:a83cccc24dea4a31ccb4972e902b0f3ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad188ec73751fd5bc0124302434ecfc6a"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#ad188ec73751fd5bc0124302434ecfc6a">ComputeLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;params, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *output)</td></tr>
<tr class="separator:ad188ec73751fd5bc0124302434ecfc6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c82a873d33bcfc7251d9f36d7f5231c"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a9c82a873d33bcfc7251d9f36d7f5231c"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a9c82a873d33bcfc7251d9f36d7f5231c">CpuBackpropLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;input, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;params, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;output_deriv, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;deriv_sum_in, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;self_repair_config, double count_in, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *input_deriv, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *params_deriv, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *value_sum_out, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *deriv_sum_out, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *self_repair_sum_out)</td></tr>
<tr class="separator:a9c82a873d33bcfc7251d9f36d7f5231c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9035dd9b21d42ab1da977a8bf69b20f5"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:a9035dd9b21d42ab1da977a8bf69b20f5"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a9035dd9b21d42ab1da977a8bf69b20f5">BackpropLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;params, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;output_deriv, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;deriv_sum_in, const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; Real &gt; &amp;self_repair_config, double count_in, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *input_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *params_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *value_sum_out, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *deriv_sum_out, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *self_repair_sum_out)</td></tr>
<tr class="memdesc:a9035dd9b21d42ab1da977a8bf69b20f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function does the 'backward' pass corresponding to the function ComputeLstmNonlinearity.  <a href="#a9035dd9b21d42ab1da977a8bf69b20f5">More...</a><br /></td></tr>
<tr class="separator:a9035dd9b21d42ab1da977a8bf69b20f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af71f2971e84cd2625cf87e544b3edb91"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:af71f2971e84cd2625cf87e544b3edb91"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#af71f2971e84cd2625cf87e544b3edb91">EnsureNonzero</a> (const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; Real &gt; &amp;src, Real epsilon, <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; Real &gt; *dest)</td></tr>
<tr class="memdesc:af71f2971e84cd2625cf87e544b3edb91"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1Vector.html" title="A class representing a vector. ">Vector</a> version of EnsureNonzero, see matrix version for documentation.  <a href="#af71f2971e84cd2625cf87e544b3edb91">More...</a><br /></td></tr>
<tr class="separator:af71f2971e84cd2625cf87e544b3edb91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ada34c41e30e57339d69e58effb62bf"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a5ada34c41e30e57339d69e58effb62bf">EnsureNonzero</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;src, <a class="el" href="classfloat.html">float</a> epsilon, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *dest)</td></tr>
<tr class="separator:a5ada34c41e30e57339d69e58effb62bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71e87a9e17dffbc17b367edb43c3d12e"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a71e87a9e17dffbc17b367edb43c3d12e">EnsureNonzero</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;src, double epsilon, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *dest)</td></tr>
<tr class="separator:a71e87a9e17dffbc17b367edb43c3d12e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6a561ada4f2860a6eed9066064719a4"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#ae6a561ada4f2860a6eed9066064719a4">EnsureNonzero</a> (const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;src, <a class="el" href="classfloat.html">float</a> epsilon, <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *dest)</td></tr>
<tr class="separator:ae6a561ada4f2860a6eed9066064719a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4b4f4f4c42b7dc3dd3e6460f6175b3a"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#aa4b4f4f4c42b7dc3dd3e6460f6175b3a">EnsureNonzero</a> (const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; double &gt; &amp;src, double epsilon, <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; double &gt; *dest)</td></tr>
<tr class="separator:aa4b4f4f4c42b7dc3dd3e6460f6175b3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab660ff528fa9fa9b3bb49284ebfa0d59"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#ab660ff528fa9fa9b3bb49284ebfa0d59">CpuBackpropLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;input, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;params, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;output_deriv, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;deriv_sum_in, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;self_repair_config, double count_in, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *input_deriv, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *params_deriv, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *value_sum_out, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *deriv_sum_out, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *self_repair_sum_out)</td></tr>
<tr class="separator:ab660ff528fa9fa9b3bb49284ebfa0d59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1aa7a68b9e7a8e2dbe0cf91fa2c30f85"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a1aa7a68b9e7a8e2dbe0cf91fa2c30f85">CpuBackpropLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;input, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;params, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;output_deriv, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;deriv_sum_in, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; double &gt; &amp;self_repair_config, double count_in, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *input_deriv, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *params_deriv, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *value_sum_out, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *deriv_sum_out, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *self_repair_sum_out)</td></tr>
<tr class="separator:a1aa7a68b9e7a8e2dbe0cf91fa2c30f85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66e07baac65c8758ab3d4241a67737eb"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#a66e07baac65c8758ab3d4241a67737eb">BackpropLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;params, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;output_deriv, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;deriv_sum_in, const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;self_repair_config, double count_in, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *input_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *params_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *value_sum_out, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *deriv_sum_out, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *self_repair_sum_out)</td></tr>
<tr class="separator:a66e07baac65c8758ab3d4241a67737eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc9b802c50657ae33d4c712df0e754ba"><td class="memItemLeft" align="right" valign="top">template void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1cu.html#adc9b802c50657ae33d4c712df0e754ba">BackpropLstmNonlinearity</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;input, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;params, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;output_deriv, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;deriv_sum_in, const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; double &gt; &amp;self_repair_config, double count_in, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *input_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *params_deriv, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *value_sum_out, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *deriv_sum_out, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *self_repair_sum_out)</td></tr>
<tr class="separator:adc9b802c50657ae33d4c712df0e754ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a9035dd9b21d42ab1da977a8bf69b20f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9035dd9b21d42ab1da977a8bf69b20f5">&#9670;&nbsp;</a></span>BackpropLstmNonlinearity() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BackpropLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_sum_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>self_repair_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>count_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>value_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>deriv_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>self_repair_sum_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function does the 'backward' pass corresponding to the function ComputeLstmNonlinearity. </p>
<p>It's a little more complicated than you might expect because of the 'self-repair' mechanism that we use to prevent the sigmoid and tanh nonlinearities oversaturating, and because of the average-activation and average-derivative stats that we store for these nonlinearites (these stats are used both to control the self-repair mechanism, and for diagnostic purposes).</p>
<p>Because the forward pass computes various intermediate values that are not output, this function actually has to do the same computations as the forward pass before it actually does the backprop.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>The same as in <a class="el" href="namespacekaldi_1_1cu.html#ad83da5d9ea1bd6ddcdc4bccc99689fdb" title="this is a special-purpose function used by class LstmNonlinearityComponent, to do its forward propaga...">ComputeLstmNonlinearity()</a>. A matrix, of dimension N by 5C (i.e. its num-cols must be a multiple of 5). The column-space is interpreted as 5 consecutive blocks, each of dimension C, which we name: (i_part, f_part, c_part, o_part, c_{t-1}). This function will also accept input of dimension N by 5C + 3, and the three final elements will be interpreted as scaling factors on i_t, f_t and o_t (useful as per-frame dropout masks). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">params</td><td>The same as in <a class="el" href="namespacekaldi_1_1cu.html#ad83da5d9ea1bd6ddcdc4bccc99689fdb" title="this is a special-purpose function used by class LstmNonlinearityComponent, to do its forward propaga...">ComputeLstmNonlinearity()</a>. A matrix, of dimension 3 by C, with rows containing the three diagonal parameter matrices used in LSTMs, namely w_{ic}, w_{fc} and w_{oc}. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">output_deriv</td><td>A matrix, of dimension N by 2C, containing the derivative of the objective function we're backpropagating, w.r.t. the quantities c_t and m_t (in two blocks of column-dimension C). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">deriv_sum_in</td><td>This is used in the self-repair code to identify oversaturated nonlinearities. It is a matrix, of dimension 5 by C, corresponding to the totals of the derivatives of the 5 sigmoid and tanh nonlinearities, in they order they appear in the equations in the documentation of <a class="el" href="namespacekaldi_1_1cu.html#ad83da5d9ea1bd6ddcdc4bccc99689fdb" title="this is a special-purpose function used by class LstmNonlinearityComponent, to do its forward propaga...">ComputeLstmNonlinearity()</a> Rspectively, they appear in the equations for (i_t, f_t, c_t, o_t, m_t). This will be divided by 'count_in' to get the average derivative value so far, for each of the nonlinearities. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">self_repair_config</td><td>A vector of dimension 10, containing the configuration of the self-repair to be used for the 5 nonlinearities. The first 5 elements are the self_repair_lower_threshold values (typically 0.05 for sigmoid and 0.2 for tanh), and the next 5 elements are the corresponding self-repair-scales (typically 10^-5). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">count_in</td><td>The data-count that corresponds to the stats in 'deriv_sum_in' at entry to the function. This function should tolerate the count being zero (in that case, it is free to do the self-repair or not, as this should only happen on the 1st minibatch of each training job). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">input_deriv</td><td>May be NULL; if not, this function writes, to this location, the backpropagated derivative of the objective function w.r.t. the 'input' matrix. This matrix should have the same dimension as 'input'. In addition to the regular backpropagated derivative, the output will include small values relating to 'self-repair'. If the input is of column-dimension 5C + 3 (i.e. we are using dropout masks), the derivatives w.r.t. the dropout masks will not be set; they will retain their value prior to this function call. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">params_deriv</td><td>May be NULL; if not, this is where this function *writes* [not adds] the backpropagated derivative of the objective function w.r.t. 'params'; it should have the same dimension as 'params' (3 by C). (This matrix will then be processed by the natural gradient code and added to the appropriate copy of the parameter matrix, outside this function). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">value_sum_out</td><td>Must be NULL if params_deriv is NULL; if not, a matrix of dimension 5 by C. This function *adds* to this location the total value of each of the sigmoid/tanh nonlinearities that it computes (this is for diagnostic purposes). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">deriv_sum_out</td><td>Must be NULL if params_deriv is NULL; if not, a matrix of dimension 5 by C; this function *adds* to this location the total of the derivative of each of the sigmoid/tanh nonlinearities that it computes (this is for diagnostic purposes and to control the self-repair). This function should tolerate the case when 'deriv_sum_out' points to the same data as 'deriv_sum_in'. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">self_repair_sum_out</td><td>Must be NULL if params_deriv is NULL; if not, a matrix of dimension 5 by C; this function *writes* to this location the sum of the number of times the self-repair code was activated (integer values 0 &lt;= k &lt;= N). This will be processed outside this function into self-repair stats for diagnostics. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00768">768</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-math_8cc_source.html#l00543">CpuBackpropLstmNonlinearity()</a>, <a class="el" href="cu-matrixdim_8h_source.html#l00063">CU1DBLOCK</a>, <a class="el" href="cu-vector_8h_source.html#l00071">CuVectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-vector_8h_source.html#l00068">CuVectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="cu-matrix_8h_source.html#l00698">CuMatrixBase&lt; Real &gt;::Mat()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l01065">kaldi::SameDim()</a>, <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>, and <a class="el" href="cu-vector_8h_source.html#l00220">CuVectorBase&lt; Real &gt;::Vec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8cc_source.html#l05764">LstmNonlinearityComponent::Backprop()</a>, <a class="el" href="cu-math_8cc_source.html#l00915">EnsureNonzero()</a>, <a class="el" href="cu-math-test_8cc_source.html#l00321">kaldi::UnitTestBackpropLstmNonlinearity()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00213">kaldi::UnitTestLstmNonlinearity()</a>.</p>
<div class="fragment"><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                                                       {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  int32 num_rows = input.NumRows(),</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        cell_dim = input.NumCols() / 5,</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      input_cols = input.NumCols();</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">// Check dimensions.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_cols == (cell_dim * 5) || input_cols == (cell_dim*5) + 3);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumRows() == 3);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumCols() == cell_dim);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_deriv.NumRows() == num_rows);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_deriv.NumCols() == 2 * cell_dim);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() == 5);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>() == cell_dim);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_config.Dim() == 10);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">if</span> (input_deriv != NULL) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(input, *input_deriv));</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordflow">if</span> (params_deriv == NULL) {</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out == NULL);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_out == NULL);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out == NULL);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out != NULL);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_out != NULL);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out != NULL);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(params, *params_deriv));</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() == 5);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>() == cell_dim);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(*value_sum_out, *deriv_sum_out));</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out-&gt;NumRows() == 5);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out-&gt;NumCols() == cell_dim);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// Each thread block is working on 1 row of the data.</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="comment">// It&#39;s best that cell dim is a multiple fo CU1DBLOCK</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordtype">int</span> have_dropout_mask = (input_cols == (cell_dim * 5) + 3);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">// Use 2D block (8x32 threads) as we need to compute column sum.</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// Use 1D grid to cover the data matrix width `cell_dim`.</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> kWarpSize = 32;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    dim3 dimBlock(kWarpSize, <a class="code" href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a> / kWarpSize);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">//    dim3 dimGrid(n_blocks(cell_dim, dimBlock.x),</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">//                 n_blocks(num_rows, dimBlock.y));</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">//    if (dimGrid.x * dimGrid.y &gt; 1024) {</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">//      dimGrid.y = std::max(1024 / dimGrid.x, 1);</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">//    }</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    dim3 dimGrid(n_blocks(cell_dim, dimBlock.x));</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">if</span> (input_deriv == NULL) {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keywordflow">if</span> (params_deriv == NULL) {</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        cuda_diff_lstm_nonlinearity(dimGrid, dimBlock, cell_dim,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                    have_dropout_mask, num_rows,</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                                    input.Data(), input.Stride(), params.Data(),</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                                    params.Stride(), output_deriv.Data(),</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                                    output_deriv.Stride(), deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                                    deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                                    self_repair_config.Data(), count_in + 1,</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                                    NULL,</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                                    0,</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                                    NULL,</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                                    0,</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                                    NULL,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                                    0,</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                    NULL,</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                    0,</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                    NULL,</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                    0);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        cuda_diff_lstm_nonlinearity(dimGrid, dimBlock, cell_dim,</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                                    have_dropout_mask, num_rows,</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                                    input.Data(), input.Stride(), params.Data(),</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                                    params.Stride(), output_deriv.Data(),</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                                    output_deriv.Stride(), deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                                    deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                                    self_repair_config.Data(), count_in + 1,</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                                    NULL,</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                                    0, params_deriv-&gt;Data(),</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                                    params_deriv-&gt;Stride(),</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                                    value_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                    value_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                                    deriv_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                                    deriv_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                                    self_repair_sum_out-&gt;Data(),</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                                    self_repair_sum_out-&gt;Stride());</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordflow">if</span> (params_deriv == NULL) {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        cuda_diff_lstm_nonlinearity(dimGrid, dimBlock, cell_dim,</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                                    have_dropout_mask, num_rows,</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                                    input.Data(), input.Stride(), params.Data(),</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                                    params.Stride(), output_deriv.Data(),</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                    output_deriv.Stride(), deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                                    deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                                    self_repair_config.Data(), count_in + 1,</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                    input_deriv-&gt;Data(), input_deriv-&gt;Stride(),</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                    NULL,</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                                    0, NULL, 0, NULL, 0, NULL, 0);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        cuda_diff_lstm_nonlinearity(dimGrid, dimBlock, cell_dim,</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                    have_dropout_mask, num_rows,</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                    input.Data(), input.Stride(), params.Data(),</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                    params.Stride(), output_deriv.Data(),</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                                    output_deriv.Stride(), deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                                    deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                                    self_repair_config.Data(), count_in + 1,</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                                    input_deriv-&gt;Data(), input_deriv-&gt;Stride(),</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                    params_deriv-&gt;Data(),</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                    params_deriv-&gt;Stride(),</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                    value_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                    value_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                    deriv_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">Data</a>(),</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                                    deriv_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">Stride</a>(),</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                    self_repair_sum_out-&gt;Data(),</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                    self_repair_sum_out-&gt;Stride());</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <a class="code" href="namespacekaldi_1_1cu.html#a1aa7a68b9e7a8e2dbe0cf91fa2c30f85">CpuBackpropLstmNonlinearity</a>(input.Mat(), params.Mat(), output_deriv.Mat(),</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                deriv_sum_in.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a1ae27d8d38f2a7651c76b4f102867dee">Mat</a>(), self_repair_config.Vec(),</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                count_in, &amp;(input_deriv-&gt;Mat()),</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                                &amp;(params_deriv-&gt;Mat()), &amp;(value_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a1ae27d8d38f2a7651c76b4f102867dee">Mat</a>()),</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                &amp;(deriv_sum_out-&gt;<a class="code" href="classkaldi_1_1CuMatrixBase.html#a1ae27d8d38f2a7651c76b4f102867dee">Mat</a>()),</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                &amp;(self_repair_sum_out-&gt;Mat()));</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a1ae27d8d38f2a7651c76b4f102867dee"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a1ae27d8d38f2a7651c76b4f102867dee">kaldi::CuMatrixBase::Mat</a></div><div class="ttdeci">const MatrixBase&lt; Real &gt; &amp; Mat() const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00698">cu-matrix.h:698</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a180e10f97fa838f9c1ae125ba164dd77"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a180e10f97fa838f9c1ae125ba164dd77">kaldi::CuMatrixBase::Stride</a></div><div class="ttdeci">MatrixIndexT Stride() const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00216">cu-matrix.h:216</a></div></div>
<div class="ttc" id="group__matrix__funcs__io_html_ga07b147212efb08775c252cd4cc7453fe"><div class="ttname"><a href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">kaldi::SameDim</a></div><div class="ttdeci">bool SameDim(const MatrixBase&lt; Real &gt; &amp;M, const MatrixBase&lt; Real &gt; &amp;N)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l01065">kaldi-matrix.h:1065</a></div></div>
<div class="ttc" id="namespacekaldi_1_1cu_html_a1aa7a68b9e7a8e2dbe0cf91fa2c30f85"><div class="ttname"><a href="namespacekaldi_1_1cu.html#a1aa7a68b9e7a8e2dbe0cf91fa2c30f85">kaldi::cu::CpuBackpropLstmNonlinearity</a></div><div class="ttdeci">template void CpuBackpropLstmNonlinearity(const MatrixBase&lt; double &gt; &amp;input, const MatrixBase&lt; double &gt; &amp;params, const MatrixBase&lt; double &gt; &amp;output_deriv, const MatrixBase&lt; double &gt; &amp;deriv_sum_in, const VectorBase&lt; double &gt; &amp;self_repair_config, double count_in, MatrixBase&lt; double &gt; *input_deriv, MatrixBase&lt; double &gt; *params_deriv, MatrixBase&lt; double &gt; *value_sum_out, MatrixBase&lt; double &gt; *deriv_sum_out, MatrixBase&lt; double &gt; *self_repair_sum_out)</div></div>
<div class="ttc" id="cu-matrixdim_8h_html_a6dbdf9d0385c92d6d915b96eaf9ce99e"><div class="ttname"><a href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a></div><div class="ttdeci">#define CU1DBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00063">cu-matrixdim.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_aa5a0f4f5fe999cc628776f18ef9138b3"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#aa5a0f4f5fe999cc628776f18ef9138b3">kaldi::CuMatrixBase::Data</a></div><div class="ttdeci">const Real * Data() const</div><div class="ttdoc">Return data pointer (const). </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00689">cu-matrix.h:689</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::CuMatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00215">cu-matrix.h:215</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::CuMatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Dimensions. </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00214">cu-matrix.h:214</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a66e07baac65c8758ab3d4241a67737eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66e07baac65c8758ab3d4241a67737eb">&#9670;&nbsp;</a></span>BackpropLstmNonlinearity() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::BackpropLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_sum_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>self_repair_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>count_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>value_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>deriv_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>self_repair_sum_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adc9b802c50657ae33d4c712df0e754ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc9b802c50657ae33d4c712df0e754ba">&#9670;&nbsp;</a></span>BackpropLstmNonlinearity() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::BackpropLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_sum_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>self_repair_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>count_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>value_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>deriv_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>self_repair_sum_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad83da5d9ea1bd6ddcdc4bccc99689fdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad83da5d9ea1bd6ddcdc4bccc99689fdb">&#9670;&nbsp;</a></span>ComputeLstmNonlinearity() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>this is a special-purpose function used by class LstmNonlinearityComponent, to do its forward propagation. </p>
<p>It computes the core part of the LSTM nonlinearity. Refer to class LstmNonlinearityComponent in ../nnet3/nnet-simple-component.h for more context.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>A matrix, of dimension N by 5C (i.e. its num-cols must be a multiple of 5). The column-space is interpreted as 5 consecutive blocks, each of dimension C, which we name: (i_part, f_part, c_part, o_part, c_{t-1}). This function will also accept input of dimension N by 5C + 3, and the three final elements will be used as scaling factors on i_t, f_t and o_t (useful as per-frame dropout masks). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">params</td><td>A matrix, of dimension 3 by C, with rows containing the three diagonal parameter matrices used in LSTMs, namely w_{ic}, w_{fc} and w_{oc}. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">output</td><td>A matrix, of dimension N by 2C. The quantities c_t and m_t respectively are put there (in two blocks of column-dimension C), according to the following equations:</td></tr>
  </table>
  </dd>
</dl>
<p>i_t = Sigmoid(i_part + w_{ic}*c_{t-1}) f_t = Sigmoid(f_part + w_{fc}*c_{t-1}) c_t = f_t*c_{t-1} + i_t * Tanh(c_part) o_t = Sigmoid(o_part + w_{oc}*c_t) m_t = o_t * Tanh(c_t)</p>
<p>Note on dropout: if the dropout mask is provided, let the mask values be i_t_mask, f_t_mask and o_t_mask (for each matrix row, these are scalars while i_t, f_t and o_t are of dimension C, because this is 'per-frame' dropout as described in <a href="http://www.danielpovey.com/files/2017_interspeech_dropout.pdf">http://www.danielpovey.com/files/2017_interspeech_dropout.pdf</a>). Then the modification to the equations above consists of replacing 'i_t' with 'i_t_mask * i_t' in the RHS of the equations above, and the same type of change for f_t and o_t. </p>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00489">489</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-math_8cc_source.html#l00445">CpuComputeLstmNonlinearity()</a>, <a class="el" href="cu-matrixdim_8h_source.html#l00063">CU1DBLOCK</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="cu-matrix_8h_source.html#l00698">CuMatrixBase&lt; Real &gt;::Mat()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8cc_source.html#l05755">LstmNonlinearityComponent::Propagate()</a>, <a class="el" href="cu-math-test_8cc_source.html#l00166">kaldi::UnitTestCuMathComputeLstmNonlinearity()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00213">kaldi::UnitTestLstmNonlinearity()</a>.</p>
<div class="fragment"><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                                         {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  int32 num_rows = input.NumRows(),</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      input_cols = input.NumCols(),</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        cell_dim = input_cols / 5;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_cols == (cell_dim * 5) || input_cols == (cell_dim * 5) + 3);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;NumRows() == num_rows);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumRows() == 3);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumCols() == cell_dim);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;NumCols() == 2 * cell_dim);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordtype">int</span> have_dropout_mask = (input_cols == (cell_dim * 5) + 3);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">// Each thread block is working on 1 row of the data.</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// It&#39;s best that cell dim is a multiple fo CU1DBLOCK</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    dim3 dimBlock(<a class="code" href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    dim3 dimGrid(num_rows);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    cuda_lstm_nonlinearity(dimGrid, dimBlock, input.Data(), input.Stride(),</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                           params.Data(), params.Stride(), output-&gt;Stride(),</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                           cell_dim, have_dropout_mask, num_rows, output-&gt;Data());</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="namespacekaldi_1_1cu.html#ace30af7f820b84b2781518ee8e00822a">CpuComputeLstmNonlinearity</a>(input.Mat(), params.Mat(), &amp;output-&gt;Mat());</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1cu_html_ace30af7f820b84b2781518ee8e00822a"><div class="ttname"><a href="namespacekaldi_1_1cu.html#ace30af7f820b84b2781518ee8e00822a">kaldi::cu::CpuComputeLstmNonlinearity</a></div><div class="ttdeci">template void CpuComputeLstmNonlinearity(const MatrixBase&lt; double &gt; &amp;input_mat, const MatrixBase&lt; double &gt; &amp;params_mat, MatrixBase&lt; double &gt; *output)</div></div>
<div class="ttc" id="cu-matrixdim_8h_html_a6dbdf9d0385c92d6d915b96eaf9ce99e"><div class="ttname"><a href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a></div><div class="ttdeci">#define CU1DBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00063">cu-matrixdim.h:63</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a83cccc24dea4a31ccb4972e902b0f3ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83cccc24dea4a31ccb4972e902b0f3ba">&#9670;&nbsp;</a></span>ComputeLstmNonlinearity() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::ComputeLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad188ec73751fd5bc0124302434ecfc6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad188ec73751fd5bc0124302434ecfc6a">&#9670;&nbsp;</a></span>ComputeLstmNonlinearity() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::ComputeLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a42584465c09901a98e3c5094d881215e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42584465c09901a98e3c5094d881215e">&#9670;&nbsp;</a></span>Copy() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Copy </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>copy_from_indices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies elements from src into tgt as given by copy_from_indices. </p>
<p>The matrices src and tgt must have the same dimensions and the dimension of copy_from_indices must equal the number of columns in the src matrix. As a result, tgt(i, j) == src(i, copy_from_indices[j]). Also see <a class="el" href="classkaldi_1_1CuMatrixBase.html#a100c3bb9789f8626e5c92b8757933a11" title="Copies column r from column indexes[r] of src. ">CuMatrix::CopyCols()</a>, which is more general. </p>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00173">173</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrixdim_8h_source.html#l00067">CU2DBLOCK</a>, <a class="el" href="cu-array_8h_source.html#l00052">CuArrayBase&lt; T &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-array_8h_source.html#l00049">CuArrayBase&lt; T &gt;::Dim()</a>, <a class="el" href="cu-matrix_8h_source.html#l00220">CuMatrixBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="cu-matrix_8h_source.html#l00698">CuMatrixBase&lt; Real &gt;::Mat()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, and <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8h_source.html#l00237">Component::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00879">AffineComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01120">SpliceComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01157">SpliceMaxComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01189">BlockAffineComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01287">SumGroupComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01388">DctComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01440">FixedLinearComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01482">FixedAffineComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01528">FixedScaleComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01569">FixedBiasComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01611">DropoutComponent::BackpropNeedsOutput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01744">Convolutional1dComponent::BackpropNeedsOutput()</a>, <a class="el" href="nnet-descriptor_8cc_source.html#l00161">SwitchingForwardingDescriptor::Copy()</a>, <a class="el" href="cu-math_8cc_source.html#l00209">EnsureNonzero()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01330">PermuteComponent::OutputDim()</a>, <a class="el" href="nnet-various_8h_source.html#l00216">CopyComponent::PropagateFnc()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00056">kaldi::TestClusterUtilsVector()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00950">AffineComponentPreconditioned::Type()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00999">AffineComponentPreconditionedOnline::Type()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01253">BlockAffineComponentPreconditioned::Type()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00097">kaldi::UnitTestCuMathCopy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                   {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(copy_from_indices.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() == tgt-&gt;NumCols());</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src.NumRows() == tgt-&gt;NumRows());</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">  #if HAVE_CUDA == 1</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    dim3 dimBlock(<a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>, <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    dim3 dimGrid(n_blocks(tgt-&gt;NumCols(), <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>), n_blocks(tgt-&gt;NumRows(), <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>));</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    cuda_copy(dimGrid, dimBlock, tgt-&gt;Data(), src.Data(),</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;              copy_from_indices.<a class="code" href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">Data</a>(), tgt-&gt;Dim(), src.Dim());</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// expand in CPU</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keyword">const</span> MatrixBase&lt;Real&gt; &amp;srcmat = src.Mat();</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">const</span> int32 *copy_from_indicesvec = copy_from_indices.<a class="code" href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">Data</a>();</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    int32 dim = copy_from_indices.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    MatrixBase&lt;Real&gt; &amp;tgtmat = tgt-&gt;Mat();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">for</span>(int32 r = 0; r &lt; tgtmat.NumRows(); r++) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">for</span>(int32 c = 0; c &lt; dim; c++) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        tgtmat(r,c) = srcmat(r,copy_from_indicesvec[c]);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuArrayBase_html_a368b2398825ede0c99248a432c6fdc7b"><div class="ttname"><a href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">kaldi::CuArrayBase::Data</a></div><div class="ttdeci">const T * Data() const</div><div class="ttdoc">Get raw pointer. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array_8h_source.html#l00052">cu-array.h:52</a></div></div>
<div class="ttc" id="cu-matrixdim_8h_html_a84acd86e193bca04fb719c476fbcbe5b"><div class="ttname"><a href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a></div><div class="ttdeci">#define CU2DBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00067">cu-matrixdim.h:67</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1CuArrayBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::CuArrayBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Return the vector dimension. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array_8h_source.html#l00049">cu-array.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a04b0bdfcd2d48d497bace3f22b988045"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04b0bdfcd2d48d497bace3f22b988045">&#9670;&nbsp;</a></span>Copy() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::Copy </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>copy_from_indices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a24e2693b7b978439329d8850cce8716b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24e2693b7b978439329d8850cce8716b">&#9670;&nbsp;</a></span>Copy() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::Copy </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>copy_from_indices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9c82a873d33bcfc7251d9f36d7f5231c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c82a873d33bcfc7251d9f36d7f5231c">&#9670;&nbsp;</a></span>CpuBackpropLstmNonlinearity() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CpuBackpropLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_sum_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>self_repair_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>count_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>value_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>deriv_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>self_repair_sum_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00543">543</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="arpa-file-parser-test_8cc_source.html#l00066">count</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l01065">kaldi::SameDim()</a>, <a class="el" href="cu-math_8cc_source.html#l00424">ScalarSigmoid()</a>, and <a class="el" href="cu-math_8cc_source.html#l00434">ScalarTanh()</a>.</p>

<p class="reference">Referenced by <a class="el" href="cu-math_8cc_source.html#l00768">BackpropLstmNonlinearity()</a>, <a class="el" href="cu-math_8cc_source.html#l00915">EnsureNonzero()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00321">kaldi::UnitTestBackpropLstmNonlinearity()</a>.</p>
<div class="fragment"><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                                                        {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  int32 num_rows = input.NumRows(),</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      input_cols = input</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                   .NumCols(),</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        cell_dim = input.NumCols() / 5;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="comment">// Check dimensions.</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_cols == (cell_dim * 5) || input_cols == (cell_dim * 5) + 3);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumRows() == 3);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params.NumCols() == cell_dim);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_deriv.NumRows() == num_rows);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output_deriv.NumCols() == 2 * cell_dim);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_in.NumRows() == 5);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_in.NumCols() == cell_dim);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_config.Dim() == 10);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">if</span> (input_deriv != NULL) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(input, *input_deriv));</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">if</span> (params_deriv == NULL) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out == NULL);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_out == NULL);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out == NULL);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out != NULL);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_sum_out != NULL);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out != NULL);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(params, *params_deriv));</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out-&gt;NumRows() == 5);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(value_sum_out-&gt;NumCols() == cell_dim);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(*value_sum_out, *deriv_sum_out));</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out-&gt;NumRows() == 5);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(self_repair_sum_out-&gt;NumCols() == cell_dim);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keyword">const</span> MatrixBase&lt;Real&gt; &amp;input_mat = input;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keyword">const</span> MatrixBase&lt;Real&gt; &amp;params_mat = params;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keyword">const</span> MatrixBase&lt;Real&gt; &amp;output_deriv_mat = output_deriv;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keyword">const</span> MatrixBase&lt;double&gt; &amp;deriv_sum_in_mat = deriv_sum_in;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keyword">const</span> VectorBase&lt;Real&gt; &amp;sr_config = self_repair_config;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  MatrixBase&lt;Real&gt; *input_deriv_mat = (</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      input_deriv == NULL ? NULL : input_deriv);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  MatrixBase&lt;Real&gt; *params_deriv_mat = NULL;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  MatrixBase&lt;Real&gt; *self_repair_sum_out_mat = NULL;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  MatrixBase&lt;double&gt; *value_sum_out_mat = NULL;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  MatrixBase&lt;double&gt; *deriv_sum_out_mat = NULL;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">if</span> (params_deriv != NULL) {</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    params_deriv_mat = params_deriv;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    value_sum_out_mat = value_sum_out;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    deriv_sum_out_mat = deriv_sum_out;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    self_repair_sum_out_mat = self_repair_sum_out;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">// We add 1.0 (i.e. a small value) to the count to avoid division by zero.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  Real <a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a> = 1.0 + count_in;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; cell_dim; c++) {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">// parameters</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    Real w_ic = params_mat(0, c);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    Real w_fc = params_mat(1, c);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    Real w_oc = params_mat(2, c);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">// derivative sums w.r.t. parameters.</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    Real w_ic_deriv_sum = 0.0;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    Real w_fc_deriv_sum = 0.0;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    Real w_oc_deriv_sum = 0.0;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">// average derivatives, for self-repair.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">// The 5 nonlinearities that are subject to self-repair are written as:</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">//  Sigmoid(i_t_input), Sigmoid(f_t_input),</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">//  Tanh(c_part), Sigmoid(o_t_input),  Tanh(c_t)</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    Real i_t_self_repair = (</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        deriv_sum_in_mat(0, c) / count &lt; sr_config(0) ? sr_config(5) : 0.0);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    Real f_t_self_repair = (</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        deriv_sum_in_mat(1, c) / count &lt; sr_config(1) ? sr_config(6) : 0.0);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    Real c_part_self_repair = (</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        deriv_sum_in_mat(2, c) / count &lt; sr_config(2) ? sr_config(7) : 0.0);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    Real o_t_self_repair = (</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        deriv_sum_in_mat(3, c) / count &lt; sr_config(3) ? sr_config(8) : 0.0);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    Real c_t_self_repair = (</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        deriv_sum_in_mat(4, c) / count &lt; sr_config(4) ? sr_config(9) : 0.0);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">// Note on how we add self-repair for sigmoids/tanh&#39;s.  If self-repair</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// is activated for this unit, then...</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">// For sigmoids we&#39;d add -self_repair_scale * (2 * sigmoid(x) - 1.0)</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">// ... to the input-deriv;</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">// For tanh&#39;s we&#39;d add -self_repair_scale * tanh(x)</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">// If self-repair is not activated, the &#39;self_repair&#39; scales are set to zero.</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">// The following variables are for the accumulation of stats on the</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">// sigmoid and tanh units.</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    Real i_t_value_sum = 0.0, i_t_deriv_sum = 0.0;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    Real f_t_value_sum = 0.0, f_t_deriv_sum = 0.0;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    Real c_part_value_sum = 0.0, c_part_deriv_sum = 0.0;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    Real o_t_value_sum = 0.0, o_t_deriv_sum = 0.0;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    Real c_t_value_sum = 0.0, c_t_deriv_sum = 0.0;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      Real i_part = input_mat(r, c),</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          f_part = input_mat(r, c + cell_dim),</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          c_part = input_mat(r, c + 2 * cell_dim),</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          o_part = input_mat(r, c + 3 * cell_dim),</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          c_prev = input_mat(r, c + 4 * cell_dim);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      Real i_scale = (input_cols == cell_dim * 5 ? 1.0 :</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                      input_mat(r, cell_dim * 5)),</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;           f_scale = (input_cols == cell_dim * 5 ? 1.0 :</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                      input_mat(r, cell_dim * 5 + 1)),</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;           o_scale = (input_cols == cell_dim * 5 ? 1.0 :</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                      input_mat(r, cell_dim * 5 + 2));</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">// For greater clarity, we give some of the quantities in the</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="comment">// forward equations their own names.</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      Real i_t_input = i_part + w_ic * c_prev,</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          i_t = <a class="code" href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">ScalarSigmoid</a>(i_t_input),</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;          f_t_input = f_part + w_fc * c_prev,</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;          f_t = <a class="code" href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">ScalarSigmoid</a>(f_t_input),</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;          tanh_c_part = <a class="code" href="namespacekaldi_1_1cu.html#a34679f52e8b49430a41f0b4614cee304">ScalarTanh</a>(c_part),</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          c_t = f_t * f_scale * c_prev + i_t * i_scale * tanh_c_part,</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          o_t_input = o_part + w_oc * c_t,</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          o_t = <a class="code" href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">ScalarSigmoid</a>(o_t_input),</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;          tanh_c_t = <a class="code" href="namespacekaldi_1_1cu.html#a34679f52e8b49430a41f0b4614cee304">ScalarTanh</a>(c_t);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="comment">// we&#39;d also compute, in the forward pass,</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="comment">//   m_t = o_t * tanh_c_t;</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="comment">// but this variable is not needed.</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">// Accumulate nonlinearity value and derivative stats.</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="comment">// Note:</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">//    tanh&#39;(x)  = sech^2(x) = -(tanh(x)+1) (tanh(x)-1) = 1 - tanh^2(x)</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">//  sigmoid&#39;(x) = sigmoid(x) * (1 - sigmoid(x)).</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      i_t_value_sum += i_t;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      i_t_deriv_sum += i_t * (1.0F - i_t);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      f_t_value_sum += f_t;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      f_t_deriv_sum += f_t * (1.0F - f_t);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      c_part_value_sum += tanh_c_part;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      c_part_deriv_sum += 1.0F - tanh_c_part * tanh_c_part;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      o_t_value_sum += o_t;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      o_t_deriv_sum += o_t * (1.0F - o_t);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      c_t_value_sum += tanh_c_t;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      c_t_deriv_sum += 1.0F - tanh_c_t * tanh_c_t;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="comment">// the derivative of the objective function w.r.t. a particular quantity</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="comment">// will be written by prepending &quot;d&quot; to the name.</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="comment">// We compute these derivatives in the reverse of the order in which</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="comment">// we computed the original quantities.</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="comment">// dc_t_out is the part of the derivative w.r.t. c_t that</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="comment">// comes directly from the output of this function.</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      Real dc_t_out = output_deriv_mat(r, c);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      Real dm_t = output_deriv_mat(r, c + cell_dim);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      Real dtanh_c_t = o_t * o_scale * dm_t;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      Real do_t = o_scale * tanh_c_t * dm_t;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      Real do_t_input = (o_t * (1.0F - o_t) * do_t</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;          - (2.0F * o_t - 1.0F) * o_t_self_repair);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      Real dc_t = ((1.0F - tanh_c_t * tanh_c_t) * dtanh_c_t + dc_t_out</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          + do_t_input * w_oc) - tanh_c_t * c_t_self_repair;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      Real dtanh_c_part = i_t * i_scale * dc_t;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      Real df_t = dc_t * f_scale * c_prev;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      Real df_t_input = ((df_t * f_t * (1.0F - f_t)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                          - (2.0F * f_t - 1.0F) * f_t_self_repair));</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      Real di_t = dc_t * i_scale * tanh_c_part;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      Real di_t_input = ((di_t * i_t * (1.0F - i_t)</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                          - (2.0F * i_t - 1.0F) * i_t_self_repair));</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      w_ic_deriv_sum += c_prev * di_t_input;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      w_fc_deriv_sum += c_prev * df_t_input;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      w_oc_deriv_sum += c_t * do_t_input;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      Real dc_prev = w_ic * di_t_input + w_fc * df_t_input + f_t * f_scale * dc_t;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      Real do_part = do_t_input;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      Real dc_part = ((1.0F - tanh_c_part * tanh_c_part) * dtanh_c_part</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;          - tanh_c_part * c_part_self_repair);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      Real df_part = df_t_input;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      Real di_part = di_t_input;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordflow">if</span> (input_deriv_mat != NULL) {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        (*input_deriv_mat)(r, c) = di_part;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        (*input_deriv_mat)(r, c + cell_dim) = df_part;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        (*input_deriv_mat)(r, c + 2 * cell_dim) = dc_part;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        (*input_deriv_mat)(r, c + 3 * cell_dim) = do_part;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        (*input_deriv_mat)(r, c + 4 * cell_dim) = dc_prev;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      }</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span> (params_deriv != NULL) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">// note: for optimizing things you can assume that params_deriv and</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="comment">// input_deriv_mat are non-NULL (i.e. all the output matrices are</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">// non-NULL).  The situations when some of the output matrices are NULL</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">// does not happen often (mainly only in testing code).</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      (*params_deriv_mat)(0, c) = w_ic_deriv_sum;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      (*params_deriv_mat)(1, c) = w_fc_deriv_sum;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      (*params_deriv_mat)(2, c) = w_oc_deriv_sum;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      (*value_sum_out_mat)(0, c) += i_t_value_sum;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      (*value_sum_out_mat)(1, c) += f_t_value_sum;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      (*value_sum_out_mat)(2, c) += c_part_value_sum;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      (*value_sum_out_mat)(3, c) += o_t_value_sum;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      (*value_sum_out_mat)(4, c) += c_t_value_sum;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="comment">// need to update self_repair_sum_out before deriv_sum_out, because</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="comment">// deriv_sum_out and deriv_sum_in might point to the same memory.</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        (*self_repair_sum_out_mat)(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, c) =</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            (deriv_sum_in_mat(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, c) / count &lt; sr_config(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) ? num_rows : 0);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      (*deriv_sum_out_mat)(0, c) += i_t_deriv_sum;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      (*deriv_sum_out_mat)(1, c) += f_t_deriv_sum;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      (*deriv_sum_out_mat)(2, c) += c_part_deriv_sum;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      (*deriv_sum_out_mat)(3, c) += o_t_deriv_sum;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      (*deriv_sum_out_mat)(4, c) += c_t_deriv_sum;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div><div class="ttc" id="group__matrix__funcs__io_html_ga07b147212efb08775c252cd4cc7453fe"><div class="ttname"><a href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">kaldi::SameDim</a></div><div class="ttdeci">bool SameDim(const MatrixBase&lt; Real &gt; &amp;M, const MatrixBase&lt; Real &gt; &amp;N)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l01065">kaldi-matrix.h:1065</a></div></div>
<div class="ttc" id="arpa-file-parser-test_8cc_html_a951345011b75d2e8d9bfc18ca63510d2"><div class="ttname"><a href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a></div><div class="ttdeci">const size_t count</div><div class="ttdef"><b>Definition:</b> <a href="arpa-file-parser-test_8cc_source.html#l00066">arpa-file-parser-test.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1cu_html_a34679f52e8b49430a41f0b4614cee304"><div class="ttname"><a href="namespacekaldi_1_1cu.html#a34679f52e8b49430a41f0b4614cee304">kaldi::cu::ScalarTanh</a></div><div class="ttdeci">static Real ScalarTanh(Real a)</div><div class="ttdef"><b>Definition:</b> <a href="cu-math_8cc_source.html#l00434">cu-math.cc:434</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1cu_html_a8ed3f905e86f54ae19fc23b5bf543e16"><div class="ttname"><a href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">kaldi::cu::ScalarSigmoid</a></div><div class="ttdeci">static Real ScalarSigmoid(Real a)</div><div class="ttdef"><b>Definition:</b> <a href="cu-math_8cc_source.html#l00424">cu-math.cc:424</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab660ff528fa9fa9b3bb49284ebfa0d59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab660ff528fa9fa9b3bb49284ebfa0d59">&#9670;&nbsp;</a></span>CpuBackpropLstmNonlinearity() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::CpuBackpropLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_sum_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>self_repair_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>count_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>value_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>deriv_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>self_repair_sum_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1aa7a68b9e7a8e2dbe0cf91fa2c30f85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1aa7a68b9e7a8e2dbe0cf91fa2c30f85">&#9670;&nbsp;</a></span>CpuBackpropLstmNonlinearity() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::CpuBackpropLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>output_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>deriv_sum_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>self_repair_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>count_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>input_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>params_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>value_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>deriv_sum_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>self_repair_sum_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae8e7126fa88ceffe492625fcf535662a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8e7126fa88ceffe492625fcf535662a">&#9670;&nbsp;</a></span>CpuComputeLstmNonlinearity() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CpuComputeLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>params_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00445">445</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-matrix_8h_source.html#l00076">MatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00084">MatrixBase&lt; Real &gt;::RowData()</a>, <a class="el" href="cu-math_8cc_source.html#l00424">ScalarSigmoid()</a>, <a class="el" href="cu-math_8cc_source.html#l00434">ScalarTanh()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00067">MatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="cu-math_8cc_source.html#l00489">ComputeLstmNonlinearity()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00166">kaldi::UnitTestCuMathComputeLstmNonlinearity()</a>.</p>
<div class="fragment"><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                                                          {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  int32 num_rows = input_mat.NumRows(),</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      input_cols = input_mat.NumCols(),</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        cell_dim = input_cols / 5;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(input_cols == (cell_dim * 5) || input_cols == (cell_dim * 5) + 3);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;NumRows() == num_rows);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params_mat.NumRows() == 3);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(params_mat.NumCols() == cell_dim);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;NumCols() == 2 * cell_dim);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  MatrixBase&lt;Real&gt; &amp;output_mat = *output;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keyword">const</span> Real *params_data = params_mat.Data();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  int32 params_stride = params_mat.Stride();</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keyword">const</span> Real *input_row = input_mat.RowData(r);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">// i_scale and f_scale relate to dropout, they will normally be 1.0.</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    Real i_scale = (input_cols == cell_dim*5 ? 1.0:input_row[cell_dim*5]),</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;         f_scale = (input_cols == cell_dim*5 ? 1.0:input_row[cell_dim*5 + 1]),</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;         o_scale = (input_cols == cell_dim*5 ? 1.0:input_row[cell_dim*5 + 2]);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    Real *output_row = output_mat.RowData(r);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">for</span> (int32 c = 0; c &lt; cell_dim; c++) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      Real i_part = input_row[c];</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      Real f_part = input_row[c + cell_dim];</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      Real c_part = input_row[c + 2 * cell_dim];</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      Real o_part = input_row[c + 3 * cell_dim];</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      Real c_prev = input_row[c + 4 * cell_dim];</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      Real w_ic = params_data[c];</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      Real w_fc = params_data[c + params_stride];</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      Real w_oc = params_data[c + params_stride * 2];</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      Real i_t = <a class="code" href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">ScalarSigmoid</a>(i_part + w_ic * c_prev);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      Real f_t = <a class="code" href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">ScalarSigmoid</a>(f_part + w_fc * c_prev);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      Real c_t = f_t * f_scale * c_prev + i_t * i_scale * <a class="code" href="namespacekaldi_1_1cu.html#a34679f52e8b49430a41f0b4614cee304">ScalarTanh</a>(c_part);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      Real o_t = <a class="code" href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">ScalarSigmoid</a>(o_part + w_oc * c_t);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      Real m_t = o_t * o_scale * <a class="code" href="namespacekaldi_1_1cu.html#a34679f52e8b49430a41f0b4614cee304">ScalarTanh</a>(c_t);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      output_row[c] = c_t;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      output_row[c + cell_dim] = m_t;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1cu_html_a34679f52e8b49430a41f0b4614cee304"><div class="ttname"><a href="namespacekaldi_1_1cu.html#a34679f52e8b49430a41f0b4614cee304">kaldi::cu::ScalarTanh</a></div><div class="ttdeci">static Real ScalarTanh(Real a)</div><div class="ttdef"><b>Definition:</b> <a href="cu-math_8cc_source.html#l00434">cu-math.cc:434</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1cu_html_a8ed3f905e86f54ae19fc23b5bf543e16"><div class="ttname"><a href="namespacekaldi_1_1cu.html#a8ed3f905e86f54ae19fc23b5bf543e16">kaldi::cu::ScalarSigmoid</a></div><div class="ttdeci">static Real ScalarSigmoid(Real a)</div><div class="ttdef"><b>Definition:</b> <a href="cu-math_8cc_source.html#l00424">cu-math.cc:424</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a54cb875280023ba744317139209dc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a54cb875280023ba744317139209dc0">&#9670;&nbsp;</a></span>CpuComputeLstmNonlinearity() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::CpuComputeLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ace30af7f820b84b2781518ee8e00822a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace30af7f820b84b2781518ee8e00822a">&#9670;&nbsp;</a></span>CpuComputeLstmNonlinearity() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::CpuComputeLstmNonlinearity </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>params_mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8113283cedb535b7fe53ba2dedacef2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8113283cedb535b7fe53ba2dedacef2e">&#9670;&nbsp;</a></span>DiffNormalizePerRow() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DiffNormalizePerRow </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>target_rms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>add_log_stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>in_deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00349">349</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8cc_source.html#l00567">CuVectorBase&lt; Real &gt;::AddDiagMat2()</a>, <a class="el" href="cu-vector_8cc_source.html#l00583">CuVectorBase&lt; Real &gt;::AddDiagMatMat()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01369">CuMatrixBase&lt; Real &gt;::AddDiagVecMat()</a>, <a class="el" href="cu-vector_8cc_source.html#l00347">CuVectorBase&lt; Real &gt;::ApplyFloor()</a>, <a class="el" href="cu-matrixdim_8h_source.html#l00063">CU1DBLOCK</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00220">CuMatrixBase&lt; Real &gt;::Dim()</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="cu-matrix_8cc_source.html#l00779">CuMatrixBase&lt; Real &gt;::MulRowsVec()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8cc_source.html#l00599">NormalizeComponent::Backprop()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00549">kaldi::UnitTestCuDiffNormalizePerRow()</a>.</p>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                                       {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keyword">const</span> Real kSquaredNormFloor = 1.3552527156068805425e-20; <span class="comment">// 2^-66</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordtype">size_t</span> dimBlock = <a class="code" href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordtype">size_t</span> dimGrid = in_deriv-&gt;NumRows();</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    cuda_diff_normalize_per_row(dimGrid, dimBlock, in_deriv-&gt;Data(),</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                in_deriv-&gt;Stride(), in_value.Data(),</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                in_value.Dim(), out_deriv.Data(),</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                out_deriv.Stride(), target_rms, add_log_stddev);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">const</span> CuSubMatrix&lt;Real&gt; out_deriv_no_log(out_deriv, 0, out_deriv.NumRows(),</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                             0, in_value.NumCols());</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    CuVector&lt;Real&gt; dot_products(out_deriv.NumRows());</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    dot_products.AddDiagMatMat(1.0, out_deriv_no_log, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, in_value,</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                               <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    CuVector&lt;Real&gt; in_norm(in_value.NumRows());</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    Real d_scaled = (in_value.NumCols() * target_rms * target_rms);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    in_norm.AddDiagMat2(1.0, in_value, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">if</span> (add_log_stddev) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      CuVector&lt;Real&gt; log_stddev_deriv(in_norm), <span class="comment">// log_stddev deriv as dF/dy .* (x^T x)^-1</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      out_deriv_for_stddev(out_deriv.NumRows(), <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="comment">// f = log(sqrt(max(epsi, x^T x / D)))</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="comment">// df/dx = epsi^2 * D &lt; x^T x ? (1/(x^T x)) * x  : 0.</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="comment">// we don&#39;t compute this exactly below for the case when x^2 x is very</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="comment">// small, but we do make sure that the deriv isn&#39;t infinity when the input</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="comment">// is zero.</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      log_stddev_deriv.ApplyFloor(in_value.NumCols() * kSquaredNormFloor);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      log_stddev_deriv.ApplyPow(-1.0);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      out_deriv_for_stddev.CopyColFromMat(out_deriv, (out_deriv.NumCols() - 1));</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      log_stddev_deriv.MulElements(out_deriv_for_stddev);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordflow">if</span> (in_deriv)</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        in_deriv-&gt;AddDiagVecMat(1.0, log_stddev_deriv, in_value, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    in_norm.Scale(1.0 / d_scaled);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    in_norm.ApplyFloor(kSquaredNormFloor);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    in_norm.ApplyPow(-0.5);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> (in_deriv) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordflow">if</span> (in_deriv-&gt;Data() != out_deriv_no_log.Data())</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        in_deriv-&gt;AddDiagVecMat(1.0, in_norm, out_deriv_no_log, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        in_deriv-&gt;MulRowsVec(in_norm);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      in_norm.ReplaceValue(1.0 / sqrt(kSquaredNormFloor), 0.0);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      in_norm.ApplyPow(3.0);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      dot_products.MulElements(in_norm);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      in_deriv-&gt;AddDiagVecMat(-1.0 / d_scaled, dot_products, in_value, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                              1.0);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="cu-matrixdim_8h_html_a6dbdf9d0385c92d6d915b96eaf9ce99e"><div class="ttname"><a href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a></div><div class="ttdeci">#define CU1DBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00063">cu-matrixdim.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3b4b706c3ec872912d5a474c4dd74482"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b4b706c3ec872912d5a474c4dd74482">&#9670;&nbsp;</a></span>DiffNormalizePerRow() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::DiffNormalizePerRow </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfloat.html">float</a>&#160;</td>
          <td class="paramname"><em>target_rms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>add_log_stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>in_deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a783b5c309d8e059f92d1da03d873a0f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a783b5c309d8e059f92d1da03d873a0f6">&#9670;&nbsp;</a></span>DiffNormalizePerRow() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::DiffNormalizePerRow </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_deriv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>target_rms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>add_log_stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>in_deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa998160ba6b5d5d28ba82fa159924648"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa998160ba6b5d5d28ba82fa159924648">&#9670;&nbsp;</a></span>EnsureNonzero() <span class="overload">[1/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnsureNonzero </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>epsilon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function requires that src and dest have the same dimension and epsilon &gt; 0. </p>
<p>It copies src to dest while ensuring that the values are bounded away from zero by at least epsilon: </p><div class="fragment"><div class="line">y =  x <span class="keywordflow">if</span> fabs(x) &gt;= epsilon;</div><div class="line">     epsilon <span class="keywordflow">if</span> 0 &lt;= x &lt; epsilon;</div><div class="line">     -epsilon <span class="keywordflow">if</span> -epsilon &lt; x &lt; 0.</div></div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00209">209</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-math_8cc_source.html#l00173">Copy()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00220">CuMatrixBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-math_8cc_source.html#l00080">Randomize()</a>, <a class="el" href="cu-math_8cc_source.html#l00037">RegularizeL1()</a>, <a class="el" href="cu-matrix_8h_source.html#l00683">CuMatrixBase&lt; Real &gt;::RowData()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l01065">kaldi::SameDim()</a>, <a class="el" href="cu-math_8cc_source.html#l00132">Splice()</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-simple-component_8cc_source.html#l02521">ScaleAndOffsetComponent::BackpropInternal()</a>, <a class="el" href="cu-math_8cc_source.html#l00915">EnsureNonzero()</a>, <a class="el" href="nnet-simple-component_8cc_source.html#l02461">ScaleAndOffsetComponent::PropagateInternal()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00073">kaldi::UnitTestEnsureNonzero()</a>.</p>
<div class="fragment"><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                             {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(*dest, src) &amp;&amp; epsilon &gt; 0.0);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    dim3 dimGrid, dimBlock;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    GetBlockSizesForSimpleMatrixOperation(src.NumRows(), src.NumCols(),</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                          &amp;dimGrid, &amp;dimBlock);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    cuda_ensure_nonzero(dimGrid, dimBlock, src.Data(), src.Dim(),</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                        epsilon, dest-&gt;Stride(), dest-&gt;Data());</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    int32 num_rows = src.NumRows(), num_cols = src.NumCols();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keyword">const</span> Real *src_data = src.RowData(r);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      Real *dest_data = dest-&gt;RowData(r);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">for</span> (int32 c = 0; c &lt; num_cols; c++) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        Real x = src_data[c], y;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">if</span> (x &lt;= -epsilon || x &gt;= epsilon) y = x;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &gt;= 0.0) y = epsilon;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">else</span> y = -epsilon;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        dest_data[c] = y;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;}</div><div class="ttc" id="group__matrix__funcs__io_html_ga07b147212efb08775c252cd4cc7453fe"><div class="ttname"><a href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">kaldi::SameDim</a></div><div class="ttdeci">bool SameDim(const MatrixBase&lt; Real &gt; &amp;M, const MatrixBase&lt; Real &gt; &amp;N)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l01065">kaldi-matrix.h:1065</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af71f2971e84cd2625cf87e544b3edb91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af71f2971e84cd2625cf87e544b3edb91">&#9670;&nbsp;</a></span>EnsureNonzero() <span class="overload">[2/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnsureNonzero </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>epsilon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classkaldi_1_1Vector.html" title="A class representing a vector. ">Vector</a> version of EnsureNonzero, see matrix version for documentation. </p>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00915">915</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-math_8cc_source.html#l00768">BackpropLstmNonlinearity()</a>, <a class="el" href="cu-math_8cc_source.html#l00543">CpuBackpropLstmNonlinearity()</a>, <a class="el" href="cu-vector_8h_source.html#l00071">CuVectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-vector_8h_source.html#l00068">CuVectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="cu-math_8cc_source.html#l00209">EnsureNonzero()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                             {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src.Dim() == dest-&gt;Dim());</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  int32 dim = src.Dim();</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="comment">// fake it with a 1-row matrix.</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  CuSubMatrix&lt;Real&gt; src_mat(src.Data(), 1,  dim, dim),</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      dest_mat(dest-&gt;Data(), 1, dim, dim);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <a class="code" href="namespacekaldi_1_1cu.html#aa4b4f4f4c42b7dc3dd3e6460f6175b3a">EnsureNonzero</a>(src_mat, epsilon, &amp;dest_mat);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1cu_html_aa4b4f4f4c42b7dc3dd3e6460f6175b3a"><div class="ttname"><a href="namespacekaldi_1_1cu.html#aa4b4f4f4c42b7dc3dd3e6460f6175b3a">kaldi::cu::EnsureNonzero</a></div><div class="ttdeci">template void EnsureNonzero(const CuVectorBase&lt; double &gt; &amp;src, double epsilon, CuVectorBase&lt; double &gt; *dest)</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5ada34c41e30e57339d69e58effb62bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ada34c41e30e57339d69e58effb62bf">&#9670;&nbsp;</a></span>EnsureNonzero() <span class="overload">[3/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::EnsureNonzero </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfloat.html">float</a>&#160;</td>
          <td class="paramname"><em>epsilon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a71e87a9e17dffbc17b367edb43c3d12e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71e87a9e17dffbc17b367edb43c3d12e">&#9670;&nbsp;</a></span>EnsureNonzero() <span class="overload">[4/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::EnsureNonzero </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>epsilon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae6a561ada4f2860a6eed9066064719a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6a561ada4f2860a6eed9066064719a4">&#9670;&nbsp;</a></span>EnsureNonzero() <span class="overload">[5/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::EnsureNonzero </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfloat.html">float</a>&#160;</td>
          <td class="paramname"><em>epsilon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa4b4f4f4c42b7dc3dd3e6460f6175b3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4b4f4f4c42b7dc3dd3e6460f6175b3a">&#9670;&nbsp;</a></span>EnsureNonzero() <span class="overload">[6/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::EnsureNonzero </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>epsilon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a177cba8d311fbafbe0c1e8da8374eaec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a177cba8d311fbafbe0c1e8da8374eaec">&#9670;&nbsp;</a></span>NormalizePerRow() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NormalizePerRow </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>target_rms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>add_log_stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Normalize nonlinearity modifies the vector of activations by scaling it so that the root-mean-square equals 1.0. </p>
<p>The output y_i = scale * x_i, and we want to RMS value of the y_i to equal target_rms, so y^t y = D * target_rms^2 (if y is one row of the input). we need to have scale = 1.0 / sqrt(x^t x / (D * target_rms^2)). there is also flooring involved, to avoid division-by-zero problems. It's important for the backprop, that the floor's square root is exactly representable as float. If add_log_stddev_ is true, log(max(epsi, sqrt(x^t x / D))) is an extra dimension of the output. </p>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00280">280</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l02388">CuMatrixBase&lt; Real &gt;::CopyColFromVec()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="cu-matrixdim_8h_source.html#l00063">CU1DBLOCK</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00220">CuMatrixBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l01065">kaldi::SameDim()</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8cc_source.html#l00570">NormalizeComponent::Propagate()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00479">kaldi::UnitTestCuMathNormalizePerRow()</a>.</p>
<div class="fragment"><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                                                         {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keyword">const</span> Real kSquaredNormFloor = 1.3552527156068805425e-20; <span class="comment">// 2^-66</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">if</span> (add_log_stddev) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(in.NumRows() == out-&gt;NumRows());</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(in.NumCols() + 1 == out-&gt;NumCols());</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(in, *out));</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordtype">size_t</span> dimBlock = <a class="code" href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordtype">size_t</span> dimGrid = out-&gt;NumRows();</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    cuda_normalize_per_row(dimGrid, dimBlock, out-&gt;Data(), out-&gt;Stride(),</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                           in.Data(), in.Dim(), target_rms, add_log_stddev);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    CuSubMatrix&lt;Real&gt; out_no_log(*out, 0, out-&gt;NumRows(), 0, in.NumCols());</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (in.Data() != out_no_log.Data())</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      out_no_log.CopyFromMat(in);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    CuVector&lt;Real&gt; in_norm(in.NumRows());</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    Real d_scaled = in.NumCols() * target_rms * target_rms;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    in_norm.AddDiagMat2(1.0 / d_scaled, in, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    in_norm.ApplyFloor(kSquaredNormFloor);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    in_norm.ApplyPow(-0.5);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    out_no_log.MulRowsVec(in_norm);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">if</span> (add_log_stddev) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      in_norm.ApplyLog();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      in_norm.Scale(-1.0);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      in_norm.Add(log(target_rms));</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      out-&gt;CopyColFromVec(in_norm, in.NumCols());</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div><div class="ttc" id="group__matrix__funcs__io_html_ga07b147212efb08775c252cd4cc7453fe"><div class="ttname"><a href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">kaldi::SameDim</a></div><div class="ttdeci">bool SameDim(const MatrixBase&lt; Real &gt; &amp;M, const MatrixBase&lt; Real &gt; &amp;N)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l01065">kaldi-matrix.h:1065</a></div></div>
<div class="ttc" id="cu-matrixdim_8h_html_a6dbdf9d0385c92d6d915b96eaf9ce99e"><div class="ttname"><a href="cu-matrixdim_8h.html#a6dbdf9d0385c92d6d915b96eaf9ce99e">CU1DBLOCK</a></div><div class="ttdeci">#define CU1DBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00063">cu-matrixdim.h:63</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a122827a22a3b13b78f8b0358f6c64c07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a122827a22a3b13b78f8b0358f6c64c07">&#9670;&nbsp;</a></span>NormalizePerRow() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::NormalizePerRow </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfloat.html">float</a>&#160;</td>
          <td class="paramname"><em>target_rms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>add_log_stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af338f27f59b00682d538195a3cfd896a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af338f27f59b00682d538195a3cfd896a">&#9670;&nbsp;</a></span>NormalizePerRow() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::NormalizePerRow </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>target_rms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>add_log_stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aadabf21b0ceab29b444130080721d686"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadabf21b0ceab29b444130080721d686">&#9670;&nbsp;</a></span>Randomize() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Randomize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>copy_from_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies a permutation of src into tgt. </p>
<p>The row permutation is specified in copy_from_idx such that src.Row(copy_from_idx[r]) == tgt.Row(r). The dimensions of copy_from_idx must be equivalent to the number of rows in tgt and src and all elements in the vector must be in [0, src.numRows()-1]. </p>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00080">80</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-array_8h_source.html#l00052">CuArrayBase&lt; T &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-array_8h_source.html#l00049">CuArrayBase&lt; T &gt;::Dim()</a>, <a class="el" href="cu-matrix_8h_source.html#l00220">CuMatrixBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="cu-matrix_8h_source.html#l00698">CuMatrixBase&lt; Real &gt;::Mat()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, and <a class="el" href="cu-matrixdim_8h_source.html#l00053">MatrixDim_::rows</a>.</p>

<p class="reference">Referenced by <a class="el" href="cu-math_8cc_source.html#l00209">EnsureNonzero()</a>, <a class="el" href="nnet-randomizer_8h_source.html#l00115">MatrixRandomizer::NumFrames()</a>, <a class="el" href="nnet-randomizer_8h_source.html#l00176">VectorRandomizer::NumFrames()</a>, <a class="el" href="nnet-randomizer_8h_source.html#l00237">StdVectorRandomizer&lt; T &gt;::NumFrames()</a>, <a class="el" href="nnet-randomizer_8cc_source.html#l00079">MatrixRandomizer::Randomize()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00046">kaldi::UnitTestCuMathRandomize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                        {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src.NumCols() == tgt-&gt;NumCols());</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src.NumRows() == tgt-&gt;NumRows());</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(copy_from_idx.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() &lt;= tgt-&gt;NumRows());</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">  #if HAVE_CUDA == 1</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">    Note: default 16x16 block-size limits the --cachesize to matrix size 16*65535 x 16*65535</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">    dim3 dimBlock(CU2DBLOCK, CU2DBLOCK);</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">    dim3 dimGrid(n_blocks(tgt-&gt;NumCols(), CU2DBLOCK), n_blocks(copy_from_idx.Dim(), CU2DBLOCK));</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">     * Let&#39;s use blocksize 4 x 128 (512 threads/block)</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">     * and extend the randomizable matrices to: col 4*65535, row 128*65535</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">     * (ie. max-cols:262140 (dim), max-rows:8388480 (datapoints))</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    dim3 dimBlock(4, 128);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    dim3 dimGrid(n_blocks(tgt-&gt;NumCols(), 4), n_blocks(copy_from_idx.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(), 128));</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="structMatrixDim__.html">MatrixDim</a> dimsrc = src.Dim(); dimsrc.<a class="code" href="structMatrixDim__.html#a9b2df668dbab2cda2e88da723d3065cf">rows</a>=copy_from_idx.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="structMatrixDim__.html">MatrixDim</a> dimtgt = tgt-&gt;Dim(); dimtgt.<a class="code" href="structMatrixDim__.html#a9b2df668dbab2cda2e88da723d3065cf">rows</a>=copy_from_idx.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    cuda_randomize(dimGrid, dimBlock, tgt-&gt;Data(), src.Data(),</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                   copy_from_idx.<a class="code" href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">Data</a>(), dimtgt, dimsrc);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// randomize in CPU</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">const</span> MatrixBase&lt;Real&gt; &amp;srcmat = src.Mat();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keyword">const</span> int32 *copy_from_idxvec = copy_from_idx.<a class="code" href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">Data</a>();</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    MatrixBase&lt;Real&gt; &amp;tgtmat = tgt-&gt;Mat();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">for</span>(int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;copy_from_idx.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      tgtmat.Row(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>).CopyFromVec(srcmat.Row(copy_from_idxvec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div><div class="ttc" id="structMatrixDim___html_a9b2df668dbab2cda2e88da723d3065cf"><div class="ttname"><a href="structMatrixDim__.html#a9b2df668dbab2cda2e88da723d3065cf">MatrixDim_::rows</a></div><div class="ttdeci">int32_cuda rows</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00053">cu-matrixdim.h:53</a></div></div>
<div class="ttc" id="structMatrixDim___html"><div class="ttname"><a href="structMatrixDim__.html">MatrixDim_</a></div><div class="ttdoc">Structure containing size of the matrix plus stride. </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00052">cu-matrixdim.h:52</a></div></div>
<div class="ttc" id="classkaldi_1_1CuArrayBase_html_a368b2398825ede0c99248a432c6fdc7b"><div class="ttname"><a href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">kaldi::CuArrayBase::Data</a></div><div class="ttdeci">const T * Data() const</div><div class="ttdoc">Get raw pointer. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array_8h_source.html#l00052">cu-array.h:52</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1CuArrayBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::CuArrayBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Return the vector dimension. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array_8h_source.html#l00049">cu-array.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae6f2832396582dba363263c618c97a85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6f2832396582dba363263c618c97a85">&#9670;&nbsp;</a></span>Randomize() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::Randomize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>copy_from_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4317ab1d0ad4ac8815bf38b68d984e08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4317ab1d0ad4ac8815bf38b68d984e08">&#9670;&nbsp;</a></span>Randomize() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::Randomize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>copy_from_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4892d89808a79d92c975653f60bac528"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4892d89808a79d92c975653f60bac528">&#9670;&nbsp;</a></span>RegularizeL1() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RegularizeL1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>gradient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>l1_penalty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>learning_rate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RegularizeL1 is a gradient step with l1 regularization added to the gradient. </p>
<p>We don't let the value cross over zero from positive to negative or vice versa, in a single step. If an element tries to cross zero and is stopped, we zero the gradient. (Dan: not sure why). </p>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00037">37</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrixdim_8h_source.html#l00067">CU2DBLOCK</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00220">CuMatrixBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="cu-matrix_8h_source.html#l00698">CuMatrixBase&lt; Real &gt;::Mat()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l01065">kaldi::SameDim()</a>, and <a class="el" href="cu-matrix_8h_source.html#l00216">CuMatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="cu-math_8cc_source.html#l00209">EnsureNonzero()</a>, <a class="el" href="nnet-linear-transform_8h_source.html#l00170">LinearTransform::Update()</a>, and <a class="el" href="nnet-affine-transform_8h_source.html#l00179">AffineTransform::Update()</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                                                                                          {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(*weight, *grad));</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    dim3 dimBlock(<a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>, <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    dim3 dimGrid(n_blocks(weight-&gt;NumCols(), <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>), n_blocks(weight-&gt;NumRows(), <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>));</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    cuda_regularize_l1(dimGrid, dimBlock, weight-&gt;Data(), grad-&gt;Data(), l1, lr,</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                       weight-&gt;Dim(), grad-&gt;Stride());</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    MatrixBase&lt;Real&gt; &amp;weight2 = weight-&gt;Mat();</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    MatrixBase&lt;Real&gt; &amp;grad2 = grad-&gt;Mat();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> r=0; r&lt;weight2.NumRows(); r++) {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> c=0; c&lt;weight2.NumCols(); c++) {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">if</span>(weight2(r,c)==0.0) <span class="keywordflow">continue</span>; <span class="comment">// skip L1 if zero weightght!</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        Real l1_signed = l1;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">if</span> (weight2(r, c) &lt; 0.0)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;          l1_signed = -l1;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        Real before = weight2(r, c);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        Real after = weight2(r, c) - lr*grad2(r, c) - l1_signed;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">if</span> ((after &gt; 0.0) ^ (before &gt; 0.0)) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;          weight2(r, c) = 0.0;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;          grad2(r, c) = 0.0;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;          weight2(r, c) -= l1_signed;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div><div class="ttc" id="group__matrix__funcs__io_html_ga07b147212efb08775c252cd4cc7453fe"><div class="ttname"><a href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">kaldi::SameDim</a></div><div class="ttdeci">bool SameDim(const MatrixBase&lt; Real &gt; &amp;M, const MatrixBase&lt; Real &gt; &amp;N)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l01065">kaldi-matrix.h:1065</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="cu-matrixdim_8h_html_a84acd86e193bca04fb719c476fbcbe5b"><div class="ttname"><a href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a></div><div class="ttdeci">#define CU2DBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00067">cu-matrixdim.h:67</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a62f3c85ff5d880e86c536593989b06ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62f3c85ff5d880e86c536593989b06ed">&#9670;&nbsp;</a></span>RegularizeL1() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::RegularizeL1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>grad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfloat.html">float</a>&#160;</td>
          <td class="paramname"><em>l1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfloat.html">float</a>&#160;</td>
          <td class="paramname"><em>lr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6c9eeda9ffdf0ea3f8ebf51ee1a48880"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c9eeda9ffdf0ea3f8ebf51ee1a48880">&#9670;&nbsp;</a></span>RegularizeL1() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::RegularizeL1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>grad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>l1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8ed3f905e86f54ae19fc23b5bf543e16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ed3f905e86f54ae19fc23b5bf543e16">&#9670;&nbsp;</a></span>ScalarSigmoid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Real kaldi::cu::ScalarSigmoid </td>
          <td>(</td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00424">424</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00083">kaldi::Exp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="cu-math_8cc_source.html#l00543">CpuBackpropLstmNonlinearity()</a>, and <a class="el" href="cu-math_8cc_source.html#l00445">CpuComputeLstmNonlinearity()</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                         {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">if</span> (a &gt; Real(0)) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> Real(1) / (Real(1) + <a class="code" href="namespacekaldi.html#acb7bb4ffd897a6d0ba3fa0cbd9093a9e">Exp</a>(-a));</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    Real x = <a class="code" href="namespacekaldi.html#acb7bb4ffd897a6d0ba3fa0cbd9093a9e">Exp</a>(a);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">return</span> x / (x + Real(1));</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_acb7bb4ffd897a6d0ba3fa0cbd9093a9e"><div class="ttname"><a href="namespacekaldi.html#acb7bb4ffd897a6d0ba3fa0cbd9093a9e">kaldi::Exp</a></div><div class="ttdeci">double Exp(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00083">kaldi-math.h:83</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a34679f52e8b49430a41f0b4614cee304"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34679f52e8b49430a41f0b4614cee304">&#9670;&nbsp;</a></span>ScalarTanh()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Real kaldi::cu::ScalarTanh </td>
          <td>(</td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00434">434</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00083">kaldi::Exp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="cu-math_8cc_source.html#l00543">CpuBackpropLstmNonlinearity()</a>, and <a class="el" href="cu-math_8cc_source.html#l00445">CpuComputeLstmNonlinearity()</a>.</p>
<div class="fragment"><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                                      {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span> (a &gt; Real(0)) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    Real inv_expa = <a class="code" href="namespacekaldi.html#acb7bb4ffd897a6d0ba3fa0cbd9093a9e">Exp</a>(-a);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">return</span> -Real(1) + Real(2) / (Real(1) + inv_expa * inv_expa);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    Real expa = <a class="code" href="namespacekaldi.html#acb7bb4ffd897a6d0ba3fa0cbd9093a9e">Exp</a>(a);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">return</span> Real(1) - Real(2) / (Real(1) + expa * expa);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_acb7bb4ffd897a6d0ba3fa0cbd9093a9e"><div class="ttname"><a href="namespacekaldi.html#acb7bb4ffd897a6d0ba3fa0cbd9093a9e">kaldi::Exp</a></div><div class="ttdeci">double Exp(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00083">kaldi-math.h:83</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0a695ade8cf4a02e68fd024f8bef9696"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a695ade8cf4a02e68fd024f8bef9696">&#9670;&nbsp;</a></span>Splice() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Splice </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>frame_offsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Splice concatenates frames of src as specified in frame_offsets into tgt. </p>
<p>The dimensions of tgt must be equivalent to the number of rows in src and it must be that tgt.NumColumns == src.NumColumns * frame_offsets.Dim(). As a result, tgt(i, k*n_cols + j) == src(i + frame_offsets[k], j) for the general case where i in [0..src.NumRows()-1], k in [0..frame_offsets.Dim()-1], j in [0..src.NumRows()-1] and n_cols = src.NumColumns(). If i + frame_offsets[k] is greater than the number of rows in src or less than 0 than the right side of the equation is replaced by src(src.NumRows()-1, j) or src(0, j) respectively, to avoid an index out of bounds. </p>

<p class="definition">Definition at line <a class="el" href="cu-math_8cc_source.html#l00132">132</a> of file <a class="el" href="cu-math_8cc_source.html">cu-math.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrixdim_8h_source.html#l00067">CU2DBLOCK</a>, <a class="el" href="cu-array_8h_source.html#l00052">CuArrayBase&lt; T &gt;::Data()</a>, <a class="el" href="cu-matrix_8h_source.html#l00689">CuMatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="cu-array_8h_source.html#l00049">CuArrayBase&lt; T &gt;::Dim()</a>, <a class="el" href="cu-matrix_8h_source.html#l00220">CuMatrixBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="cu-matrix_8h_source.html#l00698">CuMatrixBase&lt; Real &gt;::Mat()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00084">MatrixBase&lt; Real &gt;::RowData()</a>.</p>

<p class="reference">Referenced by <a class="el" href="cu-math_8cc_source.html#l00209">EnsureNonzero()</a>, <a class="el" href="nnet-component_8cc_source.html#l00117">Component::NewComponentOfType()</a>, <a class="el" href="nnet-various_8h_source.html#l00106">Splice::PropagateFnc()</a>, and <a class="el" href="cu-math-test_8cc_source.html#l00124">kaldi::UnitTestCuMathSplice()</a>.</p>
<div class="fragment"><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                                     {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src.NumCols()*frame_offsets.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() == tgt-&gt;NumCols());</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(src.NumRows() == tgt-&gt;NumRows());</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">  #if HAVE_CUDA == 1</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled()) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    CuTimer tim;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    dim3 dimBlock(<a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>, <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    dim3 dimGrid(n_blocks(tgt-&gt;NumCols(), <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>), n_blocks(tgt-&gt;NumRows(), <a class="code" href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a>));</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    cuda_splice(dimGrid, dimBlock, tgt-&gt;Data(), src.Data(),</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                frame_offsets.<a class="code" href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">Data</a>(), tgt-&gt;Dim(), src.Dim());</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    CU_SAFE_CALL(cudaGetLastError());</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    CuDevice::Instantiate().AccuProfile(__func__, tim);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// expand in CPU</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">const</span> MatrixBase&lt;Real&gt; &amp;srcmat = src.Mat();</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">const</span> int32 *frame_offsetvec = frame_offsets.<a class="code" href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">Data</a>();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    int32 dim = frame_offsets.<a class="code" href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>();</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    MatrixBase&lt;Real&gt; &amp;tgtmat = tgt-&gt;Mat();</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">for</span>(int32 r=0; r &lt; tgtmat.NumRows(); r++) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">for</span>(int32 off=0; off &lt; dim; off++) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        int32 r_off = r + frame_offsetvec[off];</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">if</span>(r_off &lt; 0) r_off = 0;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">if</span>(r_off &gt;= srcmat.NumRows()) r_off = srcmat.NumRows()-1;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        memcpy(tgtmat.RowData(r)+off*srcmat.NumCols(),srcmat.RowData(r_off),<span class="keyword">sizeof</span>(Real)*srcmat.NumCols());</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuArrayBase_html_a368b2398825ede0c99248a432c6fdc7b"><div class="ttname"><a href="classkaldi_1_1CuArrayBase.html#a368b2398825ede0c99248a432c6fdc7b">kaldi::CuArrayBase::Data</a></div><div class="ttdeci">const T * Data() const</div><div class="ttdoc">Get raw pointer. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array_8h_source.html#l00052">cu-array.h:52</a></div></div>
<div class="ttc" id="cu-matrixdim_8h_html_a84acd86e193bca04fb719c476fbcbe5b"><div class="ttname"><a href="cu-matrixdim_8h.html#a84acd86e193bca04fb719c476fbcbe5b">CU2DBLOCK</a></div><div class="ttdeci">#define CU2DBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00067">cu-matrixdim.h:67</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1CuArrayBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1CuArrayBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::CuArrayBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Return the vector dimension. </div><div class="ttdef"><b>Definition:</b> <a href="cu-array_8h_source.html#l00049">cu-array.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5294e49c288d7b13faaa7589bcc541a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5294e49c288d7b13faaa7589bcc541a5">&#9670;&nbsp;</a></span>Splice() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::Splice </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>frame_offsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="classfloat.html">float</a> &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a75e5756a55bcaf0a7f43b84c79a6d4f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75e5756a55bcaf0a7f43b84c79a6d4f6">&#9670;&nbsp;</a></span>Splice() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">template void kaldi::cu::Splice </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuArray.html">CuArray</a>&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>frame_offsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>tgt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1cu.html">cu</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
