<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: ComputationExpander Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1nnet3_1_1ComputationExpander.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classkaldi_1_1nnet3_1_1ComputationExpander-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ComputationExpander Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for ComputationExpander:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1nnet3_1_1ComputationExpander__coll__graph.png" border="0" usemap="#ComputationExpander_coll__map" alt="Collaboration graph"/></div>
<map name="ComputationExpander_coll__map" id="ComputationExpander_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a357897f866f5c4ab0b3536d31ddf4284"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a357897f866f5c4ab0b3536d31ddf4284">ComputationExpander</a> (const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> &amp;misc_info, const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;computation, <a class="el" href="classbool.html">bool</a> need_debug_info, int32 num_n_values, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *expanded_computation)</td></tr>
<tr class="separator:a357897f866f5c4ab0b3536d31ddf4284"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a740071247a178d84b8bf2b17901509b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a740071247a178d84b8bf2b17901509b4">Expand</a> ()</td></tr>
<tr class="separator:a740071247a178d84b8bf2b17901509b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a652f9fe87cd1b276eb349312151054f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a652f9fe87cd1b276eb349312151054f8">InitStrideInfo</a> ()</td></tr>
<tr class="separator:a652f9fe87cd1b276eb349312151054f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecd7fa564d816a5025ca66346f6b80fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aecd7fa564d816a5025ca66346f6b80fe">ComputeMatrixInfo</a> ()</td></tr>
<tr class="separator:aecd7fa564d816a5025ca66346f6b80fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a349da8d95ac1defe31a714e52954bbde"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a349da8d95ac1defe31a714e52954bbde">ComputeDebugInfo</a> ()</td></tr>
<tr class="separator:a349da8d95ac1defe31a714e52954bbde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0618c08b05537029106fab90e16dfe0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ac0618c08b05537029106fab90e16dfe0">ComputeSubmatrixInfo</a> ()</td></tr>
<tr class="separator:ac0618c08b05537029106fab90e16dfe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87cbe94f28fe1fbbbcde4e650b5fbfe2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a87cbe94f28fe1fbbbcde4e650b5fbfe2">ExpandRowsCommand</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;c_in, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *c_out)</td></tr>
<tr class="separator:a87cbe94f28fe1fbbbcde4e650b5fbfe2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b2ebb0f18100bdd03194aac19da1e09"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a6b2ebb0f18100bdd03194aac19da1e09">ExpandRowsMultiCommand</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;c_in, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *c_out)</td></tr>
<tr class="separator:a6b2ebb0f18100bdd03194aac19da1e09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bfd022e9b1b6b8bf5494afbcd8aff9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9bfd022e9b1b6b8bf5494afbcd8aff9d">ExpandRowRangesCommand</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;c_in, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *c_out)</td></tr>
<tr class="separator:a9bfd022e9b1b6b8bf5494afbcd8aff9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad666818585d567208e5833cd3ed6ea4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aad666818585d567208e5833cd3ed6ea4">ComputePrecomputedIndexes</a> ()</td></tr>
<tr class="separator:aad666818585d567208e5833cd3ed6ea4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47b759979e43092bbb39fc8897f6b143"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a47b759979e43092bbb39fc8897f6b143">ComputeCommands</a> ()</td></tr>
<tr class="separator:a47b759979e43092bbb39fc8897f6b143"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2eb79493ded57c85f60b26089cbc7ae3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a2eb79493ded57c85f60b26089cbc7ae3">EnsureDebugInfoExists</a> (int32 submatrix_index)</td></tr>
<tr class="separator:a2eb79493ded57c85f60b26089cbc7ae3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae75e6d0c1a5e33b7b6a02175357f0fcd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a> (int32 submat_index, int32 old_row_index, int32 *new_row_index, int32 *n_stride) const</td></tr>
<tr class="separator:ae75e6d0c1a5e33b7b6a02175357f0fcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa7be32bf8cc53a5cfb20eb89280dd06"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">GetNewMatrixLocationInfo</a> (int32 old_matrix_index, int32 old_row_index) const</td></tr>
<tr class="memdesc:aaa7be32bf8cc53a5cfb20eb89280dd06"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used in mapping row-indexes into matrices, from the old to the new computation.  <a href="#aaa7be32bf8cc53a5cfb20eb89280dd06">More...</a><br /></td></tr>
<tr class="separator:aaa7be32bf8cc53a5cfb20eb89280dd06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d39b8710ac9abb65b0812bc1a82f52e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0d39b8710ac9abb65b0812bc1a82f52e">ExpandIndexes</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;indexes, std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *indexes_expanded) const</td></tr>
<tr class="separator:a0d39b8710ac9abb65b0812bc1a82f52e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:af983142dc68170e669067284f55e06b8"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int32 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">n_stride_</a></td></tr>
<tr class="separator:af983142dc68170e669067284f55e06b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbabf05a7702103113a02a113015205f"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">nnet_</a></td></tr>
<tr class="separator:adbabf05a7702103113a02a113015205f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96c233d2a3038b6ce3f46adc9eeac6c8"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a96c233d2a3038b6ce3f46adc9eeac6c8">misc_info_</a></td></tr>
<tr class="separator:a96c233d2a3038b6ce3f46adc9eeac6c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81b35995b5ef2650f6367cb1299ef0fd"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a></td></tr>
<tr class="separator:a81b35995b5ef2650f6367cb1299ef0fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ad00746c585650630f59ba3b3c3dad1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0ad00746c585650630f59ba3b3c3dad1">need_debug_info_</a></td></tr>
<tr class="separator:a0ad00746c585650630f59ba3b3c3dad1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a0388f6e3ce9318db544eef95415305"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a></td></tr>
<tr class="separator:a9a0388f6e3ce9318db544eef95415305"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa02f703a75537d153178d8ad1e104ad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a></td></tr>
<tr class="separator:afa02f703a75537d153178d8ad1e104ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03138">3138</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a357897f866f5c4ab0b3536d31ddf4284"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a357897f866f5c4ab0b3536d31ddf4284">&#9670;&nbsp;</a></span>ComputationExpander()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html">ComputationExpander</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>misc_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> &amp;&#160;</td>
          <td class="paramname"><em>computation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>need_debug_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_n_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>expanded_computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03140">3140</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                                                            :</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">nnet_</a>(nnet), <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a96c233d2a3038b6ce3f46adc9eeac6c8">misc_info_</a>(misc_info),</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>(computation),</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0ad00746c585650630f59ba3b3c3dad1">need_debug_info_</a>(need_debug_info),</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>(num_n_values),</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>(expanded_computation) {</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_n_values &gt; 2);</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  }</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a0ad00746c585650630f59ba3b3c3dad1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0ad00746c585650630f59ba3b3c3dad1">kaldi::nnet3::ComputationExpander::need_debug_info_</a></div><div class="ttdeci">bool need_debug_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03291">nnet-optimize-utils.cc:3291</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::ComputationExpander::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03288">nnet-optimize-utils.cc:3288</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a96c233d2a3038b6ce3f46adc9eeac6c8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a96c233d2a3038b6ce3f46adc9eeac6c8">kaldi::nnet3::ComputationExpander::misc_info_</a></div><div class="ttdeci">const MiscComputationInfo &amp; misc_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03289">nnet-optimize-utils.cc:3289</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a47b759979e43092bbb39fc8897f6b143"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47b759979e43092bbb39fc8897f6b143">&#9670;&nbsp;</a></span>ComputeCommands()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeCommands </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03501">3501</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kaldi::nnet3::kAcceptInput</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kaldi::nnet3::kAddRowRanges</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kAddRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kaldi::nnet3::kAddRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kaldi::nnet3::kAddToRowsMulti</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kAllocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kBackprop</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kBackpropNoModelUpdate</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kaldi::nnet3::kCompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kCopyRows</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kaldi::nnet3::kCopyRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00292">kaldi::nnet3::kCopyToRowsMulti</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kDeallocMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00293">kaldi::nnet3::kDecompressMatrix</a>, <a class="el" href="nnet-computation_8h_source.html#l00296">kaldi::nnet3::kGotoLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kMatrixAdd</a>, <a class="el" href="nnet-computation_8h_source.html#l00291">kaldi::nnet3::kMatrixCopy</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperation</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationLabel</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationMarker</a>, <a class="el" href="nnet-computation_8h_source.html#l00295">kaldi::nnet3::kNoOperationPermanent</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kPropagate</a>, <a class="el" href="nnet-computation_8h_source.html#l00294">kaldi::nnet3::kProvideOutput</a>, <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kSetConst</a>, and <a class="el" href="nnet-computation_8h_source.html#l00289">kaldi::nnet3::kSwapMatrix</a>.</p>
<div class="fragment"><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;                                          {</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;  int32 num_commands = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size();</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.resize(num_commands);</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  <span class="keywordflow">for</span> (int32 command_index = 0; command_index &lt; num_commands;</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;       command_index++) {</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    <span class="keyword">const</span> NnetComputation::Command &amp;c = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command_index];</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;    NnetComputation::Command &amp;c_out =</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command_index];</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    c_out = c;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <span class="comment">// Commands that only operate on submatrices, components and</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    <span class="comment">// precomputed-indexes do not have to be changed because we&#39;ll take care of</span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;    <span class="comment">// the expansion by suitably redefining the matrices and submatrices, and</span></div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    <span class="comment">// recreating the precomputed-indexes.</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;    <span class="comment">// However, commands that require, &#39;indexes&#39;, &#39;indexes_multi&#39; or</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    <span class="comment">// &#39;indexes_ranges&#39; do need to be modified.</span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;    <span class="keywordflow">switch</span> (c.command_type) {</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kAllocMatrix</a>:</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>:</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kSetConst</a>:</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kSwapMatrix</a>:</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a>:</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>:</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>:</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a87cbe94f28fe1fbbbcde4e650b5fbfe2">ExpandRowsCommand</a>(c, &amp;c_out);</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>:</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>:</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a6b2ebb0f18100bdd03194aac19da1e09">ExpandRowsMultiCommand</a>(c, &amp;c_out);</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kAddRowRanges</a>:</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9bfd022e9b1b6b8bf5494afbcd8aff9d">ExpandRowRangesCommand</a>(c, &amp;c_out);</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kCompressMatrix</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kDecompressMatrix</a>:</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kAcceptInput</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kProvideOutput</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>:</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kNoOperationPermanent</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kNoOperationMarker</a>:</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kNoOperationLabel</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kGotoLabel</a>:</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Un-handled command type&quot;</span>;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;    }</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;  }</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a6b2ebb0f18100bdd03194aac19da1e09"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a6b2ebb0f18100bdd03194aac19da1e09">kaldi::nnet3::ComputationExpander::ExpandRowsMultiCommand</a></div><div class="ttdeci">void ExpandRowsMultiCommand(const NnetComputation::Command &amp;c_in, NnetComputation::Command *c_out)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03361">nnet-optimize-utils.cc:3361</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af9786d4042a4fcf23b29a14a6fb64126">kaldi::nnet3::kNoOperationPermanent</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ecee91c55553bcf2d755d00328b0253">kaldi::nnet3::kSwapMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352aaa3fd92744438323baec475cee5b9b3d">kaldi::nnet3::kProvideOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9bfd022e9b1b6b8bf5494afbcd8aff9d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9bfd022e9b1b6b8bf5494afbcd8aff9d">kaldi::nnet3::ComputationExpander::ExpandRowRangesCommand</a></div><div class="ttdeci">void ExpandRowRangesCommand(const NnetComputation::Command &amp;c_in, NnetComputation::Command *c_out)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03426">nnet-optimize-utils.cc:3426</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352add9060e8c7434f250048082c634d9a6d">kaldi::nnet3::kGotoLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00296">nnet-computation.h:296</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a6b396f5162883c2f4fb837a2af4b8895">kaldi::nnet3::kAcceptInput</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00294">nnet-computation.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a19758aa995e3baa1aa2cef6528d10fb9">kaldi::nnet3::kCompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00439">nnet-computation.h:439</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a73b5995148c3e987c4a163ad6bc9850b">kaldi::nnet3::kAllocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a55f8cb2bfd2e2c3605dfa961eff35fa2">kaldi::nnet3::kSetConst</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00289">nnet-computation.h:289</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00291">nnet-computation.h:291</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352af67517e882c1aebe145a016945b9e6a4">kaldi::nnet3::kNoOperationMarker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kaldi::nnet3::kBackpropNoModelUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a967844c2c7775d280d15738cbe852536">kaldi::nnet3::kNoOperationLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00295">nnet-computation.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00292">nnet-computation.h:292</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a0260a200407f88708e5c2793506e4ada">kaldi::nnet3::kDecompressMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a87cbe94f28fe1fbbbcde4e650b5fbfe2"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a87cbe94f28fe1fbbbcde4e650b5fbfe2">kaldi::nnet3::ComputationExpander::ExpandRowsCommand</a></div><div class="ttdeci">void ExpandRowsCommand(const NnetComputation::Command &amp;c_in, NnetComputation::Command *c_out)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03298">nnet-optimize-utils.cc:3298</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a86646468234ab036580a4f2e4d72af3c">kaldi::nnet3::kAddRowRanges</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00293">nnet-computation.h:293</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a349da8d95ac1defe31a714e52954bbde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a349da8d95ac1defe31a714e52954bbde">&#9670;&nbsp;</a></span>ComputeDebugInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeDebugInfo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03603">3603</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00317">NnetComputation::MatrixDebugInfo::cindexes</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00316">NnetComputation::MatrixDebugInfo::is_deriv</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, and <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>.</p>
<div class="fragment"><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;                                           {</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;  int32 num_matrices = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>.size();</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>.size() == num_matrices);</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>.resize(num_matrices);</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;  <span class="comment">// Matrix zero is a special case; it&#39;s the empty matrix.</span></div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[0] =</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[0];</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;  int32 num_n_values = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>;</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;    <span class="keyword">const</span> NnetComputation::MatrixDebugInfo &amp;info_in =</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[m];</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;    NnetComputation::MatrixDebugInfo &amp;info_out =</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[m];</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;    info_out.is_deriv = info_in.is_deriv;</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;    int32 num_rows_in = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m].num_rows,</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;        num_rows_out = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m].num_rows;</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_rows_in == info_in.cindexes.size());</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;    info_out.cindexes.resize(num_rows_out);</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> *cindexes_in = &amp;(info_in.cindexes[0]);</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">Cindex</a> *cindexes_out = &amp;(info_out.cindexes[0]);</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;    <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows_in; r++) {</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;      <span class="keywordflow">if</span> (info_in.cindexes[r].second.n == 0) {</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;        int32 new_r = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">GetNewMatrixLocationInfo</a>(m, r),</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;            n_stride = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">n_stride_</a>[m];</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;        <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_n_values; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;          int32 r_out = new_r + <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> * n_stride;</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;          cindexes_out[r_out] = cindexes_in[r];</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;          cindexes_out[r_out].second.n = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;        }</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;      }</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;    }</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;  }</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ad608a50eef55fe012c53acb48f1de02b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">kaldi::nnet3::NnetComputation::matrix_debug_info</a></div><div class="ttdeci">std::vector&lt; MatrixDebugInfo &gt; matrix_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00394">nnet-computation.h:394</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a47a751a8db1c9c4856d04495f80620e9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">kaldi::nnet3::NnetComputation::matrices</a></div><div class="ttdeci">std::vector&lt; MatrixInfo &gt; matrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00390">nnet-computation.h:390</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_aaa7be32bf8cc53a5cfb20eb89280dd06"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">kaldi::nnet3::ComputationExpander::GetNewMatrixLocationInfo</a></div><div class="ttdeci">int32 GetNewMatrixLocationInfo(int32 old_matrix_index, int32 old_row_index) const</div><div class="ttdoc">This function is used in mapping row-indexes into matrices, from the old to the new computation...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03761">nnet-optimize-utils.cc:3761</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac8344e7587df9247d6cc492874901d4d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac8344e7587df9247d6cc492874901d4d">kaldi::nnet3::Cindex</a></div><div class="ttdeci">std::pair&lt; int32, Index &gt; Cindex</div><div class="ttdef"><b>Definition:</b> <a href="nnet-common_8h_source.html#l00115">nnet-common.h:115</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_af983142dc68170e669067284f55e06b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">kaldi::nnet3::ComputationExpander::n_stride_</a></div><div class="ttdeci">std::vector&lt; int32 &gt; n_stride_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03286">nnet-optimize-utils.cc:3286</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aecd7fa564d816a5025ca66346f6b80fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecd7fa564d816a5025ca66346f6b80fe">&#9670;&nbsp;</a></span>ComputeMatrixInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeMatrixInfo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03588">3588</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, and <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>.</p>
<div class="fragment"><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                                            {</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;  int32 num_matrices = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>.size();</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>.resize(num_matrices);</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;  <span class="comment">// Matrix zero is a special case; it&#39;s the empty matrix.</span></div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[0] = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[0];</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;  int32 old_num_n_values = 2,</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;      new_num_n_values = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m] = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m];</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m].num_rows =</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;        (<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m].num_rows / old_num_n_values) *</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;        new_num_n_values;</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;  }</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a47a751a8db1c9c4856d04495f80620e9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">kaldi::nnet3::NnetComputation::matrices</a></div><div class="ttdeci">std::vector&lt; MatrixInfo &gt; matrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00390">nnet-computation.h:390</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aad666818585d567208e5833cd3ed6ea4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad666818585d567208e5833cd3ed6ea4">&#9670;&nbsp;</a></span>ComputePrecomputedIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputePrecomputedIndexes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03676">3676</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00339">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00439">NnetComputation::commands</a>, <a class="el" href="nnet-computation_8h_source.html#l00412">NnetComputation::component_precomputed_indexes</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00379">NnetComputation::PrecomputedIndexesInfo::data</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00150">Nnet::GetComponent()</a>, <a class="el" href="nnet-computation_8h_source.html#l00380">NnetComputation::PrecomputedIndexesInfo::input_indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kBackprop</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kBackpropNoModelUpdate</a>, <a class="el" href="nnet-computation_8h_source.html#l00290">kaldi::nnet3::kPropagate</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00335">DerivativeTimeLimiter::nnet_</a>, <a class="el" href="nnet-computation_8h_source.html#l00381">NnetComputation::PrecomputedIndexesInfo::output_indexes</a>, and <a class="el" href="nnet-component-itf_8h_source.html#l00302">Component::PrecomputeIndexes()</a>.</p>
<div class="fragment"><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;                                                    {</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;  <span class="comment">// for each element of &#39;component_precomputed_indexes&#39;,</span></div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;  <span class="comment">// we will try to work out the command-index of the associated</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;  <span class="comment">// Propagate() command and of the associated Backprop() command,</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;  <span class="comment">// if it exists.</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;  <span class="comment">// We expect that each such element will be associated with</span></div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;  <span class="comment">// exactly one Propagate() command and at most one Backprop() command.</span></div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;  int32 num_commands = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size(),</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;    num_precomputed_indexes = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">component_precomputed_indexes</a>.size();</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;  std::vector&lt;bool&gt; need_backprop(num_precomputed_indexes, <span class="keyword">false</span>);</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;  std::vector&lt;int32&gt; component_index(num_precomputed_indexes, -1);</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;  <span class="keywordflow">for</span> (int32 command_index = 0; command_index &lt; num_commands; command_index++) {</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;    <span class="keyword">const</span> NnetComputation::Command &amp;c = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command_index];</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;    <span class="keywordflow">if</span> (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a> &amp;&amp; c.arg2 &gt; 0) {</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c.arg2 &lt; num_precomputed_indexes);</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;      component_index[c.arg2] = c.arg1;</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;    }</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;    <span class="keywordflow">if</span> ((c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a> ||</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;         c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>) &amp;&amp; c.arg2 &gt; 0) {</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c.arg2 &lt; num_precomputed_indexes);</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;      need_backprop[c.arg2] = <span class="keyword">true</span>;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;    }</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;  }</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> p = 1;</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;       p &lt; <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">component_precomputed_indexes</a>.size();</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;       ++p)</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;    <span class="keyword">delete</span> <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">component_precomputed_indexes</a>[p].data;</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">component_precomputed_indexes</a>.clear();</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">component_precomputed_indexes</a>.resize(</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      num_precomputed_indexes);</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;  <span class="keywordflow">for</span> (int32 p = 1; p &lt; num_precomputed_indexes; ++p) {</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    <span class="keyword">const</span> NnetComputation::PrecomputedIndexesInfo &amp;old_info =</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">component_precomputed_indexes</a>[p];</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;    NnetComputation::PrecomputedIndexesInfo &amp;new_info =</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">component_precomputed_indexes</a>[p];</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!old_info.input_indexes.empty() &amp;&amp;</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                 !old_info.output_indexes.empty() &amp;&amp;</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;                 <span class="stringliteral">&quot;Input/output indexes not present in precomputed info of &quot;</span></div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;                 <span class="stringliteral">&quot;computation to be expanded.&quot;</span>);</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;    <span class="comment">// note: we could place these expanded indexes into &#39;new_info.input_indexes&#39;</span></div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;    <span class="comment">// and &#39;new_info.output_indexes&#39;, but we actually don&#39;t need to keep them</span></div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    <span class="comment">// there, because they are only required to be kept in computations where</span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;    <span class="comment">// the n indexes consist of the set (0, 1), and the computation we&#39;re</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;    <span class="comment">// creating has more distinct n indexes than that.</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;    std::vector&lt;Index&gt; input_indexes, output_indexes;</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0d39b8710ac9abb65b0812bc1a82f52e">ExpandIndexes</a>(old_info.input_indexes, &amp;input_indexes);</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0d39b8710ac9abb65b0812bc1a82f52e">ExpandIndexes</a>(old_info.output_indexes, &amp;output_indexes);</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(component_index[p] &gt;= 0);</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    <span class="keyword">const</span> Component *component = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(component_index[p]);</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;    ComponentPrecomputedIndexes *expanded_precomputed_indexes =</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;        component-&gt;<a class="code" href="classkaldi_1_1nnet3_1_1Component.html#ad3829084b3e064ff320153ff4b6cfd44">PrecomputeIndexes</a>(<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a96c233d2a3038b6ce3f46adc9eeac6c8">misc_info_</a>, input_indexes,</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;                                     output_indexes, need_backprop[p]);</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;    <span class="comment">// this object should not be null because it was not NULL the</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;    <span class="comment">// last time we generated it from the same component, for the</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;    <span class="comment">// same computation.</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(expanded_precomputed_indexes != NULL);</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;    new_info.data = expanded_precomputed_indexes;</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;  }</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::ComputationExpander::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03288">nnet-optimize-utils.cc:3288</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a96c233d2a3038b6ce3f46adc9eeac6c8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a96c233d2a3038b6ce3f46adc9eeac6c8">kaldi::nnet3::ComputationExpander::misc_info_</a></div><div class="ttdeci">const MiscComputationInfo &amp; misc_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03289">nnet-optimize-utils.cc:3289</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Component_html_ad3829084b3e064ff320153ff4b6cfd44"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Component.html#ad3829084b3e064ff320153ff4b6cfd44">kaldi::nnet3::Component::PrecomputeIndexes</a></div><div class="ttdeci">virtual ComponentPrecomputedIndexes * PrecomputeIndexes(const MiscComputationInfo &amp;misc_info, const std::vector&lt; Index &gt; &amp;input_indexes, const std::vector&lt; Index &gt; &amp;output_indexes, bool need_backprop) const</div><div class="ttdoc">This function must return NULL for simple Components. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00302">nnet-component-itf.h:302</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00439">nnet-computation.h:439</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a0d39b8710ac9abb65b0812bc1a82f52e"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0d39b8710ac9abb65b0812bc1a82f52e">kaldi::nnet3::ComputationExpander::ExpandIndexes</a></div><div class="ttdeci">void ExpandIndexes(const std::vector&lt; Index &gt; &amp;indexes, std::vector&lt; Index &gt; *indexes_expanded) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03794">nnet-optimize-utils.cc:3794</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kaldi::nnet3::kBackpropNoModelUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">Return component indexed c. Not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00150">nnet-nnet.cc:150</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ab8ae09d46a89f34a89b970a24156481d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab8ae09d46a89f34a89b970a24156481d">kaldi::nnet3::NnetComputation::component_precomputed_indexes</a></div><div class="ttdeci">std::vector&lt; PrecomputedIndexesInfo &gt; component_precomputed_indexes</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00412">nnet-computation.h:412</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00290">nnet-computation.h:290</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0618c08b05537029106fab90e16dfe0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0618c08b05537029106fab90e16dfe0">&#9670;&nbsp;</a></span>ComputeSubmatrixInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeSubmatrixInfo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03637">3637</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00317">NnetComputation::MatrixDebugInfo::cindexes</a>, <a class="el" href="nnet-computation_8h_source.html#l00327">NnetComputation::SubMatrixInfo::col_offset</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8cc_source.html#l00424">NnetComputation::GetSubmatrixStrings()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, <a class="el" href="nnet-computation_8h_source.html#l00324">NnetComputation::SubMatrixInfo::matrix_index</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00335">DerivativeTimeLimiter::nnet_</a>, <a class="el" href="nnet-computation_8h_source.html#l00328">NnetComputation::SubMatrixInfo::num_cols</a>, <a class="el" href="nnet-computation_8h_source.html#l00326">NnetComputation::SubMatrixInfo::num_rows</a>, <a class="el" href="nnet-computation_8cc_source.html#l00717">NnetComputation::Print()</a>, <a class="el" href="nnet-computation_8h_source.html#l00325">NnetComputation::SubMatrixInfo::row_offset</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;                                               {</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;  int32 num_submatrices = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>.size();</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>.resize(num_submatrices);</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;  <span class="comment">// Sub-matrix zero is a special case; it&#39;s the empty submatrix.</span></div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[0] = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[0];</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;  <span class="keywordflow">for</span> (int32 s = 1; s &lt; num_submatrices; s++) {</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;    <span class="keyword">const</span> NnetComputation::SubMatrixInfo &amp;info_in = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s];</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;    int32 m = info_in.matrix_index;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    <span class="keyword">const</span> NnetComputation::MatrixDebugInfo &amp;debug_info_in =</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[m];</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;    <span class="comment">// we may need to change the row_offset and num_rows.</span></div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;    int32 first_row_in = info_in.row_offset,</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;        last_row_in = first_row_in + info_in.num_rows - 1;</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="keywordflow">if</span> (!(debug_info_in.cindexes[first_row_in].second.n == 0 &amp;&amp;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;          debug_info_in.cindexes[last_row_in].second.n == 1)) {</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;      std::ostringstream computation_ss;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;      std::vector&lt;std::string&gt; submat_strings;</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#abf2fedad8e73e55adba8dba14361967f">GetSubmatrixStrings</a>(<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">nnet_</a>, &amp;submat_strings);</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">Print</a>(computation_ss, <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">nnet_</a>);</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Submatrix s&quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; submat_strings[s]</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; has strange dimensions.  Computation is: &quot;</span></div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;                &lt;&lt; computation_ss.str();</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;    }</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;    int32 first_row_out = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">GetNewMatrixLocationInfo</a>(m, first_row_in),</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        last_row_out = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">GetNewMatrixLocationInfo</a>(m, last_row_in),</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        new_num_rows = (last_row_out + 1 - first_row_out);</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    NnetComputation::SubMatrixInfo &amp;info_out =</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s];</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;    info_out.matrix_index = m;</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    info_out.row_offset = first_row_out;</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;    info_out.num_rows = new_num_rows;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;    info_out.col_offset = info_in.col_offset;</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    info_out.num_cols = info_in.num_cols;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;  }</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ad608a50eef55fe012c53acb48f1de02b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">kaldi::nnet3::NnetComputation::matrix_debug_info</a></div><div class="ttdeci">std::vector&lt; MatrixDebugInfo &gt; matrix_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00394">nnet-computation.h:394</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::ComputationExpander::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03288">nnet-optimize-utils.cc:3288</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a849faa82711b6faa8551205167721bfa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a849faa82711b6faa8551205167721bfa">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00717">nnet-computation.cc:717</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_aaa7be32bf8cc53a5cfb20eb89280dd06"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">kaldi::nnet3::ComputationExpander::GetNewMatrixLocationInfo</a></div><div class="ttdeci">int32 GetNewMatrixLocationInfo(int32 old_matrix_index, int32 old_row_index) const</div><div class="ttdoc">This function is used in mapping row-indexes into matrices, from the old to the new computation...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03761">nnet-optimize-utils.cc:3761</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00404">nnet-computation.h:404</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_abf2fedad8e73e55adba8dba14361967f"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#abf2fedad8e73e55adba8dba14361967f">kaldi::nnet3::NnetComputation::GetSubmatrixStrings</a></div><div class="ttdeci">void GetSubmatrixStrings(const Nnet &amp;nnet, std::vector&lt; std::string &gt; *submat_strings) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00424">nnet-computation.cc:424</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2eb79493ded57c85f60b26089cbc7ae3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eb79493ded57c85f60b26089cbc7ae3">&#9670;&nbsp;</a></span>EnsureDebugInfoExists()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void EnsureDebugInfoExists </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>submatrix_index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a740071247a178d84b8bf2b17901509b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a740071247a178d84b8bf2b17901509b4">&#9670;&nbsp;</a></span>Expand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Expand </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03573">3573</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, and <a class="el" href="nnet-computation_8h_source.html#l00442">NnetComputation::need_model_derivative</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l03804">kaldi::nnet3::ExpandComputation()</a>.</p>
<div class="fragment"><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                                 {</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a652f9fe87cd1b276eb349312151054f8">InitStrideInfo</a>();</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aecd7fa564d816a5025ca66346f6b80fe">ComputeMatrixInfo</a>();</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0ad00746c585650630f59ba3b3c3dad1">need_debug_info_</a>)</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a349da8d95ac1defe31a714e52954bbde">ComputeDebugInfo</a>();</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>.clear();</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ac0618c08b05537029106fab90e16dfe0">ComputeSubmatrixInfo</a>();</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aad666818585d567208e5833cd3ed6ea4">ComputePrecomputedIndexes</a>();</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a47b759979e43092bbb39fc8897f6b143">ComputeCommands</a>();</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a> =</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a>;</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ad608a50eef55fe012c53acb48f1de02b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">kaldi::nnet3::NnetComputation::matrix_debug_info</a></div><div class="ttdeci">std::vector&lt; MatrixDebugInfo &gt; matrix_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00394">nnet-computation.h:394</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a0ad00746c585650630f59ba3b3c3dad1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a0ad00746c585650630f59ba3b3c3dad1">kaldi::nnet3::ComputationExpander::need_debug_info_</a></div><div class="ttdeci">bool need_debug_info_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03291">nnet-optimize-utils.cc:3291</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_ac0618c08b05537029106fab90e16dfe0"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ac0618c08b05537029106fab90e16dfe0">kaldi::nnet3::ComputationExpander::ComputeSubmatrixInfo</a></div><div class="ttdeci">void ComputeSubmatrixInfo()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03637">nnet-optimize-utils.cc:3637</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_aecd7fa564d816a5025ca66346f6b80fe"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aecd7fa564d816a5025ca66346f6b80fe">kaldi::nnet3::ComputationExpander::ComputeMatrixInfo</a></div><div class="ttdeci">void ComputeMatrixInfo()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03588">nnet-optimize-utils.cc:3588</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a58c542fffb7e7f754148c264c90b4a5e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a58c542fffb7e7f754148c264c90b4a5e">kaldi::nnet3::NnetComputation::need_model_derivative</a></div><div class="ttdeci">bool need_model_derivative</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00442">nnet-computation.h:442</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a652f9fe87cd1b276eb349312151054f8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a652f9fe87cd1b276eb349312151054f8">kaldi::nnet3::ComputationExpander::InitStrideInfo</a></div><div class="ttdeci">void InitStrideInfo()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03548">nnet-optimize-utils.cc:3548</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a47b759979e43092bbb39fc8897f6b143"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a47b759979e43092bbb39fc8897f6b143">kaldi::nnet3::ComputationExpander::ComputeCommands</a></div><div class="ttdeci">void ComputeCommands()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03501">nnet-optimize-utils.cc:3501</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_aad666818585d567208e5833cd3ed6ea4"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aad666818585d567208e5833cd3ed6ea4">kaldi::nnet3::ComputationExpander::ComputePrecomputedIndexes</a></div><div class="ttdeci">void ComputePrecomputedIndexes()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03676">nnet-optimize-utils.cc:3676</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a349da8d95ac1defe31a714e52954bbde"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a349da8d95ac1defe31a714e52954bbde">kaldi::nnet3::ComputationExpander::ComputeDebugInfo</a></div><div class="ttdeci">void ComputeDebugInfo()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03603">nnet-optimize-utils.cc:3603</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d39b8710ac9abb65b0812bc1a82f52e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d39b8710ac9abb65b0812bc1a82f52e">&#9670;&nbsp;</a></span>ExpandIndexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ExpandIndexes </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>indexes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet3_1_1Index.html">Index</a> &gt; *&#160;</td>
          <td class="paramname"><em>indexes_expanded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03794">3794</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8cc_source.html#l03106">kaldi::nnet3::ConvertNumNValues()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02942">kaldi::nnet3::FindNStride()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;                                              {</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;  <span class="keywordtype">bool</span> full_check = <span class="keyword">false</span>;</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;  int32 n_stride = <a class="code" href="namespacekaldi_1_1nnet3.html#a79122735e3f124a6865ff339f40ec191">FindNStride</a>(indexes, full_check);</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(n_stride &gt; 0);</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a4a1bed82d2cb5fbdc695bf32053117ad">ConvertNumNValues</a>(n_stride, 2, <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>,</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;                    indexes, indexes_expanded);</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet3_html_a4a1bed82d2cb5fbdc695bf32053117ad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4a1bed82d2cb5fbdc695bf32053117ad">kaldi::nnet3::ConvertNumNValues</a></div><div class="ttdeci">static void ConvertNumNValues(int32 n_stride, int32 old_N, int32 new_N, const std::vector&lt; Index &gt; &amp;indexes_in, std::vector&lt; Index &gt; *indexes_out)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03106">nnet-optimize-utils.cc:3106</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a79122735e3f124a6865ff339f40ec191"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a79122735e3f124a6865ff339f40ec191">kaldi::nnet3::FindNStride</a></div><div class="ttdeci">static int32 FindNStride(const std::vector&lt; Index &gt; &amp;indexes, bool full_check)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02942">nnet-optimize-utils.cc:2942</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9bfd022e9b1b6b8bf5494afbcd8aff9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bfd022e9b1b6b8bf5494afbcd8aff9d">&#9670;&nbsp;</a></span>ExpandRowRangesCommand()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ExpandRowRangesCommand </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;&#160;</td>
          <td class="paramname"><em>c_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *&#160;</td>
          <td class="paramname"><em>c_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03426">3426</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00430">NnetComputation::indexes_ranges</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;                                   {</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;  <span class="comment">// we need to expand the pairs of row-indexes in c_in.arg2, and put the index</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;  <span class="comment">// of the resulting vector&lt;int&gt; in expanded_computation_-&gt;indexes_ranges, in</span></div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  <span class="comment">// &#39;c_out-&gt;arg2&#39;.</span></div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;  int32 s1 = c_in.arg1, s2 = c_in.arg2,</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;      num_rows_old = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].num_rows,</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      num_rows_new = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].num_rows;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(c_in.arg3) &lt;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;               <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3095d45a751aaa81c1024cf9510e2ed7">indexes_ranges</a>.size());</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;  int32 num_n_values = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;  int32 old_arg3 = c_out-&gt;arg3;</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;  c_out-&gt;arg3 = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3095d45a751aaa81c1024cf9510e2ed7">indexes_ranges</a>.size();</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3095d45a751aaa81c1024cf9510e2ed7">indexes_ranges</a>.push_back(</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      std::vector&lt;std::pair&lt;int32, int32&gt; &gt;());</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;new_indexes_ranges =</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3095d45a751aaa81c1024cf9510e2ed7">indexes_ranges</a>.back();</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;old_indexes_ranges =</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3095d45a751aaa81c1024cf9510e2ed7">indexes_ranges</a>[old_arg3];</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;  <span class="comment">// old_indexes_ranges is a vector that has the same size as the num-rows of</span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;  <span class="comment">// submatrix s1.  It contains pairs that are either two copies of the same</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  <span class="comment">// value (in practice the pair (-1, -1)), or pairs (begin-row-index,</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;  <span class="comment">// end-row-index) representing the (begin,end) of a range in submatrix s2.</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;  <span class="comment">// Note: end-row-index is one past the end of the range, as for C++ iterators.</span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;int32&gt;(old_indexes_ranges.size()) == num_rows_old);</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;  new_indexes_ranges.resize(num_rows_new,</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;                           std::pair&lt;int32,int32&gt;(-1, -1));</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;  <span class="keywordflow">for</span> (int32 i1 = 0; i1 &lt; num_rows_old; i1++) {</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    int32 new_i1_n0, n_stride1;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a>(s1, i1, &amp;new_i1_n0, &amp;n_stride1)) {</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;      <span class="comment">// GetNewSubmatLocationInfo() returns true if this corresponds to</span></div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      <span class="comment">// a Cindex with n == 0.</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;      int32 i2_begin = old_indexes_ranges[i1].first,</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;          i2_end = old_indexes_ranges[i1].second;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;      <span class="keywordflow">if</span> (i2_end == i2_begin)</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;        <span class="keywordflow">continue</span>;  <span class="comment">// (-1, -1) pair, meaning an empty range.</span></div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                   <span class="comment">// &#39;new_indexes_ranges&#39; is filled with (-1, -1) pairs as a</span></div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;                   <span class="comment">// default so we don&#39;t have to do anything for these</span></div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                   <span class="comment">// elements.</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;      int32 i2_last = i2_end - 1;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      int32 new_i2_n0_begin, new_i2_n0_last,</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;          n_stride2;  <span class="comment">// only 1 stride variable; both calls will output</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;                          <span class="comment">// the same value.</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      <span class="keywordtype">bool</span> ans1 = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a>(s2, i2_begin, &amp;new_i2_n0_begin,</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;                                           &amp;n_stride2),</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;          ans2 = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a>(s2, i2_last, &amp;new_i2_n0_last,</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                                          &amp;n_stride2);</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans1 &amp;&amp; ans2 &amp;&amp; new_i2_n0_last &gt;= new_i2_n0_begin &amp;&amp;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                   new_i2_n0_begin &gt;= 0 &amp;&amp; n_stride1 &gt; 0 &amp;&amp; n_stride2 &gt; 0);</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;      <span class="comment">// source should also be for n==0, because we don&#39;t (or at least</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      <span class="comment">// shouldn&#39;t) create computations that mix up the &#39;n&#39; values</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      int32 new_i1 = new_i1_n0,</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;          new_i2_begin = new_i2_n0_begin,</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;          new_i2_end = new_i2_n0_last + 1;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_n_values;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;           <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++, new_i1 += n_stride1, new_i2_begin += n_stride2,</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;               new_i2_end += n_stride2) {</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;        new_indexes_ranges[new_i1].first = new_i2_begin;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;        new_indexes_ranges[new_i1].second = new_i2_end;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      }</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;    }</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;  }</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00404">nnet-computation.h:404</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_ae75e6d0c1a5e33b7b6a02175357f0fcd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">kaldi::nnet3::ComputationExpander::GetNewSubmatLocationInfo</a></div><div class="ttdeci">bool GetNewSubmatLocationInfo(int32 submat_index, int32 old_row_index, int32 *new_row_index, int32 *n_stride) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03743">nnet-optimize-utils.cc:3743</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a3095d45a751aaa81c1024cf9510e2ed7"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a3095d45a751aaa81c1024cf9510e2ed7">kaldi::nnet3::NnetComputation::indexes_ranges</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; indexes_ranges</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00430">nnet-computation.h:430</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a87cbe94f28fe1fbbbcde4e650b5fbfe2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87cbe94f28fe1fbbbcde4e650b5fbfe2">&#9670;&nbsp;</a></span>ExpandRowsCommand()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ExpandRowsCommand </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;&#160;</td>
          <td class="paramname"><em>c_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *&#160;</td>
          <td class="paramname"><em>c_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03298">3298</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00340">NnetComputation::Command::alpha</a>, <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00343">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00419">NnetComputation::indexes</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                                   {</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;  <span class="comment">// we need to expand the row-indexes in c_in.arg3, and put the index of the</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;  <span class="comment">// resulting vector&lt;int&gt; in expanded_computation_-&gt;indexes, in &#39;c_out-&gt;arg3&#39;.</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;  int32 s1 = c_in.arg1, s2 = c_in.arg2;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;  <span class="comment">// The command that gets called is something like</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;  <span class="comment">// submat1.AddRows(submat2, indexes) if submat1 is the submatrix referred to in</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;  <span class="comment">// &#39;s1&#39; and submat2 is the submatrix referred to in &#39;s2&#39;.</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;  <span class="comment">// &#39;indexes&#39; has the same size as the num-rows of submat1, and the values</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;  <span class="comment">// in the vector are row-indexes into s2.</span></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;  int32 old_arg3 = c_out-&gt;arg3;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;  c_out-&gt;arg3 = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab84babea5bedf77dcfd64a0df53219c5">indexes</a>.size();</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;  c_out-&gt;alpha = c_in.alpha;</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab84babea5bedf77dcfd64a0df53219c5">indexes</a>.push_back(std::vector&lt;int32&gt;());</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;  std::vector&lt;int32&gt; &amp;new_indexes = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab84babea5bedf77dcfd64a0df53219c5">indexes</a>.back();</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;  <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;old_indexes = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab84babea5bedf77dcfd64a0df53219c5">indexes</a>[old_arg3];</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;  int32 old_size = old_indexes.size(),</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;      num_n_values = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>,</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;      new_s1_size = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].num_rows,</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      new_s2_size = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s2].num_rows;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(old_size == <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].num_rows);</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;  new_indexes.resize(new_s1_size, -1);</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;  <span class="comment">// A note on the variable names: i1 and i2 are indexes into the destination</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;  <span class="comment">// submatrix and the source submatrix respectively, of the CopyRows or AddRows</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;  <span class="comment">// command.</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;  <span class="comment">// &quot;n0&quot; in the variable name means that this corresponds to an Index with n==0.</span></div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;  <span class="comment">// things without &quot;new&quot; in the name refer to the old computation; things with</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;  <span class="comment">// &quot;new&quot; in the name refer to the computation that we are generating.</span></div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;  <span class="keywordflow">for</span> (int32 i1 = 0; i1 &lt; old_size; i1++) {</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    int32 new_i1_n0, n_stride1;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a>(s1, i1, &amp;new_i1_n0, &amp;n_stride1)) {</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;      <span class="comment">// GetNewSubmatLocationInfo() returns true if this corresponds to</span></div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      <span class="comment">// a Cindex with n == 0.</span></div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      int32 i2 = old_indexes[i1];  <span class="comment">// note: i2 is the row index into submatrix s2.</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;      int32 new_i2_n0, n_stride2;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;      <span class="keywordflow">if</span> (i2 &lt; 0) {  <span class="comment">// if i2 is -1, we&#39;ll just leave any relevant positions in</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                     <span class="comment">// &#39;new_indexes&#39; with -1&#39;s in them.</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;        <span class="keywordtype">bool</span> ans = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a>(s2, i2, &amp;new_i2_n0, &amp;n_stride2);</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans);  <span class="comment">// source should also be for n==0, because we don&#39;t</span></div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;                            <span class="comment">// (or at least shouldn&#39;t) create computations that</span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                            <span class="comment">// mix up the &#39;n&#39; values</span></div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;        int32 new_i1 = new_i1_n0, new_i2 = new_i2_n0;</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;        <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_n_values;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;             ++<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, new_i1 += n_stride1, new_i2 += n_stride2) {</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;          <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(new_i1 &lt; new_s1_size &amp;&amp; new_i2 &lt; new_s2_size);</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;          new_indexes[new_i1] = new_i2;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        }</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;      }</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    }</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;  }</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00404">nnet-computation.h:404</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ab84babea5bedf77dcfd64a0df53219c5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ab84babea5bedf77dcfd64a0df53219c5">kaldi::nnet3::NnetComputation::indexes</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int32 &gt; &gt; indexes</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00419">nnet-computation.h:419</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_ae75e6d0c1a5e33b7b6a02175357f0fcd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">kaldi::nnet3::ComputationExpander::GetNewSubmatLocationInfo</a></div><div class="ttdeci">bool GetNewSubmatLocationInfo(int32 submat_index, int32 old_row_index, int32 *new_row_index, int32 *n_stride) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03743">nnet-optimize-utils.cc:3743</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6b2ebb0f18100bdd03194aac19da1e09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b2ebb0f18100bdd03194aac19da1e09">&#9670;&nbsp;</a></span>ExpandRowsMultiCommand()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ExpandRowsMultiCommand </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;&#160;</td>
          <td class="paramname"><em>c_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> *&#160;</td>
          <td class="paramname"><em>c_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03361">3361</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00341">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00342">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00425">NnetComputation::indexes_multi</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;                                   {</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;  <span class="comment">// we need to expand the (submatrix,row)-index pairs in c_in.arg2, and put the</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;  <span class="comment">// index of the resulting vector&lt;int&gt; in expanded_computation_-&gt;indexes_multi,</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;  <span class="comment">// in &#39;c_out-&gt;arg2&#39;.</span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;  int32 s1 = c_in.arg1,</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;      num_rows_old = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].num_rows,</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;      num_rows_new = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].num_rows;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_rows_old % 2 == 0);</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;  int32 num_n_values = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;  int32 old_arg2 = c_out-&gt;arg2;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;  c_out-&gt;arg2 = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#aa8c3cb92dfb1d06fbfc4fe902f367c94">indexes_multi</a>.size();</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#aa8c3cb92dfb1d06fbfc4fe902f367c94">indexes_multi</a>.push_back(</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;      std::vector&lt;std::pair&lt;int32, int32&gt; &gt;());</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;  std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;new_indexes_multi =</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#aa8c3cb92dfb1d06fbfc4fe902f367c94">indexes_multi</a>.back();</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::pair&lt;int32, int32&gt; &gt; &amp;old_indexes_multi =</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#aa8c3cb92dfb1d06fbfc4fe902f367c94">indexes_multi</a>[old_arg2];</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;  <span class="comment">// old_indexes_multi is a vector that has the same size as the num-rows</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;  <span class="comment">// of submatrix s1.  It contains pairs that are either (-1, -1), or</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;  <span class="comment">// pairs (submatrix-index, row-index) referring to other submatrices</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;  <span class="comment">// in the computation.</span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;int32&gt;(old_indexes_multi.size()) == num_rows_old);</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;  new_indexes_multi.resize(num_rows_new,</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;                           std::pair&lt;int32,int32&gt;(-1, -1));</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;  <span class="keywordflow">for</span> (int32 i1 = 0; i1 &lt; num_rows_old; i1++) {</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    int32 new_i1_n0, n_stride1;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a>(s1, i1, &amp;new_i1_n0, &amp;n_stride1)) {</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;      <span class="comment">// GetNewSubmatLocationInfo() returns true if this corresponds to</span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      <span class="comment">// a Cindex with n == 0.</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;      int32 s2 = old_indexes_multi[i1].first,</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;          i2 = old_indexes_multi[i1].second;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;      int32 new_i2_n0, n_stride2;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;      <span class="keywordflow">if</span> (s2 &lt; 0) {  <span class="comment">// if s2 is -1, we don&#39;t have to do anything... we&#39;d have</span></div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;                     <span class="comment">// to fill any relevant positions in &#39;new_indexes_multi&#39;</span></div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;                     <span class="comment">// with (-1,-1)&#39;s, but it&#39;s filled with that by default.</span></div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;        <span class="keywordtype">bool</span> ans = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">GetNewSubmatLocationInfo</a>(s2, i2, &amp;new_i2_n0, &amp;n_stride2);</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans);  <span class="comment">// source should also be for n==0, because we don&#39;t</span></div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;                            <span class="comment">// (or at least shouldn&#39;t) create computations that</span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;                            <span class="comment">// mix up the &#39;n&#39; values</span></div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        int32 new_i1 = new_i1_n0, new_i2 = new_i2_n0;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;        <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_n_values;</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;             <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++, new_i1 += n_stride1, new_i2 += n_stride2) {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;          new_indexes_multi[new_i1].first = s2;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;          new_indexes_multi[new_i1].second = new_i2;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;        }</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;      }</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;    }</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;  }</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_aa8c3cb92dfb1d06fbfc4fe902f367c94"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#aa8c3cb92dfb1d06fbfc4fe902f367c94">kaldi::nnet3::NnetComputation::indexes_multi</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; &gt; indexes_multi</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00425">nnet-computation.h:425</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00404">nnet-computation.h:404</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_ae75e6d0c1a5e33b7b6a02175357f0fcd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#ae75e6d0c1a5e33b7b6a02175357f0fcd">kaldi::nnet3::ComputationExpander::GetNewSubmatLocationInfo</a></div><div class="ttdeci">bool GetNewSubmatLocationInfo(int32 submat_index, int32 old_row_index, int32 *new_row_index, int32 *n_stride) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03743">nnet-optimize-utils.cc:3743</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaa7be32bf8cc53a5cfb20eb89280dd06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa7be32bf8cc53a5cfb20eb89280dd06">&#9670;&nbsp;</a></span>GetNewMatrixLocationInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 GetNewMatrixLocationInfo </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>old_matrix_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>old_row_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function is used in mapping row-indexes into matrices, from the old to the new computation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">matrix_index</td><td>The matrix-index &gt; 0, for which we are mapping row-indexes. The matrix-indexes are the same in the old and new computations. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">old_row_index</td><td>The old row-index into the matrix. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function returns the row-index where the cindex referred to in 'old_matrix_index' will reside in the new, expanded computation, WITH THE CAVEAT THAT if the old cindex had n == 1, we'll output the location of the cindex with n == num_n_values_ - 1. This happens to be what we want (it maps the last n value on the input to the last n value on the output. </dd></dl>

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03761">3761</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>.</p>
<div class="fragment"><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;                                                   {</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;  <span class="comment">// to understand &#39;block_size&#39;, read the comment for FindNStride().</span></div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;  int32 n_stride = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">n_stride_</a>[matrix_index],</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;      old_num_n_values = 2, new_num_n_values = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">num_n_values_</a>,</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;      old_block_size = old_num_n_values * n_stride,</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;      new_block_size = new_num_n_values * n_stride,</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;      block_index = old_row_index / old_block_size,</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;      offset_within_block = old_row_index % old_block_size;</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  <span class="comment">// within each block, we can show, given our assumptions, that</span></div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;  <span class="comment">// we must first have a sub-block of &#39;n_stride&#39; values all with</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;  <span class="comment">// n == 0, then another sub-clock of &#39;n_stride&#39; values all with</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;  <span class="comment">// n == 1, and so on.  [except there is no &#39;and so on&#39; for the</span></div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;  <span class="comment">// input computation, where we expect the &#39;n&#39; values to be the</span></div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;  <span class="comment">// set {0, 1}.]</span></div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;  int32 old_n_value = offset_within_block / n_stride,</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;      index_within_subblock = offset_within_block % n_stride;</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  <span class="keyword">const</span> std::vector&lt;Cindex&gt; &amp;cindexes =</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[matrix_index].cindexes;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(old_n_value == cindexes[old_row_index].second.n &amp;&amp;</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;               (old_n_value == 0 || old_n_value == 1));</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;  <span class="comment">// Search for CAVEAT in the comment for this function to see what this is</span></div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;  <span class="comment">// about.  Mapping old_n_value == 1 -&gt; new_n_value == new_num_n_values - 1</span></div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;  <span class="comment">// just happens to be useful for the way we use this function... it maps the</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;  <span class="comment">// end of an old submatrix to the end of a new submatrix.</span></div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;  int32 new_n_value = (old_n_value == 0 ? 0 : new_num_n_values - 1);</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;  <span class="keywordflow">return</span> block_index * new_block_size + index_within_subblock +</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;      new_n_value * n_stride;</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ad608a50eef55fe012c53acb48f1de02b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">kaldi::nnet3::NnetComputation::matrix_debug_info</a></div><div class="ttdeci">std::vector&lt; MatrixDebugInfo &gt; matrix_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00394">nnet-computation.h:394</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_af983142dc68170e669067284f55e06b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">kaldi::nnet3::ComputationExpander::n_stride_</a></div><div class="ttdeci">std::vector&lt; int32 &gt; n_stride_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03286">nnet-optimize-utils.cc:3286</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a9a0388f6e3ce9318db544eef95415305"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a9a0388f6e3ce9318db544eef95415305">kaldi::nnet3::ComputationExpander::num_n_values_</a></div><div class="ttdeci">int32 num_n_values_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03292">nnet-optimize-utils.cc:3292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae75e6d0c1a5e33b7b6a02175357f0fcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae75e6d0c1a5e33b7b6a02175357f0fcd">&#9670;&nbsp;</a></span>GetNewSubmatLocationInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> GetNewSubmatLocationInfo </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>submat_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>old_row_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>new_row_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>n_stride</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03743">3743</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00317">NnetComputation::MatrixDebugInfo::cindexes</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>, and <a class="el" href="nnet-computation_8h_source.html#l00404">NnetComputation::submatrices</a>.</p>
<div class="fragment"><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;                                                 {</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;  int32 matrix_index = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[submat_index].matrix_index,</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;   old_row_offset = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[submat_index].row_offset,</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;   new_row_offset = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">expanded_computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[submat_index].row_offset;</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;  <span class="keyword">const</span> NnetComputation::MatrixDebugInfo &amp;debug_info_in =</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[matrix_index];</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;  <span class="keywordflow">if</span> (debug_info_in.cindexes[old_row_index + old_row_offset].second.n != 0)</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;  *new_row_index = (<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">GetNewMatrixLocationInfo</a>(matrix_index,</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                                             old_row_index + old_row_offset) -</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;                    new_row_offset);</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;  *n_stride = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">n_stride_</a>[matrix_index];</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ad608a50eef55fe012c53acb48f1de02b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">kaldi::nnet3::NnetComputation::matrix_debug_info</a></div><div class="ttdeci">std::vector&lt; MatrixDebugInfo &gt; matrix_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00394">nnet-computation.h:394</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_aaa7be32bf8cc53a5cfb20eb89280dd06"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#aaa7be32bf8cc53a5cfb20eb89280dd06">kaldi::nnet3::ComputationExpander::GetNewMatrixLocationInfo</a></div><div class="ttdeci">int32 GetNewMatrixLocationInfo(int32 old_matrix_index, int32 old_row_index) const</div><div class="ttdoc">This function is used in mapping row-indexes into matrices, from the old to the new computation...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03761">nnet-optimize-utils.cc:3761</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_afa02f703a75537d153178d8ad1e104ad"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#afa02f703a75537d153178d8ad1e104ad">kaldi::nnet3::ComputationExpander::expanded_computation_</a></div><div class="ttdeci">NnetComputation * expanded_computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03293">nnet-optimize-utils.cc:3293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00404">nnet-computation.h:404</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_af983142dc68170e669067284f55e06b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">kaldi::nnet3::ComputationExpander::n_stride_</a></div><div class="ttdeci">std::vector&lt; int32 &gt; n_stride_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03286">nnet-optimize-utils.cc:3286</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a652f9fe87cd1b276eb349312151054f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a652f9fe87cd1b276eb349312151054f8">&#9670;&nbsp;</a></span>InitStrideInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void InitStrideInfo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03548">3548</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-computation_8h_source.html#l00317">NnetComputation::MatrixDebugInfo::cindexes</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00342">DerivativeTimeLimiter::computation_</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l02942">kaldi::nnet3::FindNStride()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="nnet-computation_8h_source.html#l00390">NnetComputation::matrices</a>, and <a class="el" href="nnet-computation_8h_source.html#l00394">NnetComputation::matrix_debug_info</a>.</p>
<div class="fragment"><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;                                         {</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;  <span class="comment">// note: the zeroth matrix is not a real matrix, it&#39;s the empty matrix.</span></div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;  int32 num_matrices = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>.size();</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">n_stride_</a>.resize(num_matrices);</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">n_stride_</a>[0] = 0;</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;  <span class="comment">// the input computation to class ComputationExpander is required to</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;  <span class="comment">// have its debug info set up.</span></div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!<a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>.empty());</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;  <span class="keywordflow">for</span> (int32 m = 1; m &lt; num_matrices; m++) {</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    int32 num_rows = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m].num_rows;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;    <span class="keyword">const</span> NnetComputation::MatrixDebugInfo &amp;debug_info = <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">computation_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">matrix_debug_info</a>[m];</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(debug_info.cindexes.size() == num_rows);</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;    <span class="keywordtype">bool</span> full_check = <span class="keyword">true</span>;  <span class="comment">// TODO: eventually change this to false.</span></div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;    int32 n_stride = <a class="code" href="namespacekaldi_1_1nnet3.html#a79122735e3f124a6865ff339f40ec191">FindNStride</a>(debug_info.cindexes, full_check);</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    <span class="keywordflow">if</span> (n_stride == 0) {</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Problem encountered in &#39;shortcut&#39; compilation: the computation &quot;</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;does not have the expected structure.  Try compiling with &quot;</span></div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;--use-shortcut=false.&quot;</span>;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    }</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">n_stride_</a>[m] = n_stride;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;  }</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ad608a50eef55fe012c53acb48f1de02b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ad608a50eef55fe012c53acb48f1de02b">kaldi::nnet3::NnetComputation::matrix_debug_info</a></div><div class="ttdeci">std::vector&lt; MatrixDebugInfo &gt; matrix_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00394">nnet-computation.h:394</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a79122735e3f124a6865ff339f40ec191"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a79122735e3f124a6865ff339f40ec191">kaldi::nnet3::FindNStride</a></div><div class="ttdeci">static int32 FindNStride(const std::vector&lt; Index &gt; &amp;indexes, bool full_check)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l02942">nnet-optimize-utils.cc:2942</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_a81b35995b5ef2650f6367cb1299ef0fd"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#a81b35995b5ef2650f6367cb1299ef0fd">kaldi::nnet3::ComputationExpander::computation_</a></div><div class="ttdeci">const NnetComputation &amp; computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03290">nnet-optimize-utils.cc:3290</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a47a751a8db1c9c4856d04495f80620e9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">kaldi::nnet3::NnetComputation::matrices</a></div><div class="ttdeci">std::vector&lt; MatrixInfo &gt; matrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00390">nnet-computation.h:390</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationExpander_html_af983142dc68170e669067284f55e06b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationExpander.html#af983142dc68170e669067284f55e06b8">kaldi::nnet3::ComputationExpander::n_stride_</a></div><div class="ttdeci">std::vector&lt; int32 &gt; n_stride_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l03286">nnet-optimize-utils.cc:3286</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a81b35995b5ef2650f6367cb1299ef0fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81b35995b5ef2650f6367cb1299ef0fd">&#9670;&nbsp;</a></span>computation_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>&amp; computation_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03290">3290</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="afa02f703a75537d153178d8ad1e104ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa02f703a75537d153178d8ad1e104ad">&#9670;&nbsp;</a></span>expanded_computation_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>* expanded_computation_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03293">3293</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="a96c233d2a3038b6ce3f46adc9eeac6c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96c233d2a3038b6ce3f46adc9eeac6c8">&#9670;&nbsp;</a></span>misc_info_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html">MiscComputationInfo</a>&amp; misc_info_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03289">3289</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="af983142dc68170e669067284f55e06b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af983142dc68170e669067284f55e06b8">&#9670;&nbsp;</a></span>n_stride_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;int32&gt; n_stride_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03286">3286</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="a0ad00746c585650630f59ba3b3c3dad1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ad00746c585650630f59ba3b3c3dad1">&#9670;&nbsp;</a></span>need_debug_info_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> need_debug_info_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03291">3291</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="adbabf05a7702103113a02a113015205f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbabf05a7702103113a02a113015205f">&#9670;&nbsp;</a></span>nnet_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a>&amp; nnet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03288">3288</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<a id="a9a0388f6e3ce9318db544eef95415305"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a0388f6e3ce9318db544eef95415305">&#9670;&nbsp;</a></span>num_n_values_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 num_n_values_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l03292">3292</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>nnet3/<a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li><li class="navelem"><a class="el" href="classkaldi_1_1nnet3_1_1ComputationExpander.html">ComputationExpander</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
